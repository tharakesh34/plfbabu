<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
		
<changeSet author="Prasad" id="1" dbms="mssql, postgresql">
        <createTable tableName="DATA_ENGINE_PARSERS">
            <column name="ID" type="smallint">
                <constraints nullable="false"/>
            </column>
            <column name="TYPE" type="char(10)">
                <constraints nullable="false"/>
            </column>
            <column name="NAME" type="varchar(10)">
                <constraints nullable="false"/>
            </column>
            <column name="CLASSNAME" type="varchar(250)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
     <changeSet author="Prasad" id="1.1" dbms="mssql, postgresql">
        <addPrimaryKey columnNames="ID" constraintName="PK_DE_P_ID" tableName="DATA_ENGINE_PARSERS"/>
    </changeSet>
	<changeSet author="Prasad" id="2" dbms="mssql, postgresql">
        <createTable tableName="DATA_ENGINE_CONFIG">
            <column name="ID" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="NAME" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
            <column name="DESCRIPTION" type="varchar(250)"/>
            <column name="PARSER" type="smallint">
                <constraints nullable="false"/>
            </column>
            <column name="WORKSHEET" type="varchar(50)"/>
            <column name="TEXTQUALIFIER" type="char(1)"/>
            <column name="ROWDELIMITER" type="varchar(4)"/>
            <column name="COLUMNDELIMITER" type="char(1)"/>
            <column defaultValueNumeric="0" name="STARTINGROW" type="smallint">
                <constraints nullable="false"/>
            </column>
            <column name="SKIPHEADERROW" type="boolean"/>
            <column name="FIELDNAMES" type="CLOB"/>
            <column name="HEADER" type="CLOB"/>
            <column name="TRAILER" type="CLOB"/>
            <column name="UPLOADLOCATION" type="char(1)">
                <constraints nullable="false"/>
            </column>
            <column name="UPLOADPATH" type="varchar(250)"/>
            <column name="FILEPREFIXNAME" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
            <column name="FILEEXTENSION" type="varchar(250)"/>
            <column defaultValueNumeric="0" name="FILESEQUENCENO" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="LASTPROCESSEDON" type="datetime"/>
            <column name="FILENAMEFORMAT" type="varchar(250)"/>
            <column name="CRONEXPRESSION" type="varchar(50)"/>
            <column name="NOTIFICATIONSTATUSEMAIL" type="varchar(254)"/>
            <column name="POSTEVENT" type="varchar(100)"/>
            <column name="BACKUPFILE" type="boolean"/>
            <column name="ACTIVE" type="boolean"/>
        </createTable>
    </changeSet>
	<changeSet author="Prasad" id="3" dbms="mssql, postgresql">
        <addPrimaryKey columnNames="ID" constraintName="PK_DE_CONFIG_ID" tableName="DATA_ENGINE_CONFIG"/>
    </changeSet>
    <changeSet author="Prasad" id="3.1" dbms="mssql, postgresql">
        <addForeignKeyConstraint baseColumnNames="PARSER" baseTableName="DATA_ENGINE_CONFIG" constraintName="FK_DE_CONFIG_PARSER" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="ID" referencedTableName="DATA_ENGINE_PARSERS"/>
    </changeSet>
    <changeSet author="Prasad" id="3.2" dbms="mssql, postgresql">
        <addUniqueConstraint columnNames="NAME" constraintName="UK_DE_CONFIG_NAME" tableName="DATA_ENGINE_CONFIG"/>
    </changeSet>

	<changeSet author="prasad" id="4" dbms="mssql, postgresql">
        <createTable tableName="DATA_ENGINE_TABLE">
            <column name="Id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="ConfigId" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="Name" type="varchar(30)">
                <constraints nullable="false"/>
            </column>
            <column name="Operation" type="smallint"/>
            <column name="KeyFields" type="varchar(200)">
                <constraints nullable="false"/>
            </column>
            <column name="Filter" type="varchar(1000)"/>
            <column name="StatusUpdate" type="varchar(1000)"/>
            <column name="SkipRows" type="varchar(100)"/>
            <column name="Identifier" type="varchar(4)"/>
            <column name="Description" type="varchar(50)"/>
            <column name="StartIndex" type="varchar(20)"/>
            <column name="EndIndex" type="varchar(20)"/>
            <column defaultValueNumeric="0" name="RecordLength" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="MultiRow" type="boolean"/>
            <column name="PrepareXML" type="boolean"/>
            <column name="XmlField" type="varchar(30)"/>
        </createTable>
    </changeSet>
    <changeSet author="prasad" id="4.1" dbms="mssql, postgresql">
        <addPrimaryKey columnNames="Id" constraintName="PK_DE_TABLE_Id" tableName="DATA_ENGINE_TABLE"/>
    </changeSet>
    <changeSet author="prasad" id="4.2" dbms="mssql, postgresql">
        <addForeignKeyConstraint baseColumnNames="ConfigId" baseTableName="DATA_ENGINE_TABLE" constraintName="FK_DE_TABLE_ConfigId" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="ID" referencedTableName="DATA_ENGINE_CONFIG"/>
    </changeSet>
    
<changeSet author="prasad" id="5" dbms="mssql, postgresql">
        <createTable tableName="DATA_ENGINE_COLUMN">
            <column name="Id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="TableId" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="Name" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="Skip" type="boolean"/>
            <column defaultValue="N" name="SeqType" type="char(1)"/>
            <column name="SeqObject" type="varchar(30)"/>
            <column name="DefaultValue" type="varchar(100)"/>
            <column name="DerivedFrom" type="varchar(100)"/>
            <column defaultValueNumeric="0" name="ChildReference" type="boolean"/>
            <column name="ParentName" type="varchar(50)"/>
            <column name="StartIndex" type="varchar(10)"/>
            <column name="EndIndex" type="varchar(10)"/>
            <column name="RuleForValue" type="varchar(2000)"/>
            <column name="QueryForValue" type="varchar(2000)"/>
            <column name="Format" type="varchar(30)"/>
            <column name="XmlTag" type="boolean"/>
        </createTable>
    </changeSet>
    <changeSet author="prasad" id="5.1" dbms="mssql, postgresql">
        <addPrimaryKey columnNames="Id" constraintName="PK_DE_COLUMN_Id" tableName="DATA_ENGINE_COLUMN"/>
    </changeSet>
     <changeSet author="prasad" id="5.2" dbms="mssql, postgresql">
        <addForeignKeyConstraint baseColumnNames="TableId" baseTableName="DATA_ENGINE_COLUMN" constraintName="FK_DE_COLUMN_TableId" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="Id" referencedTableName="DATA_ENGINE_TABLE"/>
    </changeSet>

<changeSet author="prasad" id="6" dbms="mssql, postgresql">
        <createTable tableName="DATA_ENGINE_STATUS">
            <column name="Id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="Name" type="varchar(100)">
                <constraints nullable="false"/>
            </column>
            <column name="Status" type="char(1)">
                <constraints nullable="false"/>
            </column>
            <column name="FileName" type="varchar(100)"/>
            <column name="Reference" type="varchar(100)"/>
            <column name="ValueDate" type="datetime"/>
            <column defaultValueNumeric="0" name="TotalRecords" type="int">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="ProcessedRecords" type="int">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="SuccessRecords" type="int">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="FailedRecords" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="StartTime" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="EndTime" type="datetime"/>
            <column name="UserId" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="Remarks" type="nvarchar(2000)"/>
        </createTable>
    </changeSet>
    <changeSet author="prasad" id="6.1" dbms="mssql, postgresql">
        <addPrimaryKey columnNames="Id" constraintName="PK_DES_ID" tableName="DATA_ENGINE_STATUS"/>
    </changeSet>
<changeSet author="prasad" id="7">
        <createTable tableName="DATA_ENGINE_LOG">
            <column name="Id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="KeyId" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
            <column name="Status" type="char(1)">
                <constraints nullable="false"/>
            </column>
            <column name="Reason" type="varchar(2000)"/>
        </createTable>
    </changeSet>
<changeSet author="prasad" id="7.1" dbms="mssql, postgresql">
        <addForeignKeyConstraint baseColumnNames="Id" baseTableName="DATA_ENGINE_LOG" constraintName="FK_DEL_ID" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="Id" referencedTableName="DATA_ENGINE_STATUS"/>
    </changeSet>

<changeSet author="prasad" id="8" dbms="mssql, postgresql">
        <createTable tableName="DATA_ENGINE_TABLES">
            <column name="Id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="Name" type="varchar(30)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
<changeSet author="prasad" id="8.1" dbms="mssql, postgresql">
        <addUniqueConstraint columnNames="Name" constraintName="UK_DE_T_Name" tableName="DATA_ENGINE_TABLES"/>
    </changeSet>
<changeSet author="prasad" id="9">
        <createTable tableName="DATA_ENGINE_EXECUTION_FIELDS">
            <column name="ID" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="FIELD1" type="varchar(200)"/>
            <column name="FIELD2" type="varchar(200)"/>
            <column name="FIELD3" type="varchar(200)"/>
        </createTable>
    </changeSet>
     <changeSet author="prasad" id="9.1" dbms="mssql, postgresql">
        <addForeignKeyConstraint baseColumnNames="ID" baseTableName="DATA_ENGINE_EXECUTION_FIELDS" constraintName="FK_DE_ED_ID" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="Id" referencedTableName="DATA_ENGINE_STATUS"/>
    </changeSet>

<changeSet author="prasad" id="9.2" dbms="mssql, postgresql">
        <createTable tableName="SEQ_DATA_ENGINE_CONFIG">
            <column name="SeqNo" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="prasad" id="10" dbms="mssql, postgresql">
        <createTable tableName="SEQ_DATA_ENGINE_TABLE">
            <column name="SeqNo" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
 <changeSet author="prasad" id="11" dbms="mssql, postgresql">
        <createTable tableName="SEQ_DATA_ENGINE_COLUMN">
            <column name="SeqNo" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
 <changeSet author="prasad" id="12" dbms="mssql, postgresql">
        <createTable tableName="SEQ_DATA_ENGINE_STATUS">
            <column name="SeqNo" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

<changeSet id="13" author="prasad" dbms="mssql, postgresql">
	<sql>
DELETE FROM SEQ_DATA_ENGINE_CONFIG;
DELETE FROM SEQ_DATA_ENGINE_TABLE;
DELETE FROM SEQ_DATA_ENGINE_COLUMN;
DELETE FROM SEQ_DATA_ENGINE_STATUS;
</sql>
</changeSet>
<changeSet id="14" author="prasad" dbms="mssql, postgresql">
	<sql>

INSERT INTO SEQ_DATA_ENGINE_CONFIG VALUES(0);
INSERT INTO SEQ_DATA_ENGINE_TABLE  VALUES(0);
INSERT INTO SEQ_DATA_ENGINE_COLUMN VALUES(0);
INSERT INTO SEQ_DATA_ENGINE_STATUS VALUES(0);
</sql>
</changeSet>

</databaseChangeLog>