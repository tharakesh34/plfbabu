<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	 <property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />

	<changeSet id="pre_run_for_pgp" author="Jayant" runAlways="true"
		dbms="postgresql">
		<sql>
			Set search_path = plf,public,pg_catalog;
		</sql>
	</changeSet>
	
	
	<changeSet id="1" author="saikrshna.p">
		<sql>
		delete from ErrorDetails where code='CE0001';
			 insert into ErrorDetails (Code, Language, Severity, Message, RecordStatus, WorkflowId, LastMntBy, Version) values ('CE0001', 'EN', 'E', 'BPI Treatment should be Schedule BPI on Interest Frequency as the payment day is on or before 25.', 'Approved', 0, 1000, 1);
		</sql>
	</changeSet> 
	
	<changeSet id="2" author="saikrshna.p">
		<sql>
		delete from ErrorDetails where code='CE0002';
			insert into ErrorDetails (Code, Language, Severity, Message, RecordStatus, WorkflowId, LastMntBy, Version)  values ('CE0002', 'EN', 'E', 'BPI Treatment should be Deduct BPI from Disbursement as the payment day is after 25.', 'Approved', 0, 1000, 1);
		</sql>
	</changeSet> 	
	
	  <changeSet id="3" author="Durga Prasad G">
			<sql>
				Delete From DATA_ENGINE_COLUMN Where TABLEID = (Select Id from DATA_ENGINE_TABLE Where CONFIGID = (Select id from Data_Engine_Config Where Name = 'VAS_PREMIUM_CALCULATION_UPLOAD'));
				Delete From DATA_ENGINE_TABLE Where CONFIGID = (Select Id from Data_Engine_Config Where Name  = 'VAS_PREMIUM_CALCULATION_UPLOAD');
				Delete From Data_Engine_Config Where Name  = 'VAS_PREMIUM_CALCULATION_UPLOAD';
				
				Insert Into Data_Engine_Config Values ((Select max(id)+1 from Data_Engine_Config),'VAS_PREMIUM_CALCULATION_UPLOAD','VAS Premium calculation upload.',12,'Sheet1',null,null,null,0,1,null,null,null,'C', '/opt/PFF/insurance/premiumcalculation','INSURANCE_','.xlsx',0, null,null,null,0,null,1,1);
				                                        
				Insert Into DATA_ENGINE_TABLE values ((Select max(id)+1 from DATA_ENGINE_TABLE),(Select id from Data_Engine_Config Where Name = 'VAS_PREMIUM_CALCULATION_UPLOAD'),'VASPremiumCalcDet_DataEngine',1,'CustomerAgeF',null,null,null,null,null,null,null,5,0,0);
				 
				Insert into DATA_ENGINE_COLUMN Values ((Select max(id)+1 from DATA_ENGINE_COLUMN),(Select Id from DATA_ENGINE_TABLE Where CONFIGID = (Select Id from DATA_ENGINE_Config Where Name = 'VAS_PREMIUM_CALCULATION_UPLOAD')),'BatchId',0,'N',null,null,'${FILE_ID}',null,0,null,null,null,null,'M');
				Insert into DATA_ENGINE_COLUMN Values ((Select max(id)+1 from DATA_ENGINE_COLUMN),(Select Id from DATA_ENGINE_TABLE Where CONFIGID = (Select id from Data_Engine_Config Where Name = 'VAS_PREMIUM_CALCULATION_UPLOAD')),'ManufacturerName',0,'N',null,null,null,null,0,null,null,null,null,'O');
				Insert into DATA_ENGINE_COLUMN Values ((Select max(id)+1 from DATA_ENGINE_COLUMN),(Select Id from DATA_ENGINE_TABLE Where CONFIGID = (Select Id from DATA_ENGINE_Config Where Name = 'VAS_PREMIUM_CALCULATION_UPLOAD')),'CustomerAgeF',0,'N',null,null,null,null,1,null,null,null,null,'M');
				Insert into DATA_ENGINE_COLUMN Values ((Select max(id)+1 from DATA_ENGINE_COLUMN),(Select Id from DATA_ENGINE_TABLE Where CONFIGID = (Select Id from DATA_ENGINE_Config Where Name = 'VAS_PREMIUM_CALCULATION_UPLOAD')),'Gender',0,'N',null,null,null,null,2,null,null,null,null,'O');
				Insert into DATA_ENGINE_COLUMN Values ((Select max(id)+1 from DATA_ENGINE_COLUMN),(Select Id from DATA_ENGINE_TABLE Where CONFIGID = (Select Id from DATA_ENGINE_Config Where Name = 'VAS_PREMIUM_CALCULATION_UPLOAD')),'PolicyAgeF',0,'N',null,null,null,null,3,null,null,null,null,'O');
				Insert into DATA_ENGINE_COLUMN Values ((Select max(id)+1 from DATA_ENGINE_COLUMN),(Select Id from DATA_ENGINE_TABLE Where CONFIGID = (Select Id from DATA_ENGINE_Config Where Name = 'VAS_PREMIUM_CALCULATION_UPLOAD')),'PremiumPercentageF',0,'N',null,null,null,null,4,null,null,null,null,'M');
				Insert into DATA_ENGINE_COLUMN Values ((Select max(id)+1 from DATA_ENGINE_COLUMN),(Select Id from DATA_ENGINE_TABLE Where CONFIGID = (Select Id from DATA_ENGINE_Config Where Name = 'VAS_PREMIUM_CALCULATION_UPLOAD')),'MinAmountF',0,'N',null,null,null,null,5,null,null,null,null,'O');
				Insert into DATA_ENGINE_COLUMN Values ((Select max(id)+1 from DATA_ENGINE_COLUMN),(Select Id from DATA_ENGINE_TABLE Where CONFIGID = (Select Id from DATA_ENGINE_Config Where Name = 'VAS_PREMIUM_CALCULATION_UPLOAD')),'MaxAmountF',0,'N',null,null,null,null,6,null,null,null,null,'O');
				Insert into DATA_ENGINE_COLUMN Values ((Select max(id)+1 from DATA_ENGINE_COLUMN),(Select Id from DATA_ENGINE_TABLE Where CONFIGID = (Select Id from DATA_ENGINE_Config Where Name = 'VAS_PREMIUM_CALCULATION_UPLOAD')),'LoanAgeF',0,'N',null,null,null,null,7,null,null,null,null,'M');
			</sql>
		</changeSet>
		
		<changeSet  id="4" author="Durgaprasad G" >
		  <sql>
			Update SMTParameters set sysparmvalue = 'N' Where sysparmcode = 'VAS_MEDICAL_STATUS_CALCULATION_YES_NO'; 		 
		 </sql>
	   </changeSet>
		
		<changeSet id="5" author="Durgaprasad G">
			<sql>
			<![CDATA[
			INSERT [dbo].[ExtendedFieldHeader] ([ModuleId], [ModuleName], [SubModuleName], [TabHeading], [NumberOfColumns], [Version], [LastMntBy], [LastMntOn], [RecordStatus], [RoleCode], [NextRoleCode], [TaskId], [NextTaskId], [RecordType], [WorkflowId], [POSTVALIDATION], [PREVALIDATION], [POSTVALIDATIONREQ], [PREVALIDATIONREQ], [event]) VALUES (10008, N'VAS', N'INSURANC', N'INSURANC', N'2', 2, 1000, CAST(N'2019-01-31 15:43:08.557' AS DateTime), N'Approved', N'', N'', N'', N'', N'', 0, NULL, NULL, CAST(0 AS Decimal(1, 0)), CAST(0 AS Decimal(1, 0)), NULL)
			
			
			INSERT [dbo].[ExtendedFieldDetail] ([ModuleId], [FieldName], [FieldType], [FieldLength], [FieldPrec], [FieldLabel], [FieldMandatory], [FieldConstraint], [FieldSeqOrder], [FieldList], [FieldDefaultValue], [FieldMinValue], [FieldMaxValue], [FieldUnique], [Version], [LastMntBy], [LastMntOn], [RecordStatus], [RoleCode], [NextRoleCode], [TaskId], [NextTaskId], [RecordType], [WorkflowId], [MultiLine], [PARENTTAG], [INPUTELEMENT], [EDITABLE], [ExtendedType], [allowInRule], [scriptlet], [Visible], [filters], [ValFromScript]) VALUES (10008, N'CALCULATEPREMIUM', N'BUTTON', 0, 0, N'Calculate Premium Amount', 0, N'', 40, NULL, NULL, 0, 0, 0, 1, 0, CAST(N'2019-01-31 15:33:09.653' AS DateTime), N'Approved', N'', N'', N'', N'', N'', 0, 0, N'EXTDETGRPBOX', 0, 1, 0, 0, NULL, 1, NULL, 0)
			INSERT [dbo].[ExtendedFieldDetail] ([ModuleId], [FieldName], [FieldType], [FieldLength], [FieldPrec], [FieldLabel], [FieldMandatory], [FieldConstraint], [FieldSeqOrder], [FieldList], [FieldDefaultValue], [FieldMinValue], [FieldMaxValue], [FieldUnique], [Version], [LastMntBy], [LastMntOn], [RecordStatus], [RoleCode], [NextRoleCode], [TaskId], [NextTaskId], [RecordType], [WorkflowId], [MultiLine], [PARENTTAG], [INPUTELEMENT], [EDITABLE], [ExtendedType], [allowInRule], [scriptlet], [Visible], [filters], [ValFromScript]) VALUES (10008, N'CUSTOMERAGE', N'TEXT', 50, 0, N'Customer Age', 0, N'REGEX_ALPHANUM_SPACE_SPL', 10, N'', N'', 0, 0, 0, 1, 0, CAST(N'2019-01-31 15:33:09.653' AS DateTime), N'Approved', N'', N'', N'', N'', N'', 0, 0, N'EXTDETGRPBOX', 1, 0, 0, 0, NULL, 1, NULL, 0)
			INSERT [dbo].[ExtendedFieldDetail] ([ModuleId], [FieldName], [FieldType], [FieldLength], [FieldPrec], [FieldLabel], [FieldMandatory], [FieldConstraint], [FieldSeqOrder], [FieldList], [FieldDefaultValue], [FieldMinValue], [FieldMaxValue], [FieldUnique], [Version], [LastMntBy], [LastMntOn], [RecordStatus], [RoleCode], [NextRoleCode], [TaskId], [NextTaskId], [RecordType], [WorkflowId], [MultiLine], [PARENTTAG], [INPUTELEMENT], [EDITABLE], [ExtendedType], [allowInRule], [scriptlet], [Visible], [filters], [ValFromScript]) VALUES (10008, N'EXTDETGRPBOX', N'GROUPBOX', 0, 0, N'Extended Details', 0, N'', 5, NULL, NULL, 0, 0, 0, 1, 0, CAST(N'2019-01-31 15:33:09.653' AS DateTime), N'Approved', N'', N'', N'', N'', N'', 0, 0, NULL, 0, 1, 0, 0, NULL, 1, NULL, 0)
			INSERT [dbo].[ExtendedFieldDetail] ([ModuleId], [FieldName], [FieldType], [FieldLength], [FieldPrec], [FieldLabel], [FieldMandatory], [FieldConstraint], [FieldSeqOrder], [FieldList], [FieldDefaultValue], [FieldMinValue], [FieldMaxValue], [FieldUnique], [Version], [LastMntBy], [LastMntOn], [RecordStatus], [RoleCode], [NextRoleCode], [TaskId], [NextTaskId], [RecordType], [WorkflowId], [MultiLine], [PARENTTAG], [INPUTELEMENT], [EDITABLE], [ExtendedType], [allowInRule], [scriptlet], [Visible], [filters], [ValFromScript]) VALUES (10008, N'LOANAMOUNT', N'DECIMAL', 18, 0, N'Loan Amount', 0, N'', 30, N'', N'', 0, 0, 0, 1, 0, CAST(N'2019-01-31 15:33:09.653' AS DateTime), N'Approved', N'', N'', N'', N'', N'', 0, 0, N'EXTDETGRPBOX', 1, 0, 0, 0, NULL, 1, NULL, 0)
			INSERT [dbo].[ExtendedFieldDetail] ([ModuleId], [FieldName], [FieldType], [FieldLength], [FieldPrec], [FieldLabel], [FieldMandatory], [FieldConstraint], [FieldSeqOrder], [FieldList], [FieldDefaultValue], [FieldMinValue], [FieldMaxValue], [FieldUnique], [Version], [LastMntBy], [LastMntOn], [RecordStatus], [RoleCode], [NextRoleCode], [TaskId], [NextTaskId], [RecordType], [WorkflowId], [MultiLine], [PARENTTAG], [INPUTELEMENT], [EDITABLE], [ExtendedType], [allowInRule], [scriptlet], [Visible], [filters], [ValFromScript]) VALUES (10008, N'LOANTERMS', N'TEXT', 50, 0, N'Number OF Installments', 0, N'REGEX_ALPHANUM_SPACE_SPL', 20, N'', N'', 0, 0, 0, 2, 0, CAST(N'2019-01-31 15:43:08.557' AS DateTime), N'Approved', N'', N'', N'', N'', N'', 0, 0, N'EXTDETGRPBOX', 1, 0, 0, 0, NULL, 1, NULL, 0)
			
			
			INSERT [dbo].[VasStructure] ([ProductCode], [ProductDesc], [RecAgainst], [FeeAccrued], [FeeAccounting], [AccrualAccounting], [RecurringType], [FreeLockPeriod], [PreValidationReq], [PostValidationReq], [Remarks], [Active], [Version], [LastMntBy], [LastMntOn], [RecordStatus], [RoleCode], [NextRoleCode], [TaskId], [NextTaskId], [RecordType], [WorkflowId], [ProductType], [VasFee], [AllowFeeToModify], [ManufacturerId], [PreValidation], [PostValidation], [feetype], [flpcalculatedon], [shortcode], [ModeOfPayment], [AllowFeeType], [MedicalApplicable], [BatchId]) VALUES (N'INSURANC', N'Insurance product.', N'Finance', 1, 1109, 1110, 0, 0, 1, 0, N'Insurance product.', 1, 2, 1000, CAST(N'2019-01-31 15:43:08.557' AS DateTime), N'Approved', N'', N'', N'', N'', N'', 0, N'INSURANC', CAST(0 AS Decimal(18, 0)), 1, 7000451, N'
			
			var financeMain = fd.getFinScheduleData().getFinanceMain();
			
			//Loan Amount
			defaults.add("LOANAMOUNT",financeMain.getFinAssetValue()/100);
			    
			//Loan Terms
			var loanTerms = financeMain.getNumberOfTerms();
			loanTerms = loanTerms + financeMain.getGraceTerms();
			defaults.add("LOANTERMS",loanTerms);
			
			
			//CustomerAge
			var customer = fd.getCustomerDetails().getCustomer();
			defaults.add("CUSTOMERAGE",customer.getCustomerAge());', N'', 47, N'#', N'CRD', N'D', N'A', 0, 569);
		]]>
		</sql>
	</changeSet>
</databaseChangeLog>
