<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />


	<changeSet id="20" author="Siva">
		<createTable tableName="ManualAdviseMovements">
			<column name="MovementID" type="bigint">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="AdviseID" type="bigint">
				<constraints  nullable="false" />
			</column>
			<column name="MovementDate" type="datetime">
				<constraints  nullable="false" />
			</column>
			<column name="MovementAmount" type="decimal(18,0)">
				<constraints nullable="false" />
			</column>
			<column name="PaidAmount" type="decimal(18,0)">
				<constraints nullable="false" />
			</column>
			<column name="WaivedAmount" type="decimal(18,0)">
				<constraints nullable="false" />
			</column>
			<column name="Status" type="char(1)">
 			</column>
		</createTable>
	</changeSet>

	<changeSet id="21" author="Siva">
		<addColumn tableName="ManualAdviseMovements">
			<column name="PayAgainstID" type="bigint">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>
	
	<changeSet id="44" author="Siva">
		<sql>
					
		DELETE from secRolegroups where GrpId IN(Select GrpID From SecGroups WHERE GrpCode IN('FIN_RECEIPT_MAKER','FIN_RECEIPT_APPROVER'));
		
		UPDATE SEQSECROLES SET SEQNO= (SELECT MAX(ROLEID) FROM SECROLES);
		UPDATE SEQSECROLEGROUPS SET SEQNO= (SELECT MAX(ROLEGRPID) FROM SECROLEGROUPS);
		
		INSERT INTO SECROLES SELECT (SELECT MAX(ROLEID)+1 FROM SECROLES),1, 'RECEIPT_MAKER', 'Receipt Maker','FINANCE', 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECROLES WHERE 0=0;
		INSERT INTO SECROLES SELECT (SELECT MAX(ROLEID)+1 FROM SECROLES),1, 'RECEIPT_APPROVER', 'Receipt Approver','FINANCE', 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECROLES WHERE 0=0;
		INSERT INTO SECROLES SELECT (SELECT MAX(ROLEID)+1 FROM SECROLES),1, 'DEPOSIT_MAKER', 'Deposit Maker','FINANCE', 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECROLES WHERE 0=0;
		INSERT INTO SECROLES SELECT (SELECT MAX(ROLEID)+1 FROM SECROLES),1, 'DEPOSIT_APPROVER', 'Deposit Approver','FINANCE', 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECROLES WHERE 0=0;
		
		INSERT INTO SecRoleGroups values((Select MAX(RoleGrpID)+1 From SecRoleGroups),(Select GrpId  From SecGroups Where GrpCode='FIN_RECEIPT_MAKER'), (Select  RoleID  From SecRoles Where RoleCd='RECEIPT_MAKER'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0); 
		INSERT INTO SecRoleGroups values((Select MAX(RoleGrpID)+1 From SecRoleGroups),(Select GrpId  From SecGroups Where GrpCode='FIN_RECEIPT_APPROVER'), (Select  RoleID  From SecRoles Where RoleCd='RECEIPT_APPROVER'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0); 
		INSERT INTO SecRoleGroups values((Select MAX(RoleGrpID)+1 From SecRoleGroups),(Select GrpId  From SecGroups Where GrpCode='FIN_RECEIPT_APPROVER'), (Select  RoleID  From SecRoles Where RoleCd='DEPOSIT_MAKER'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0); 
		INSERT INTO SecRoleGroups values((Select MAX(RoleGrpID)+1 From SecRoleGroups),(Select GrpId  From SecGroups Where GrpCode='FIN_RECEIPT_APPROVER'), (Select  RoleID  From SecRoles Where RoleCd='DEPOSIT_APPROVER'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0); 
		
		UPDATE SEQSECROLES SET SEQNO= (SELECT MAX(ROLEID) FROM SECROLES);
		UPDATE SEQSECROLEGROUPS SET SEQNO= (SELECT MAX(ROLEGRPID) FROM SECROLEGROUPS);
		
		</sql>
	</changeSet>
	<changeSet id="50" author="Siva">
		<sql>
					
		UPDATE SEQSECOPERATIONS SET SEQNO= (SELECT MAX(OPRID) FROM SECOPERATIONS);
		UPDATE SEQSECOPERATIONROLES SET SEQNO= (SELECT MAX(OPRROLEID) FROM SECOPERATIONROLES);
		UPDATE SEQSECUSEROPERATIONS SET SEQNO= (SELECT MAX(USROPRID) FROM SECUSEROPERATIONS);
		
		INSERT INTO SECOPERATIONS SELECT (SELECT MAX(OPRID)+1 FROM SECOPERATIONS), 'RCM', 'Receipt Maker', 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECOPERATIONS WHERE 0=0;
		INSERT INTO SECOPERATIONS SELECT (SELECT MAX(OPRID)+1 FROM SECOPERATIONS), 'RCA', 'Receipt Approver', 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECOPERATIONS WHERE 0=0;
		INSERT INTO SECOPERATIONS SELECT (SELECT MAX(OPRID)+1 FROM SECOPERATIONS), 'DPM', 'Deposit Maker', 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECOPERATIONS WHERE 0=0;
		INSERT INTO SECOPERATIONS SELECT (SELECT MAX(OPRID)+1 FROM SECOPERATIONS), 'DPA', 'Deposit Approver', 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECOPERATIONS WHERE 0=0;
		
		INSERT INTO SecOperationRoles values((Select MAX(OprRoleID)+1 From SecOperationRoles),(Select OprId  From SecOperations Where OprCode='RCM'), (Select  RoleID  From SecRoles Where RoleCd='RECEIPT_MAKER'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0); 
		INSERT INTO SecOperationRoles values((Select MAX(OprRoleID)+1 From SecOperationRoles),(Select OprId  From SecOperations Where OprCode='RCA'), (Select  RoleID  From SecRoles Where RoleCd='RECEIPT_APPROVER'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0); 
		INSERT INTO SecOperationRoles values((Select MAX(OprRoleID)+1 From SecOperationRoles),(Select OprId  From SecOperations Where OprCode='DPM'), (Select  RoleID  From SecRoles Where RoleCd='DEPOSIT_MAKER'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0); 
		INSERT INTO SecOperationRoles values((Select MAX(OprRoleID)+1 From SecOperationRoles),(Select OprId  From SecOperations Where OprCode='DPA'), (Select  RoleID  From SecRoles Where RoleCd='DEPOSIT_APPROVER'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0); 
		
		INSERT INTO SecUserOperations values((Select MAX(UsrOprID)+1 From SecUserOperations),(Select UsrId  From SecUsers Where UsrLogin='MAKER'), (Select  OprID  From SecOperations Where OprCode='RCM'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0); 
		INSERT INTO SecUserOperations values((Select MAX(UsrOprID)+1 From SecUserOperations),(Select UsrId  From SecUsers Where UsrLogin='APPROVER'), (Select  OprID  From SecOperations Where OprCode='RCA'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0); 
		INSERT INTO SecUserOperations values((Select MAX(UsrOprID)+1 From SecUserOperations),(Select UsrId  From SecUsers Where UsrLogin='APPROVER'), (Select  OprID  From SecOperations Where OprCode='DPM'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0); 
		INSERT INTO SecUserOperations values((Select MAX(UsrOprID)+1 From SecUserOperations),(Select UsrId  From SecUsers Where UsrLogin='APPROVER'), (Select  OprID  From SecOperations Where OprCode='DPA'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0); 
		
		UPDATE SEQSECOPERATIONS SET SEQNO= (SELECT MAX(OPRID) FROM SECOPERATIONS);
		UPDATE SEQSECOPERATIONROLES SET SEQNO= (SELECT MAX(OPRROLEID) FROM SECOPERATIONROLES);
		UPDATE SEQSECUSEROPERATIONS SET SEQNO= (SELECT MAX(USROPRID) FROM SECUSEROPERATIONS);
		
		</sql>
	</changeSet>
	
	 <changeSet id="55.1" author="Siva">
    	<sql>
			DELETE FROM FinRepayScheduleDetail_Temp;
			DELETE FROM FinRepayScheduleDetail;
			DELETE FROM FinRepayHeader_Temp;
			DELETE FROM FinRepayHeader;
    	</sql>
	</changeSet>
	 <changeSet id="56" author="Siva">
    	<addPrimaryKey 
            columnNames="REPAYID, RECEIPTSEQID"
            constraintName="PK_FRH_RID_RCPTSEQID"
            tableName="FinRepayHeader"/>
	</changeSet>
  	<changeSet id="57" author="Siva">
    	<addPrimaryKey 
            columnNames="REPAYID, RECEIPTSEQID"
            constraintName="PK_FRH_RID_RCPTSEQID_T"
            tableName="FinRepayHeader_Temp"/>
	</changeSet>
	
	<changeSet id="58" author="Siva">
		<addColumn tableName="FinRepayScheduleDetail">
			<column name="RepaySchID" type="int">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>
	<changeSet id="59" author="Siva">
		<addColumn tableName="FinRepayScheduleDetail_Temp">
			<column name="RepaySchID" type="int">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>

	<changeSet id="61" author="Siva">
		<dropPrimaryKey constraintName="PK_REPAYSCHEDULEDETAIL"
			tableName="FINREPAYSCHEDULEDETAIL" />
	</changeSet>
		
	<changeSet id="63" author="Siva">
		<addColumn tableName="FinRepayScheduleDetail">
			<column name="RepayID" type="bigint">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>
	<changeSet id="64" author="Siva">
		<addColumn tableName="FinRepayScheduleDetail_Temp">
			<column name="RepayID" type="bigint">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>
	
	<changeSet id="65" author="Siva">
		<addPrimaryKey columnNames="REPAYSCHID, REPAYID"
			constraintName="PK_REPAYSCHEDULEDETAIL" tableName="FINREPAYSCHEDULEDETAIL" />
	</changeSet>
	<changeSet id="66" author="Siva">
		<sql>create index ix_frpsd_finref on
			FINREPAYSCHEDULEDETAIL(FINREFERENCE asc);
		</sql>
	</changeSet>

	<changeSet id="67" author="Siva">
		<dropPrimaryKey constraintName="PK_REPAYSCHEDULEDETAIL_TEMP"
			tableName="FINREPAYSCHEDULEDETAIL_TEMP" />
	</changeSet>
	<changeSet id="68" author="Siva">
		<addPrimaryKey columnNames="REPAYSCHID, REPAYID"
			constraintName="PK_REPAYSCHEDULEDETAIL_TEMP" tableName="FINREPAYSCHEDULEDETAIL_TEMP" />
	</changeSet>
	<changeSet id="69" author="Siva">
		<sql>create index ix_frpsd_finref_T on
			FINREPAYSCHEDULEDETAIL_TEMP(FINREFERENCE asc);
		</sql>
	</changeSet>	

	<changeSet id="70" author="Siva">
		<sql>create index ix_frh_finref on
			FINREPAYHEADER(FINREFERENCE asc);
		</sql>
	</changeSet>	
	
	<changeSet id="71" author="Siva">
		<sql>create index ix_frh_finref_T on
			FINREPAYHEADER_TEMP(FINREFERENCE asc);
		</sql>
	</changeSet>

	<changeSet id="72" author="Siva">
		<dropNotNullConstraint tableName="FinRepayHeader"
			columnName="TOTALREFUND" columnDataType="decimal(18,0)" />
	</changeSet>

	<changeSet id="73" author="Siva">
		<dropNotNullConstraint tableName="FinRepayHeader_Temp"
			columnName="TOTALREFUND" columnDataType="decimal(18,0)" />
	</changeSet>
	
	<changeSet id="74" author="Siva" dbms="oracle">	
   		<sql splitStatements="false">
     		 begin
              execute immediate 'CREATE SEQUENCE SeqFinRepayHeader START WITH 1 INCREMENT BY 1 MAXVALUE 9223372036854775807 NOCYCLE';  
     		 end;  
     	 </sql>
 </changeSet>
 
 <changeSet id="75" author="Siva" dbms="postgresql">	
   		<sql splitStatements="false">
   			do $$
			 begin
   execute 'CREATE SEQUENCE SeqFinRepayHeader START  1 INCREMENT BY 1 ';  
			 end;  
			$$;
	    </sql>
 </changeSet>
 
 	<changeSet id="76" author="Siva" dbms="mssql">
		<sql splitStatements="false">
			CREATE TABLE SeqFinRepayHeader(
			SeqNo 				bigint IDENTITY(1,1) NOT NULL,
			Value 				int NOT NULL
			);	
		</sql>
	</changeSet>
	
	<changeSet id="77" author="Siva">
		<dropNotNullConstraint tableName="FinRepayHeader"
			columnName="INSREFUND" columnDataType="decimal(18,0)" />
	</changeSet>

	<changeSet id="78" author="Siva">
		<dropNotNullConstraint tableName="FinRepayHeader_Temp"
			columnName="INSREFUND" columnDataType="decimal(18,0)" />
	</changeSet>
		<changeSet id="79" author="Siva">
		<dropNotNullConstraint tableName="FinRepayHeader"
			columnName="TOTALWAIVER" columnDataType="decimal(18,0)" />
	</changeSet>

	<changeSet id="80" author="Siva">
		<dropNotNullConstraint tableName="FinRepayHeader_Temp"
			columnName="TOTALWAIVER" columnDataType="decimal(18,0)" />
	</changeSet>
	<changeSet id="124" author="Siva">
		<sql>
		
		UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
		UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS); 

		INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'ReceiptDialog_paymentRef','ReceiptDialog',0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0; 
		INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'ReceiptDialog_transactionRef','ReceiptDialog',0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0;
		
		INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='FIN_RECEIPT_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='ReceiptDialog_paymentRef'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
		INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='FIN_RECEIPT_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='ReceiptDialog_transactionRef'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
		 
		UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
		UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS); 
		
		</sql>
	</changeSet>
	
	<changeSet id="156" author="Siva">
		<createView viewName="FINODPENALTYRATES_AVIEW" replaceIfExists="true">
			SELECT     FinReference, FinEffectDate, ApplyODPenalty, ODIncGrcDays, ODChargeType, ODGraceDays, ODChargeCalOn, ODChargeAmtOrPerc, ODAllowWaiver, 
                      ODMaxWaiverPerc
FROM          FinODPenaltyRates 			
		</createView>
	</changeSet>
	
	<changeSet id="157" author="Siva">
		<createView viewName="FINODPENALTYRATES_TVIEW" replaceIfExists="true">
			  SELECT     FinReference, FinEffectDate, ApplyODPenalty, ODIncGrcDays, ODChargeType, ODGraceDays, ODChargeCalOn, 
           ODChargeAmtOrPerc, ODAllowWaiver, ODMaxWaiverPerc
FROM          FinODPenaltyRates_Temp	
		</createView>
	</changeSet>
	<changeSet id="158" author="Siva">
		<createView viewName="FINODPENALTYRATES_VIEW" replaceIfExists="true">
			   SELECT     FinReference, FinEffectDate, ApplyODPenalty, ODIncGrcDays, ODChargeType, ODGraceDays, ODChargeCalOn, ODChargeAmtOrPerc, ODAllowWaiver, 
                      ODMaxWaiverPerc
				FROM         FinODPenaltyRates_Temp 
				UNION 
				SELECT     FinReference, FinEffectDate, ApplyODPenalty, ODIncGrcDays, ODChargeType, ODGraceDays, ODChargeCalOn, ODChargeAmtOrPerc, ODAllowWaiver, 
				                      ODMaxWaiverPerc
				FROM         FinODPenaltyRates 
				WHERE    NOT EXISTS (SELECT 1 FROM FinODPenaltyRates_Temp WHERE FinReference = FinODPenaltyRates.FinReference)
		</createView>
	</changeSet>

	<changeSet id="159" author="pruthvi">
		<dropPrimaryKey constraintName="PK_FINODPENALTYRATES"
			tableName="FINODPENALTYRATES" />
	</changeSet>
	<changeSet id="160" author="pruthvi">
		<addPrimaryKey columnNames="FINREFERENCE"
			constraintName="PK_FINODPENALTYRATES" tableName="FINODPENALTYRATES" />
	</changeSet>
	<changeSet id="161" author="pruthvi">
		<dropPrimaryKey constraintName="PK_FINODPENALTYRATES_TEMP"
			tableName="FINODPENALTYRATES_TEMP" />
	</changeSet>
	<changeSet id="162" author="pruthvi">
		<addPrimaryKey columnNames="FINREFERENCE"
			constraintName="PK_FINODPENALTYRATES_TEMP" tableName="FINODPENALTYRATES_TEMP" />
	</changeSet>

	<changeSet id="163" author="Siva">
		<createTable tableName="FinODPenaltyRates_Log">
			<column name="LogKey" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="FinReference" type="VARCHAR(20)">
				<constraints nullable="false" />
			</column>
			<column name="FinEffectDate" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="ApplyODPenalty" type="boolean">
				<constraints nullable="false" />
			</column>
			<column name="ODIncGrcDays" type="boolean">
				<constraints nullable="false" />
			</column>
			<column name="ODChargeType" type="CHAR(1)" />
			<column name="ODGraceDays" type="int" />
			<column name="ODChargeCalOn" type="varchar(8)" />
			<column name="ODChargeAmtOrPerc" type="decimal(18,0)" />
			<column name="ODAllowWaiver" type="boolean" />
			<column name="ODMaxWaiverPerc" type="decimal(5,2)" />
		</createTable>
	</changeSet>
	<changeSet id="164" author="pruthvi">
		<addPrimaryKey columnNames="LogKey" constraintName="PK_FinOdPenaltyRates_Log"
			tableName="FinOdPenaltyRates_Log" />
	</changeSet>

	<changeSet id="165" author="pruthvi" dbms="mssql">
		<sql splitStatements="false">
			CREATE TABLE SeqFinODPenaltyRates(
			SeqNo
			bigint IDENTITY(1,1) NOT NULL,
			Value int NOT NULL
			);
		</sql>
	</changeSet>

	<changeSet id="166" author="pruthvi" dbms="oracle">
		<sql splitStatements="false">
			begin
			execute immediate 'CREATE SEQUENCE SeqFinODPenaltyRates START WITH 1
			INCREMENT BY 1 MAXVALUE 9223372036854775807 NOCYCLE';
			end;
		</sql>
	</changeSet>
	
	<changeSet id="169" author="Siva">
		<addColumn tableName="FinReceiptHeader">
			<column name="Status" type="char(1)" />
			<column name="Version" type="int">
				<constraints nullable="false" />
			</column>
			<column name="LastMntBy" type="bigint" />
			<column name="LastMntOn" type="datetime" />
			<column name="RecordStatus" type="varchar(50)" />
			<column name="RoleCode" type="varchar(100)" />
			<column name="NextRoleCode" type="varchar(200)" />
			<column name="TaskId" type="varchar(50)" />
			<column name="NextTaskId" type="varchar(200)" />
			<column name="RecordType" type="varchar(50)" />
			<column name="WorkflowId" type="bigint" />
		</addColumn>
	</changeSet>
	
	<changeSet id="170" author="Siva">
		<addColumn tableName="FinReceiptHeader_Temp">
			<column name="Status" type="char(1)" />
			<column name="Version" type="int">
				<constraints nullable="false" />
			</column>
			<column name="LastMntBy" type="bigint" />
			<column name="LastMntOn" type="datetime" />
			<column name="RecordStatus" type="varchar(50)" />
			<column name="RoleCode" type="varchar(100)" />
			<column name="NextRoleCode" type="varchar(200)" />
			<column name="TaskId" type="varchar(50)" />
			<column name="NextTaskId" type="varchar(200)" />
			<column name="RecordType" type="varchar(50)" />
			<column name="WorkflowId" type="bigint" />
		</addColumn>
	</changeSet>
	
	<changeSet id="171" author="Siva">
		<addForeignKeyConstraint constraintName="FK_RAD_FRH_RECEIPTID_T"
			referencedTableName="FinreceiptHeader_temp" referencedColumnNames="receiptid"
			baseTableName="ReceiptAllocationDetail_temp" baseColumnNames="receiptid" />
	</changeSet>
  	<changeSet id="172" author="Siva">
		<addForeignKeyConstraint constraintName="FK_RAD_FRH_RECEIPTID"
			referencedTableName="FinreceiptHeader" referencedColumnNames="receiptid"
			baseTableName="ReceiptAllocationDetail" baseColumnNames="receiptid" />
	</changeSet>
  
  <changeSet id="173" author="Siva">
		<addForeignKeyConstraint constraintName="FK_FRD_FRH_RECEIPTID_T"
			referencedTableName="FinreceiptHeader_temp" referencedColumnNames="receiptid"
			baseTableName="FinreceiptDetail_temp" baseColumnNames="receiptid" />
	</changeSet>
  	<changeSet id="174" author="Siva">
		<addForeignKeyConstraint constraintName="FK_FRD_FRH_RECEIPTID"
			referencedTableName="FinreceiptHeader" referencedColumnNames="receiptid"
			baseTableName="FinreceiptDetail" baseColumnNames="receiptid" />
	</changeSet>
	
	 <changeSet id="175" author="Siva">
		<renameColumn columnDataType="char(1)" newColumnName="ReceiptModeStatus"
			oldColumnName="Status" tableName="FinReceiptHeader" />
	</changeSet>
	
	 <changeSet id="176" author="Siva">
		<renameColumn columnDataType="char(1)" newColumnName="ReceiptModeStatus"
			oldColumnName="Status" tableName="FinReceiptHeader_Temp" />
	</changeSet>
	
	<changeSet id="177" author="Irfan">
		<createView viewName="FinReceiptHeader_View" replaceIfExists="true">
			SELECT     T1.ReceiptID, T1.ReceiptDate, T1.Reference, T1.ReceiptPurpose, T1.ReceiptMode, T1.AllocationType, T2.FinType, 
			T2.FinBranch, T3.CustCIF , 	T3.CustShrtName
			FROM         FinReceiptHeader_Temp T1 INNER JOIN
       FinanceMain T2 ON T1.Reference = T2.FinReference INNER JOIN
       Customers T3 ON T2.CustId = T3.CustId
UNION ALL
	SELECT     T1.ReceiptID, T1.ReceiptDate, T1.Reference, T1.ReceiptPurpose, T1.ReceiptMode, T1.AllocationType, T2.FinType, 
			T2.FinBranch, T3.CustCIF , 	T3.CustShrtName
		FROM         FinReceiptHeader T1 INNER JOIN
       FinanceMain T2 ON T1.Reference = T2.FinReference INNER JOIN
       Customers T3 ON T2.CustId = T3.CustId
		WHERE     NOT EXISTS
                          (SELECT     1
                            FROM          FinReceiptHeader_TEMP 
                            WHERE      ReceiptID = T1.ReceiptID)
		</createView>
	</changeSet>
	<changeSet id="178" author="Irfan">
		<sql>
			UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
			UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS); 
			INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS),0, 'menuItem_FinanceManagement_ReceiptRealization','MENU',0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0; 
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CL_LOAN_ENQUIRY') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='menuItem_FinanceManagement_ReceiptRealization'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);	
			UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
			UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS); 
		</sql>
	</changeSet>
	<changeSet id="179" author="Irfan">
		<createView viewName="FinReceiptHeader_View" replaceIfExists="true">
			SELECT     T1.ReceiptID, T1.ReceiptDate, T1.Reference, T1.ReceiptPurpose, T1.ReceiptMode, T1.AllocationType, T2.FinType, 
			T2.FinBranch, T3.CustCIF , 	T3.CustShrtName, T1.RecordStatus, T1.RecordType
			FROM         FinReceiptHeader_Temp T1 INNER JOIN
       FinanceMain T2 ON T1.Reference = T2.FinReference INNER JOIN
       Customers T3 ON T2.CustId = T3.CustId
UNION ALL
	SELECT     T1.ReceiptID, T1.ReceiptDate, T1.Reference, T1.ReceiptPurpose, T1.ReceiptMode, T1.AllocationType, T2.FinType, 
			T2.FinBranch, T3.CustCIF , 	T3.CustShrtName, T1.RecordStatus, T1.RecordType
		FROM         FinReceiptHeader T1 INNER JOIN
       FinanceMain T2 ON T1.Reference = T2.FinReference INNER JOIN
       Customers T3 ON T2.CustId = T3.CustId
		WHERE     NOT EXISTS
                          (SELECT     1
                            FROM          FinReceiptHeader_TEMP 
                            WHERE      ReceiptID = T1.ReceiptID)
		</createView>
	</changeSet>
	<changeSet id="180" author="Irfan">
		<createView viewName="FinReceiptHeader_View" replaceIfExists="true">
			SELECT     T1.ReceiptID, T1.ReceiptDate, T1.Reference, T1.ReceiptPurpose, T1.ReceiptMode, T1.AllocationType, T2.FinType, 
			T2.FinBranch, T3.CustCIF , 	T3.CustShrtName, T1.RecordStatus, T1.RecordType, T1.NextRoleCode
			FROM         FinReceiptHeader_Temp T1 INNER JOIN
       FinanceMain T2 ON T1.Reference = T2.FinReference INNER JOIN
       Customers T3 ON T2.CustId = T3.CustId
UNION ALL
	SELECT     T1.ReceiptID, T1.ReceiptDate, T1.Reference, T1.ReceiptPurpose, T1.ReceiptMode, T1.AllocationType, T2.FinType, 
			T2.FinBranch, T3.CustCIF , 	T3.CustShrtName, T1.RecordStatus, T1.RecordType, T1.NextRoleCode
		FROM         FinReceiptHeader T1 INNER JOIN
       FinanceMain T2 ON T1.Reference = T2.FinReference INNER JOIN
       Customers T3 ON T2.CustId = T3.CustId
		WHERE     NOT EXISTS
                          (SELECT     1
                            FROM          FinReceiptHeader_TEMP 
                            WHERE      ReceiptID = T1.ReceiptID)
		</createView>
	</changeSet>
	
</databaseChangeLog>