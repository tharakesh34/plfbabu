<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	 <property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />

	<changeSet id="pre_run_for_pgp" author="Jayant" runAlways="true"
		dbms="postgresql">
		<sql>
			Set search_path = plf,public,pg_catalog;
		</sql>
	</changeSet>
	
	<changeSet id="1" author="Vasu">
		<sql>
			update workflowdetails set WorkFlowActive='0' where WorkFlowType='CORPORATECREDITREVIEW';
		</sql>
		<insert tableName="WorkFlowDetails">
			<column name="WorkFlowId" valueComputed="(select max(Seqno) + 1 from SeqWorkFlowDetails)"/>
			<column name="WorkFlowType">CORPORATECREDITREVIEW</column>
			<column name="WorkFlowSubType">Corporate Credit Review</column>
			<column name="WorkFlowDesc">Corporate Credit Review</column>
			<column name="JsonDesign" type="nclob"><![CDATA[NULL]]></column>
			<column name="SvgDesign" type="nclob"><![CDATA[NULL]]></column>
            <column name="WorkFlowXml" type="clob"><![CDATA[NULL]]></column>
			<column name="WorkFlowRoles">CCR</column>
			<column name="FirstTaskOwner">CCR</column>
			<column name="WorkFlowActive">1</column>
			<column name="Version">5</column>
			<column name="LastMntBy">1000</column>		
			<column name="LastMntOn" valueDate="current_timestamp"/>
			<column name="RecordStatus">Null</column>
			<column name="RoleCode"></column>
			<column name="NextRoleCode"></column>
			<column name="TaskId"></column>
			<column name="NextTaskId"></column>	
     		<column name="RecordType">NULL</column>		
		</insert>	
	</changeSet>
	<changeSet id="2" author="Vasu">
		<update tableName="WORKFLOWDETAILS">
			<column name="JSONDESIGN" type="NCLOB"><![CDATA[{"resourceId":822,"properties":{"process_id":"CORPORATECREDITREVIEW","name":"Corporate Credit Review","documentation":"Corporate Credit Review","category":"","listenerclass":"","listenerentitytype":""},"stencil":{"id":"BPMNDiagram"},"childShapes":[{"resourceId":"startEvent1","properties":{"overrideid":"","name":"Start"},"stencil":{"id":"StartNoneEvent"},"childShapes":[],"outgoing":[{"resourceId":"sid-515123C5-CB7D-46E1-A063-D799D2FD178B"}],"bounds":{"lowerRight":{"x":130,"y":193},"upperLeft":{"x":100,"y":163}},"dockers":[]},{"resourceId":"sid-40177BF3-5C8D-4E13-8E55-93126967F234","properties":{"overrideid":"","name":"CCR","usertaskassignment":{"assignment":{"type":"idm","idm":{"type":"user","assignee":{"email":"CCR","firstName":"CCR","fullName":"CCR","id":"CCR","roledesc":"CCR Details","$$hashKey":"object:1622"}}}},"additionalforms":"","formkeydefinition":"","prioritydefinition":"Role Queue","baseactor":"","duedatedefinition":"","multiinstance_type":"None","isforcompensation":"false"},"stencil":{"id":"UserTask"},"childShapes":[],"outgoing":[{"resourceId":"sid-CD1A6740-DA0B-498D-B7B6-2274046A6D08"},{"resourceId":"sid-A945B357-BD12-4D7C-A570-901EB63BA094"}],"bounds":{"lowerRight":{"x":275,"y":218},"upperLeft":{"x":175,"y":138}},"dockers":[]},{"resourceId":"sid-515123C5-CB7D-46E1-A063-D799D2FD178B","properties":{"overrideid":"","name":"","repruseaction":"false","conditionsequenceflow":"","defaultflow":"false","action":"","state":"","mandatenotes":"false"},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-40177BF3-5C8D-4E13-8E55-93126967F234"}],"bounds":{"lowerRight":{"x":174.15625,"y":178},"upperLeft":{"x":130.609375,"y":178}},"dockers":[{"x":15,"y":15},{"x":50,"y":40}],"target":{"resourceId":"sid-40177BF3-5C8D-4E13-8E55-93126967F234"}},{"resourceId":"sid-5532A92C-4873-4D7C-B143-DB3C3A163CF9","properties":{"overrideid":"","name":"Complete Process","servicetaskexpression":"doApprove","isforcompensation":"false","multiinstance_type":"None"},"stencil":{"id":"approveTask"},"childShapes":[],"outgoing":[{"resourceId":"sid-CD2E2866-C3A5-40C4-A152-9280082949F8"}],"bounds":{"lowerRight":{"x":670,"y":218},"upperLeft":{"x":570,"y":138}},"dockers":[]},{"resourceId":"sid-F4AF09CD-2EB1-424D-A5FA-EF81E7B014E8","properties":{"overrideid":"","name":"End"},"stencil":{"id":"EndNoneEvent"},"childShapes":[],"outgoing":[],"bounds":{"lowerRight":{"x":898,"y":192},"upperLeft":{"x":870,"y":164}},"dockers":[]},{"resourceId":"sid-A4322A8F-BC65-426D-9928-816E149E5F68","properties":{"overrideid":"","name":"","sequencefloworder":""},"stencil":{"id":"ExclusiveGateway"},"childShapes":[],"outgoing":[{"resourceId":"sid-99EFE39E-CB76-42B5-A51A-B75F9B2DE167"},{"resourceId":"sid-27DA2ED6-52C9-4B2A-A23F-2ADD1B8D6A9A"}],"bounds":{"lowerRight":{"x":385,"y":198},"upperLeft":{"x":345,"y":158}},"dockers":[]},{"resourceId":"sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B","properties":{"overrideid":"","name":"Reject","servicetaskexpression":"doReject","isforcompensation":"false","multiinstance_type":"None"},"stencil":{"id":"rejectTask"},"childShapes":[],"outgoing":[{"resourceId":"sid-4B7910F8-E94A-43D4-8484-CEFF0485DF0E"}],"bounds":{"lowerRight":{"x":415,"y":349},"upperLeft":{"x":315,"y":269}},"dockers":[]},{"resourceId":"sid-E62880BF-36DA-43D7-98E7-8D49E33BB9C3","properties":{"overrideid":"","name":"End"},"stencil":{"id":"EndNoneEvent"},"childShapes":[],"outgoing":[],"bounds":{"lowerRight":{"x":544.6666717529297,"y":323},"upperLeft":{"x":516.6666717529297,"y":295}},"dockers":[]},{"resourceId":"sid-4B7910F8-E94A-43D4-8484-CEFF0485DF0E","properties":{"overrideid":"","name":"","repruseaction":"false","conditionsequenceflow":"","defaultflow":"false","action":"","state":"","mandatenotes":"false"},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-E62880BF-36DA-43D7-98E7-8D49E33BB9C3"}],"bounds":{"lowerRight":{"x":516.0768275856972,"y":309},"upperLeft":{"x":415.182293176651,"y":309}},"dockers":[{"x":50,"y":40},{"x":14,"y":14}],"target":{"resourceId":"sid-E62880BF-36DA-43D7-98E7-8D49E33BB9C3"}},{"resourceId":"sid-CD2E2866-C3A5-40C4-A152-9280082949F8","properties":{"overrideid":"","name":"","repruseaction":"false","conditionsequenceflow":"","defaultflow":"false","action":"","state":"","mandatenotes":"false"},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-F4AF09CD-2EB1-424D-A5FA-EF81E7B014E8"}],"bounds":{"lowerRight":{"x":869.59375,"y":178},"upperLeft":{"x":670.5,"y":178}},"dockers":[{"x":50,"y":40},{"x":14,"y":14}],"target":{"resourceId":"sid-F4AF09CD-2EB1-424D-A5FA-EF81E7B014E8"}},{"resourceId":"sid-CD1A6740-DA0B-498D-B7B6-2274046A6D08","properties":{"overrideid":"","name":"","repruseaction":false,"conditionsequenceflow":{"expression":{"type":"static","staticValue":""}},"defaultflow":"false","action":"","state":"","mandatenotes":"false","showdiamondmarker":false},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-A4322A8F-BC65-426D-9928-816E149E5F68"}],"bounds":{"lowerRight":{"x":344.8593912124634,"y":178},"upperLeft":{"x":275.7656316757202,"y":178}},"dockers":[{"x":50,"y":40},{"x":31.66668701171875,"y":20}],"target":{"resourceId":"sid-A4322A8F-BC65-426D-9928-816E149E5F68"}},{"resourceId":"sid-99EFE39E-CB76-42B5-A51A-B75F9B2DE167","properties":{"overrideid":"","name":"Approve","repruseaction":true,"conditionsequenceflow":{"expression":{"type":"static","staticValue":"vo.recordStatus == 'Approved'"}},"defaultflow":"false","action":"Approve","state":"Approved","mandatenotes":"false"},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-5532A92C-4873-4D7C-B143-DB3C3A163CF9"}],"bounds":{"lowerRight":{"x":569.2929706798927,"y":178.4609259922493},"upperLeft":{"x":385.3886699451072,"y":178.0996208827507}},"dockers":[{"x":20.5,"y":20.5},{"x":50,"y":40}],"target":{"resourceId":"sid-5532A92C-4873-4D7C-B143-DB3C3A163CF9"}},{"resourceId":"sid-27DA2ED6-52C9-4B2A-A23F-2ADD1B8D6A9A","properties":{"overrideid":"","name":"","repruseaction":false,"conditionsequenceflow":{"expression":{"type":"static","staticValue":"vo.recordStatus == 'Rejected'"}},"defaultflow":"false","action":"","state":"","mandatenotes":true},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B"}],"bounds":{"lowerRight":{"x":365.4219498604973,"y":268.2382885897997},"upperLeft":{"x":365.1561751395027,"y":198.8710864102003}},"dockers":[{"x":20.5,"y":20.5},{"x":50,"y":40}],"target":{"resourceId":"sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B"}},{"resourceId":"sid-A945B357-BD12-4D7C-A570-901EB63BA094","properties":{"overrideid":"","name":"Cancel","repruseaction":true,"conditionsequenceflow":{"expression":{"type":"static","staticValue":"vo.recordStatus == 'Cancelled'"}},"defaultflow":"false","action":"Cancel","state":"Cancelled","mandatenotes":true},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B"}],"bounds":{"lowerRight":{"x":314.78125,"y":309},"upperLeft":{"x":225,"y":218.9140625}},"dockers":[{"x":50,"y":40},{"x":225,"y":309},{"x":50,"y":40}],"target":{"resourceId":"sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B"}}],"bounds":{"lowerRight":{"x":1200,"y":1050},"upperLeft":{"x":0,"y":0}},"stencilset":{"url":"stencilsets/bpmn2.0/bpmn2.0.json","namespace":"http://b3mn.org/stencilset/bpmn2.0#"},"ssextensions":[]}]]></column>
			<column name="WORKFLOWXML" type="CLOB"><![CDATA[<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://activiti.org/test"><process id="CORPORATECREDITREVIEW" name="Corporate Credit Review" isExecutable="true"><documentation>Corporate Credit Review</documentation><startEvent id="startEvent1" name="Start"/><userTask id="sid-40177BF3-5C8D-4E13-8E55-93126967F234" name="CCR" activiti:actor="CCR" activiti:assignmentLevel="Role Queue"/><sequenceFlow id="sid-515123C5-CB7D-46E1-A063-D799D2FD178B" sourceRef="startEvent1" targetRef="sid-40177BF3-5C8D-4E13-8E55-93126967F234" representsUserAction="false" mandateNotes="false"/><serviceTask id="sid-5532A92C-4873-4D7C-B143-DB3C3A163CF9" name="Complete Process" activiti:operation="doApprove"/><endEvent id="sid-F4AF09CD-2EB1-424D-A5FA-EF81E7B014E8" name="End"/><exclusiveGateway id="sid-A4322A8F-BC65-426D-9928-816E149E5F68"/><serviceTask id="sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B" name="Reject" activiti:operation="doReject"/><endEvent id="sid-E62880BF-36DA-43D7-98E7-8D49E33BB9C3" name="End"/><sequenceFlow id="sid-4B7910F8-E94A-43D4-8484-CEFF0485DF0E" sourceRef="sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B" targetRef="sid-E62880BF-36DA-43D7-98E7-8D49E33BB9C3" representsUserAction="false" mandateNotes="false"/><sequenceFlow id="sid-CD2E2866-C3A5-40C4-A152-9280082949F8" sourceRef="sid-5532A92C-4873-4D7C-B143-DB3C3A163CF9" targetRef="sid-F4AF09CD-2EB1-424D-A5FA-EF81E7B014E8" representsUserAction="false" mandateNotes="false"/><sequenceFlow id="sid-CD1A6740-DA0B-498D-B7B6-2274046A6D08" sourceRef="sid-40177BF3-5C8D-4E13-8E55-93126967F234" targetRef="sid-A4322A8F-BC65-426D-9928-816E149E5F68" representsUserAction="false" mandateNotes="false"/><sequenceFlow id="sid-99EFE39E-CB76-42B5-A51A-B75F9B2DE167" name="Approve" sourceRef="sid-A4322A8F-BC65-426D-9928-816E149E5F68" targetRef="sid-5532A92C-4873-4D7C-B143-DB3C3A163CF9" action="Approve" state="Approved" representsUserAction="true" mandateNotes="false"><conditionExpression xsi:type="tFormalExpression">vo.recordStatus == 'Approved'</conditionExpression></sequenceFlow><sequenceFlow id="sid-27DA2ED6-52C9-4B2A-A23F-2ADD1B8D6A9A" sourceRef="sid-A4322A8F-BC65-426D-9928-816E149E5F68" targetRef="sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B" representsUserAction="false" mandateNotes="true"><conditionExpression xsi:type="tFormalExpression">vo.recordStatus == 'Rejected'</conditionExpression></sequenceFlow><sequenceFlow id="sid-A945B357-BD12-4D7C-A570-901EB63BA094" name="Cancel" sourceRef="sid-40177BF3-5C8D-4E13-8E55-93126967F234" targetRef="sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B" action="Cancel" state="Cancelled" representsUserAction="true" mandateNotes="true"><conditionExpression xsi:type="tFormalExpression">vo.recordStatus == 'Cancelled'</conditionExpression></sequenceFlow></process><bpmndi:BPMNDiagram id="BPMNDiagram_CORPORATECREDITREVIEW"><bpmndi:BPMNPlane bpmnElement="CORPORATECREDITREVIEW" id="BPMNPlane_CORPORATECREDITREVIEW"><bpmndi:BPMNShape bpmnElement="startEvent1" id="BPMNShape_startEvent1"><omgdc:Bounds height="30.0" width="30.0" x="100.0" y="163.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-40177BF3-5C8D-4E13-8E55-93126967F234" id="BPMNShape_sid-40177BF3-5C8D-4E13-8E55-93126967F234"><omgdc:Bounds height="80.0" width="100.0" x="175.0" y="138.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-5532A92C-4873-4D7C-B143-DB3C3A163CF9" id="BPMNShape_sid-5532A92C-4873-4D7C-B143-DB3C3A163CF9"><omgdc:Bounds height="80.0" width="100.0" x="570.0" y="138.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-F4AF09CD-2EB1-424D-A5FA-EF81E7B014E8" id="BPMNShape_sid-F4AF09CD-2EB1-424D-A5FA-EF81E7B014E8"><omgdc:Bounds height="28.0" width="28.0" x="870.0" y="164.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-A4322A8F-BC65-426D-9928-816E149E5F68" id="BPMNShape_sid-A4322A8F-BC65-426D-9928-816E149E5F68"><omgdc:Bounds height="40.0" width="40.0" x="345.0" y="158.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B" id="BPMNShape_sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B"><omgdc:Bounds height="80.0" width="100.0" x="315.0" y="269.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-E62880BF-36DA-43D7-98E7-8D49E33BB9C3" id="BPMNShape_sid-E62880BF-36DA-43D7-98E7-8D49E33BB9C3"><omgdc:Bounds height="28.0" width="28.0" x="516.6666717529297" y="295.0"/></bpmndi:BPMNShape><bpmndi:BPMNEdge bpmnElement="sid-4B7910F8-E94A-43D4-8484-CEFF0485DF0E" id="BPMNEdge_sid-4B7910F8-E94A-43D4-8484-CEFF0485DF0E"><omgdi:waypoint x="415.0" y="309.0"/><omgdi:waypoint x="516.6666717529297" y="309.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-CD2E2866-C3A5-40C4-A152-9280082949F8" id="BPMNEdge_sid-CD2E2866-C3A5-40C4-A152-9280082949F8"><omgdi:waypoint x="670.0" y="178.0"/><omgdi:waypoint x="870.0" y="178.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-CD1A6740-DA0B-498D-B7B6-2274046A6D08" id="BPMNEdge_sid-CD1A6740-DA0B-498D-B7B6-2274046A6D08"><omgdi:waypoint x="275.0" y="178.0"/><omgdi:waypoint x="345.0" y="178.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-515123C5-CB7D-46E1-A063-D799D2FD178B" id="BPMNEdge_sid-515123C5-CB7D-46E1-A063-D799D2FD178B"><omgdi:waypoint x="130.0" y="178.0"/><omgdi:waypoint x="175.0" y="178.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-27DA2ED6-52C9-4B2A-A23F-2ADD1B8D6A9A" id="BPMNEdge_sid-27DA2ED6-52C9-4B2A-A23F-2ADD1B8D6A9A"><omgdi:waypoint x="365.42692307692306" y="197.57307692307694"/><omgdi:waypoint x="365.15325670498083" y="269.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-99EFE39E-CB76-42B5-A51A-B75F9B2DE167" id="BPMNEdge_sid-99EFE39E-CB76-42B5-A51A-B75F9B2DE167"><omgdi:waypoint x="384.53740157480314" y="178.46259842519686"/><omgdi:waypoint x="570.0" y="178.098231827112"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-A945B357-BD12-4D7C-A570-901EB63BA094" id="BPMNEdge_sid-A945B357-BD12-4D7C-A570-901EB63BA094"><omgdi:waypoint x="225.0" y="218.0"/><omgdi:waypoint x="225.0" y="309.0"/><omgdi:waypoint x="315.0" y="309.0"/></bpmndi:BPMNEdge></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></definitions>]]></column>
			<where>workflowtype='CORPORATECREDITREVIEW'and workflowactive=1
			</where>
		</update>
	</changeSet>
	<changeSet id="3" author="Vasu">
		<sql>
			UPDATE SeqWorkFlowDetails SET SEQNO= (SELECT MAX(WorkflowId)+1 FROM workflowdetails);
		</sql>
	</changeSet> 	
			
</databaseChangeLog>
