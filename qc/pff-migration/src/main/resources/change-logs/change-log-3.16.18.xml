<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />
	

	<changeSet id="1" author="Jayant">
		<createTable tableName="DM_LOAN_DETAILS_MONTHLY">
			<column name="APPLID" type="DECIMAL(8)"/>
			<column name="AGREEMENTNO" type="VARCHAR(20)"/>
			<column name="DISBURSEMENTDATE" type="DATETIME"/>
			<column name="CUSTOMER_YIELD" type="DECIMAL(18,4)"/>
			<column name="TEST_FLAG" type="CHAR(1)"/>
			<column name="STATUS" type="VARCHAR(20)"/>
			<column name="NAP_STAGE" type="VARCHAR(50)"/>
			<column name="EMI_PRESENTMENT_FLAG" type="CHAR(1)"/>
			<column name="FIRST_PRESENT_BOUNCE" type="CHAR(1)"/>
			<column name="SECOND_PRESENT_BOUNCE" type="CHAR(1)"/>
			<column name="AMT_COLL_2ND_PRESENT" type="DECIMAL(18,4)"/>
			<column name="DT_2ND_PRESENT" type="DATETIME"/>
			<column name="DUEDAY" type="DECIMAL(2)"/>
			<column name="LMS_BUCKET" type="DECIMAL(3)"/>
			<column name="COLL_BUCKET" type="DECIMAL(3)"/>
			<column name="FEMIRET" type="CHAR(1)"/>
			<column name="RETINTHREE" type="DECIMAL"/>
			<column name="FIRST_BOUNCE_DATE" type="DATETIME"/>
			<column name="LAST_EMI_COLL_AMT" type="DECIMAL(18,4)"/>
			<column name="LAST_EMI_COLL_DT" type="DATETIME"/>
			<column name="NOTDEPO_FLG" type="CHAR(1)"/>
			<column name="BULK_REFUND" type="DECIMAL(18,4)"/>
			<column name="REPOSSESIONDATE" type="DATETIME"/>
			<column name="SOLDDATE" type="DATETIME"/>
			<column name="SOLDAMT" type="DECIMAL(18,4)"/>
			<column name="INSURANCE_APPLIED_FLG" type="CHAR(1)"/>
			<column name="CLOSUREDATE" type="DATETIME"/>
			<column name="BUSINESSDATE" type="DATETIME"/>
			<column name="PROCESSED_FLAG" type="CHAR(1)"/>
			<column name="PROCESS_DATE" type="DATETIME"/>
			<column name="TOTAL_CHQ_BOUNCE" type="DECIMAL(18,4)"/>
			<column name="COLLECT_AMT_RECD" type="DECIMAL(18,4)"/>
			<column name="TOTAL_PENAL_AMOUNT" type="DECIMAL(18,4)"/>
			<column name="WRITEOFFDATE" type="DATETIME"/>
			<column name="WRITEOFF_AMT" type="DECIMAL(18,2)"/>
			<column name="INT_RECD_YTD" type="DECIMAL(18,2)"/>
			<column name="PARENT_AGREEMENTNO" type="CHAR(20)"/>
			<column name="EXISTING_LANNO" type="VARCHAR(20)"/>
			<column name="COLLECTIONPOS" type="DECIMAL(16,2)"/>
			<column name="COLLECT_EMI_OS" type="DECIMAL(16,2)"/>
			<column name="SETTLEMENT_FLAG" type="VARCHAR(1)"/>
			<column name="RECDATE" type="DATETIME"/>
			<column name="DPDDAYS" type="DECIMAL(8)"/>
		</createTable>
	</changeSet>
	
	<changeSet id="2" author="Jayant">
		<createTable tableName="DM_LOAN_BALANCES_MONTHLY">
			<column name="APPLID" type="DECIMAL(8)"/>
			<column name="AGREEMENTNO" type="VARCHAR(20)"/>
			<column name="COLL_BOM_BUCKET" type="DECIMAL(3)"/>
			<column name="DPD" type="DECIMAL(8)"/>
			<column name="DPD_STRING" type="VARCHAR(200)"/>
			<column name="EMI_OS" type="DECIMAL(16,2)"/>
			<column name="TOTAL_RECBL" type="DECIMAL(16,2)"/>
			<column name="TOTAL_RECD" type="DECIMAL(16,2)"/>
			<column name="NO_OF_EMI_DUE" type="DECIMAL(3)"/>
			<column name="NO_OF_EMI_RECD" type="DECIMAL(3)"/>
			<column name="NO_OF_EMI_OS" type="DECIMAL(3)"/>
			<column name="TOTAL_CHQ_BOUNCE" type="NUMBER"/>
			<column name="EMI_DUE" type="DECIMAL(16,2)"/>
			<column name="PRINCIPAL_DUE" type="DECIMAL(16,2)"/>
			<column name="INTEREST_DUE" type="DECIMAL(16,2)"/>
			<column name="EMI_RECEIVED" type="DECIMAL(16,2)"/>
			<column name="PRINCIPAL_RECEIVED" type="DECIMAL(16,2)"/>
			<column name="INTEREST_RECEIVED" type="DECIMAL(16,2)"/>
			<column name="PRINCIPAL_OS" type="DECIMAL(16,2)"/>
			<column name="INTEREST_OS" type="DECIMAL(16,2)"/>
			<column name="PRINCIPAL_WAIVED" type="DECIMAL(16,2)"/>
			<column name="EMI_PRINCIPAL_WAIVED" type="DECIMAL(16,2)"/>
			<column name="EMI_INTEREST_WAIVED" type="DECIMAL(16,2)"/>
			<column name="PRINCIPAL_AT_TERM" type="DECIMAL(16,2)"/>
			<column name="ADVANCE_EMI_BILLED" type="DECIMAL(16,2)"/>
			<column name="MIGRATED_ADVANCE_EMI" type="DECIMAL(16,2)"/>
			<column name="MIGRATED_ADVANCE_EMI_BILLED" type="DECIMAL(16,2)"/>
			<column name="MIGRATED_ADVANCE_EMI_UNBILLED" type="DECIMAL(16,2)"/>
			<column name="CLOSED_CAN_ADV_EMI" type="DECIMAL(16,2)"/>
			<column name="PRINCIPAL_BALANCE" type="DECIMAL(16,2)"/>
			<column name="INTEREST_BALANCE" type="DECIMAL(16,2)"/>
			<column name="SOH_BALANCE" type="DECIMAL(16,2)"/>
			<column name="NO_OF_UNBILLED_EMI" type="DECIMAL(16,2)"/>
			<column name="TOTAL_INTEREST" type="DECIMAL(16,2)"/>
			<column name="ACCRUED_AMOUNT" type="DECIMAL(16,2)"/>
			<column name="BALANCE_UMFC" type="DECIMAL(16,2)"/>
			<column name="EMI_IN_ADVANCE_RECEIVED_MAKER" type="DECIMAL(16,2)"/>
			<column name="EMI_IN_ADVANCE_BILLED" type="DECIMAL(16,2)"/>
			<column name="EMI_IN_ADVANCE_UNBILLED" type="DECIMAL(16,2)"/>
			<column name="MIG_ADV_EMI_BILLED_PRINCOMP" type="DECIMAL(16,2)"/>
			<column name="MIG_ADV_EMI_BILLED_INTCOMP" type="DECIMAL(16,2)"/>
			<column name="MIG_ADV_EMI_UNBILLED_PRINCOMP" type="DECIMAL(16,2)"/>
			<column name="MIG_ADV_EMI_UNBILL_INTCOMP" type="DECIMAL(16,2)"/>
			<column name="EMI_IN_ADV_BILLED_PRINCOMP" type="DECIMAL(16,2)"/>
			<column name="EMI_IN_ADV_BILLED_INTCOMP" type="DECIMAL(16,2)"/>
			<column name="EMI_IN_ADV_UNBILLED_PRINCOMP" type="DECIMAL(16,2)"/>
			<column name="EMI_IN_ADV_UNBILL_INTCOMP" type="DECIMAL(16,2)"/>
			<column name="CLOS_CAN_ADV_EMI_PRINCOMP" type="DECIMAL(16,2)"/>
			<column name="CLOS_CAN_ADV_EMI_INTCOMP" type="DECIMAL(16,2)"/>
			<column name="SECURITY_DEPOSIT" type="DECIMAL(16,2)"/>
			<column name="SECURITY_DEPOSIT_ADJUSTED" type="DECIMAL(16,2)"/>
			<column name="ROUNDING_DIFF_RECEIVABLE" type="DECIMAL(16,2)"/>
			<column name="ROUNDING_DIFF_RECEIVED" type="DECIMAL(16,2)"/>
			<column name="MIG_DIFFERENCE_RECEIVABLE" type="DECIMAL(16,2)"/>
			<column name="MIG_DIFFERENCE_RECEIVED" type="DECIMAL(16,2)"/>
			<column name="MIG_DIFFERENCE_PAYABLE" type="DECIMAL(16,2)"/>
			<column name="MIG_DIFFERENCE_PAID" type="DECIMAL(16,2)"/>
			<column name="WRITEOFF_DUE" type="DECIMAL(16,2)"/>
			<column name="WRITEOFF_RECEIVED" type="DECIMAL(16,2)"/>
			<column name="SOLD_SEIZE_RECEIVABLE" type="DECIMAL(16,2)"/>
			<column name="SOLD_SEIZE_RECEIVED" type="DECIMAL(16,2)"/>
			<column name="SOLD_SEIZE_PAYABLE" type="DECIMAL(16,2)"/>
			<column name="SOLD_SEIZE_PAID" type="DECIMAL(16,2)"/>
			<column name="NET_EXCESS_RECEIVED" type="DECIMAL(16,2)"/>
			<column name="NET_EXCESS_ADJUSTED" type="DECIMAL(16,2)"/>
			<column name="LPP_CHARGES_RECEIVABLE" type="DECIMAL(16,2)"/>
			<column name="LPP_CHARGES_RECEIVED" type="DECIMAL(16,2)"/>
			<column name="PDC_SWAP_CHARGES_RECEIVABLE" type="DECIMAL(16,2)"/>
			<column name="PDC_SWAP_CHARGES_RECEIVED" type="DECIMAL(16,2)"/>
			<column name="REPO_CHARGES_RECEIVABLE" type="DECIMAL(16,2)"/>
			<column name="REPO_CHARGES_RECEIVED" type="DECIMAL(16,2)"/>
			<column name="FORECLOSURE_CHARGES_DUE" type="DECIMAL(16,2)"/>
			<column name="FORECLOSURE_CHARGES_RECEIVED" type="DECIMAL(16,2)"/>
			<column name="COLLECT_AMT_RECD" type="DECIMAL(16,2)"/>
			<column name="TOTAL_PENAL_AMOUNT" type="DECIMAL(16,2)"/>
			<column name="BOUNCE_CHARGES_DUE" type="DECIMAL(16,2)"/>
			<column name="BOUNCE_CHARGES_RECEIVED" type="DECIMAL(16,2)"/>
			<column name="INSUR_RENEW_CHARGE" type="DECIMAL(16,2)"/>
			<column name="INSUR_RENEW_CHARGE_RECD" type="DECIMAL(16,2)"/>
			<column name="INSUR_RECEIVABLE" type="DECIMAL(16,2)"/>
			<column name="INSUR_RECEIVED" type="DECIMAL(16,2)"/>
			<column name="INSUR_PAYABLE" type="DECIMAL(16,2)"/>
			<column name="INSUR_PAID" type="DECIMAL(16,2)"/>
			<column name="EMI_OS_GL_AMT" type="DECIMAL(16,2)"/>
			<column name="BOUNCE_RECEIPT_DAYS" type="DECIMAL(16,2)"/>
			<column name="BUSINESSDATE" type="DATETIME"/>
			<column name="PROCESSED_FLAG" type="CHAR(1)"/>
			<column name="PROCESS_DATE" type="DATETIME"/>
			<column name="AMTFIN" type="DECIMAL(16,2)"/>
			<column name="DISBURSEDAMT" type="DECIMAL(19,5)"/>
			<column name="DISB_STATUS" type="VARCHAR(2)"/>
			<column name="FIRST_DUE_DATE" type="DATETIME"/>
			<column name="GROSS_TENURE" type="DECIMAL(3)"/>
			<column name="MATURITYDATE" type="DATETIME"/>
			<column name="ADV_EMI_AMT" type="DECIMAL(16,2)"/>
			<column name="EMI" type="DECIMAL(16,2)"/>
			<column name="REPAYMENT_MODE" type="VARCHAR(1)"/>
			<column name="PRODUCTFLAG" type="VARCHAR(8)"/>
			<column name="AGREEMENTDATE" type="DATETIME"/>
			<column name="EXPIRYDATE" type="DATETIME"/>
			<column name="NO_OF_ADV_INSTL" type="DECIMAL(3)"/>
			<column name="UNIT_ID" type="DECIMAL(8)"/>
			<column name="BOUNCE_CHARGE_WAIVE" type="DECIMAL(16,2)"/>
			<column name="LPP_CHARGE_WAIVE" type="DECIMAL(16,2)"/>
		</createTable>
	</changeSet>
	
	<changeSet id="3" author="Jayant">
		<createTable tableName="DM_DISB_DETAILS_MONTHLY">
			<column name="APPLID" type="DECIMAL(8)"/>
			<column name="AGREEMENTNO" type="VARCHAR(20)"/>
			<column name="PARENT_AGREEMENTNO" type="CHAR(20)"/>
			<column name="NET_AMTFIN" type="DECIMAL(16,2)"/>
			<column name="NET_TENURE" type="DECIMAL(16,2)"/>
			<column name="PROMOTIONID" type="DECIMAL(8)"/>
			<column name="DLR_SUBVENTION" type="DECIMAL(16,2)"/>
			<column name="HIRER_BANK" type="VARCHAR(50)"/>
			<column name="CUST_BANK_CITY" type="VARCHAR(35)"/>
			<column name="CUST_ACCT_NO" type="VARCHAR(16)"/>
			<column name="IMD" type="DECIMAL(16,2)"/>
			<column name="SHORT_RECD" type="DECIMAL(16,2)"/>
			<column name="UPFRONT_CHARGES" type="DECIMAL(16,2)"/>
			<column name="PF_AMT" type="DECIMAL(16,2)"/>
			<column name="DOWNPAYMENT" type="DECIMAL(16,2)"/>
			<column name="DLR_BUY_DOWN" type="DECIMAL(16,2)"/>
			<column name="MFG_SUBVENTION_NDED" type="DECIMAL(16,2)"/>
			<column name="MFG_SUBVENTION_DED" type="DECIMAL(16,2)"/>
			<column name="ICICI_LOMBARD" type="DECIMAL(16,2)"/>
			<column name="BAGIC" type="DECIMAL(16,2)"/>
			<column name="SERVICECHARGE" type="DECIMAL(16,2)"/>
			<column name="UPFRONT_INTEREST" type="DECIMAL(16,2)"/>
			<column name="EXTND_WARR_DLR" type="DECIMAL(16,2)"/>
			<column name="PF_RCV_FRM_MFR" type="DECIMAL(16,2)"/>
			<column name="SRV_CHARGE_FRM_DLR" type="DECIMAL(16,2)"/>
			<column name="ADD_UPFRONT_INT_DLR" type="DECIMAL(16,2)"/>
			<column name="COM_UPF_INT_FRM_DLR" type="DECIMAL(16,2)"/>
			<column name="ADD_UPFRONT_FRM_CUST" type="DECIMAL(16,2)"/>
			<column name="UPFRONT_FRM_CUST" type="DECIMAL(16,2)"/>
			<column name="COM_UPF_INT_FRM_CUST" type="DECIMAL(16,2)"/>
			<column name="MORTGAGE_ORG" type="DECIMAL(16,2)"/>
			<column name="PRE_EMI" type="DECIMAL(16,2)"/>
			<column name="COMMITMENT_FEE" type="DECIMAL(16,2)"/>
			<column name="PF_FROM_CUST" type="DECIMAL(16,2)"/>
			<column name="ADV_REC_FRM_CUST" type="DECIMAL(16,2)"/>
			<column name="BALIC_CHARGES" type="DECIMAL(16,2)"/>
			<column name="OTHER_CHARGES_RECBL_CAS" type="DECIMAL(16,2)"/>
			<column name="OTHER_CHARGES_PAYABLE_CAS" type="DECIMAL(16,2)"/>
			<column name="BUSINESSDATE" type="DATETIME"/>
			<column name="PROCESSED_FLAG" type="CHAR(1)"/>
			<column name="PROCESS_DATE" type="DATETIME"/>
			<column name="EXISTING_LANNO" type="VARCHAR(20)"/>
		</createTable>
	</changeSet>
	<changeSet id="4" author="Jayant">
		<addColumn tableName="DM_LOAN_DETAILS_MONTHLY">
			<column name="BATCHID" type="BIGINT"></column>
		</addColumn>
	</changeSet>
	<changeSet id="5" author="Jayant">
		<addColumn tableName="DM_LOAN_BALANCES_MONTHLY">
			<column name="BATCHID" type="BIGINT"></column>
		</addColumn>
	</changeSet>
	<changeSet id="6" author="Jayant">
		<addColumn tableName="DM_DISB_DETAILS_MONTHLY">
			<column name="BATCHID" type="BIGINT"></column>
		</addColumn>
	</changeSet>
	<changeSet id="7" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_ADDRESS_DETAILS_VIEW"  replaceIfExists="true"> 
	  SELECT T7.FIELDCODEVALUE_NUM ADDRESSID,
			T1.CUSTID CUSTOMERID,T1.CUSTADDRPROVINCE STATEID,NULL REGIONID,T1.CUSTADDRCITY CITY,
			T2.PHONENUMBER STDISD,T1.CUSTADDRPRIORITY MAILINGADDRESS,CUSTADDRHNBR ADDRESS1,
			CUSTADDRSTREET ADDRESS2,CUSTADDRSTREET ADDRESS3,
			CUSTADDRZIP ZIPCODE,01 COUNTRY,CUSTADDRTYPE ADDRESSTYPE,
			NULL APPLICANT_TYPE,T3.PHONENUMBER PHONE1,T4.PHONENUMBER PHONE2,T5.PHONENUMBER MOBILE,
			CUSTEMAIL EMAIL,NULL BUSINESSDATE,
			'N' PROCESSFLAG,NULL PROCESS_DATE,
			NULL AREA,NULL LANDMARK,NULL BUSINESS_YEAR,NULL BATCH_ID ,T1.Lastmnton
			FROM CUSTOMERADDRESSES T1
			INNER JOIN CUSTOMERS T2 ON T1.CUSTID=T2.CUSTID 
			LEFT JOIN CUSTOMERPHONENUMBERS T3 ON T3.PHONECUSTID=T1.CUSTID AND T3.PHONETYPEPRIORITY=5
			LEFT JOIN (Select phonecustid,PHONENUMBER from (Select row_number() over(partition by phonecustid order by phonecustid) row_num,phonecustid,PHONENUMBER 
		  from CUSTOMERPHONENUMBERS where PHONETYPEPRIORITY=4)T where row_num=1) T4 ON T4.PHONECUSTID=T1.CUSTID 
			LEFT JOIN CUSTOMERPHONENUMBERS T5 ON T5.PHONECUSTID=T1.CUSTID AND T5.PHONETYPECODE ='MOBILE'
			LEFT JOIN CUSTOMEREMAILS T6 ON T6.CUSTID=T1.CUSTID AND CUSTEMAILPRIORITY=5
		Left join DATAMART_STAGE_MAPPING T7 on T7.FIELDCODE = T1.CustAddrtype and FIELDTYPE='Address'
	</createView>
</changeSet>
	
<changeSet id="8" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_APPLICANT_DETAILS_VIEW"  replaceIfExists="true"> 
	  SELECT DISTINCT T1.custcorebank CUSTOMERID,
				'APPLICANT' CUST_TYPE,
				T1.CUSTCRCPR PANNO, CUSTADDRHNBR ADDRESS1,T2.CUSTFLATNBR ADDRESS2,CUSTADDRSTREET ADDRESS3,CUSTADDRLINE1 ADDRESS4,CUSTADDRCITY 
				CITY,CUSTADDRPROVINCE STATE,CUSTADDRCOUNTRY COUNTRY,CUSTADDRZIP ZIPCODE,CUSTADDRTYPE ADDRESSTYPE,CUSTEMAIL EMAIL,T41.PHONENUMBER 
				PHONE1,T42.PHONENUMBER PHONE2,T4.PHONENUMBER MOBILE,T5.PHONENUMBER FAX,
				CASE WHEN T1.CUSTCOREBANK IS NULL THEN 'N' ELSE 'Y' END EXISTING_CUST_FLAG,
				CASE WHEN CUSTCTGCODE='RETAIL' THEN 'I' ELSE 'C' END INDIV_CORP_FLAG,
				ROUND(MONTHS_BETWEEN( (SELECT TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')  SYSPARMVALUE FROM SMTPARAMETERS WHERE 
				SYSPARMCODE='APP_DATE'),T1.CUSTDOB)/12) AGE,CUSTDOB DOB,CUSTFNAME FNAME,CUSTMNAME MNAME,CUSTLNAME LNAME,GENDERDESC 
				GENDER,CUSTMARITALSTS MARITAL_STATUS,NOOFDEPENDENTS NO_OF_DEPENDENT,
				ROUND(MONTHS_BETWEEN( (SELECT TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')  SYSPARMVALUE FROM SMTPARAMETERS WHERE 
				SYSPARMCODE='APP_DATE'),T7.CUSTEMPFROM)/12) YEARS_CURRENT_JOB,NULL YEARS_PREV_JOB,NULL QUALIFICATION,NULL RESIDENCETYPE,
				NULL YEARS_CURR_RESI,E.EMPNAME EMPLOYER_DESC,NULL COMPANY_TYPE,T1.CUSTINDUSTRY INDUSTRYID,NULL NATURE_OF_BUSINESS,
				T7.CUSTEMPTYPE EMPLOYMENT_TYPE,T7.CUSTEMPDESG EMPDESG,NULL OCCUPATION,
				 UDF_CONVERTCURRENCY(T1.CUSTTOTALINCOME,'INR','INR')  ANNUAL_INCOME,NULL GUARDIAN,NULL BUSINESSDATE,'N' PROCESSED_FLAG,
				NULL PROCESS_DATE,NULL SEGMENTS,CUSTSHRTNAME CUSTOMERNAME,NULL CONTACT_PERSON_NAME,T1.custtypecode CONSTITUTION,
				BBD.BANKCODE CUST_BANK_NAME,NULL CUST_BANK_BRANCH,NULL EMI_CARD_LIMIT,NULL EMI_CARD_ACCEPT_FLAG,NULL EMI_CARD_SWIPE_FLAG,
				NULL EMI_CARD_ELIG,NULL EMI_CARD_NO,NULL BANK_ECS_MANDATE,
				CASE WHEN M.CUSTID IS NOT NULL THEN 'Y' ELSE 'N' END OPEN_ECS_AVLB,
				M.STARTDATE OPEN_ECS_DATE,
				(SELECT EXTRACT(YEAR FROM (TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')))  SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE') 
				BUSINESS_YEAR,CUSTSALUTATIONCODE TITLE,CUSTEMPNAME COMP_NAME,CUSTEMPFROM  YEARS_CURR_JOB,NULL GRADE,NULL FAMILY_CODE,
				NULL MINOR,NULL GUARDIAN_NEW,CUSTCRCPR UCIN_NO,NULL PREFERRED_ELIGIBILITY,NULL PREFERRED_CARD_ACCEPTANCE,
				NULL PREFERRED_CARD_LIMIT,CUSTDFTBRANCH CUST_BRANCHID,NULL BATCH_ID ,T1.LastMnton
				FROM FinanceMain F 
		  Inner JOIN CUSTOMERS T1 on F.custid =T1.custid
				LEFT JOIN CUSTOMERADDRESSES T2 ON T1.CUSTID=T2.CUSTID AND CUSTADDRPRIORITY=5
				LEFT JOIN CUSTOMEREMAILS T3 ON T3.CUSTID=T1.CUSTID AND CUSTEMAILPRIORITY=5
				LEFT JOIN CUSTOMERPHONENUMBERS T41 ON T41.PHONECUSTID=T1.CUSTID AND T41.PHONETYPEPRIORITY=5
				LEFT JOIN (Select phonecustid,PHONENUMBER from (Select row_number() over(partition by phonecustid order by phonecustid) row_num,phonecustid,PHONENUMBER 
		  from CUSTOMERPHONENUMBERS where PHONETYPEPRIORITY=4)T where row_num=1) T42 ON T42.PHONECUSTID=T1.CUSTID 
				LEFT JOIN CUSTOMERPHONENUMBERS T4 ON T4.PHONECUSTID=T1.CUSTID AND T4.PHONETYPECODE ='MOBILE'
				LEFT JOIN CUSTOMERPHONENUMBERS T5 ON T5.PHONECUSTID=T1.CUSTID AND T5.PHONETYPECODE= 'FAX'
				LEFT JOIN BMTGENDERS T6 ON T6.GENDERCODE=T1.CUSTGENDERCODE
				LEFT JOIN CUSTOMEREMPDETAILS T7 ON T7.CUSTID = T1.CUSTID AND CURRENTEMPLOYER=1
				LEFT JOIN EMPLOYERDETAIL E ON E.EMPLOYERID = T7.CUSTEMPNAME
				LEFT JOIN (SELECT CUSTID,MAX(STARTDATE)STARTDATE FROM MANDATES M WHERE OPENMANDATE=1  AND MANDATETYPE='ECS' GROUP BY CUSTID)M ON M.CUSTID = T1.CUSTID
				LEFT JOIN (SELECT B.CUSTID,B.BANKBRANCHID FROM (
				SELECT CUSTID,MAX(LASTMNTON)LASTMNTON 
				FROM BENEFICIARY GROUP BY CUSTID )T  INNER JOIN BENEFICIARY B ON B.CUSTID=T.CUSTID AND B.LASTMNTON=T.LASTMNTON) B ON B.CUSTID =T1.CUSTID
				LEFT JOIN BANKBRANCHES BB ON BB.BANKBRANCHID = B.BANKBRANCHID
				LEFT JOIN BMTBANKDETAIL BBD ON BBD.BANKCODE =BB.BANKCODE
				where T1.custcorebank is not null
	</createView>
</changeSet>
			
<changeSet id="9" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_APPLICATION_DETAILS_VIEW"  replaceIfExists="true"> 
	  SELECT  substr(T2.finreference,-7,7) APPLID,substr(T2.finreference,-7,7) CRM_DEALID,NULL CRSCOREDATE,
				NULL CIBILSCORE,NULL APPSCORE,NULL BEHSCORE,NULL DEVIATION_TYPE,NULL DEVIATION_FLAG,
				NULL DEVIATION_CODE,NULL DEVIATION_NAME,NULL REQ_TENURE,NULL REQ_LOAN_AMT,
				NULL LOAN_LIMIT,T1.TOTALPRISCHD/CCYMINORCCYUNITS APPROVE_LOAN_AMT,NULL LOAN_PURPOSE,
				T1.FINTYPE LOAN_TYPE,CASE WHEN T1.CLOSINGSTATUS='C' THEN T2.LASTMNTON ELSE NULL END CANCELLATIONDATE,
				NULL CANCEL_REASON,substr(T2.REPAYFRQ,1,1) FREQUENCY,T1.FINAPPROVEDDATE LOAN_APPROVAL_DATE,
				T2.FINCONTRACTDATE AGREEMENTDATE,
				CASE WHEN T1.CURREDUCINGRATE>999 THEN 999 ELSE T1.CURREDUCINGRATE END INTRATE,
				CASE WHEN T2.EFFECTIVERATEOFRETURN>999 THEN 999 ELSE T2.EFFECTIVERATEOFRETURN END FLAT_RATE,
				CASE WHEN T2.EFFECTIVERATEOFRETURN>999 THEN 999 ELSE T2.EFFECTIVERATEOFRETURN END IRR,
				NULL GROSS_LTV,NULL NET_LTV,NULL COF,
				NULL DEBT_BURDEN_RATIO,NULL FOIR_DB,NULL SCHEMEID,NULL SCHEMEDESC,NULL SCHEMEGROUPID,
				NULL SCHEME_GROUPG_DESC,NULL PRODUCT_CATEGORY,T1.FINCATEGORY PROD_TYPE,
				NULL PROMOTIONID,NULL PROGRAMID,NULL SURROGATE_FLAG,NULL SOURCING_CHANNEL_TYPE,
				NULL SOURCING_CHANNEL_NAME,NULL REFERAL_GROUP,NULL REFERAL_NAME,
				NULL COUNTRYID,NULL COUNTRY,NULL REGIONID,NULL REGION,NULL STATEID,
				NULL STATE,NULL CITYID,NULL CITY,T1.FINBRANCH BRANCHID,BRANCHDESC BRANCHDESC,
				NULL BROKER_NAME,NULL DME_NAME,NULL ASM_NAME,C.CUSTRO1 RSM_NAME,
				NULL CRDT_MGR_NAME,NULL ROID_NAME,
				NULL TLID_NAME,NULL BMID_NAME,NULL COID_NAME,NULL SUPPLIERID,
				NULL DLR_PARTICIPATION_RATE,NULL LOCAL_OUTSTATION_FLG,C.custcorebank CUSTOMERID,
				NULL BUSINESSDATE,
				'N' PROCESSED_FLAG,NULL PROCESS_DATE,
				T1.FINTYPE PRODUCT,NULL SEGMENTS,NULL CRM_STATUS,T1.FINSTARTDATE LOGINDATE,T1.FINAPPROVEDDATE APPR_REJ_DATE,
				CASE WHEN T1.CLOSINGSTATUS='C' THEN T2.LASTMNTON ELSE NULL END CANCEL_DATE,
				NULL FILE_STATUS,NULL FILE_HOLD_REASON,NULL QDPDONE,NULL ISHOLD,NULL BRANCH_INW_DATE,
				NULL BRANCH_HOLD_DATE,NULL CPU_INW_DATE,NULL CPU_HOLD_DATE,NULL SYSTEM_HOLD,NULL PSL_FLAG,
				NULL DOC_WAVE_FLAG,NULL CUSTOMER_SWIPE,NULL CUSTOMER_ACCEPTANCE,'PAN CARD' KYC_DOC_TYPE,
				CD.CUSTDOCTITLE KYC_DOC_ID,NULL BUSINESS_IRR,NULL INSPECTORNAME,NULL REGNUMBER,
				NULL BUSINESS_YEAR,NULL DEALID,NULL PRETAXIRR,NULL ODM_FLAG,NULL DI_DATE,
				NULL LAA_QDP_FLAG,NULL PREFERRED_CARD_ACCEPTANCE,
				NULL ORIG_AMTFIN,NULL ELC_FLAG,NULL ELC_LIMIT,NULL QDP_DONE_DATE,
				NULL LAA_DECENTRALIZED_FLAG,NULL FCU_FLAG,
				NULL MKTGID,NULL DM_MPID,NULL SWIPE_CARD_CODE,NULL SOURCE_CARD_CODE,
				NULL DII_USER_ID,NULL QDP_CHEQUE_ISSUE,NULL INTEREST_TYPE,
				NULL DII_DONE_DATE,NULL FINISH_DATE,NULL BATCH_ID ,T2.Lastmnton
				FROM FINPFTDETAILS T1
				INNER JOIN FINANCEMAIN T2 ON T1.FINREFERENCE=T2.FINREFERENCE
				INNER JOIN RMTBRANCHES T3 ON T3.BRANCHCODE=T1.FINBRANCH
				INNER JOIN CUSTOMERS C ON C.CUSTID = T2.CUSTID
				INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE=T2.FINCCY
				LEFT JOIN (SELECT DISTINCT CUSTID,CUSTDOCTITLE FROM CUSTOMERDOCUMENTS WHERE CUSTDOCCATEGORY='03') CD ON CD.CUSTID = C.CUSTID
				WHERE substr(T2.finreference,-7,7) IS NOT NULL
	</createView>
</changeSet>
			
<changeSet id="10" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_BOUNCE_DETAILS_VIEW"  replaceIfExists="true"> 
	   SELECT substr(T3.finreference,-7,7) APPLID,T2.FAVOURNUMBER CHEQUEID,T3.FINREFERENCE AGREEMENTNO,
			T3.POSTDATE BOUNCE_DATE,T4.BounceCode BOUNCE_REASON,T3.ADVISEAMOUNT BOUNCE_AMT,
			NULL BUSINESSDATE,
			'N' PROCESSED_FLAG,NULL PROCESS_DATE,'' SEGMENTS,CAST(NULL AS NUMERIC(16,2)) BUSINESS_YEAR,'' CHEQUEDATE, NULL BATCH_ID,T3.Lastmnton
			FROM  MANUALADVISE T3
			INNER JOIN FINRECEIPTHEADER T ON T.RECEIPTID = T3.RECEIPTID 
			INNER JOIN FINRECEIPTDETAIL T2 ON T.RECEIPTID =T2.RECEIPTID AND T.RECEIPTMODE = T2.PAYMENTTYPE  
			INNER JOIN BOUNCEREASONS T4 ON T4.BOUNCEID =T3.BOUNCEID
			WHERE T.RECEIPTMODESTATUS  IN ('B') AND T.RECEIPTMODE IN ('CHEQUE','DD') AND T3.ADVISETYPE=1 AND T3.BOUNCEID>0
	</createView>
</changeSet>
		
<changeSet id="11" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_COAPPLICANT_DTLS_VIEW"  replaceIfExists="true"> 
	  <![CDATA[SELECT T1.CUSTID CUSTOMERID,T.APPLICANT_TYPE APPLICANT_TYPE,T1.CUSTCRCPR PAN_NO,
			NULL CUST_RELATION,T1.CUSTCTGCODE CUST_TYPE,
			CASE WHEN ROUND(MONTHS_BETWEEN((SELECT TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')  SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE'), T1.CUSTDOB)/12)<=99
			THEN ROUND(MONTHS_BETWEEN((SELECT TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')  SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE'), T1.CUSTDOB)/12) ELSE 99 END AGE,
			CUSTDOB DOB,CUSTFNAME FNAME,CUSTMNAME MNAME,CUSTLNAME LNAME,
			GENDERCODE GENDER,CUSTMARITALSTS MARITAL_STATUS,NOOFDEPENDENTS NO_OF_DEPENDENT,
			ROUND(MONTHS_BETWEEN( (SELECT TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')  SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE'),T7.CUSTEMPFROM)/12)  YRS_CURRENTJOB,
			NULL PREVIOUS_JOB_YEAR,NULL QUALIFICATION,E.EMPNAME EMPLOYER_DESC,
			NULL COMPANY_TYPE,T1.CUSTINDUSTRY INDUSTRYID,T1.CUSTSECTOR BUSINESS_NATURE,
			NULL OCCUPATION_CODE,NULL GUARDIAN,'N' PROCESS_FLAG,
			NULL PROCESS_DATE,CUSTEMPTYPE EMP_TYPE,NULL BUSINESSDATE,
			 UDF_CONVERTCURRENCY(CUSTTOTALINCOME,'INR','INR')  INCOME,APPLID APPLID,NULL BATCH_ID ,T.Lastmnton
			FROM 
			(SELECT DISTINCT 'CO APPLICANT' APPLICANT_TYPE,CUSTCIF,substr(finreference,-7,7) APPLID,Lastmnton FROM FINJOINTACCOUNTDETAILS UNION
			SELECT DISTINCT 'GUARANTEER' APPLICANT_TYPE,GUARANTORCIF,substr(finreference,-7,7) APPLID,Lastmnton FROM FINGUARANTORSDETAILS) T
			INNER JOIN CUSTOMERS T1 ON T.CUSTCIF =T1.CUSTCIF
			LEFT JOIN BMTGENDERS T2 ON T2.GENDERCODE=T1.CUSTGENDERCODE
			LEFT JOIN RMTCUSTTYPES T3 ON T3.CUSTTYPECODE=T1.CUSTTYPECODE
			LEFT JOIN CUSTOMEREMPDETAILS T7 ON T7.CUSTID = T1.CUSTID AND CURRENTEMPLOYER=1
			LEFT JOIN EMPLOYERDETAIL E ON E.EMPLOYERID = T7.CUSTEMPNAME]]>
	</createView>
</changeSet>

<changeSet id="12" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_DISB_DETAILS_DAILY_VIEW"  replaceIfExists="true"> 
	  <![CDATA[SELECT T2.FINAPPROVEDDATE AGREEMENTDATE,substr(T2.finreference,-7,7) APPLID,T2.FINREFERENCE AGREEMENTNO,
				T3.DISBSEQ DISBURSEMENTNO,T3.DISBDATE DISBURSEMENTDATE,NULL PARENT_AGREEMENTNO,
				T2.FINAMOUNT/CCYMINORCCYUNITS  AMTFIN,(T2.FINAMOUNT - T2.DOWNPAYMENT + T2.FEECHARGEAMT)/CCYMINORCCYUNITS  NET_AMTFIN,
				T7.DISBAMOUNT/CCYMINORCCYUNITS  DISBURSEDAMT,
				CASE WHEN T2.FINASSETVALUE=T2.FINCURRASSETVALUE THEN 'FULLY DISBURSED' ELSE 'PARTIALLY DISBURSED' END DISB_STATUS,
				T1.FIRSTREPAYDATE FIRST_DUE_DATE,ROUND(MONTHS_BETWEEN( T2.MATURITYDATE,T2.FINSTARTDATE)) GROSS_TENURE,T1.NOINST NET_TENURE,
				T2.MATURITYDATE MATURITYDATE,T2.LASTREPAYDATE EXPIRYDATE,NULL NO_OF_ADV_INSTL,
				NULL ADV_EMI_AMT,T2.FIRSTREPAY EMI,T2.FINREPAYMETHOD REPAYMENT_MODE,
				T2.FINTYPE PRODUCTFLAG,P.PROMOTIONID PROMOTIONID,NULL ICICI_LOMBARD,
				NULL BAGIC,NULL BALIC_CHARGES,
				NULL BUSINESSDATE,
				'N' PROCESSED_FLAG,
				NULL PROCESS_DATE,
				NULL SEGMENTS,T9.TOTALFEE/CCYMINORCCYUNITS FEE,NULL DEALER_SUBV,NULL MANU_SUBV_DED,NULL MANU_SUBV_NDED,
				T2.BPIAMOUNT/CCYMINORCCYUNITS PREEMI,
				NULL EXISTING_LANNO,NULL MORTGAGE_FEE,NULL COMMITMENT_FEE,T10.PROCES_FEE/CCYMINORCCYUNITS  PROCESSING_FEE,
				NULL PRE_EMI_RECEIVABLE,T2.INSURANCEAMT/CCYMINORCCYUNITS INSURANCE,
				T2.FINREPAYMETHOD PAYMENTMODE,CASE when substr(T2.REPAYFRQ,1,1)='Y' then 'A' else substr(T2.REPAYFRQ,1,1) end FREQ,
				NULL CHEQUENUM,substr(FA.BENEFICIARYACCNO,1,16)  CUST_ACCT_NO,T5.BANKNAME BANKNAME,T6.MICR MICRCODE,NULL BUSINESS_YEAR,
				NULL EMI_CHARGE,NULL PDC_CHARGE,CASE WHEN T2.EFFECTIVERATEOFRETURN>999 THEN 999 ELSE T2.EFFECTIVERATEOFRETURN END IRR_PER,
				T9.TOTALFEE/CCYMINORCCYUNITS FEE_WL,
				NULL ELC_CHARGE,NULL CREDIT_VIDYA_FEES,NULL BATCH_ID ,T3.Lastmnton
				FROM FINDISBURSEMENTDETAILS T3 
				INNER JOIN FINPFTDETAILS T1 ON T1.FINREFERENCE=T3.FINREFERENCE
				INNER JOIN FINANCEMAIN T2 ON T3.FINREFERENCE=T2.FINREFERENCE
				INNER JOIN RMTFINANCETYPES T4 ON T4.FINTYPE=T2.FINTYPE
				LEFT JOIN BANKBRANCHES T6 ON T6.BRANCHCODE=T2.FINBRANCH 
				LEFT JOIN BMTBANKDETAIL T5 ON T5.BANKCODE=T6.BANKCODE
				LEFT JOIN PROMOTIONS P ON P.PROMOTIONCODE = T2.PROMOTIONCODE
				INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE=T2.FINCCY			
				LEFT JOIN (SELECT FINREFERENCE,SUM(DISBAMOUNT) DISBAMOUNT
						   FROM FINDISBURSEMENTDETAILS
						   WHERE DISBDATE<=(SELECT TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')  SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE')
						   GROUP BY FINREFERENCE)T7 ON T7.FINREFERENCE=T2.FINREFERENCE
				LEFT JOIN (SELECT FINREFERENCE,SUM(BALANCEAMT)BALANCEAMT FROM FINEXCESSAMOUNT 
						   WHERE AMOUNTTYPE = 'A' GROUP BY FINREFERENCE)T8 ON T8.FINREFERENCE=T2.FINREFERENCE
				LEFT JOIN (SELECT FINREFERENCE,SUM(ACTUALAMOUNT-WAIVEDAMOUNT)TOTALFEE FROM FINFEEDETAIL
							GROUP BY FINREFERENCE)T9 ON T9.FINREFERENCE=T2.FINREFERENCE
				LEFT JOIN (SELECT FINREFERENCE,SUM(ACTUALAMOUNT-WAIVEDAMOUNT)PROCES_FEE 
							FROM FINFEEDETAIL F 
							INNER JOIN FEETYPES FT ON F.FEETYPEID = FT.FEETYPEID
							WHERE FT.FEETYPECODE='PROCFEE'
							GROUP BY FINREFERENCE)T10 ON T10.FINREFERENCE=T2.FINREFERENCE
				LEFT JOIN (SELECT FA.FINREFERENCE,FA.BENEFICIARYACCNO FROM (
							SELECT FINREFERENCE,MAX(PAYMENTSEQ) MAXPAYMENTSEQ FROM FINADVANCEPAYMENTS
							GROUP BY FINREFERENCE)T 
							INNER JOIN FINADVANCEPAYMENTS FA ON FA.FINREFERENCE=T.FINREFERENCE 
							AND FA.PAYMENTSEQ = T.MAXPAYMENTSEQ
						   )FA ON FA.FINREFERENCE=T2.FINREFERENCE]]>
	</createView>
</changeSet>

<changeSet id="13" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_HTS_UNADJUSTED_AMT_VIEW"  replaceIfExists="true"> 
	   Select substr(T2.finreference,-7,7) APPLID, SUM(T2.BALANCEAMT/RC.CCYMINORCCYUNITS)  UNADJUSTED_AMOUNT,
			NULL BUSINESSDATE,NULL BATCH_ID 
		from FINEXCESSAMOUNT  T2
		inner join FINANCEMAIN T1 on T1.FINREFERENCE =T2.FINREFERENCE
	  INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T1.FINCCY
		GROUP BY T2.FINREFERENCE
	</createView>
</changeSet>
		
<changeSet id="14" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_INSURANCE_DETAILS_VIEW"  replaceIfExists="true"> 
	  SELECT substr(T1.finreference,-7,7) APPLID,T1.FINREFERENCE AGREEMENTNO,NULL ASSETID,T2.HOSTFEETYPECODE 
				INSURANCE_TYPE,T2.VASFEEAMT INSUR_PREMIUM,NULL INSURANCE_RENEWAL_DATE,NULL BUSINESSDATE,'N' PROCESSED_FLAG,NULL PROCESS_DATE,NULL  
				SEGMENTS,NULL BUSINESS_YEAR,NULL POLICY_TENURE,NULL SUM_ASSURED,NULL NOMINEE_NAME,NULL GOOD_HEALTH,NULL CRITICAL_ILLNESS_FLAG, 
				NULL RELATIONSHIP,NULL NOMINEE_ADDRESS,NULL NOMINEE_RELATION,NULL NOMINEE_DOB,NULL NOMINEE_AGE,NULL NOMINEE_CONTACTNO,NULL 
				NOMINEE_NAME2,NULL NOMINEE_ADDRESS2,NULL NOMINEE_RELATION2,NULL NOMINEE_DOB2,NULL NOMINEE_AGE2,NULL NOMINEE_CONTACTNO2,NULL 
				DFGH,NULL BATCH_ID 
				FROM FINANCEMAIN T1 
				INNER JOIN (SELECT T1.FINREFERENCE,HOSTFEETYPECODE,SUM(ACTUALAMOUNT-WAIVEDAMOUNT)VASFEEAMT FROM FINFEEDETAIL T1 
							LEFT JOIN FEETYPES T2 ON T1.FEETYPEID = T2.FEETYPEID
							LEFT JOIN VASRECORDING T4 ON T1.VASREFERENCE = T4.VASREFERENCE
							WHERE HOSTFEETYPECODE IS NOT NULL 
							GROUP BY T1.FINREFERENCE,HOSTFEETYPECODE) T2 ON T1.FINREFERENCE = T2.FINREFERENCE
	</createView>
</changeSet>
			
<changeSet id="15" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_IVR_GATEWAY_FLEXI_VIEW"  replaceIfExists="true"> 
	  SELECT T1.FINREFERENCE AGREEMENTNO,T2.FINASSETVALUE/CCYMINORCCYUNITS DROP_LINE_LIMIT, 
			(T2.FINASSETVALUE-T2.FINCURRASSETVALUE)/CCYMINORCCYUNITS AMOUNT_DRAWN_LIMIT,
			T1.TOTALPRISCHD UTLIZED_BALANCE_LIMIT,T1.TOTALPRIPAID/CCYMINORCCYUNITS PRINCIPLE_AMOUNT_PAID,
			T1.TOTALPRIBAL/CCYMINORCCYUNITS BALANCE_PRINCIPAL_OUTSTANDING,
			NULL PROCESS_DATE,
			NULL BUSINESSDATE,NULL BATCH_ID,T2.Lastmnton
			FROM FINPFTDETAILS T1
			INNER JOIN FINANCEMAIN T2 ON T1.FINREFERENCE=T2.FINREFERENCE
			INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T1.FINCCY
	</createView>
</changeSet>
		
<changeSet id="16" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_LEA_DOC_DTLE_VIEW"  replaceIfExists="true"> 
	  SELECT substr(T1.finreference,-7,7)  AGREEMENTID,NULL APPLICABLE,
				substr(T2.finreference,-7,7)  APPLID,NULL APPROVED_BY,NULL AUTHDATE,NULL AUTHID,NULL AWB_NO,NULL BRANCHSTATUS,
				CAST(NULL AS NUMERIC(8,0)) CONSTITUTION,NULL COURIER_NAME,'N' CRITICAL,'P' CUSTOMER_TYPE,
				C.custcorebank  CUSTOMERID,NULL DATE_BRANCH_STATUS,NULL DATELASTUPDT,NULL DOC_CLASSFN,NULL DOC_RETRIEVAL_STATUS,
				CAST(NULL AS NUMERIC(8,0)) DOCID,NULL DOCTYPE,NULL FILE_BARCODE,NULL MAKERDATE,NULL MAKERID,NULL MC_STATUS,NULL NEW_FLAG,
				NULL ORIGINALS,NULL PACKET_TRACKER_NO,NULL PROPERTY_ADDRESS,DOCCATEGORY PROPERTY_CODE,NULL REASON,
				CASE WHEN DOCUMENT_STATUS='COMPLETED' THEN 'Y' ELSE 'N' END RECEIVED,NULL RECEIVEDDATE,NULL REJECTION_REASONS,
				NULL RELEASED_DATE,NULL RELEASED_REMARKS,D.DESCRIPTION REMARKS,'PBD' STAGE,D.RECEIVABLEDATE TARGETDATE,NULL TITLE_DOCUMENT,
				CAST(NULL AS NUMERIC(8,0)) TXNDOCID,NULL VALIDTILLDATE,NULL VAP_LOAN_FLAG,NULL BUSINESSDATE,'N' PROCESSFLAG,NULL PROCESSDATE,
				NULL SEGMENT,NULL REVISED_TARGET_DATE,NULL BATCH_ID,D.lastmnton 
				FROM (SELECT T.FINREFERENCE,COVENANTTYPE DOCCATEGORY,(CASE WHEN ALWWAIVER=1 THEN NULL ELSE T.RECEIVABLEDATE END) RECEIVABLEDATE,
						CASE WHEN ALWWAIVER=1 THEN 'WAIVED' ELSE 'PENDING' END DOCUMENT_STATUS,DESCRIPTION,T.lastmnton FROM FINCOVENANTTYPE T
						WHERE T.FINREFERENCE||COVENANTTYPE NOT IN (SELECT REFERENCEID||DOCCATEGORY  FROM DOCUMENTDETAILS DD)
						UNION ALL
						SELECT REFERENCEID FINREFERENCE,DD.DOCCATEGORY,NULL,'COMPLETED',DESCRIPTION,DD.lastmnton FROM DOCUMENTDETAILS DD 
						LEFT JOIN FINCOVENANTTYPE FC ON FC.FINREFERENCE=DD.REFERENCEID AND FC.COVENANTTYPE = DD.DOCCATEGORY)D 
				INNER JOIN FINPFTDETAILS T1 ON T1.FINREFERENCE=D.FINREFERENCE
				INNER JOIN Customers C on C.custid = T1.custid
				INNER JOIN FINANCEMAIN T2 ON T1.FINREFERENCE=T2.FINREFERENCE
				WHERE substr(T1.finreference,-7,7) IS NOT NULL
	</createView>
</changeSet>
			
<changeSet id="17" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_LOAN_DETAILS_DAILY_VIEW"  replaceIfExists="true"> 
	  SELECT substr(T1.finreference,-7,7) APPLID,T1.FINREFERENCE AGREEMENTNO,T3.CUSTID CUSTOMERID,
			EFFECTIVERATEOFRETURN CUSTOMER_YIELD,
			CASE WHEN T1.FINISACTIVE =1 THEN 'ACTIVE' WHEN T1.CLOSINGSTATUS='C' 
			THEN 'CANCELLED' ELSE 'CLOSED' END STATUS,T4.NPABUCKETID NPA_STAGE,NULL LMS_BUCKET,
			NULL COLL_BUCKET,NULL INSURANCE_APPLIED_FLG,
			NULL BUSINESSDATE,
			'N' PROCESSED_FLAG,NULL PROCESS_DATE,
			'LMS-DII' SEGMENTS,T1.MATURITYDATE CLOSUREDATE,
			NULL TOPUP_AMT,(SELECT EXTRACT(YEAR FROM (TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')))SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE') BUSINESS_YEAR,
			M.MANDATEID PDCID,NULL PCFLAG,
			CASE WHEN T1.PRODUCTCATEGORY='ODFCLITY' THEN 'Y' ELSE 'N' END OD_FLAG,
			T1.REPAYMARGIN MARGIN,T1.REPAYSPECIALRATE SPECIALMARGIN,NULL FIXEDTENOR,
			NULL CEEFFECTIVEDATE,T1.REPAYPROFITRATE EFF_RATE,T2.CURREDUCINGRATE PLRRATE,NULL PARTY_CODE,
			COALESCE(T3.CUSTFNAME,'')||' '||COALESCE(T3.CUSTMNAME,'')||' '||COALESCE(T3.CUSTLNAME,'') PARTY_NAME,
			NULL ZONE,NULL COLLECTION_CENTRE,NULL VIRTUAL_ACCOUNT_NUMBER,
			CASE WHEN T1.schedulemethod='EQUAL' and T1.stepfinance=0 then 'E'
		WHEN T1.schedulemethod='PFT' then 'T'
		WHEN T1.schedulemethod='PRI_PFT' and T1.stepfinance=0 then 'P'
		WHEN T1.schedulemethod='EQUAL' and T1.stepfinance=1 then 'G'
		WHEN T1.schedulemethod='PRI_PFT' and T1.stepfinance=1 then 'R' END INSTALLMENT_TYPE,NULL COMPANYTYPE,
			T1.TOTALPROFIT/CCYMINORCCYUNITS FIANANCE_CHARGES,T1.APPLICATIONNO FILENO,NULL NO_OF_PDCS,
			T9.VasFeeAmt/CCYMINORCCYUNITS LIFEINSURANCE,T6.REMAININGFEE/CCYMINORCCYUNITS SHORTRECEIVED,T3.CUSTSHRTNAME IN_FAVOUR_OFF,NULL MKTGID,
			T7.BALANCEAMT/CCYMINORCCYUNITS PRE_EMI_INT_500071,NULL LOAN_PURPOSE_DTL,NULL LOAN_PURPOSE_DESC,
			T8.TOT_FEE/CCYMINORCCYUNITS LOGIN_FEES,NULL VC_REFERRAL_CD,NULL VC_REFERRAL_NAME,
			NULL PROC_FEES2,T1.FINREPAYMETHOD INSTRUMENT_TYPE,NULL LAN_BARCODE,T1.FINSTARTDATE INTSTART_DATE_REGULAR,
			T1.BPIAMOUNT/CCYMINORCCYUNITS  BPI_RECEIVABLE,NULL BPI_PAYABLE,
			CASE WHEN M.OPENMANDATE=1 THEN 'Y' ELSE 'N' END OPEN_FACILITY_FLAG,NULL BATCH_ID,T1.Lastmnton
			FROM FINANCEMAIN T1
			INNER JOIN FINPFTDETAILS T2 ON T1.FINREFERENCE=T2.FINREFERENCE
			INNER JOIN CUSTOMERS T3 ON T3.CUSTID=T1.CUSTID
			INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T2.FINCCY
			LEFT JOIN FINPROVISIONS T4 ON T4.FINREFERENCE=T1.FINREFERENCE
			LEFT JOIN MANDATES M ON M.ORGREFERENCE =T1.FINREFERENCE AND M.MANDATEID = T1.MANDATEID
			LEFT JOIN (SELECT T1.FINREFERENCE , SUM(REMAININGFEE)REMAININGFEE FROM FINFEEDETAIL T1
			WHERE FEESCHEDULEMETHOD = 'DISB'
			GROUP BY T1.FINREFERENCE) T6 ON T1.FINREFERENCE=T6.FINREFERENCE
			LEFT JOIN (SELECT T1.FINREFERENCE , SUM(BALANCEAMT)BALANCEAMT FROM FINEXCESSAMOUNT T1
			WHERE AMOUNTTYPE = 'A' 
			GROUP BY T1.FINREFERENCE) T7 ON T1.FINREFERENCE=T7.FINREFERENCE
			LEFT JOIN (SELECT T1.FINREFERENCE , SUM(ACTUALAMOUNT-WAIVEDAMOUNT)TOT_FEE FROM FINFEEDETAIL T1
			GROUP BY T1.FINREFERENCE) T8 ON T1.FINREFERENCE=T8.FINREFERENCE
		LEFT JOIN (Select T1.Finreference,SUM(ActualAmount-WaivedAmount)VasFeeAmt from finfeedetail T1 
		Left join feetypes T2 on T1.Feetypeid = T2.Feetypeid
		Left join VasRecording T4 on T1.VasReference = T4.VasReference group by T1.Finreference)T9 ON T1.FINREFERENCE=T9.FINREFERENCE
	</createView>
</changeSet>
	
<changeSet id="18" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_LOAN_VOUCHER_DETAILS_VIEW"  replaceIfExists="true"> 
	  Select NULL MODULEID,Case when DSM.FIELDCODEVALUE_char is not null then DSM.FIELDCODEVALUE_char else 'X' end STAGEID,
				P.LINKEDTRANID ||TRANSORDER LEA_VOUCHERID,NULL FA_VOUCHERID,
		Case when DSM.FIELDCODEVALUE_char is not null then DSM.FIELDCODEVALUE_char else 'X' end VOUCHERTYPE,
		P.POSTDATE VOUCHERDATE,P.VALUEDATE VALUEDATE,RB.BANKREFNO BRANCHID,RB.BRANCHCODE BRANCH_CODE,
		RB.BRANCHDESC BRANCHDESC,RCP.BUSINESSAREA BUSINESS_AREA,AM.PROFITCENTERID PROFIT_CENTRE,FM.FINTYPE PRODUCT_FLAG,
		NULL SCHEMEID,PM.PROMOTIONDESC SCHEMEDESC,NULL ASSIGNMENT,substr(fm.finreference,-7,7) AGREEMENTID,FM.FINREFERENCE AGREEMENTNO,FM.FINAPPROVEDDATE AGREEMENTDATE,
		FP.FIRSTDISBDATE DISBURSALDATE,FM.FINISACTIVE LOAN_STATUS,FPR.NPABUCKETID NPA_STAGEID,
		substr(P.ACCOUNT,1,12) FINNONE_GLID,AT.ACTYPEDESC GROUPGLDESC,AM.HOSTACCOUNT SAPGL_CODE,
		AM.COSTCENTERID COST_CENTRE,
		COALESCE(CASE WHEN P.DRORCR='D' THEN P.POSTAMOUNT END,0) DRAMT,
		COALESCE(CASE WHEN P.DRORCR='C' THEN P.POSTAMOUNT END,0) CRAMT,
		P.DRORCR DRCR_FLAG,P.POSTAMOUNT DRCR_AMT,P.TRANDESC NARRATION,
		NULL CHEQUEID,
		NULL BUSINESSDATE,
		NULL PROCESSDATE,
		NULL SEGMENT,'N' PROCESSED_FLAG,NULL BATCH_ID,POSTDATE lastmnton from (
		Select P.LINKEDTRANID,P.TRANSORDER,P.FINREFERENCE,P.POSTDATE,P.VALUEDATE,P.ACCOUNT,P.FINEVENT,P.DRORCR,P.POSTAMOUNT,P.TRANDESC           
		from postings P INNER JOIN FINANCEMAIN FM ON FM.FINREFERENCE=P.FINREFERENCE where (P.PostAmount != 0)
		union all
		Select P.LINKEDTRANID,P.TRANSORDER,V.Primarylinkref,P.POSTDATE,P.VALUEDATE,P.ACCOUNT,P.FINEVENT,P.DRORCR,P.POSTAMOUNT,P.TRANDESC  
		from postings P INNER JOIN FINANCEMAIN FM ON FM.FINREFERENCE=P.FINREFERENCE
		Inner join vasrecording V on V.vasreference = P.finReference where (P.PostAmount != 0))P
		INNER JOIN FINANCEMAIN FM ON FM.FINREFERENCE=P.FINREFERENCE
		INNER JOIN FINPFTDETAILS FP ON FM.FINREFERENCE=FP.FINREFERENCE
		INNER JOIN RMTBRANCHES RB ON RB.BRANCHCODE = FM.FINBRANCH
		LEFT JOIN RMTCOUNTRYVSPROVINCE RCP ON RCP.CPPROVINCE = RB.BRANCHPROVINCE
		INNER JOIN ACCOUNTMAPPING AM  ON AM.ACCOUNT = P.ACCOUNT
		INNER JOIN RMTACCOUNTTYPES AT   ON AT.ACTYPE = AM.ACCOUNTTYPE
		LEFT JOIN PROMOTIONS PM ON PM.PROMOTIONCODE = FM.PROMOTIONCODE
		LEFT JOIN FINPROVISIONS FPR ON FPR.FINREFERENCE = FM.PROMOTIONCODE
		LEFT JOIN DataMart_Stage_Mapping DSM on DSM.FieldCode = P.FINEVENT and DSM.FieldType='Event'
	</createView>
</changeSet>

<changeSet id="19" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_LOANWISE_CHARGE_DTLS_VIEW"  replaceIfExists="true"> 
	  SELECT substr(T1.finreference,-7,7)  AGREEMENTID,M.ADVISEID TXNADVICEID,
	  Coalesce(M.FEETYPEID,m.bounceid) CHARGEID,NULL CHARGECODEID,coalesce(F.FEETYPEDESC,b.reason) CHARGEDESC,M.ADVISEAMOUNT/CCYMINORCCYUNITS CHARGEAMT,NULL STATUS,
			NULL AMTINPROCESS,M.PAIDAMOUNT/CCYMINORCCYUNITS TXNADJUSTEDAMT,
		M.ADVISEAMOUNT/CCYMINORCCYUNITS ADVICEAMT,M.POSTDATE ADVICEDATE,NULL BUSINESSDATE,
			NULL  PROCESSDATE,'N' PROCESSED_FLAG,'' SEGMENT,NULL BATCH_ID,M.lastmnton
			FROM FINPFTDETAILS T1
			INNER JOIN FINANCEMAIN T2 ON T1.FINREFERENCE=T2.FINREFERENCE
		INNER JOIN (Select FINREFERENCE,'01'||FeeId ADVISEID,FEETYPEID,
				   (ActualAmount-waivedAmount)ADVISEAMOUNT,PAIDAMOUNT,POSTDATE,null bounceid,lastmnton from finfeedetail 
					where FEETYPEID>0 union all
					Select FINREFERENCE,'02'||ADVISEID,FEETYPEID,ADVISEAMOUNT,PAIDAMOUNT,POSTDATE,bounceid,lastmnton
					from MANUALADVISE) M ON M.FINREFERENCE=T1.FINREFERENCE
		INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T1.FINCCY
		LEFT JOIN FEETYPES F ON F.FEETYPEID = M.FEETYPEID 	
		left join bouncereasons b on b.bounceid = m.bounceid
		WHERE substr(T1.finreference,-7,7) IS NOT NULL
	</createView>
</changeSet>

<changeSet id="04" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_LOANWISE_REPAYSCHEDULE_VIEW"  replaceIfExists="true"> 
	  SELECT T1.FINREFERENCE AGREEMENTNO,substr(T1.finreference,-7,7) AGREEMENTID,
			substr(T1.finreference,-7,7)||T2.INSTNUMBER PROPINSTLID,T2.INSTNUMBER EMI_NO,T2.SCHDATE DUEDATE,
			T2.BALANCEFORPFTCAL/CCYMINORCCYUNITS  OPENING_PRINCIPAL,
			T2.REPAYAMOUNT/CCYMINORCCYUNITS  INSTALMENT_AMT,
			T2.PRINCIPALSCHD/CCYMINORCCYUNITS  PRINCIPAL_AMT,
			T2.PROFITSCHD/CCYMINORCCYUNITS  INTEREST_AMT,
			T2.CLOSINGBALANCE/CCYMINORCCYUNITS  CLOSING_PRINCIPAL,T2.SCHDMETHOD INSTAL_TYPE,
			NULL TOTAL_AMOUNT_DUE,
			T1.FINASSETVALUE/CCYMINORCCYUNITS DROPLINE_LIMIT,
			(FINASSETVALUE-FINCURRASSETVALUE)/CCYMINORCCYUNITS ACT_AVAILABLE_LIMIT,
			FP.TOTALPRISCHD/CCYMINORCCYUNITS ACT_UTILISATION_LIMIT,CASE WHEN BPIORHOLIDAY='H' THEN 'Y' ELSE 'N' END EMI_HOLIDAY,
			NULL BATCH_ID,
			NULL BUSINESSDATE,T1.lastmnton
			FROM FINSCHEDULEDETAILS T2 
			INNER JOIN FINPFTDETAILS FP ON T2.FINREFERENCE=FP.FINREFERENCE
			INNER JOIN FINANCEMAIN T1 ON T1.FINREFERENCE=T2.FINREFERENCE
			INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T1.FINCCY
		WHERE DISBONSCHDATE=0 and repayamount>0
	</createView>
</changeSet>

<changeSet id="20" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_NOC_ELIGIBLE_LOANS_VIEW"  replaceIfExists="true"> 
	  SELECT T1.FINREFERENCE AGREEMENTNO,T1.FINREFERENCE LOANACCTNUM,T1.FINTYPE PRODUCTFLAG,CUSTEMAIL EMAIL,
			NULL BUSINESSDATE,
			NULL PROCESS_DATE,'N' PROCESSED_FLAG ,NULL BATCH_ID, T1.lastmnton
			FROM Financemain T1
			LEFT JOIN CUSTOMEREMAILS T3 ON T3.CUSTID=T1.CUSTID AND CUSTEMAILPRIORITY=5
	</createView>
</changeSet>
		
<changeSet id="21" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_OPENECS_DETAILS_VIEW"  replaceIfExists="true"> 
	  SELECT C.custcorebank CUSTOMERID,T1.MANDATEID ECS_ID,T2.BANKCODE BANK_ID,T3.BANKNAME BANK_NAME,NULL BANKBRANCHID,NULL BANKID,
				substr(T2.BRANCHDESC,1,50) BANK_BRANCH_NAME,PCCITYNAME CITY,T1.ACCTYPE ACCTYPE,T1.ACCNUMBER ACCNO,T1.MAXLIMIT/100 MAXLIMIT,NULL 
				BALLIMIT,NULL UTIL_LIMIT,NULL VALID_LIMIT,CASE WHEN T1.MANDATETYPE='ECS' THEN 'E' WHEN T1.MANDATETYPE='NACH' THEN 'Z' WHEN 
				T1.MANDATETYPE='DDM' THEN 'A'  END REPAY_MODE,T2.MICR MICRCODE,T1.ACTIVE ACTIVE_FLAG,T2.CITY CITYID,NULL SEGMENTS,
				NULL BUSINESSDATE,NULL PROCESS_DATE,NULL BATCH_ID ,T1.lastmnton
				FROM MANDATES T1
				INNER JOIN Customers C on C.CUSTID = T1.CUSTID
				INNER JOIN BANKBRANCHES T2 ON T2.BANKBRANCHID=T1.BANKBRANCHID 
				INNER JOIN BMTBANKDETAIL T3 ON T3.BANKCODE=T2.BANKCODE
				LEFT JOIN RMTPROVINCEVSCITY T4 ON T4.PCCITY = T2.CITY
	</createView>
</changeSet>
	
<changeSet id="22" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_PREPAYMENT_DETAILS_VIEW"  replaceIfExists="true"> 
	  SELECT substr(T2.finreference,-7,7)  APPLID,T1.FINREFERENCE AGREEMENTNO,T3.Receiptid PREPAYMENTID,NULL PREPAYMENT_RATE,NULL PREPAYMENT_TYPE,
			NULL PREPAYMENT_PENALTY_DUE,NULL PREPAYMENT_PENALTY_PAID,NULL PREPAYMENT_AMT,
			NULL BUSINESSDATE,'N' PROCESSED_FLAG,
			NULL PROCESS_DATE,
			'' SEGMENTS,'' PREPAYMENT_DATE,CAST(NULL AS NUMERIC(8,0)) BUSINESS_YEAR, NULL BATCH_ID ,T2.Lastmnton
			FROM FINPFTDETAILS T1
			INNER JOIN FINANCEMAIN T2 ON T1.FINREFERENCE=T2.FINREFERENCE
		inner join Finreceiptheader T3 on T3.Reference = T1.FINREFERENCE
	</createView>
</changeSet>
	
<changeSet id="23" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_PRESENTATION_DETAILS_VIEW"  replaceIfExists="true"> 
	 SELECT T1.FINREFERENCE AGREEMENTNO,FIRSTREPAYAMT/CCYMINORCCYUNITS   EMI,
				CASE WHEN T3.MANDATETYPE='ECS' THEN 'ECS' WHEN T3.MANDATETYPE='NACH' THEN 'Z' WHEN T3.MANDATETYPE='DDM' THEN 'D'  END  REPAY_TYPE,
				FR.Receiptdate DEPOSITED_DATE,NULL CREDIT_STATUS,b.BounceCode RETURN_CODE,b.reason RETURN_REASON,NULL REMARKS,NULL SEGMENTS,
				NULL PROCESSDATE,
				NULL BUSINESSDATE,
				PR.EMINo EMI_NO,T7.BANKNAME CUSTOMER_BANK_NAME,NULL BOM_BOUNCE_BUCKET,T6.MICR MICR_CODE,NULL STATUS_UPDT_DATE,T3.ACCNUMBER CUST_BANK_AC_NO,T6.BRANCHDESC CUSTOMER_BANK_BRANCH,
				T3.MANDATEID||PR.EMINo CHEQUESNO,NULL CHEQUEDATE,case when PR.EMINo=1  then 'Y' else 'N' end FEMI_FLAG,
				194 HOLD_IGNORE_CODE,Case when T3.Status='HOLD' then T3.Reason end HOLD_IGNORE_REASON,NULL DEST_ACC_HOLDER,
				T3.MANDATEID PDCID,  T6.BANKCODE BBRANCHID, NULL BATCH_ID ,PR.lastmnton
				FROM FINPFTDETAILS T1
				INNER JOIN FINANCEMAIN T2 ON T1.FINREFERENCE=T2.FINREFERENCE
				INNER JOIN PRESENTMENTDETAILS PR on PR.FINREFERENCE = T2.FINREFERENCE
				INNER JOIN FINRECEIPTHEADER FR on FR.RECEIPTID = PR.RECEIPTID
				LEFT JOIN BOUNCEREASONS B ON B.BOUNCEID = PR.BOUNCEID
				INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T2.FINCCY
				INNER JOIN MANDATES T3 ON T3.Mandateid = PR.Mandateid AND T3.ACTIVE=1
				INNER JOIN BANKBRANCHES T6 ON T6.BANKBRANCHID=T3.BANKBRANCHID 
				INNER JOIN BMTBANKDETAIL T7 ON T7.BANKCODE=T6.BANKCODE
	</createView>
</changeSet>
		
<changeSet id="24" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_PROPERTY_DTL_VIEW"  replaceIfExists="true"> 
	  SELECT NULL PROPERTYID,T1.FINREFERENCE APPLICATIONID,NULL ADDRESS1,
			NULL ADDRESS2,NULL ADDRESS3,NULL CITY,NULL STATE,T1.FINTYPE PRODUCTFLAG,
			NULL BUSINESSDATE,
			NULL  PROPERTY_TYPE,NULL  PROPERTY_DESC,
			NULL PROPERTY_VALUE,NULL  ZIPCODE,'N'  PROCESSFLAG,
			NULL PROCESS_DATE,
			NULL  BATCH_ID 
			FROM FINPFTDETAILS T1 where 1=2
	</createView>
</changeSet>
		
<changeSet id="25" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_RESCH_DETAILS_DAILY_VIEW"  replaceIfExists="true"> 
	  SELECT  substr(T2.finreference,-7,7) APPLID,T2.FINREFERENCE AGREEMENTNO,
			CASE WHEN FINASSETVALUE - FINCURRASSETVALUE > 0 THEN 'PARTIALLY DISBURSED' ELSE 'FULLY DISBURSED' END DISB_STATUS,
			T1.NOINST GROSS_TENURE, T1.NOINST NET_TENURE,T2.MATURITYDATE MATURITYDATE,T2.LASTREPAYDATE EXPIRYDATE,T1.FIRSTREPAYAMT/CCYMINORCCYUNITS  EMI, 
			T2.FINREPAYMETHOD REPAYMENT_MODE,T1.FINTYPE PRODUCTFLAG,
			NULL BUSINESSDATE,'N' PROCESSED_FLAG,
			NULL PROCESS_DATE,
			NULL SEGMENTS,substr(T2.REPAYFRQ,1,1) FREQ,
			CASE WHEN T1.FINISACTIVE =1 THEN 'ACTIVE' WHEN T1.CLOSINGSTATUS='C' THEN 'CANCELLED' ELSE 'CLOSED' END LOAN_STATUS,T1.MATURITYDATE CLOSUREDATE,
			T1.CUSTCIF CUST_ACCT_NO,T7.BANKNAME BANKNAME,T6.MICR MICRCODE,T6.BRANCHDESC CUST_BANK_BRANCH,
			T8.PCCITYNAME  CUST_BANK_CITY,NULL BUSINESS_YEAR,T3.MANDATEID PDCID,NULL PCFLAG,NULL TIE_UP,
			CASE WHEN REPAYMARGIN>999 THEN 999 ELSE REPAYMARGIN END MARGIN,T2.REPAYSPECIALRATE SPECIALMARGIN,
			T2.NUMBEROFTERMS FIXEDTENOR,NULL CEEFFECTIVEDATE,CASE WHEN T2.EFFECTIVERATEOFRETURN>999 THEN 999 ELSE T2.EFFECTIVERATEOFRETURN END  EFF_RATE,T1.CURREDUCINGRATE 

	PLRRATE,
			NULL TIE_UP_WITH,CASE WHEN T1.FINISACTIVE=0 THEN LATESTRPYDATE ELSE NULL END DATE_OF_CLOSURE,T3.Inputdate PDCMS_SEQ_GENERATED_DATE,
			T3.Inputdate INSTRUMENT_DATA_ENTRY_DATE,T2.FINAPPROVEDDATE PAYMENT_AUTHORIZATION_DATE, NULL BATCH_ID,T2.lastmnton
			FROM FINPFTDETAILS T1
			INNER JOIN FINANCEMAIN T2 ON T1.FINREFERENCE=T2.FINREFERENCE
			INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T2.FINCCY
			INNER JOIN MANDATES T3 ON T3.ORGREFERENCE = T2.FINREFERENCE AND T3.ACTIVE=1
			INNER JOIN BANKBRANCHES T6 ON T6.BANKBRANCHID=T3.BANKBRANCHID 
			INNER JOIN BMTBANKDETAIL T7 ON T7.BANKCODE=T6.BANKCODE
			LEFT JOIN RMTPROVINCEVSCITY T8 ON T8.PCCITY = T6.CITY
	</createView>
</changeSet>
	
<changeSet id="26" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_SEND_SOA_EMAIL_VIEW"  replaceIfExists="true"> 
	  SELECT T1.FINREFERENCE AGREEMENTNO,T1.CUSTID CUSTOMERID,T4.CUSTEMAIL EMAILID,substr(T2.finreference,-7,7) AGREEMENTID,
			substr(T2.finreference,-7,7) PROCESSID,
			(SELECT TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')  SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE')  GENERATION_DATE,
			NULL PROCESSED,T1.FINTYPE PRODUCTFLAG,NULL GROUPID,T5.ACTIVECNT+T6.CLOSECNT TOTAL_LAN,T6.CLOSECNT TOTAL_CLOSED_LAN,T5.ACTIVECNT TOTAL_ACTIVE_LAN,NULL SWIPE_FLAG,NULL 
			EMI_CARD_NO,T1.LATESTDISBDATE DISBURSEMENT_DATE,NULL SUPPLIERID,NULL SUPPLIERDESC,TOTALPRISCHD/CCYMINORCCYUNITS   AMT_FIN,
			FIRSTREPAYAMT/CCYMINORCCYUNITS  EMI,NEXTREPAYDATE NEXT_EMI_DUE_DATE,NULL CHEQUE_BOUNCE_CHARGE, NULL BATCH_ID ,T2.lastmnton
			FROM FINPFTDETAILS T1
			INNER JOIN FINANCEMAIN T2 ON T1.FINREFERENCE=T2.FINREFERENCE
			INNER JOIN CUSTOMERS T3 ON T3.CUSTID=T1.CUSTID
			INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T2.FINCCY
			LEFT JOIN CUSTOMEREMAILS T4 ON T4.CUSTID=T3.CUSTID AND CUSTEMAILPRIORITY=5
			LEFT JOIN (SELECT CUSTID,COUNT(*)ACTIVECNT FROM FINPFTDETAILS
					WHERE (FINISACTIVE=1) GROUP BY CUSTID)T5 ON T1.CUSTID =T5.CUSTID  
			LEFT JOIN (SELECT CUSTID,COUNT(*)CLOSECNT FROM FINPFTDETAILS
					WHERE (FINISACTIVE!=1)GROUP BY CUSTID)T6 ON T1.CUSTID =T6.CUSTID
	</createView>
</changeSet>
		
<changeSet id="27" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_SUBQ_DISB_DETAILS_VIEW"  replaceIfExists="true"> 
	  SELECT T2.FINAPPROVEDDATE AGREEMENTDATE, substr(T2.finreference,-7,7) APPLID,
			T2.FINREFERENCE AGREEMENTNO,T3.DISBSEQ DISBURSEMENTNO,T3.DISBDATE DISBURSEMENTDATE,NULL PARENT_AGREEMENTNO,
			T2.FINAMOUNT/CCYMINORCCYUNITS   AMTFIN, NULL NET_AMTFIN,T3.DISBAMOUNT/CCYMINORCCYUNITS  DISBURSEDAMT,
			T3.DISBISACTIVE DISB_STATUS,T1.FIRSTREPAYDATE FIRST_DUE_DATE,NULL GROSS_TENURE,
			NULL NET_TENURE,T2.MATURITYDATE MATURITYDATE,T2.MATURITYDATE EXPIRYDATE,NULL NO_OF_ADV_INSTL,  
			NULL ADV_EMI_AMT,T2.FIRSTREPAY EMI,T2.FINREPAYMETHOD REPAYMENT_MODE,
			T2.FINTYPE PRODUCTFLAG,NULL PROMOTIONID,NULL  ICICI_LOMBARD,NULL  BAGIC,NULL  BALIC_CHARGES,
			NULL BUSINESSDATE,
			'N' PROCESSED_FLAG,NULL PROCESS_DATE,NULL SEGMENTS,
			NULL  FEE,NULL  DEALER_SUBV,NULL  MANU_SUBV_DED,NULL  MANU_SUBV_NDED,NULL  PREEMI,NULL EXISTING_LANNO,NULL MORTGAGE_FEE,NULL COMMITMENT_FEE,
			NULL PROCESSING_FEE,NULL PRE_EMI_RECEIVABLE,NULL INSURANCE,NULL PAYMENTMODE,substr(T2.REPAYFRQ,1,1) FREQ,NULL CHEQUENUM,NULL BATCH_ID ,T2.lastmnton
			FROM  FINPFTDETAILS T1 INNER JOIN FINANCEMAIN T2 ON T1.FINREFERENCE=T2.FINREFERENCE
			INNER JOIN FINDISBURSEMENTDETAILS T3 ON T3.FINREFERENCE=T1.FINREFERENCE
			INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T2.FINCCY
	</createView>
</changeSet>

<changeSet id="28" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_TOPUP_DETAILS_VIEW"  replaceIfExists="true"> 
		SELECT T1.FINREFERENCE AGREEMENTNO,
		CAST(T2.APPLICATIONNO AS NUMERIC(8,0)) APPLID,T1.FINTYPE PRODUCTFLAG,
		CAST(NULL AS NUMERIC(8,0)) TOP_UP_AMT,
		CAST(NULL AS NUMERIC(8,0)) X_LAN_POS,
		CAST(NULL AS NUMERIC(16,2))  DISBURSALAMOUNT,
		CAST(T1.FINAMOUNT AS NUMERIC(16,2)) AMTFIN,NULL PROCESSEDDATE,NULL BUSINESSDATE,T2.lastmnton
		FROM FINPFTDETAILS T1
		INNER JOIN FINANCEMAIN T2 ON T1.FINREFERENCE=T2.FINREFERENCE
	</createView>
</changeSet>

<changeSet id="29" author="Prasad"  dbms="oracle"> 
	<createView viewName="DM_WRITEOFF_DETAILS_VIEW"  replaceIfExists="true"> 
	  SELECT  substr(T2.finreference,-7,7) APPLID,
			T2.FINREFERENCE AGREEMENTNO,WRITEOFFDATE CHARGEOFF_DT,NULL CHARGEOFF_FLG,
			T1.REMARKS CHARGEOFF_REASON,NULL SETTLEMENT_LOSS,
			(WRITEOFFPRINCIPAL+WRITEOFFPROFIT)/CCYMINORCCYUNITS   GROSS_WRITEOFF_AMT,
			(WRITEOFFPRINCIPAL+WRITEOFFPROFIT)/CCYMINORCCYUNITS   NET_WRITEOFF_AMT,
			NULL BUSINESSDATE,
			'N' PROCESSED_FLAG,NULL PROCESS_DATE,NULL SEGMENTS,
			NULL RECEIPT_ON_CHARGEOFF,NULL BUSINESS_YEAR, NULL BATCH_ID,T2.lastmnton 
			FROM FINWRITEOFFDETAIL T1
			INNER JOIN FINANCEMAIN T2 ON T1.FINREFERENCE=T2.FINREFERENCE
			INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T2.FINCCY
	</createView>
</changeSet>

<changeSet id="30" author="Prasad"  dbms="oracle"> 
	<createView viewName="FORECLOSURECHARGES_VIEW"  replaceIfExists="true"> 
	  select substr(T1.finreference,-7,7) AGREEMENTID,t4.BAL_PRINCIPAL/CCYMINORCCYUNITS  BAL_PRINCIPAL,
		null RESEDUL_VALUE,T4.INSTALLMENTS INSTALLMENTS,T4.ADVICES ADVICES,
		t4.PENALTY/CCYMINORCCYUNITS   PENALTY,t4.INTREST_ON_TERMINATION/CCYMINORCCYUNITS  INTREST_ON_TERMINATION,null FLOATINTREST_ON_TERMINATION,
			t4.OVER_DUES/CCYMINORCCYUNITS OVER_DUES,t4.OVER_DUES/CCYMINORCCYUNITS CURRENT_OVERDUES,t4.CURRENT_WAVEOFFAMT/CCYMINORCCYUNITS CURRENT_WAVEOFFAMT,
			null OVER_DISTANCE_CHARGES,	0 INTREST_ON_TERMINATION_PER_DAY,t1.PFTACCRUED/CCYMINORCCYUNITS INTREST_ACCRUALS,t4.EXCESS_AMOUNT/CCYMINORCCYUNITS EXCESS_AMOUNT,
			null EXCESS_REFUND,	null ADVICE,null REBATE,null ADVINSTL,null EXCESSPRINPMNT,null SDAMT,null SDINT,null EXCESS_INTREST_RATE,null VAT_ON_FORECLOSURE,
			null UNDER_DISTANCE_CHARGES, T3.NET_PAYBALE/CCYMINORCCYUNITS NET_PAYBALE,t3.TotalFeeAmount/CCYMINORCCYUNITS WAIVEOFFAMOUNT,'Foreclosure' ACTIVITY,
			t3.AUTHORIZEDON AUTHORIZEDON,null COMMITMENT_FEE,null ORIGINATION_FEE,null PRE_EMI,(Select to_date(sysparmvalue, 'YYYY-MM-DD')  sysparmvalue 
		from smtparameters where SYSPARMCODE='APP_DATE') BUSINESS_DATE, null CHEQUEID,t1.CLOSINGSTATUS STATUS,T4.INTEREST_WAIVE_OFF/CCYMINORCCYUNITS INTEREST_WAIVE_OFF,
		T4.BALANCE_PRIN_WAIVE_OFF/CCYMINORCCYUNITS BALANCE_PRIN_WAIVE_OFF,t4.INSTALLMET_INT_WAIVE_OFF/CCYMINORCCYUNITS  INSTALLMET_INT_WAIVE_OFF,
		t4.INTEREST_WAIVE_OFF/CCYMINORCCYUNITS WOFF_CURRMONTH_INT,t4.WOFF_OVERDUE_CHARGE/CCYMINORCCYUNITS  WOFF_OVERDUE_CHARGE,
		T4.WOFF_CHQBOUNCE_CHARGES/CCYMINORCCYUNITS WOFF_CHQBOUNCE_CHARGES,T4.WOFF_OTHERS/CCYMINORCCYUNITS WOFF_OTHERS,
		T4.BALANCE_PRIN_WAIVE_OFF/CCYMINORCCYUNITS INSTALLMENT_PRIN_WAIVE_OFF,null WOFF_PARKING_CHARGES,null TOT_OTHER_REPO_CHARGES,
		null WOFF_OTHER_REPO_CHARGES,null TOT_REPOSESSION_CHARGES,null WOFF_REPOSESSION_CHARGES,null TOT_PARKING_CHARGES,null BATCH_ID,t2.lastmnton
		from Finpftdetails t1
			inner join financemain t2 on t1.finreference =t2.finreference
			INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T1.FINCCY
			inner join (Select reference,sum(TotFeeAmount)TotalFeeAmount,sum(ReceiptAmount-coalesce(WaviedAmt,0)) NET_PAYBALE,MAX(Receiptdate) AUTHORIZEDON from FINRECEIPTHEADER 
			where receiptpurpose = 'EarlySettlement' group by reference)T3 on T3.reference =T1.finreference 
			left join  ( Select T1.reference,Count( Case when T3.Finevent='SchdlRepayment' then  T4.Schdate end)INSTALLMENTS,
							SUM(PriAmount)BAL_PRINCIPAL,SUM(PFTAmount)INTREST_ON_TERMINATION,
							 sum(Coalesce( Case when T3.Finevent='E' then  RepayAMount end,0))EXCESS_AMOUNT,
							 Count( case when m.movementid is not null then m.movementid end)ADVICES,
							 SUM(Case when RA.AllocationType='ODC' THEN RA.PaidAMount end)PENALTY,
							 SUM(Case when RA.AllocationType='LPFT' THEN RA.PaidAMount end)OVER_DUES,
							 SUM(Case when RA.AllocationType is not null THEN RA.WaivedAMount end)CURRENT_WAVEOFFAMT,
							 SUM(Case when RA.AllocationType='PFT' THEN RA.WaivedAMount end)INTEREST_WAIVE_OFF,
							 SUM(Case when RA.AllocationType='PRI' THEN RA.WaivedAMount end)BALANCE_PRIN_WAIVE_OFF,
							 SUM(Case when RA.AllocationType='LPFT' THEN RA.WaivedAMount end)INSTALLMET_INT_WAIVE_OFF,
							 SUM(Case when RA.AllocationType='ODC' THEN RA.WaivedAMount end)WOFF_OVERDUE_CHARGE,
							 SUM(Case when RA.AllocationType='BOUNCE' THEN RA.WaivedAMount end)WOFF_CHQBOUNCE_CHARGES,
							 SUM(Case when RA.AllocationType  not in ('BOUNCE','PFT','PRI','LPFT','ODC') THEN RA.WaivedAMount end)WOFF_OTHERS
					  from FINRECEIPTHEADER T1 inner join 
							 FINRECEIPTDETAIL T2 on T1.RECEIPTID =T2.RECEIPTID inner join 
							 Finrepayheader T3 on T3.Receiptseqid = T2.Receiptseqid  inner join 
							 Finrepayscheduledetail T4 on T4.repayid = T3.repayid left join
							 Manualadvisemovements M on M.Receiptseqid = T2.Receiptseqid left join
							 Receiptallocationdetail RA on RA.RECEIPTID =T1.RECEIPTID
					  where T1.receiptpurpose = 'EarlySettlement'
							group by T1.reference) T4 on T4.reference =T1.finreference
	</createView>
</changeSet>
<changeSet id="31" author="Siva">
		<createView viewName="FINRECEIPTDETAIL_TVIEW" replaceIfExists="true"> 
			Select T1.ReceiptID , T1.ReceiptSeqID , T1.ReceiptType , T1.PaymentTo , T1.PaymentType , T1.PayAgainstID  , 
						T1.Amount  , T1.FavourNumber , T1.ValueDate , T1.BankCode , T1.FavourName , T1.DepositDate , T1.DepositNo , T1.PaymentRef , 
						 T1.TransactionRef , T1.ChequeAcNo , T1.FundingAc , T1.ReceivedDate , T1.Status , T2.BankName BankCodeDesc,
						 T3.PartnerBankCode FundingAcDesc , T1.PayOrder, T1.LogKey, T3.AccountNo PartnerBankAc, T3.AcType PartnerBankAcType, T5.FeeTypeCode
						 From FinReceiptDetail_Temp T1 LEFT JOIN 
						   BMTBankDetail T2 ON T1.BankCode = T2.BankCode LEFT JOIN 
						   PartnerBanks T3 ON T1.FundingAc  = T3.PartnerBankID LEFT JOIN
			         ManualAdvise T4 ON T1.PayAgainstID = T4.AdviseID AND T1.PaymentType = 'PAYABLE' LEFT JOIN
			         FeeTypes T5 ON T4.FeeTypeId = T5.FeeTypeId
		</createView>
	</changeSet>
	<changeSet id="32" author="Siva">
		<createView viewName="FINRECEIPTDETAIL_AVIEW" replaceIfExists="true"> 
			  Select T1.ReceiptID , T1.ReceiptSeqID , T1.ReceiptType , T1.PaymentTo , T1.PaymentType , T1.PayAgainstID  , 
						T1.Amount  , T1.FavourNumber , T1.ValueDate , T1.BankCode , T1.FavourName , T1.DepositDate , T1.DepositNo , T1.PaymentRef , 
						 T1.TransactionRef , T1.ChequeAcNo , T1.FundingAc , T1.ReceivedDate , T1.Status , T2.BankName BankCodeDesc,
						 T3.PartnerBankCode FundingAcDesc, T1.PayOrder , T1.LogKey, T3.AccountNo PartnerBankAc, T3.AcType PartnerBankAcType, T5.FeeTypeCode,T5.FeeTypeDesc
						 From FinReceiptDetail T1 LEFT JOIN 
						   BMTBankDetail T2 ON T1.BankCode = T2.BankCode LEFT JOIN 
						   PartnerBanks T3 ON T1.FundingAc  = T3.PartnerBankID LEFT JOIN 
						   manualadvise T4 ON T1.PayAgainstID  = T4.AdviseID AND T1.PaymentType = 'PAYABLE' LEFT JOIN
			         FeeTypes T5 ON T4.FeeTypeID = T5.FeeTypeID
		</createView>
	</changeSet>
	<changeSet id="33" author="Siva">
		<sql>
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'PB_ReceiptAmount','Total Receipt Amount from Bank','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'PA_ReceiptAmount','Total Receipt Amount from Payable','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'EX_ReceiptAmount','Total Receipt Amount from Excess','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'EA_ReceiptAmount','Total Receipt Amount from EMIAdvance','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_exPft','Total Interest Paid from Excess','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_eAPft','Total Interest Paid from EMIAdvance','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_pAPft','Total Interest Paid from Payable','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_pftDuePaid','Interest Due Paid - Bank','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_ExPftDuePaid','Interest Due Paid - Excess','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_EAPftDuePaid','Interest Due Paid - EMIAdvance','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_PAPftDuePaid','Interest Due Paid - Payable','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_pftDueWaived','Interest Due Waived','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_accruedPaid','Accrual Interest Paid - Bank','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_exAccruedPaid','Accrual Interest Paid - Excess','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_eAAccruedPaid','Accrual Interest Paid - EMIAdvance','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_pAAccruedPaid','Accrual Interest Paid - Payable','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_accrueWaived','Accrual Interest Waived','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_unAccruedPaid','UnAccrued Interest Paid - Bank','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_exUnAccruedPaid','UnAccrued Interest Paid - Excess','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_eAUnAccruedPaid','UnAccrued Interest Paid - EMIAdvance','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_pAUnAccruedPaid','UnAccrued Interest Paid - Payable','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_unAccrueWaived','UnAccrued Interest Waived','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_exPri','Total Principal Paid from Excess','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_eAPri','Total Principal Paid from EMIAdvance','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_pAPri','Total Principal Paid from Payable','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_futurePriPaid','Future Principal Paid - Bank','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_exFuturePriPaid','Future Principal Paid - Excess','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_eAFuturePriPaid','Future Principal Paid - EMIAdvance','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_pAFuturePriPaid','Future Principal Paid - Payable','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_futurePriWaived','Future Principal Waived','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_priDuePaid','Principal Due Paid - Bank','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_ExPriDuePaid','Principal Due Paid - Excess','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_EAPriDuePaid','Principal Due Paid - EMIAdvance','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_PAPriDuePaid','Principal Due Paid - Payable','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES (ALLOWEDEVENT,ALLOWEDRIA,AMOUNTCODE,AMOUNTCODEDESC,AMOUNTCODEISACTIVE,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('EARLYSTL',0,'ae_priDueWaived','Principal Due Waived','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
		</sql>
	</changeSet>
		<changeSet id="34" author="manoj.p">
		<createTable tableName="CONTROLDUMP_EXTRACT">
			<column name ="SEQID" 			type="bigint">
				<constraints nullable="false" />
			</column>
			<column name ="FINREFERENCE" 	type="varchar(20)">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name ="FINTYPE" 		type="varchar(8)">
				<constraints nullable="false"/>
			</column>
			<column name ="FINBRANCH" 				type="varchar(12)"/>
			<column name ="FINCONTRACTDATE" 		type="datetime"/>
			<column name ="FINASSETVALUE" 			type="number(18,2)"/>
			<column name ="FINSTATUS" 				type="varchar(8)"/>
			<column name ="DUEBUCKET" 				type="int"/>
			<column name ="FINCURRASSETVALUE" 		type="number(18,2)"/>
			<column name ="EFFECTIVERATEOFRETURN" 	type="number(13,9)"/>
			<column name ="REPAYPROFITRATE" 		type="number(13,9)"/>
			<column name ="FINISACTIVE" 			type="smallint"/>
			<column name ="LASTREPAYDATE" 			type="datetime"/>
			<column name ="MATURITYDATE" 			type="datetime"/>
			<column name ="CLOSINGSTATUS" 			type="char(1)"/>
			<column name ="FINSTARTDATE" 			type="datetime"/>
			<column name ="CUSTCIF"					type="varchar(20)"/>
			<column name ="CUSTSHRTNAME" 			type="varchar(200)"/>
			<column name ="BANKREFNO" 				type="varchar(20)"/>
			<column name ="BRANCHDESC" 				type="varchar(50)"/>
			<column name ="CCYEDITFIELD" 			type="smallint"/>
			<column name ="CCYMINORCCYUNITS" 		type="smallint"/>
			<column name ="PROMOTIONID" 			type="bigint"/>
			<column name ="PROMOTIONDESC" 			type="varchar(50)"/>
			<column name ="MANDATETYPE" 			type="varchar(20)"/>
		</createTable>
	</changeSet>
	<changeSet id="35" author="Jayant" dbms="oracle">
	    <sql splitStatements="false">
	        begin
	        	SP_INVALIDVIEWS;
	        	RESEED_SEQUENCE_TABLES;
	        end;
	    </sql>
	</changeSet>
	<changeSet id="36" author="Jayant" dbms="oracle">
		<createView viewName="DM_LOAN_DETAILS_DAILY_VIEW" replaceIfExists="true">
				SELECT substr(T1.finreference,-7,7) APPLID,T1.FINREFERENCE AGREEMENTNO,T3.CUSTID CUSTOMERID,
				EFFECTIVERATEOFRETURN CUSTOMER_YIELD,
				CASE WHEN T1.FINISACTIVE =1 THEN 'ACTIVE' WHEN T1.CLOSINGSTATUS='C' 
				THEN 'CANCELLED' ELSE 'CLOSED' END STATUS,T4.NPABUCKETID NPA_STAGE,NULL LMS_BUCKET,
				NULL COLL_BUCKET,NULL INSURANCE_APPLIED_FLG,
				NULL BUSINESSDATE,
				'N' PROCESSED_FLAG,NULL PROCESS_DATE,
				'LMS-DII' SEGMENTS,T1.MATURITYDATE CLOSUREDATE,
				NULL TOPUP_AMT,(SELECT EXTRACT(YEAR FROM (TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')))SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE') BUSINESS_YEAR,
				M.MANDATEID PDCID,NULL PCFLAG,
				CASE WHEN T1.PRODUCTCATEGORY='ODFCLITY' THEN 'Y' ELSE 'N' END OD_FLAG,
				T1.REPAYMARGIN MARGIN,null SPECIALMARGIN,NULL FIXEDTENOR,
				NULL CEEFFECTIVEDATE,T1.REPAYPROFITRATE EFF_RATE,T2.CURREDUCINGRATE PLRRATE,NULL PARTY_CODE,
				COALESCE(T3.CUSTFNAME,'')||' '||COALESCE(T3.CUSTMNAME,'')||' '||COALESCE(T3.CUSTLNAME,'') PARTY_NAME,
				NULL ZONE,NULL COLLECTION_CENTRE,NULL VIRTUAL_ACCOUNT_NUMBER,
				CASE WHEN T1.schedulemethod='EQUAL' and T1.stepfinance=0 then 'E'
			WHEN T1.schedulemethod='PFT' then 'T'
			WHEN T1.schedulemethod='PRI_PFT' and T1.stepfinance=0 then 'P'
			WHEN T1.schedulemethod='EQUAL' and T1.stepfinance=1 then 'G'
			WHEN T1.schedulemethod='PRI_PFT' and T1.stepfinance=1 then 'R' END INSTALLMENT_TYPE,NULL COMPANYTYPE,
				T1.TOTALPROFIT/CCYMINORCCYUNITS FIANANCE_CHARGES,T1.APPLICATIONNO FILENO,NULL NO_OF_PDCS,
				T9.VasFeeAmt/CCYMINORCCYUNITS LIFEINSURANCE,T6.REMAININGFEE/CCYMINORCCYUNITS SHORTRECEIVED,T3.CUSTSHRTNAME IN_FAVOUR_OFF,NULL MKTGID,
				T7.BALANCEAMT/CCYMINORCCYUNITS PRE_EMI_INT_500071,NULL LOAN_PURPOSE_DTL,NULL LOAN_PURPOSE_DESC,
				T8.TOT_FEE/CCYMINORCCYUNITS LOGIN_FEES,NULL VC_REFERRAL_CD,NULL VC_REFERRAL_NAME,
				NULL PROC_FEES2,T1.FINREPAYMETHOD INSTRUMENT_TYPE,NULL LAN_BARCODE,T1.FINSTARTDATE INTSTART_DATE_REGULAR,
				T1.BPIAMOUNT/CCYMINORCCYUNITS  BPI_RECEIVABLE,NULL BPI_PAYABLE,
				CASE WHEN M.OPENMANDATE=1 THEN 'Y' ELSE 'N' END OPEN_FACILITY_FLAG,NULL BATCH_ID,T1.Lastmnton
				FROM FINANCEMAIN T1
				INNER JOIN FINPFTDETAILS T2 ON T1.FINREFERENCE=T2.FINREFERENCE
				INNER JOIN CUSTOMERS T3 ON T3.CUSTID=T1.CUSTID
				INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T2.FINCCY
				LEFT JOIN FINPROVISIONS T4 ON T4.FINREFERENCE=T1.FINREFERENCE
				LEFT JOIN MANDATES M ON M.ORGREFERENCE =T1.FINREFERENCE AND M.MANDATEID = T1.MANDATEID
				LEFT JOIN (SELECT T1.FINREFERENCE , SUM(REMAININGFEE)REMAININGFEE FROM FINFEEDETAIL T1
				WHERE FEESCHEDULEMETHOD = 'DISB'
				GROUP BY T1.FINREFERENCE) T6 ON T1.FINREFERENCE=T6.FINREFERENCE
				LEFT JOIN (SELECT T1.FINREFERENCE , SUM(BALANCEAMT)BALANCEAMT FROM FINEXCESSAMOUNT T1
				WHERE AMOUNTTYPE = 'A' 
				GROUP BY T1.FINREFERENCE) T7 ON T1.FINREFERENCE=T7.FINREFERENCE
				LEFT JOIN (SELECT T1.FINREFERENCE , SUM(ACTUALAMOUNT-WAIVEDAMOUNT)TOT_FEE FROM FINFEEDETAIL T1
				GROUP BY T1.FINREFERENCE) T8 ON T1.FINREFERENCE=T8.FINREFERENCE
			LEFT JOIN (Select T1.Finreference,SUM(ActualAmount-WaivedAmount)VasFeeAmt from finfeedetail T1 
			Left join feetypes T2 on T1.Feetypeid = T2.Feetypeid
			Left join VasRecording T4 on T1.VasReference = T4.VasReference group by T1.Finreference)T9 ON T1.FINREFERENCE=T9.FINREFERENCE
		</createView>
	</changeSet>
	<changeSet id="37" author="Jayant" dbms="oracle">
		<createView viewName="DM_INSURANCE_DETAILS_VIEW" replaceIfExists="true">
				  SELECT substr(T1.finreference,-7,7) APPLID,T1.FINREFERENCE AGREEMENTNO,NULL ASSETID,substr(T2.HOSTFEETYPECODE,1,15)
				INSURANCE_TYPE,T2.VASFEEAMT INSUR_PREMIUM,NULL INSURANCE_RENEWAL_DATE,NULL BUSINESSDATE,'N' PROCESSED_FLAG,NULL PROCESS_DATE,NULL  
				SEGMENTS,NULL BUSINESS_YEAR,NULL POLICY_TENURE,NULL SUM_ASSURED,NULL NOMINEE_NAME,NULL GOOD_HEALTH,NULL CRITICAL_ILLNESS_FLAG, 
				NULL RELATIONSHIP,NULL NOMINEE_ADDRESS,NULL NOMINEE_RELATION,NULL NOMINEE_DOB,NULL NOMINEE_AGE,NULL NOMINEE_CONTACTNO,NULL 
				NOMINEE_NAME2,NULL NOMINEE_ADDRESS2,NULL NOMINEE_RELATION2,NULL NOMINEE_DOB2,NULL NOMINEE_AGE2,NULL NOMINEE_CONTACTNO2,NULL 
				DFGH,NULL BATCH_ID, T1.LASTMNTON LASTMNTON
				FROM FINANCEMAIN T1 
				INNER JOIN (SELECT T1.FINREFERENCE,HOSTFEETYPECODE,SUM(ACTUALAMOUNT-WAIVEDAMOUNT)VASFEEAMT FROM FINFEEDETAIL T1 
							LEFT JOIN FEETYPES T2 ON T1.FEETYPEID = T2.FEETYPEID
							LEFT JOIN VASRECORDING T4 ON T1.VASREFERENCE = T4.VASREFERENCE
							WHERE HOSTFEETYPECODE IS NOT NULL 
							GROUP BY T1.FINREFERENCE,HOSTFEETYPECODE) T2 ON T1.FINREFERENCE = T2.FINREFERENCE
		</createView>
	</changeSet>
	<changeSet id="38" author="Jayant" dbms="oracle">
		<createView viewName="DM_APPLICANT_DETAILS_VIEW" replaceIfExists="true">
				SELECT DISTINCT T1.custcorebank CUSTOMERID,
				'APPLICANT' CUST_TYPE,
				T1.CUSTCRCPR PANNO, CUSTADDRHNBR ADDRESS1,T2.CUSTFLATNBR ADDRESS2,CUSTADDRSTREET ADDRESS3,CUSTADDRLINE1 ADDRESS4,CUSTADDRCITY 
				CITY,CUSTADDRPROVINCE STATE,CUSTADDRCOUNTRY COUNTRY,CUSTADDRZIP ZIPCODE,CUSTADDRTYPE ADDRESSTYPE,CUSTEMAIL EMAIL,T41.PHONENUMBER 
				PHONE1,T42.PHONENUMBER PHONE2,T4.PHONENUMBER MOBILE,T5.PHONENUMBER FAX,
				CASE WHEN T1.CUSTCOREBANK IS NULL THEN 'N' ELSE 'Y' END EXISTING_CUST_FLAG,
				CASE WHEN CUSTCTGCODE='RETAIL' THEN 'I' ELSE 'C' END INDIV_CORP_FLAG,
				ROUND(MONTHS_BETWEEN( (SELECT TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')  SYSPARMVALUE FROM SMTPARAMETERS WHERE 
				SYSPARMCODE='APP_DATE'),T1.CUSTDOB)/12) AGE,CUSTDOB DOB,CUSTFNAME FNAME,CUSTMNAME MNAME,CUSTLNAME LNAME,GENDERDESC 
				GENDER,CUSTMARITALSTS MARITAL_STATUS,NOOFDEPENDENTS NO_OF_DEPENDENT,
				ROUND(MONTHS_BETWEEN( (SELECT TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')  SYSPARMVALUE FROM SMTPARAMETERS WHERE 
				SYSPARMCODE='APP_DATE'),T7.CUSTEMPFROM)/12) YEARS_CURRENT_JOB,NULL YEARS_PREV_JOB,NULL QUALIFICATION,NULL RESIDENCETYPE,
				NULL YEARS_CURR_RESI,E.EMPNAME EMPLOYER_DESC,NULL COMPANY_TYPE,T1.CUSTINDUSTRY INDUSTRYID,NULL NATURE_OF_BUSINESS,
				T7.CUSTEMPTYPE EMPLOYMENT_TYPE,T7.CUSTEMPDESG EMPDESG,NULL OCCUPATION,
				 UDF_CONVERTCURRENCY(T1.CUSTTOTALINCOME,'INR','INR')  ANNUAL_INCOME,NULL GUARDIAN,NULL BUSINESSDATE,'N' PROCESSED_FLAG,
				NULL PROCESS_DATE,NULL SEGMENTS,CUSTSHRTNAME CUSTOMERNAME,NULL CONTACT_PERSON_NAME,T1.custtypecode CONSTITUTION,
				BBD.BANKCODE CUST_BANK_NAME,NULL CUST_BANK_BRANCH,NULL EMI_CARD_LIMIT,NULL EMI_CARD_ACCEPT_FLAG,NULL EMI_CARD_SWIPE_FLAG,
				NULL EMI_CARD_ELIG,NULL EMI_CARD_NO,NULL BANK_ECS_MANDATE,
				CASE WHEN M.CUSTID IS NOT NULL THEN 'Y' ELSE 'N' END OPEN_ECS_AVLB,
				M.STARTDATE OPEN_ECS_DATE,
				(SELECT EXTRACT(YEAR FROM (TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')))  SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE') 
				BUSINESS_YEAR,CUSTSALUTATIONCODE TITLE,CUSTEMPNAME COMP_NAME,CUSTEMPFROM  YEARS_CURR_JOB,NULL GRADE,NULL FAMILY_CODE,
				NULL MINOR,NULL GUARDIAN_NEW,CUSTCRCPR UCIN_NO,NULL PREFERRED_ELIGIBILITY,NULL PREFERRED_CARD_ACCEPTANCE,
				NULL PREFERRED_CARD_LIMIT,CUSTDFTBRANCH CUST_BRANCHID,NULL BATCH_ID ,T1.LastMnton
				FROM CUSTOMERS T1
				LEFT JOIN CUSTOMERADDRESSES T2 ON T1.CUSTID=T2.CUSTID AND CUSTADDRPRIORITY=5
				LEFT JOIN CUSTOMEREMAILS T3 ON T3.CUSTID=T1.CUSTID AND CUSTEMAILPRIORITY=5
				LEFT JOIN CUSTOMERPHONENUMBERS T41 ON T41.PHONECUSTID=T1.CUSTID AND T41.PHONETYPEPRIORITY=5
				LEFT JOIN (Select phonecustid,PHONENUMBER from (Select row_number() over(partition by phonecustid order by phonecustid) row_num,phonecustid,PHONENUMBER 
		  from CUSTOMERPHONENUMBERS where PHONETYPEPRIORITY=4)T where row_num=1) T42 ON T42.PHONECUSTID=T1.CUSTID 
				LEFT JOIN CUSTOMERPHONENUMBERS T4 ON T4.PHONECUSTID=T1.CUSTID AND T4.PHONETYPECODE ='MOBILE'
				LEFT JOIN CUSTOMERPHONENUMBERS T5 ON T5.PHONECUSTID=T1.CUSTID AND T5.PHONETYPECODE= 'FAX'
				LEFT JOIN BMTGENDERS T6 ON T6.GENDERCODE=T1.CUSTGENDERCODE
				LEFT JOIN CUSTOMEREMPDETAILS T7 ON T7.CUSTID = T1.CUSTID AND CURRENTEMPLOYER=1
				LEFT JOIN EMPLOYERDETAIL E ON E.EMPLOYERID = T7.CUSTEMPNAME
				LEFT JOIN (SELECT CUSTID,MAX(STARTDATE)STARTDATE FROM MANDATES M WHERE OPENMANDATE=1  AND MANDATETYPE='ECS' GROUP BY CUSTID)M ON M.CUSTID = T1.CUSTID
				LEFT JOIN (SELECT B.CUSTID,B.BANKBRANCHID FROM (
				SELECT CUSTID,MAX(LASTMNTON)LASTMNTON 
				FROM BENEFICIARY GROUP BY CUSTID )T  INNER JOIN BENEFICIARY B ON B.CUSTID=T.CUSTID AND B.LASTMNTON=T.LASTMNTON) B ON B.CUSTID =T1.CUSTID
				LEFT JOIN BANKBRANCHES BB ON BB.BANKBRANCHID = B.BANKBRANCHID
				LEFT JOIN BMTBANKDETAIL BBD ON BBD.BANKCODE =BB.BANKCODE
				where T1.custcorebank is not null and T1.custid in (select custid from FinanceMain)
		</createView>
	</changeSet>
	<changeSet id="39" author="Jayant" dbms="oracle">
		<createView viewName="DM_HTS_UNADJUSTED_AMT_VIEW" replaceIfExists="true">
			Select substr(T2.finreference,-7,7) APPLID, SUM(T2.BALANCEAMT/RC.CCYMINORCCYUNITS)  UNADJUSTED_AMOUNT,
			NULL BUSINESSDATE,NULL BATCH_ID from FINEXCESSAMOUNT  T2 inner join FINANCEMAIN T1 on T1.FINREFERENCE =T2.FINREFERENCE
	  		INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T1.FINCCY 	GROUP BY T2.FINREFERENCE
		</createView>
	</changeSet>
	<changeSet id="40" author="Jayant" dbms="oracle">
		<createView viewName="DM_PROPERTY_DTL_VIEW" replaceIfExists="true">
			  SELECT NULL PROPERTYID,T1.FINREFERENCE APPLICATIONID,NULL ADDRESS1,
				NULL ADDRESS2,NULL ADDRESS3,NULL CITY,NULL STATE,T1.FINTYPE PRODUCTFLAG,
				NULL BUSINESSDATE,
				NULL  PROPERTY_TYPE,NULL  PROPERTY_DESC,
				NULL PROPERTY_VALUE,NULL  ZIPCODE,'N'  PROCESSFLAG,
				NULL PROCESS_DATE,
				NULL  BATCH_ID, T2.LASTMNTON LASTMNTON 
				FROM FINPFTDETAILS T1 
	      Inner JOIN FINANCEMAIN T2 ON T1.FINREFERENCE = T2.FINREFERENCE 
	      where 1=2
		</createView>
	</changeSet>
	<changeSet id="41" author="Jayant" dbms="oracle">
		<createView viewName="DM_RESCH_DETAILS_DAILY_VIEW" replaceIfExists="true">
			  SELECT  substr(T2.finreference,-7,7) APPLID,T2.FINREFERENCE AGREEMENTNO,
			CASE WHEN FINASSETVALUE - FINCURRASSETVALUE > 0 THEN 'PARTIALLY DISBURSED' ELSE 'FULLY DISBURSED' END DISB_STATUS,
			T1.NOINST GROSS_TENURE, T1.NOINST NET_TENURE,T2.MATURITYDATE MATURITYDATE,T2.LASTREPAYDATE EXPIRYDATE,T1.FIRSTREPAYAMT/CCYMINORCCYUNITS  EMI, 
			T2.FINREPAYMETHOD REPAYMENT_MODE,T1.FINTYPE PRODUCTFLAG,
			NULL BUSINESSDATE,'N' PROCESSED_FLAG,
			NULL PROCESS_DATE,
			NULL SEGMENTS,substr(T2.REPAYFRQ,1,1) FREQ,
			CASE WHEN T1.FINISACTIVE =1 THEN 'ACTIVE' WHEN T1.CLOSINGSTATUS='C' THEN 'CANCELLED' ELSE 'CLOSED' END LOAN_STATUS,T1.MATURITYDATE CLOSUREDATE,
			T1.CUSTCIF CUST_ACCT_NO,T7.BANKNAME BANKNAME,T6.MICR MICRCODE,T6.BRANCHDESC CUST_BANK_BRANCH,
			T8.PCCITYNAME  CUST_BANK_CITY,NULL BUSINESS_YEAR,T3.MANDATEID PDCID,NULL PCFLAG,NULL TIE_UP,
			CASE WHEN REPAYMARGIN>999 THEN 999 ELSE REPAYMARGIN END MARGIN,null SPECIALMARGIN,
			T2.NUMBEROFTERMS FIXEDTENOR,NULL CEEFFECTIVEDATE,CASE WHEN T2.EFFECTIVERATEOFRETURN>999 THEN 999 ELSE T2.EFFECTIVERATEOFRETURN END  EFF_RATE,T1.CURREDUCINGRATE 
	        PLRRATE,
			NULL TIE_UP_WITH,CASE WHEN T1.FINISACTIVE=0 THEN LATESTRPYDATE ELSE NULL END DATE_OF_CLOSURE,T3.Inputdate PDCMS_SEQ_GENERATED_DATE,
			T3.Inputdate INSTRUMENT_DATA_ENTRY_DATE,T2.FINAPPROVEDDATE PAYMENT_AUTHORIZATION_DATE, NULL BATCH_ID,T2.lastmnton
			FROM FINPFTDETAILS T1
			INNER JOIN FINANCEMAIN T2 ON T1.FINREFERENCE=T2.FINREFERENCE
			INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T2.FINCCY
			INNER JOIN MANDATES T3 ON T3.ORGREFERENCE = T2.FINREFERENCE AND T3.ACTIVE=1
			INNER JOIN BANKBRANCHES T6 ON T6.BANKBRANCHID=T3.BANKBRANCHID 
			INNER JOIN BMTBANKDETAIL T7 ON T7.BANKCODE=T6.BANKCODE
			LEFT JOIN RMTPROVINCEVSCITY T8 ON T8.PCCITY = T6.CITY
		</createView>
	</changeSet>
	<changeSet id="42" author="Jayant" dbms="oracle">
		<sqlFile path="change-logs/SP_DM_DISB_DETAILS_MONTHLY.sql" endDelimiter="DonotStop" encoding="UTF-8"/>
	</changeSet>
	<changeSet id="43" author="Jayant" dbms="oracle">
		<sqlFile path="change-logs/SP_DM_LOAN_BALANCES_MONTHLY.sql" endDelimiter="DonotStop" encoding="UTF-8"/>
	</changeSet>
	<changeSet id="44" author="Jayant" dbms="oracle">
		<sqlFile path="change-logs/SP_DM_LOAN_DETAILS_MONTHLY.sql" endDelimiter="DonotStop" encoding="UTF-8"/>
	</changeSet>
	<changeSet id="45" author="Jayant" dbms="oracle">
	    <sql splitStatements="false">
	        begin
	        	SP_INVALIDVIEWS;
	        	RESEED_SEQUENCE_TABLES;
	        end;
	    </sql>
	</changeSet>
	<changeSet id="46" author="Manoj">
		<sql>
			delete from SMTPARAMETERS where sysparmcode='DM_LMN_PROCESSINGREQ';
			INSERT INTO SMTPARAMETERS VALUES ('DM_LMN_PROCESSINGREQ','LastMntOn required for DataMart Processing','String', 1,  'Y','1',0, NULL, NULL,'LastMntOn required for DataMart Processing',1, 1000, CURRENT_TIMESTAMP,'Approved',NULL, NULL, NULL, NULL, NULL, 0);
		</sql>
	</changeSet>
	<changeSet id="47" author="Jayant" dbms="oracle">
		<createView viewName="DM_LOAN_VOUCHER_DETAILS_VIEW" replaceIfExists="true">
			Select NULL MODULEID,Case when DSM.FIELDCODEVALUE_char is not null then DSM.FIELDCODEVALUE_char else 'X' end STAGEID,
				P.LINKEDTRANID ||TRANSORDER LEA_VOUCHERID,NULL FA_VOUCHERID,
		Case when DSM.FIELDCODEVALUE_char is not null then DSM.FIELDCODEVALUE_char else 'X' end VOUCHERTYPE,
		P.POSTDATE VOUCHERDATE,P.VALUEDATE VALUEDATE,RB.BANKREFNO BRANCHID,RB.BRANCHCODE BRANCH_CODE,
		RB.BRANCHDESC BRANCHDESC,RCP.BUSINESSAREA BUSINESS_AREA,AM.PROFITCENTERID PROFIT_CENTRE,FM.FINTYPE PRODUCT_FLAG,
		NULL SCHEMEID,PM.PROMOTIONDESC SCHEMEDESC,NULL ASSIGNMENT,substr(fm.finreference,-7,7) AGREEMENTID,FM.FINREFERENCE AGREEMENTNO,FM.FINAPPROVEDDATE AGREEMENTDATE,
		FP.FIRSTDISBDATE DISBURSALDATE,FM.FINISACTIVE LOAN_STATUS,FPR.NPABUCKETID NPA_STAGEID,
		substr(P.ACCOUNT,1,12) FINNONE_GLID,AT.ACTYPEDESC GROUPGLDESC,AM.HOSTACCOUNT SAPGL_CODE,
		AM.COSTCENTERID COST_CENTRE,
		COALESCE(CASE WHEN P.DRORCR='D' THEN P.POSTAMOUNT END,0) DRAMT,
		COALESCE(CASE WHEN P.DRORCR='C' THEN P.POSTAMOUNT END,0) CRAMT,
		P.DRORCR DRCR_FLAG,P.POSTAMOUNT DRCR_AMT,P.TRANDESC NARRATION,
		NULL CHEQUEID,
		NULL BUSINESSDATE,
		NULL PROCESSDATE,
		NULL SEGMENT,'N' PROCESSED_FLAG,NULL BATCH_ID,P.lastmnton from (
		Select P.LINKEDTRANID,P.TRANSORDER,P.FINREFERENCE,P.POSTDATE,P.VALUEDATE,P.ACCOUNT,P.FINEVENT,P.DRORCR,P.POSTAMOUNT,P.TRANDESC,FM.lastmnton          
		from postings P INNER JOIN FINANCEMAIN FM ON FM.FINREFERENCE=P.FINREFERENCE where (P.PostAmount != 0)
		union all
		Select P.LINKEDTRANID,P.TRANSORDER,V.Primarylinkref,P.POSTDATE,P.VALUEDATE,P.ACCOUNT,P.FINEVENT,P.DRORCR,P.POSTAMOUNT,P.TRANDESC,FM.lastmnton   
		from postings P INNER JOIN FINANCEMAIN FM ON FM.FINREFERENCE=P.FINREFERENCE
		Inner join vasrecording V on V.vasreference = P.finReference where (P.PostAmount != 0))P
		INNER JOIN FINANCEMAIN FM ON FM.FINREFERENCE=P.FINREFERENCE
		INNER JOIN FINPFTDETAILS FP ON FM.FINREFERENCE=FP.FINREFERENCE
		INNER JOIN RMTBRANCHES RB ON RB.BRANCHCODE = FM.FINBRANCH
		LEFT JOIN RMTCOUNTRYVSPROVINCE RCP ON RCP.CPPROVINCE = RB.BRANCHPROVINCE
		INNER JOIN ACCOUNTMAPPING AM  ON AM.ACCOUNT = P.ACCOUNT
		INNER JOIN RMTACCOUNTTYPES AT   ON AT.ACTYPE = AM.ACCOUNTTYPE
		LEFT JOIN PROMOTIONS PM ON PM.PROMOTIONCODE = FM.PROMOTIONCODE
		LEFT JOIN FINPROVISIONS FPR ON FPR.FINREFERENCE = FM.PROMOTIONCODE
		LEFT JOIN DataMart_Stage_Mapping DSM on DSM.FieldCode = P.FINEVENT and DSM.FieldType='Event'
		</createView>
	</changeSet>
	<changeSet id="48" author="Jayant" dbms="oracle">
		<createView viewName="DM_OPENECS_DETAILS_VIEW" replaceIfExists="true">
			  SELECT C.custcorebank CUSTOMERID,T1.MANDATEID ECS_ID,T2.BANKCODE BANK_ID,T3.BANKNAME BANK_NAME,NULL BANKBRANCHID,NULL BANKID,
				substr(T2.BRANCHDESC,1,50) BANK_BRANCH_NAME,PCCITYNAME CITY,T1.ACCTYPE ACCTYPE,substr(T1.ACCNUMBER,1,16) ACCNO,T1.MAXLIMIT/100 MAXLIMIT,NULL 
				BALLIMIT,NULL UTIL_LIMIT,NULL VALID_LIMIT,CASE WHEN T1.MANDATETYPE='ECS' THEN 'E' WHEN T1.MANDATETYPE='NACH' THEN 'Z' WHEN 
				T1.MANDATETYPE='DDM' THEN 'A'  END REPAY_MODE,T2.MICR MICRCODE,T1.ACTIVE ACTIVE_FLAG,T2.CITY CITYID,NULL SEGMENTS,
				NULL BUSINESSDATE,NULL PROCESS_DATE,NULL BATCH_ID ,T1.lastmnton
				FROM MANDATES T1
				INNER JOIN Customers C on C.CUSTID = T1.CUSTID
				INNER JOIN BANKBRANCHES T2 ON T2.BANKBRANCHID=T1.BANKBRANCHID 
				INNER JOIN BMTBANKDETAIL T3 ON T3.BANKCODE=T2.BANKCODE
				LEFT JOIN RMTPROVINCEVSCITY T4 ON T4.PCCITY = T2.CITY
		</createView>
	</changeSet>
	<changeSet id="49" author="Jayant" dbms="oracle">
	    <sql splitStatements="false">
	        begin
	        	SP_INVALIDVIEWS;
	        	RESEED_SEQUENCE_TABLES;
	        end;
	    </sql>
	</changeSet>
	<changeSet id="50" author="Jayant" dbms="oracle">
		<createView viewName="DM_BOUNCE_DETAILS_VIEW" replaceIfExists="true">
			SELECT distinct substr(T3.finreference,-7,7) APPLID,T2.FAVOURNUMBER CHEQUEID,T3.FINREFERENCE AGREEMENTNO,
			T3.POSTDATE BOUNCE_DATE,T4.BounceCode BOUNCE_REASON,T3.ADVISEAMOUNT BOUNCE_AMT,
			NULL BUSINESSDATE,
			'N' PROCESSED_FLAG,NULL PROCESS_DATE,'' SEGMENTS,CAST(NULL AS NUMERIC(16,2)) BUSINESS_YEAR,'' CHEQUEDATE, NULL BATCH_ID,T3.Lastmnton
			FROM  MANUALADVISE T3
			INNER JOIN FINRECEIPTHEADER T ON T.RECEIPTID = T3.RECEIPTID 
			INNER JOIN FINRECEIPTDETAIL T2 ON T.RECEIPTID =T2.RECEIPTID AND T.RECEIPTMODE = T2.PAYMENTTYPE  
			INNER JOIN BOUNCEREASONS T4 ON T4.BOUNCEID =T3.BOUNCEID
			WHERE T.RECEIPTMODESTATUS  IN ('B') AND T.RECEIPTMODE IN ('CHEQUE','DD') AND T3.ADVISETYPE=1 AND T3.BOUNCEID>0
		</createView>
	</changeSet>
	<changeSet id="51" author="Jayant" dbms="oracle">
		<createView viewName="DM_HTS_UNADJUSTED_AMT_VIEW" replaceIfExists="true">
			  Select substr(T2.finreference,-7,7) APPLID, T2.FINREFERENCE, SUM(T2.BALANCEAMT/RC.CCYMINORCCYUNITS)  UNADJUSTED_AMOUNT,
			NULL BUSINESSDATE,NULL BATCH_ID from FINEXCESSAMOUNT  T2 inner join FINANCEMAIN T1 on T1.FINREFERENCE =T2.FINREFERENCE
	  		INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T1.FINCCY 	GROUP BY T2.FINREFERENCE
		</createView>
	</changeSet>
</databaseChangeLog>