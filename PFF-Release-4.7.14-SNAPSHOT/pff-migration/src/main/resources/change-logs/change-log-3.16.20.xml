<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />
	

	
	<changeSet id="1" author="Veeravenkata">
	<createView viewName="FINRECEIPTDETAIL_AVIEW" replaceIfExists="true">
		Select 	T1.ReceiptID, T1.ReceiptSeqID, T1.ReceiptType, T1.PaymentTo, T1.PaymentType, T1.PayAgainstID, 
				T1.Amount, T1.FavourNumber , T1.ValueDate , T1.BankCode , T1.FavourName , T1.DepositDate , T1.DepositNo, T1.PaymentRef, 
				T1.TransactionRef , T1.ChequeAcNo , T1.FundingAc , T1.ReceivedDate , T1.Status , T2.BankName BankCodeDesc,
				T3.PartnerBankCode FundingAcCode, T3.PartnerBankName FundingAcDesc, T1.PayOrder, T1.LogKey, T3.AccountNo PartnerBankAc, 
				T3.AcType PartnerBankAcType, T5.FeeTypeCode, T5.FeeTypeDesc
				
		From 	FinReceiptDetail T1 LEFT JOIN 
				BMTBankDetail T2 ON T1.BankCode = T2.BankCode LEFT JOIN 
				PartnerBanks T3 ON T1.FundingAc  = T3.PartnerBankID LEFT JOIN
				ManualAdvise T4 ON T1.PayAgainstID = T4.AdviseID AND T1.PaymentType = 'PAYABLE' LEFT JOIN
				FeeTypes T5 ON T4.FeeTypeId = T5.FeeTypeId
	</createView>
</changeSet>
<changeSet id="2" author="Veeravenkata">
	<createView viewName="FINRECEIPTDETAIL_TVIEW" replaceIfExists="true">
		Select  T1.ReceiptID, T1.ReceiptSeqID, T1.ReceiptType, T1.PaymentTo, T1.PaymentType, T1.PayAgainstID, 
				T1.Amount, T1.FavourNumber , T1.ValueDate , T1.BankCode , T1.FavourName , T1.DepositDate , T1.DepositNo, T1.PaymentRef, 
				T1.TransactionRef , T1.ChequeAcNo , T1.FundingAc , T1.ReceivedDate , T1.Status , T2.BankName BankCodeDesc,
				T3.PartnerBankCode FundingAcCode, T3.PartnerBankName FundingAcDesc, T1.PayOrder, T1.LogKey, T3.AccountNo PartnerBankAc, 
				T3.AcType PartnerBankAcType, T5.FeeTypeCode
				
		From 	FinReceiptDetail_Temp T1 LEFT JOIN 
				BMTBankDetail T2 ON T1.BankCode = T2.BankCode LEFT JOIN 
				PartnerBanks T3 ON T1.FundingAc  = T3.PartnerBankID LEFT JOIN
				ManualAdvise T4 ON T1.PayAgainstID = T4.AdviseID AND T1.PaymentType = 'PAYABLE' LEFT JOIN
				FeeTypes T5 ON T4.FeeTypeId = T5.FeeTypeId
	</createView>
</changeSet>
<changeSet id="3" author="Sriram" >
		<addColumn tableName="Beneficiary">
			<column name="BeneficiaryActive" type="boolean" defaultValue="0"/>
		</addColumn>
		<addColumn tableName="Beneficiary_Temp">
			<column name="BeneficiaryActive" type="boolean" defaultValue="0"/>
		</addColumn>
</changeSet>
<changeSet id="4" author="Sriram">
	<sql>
			UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
			UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS); 

			INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'BeneficiaryDialog_Active','BeneficiaryDialog',0,1000,current_timestamp,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0; 
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='BENEFICIARY_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='BeneficiaryDialog_Active'), 1, 0,1000,current_timestamp,' ',' ',' ',' ',' ',' ',0);

			UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
			UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS); 
	</sql>
</changeSet>
<changeSet id="5" author="Sriram">
	<createView viewName="Beneficiary_View" replaceIfExists="true"> 
 SELECT		T1.BeneficiaryId, T1.CustID, T1.BankBranchID, T1.AccNumber, T1.AccHolderName, T1.PhoneCountryCode, T1.PhoneAreaCode, T1.PhoneNumber, T1.Email		
					, T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId,T1.NextTaskId, T1.RecordType, T1.WorkflowId,
					T2.BankCode, T2.BranchCode,T2.BranchDesc,T2.IFSC, T2.City, T3.BankName, T4.CustCIF, T4.CustShrtName,T1.BeneficiaryActive	 
		FROM    	Beneficiary_Temp T1 INNER JOIN
					BankBranches T2 ON T1.BankBranchID = T2.BankBranchID  INNER JOIN
					BMTBankDetail T3  ON T2.BankCode=T3.BankCode INNER JOIN
					Customers  T4  ON T1.CustID = T4.CustID
		UNION ALL
		
		SELECT		T1.BeneficiaryId, T1.CustID, T1.BankBranchID, T1.AccNumber, T1.AccHolderName, T1.PhoneCountryCode, T1.PhoneAreaCode, T1.PhoneNumber, T1.Email		
					, T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId,T1.NextTaskId, T1.RecordType, T1.WorkflowId,
					T2.BankCode, T2.BranchCode,T2.BranchDesc,T2.IFSC, T2.City, T3.BankName, T4.CustCIF, T4.CustShrtName,T1.BeneficiaryActive		 
		FROM    	Beneficiary T1 INNER JOIN
					BankBranches T2 ON T1.BankBranchID = T2.BankBranchID  INNER JOIN
					BMTBankDetail T3  ON T2.BankCode=T3.BankCode INNER JOIN
					Customers  T4  ON T1.CustID = T4.CustID
		WHERE     NOT EXISTS (SELECT 1 FROM Beneficiary_TEMP WHERE BeneficiaryId = T1.BeneficiaryId)
	</createView>
</changeSet>
<changeSet id="6" author="Sriram">
	<createView viewName="Beneficiary_AView" replaceIfExists="true"> 
		SELECT		T1.BeneficiaryId, T1.CustID, T1.BankBranchID, T1.AccNumber, T1.AccHolderName, T1.PhoneCountryCode, T1.PhoneAreaCode, T1.PhoneNumber, T1.Email		
					, T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId,T1.NextTaskId, T1.RecordType, T1.WorkflowId,
					T2.BankCode, T2.BranchCode,T2.BranchDesc,T2.IFSC, T2.City, T3.BankName, T4.CustCIF, T4.CustShrtName,T1.BeneficiaryActive
		FROM    	Beneficiary T1 INNER JOIN
					BankBranches T2 ON T1.BankBranchID = T2.BankBranchID  INNER JOIN
					BMTBankDetail T3  ON T2.BankCode=T3.BankCode INNER JOIN
					Customers  T4  ON T1.CustID = T4.CustID
	</createView>
</changeSet>
<changeSet id="7" author="Sriram" >
		<sql>
	
			Delete From SecRights Where RIGHTNAME = 'button_BeneficiaryList_NewBeneficiary';
			INSERT INTO SECRIGHTS VALUES((SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 2, 'button_BeneficiaryList_NewBeneficiary','BeneficiaryList',0,1000,current_timestamp,' ',' ',' ',' ',' ',' ',0); 
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE='BENEFICIARY_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='button_BeneficiaryList_NewBeneficiary'), 1, 0,1000,current_timestamp,' ',' ',' ',' ',' ',' ',0);
	
			UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
			UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS); 
		</sql>
	</changeSet>
<changeSet id="8" author="Sriram" >
		<addColumn tableName="Beneficiary">
			<column name="DefaultBeneficiary" type="boolean" defaultValue="0"/>
		</addColumn>
		<addColumn tableName="Beneficiary_Temp">
			<column name="DefaultBeneficiary" type="boolean" defaultValue="0"/>
		</addColumn>
</changeSet>
<changeSet id="9" author="Sriram">
	<sql>
			
			INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'BeneficiaryDialog_DefaultBeneficiary','BeneficiaryDialog',0,1000,current_timestamp,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0; 
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='BENEFICIARY_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='BeneficiaryDialog_DefaultBeneficiary'), 1, 0,1000,current_timestamp,' ',' ',' ',' ',' ',' ',0);

			UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
			UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS); 
	</sql>
</changeSet>
<changeSet id="10" author="Sriram">
	<createView viewName="Beneficiary_View" replaceIfExists="true"> 
		SELECT		T1.BeneficiaryId, T1.CustID, T1.BankBranchID, T1.AccNumber, T1.AccHolderName, T1.PhoneCountryCode, T1.PhoneAreaCode, T1.PhoneNumber, T1.Email		
					, T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId,T1.NextTaskId, T1.RecordType, T1.WorkflowId,
					T2.BankCode, T2.BranchCode,T2.BranchDesc,T2.IFSC, T2.City, T3.BankName, T4.CustCIF, T4.CustShrtName,T1.BeneficiaryActive,T1.DefaultBeneficiary 
		FROM    	Beneficiary_Temp T1 INNER JOIN
					BankBranches T2 ON T1.BankBranchID = T2.BankBranchID  INNER JOIN
					BMTBankDetail T3  ON T2.BankCode=T3.BankCode INNER JOIN
					Customers  T4  ON T1.CustID = T4.CustID
		UNION ALL
		
		SELECT		T1.BeneficiaryId, T1.CustID, T1.BankBranchID, T1.AccNumber, T1.AccHolderName, T1.PhoneCountryCode, T1.PhoneAreaCode, T1.PhoneNumber, T1.Email		
					, T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId,T1.NextTaskId, T1.RecordType, T1.WorkflowId,
					T2.BankCode, T2.BranchCode,T2.BranchDesc,T2.IFSC, T2.City, T3.BankName, T4.CustCIF, T4.CustShrtName,T1.BeneficiaryActive,T1.DefaultBeneficiary 		 
		FROM    	Beneficiary T1 INNER JOIN
					BankBranches T2 ON T1.BankBranchID = T2.BankBranchID  INNER JOIN
					BMTBankDetail T3  ON T2.BankCode=T3.BankCode INNER JOIN
					Customers  T4  ON T1.CustID = T4.CustID
		WHERE     NOT EXISTS (SELECT 1 FROM Beneficiary_TEMP WHERE BeneficiaryId = T1.BeneficiaryId)
	</createView>
</changeSet>
<changeSet id="11" author="Sriram">
	<createView viewName="Beneficiary_AView" replaceIfExists="true"> 
		SELECT		T1.BeneficiaryId, T1.CustID, T1.BankBranchID, T1.AccNumber, T1.AccHolderName, T1.PhoneCountryCode, T1.PhoneAreaCode, T1.PhoneNumber, T1.Email		
					, T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId,T1.NextTaskId, T1.RecordType, T1.WorkflowId,
					T2.BankCode, T2.BranchCode,T2.BranchDesc,T2.IFSC, T2.City, T3.BankName, T4.CustCIF, T4.CustShrtName,T1.BeneficiaryActive,T1.DefaultBeneficiary 
		FROM    	Beneficiary T1 INNER JOIN
					BankBranches T2 ON T1.BankBranchID = T2.BankBranchID  INNER JOIN
					BMTBankDetail T3  ON T2.BankCode=T3.BankCode INNER JOIN
					Customers  T4  ON T1.CustID = T4.CustID
	</createView>
</changeSet>
<changeSet id="12" author="Somasekhar" >
		<addColumn tableName="PRESENTMENTHEADER">
			<column name="BankCode" type="varchar(8)" />
		</addColumn>
		<addColumn tableName="PRESENTMENTHEADER_Temp">
			<column name="BankCode" type="varchar(8)"/>
		</addColumn>
</changeSet>

<changeSet id="13" author="Somasekhar" >
		<createView viewName="PRESENTMENTHEADER_AVIEW" replaceIfExists="true">
			 SELECT		T1.ID, T1.REFERENCE, T1.PRESENTMENTDATE, T1.PARTNERBANKID, T1.FROMDATE, T1.TODATE, T1.STATUS, T1.MANDATETYPE, T1.LOANTYPE, T1.FINBRANCH, T1.SCHDATE	,T1.BANKCODE,
                        T1.VERSION , T1.LASTMNTBY, T1.LASTMNTON,T1.RECORDSTATUS, T1.ROLECODE, T1.NEXTROLECODE, T1.TASKID, T1.NEXTTASKID, T1.RECORDTYPE, T1.WORKFLOWID, 
                        T1.DBSTATUSID, T2.PARTNERBANKNAME, T2.PARTNERBANKCODE, T2.ACCOUNTNO PARTNERACCTNUMBER,T2.ACTYPE PARTNERACCTTYPE,
                        T1.IMPORTSTATUSID, T1.TOTALRECORDS,T1.PROCESSEDRECORDS,T1.SUCCESSRECORDS,T1.FAILEDRECORDS  ,T3.BANKNAME      
            FROM    	PRESENTMENTHEADER  T1 
			LEFT JOIN   PARTNERBANKS T2 ON T1.PARTNERBANKID = T2.PARTNERBANKID
       LEFT JOIN   BMTBANKDETAIL T3 ON T3.BANKCODE = T1.BANKCODE
		
		</createView>
</changeSet>
<changeSet id="14" author="Somasekhar">
		<createView viewName="PRESENTMENTHEADER_VIEW" replaceIfExists="true">
					SELECT		T1.ID, T1.REFERENCE, T1.PRESENTMENTDATE, T1.PARTNERBANKID, T1.FROMDATE, T1.TODATE, T1.STATUS, T1.MANDATETYPE, T1.LOANTYPE, T1.FINBRANCH, T1.SCHDATE	,T1.BANKCODE,
                        T1.VERSION , T1.LASTMNTBY, T1.LASTMNTON,T1.RECORDSTATUS, T1.ROLECODE, T1.NEXTROLECODE, T1.TASKID, T1.NEXTTASKID, T1.RECORDTYPE, T1.WORKFLOWID, 
                        T1.DBSTATUSID, T2.PARTNERBANKNAME, T2.PARTNERBANKCODE, T2.ACCOUNTNO PARTNERACCTNUMBER,T2.ACTYPE PARTNERACCTTYPE,
                        T1.IMPORTSTATUSID, T1.TOTALRECORDS,T1.PROCESSEDRECORDS,T1.SUCCESSRECORDS,T1.FAILEDRECORDS ,T3.BANKNAME    
            FROM    	PRESENTMENTHEADER_Temp  T1 
			LEFT JOIN   PARTNERBANKS T2 ON T1.PARTNERBANKID = T2.PARTNERBANKID
      LEFT JOIN   BMTBANKDETAIL T3 ON T3.BANKCODE = T1.BANKCODE
			UNION ALL
			
			SELECT		T1.ID, T1.REFERENCE, T1.PRESENTMENTDATE, T1.PARTNERBANKID, T1.FROMDATE, T1.TODATE, T1.STATUS, T1.MANDATETYPE, T1.LOANTYPE, T1.FINBRANCH, T1.SCHDATE	,T1.BANKCODE,
                        T1.VERSION , T1.LASTMNTBY, T1.LASTMNTON,T1.RECORDSTATUS, T1.ROLECODE, T1.NEXTROLECODE, T1.TASKID, T1.NEXTTASKID, T1.RECORDTYPE, T1.WORKFLOWID, 
                        T1.DBSTATUSID, T2.PARTNERBANKNAME, T2.PARTNERBANKCODE, T2.ACCOUNTNO PARTNERACCTNUMBER,T2.ACTYPE PARTNERACCTTYPE,
                        T1.IMPORTSTATUSID, T1.TOTALRECORDS,T1.PROCESSEDRECORDS,T1.SUCCESSRECORDS,T1.FAILEDRECORDS ,T3.BANKNAME       
            FROM    	PRESENTMENTHEADER  T1 
			LEFT JOIN   PARTNERBANKS T2 ON T1.PARTNERBANKID = T2.PARTNERBANKID
      LEFT JOIN   BMTBANKDETAIL T3 ON T3.BANKCODE = T1.BANKCODE
			WHERE     NOT EXISTS (SELECT 1 FROM PRESENTMENTHEADER_TEMP WHERE ID = T1.ID)

		</createView>
</changeSet>
<changeSet id="15" author="Jayant" dbms="oracle">
	    <sql splitStatements="false">
	        begin
	        	SP_INVALIDVIEWS;
	        	RESEED_SEQUENCE_TABLES;
	        end;
	    </sql>
</changeSet>
</databaseChangeLog>