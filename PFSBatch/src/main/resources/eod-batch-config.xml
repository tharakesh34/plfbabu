<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:lang="http://www.springframework.org/schema/lang" xsi:schemaLocation="http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang.xsd
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch-3.0.xsd">
	<import resource="launch-context.xml" />
	<import resource="eod-batch-config-db.xml" />
	<import resource="eod-batch-config-beans.xml" />
	<import resource="eod-batch-config-tasklet.xml" />
	<import resource="eod-batch-config-service.xml" />
	<!-- _____________________________________________ JOB FLOW DEFINITION _________________________________________ -->
	<!-- The job definition for the PLF End of Day -->
	<job id="plfEodJob" xmlns="http://www.springframework.org/schema/batch" incrementer="PFSJobParametersIncrementer">
		<listeners>
			<listener ref="eodJobListener" />
		</listeners>
		<step id="beforeEOD">
			<tasklet ref="beforeEODTaskLet" />
			<next on="*" to="prepareCustomerQueue" />
			<fail on="FAILED" />
		</step>
		<step id="prepareCustomerQueue">
			<tasklet ref="prepareCustomerQueueTaskLet" />
			<next on="*" to="masterStep" />
			<fail on="FAILED" />
		</step>

		<step id="masterStep">
			<partition step="microEOD" partitioner="partitioningMaster">
				<handler task-executor="taskExecutor" />
			</partition>
			<next on="*" to="snapShotPreparation" />
			<fail on="FAILED" />
		</step>

		<!-- <step id="threadAllocation"> <tasklet ref="threadAllocationTaskLet" /> <next on="*" to="microEOD" /> <fail on="FAILED" /> </step> <step id="microEOD"> <tasklet allow-start-if-complete="true" ref="microEODTaskLet" > <transaction-attributes propagation="NEVER"/> </tasklet> <next on="*" to="microEODMonitor" /> <fail on="FAILED" /> </step> <step id="microEODMonitor"> <tasklet allow-start-if-complete="true" ref="microEODMonitorTaskLet" /> <next on="*" to="microEODDecision" /> <fail on="FAILED" 
			/> </step> <decision id="microEODDecision" decider="microEODDecider"> <next on="UNKNOWN" to="microEOD" /> <next on="*" to="snapShotPreparation" /> <fail on="FAILED" /> </decision> -->
		<step id="snapShotPreparation">
			<tasklet ref="snapShotPreparationTaskLet" />
			<next on="*" to="completeEOD" />
			<fail on="FAILED" />
		</step>
		<decision id="completeEOD" decider="completeEODDecider">
			<end on="COMPLETED" exit-code="COMPLETED" />
			<fail on="FAILED" />
		</decision>

		<!-- Next Business Date Updation -->
		<!-- <step id="nextBussDateUpdation"> <tasklet ref="nextBussDateUpdationTaskLet" /> <next on="*" to="removeMaintenance" /> <fail on="FAILED" /> </step> -->
		<!-- Value Date Updation -->
		<!-- <step id="valueDateUpdation"> <tasklet ref="valueDateUpdationTasklet" /> <next on="*" to="commencementPostings" /> <fail on="FAILED" /> </step> -->
		<!-- <step id="notification"> <tasklet ref="notificationTasklet" /> <next on="*" to="archiveDocument" /> <fail on="FAILED" /> </step> -->
		<!-- <step id="sendMail"> <tasklet ref="sendMailTaskLet" /> <next on="*" to="snapShotPreparation" /> <fail on="FAILED" /> </step> -->
		<!-- -->
		<!-- Limit Decision For loop -->
		<!-- -->
	</job>
	<step id="microEOD" xmlns="http://www.springframework.org/schema/batch">
		<tasklet ref="microEODTaskLet">
		<transaction-attributes propagation="NEVER"/>	
		</tasklet>
	</step>

	<bean id="taskExecutor" class="org.springframework.core.task.SimpleAsyncTaskExecutor" />
	<bean id="partitioningMaster" class="com.pennant.backend.endofday.tasklet.PartitioningMaster">
		<property name="customerQueuingDAO" ref="customerQueuingDAO" />
	</bean>


</beans>