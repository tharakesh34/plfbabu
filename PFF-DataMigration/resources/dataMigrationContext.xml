<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:tx="http://www.springframework.org/schema/tx" xmlns:p="http://www.springframework.org/schema/p"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		http://www.springframework.org/schema/aop
		http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
		http://www.springframework.org/schema/tx
		http://www.springframework.org/schema/tx/spring-tx-3.0.xsd">

	<!-- Configuration to retrieve values from environment variables or system 
		properties those will be used for cryptography -->
	<bean id="envVariableConfig"
		class="org.jasypt.encryption.pbe.config.EnvironmentStringPBEConfig">
		<property name="algorithm" value="PBEWithMD5AndDES" />
		<property name="passwordEnvName" value="APP_ENCRYPTION_PASSWORD" />
	</bean>

	<!-- Configuration that will be applied for obtaining the encryption key -->
	<bean id="encryptor" class="org.jasypt.encryption.pbe.StandardPBEStringEncryptor">
		<property name="config" ref="envVariableConfig" />
	</bean>

	<!-- Configuration which can make use of a StringEncryptor or TextEncryptor 
		object to decrypt property values if they are encrypted in the loaded resource 
		locations -->
	<bean id="propertyConfig"
		class="org.jasypt.spring.properties.EncryptablePropertyPlaceholderConfigurer">
		<constructor-arg ref="encryptor" />
		<property name="location" value="classpath:data-migration-db.properties" />
	</bean>

	<!-- Basic implementation of javax.sql.DataSource that is configured via 
		JavaBeans properties -->
	<bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource"
		destroy-method="close">
		<property name="driverClassName" value="${pfs.jdbc.driverClassName}" />
		<property name="url" value="${pfs.jdbc.url}" />
		<property name="username" value="${pfs.jdbc.username}" />
		<property name="password" value="${pfs.jdbc.password}" />
	</bean>
	
	<bean id="secDataSource" class="org.apache.commons.dbcp.BasicDataSource">
		<property name="driverClassName" value="${pfs.jdbc.driverClassName}" />
		<property name="url" value="${pfs.jdbc.url}" />
		<property name="username" value="${pfs.jdbc.username}" />
		<property name="password" value="${pfs.jdbc.password}" />
	</bean>
	<bean id="auditDataSource" class="org.apache.commons.dbcp.BasicDataSource">
		<property name="driverClassName" value="${pfs.jdbc.driverClassName}" />
		<property name="url" value="${pfs.jdbc.url}" />
		<property name="username" value="${pfs.jdbc.username}" />
		<property name="password" value="${pfs.jdbc.password}" />
	</bean>
	<bean id="extDataSource" class="org.apache.commons.dbcp.BasicDataSource">
		<property name="driverClassName" value="${pfs.jdbc.driverClassName}" />
		<property name="url" value="${pfs.jdbc.url}" />
		<property name="username" value="${pfs.jdbc.username}" />
		<property name="password" value="${pfs.jdbc.password}" />
	</bean>
	
<!-- Application Transaction Managers -->
	<bean id="secTransactionManager"
		class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource" ref="secDataSource" />
	</bean>
	<bean id="transactionManager"
		class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource" ref="dataSource" />
	</bean>
	<bean id="auditTransactionManager"
		class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource" ref="auditDataSource" />
	</bean>
	<bean id="extTransactionManager"
		class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource" ref="extDataSource" />
	</bean>
	
	<tx:advice id="secServiceTxAdvice" transaction-manager="secTransactionManager">
		<tx:attributes>
			<tx:method name="*" propagation="REQUIRED" />
		</tx:attributes>
	</tx:advice>
	<tx:advice id="serviceTxAdvice" transaction-manager="transactionManager">
		<tx:attributes>
			<tx:method name="*" propagation="REQUIRED" />
		</tx:attributes>
	</tx:advice>
	<tx:advice id="auditServiceTxAdvice" transaction-manager="auditTransactionManager">
		<tx:attributes>
			<tx:method name="*" propagation="REQUIRED" />
		</tx:attributes>
	</tx:advice>
	<tx:advice id="extServiceTxAdvice" transaction-manager="extTransactionManager">
		<tx:attributes>
			<tx:method name="*" propagation="REQUIRED" />
		</tx:attributes>
	</tx:advice>
	
	<!-- The below cross cutting functionality may not required since we are defining the transaction for each service configuration -->
	<aop:config>
		<aop:pointcut id="guiServiceMethods" expression="execution(* com.pennant.gui.service.*.*(..))" />
		<aop:pointcut id="serviceMethods" expression="execution(* com.pennant.backend.service.*.*(..))" />
		<aop:pointcut id="daoMethods" expression="execution(* com.pennant.backend.dao.*.*(..))" />

		<aop:advisor advice-ref="secServiceTxAdvice" pointcut-ref="guiServiceMethods" />
		<aop:advisor advice-ref="secServiceTxAdvice" pointcut-ref="serviceMethods" />
		<aop:advisor advice-ref="serviceTxAdvice" pointcut-ref="guiServiceMethods" />
		<aop:advisor advice-ref="serviceTxAdvice" pointcut-ref="serviceMethods" />
		<aop:advisor advice-ref="auditServiceTxAdvice" pointcut-ref="guiServiceMethods" />
		<aop:advisor advice-ref="auditServiceTxAdvice" pointcut-ref="serviceMethods" />
		<!-- <aop:advisor advice-ref="extServiceTxAdvice" pointcut-ref="guiServiceMethods" />
		<aop:advisor advice-ref="extServiceTxAdvice" pointcut-ref="serviceMethods" />	 -->
	</aop:config>

	<bean id="startDataMigration" class="com.pennant.datamigration.process.StartDataMigration">
	</bean>
	
	<!-- ====================================================== -->
	<!-- Finance Details Configuration -->
	<!-- ====================================================== -->

	<!--============ Finance Details ============== -->

	<bean id="dmFinanceDetailService"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref bean="transactionManager" />
		</property>
		<property name="target">
			<ref bean="dmFinanceDetailServiceTarget" />
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="saveOrUpdate*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
				<prop key="doApprove*">PROPAGATION_REQUIRED</prop>
				<prop key="doReject*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED</prop>
			</props>
		</property>
	</bean>

	<bean name="dmFinanceDetailServiceTarget"
		class="com.pennant.datamigration.service.impl.DMTransactionServiceImpl">
		<property name="financeMainDAO" ref="financeMainDAO" />
		<property name="financeDisbursementDAO" ref="financeDisbursementDAO" />
		<property name="finAdvancePaymentsDAO" ref="finAdvancePaymentsDAO" />
		<property name="financeScheduleDetailDAO" ref="financeScheduleDetailDAO" />
		<property name="finServiceInstructionDAO" ref="finServiceInstructionDAO" />
		<property name="finReceiptHeaderDAO" ref="finReceiptHeaderDAO" />
		<property name="finReceiptDetailDAO" ref="finReceiptDetailDAO" />
		<property name="receiptAllocationDetailDAO" ref="receiptAllocationDetailDAO" />
		<property name="financeRepaymentsDAO" ref="financeRepaymentsDAO" />
		<property name="presentmentDetailDAO" ref="presentmentDetailDAO" />
		<property name="manualAdviseDAO" ref="manualAdviseDAO" />
		<property name="paymentHeaderDAO" ref="paymentHeaderDAO" />
		<property name="paymentDetailDAO" ref="paymentDetailDAO" />
		<property name="paymentInstructionDAO" ref="paymentInstructionDAO" />
		<property name="finODDetailsDAO" ref="finODDetailsDAO" />
		<property name="finODPenaltyRateDAO" ref="finODPenaltyRateDAO" />
		<property name="provisionDAO" ref="provisionDAO" />
		<property name="finFeeDetailDAO" ref="finFeeDetailDAO" />
		<property name="finFeeScheduleDetailDAO" ref="finFeeScheduleDetailDAO" />
		<property name="finPlanEmiHolidayDAO" ref="finPlanEmiHolidayDAO" />
		<property name="mandateDAO" ref="mandateDAO" />
		<property name="finExcessAmountDAO" ref="finExcessAmountDAO" />
		<property name="jountAccountDetailDAO" ref="jountAccountDetailDAO" />
		<property name="guarantorDetailDAO" ref="guarantorDetailDAO" />
		<property name="recoveryDAO" ref="overdueChargeRecoveryDAO" />
		<property name="finStatusDetailDAO" ref="finStatusDetailDAO" />
		<property name="financeSuspHeadDAO" ref="financeSuspHeadDAO" />
		<property name="financeTypeDAO" ref="financeTypeDAO" />
		<property name="repayInstructionDAO" ref="repayInstructionDAO" />
		<property name="basicLoanReconDAO" ref="basicLoanReconDAO" />
		<property name="financeProfitDetailDAO" ref="financeProfitDetailDAO" />
		<property name="postingsDAO" ref="postingsDAO" />
		<property name="latePayMarkingService" ref="latePayMarkingService" />
	</bean>
	
	
	<bean id="dmFinanceDetailFetch"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref bean="transactionManager" />
		</property>
		<property name="target">
			<ref bean="dmFinanceDetailFetchTarget" />
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="saveOrUpdate*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
				<prop key="doApprove*">PROPAGATION_REQUIRED</prop>
				<prop key="doReject*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED</prop>
			</props>
		</property>
	</bean>

	<bean name="dmFinanceDetailFetchTarget"
		class="com.pennant.datamigration.service.impl.DMTransactionFetchImpl">
		<property name="financeMainDAO" ref="financeMainDAO" />
		<property name="financeDisbursementDAO" ref="financeDisbursementDAO" />
		<property name="finAdvancePaymentsDAO" ref="finAdvancePaymentsDAO" />
		<property name="financeScheduleDetailDAO" ref="financeScheduleDetailDAO" />
		<property name="finServiceInstructionDAO" ref="finServiceInstructionDAO" />
		<property name="finReceiptHeaderDAO" ref="finReceiptHeaderDAO" />
		<property name="finReceiptDetailDAO" ref="finReceiptDetailDAO" />
		<property name="receiptAllocationDetailDAO" ref="receiptAllocationDetailDAO" />
		<property name="financeRepaymentsDAO" ref="financeRepaymentsDAO" />
		<property name="presentmentDetailDAO" ref="presentmentDetailDAO" />
		<property name="manualAdviseDAO" ref="manualAdviseDAO" />
		<property name="paymentHeaderDAO" ref="paymentHeaderDAO" />
		<property name="paymentDetailDAO" ref="paymentDetailDAO" />
		<property name="paymentInstructionDAO" ref="paymentInstructionDAO" />
		<property name="finODDetailsDAO" ref="finODDetailsDAO" />
		<property name="finODPenaltyRateDAO" ref="finODPenaltyRateDAO" />
		<property name="provisionDAO" ref="provisionDAO" />
		<property name="finFeeDetailDAO" ref="finFeeDetailDAO" />
		<property name="finFeeScheduleDetailDAO" ref="finFeeScheduleDetailDAO" />
		<property name="finPlanEmiHolidayDAO" ref="finPlanEmiHolidayDAO" />
		<property name="mandateDAO" ref="mandateDAO" />
		<property name="finExcessAmountDAO" ref="finExcessAmountDAO" />
		<property name="jountAccountDetailDAO" ref="jountAccountDetailDAO" />
		<property name="guarantorDetailDAO" ref="guarantorDetailDAO" />
		<property name="recoveryDAO" ref="overdueChargeRecoveryDAO" />
		<property name="finStatusDetailDAO" ref="finStatusDetailDAO" />
		<property name="financeSuspHeadDAO" ref="financeSuspHeadDAO" />
		<property name="financeTypeDAO" ref="financeTypeDAO" />
		<property name="repayInstructionDAO" ref="repayInstructionDAO" />
		<property name="sourceDataSummaryDAO" ref="sourceDataSummaryDAO" />
		<property name="basicLoanReconDAO" ref="basicLoanReconDAO" />
		<property name="customerDAO" ref="customerDAO" />
		<property name="branchDAO" ref="branchDAO" />
		<property name="baseRateCodeDAO" ref="baseRateCodeDAO" />
		<property name="splRateCodeDAO" ref="splRateCodeDAO" />
		<property name="feeTypeDAO" ref="feeTypeDAO" />
	</bean>

	<bean id="financeProfitDetailDAO" class="com.pennant.backend.dao.finance.impl.FinanceProfitDetailDAOImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>
	
	<bean id="postingsDAO" class="com.pennant.backend.dao.rulefactory.impl.PostingsDAOImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>
	
	<bean id="sourceDataSummaryDAO" class="com.pennant.datamigration.dao.impl.SourceDataSummaryDAOImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>
	
	<bean id="basicLoanReconDAO" class="com.pennant.datamigration.dao.impl.BasicLoanReconDAOImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>
	
	<bean id="interfaceDAO" class="com.pennant.corebanking.dao.impl.InterfaceDAOImpl">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="accountDetailProcess"
		class="com.pennant.corebanking.process.impl.AccountDetailProcessImpl">
		<property name="interfaceDAO" ref="interfaceDAO" />
	</bean>

	<bean id="accountDataProcess"
		class="com.pennant.corebanking.process.impl.AccountDataProcessImpl" />

	<bean id="accountPostingProcess"
		class="com.pennant.corebanking.process.impl.AccountPostingProcessImpl">
		<property name="interfaceDAO" ref="interfaceDAO" />
	</bean>

	<bean id="customerDataProcess"
		class="com.pennant.corebanking.process.impl.CustomerDataProcessImpl">
		<property name="interfaceDAO" ref="interfaceDAO" />
	</bean>

	<bean id="customerCreationProcess"
		class="com.pennant.corebanking.process.impl.CustomerCreationProcessImpl">
		<property name="interfaceDAO" ref="interfaceDAO" />
	</bean>

	<bean id="customerLimitProcess"
		class="com.pennant.corebanking.process.impl.CustomerLimitProcessImpl">
		<property name="interfaceDAO" ref="interfaceDAO" />
	</bean>

	<bean id="dateRollOverProcess"
		class="com.pennant.corebanking.process.impl.DateRollOverProcessImpl">
		<property name="interfaceDAO" ref="interfaceDAO" />
	</bean>

	<bean id="dailyDownloadProcess"
		class="com.pennant.corebanking.process.impl.DailyDownloadProcessImpl">
		<property name="interfaceDAO" ref="interfaceDAO" />
	</bean>

	<bean id="financeCancellationProcess"
		class="com.pennant.corebanking.process.impl.FinanceCancellationProcessImpl">
		<property name="interfaceDAO" ref="interfaceDAO" />
	</bean>

	<bean id="uploadProfitDetailProcess"
		class="com.pennant.corebanking.process.impl.UploadProfitDetailProcessImpl">
		<property name="interfaceDAO" ref="interfaceDAO" />
	</bean>

	<bean id="ddaProcess" class="com.pennant.corebanking.process.impl.DDAProcessmpl" />

	<bean id="depositDetailProcess"
		class="com.pennant.corebanking.process.impl.DepositDetailProcessImpl">
	</bean>

	<bean id="hostStatusEnquiryProcess"
		class="com.pennant.corebanking.process.impl.HostStatusEnquiryProcessImpl" />

	<bean id="policeAcceptanceProcess"
		class="com.pennant.corebanking.process.impl.PoliceAcceptanceProcessImpl" />

	<bean id="norkamCheckProcess"
		class="com.pennant.corebanking.process.impl.NorkamCheckProcessImpl" />

	<bean id="financeMaintenanceProcess"
		class="com.pennant.corebanking.process.impl.FinanceMaintenanceProcessImpl" />

	<bean id="chequeVerificationProcess"
		class="com.pennant.corebanking.process.impl.ChequeVerificationProcessImpl" />

	<bean id="nationalBondProcess"
		class="com.pennant.corebanking.process.impl.NationalBondProcessImpl">
		<property name="interfaceDAO" ref="interfaceDAO" />
	</bean>

	<bean id="managerChequeProcess" class="com.pennant.equation.process.ManagerChequeProcess" />
	
</beans>