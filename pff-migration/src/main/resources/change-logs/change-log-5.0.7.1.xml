<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />

	<changeSet id="pre_run_for_pgp" author="Adarsh" runAlways="true"
		dbms="postgresql">
		<sql>
			Set search_path = plf,public,pg_catalog;
		</sql>
	</changeSet>

	<changeSet id="43" author="saikiran.v">
		<createTable tableName="tax_details">
			<column name="id" type="bigint">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="ReferenceId" type="bigint" defaultValue="0">
				<constraints nullable="false" />
			</column>
			<column name="TaxType" type="varchar(8)">
				<constraints nullable="false" />
			</column>
			<column name="TaxPerc" type="Decimal(5,2)" />
			<column name="TaxAmount" type="Decimal(18,0)" />
			<column name="actualTax" type="Decimal(18,0)" />
			<column name="paidTax" type="Decimal(18,0)" />
			<column name="netTax" type="Decimal(18,0)" />
			<column name="remFeeTax" type="Decimal(18,0)" />
			<column name="WaivedTax" type="Decimal(18,0)" />
		</createTable>
	</changeSet>

	<changeSet id="44" author="saikiran.v">
		<createTable tableName="tax_details_temp">
			<column name="id" type="bigint">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="ReferenceId" type="bigint" />
			<column name="TaxType" type="varchar(8)">
				<constraints nullable="false" />
			</column>
			<column name="TaxPerc" type="Decimal(5,2)" />
			<column name="TaxAmount" type="Decimal(18,0)" />
			<column name="actualTax" type="Decimal(18,0)" />
			<column name="paidTax" type="Decimal(18,0)" />
			<column name="netTax" type="Decimal(18,0)" />
			<column name="remFeeTax" type="Decimal(18,0)" />
			<column name="WaivedTax" type="Decimal(18,0)" />
		</createTable>
	</changeSet>

	<changeSet id="44.1" author="Saikiran.v" dbms="mssql">
		<sql>
			<![CDATA[
				ALTER TABLE tax_details_temp ADD CONSTRAINT DF_tax_details_temp_ReferenceId DEFAULT 0 FOR ReferenceId;
			]]>
		</sql>
	</changeSet>

	<changeSet id="44.1" author="Saikiran.v" dbms="postgresql, oracle">
		<addDefaultValue columnName="ReferenceId" tableName="tax_details_temp"
			defaultValue="0" />
	</changeSet>

	<changeSet id="45" author="saikiran.v">
		<createView viewName="tax_details_aview">
			 SELECT t1.id,t1.referenceid, t1.taxtype,  t1.taxperc, t1.actualtax, t1.paidtax, t1.nettax, t1.remfeetax, t1.waivedtax FROM tax_details t1		
		</createView>
	</changeSet>

	<changeSet id="46" author="saikiran.v">
		<createView viewName="tax_details_tview">
			 SELECT t1.id,t1.referenceid, t1.taxtype,  t1.taxperc, t1.actualtax, t1.paidtax, t1.nettax, t1.remfeetax, t1.waivedtax FROM tax_details_temp t1		
		</createView>
	</changeSet>

	<changeSet id="47" author="saikiran.v">
		<createView viewName="tax_details_view">
			 SELECT t1.id,t1.referenceid,t1.taxtype,t1.taxperc,t1.actualtax,t1.paidtax,t1.nettax,t1.remfeetax,t1.waivedtax
   			 FROM tax_details_temp t1
			UNION ALL
			 SELECT t1.id,t1.referenceid,t1.taxtype,t1.taxperc,t1.actualtax,t1.paidtax,t1.nettax,t1.remfeetax,t1.waivedtax
  			 FROM tax_details t1
 			 WHERE NOT (EXISTS ( SELECT 1  FROM tax_details_temp  WHERE tax_details_temp.id = t1.id))
		</createView>
	</changeSet>

	<changeSet id="48" author="saikiran.v">
		<createTable tableName="Tax_Header">
			<column name="headerId" type="bigint">
				<constraints primaryKey="true" nullable="false" />
			</column>
		</createTable>
	</changeSet>

	<changeSet id="49" author="saikiran.v">
		<createTable tableName="Tax_Header_temp">
			<column name="headerId" type="bigint">
				<constraints primaryKey="true" nullable="false" />
			</column>
		</createTable>
	</changeSet>

	<changeSet id="50" author="saikiran.v">
		<createSequence sequenceName="SeqTax_Details" />
		<createSequence sequenceName="SeqTax_Header" />
	</changeSet>

	<changeSet author="saikiran.v" id="63">
		<addColumn tableName="ManualAdviseMovements">
			<column name="taxHeaderId" type="bigint" defaultValue="0">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>

	<changeSet author="saikiran.v" id="64">
		<addColumn tableName="ManualAdviseMovements_temp">
			<column name="taxHeaderId" type="bigint" defaultValue="0">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>

	<changeSet id="65" author="saikiran.v">
		<createView viewName="manualadvisemovements_aview"
			replaceIfExists="true">
			SELECT t1.movementid,t1.adviseid,t1.movementdate,t1.movementamount,t1.paidamount,t1.waivedamount,
    		t1.status, t1.receiptid, t1.receiptseqid, t1.paidcgst, t1.paidsgst, t1.paidigst,t1.paidugst,
    		t2.advisetype, t3.feetypecode,COALESCE(t3.taxapplicable, 0) AS taxapplicable,t3.taxcomponent,
    		t3.feetypedesc,t1.waivedcgst,t1.waivedsgst, t1.waivedugst, t1.waivedigst,t1.taxheaderid
			FROM manualadvisemovements t1
    		JOIN manualadvise t2 ON t1.adviseid = t2.adviseid
    		LEFT JOIN feetypes t3 ON t2.feetypeid = t3.feetypeid
		</createView>
	</changeSet>

	<changeSet id="66" author="saikiran.v">
		<createView viewName="manualadvisemovements_tview"
			replaceIfExists="true">
			SELECT t1.movementid,t1.adviseid,t1.movementdate,t1.movementamount,t1.paidamount,t1.waivedamount,t1.status,t1.receiptid,t1.receiptseqid,
			t1.paidcgst,t1.paidsgst,t1.paidigst,t1.paidugst,t2.advisetype,t3.feetypecode,COALESCE(t3.taxapplicable, 0) AS taxapplicable,
			t3.taxcomponent,t3.feetypedesc,t1.waivedcgst,t1.waivedsgst,t1.waivedugst,t1.waivedigst,t1.taxheaderid
  			FROM manualadvisemovements_temp t1 
  			JOIN manualadvise t2 ON t1.adviseid = t2.adviseid 
  			LEFT JOIN feetypes t3 ON t2.feetypeid = t3.feetypeid
		</createView>
	</changeSet>

	<changeSet id="75" author="saikiran.v">
		<dropColumn tableName="tax_details_temp" columnName="TaxAmount" />
	</changeSet>
	<changeSet id="76" author="saikiran.v">
		<dropColumn tableName="tax_details" columnName="TaxAmount" />
	</changeSet>

	<changeSet id="77" author="saikiran.v">
		<addColumn tableName="Tax_Header">
			<column name="version" type="int" />
			<column name="lastmntby" type="bigint" />
			<column name="lastmnton" type="datetime" />
			<column name="recordstatus" type="varchar(50)" />
			<column name="rolecode" type="varchar(100)" />
			<column name="nextrolecode" type="varchar(200)" />
			<column name="taskid" type="varchar(50)" />
			<column name="nexttaskid" type="varchar(200)" />
			<column name="recordtype" type="varchar(50)" />
			<column name="workflowid" type="bigint" />
		</addColumn>
	</changeSet>

	<changeSet id="78" author="saikiran.v">
		<addColumn tableName="Tax_Header_temp">
			<column name="version" type="int" />
			<column name="lastmntby" type="bigint" />
			<column name="lastmnton" type="datetime" />
			<column name="recordstatus" type="varchar(50)" />
			<column name="rolecode" type="varchar(100)" />
			<column name="nextrolecode" type="varchar(200)" />
			<column name="taskid" type="varchar(50)" />
			<column name="nexttaskid" type="varchar(200)" />
			<column name="recordtype" type="varchar(50)" />
			<column name="workflowid" type="bigint" />
		</addColumn>
	</changeSet>

	<changeSet id="79" author="saikiran.v">
		<addColumn tableName="Tax_details">
			<column name="version" type="int" />
			<column name="lastmntby" type="bigint" />
			<column name="lastmnton" type="datetime" />
			<column name="recordstatus" type="varchar(50)" />
			<column name="rolecode" type="varchar(100)" />
			<column name="nextrolecode" type="varchar(200)" />
			<column name="taskid" type="varchar(50)" />
			<column name="nexttaskid" type="varchar(200)" />
			<column name="recordtype" type="varchar(50)" />
			<column name="workflowid" type="bigint" />
		</addColumn>
	</changeSet>

	<changeSet id="80" author="saikiran.v">
		<addColumn tableName="Tax_details_temp">
			<column name="version" type="int" />
			<column name="lastmntby" type="bigint" />
			<column name="lastmnton" type="datetime" />
			<column name="recordstatus" type="varchar(50)" />
			<column name="rolecode" type="varchar(100)" />
			<column name="nextrolecode" type="varchar(200)" />
			<column name="taskid" type="varchar(50)" />
			<column name="nexttaskid" type="varchar(200)" />
			<column name="recordtype" type="varchar(50)" />
			<column name="workflowid" type="bigint" />
		</addColumn>
	</changeSet>

	<changeSet id="81" author="saikiran.v">
		<createView viewName="tax_details_aview" replaceIfExists="true">
			 SELECT t1.id,t1.referenceid, t1.taxtype,  t1.taxperc, t1.actualtax, t1.paidtax, t1.nettax, t1.remfeetax, t1.waivedtax,
			 t1.version,t1.lastMntOn, t1.lastMntBy,t1.recordStatus, t1.roleCode, t1.nextRoleCode, t1.taskId, t1.nextTaskId, t1.recordType, t1.workflowId
			 FROM tax_details t1		
		</createView>
	</changeSet>

	<changeSet id="82" author="saikiran.v">
		<createView viewName="tax_details_tview" replaceIfExists="true">
			 SELECT t1.id,t1.referenceid, t1.taxtype,  t1.taxperc, t1.actualtax, t1.paidtax, t1.nettax, t1.remfeetax, t1.waivedtax,
			 t1.version,t1.lastMntOn, t1.lastMntBy,t1.recordStatus, t1.roleCode, t1.nextRoleCode, t1.taskId, t1.nextTaskId, t1.recordType, t1.workflowId
			 FROM tax_details_temp t1		
		</createView>
	</changeSet>

	<changeSet id="83" author="saikiran.v">
		<createView viewName="tax_details_view" replaceIfExists="true">
			 SELECT t1.id,t1.referenceid,t1.taxtype,t1.taxperc,t1.actualtax,t1.paidtax,t1.nettax,t1.remfeetax,t1.waivedtax,
			 t1.version,t1.lastMntOn, t1.lastMntBy,t1.recordStatus, t1.roleCode, t1.nextRoleCode, t1.taskId, t1.nextTaskId, t1.recordType, t1.workflowId
   			 FROM tax_details_temp t1
			UNION ALL
			 SELECT t1.id,t1.referenceid,t1.taxtype,t1.taxperc,t1.actualtax,t1.paidtax,t1.nettax,t1.remfeetax,t1.waivedtax,
			 t1.version,t1.lastMntOn, t1.lastMntBy,t1.recordStatus, t1.roleCode, t1.nextRoleCode, t1.taskId, t1.nextTaskId, t1.recordType, t1.workflowId
  			 FROM tax_details t1
 			 WHERE NOT (EXISTS ( SELECT 1  FROM tax_details_temp  WHERE tax_details_temp.id = t1.id))
		</createView>
	</changeSet>

	<changeSet id="84" author="saikiran.v">
		<createView viewName="tax_header_aview" replaceIfExists="true">
			 SELECT t1.headerId, t1.version,t1.lastMntOn, t1.lastMntBy,t1.recordStatus, t1.roleCode, t1.nextRoleCode, t1.taskId, t1.nextTaskId, t1.recordType, t1.workflowId
			 FROM tax_header t1		
		</createView>
	</changeSet>

	<changeSet id="85" author="saikiran.v">
		<createView viewName="tax_header_tview" replaceIfExists="true">
			 SELECT t1.headerId, t1.version,t1.lastMntOn, t1.lastMntBy,t1.recordStatus, t1.roleCode, t1.nextRoleCode, t1.taskId, t1.nextTaskId, t1.recordType, t1.workflowId
			 FROM tax_header_temp t1		
		</createView>
	</changeSet>

	<changeSet id="86" author="saikiran.v">
		<createView viewName="tax_header_view" replaceIfExists="true">
			 SELECT t1.headerId, t1.version,t1.lastMntOn, t1.lastMntBy,t1.recordStatus, t1.roleCode, t1.nextRoleCode, t1.taskId, t1.nextTaskId, t1.recordType, t1.workflowId
   			 FROM tax_header_temp t1
			UNION ALL
			 SELECT t1.headerId, t1.version,t1.lastMntOn, t1.lastMntBy,t1.recordStatus, t1.roleCode, t1.nextRoleCode, t1.taskId, t1.nextTaskId, t1.recordType, t1.workflowId
  			 FROM tax_header t1
 			 WHERE NOT (EXISTS ( SELECT 1  FROM tax_header_temp  WHERE tax_header_temp.headerId = t1.headerId))
		</createView>
	</changeSet>

	<changeSet id="87" author="saikiran.v">
		<sql>
			update Tax_Header set workflowid=0 where workflowid is null;
			update Tax_Header_temp set workflowid=0 where workflowid is null;
			update Tax_details set workflowid=0 where workflowid is null;
			update
			Tax_details_temp set
			workflowid=0 where workflowid is null;
		</sql>
	</changeSet>

	<changeSet id="88" author="saikiran.v">
		<addNotNullConstraint tableName="Tax_Header"
			columnName="workflowid" columnDataType="bigint" />
		<addNotNullConstraint tableName="Tax_Header_temp"
			columnName="workflowid" columnDataType="bigint" />
		<addNotNullConstraint tableName="Tax_details"
			columnName="workflowid" columnDataType="bigint" />
		<addNotNullConstraint tableName="Tax_details_temp"
			columnName="workflowid" columnDataType="bigint" />
	</changeSet>

	<changeSet id="78" author="Durgaprasad.g">
		<addColumn tableName="FEEWAIVERDETAILS">
			<column name="WaiverType" type="char(1)" />
		</addColumn>
	</changeSet>

	<changeSet id="79" author="Durgaprasad.g">
		<addColumn tableName="FEEWAIVERDETAILS_Temp">
			<column name="WaiverType" type="char(1)" />
		</addColumn>
	</changeSet>

	<changeSet author="Kesav" id="80">
		<addColumn tableName="FEEWAIVERDETAILS">
			<column name="TaxHeaderId" type="bigint" defaultValue="0">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>

	<changeSet author="Kesav" id="81">
		<addColumn tableName="FEEWAIVERDETAILS_Temp">
			<column name="TaxHeaderId" type="bigint" defaultValue="0">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>

	<changeSet author="Kesav" id="82">
		<addColumn tableName="FEEWAIVERDETAILS">
			<column name="ActualReceivable" type="decimal(18,0)"
				defaultValue="0">
				<constraints nullable="false" />
			</column>
			<column name="ReceivableGST" type="decimal(18,0)"
				defaultValue="0">
				<constraints nullable="false" />
			</column>
			<column name="CurrActualWaiver" type="decimal(18,0)"
				defaultValue="0">
				<constraints nullable="false" />
			</column>
			<column name="CurrWaiverGST" type="decimal(18,0)"
				defaultValue="0">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>

	<changeSet author="Kesav" id="83">
		<addColumn tableName="FEEWAIVERDETAILS_Temp">
			<column name="ActualReceivable" type="decimal(18,0)"
				defaultValue="0">
				<constraints nullable="false" />
			</column>
			<column name="ReceivableGST" type="decimal(18,0)"
				defaultValue="0">
				<constraints nullable="false" />
			</column>
			<column name="CurrActualWaiver" type="decimal(18,0)"
				defaultValue="0">
				<constraints nullable="false" />
			</column>
			<column name="CurrWaiverGST" type="decimal(18,0)"
				defaultValue="0">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>

	<changeSet id="84" author="Kesav">
		<addColumn tableName="FEEWAIVERDETAILS">
			<column name="TaxApplicable" type="boolean" defaultValue="0">
				<constraints nullable="false" />
			</column>
			<column name="TaxComponent" type="Char(1)" />
		</addColumn>
	</changeSet>

	<changeSet id="85" author="Kesav">
		<addColumn tableName="FEEWAIVERDETAILS_Temp">
			<column name="TaxApplicable" type="boolean" defaultValue="0">
				<constraints nullable="false" />
			</column>
			<column name="TaxComponent" type="Char(1)" />
		</addColumn>
	</changeSet>

	<changeSet id="86" author="Kesav">
		<sql>
		 	<![CDATA[
			    delete from SMTPARAMETERS where sysparmcode='ALLOW_PROFIT_WAIVER';
				INSERT INTO SMTPARAMETERS Values('ALLOW_PROFIT_WAIVER','Allow Profit Waiver','String', 0, 'N', 1, 0, NULL, NULL,'Allow Profit Waiver', 1, 1000,CURRENT_TIMESTAMP,'Approved', NULL, NULL, NULL, NULL, NULL, 0);
			]]>
		</sql>
	</changeSet>

	<changeSet id="87" author="Kesav">
		<comment>Waiver Accounting Configuration</comment>
		<sql>
			<![CDATA[
				Delete from BMTAMOUNTCODES Where AllowedEvent = 'WAIVER';
				Delete from BMTAEEvents Where AEEVENTCODE = 'WAIVER';
				
				Insert into BMTAEEVENTS values ('WAIVER','Waiver',1,1000,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,1,1, 1, 1);
				Insert into BMTAMOUNTCODES values('WAIVER',0,'ae_pftWaiver','Interest waiver amount','1',1,1000,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
				
				Insert into BMTAMOUNTCODES values('WAIVER',0,'LPP_CGST_W','Penalty charge CGST Waived',1,1,1000,Current_TimeStamp,'Approved',null,null,null,null,null,0);
				Insert into BMTAMOUNTCODES values('WAIVER',0,'LPP_SGST_W','Penalty charge SGST Waived',1,1,1000,Current_TimeStamp,'Approved',null,null,null,null,null,0);
				Insert into BMTAMOUNTCODES values('WAIVER',0,'LPP_IGST_W','Penalty charge IGST Waived',1,1,1000,Current_TimeStamp,'Approved',null,null,null,null,null,0);
				Insert into BMTAMOUNTCODES values('WAIVER',0,'LPP_UGST_W','Penalty charge UGST Waived',1,1,1000,Current_TimeStamp,'Approved',null,null,null,null,null,0);
				Insert into BMTAMOUNTCODES values('WAIVER',0,'ae_penaltyWaived','Penalty Waived',1,1,1000,Current_TimeStamp,'Approved',null,null,null,null,null,0);
				
				Insert into BMTAMOUNTCODES values('WAIVER',0,'bounceCharge_CGST_W','Bounce charge CGST Waived',1,1,1000,Current_TimeStamp,'Approved',null,null,null,null,null,0);
				Insert into BMTAMOUNTCODES values('WAIVER',0,'bounceCharge_SGST_W','Bounce charge SGST Waived',1,1,1000,Current_TimeStamp,'Approved',null,null,null,null,null,0);
				Insert into BMTAMOUNTCODES values('WAIVER',0,'bounceCharge_IGST_W','Bounce charge IGST Waived',1,1,1000,Current_TimeStamp,'Approved',null,null,null,null,null,0);
				Insert into BMTAMOUNTCODES values('WAIVER',0,'bounceCharge_UGST_W','Bounce charge UGST Waived',1,1,1000,Current_TimeStamp,'Approved',null,null,null,null,null,0);
				Insert into BMTAMOUNTCODES values('WAIVER',0,'bounceChargeWaived','Bounce charges Waived',1,1,1000,Current_TimeStamp,'Approved',null,null,null,null,null,0);
			]]>
		</sql>
	</changeSet>

	<changeSet id="89" author="Durgaprasad.G">
		<addColumn tableName="Finscheduledetails">
			<column name="SchdPftWaiver" type="decimal(18,0)"
				defaultValue="0">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>

	<changeSet id="90" author="Durgaprasad.G">
		<addColumn tableName="Finscheduledetails_TEMP">
			<column name="SchdPftWaiver" type="decimal(18,0)"
				defaultValue="0">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>

	<changeSet id="91" author="Durgaprasad.G">
		<addColumn tableName="FINSCHEDULEDETAILS_PA">
			<column name="SchdPftWaiver" type="decimal(18,0)"
				defaultValue="0">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>

	<changeSet id="92" author="Durgaprasad.G">
		<addColumn tableName="FINSCHEDULEDETAILS_LOG">
			<column name="SchdPftWaiver" type="decimal(18,0)"
				defaultValue="0">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>

	<changeSet id="93" author="Durgaprasad.G">
		<createView viewName="FINSCHEDULEDETAILS_AVIEW"
			replaceIfExists="true">
			SELECT t1.finreference,
						t1.schseq,
						t1.schdate,
						t1.pftonschdate,
						t1.repayonschdate,
						t1.cpzonschdate,
						t1.rvwonschdate,
						t1.disbonschdate,
						t1.downpaymentonschdate,
						t1.balanceforpftcal,
						t1.baserate,
						t1.splrate,
						t1.actrate,
						t1.noofdays,
						t1.dayfactor,
						t1.profitcalc,
						t1.profitschd,
						t1.principalschd,
						t1.repayamount,
						t1.profitbalance,
						t1.disbamount,
						t1.cpzamount,
						t1.downpaymentamount,
						t1.closingbalance,
						t1.profitfraction,
						t1.prvrepayamount,
						t1.schdpftpaid,
						t1.schpftpaid,
						t1.schdpripaid,
						t1.schpripaid,
						t1.specifier,
						t1.defschddate,
						t1.schdmethod,
						t1.mrgrate,
						t1.calonindrate,
						t1.feechargeamt,
						t1.calculatedrate,
						t1.earlypaidbal,
						t1.earlypaid,
						t1.refundorwaiver,
						t1.writeoffprincipal,
						t1.writeoffprofit,
						t1.orgpft,
						t1.orgpri,
						t1.orgendbal,
						t1.orgplanpft,
						t1.feeschd,
						t1.schdfeepaid,
						t1.schdfeeos,
						t1.insschd,
						t1.schdinspaid,
						t1.advpftrate,
						t1.advprofit,
						t1.advrepayamount,
						t1.advbaserate,
						t1.advmargin,
						t1.advcalrate,
						t1.suplrent,
						t1.incrcost,
						t1.suplrentpaid,
						t1.incrcostpaid,
						t1.rolloveronschdate,
						t1.rolloveramount,
						t1.rolloveramountpaid,
						t1.tdsamount,
						t1.tdspaid,
						t1.pftdaysbasis,
						t1.writeoffins,
						t1.writeoffincrcost,
						t1.writeoffsuplrent,
						t1.writeoffschfee,
						t1.insuranceamt,
						t1.instnumber,
						t1.bpiorholiday,
						t1.frqdate,
						t1.presentmentid,
						t1.partialpaidamt,
						t1.feetax,
						t1.recallock,
						t1.tdsApplicable,
						t1.schdPftWaiver
				FROM finscheduledetails t1
		</createView>
	</changeSet>

	<changeSet id="94" author="Durgaprasad G">
		<createView viewName="FINSCHEDULEDETAILS_VIEW"
			replaceIfExists="true">
			  SELECT t1.finreference,
								t1.schseq,
								t1.schdate,
								t1.pftonschdate,
								t1.repayonschdate,
								t1.cpzonschdate,
								t1.rvwonschdate,
								t1.disbonschdate,
								t1.downpaymentonschdate,
								t1.balanceforpftcal,
								t1.baserate,
								t1.splrate,
								t1.actrate,
								t1.noofdays,
								t1.dayfactor,
								t1.profitcalc,
								t1.profitschd,
								t1.principalschd,
								t1.repayamount,
								t1.profitbalance,
								t1.disbamount,
								t1.cpzamount,
								t1.downpaymentamount,
								t1.closingbalance,
								t1.profitfraction,
								t1.prvrepayamount,
								t1.schdpftpaid,
								t1.schpftpaid,
								t1.schdpripaid,
								t1.schpripaid,
								t1.specifier,
								t1.defschddate,
								t1.schdmethod,
								t1.mrgrate,
								t1.calonindrate,
								t1.feechargeamt,
								t1.calculatedrate,
								t1.earlypaidbal,
								t1.earlypaid,
								t1.refundorwaiver,
								t1.writeoffprincipal,
								t1.writeoffprofit,
								t1.orgpft,
								t1.orgpri,
								t1.orgendbal,
								t1.orgplanpft,
								t1.feeschd,
								t1.schdfeepaid,
								t1.schdfeeos,
								t1.insschd,
								t1.schdinspaid,
								t1.advpftrate,
								t1.advprofit,
								t1.advrepayamount,
								t1.advbaserate,
								t1.advmargin,
								t1.advcalrate,
								t1.suplrent,
								t1.incrcost,
								t1.suplrentpaid,
								t1.incrcostpaid,
								t1.rolloveronschdate,
								t1.rolloveramount,
								t1.rolloveramountpaid,
								t1.tdsamount,
								t1.tdspaid,
								t1.pftdaysbasis,
								t1.writeoffins,
								t1.writeoffincrcost,
								t1.writeoffsuplrent,
								t1.writeoffschfee,
								t1.insuranceamt,
								t1.instnumber,
								t1.bpiorholiday,
								t1.frqdate,
								t1.presentmentid,
								t1.partialpaidamt,
								t1.feetax,
								t1.recallock,
								t1.tdsApplicable,
								t1.schdPftWaiver
							   FROM finscheduledetails_temp t1
							UNION ALL
							 SELECT t1.finreference,
								t1.schseq,
								t1.schdate,
								t1.pftonschdate,
								t1.repayonschdate,
								t1.cpzonschdate,
								t1.rvwonschdate,
								t1.disbonschdate,
								t1.downpaymentonschdate,
								t1.balanceforpftcal,
								t1.baserate,
								t1.splrate,
								t1.actrate,
								t1.noofdays,
								t1.dayfactor,
								t1.profitcalc,
								t1.profitschd,
								t1.principalschd,
								t1.repayamount,
								t1.profitbalance,
								t1.disbamount,
								t1.cpzamount,
								t1.downpaymentamount,
								t1.closingbalance,
								t1.profitfraction,
								t1.prvrepayamount,
								t1.schdpftpaid,
								t1.schpftpaid,
								t1.schdpripaid,
								t1.schpripaid,
								t1.specifier,
								t1.defschddate,
								t1.schdmethod,
								t1.mrgrate,
								t1.calonindrate,
								t1.feechargeamt,
								t1.calculatedrate,
								t1.earlypaidbal,
								t1.earlypaid,
								t1.refundorwaiver,
								t1.writeoffprincipal,
								t1.writeoffprofit,
								t1.orgpft,
								t1.orgpri,
								t1.orgendbal,
								t1.orgplanpft,
								t1.feeschd,
								t1.schdfeepaid,
								t1.schdfeeos,
								t1.insschd,
								t1.schdinspaid,
								t1.advpftrate,
								t1.advprofit,
								t1.advrepayamount,
								t1.advbaserate,
								t1.advmargin,
								t1.advcalrate,
								t1.suplrent,
								t1.incrcost,
								t1.suplrentpaid,
								t1.incrcostpaid,
								t1.rolloveronschdate,
								t1.rolloveramount,
								t1.rolloveramountpaid,
								t1.tdsamount,
								t1.tdspaid,
								t1.pftdaysbasis,
								t1.writeoffins,
								t1.writeoffincrcost,
								t1.writeoffsuplrent,
								t1.writeoffschfee,
								t1.insuranceamt,
								t1.instnumber,
								t1.bpiorholiday,
								t1.frqdate,
								t1.presentmentid,
								t1.partialpaidamt,
								t1.feetax,
								t1.recallock,
								t1.tdsApplicable,
								t1.schdPftWaiver
							   FROM finscheduledetails t1
							  WHERE NOT (EXISTS ( SELECT 1
									   FROM finscheduledetails_temp
									  WHERE finscheduledetails_temp.finreference = t1.finreference))
	
	</createView>
	</changeSet>

	<changeSet id="95" author="Durgaprasad.G">
		<createView viewName="FINSCHEDULEDETAILS_TVIEW"
			replaceIfExists="true">
			  SELECT t1.finreference,
						t1.schseq,
						t1.schdate,
						t1.pftonschdate,
						t1.repayonschdate,
						t1.cpzonschdate,
						t1.rvwonschdate,
						t1.disbonschdate,
						t1.downpaymentonschdate,
						t1.balanceforpftcal,
						t1.baserate,
						t1.splrate,
						t1.actrate,
						t1.noofdays,
						t1.dayfactor,
						t1.profitcalc,
						t1.profitschd,
						t1.principalschd,
						t1.repayamount,
						t1.profitbalance,
						t1.disbamount,
						t1.cpzamount,
						t1.downpaymentamount,
						t1.closingbalance,
						t1.profitfraction,
						t1.prvrepayamount,
						t1.schdpftpaid,
						t1.schpftpaid,
						t1.schdpripaid,
						t1.schpripaid,
						t1.specifier,
						t1.defschddate,
						t1.schdmethod,
						t1.mrgrate,
						t1.calonindrate,
						t1.feechargeamt,
						t1.calculatedrate,
						t1.earlypaidbal,
						t1.earlypaid,
						t1.refundorwaiver,
						t1.writeoffprincipal,
						t1.writeoffprofit,
						t1.orgpft,
						t1.orgpri,
						t1.orgendbal,
						t1.orgplanpft,
						t1.feeschd,
						t1.schdfeepaid,
						t1.schdfeeos,
						t1.insschd,
						t1.schdinspaid,
						t1.advpftrate,
						t1.advprofit,
						t1.advrepayamount,
						t1.advbaserate,
						t1.advmargin,
						t1.advcalrate,
						t1.suplrent,
						t1.incrcost,
						t1.suplrentpaid,
						t1.incrcostpaid,
						t1.rolloveronschdate,
						t1.rolloveramount,
						t1.rolloveramountpaid,
						t1.tdsamount,
						t1.tdspaid,
						t1.pftdaysbasis,
						t1.writeoffins,
						t1.writeoffincrcost,
						t1.writeoffsuplrent,
						t1.writeoffschfee,
						t1.insuranceamt,
						t1.instnumber,
						t1.bpiorholiday,
						t1.frqdate,
						t1.presentmentid,
						t1.partialpaidamt,
						t1.feetax,
						t1.recallock,
						t1.tdsApplicable,
						t1.schdPftWaiver
            FROM finscheduledetails_temp t1
	  </createView>
	</changeSet>

	<changeSet id="96" author="Durgaprasad G">
		<addColumn tableName="FINREPAYDETAILS">
			<column name="WaiverId" type="bigint" defaultValue="0">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>

	<changeSet id="97" author="Durgaprasad G">
		<addColumn tableName="FinRepayscheduledetail">
			<column name="WaiverId" type="bigint" defaultValue="0">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>

</databaseChangeLog>