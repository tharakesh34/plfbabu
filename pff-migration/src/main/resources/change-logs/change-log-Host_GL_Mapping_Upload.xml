<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value="" dbms="oracle" />
	<property name="add.schema" value="" dbms="postgresql" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PLFAVANSEQC.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()" dbms="postgresql" />

	<changeSet id="pre_run_for_pgp" author="Gopal.p" runAlways="true" dbms="postgresql">
		<sql>
			Set search_path = plf,public,pg_catalog;
		</sql>
	</changeSet>
	
	 <changeSet id="ST#840.1" author="sainaveen.y">
		<createTable tableName="HOST_GL_UPLOAD">
			<column name="Id" type="bigint" autoIncrement="true">
				<constraints nullable="false" />
			</column>
			<column name="HeaderID" type="bigint" />
			<column name="RecordSeq" type="bigint" />
			<column name="HostGLCode" type="varchar(20)"/>
			<column name="AccountType" type="varchar(15)" />
			<column name="LoanType" type="varchar(8)" />
			<column name="CostCentreCode" type="varchar(20)" />
			<column name="ProfitCentreCode" type="varchar(20)" />
			<column name="OpenedDate" type="datetime" />
			<column name="AllowManualEntries" type="char(1)" />
			<column name="GLDescription" type="varchar(50)" />
			<column name="Progress" type="int" />
			<column name="Status" type="char(1)" />
			<column name="ErrorCode" type="varchar(20)" />
			<column name="ErrorDesc" type="varchar(2000)" />
			</createTable>
	</changeSet>

	<changeSet id="ST#840.2" author="sainaveen.y">
		<addPrimaryKey constraintName="PK_HOST_GL_UPLOAD_ID" tableName="HOST_GL_UPLOAD" columnNames="id" />
	</changeSet>
	
	<changeSet id="ST#840.3" author="sainaveen.y">
		<sql>
			<![CDATA[
				DELETE FROM DATA_ENGINE_LOG WHERE STATUSID IN (SELECT ID FROM DATA_ENGINE_STATUS WHERE NAME ='HOST_GL_UPLOAD');
 				DELETE FROM DATA_ENGINE_DOWNLOAD_HISTORY WHERE ID IN (SELECT ID FROM DATA_ENGINE_STATUS WHERE NAME ='HOST_GL_UPLOAD');
 				DELETE FROM DATA_ENGINE_STATUS WHERE NAME ='HOST_GL_UPLOAD';
 				
				DELETE FROM DATA_ENGINE_COLUMN WHERE TABLEID IN (SELECT ID FROM DATA_ENGINE_TABLE WHERE CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_UPLOAD'));
				DELETE FROM DATA_ENGINE_TABLE WHERE CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_UPLOAD');
				DELETE FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_UPLOAD';

				INSERT INTO DATA_ENGINE_CONFIG (ID, NAME, DESCRIPTION, PARSER, WORKSHEET, TEXTQUALIFIER, ROWDELIMITER, COLUMNDELIMITER, STARTINGROW, SKIPHEADERROW, FIELDNAMES, HEADER, TRAILER, UPLOADLOCATION, UPLOADPATH, FILEPREFIXNAME, FILEEXTENSION, FILESEQUENCENO, LASTPROCESSEDON, FILENAMEFORMAT, CRONEXPRESSION, NOTIFICATIONSTATUSEMAIL, POSTEVENT, BACKUPFILE, ACTIVE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_CONFIG), 'HOST_GL_UPLOAD', 'Host GL Upload File.', 12, 'HOSTGL', null, null, ',', 0, 1, null, 'ROW:{Host GL Code, Account Type, Loan Type, Cost Centre, Profit Centre, Opened Date, Allow Manual Entries, GL Description}', null, 'C', '/opt/PFF/BASE/hdfc/HostGL/upload', 'HostGL_', '.xlsx', 0, CURRENT_TIMESTAMP, '${ddmm},.${SEQ_DATE_FILE}', null, '0', NULL, 1, 1);

				INSERT INTO DATA_ENGINE_TABLE (ID, CONFIGID, NAME, OPERATION, KEYFIELDS, FILTER, STATUSUPDATE, SKIPROWS, IDENTIFIER, DESCRIPTION, STARTINDEX, ENDINDEX, RECORDLENGTH, MULTIROW, HEADERTABLE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_TABLE), (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_UPLOAD'), 'HOST_GL_UPLOAD', 1, 'ID', NULL, NULL, NULL, NULL, NULL, NULL, NULL, 8, 0, 0);
								
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_UPLOAD')),  'ID',  				    1, 'N', NULL, NULL, NULL, NULL, '0',  NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_UPLOAD')),  'HEADERID',     		    0, 'N', NULL, NULL, '${HEADER_ID}',   NULL, '0', NULL, NULL, NULL, NULL, 'M');								
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_UPLOAD')),  'HOSTGLCODE',      		0, 'N', NULL, NULL, NULL, NULL, '0',  NULL, NULL, NULL, NULL, 'M');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_UPLOAD')),  'ACCOUNTTYPE',           0, 'N', NULL, NULL, NULL, NULL, '1',  NULL, NULL, NULL, NULL, 'M');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_UPLOAD')),  'LOANTYPE',      		0, 'N', NULL, NULL, NULL, NULL, '2',  NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_UPLOAD')),  'COSTCENTRECODE',      	0, 'N', NULL, NULL, NULL, NULL, '3',  NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_UPLOAD')),  'PROFITCENTRECODE',      0, 'N', NULL, NULL, NULL, NULL, '4',  NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_UPLOAD')),  'OPENEDDATE',      		0, 'N', NULL, NULL, NULL, NULL, '5',  NULL, NULL, NULL, 'dd-MMM-yyyy', 'M');
			    INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_UPLOAD')),  'ALLOWMANUALENTRIES',    0, 'N', NULL, NULL, NULL, NULL, '6',  NULL, NULL, NULL, NULL, 'M');
			    INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_UPLOAD')),  'GLDESCRIPTION',         0, 'N', NULL, NULL, NULL, NULL, '7',  NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_UPLOAD')),  'STATUS',                0, 'N', NULL, 'S', NULL, NULL,  '8',  NULL, NULL, NULL, NULL, 'O');
				]]>
		 </sql>
	</changeSet>
	
	<changeSet id="ST#840.4" author="sainaveen.y">
		<sql>
			<![CDATA[
				DELETE FROM DATA_ENGINE_LOG WHERE STATUSID IN (SELECT ID FROM DATA_ENGINE_STATUS WHERE NAME ='HOST_GL_TEMPLATE');
 				DELETE FROM DATA_ENGINE_DOWNLOAD_HISTORY WHERE ID IN (SELECT ID FROM DATA_ENGINE_STATUS WHERE NAME ='HOST_GL_TEMPLATE');
 				DELETE FROM DATA_ENGINE_STATUS WHERE NAME ='HOST_GL_TEMPLATE';
 				
				DELETE FROM DATA_ENGINE_COLUMN WHERE TABLEID IN (SELECT ID FROM DATA_ENGINE_TABLE WHERE CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_TEMPLATE'));
				DELETE FROM DATA_ENGINE_TABLE WHERE CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_TEMPLATE');
				DELETE FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_TEMPLATE';

				INSERT INTO DATA_ENGINE_CONFIG (ID, NAME, DESCRIPTION, PARSER, WORKSHEET, TEXTQUALIFIER, ROWDELIMITER, COLUMNDELIMITER, STARTINGROW, SKIPHEADERROW, FIELDNAMES, HEADER, TRAILER, UPLOADLOCATION, UPLOADPATH, FILEPREFIXNAME, FILEEXTENSION, FILESEQUENCENO, LASTPROCESSEDON, FILENAMEFORMAT, CRONEXPRESSION, NOTIFICATIONSTATUSEMAIL, POSTEVENT, BACKUPFILE, ACTIVE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_CONFIG), 'HOST_GL_TEMPLATE', 'Host GL Template Download', 3, 'HOSTGL', NULL, NULL, ',' , 0, 0, NULL, 'ROW:{Host GL Code, Account Type, Loan Type, Cost Centre, Profit Centre, Opened Date, Allow Manual Entries, GL Description, Status}',  '', 'A', '/opt/PFF/BASE/hdfc/HostGL/template', 'HostGL_', '.xlsx', 0, current_timestamp, '${ddMMYYYYHms}', NULL, 0, NULL, 1, 1);

				INSERT INTO DATA_ENGINE_TABLE (ID, CONFIGID, NAME, OPERATION, KEYFIELDS, FILTER, STATUSUPDATE, SKIPROWS, IDENTIFIER, DESCRIPTION, STARTINDEX, ENDINDEX, RECORDLENGTH, MULTIROW, HEADERTABLE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_TABLE), (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_TEMPLATE'), 'HOST_GL_UPLOAD',  0, 'ID', NULL, NULL, NULL, NULL, NULL, NULL, NULL, 8, 0, 0);
								
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_TEMPLATE')),  'ID',  				    1, 'N', NULL, NULL, NULL, NULL, '0',  NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_TEMPLATE')),  'HEADERID',     		    0, 'N', NULL, NULL, '${HEADER_ID}',   NULL, '0', NULL, NULL, NULL, NULL, 'M');								
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_TEMPLATE')),  'HOSTGLCODE',      		0, 'N', NULL, NULL, NULL, NULL, '0',  NULL, NULL, NULL, NULL, 'M');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_TEMPLATE')),  'ACCOUNTTYPE',             0, 'N', NULL, NULL, NULL, NULL, '1',  NULL, NULL, NULL, NULL, 'M');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_TEMPLATE')),  'LOANTYPE',      		    0, 'N', NULL, NULL, NULL, NULL, '2',  NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_TEMPLATE')),  'COSTCENTRECODE',      	0, 'N', NULL, NULL, NULL, NULL, '3',  NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_TEMPLATE')),  'PROFITCENTRECODE',       	0, 'N', NULL, NULL, NULL, NULL, '4',  NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_TEMPLATE')),  'OPENEDDATE',      		0, 'N', NULL, NULL, NULL, NULL, '5',  NULL, NULL, NULL, 'dd-MMM-yyyy', 'M');
			    INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_TEMPLATE')),  'ALLOWMANUALENTRIES',      0, 'N', NULL, NULL, NULL, NULL, '6',  NULL, NULL, NULL, NULL, 'M');
			    INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_TEMPLATE')),  'GLDESCRIPTION',           0, 'N', NULL, NULL, NULL, NULL, '7',  NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_TEMPLATE')),  'STATUS',                  0, 'N', NULL, 'S', NULL, NULL,  '8',  NULL, NULL, NULL, NULL, 'O');
				]]>
		 </sql>
	</changeSet>
	
	<changeSet id="ST#840.5" author="sainaveen.y">
		<sql>
			<![CDATA[
				DELETE FROM DATA_ENGINE_LOG WHERE STATUSID IN (SELECT ID FROM DATA_ENGINE_STATUS WHERE NAME ='HOST_GL_DOWNLOAD');
 				DELETE FROM DATA_ENGINE_DOWNLOAD_HISTORY WHERE ID IN (SELECT ID FROM DATA_ENGINE_STATUS WHERE NAME ='HOST_GL_DOWNLOAD');
 				DELETE FROM DATA_ENGINE_STATUS WHERE NAME ='HOST_GL_DOWNLOAD';
 				
				DELETE FROM DATA_ENGINE_COLUMN WHERE TABLEID IN (SELECT ID FROM DATA_ENGINE_TABLE WHERE CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_DOWNLOAD'));
				DELETE FROM DATA_ENGINE_TABLE WHERE CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_DOWNLOAD');
				DELETE FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_DOWNLOAD';

				INSERT INTO DATA_ENGINE_CONFIG (ID, NAME, DESCRIPTION, PARSER, WORKSHEET, TEXTQUALIFIER, ROWDELIMITER, COLUMNDELIMITER, STARTINGROW, SKIPHEADERROW, FIELDNAMES, HEADER, TRAILER, UPLOADLOCATION, UPLOADPATH, FILEPREFIXNAME, FILEEXTENSION, FILESEQUENCENO, LASTPROCESSEDON, FILENAMEFORMAT, CRONEXPRESSION, NOTIFICATIONSTATUSEMAIL, POSTEVENT, BACKUPFILE, ACTIVE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_CONFIG), 'HOST_GL_DOWNLOAD', 'Host GL  Download', 3, 'HOSTGL', NULL, NULL, ',' , 0, 0, NULL, 'ROW:{Host GL Code,Account Type,Loan Type,Cost Centre,Profit Centre,Opened Date,Allow Manual Entries,GL Description, Upload Status, ErrorCode, ErrorDesc, Created On, Created By, Approved On, Approved By}',  '', 'A', '/opt/PFF/BASE/hdfc/HostGL/download', 'HostGL_', '.xlsx', 0, current_timestamp, '${ddMMYYYYHms}', NULL, 0, NULL, 1, 1);

				INSERT INTO DATA_ENGINE_TABLE (ID, CONFIGID, NAME, OPERATION, KEYFIELDS, FILTER, STATUSUPDATE, SKIPROWS, IDENTIFIER, DESCRIPTION, STARTINDEX, ENDINDEX, RECORDLENGTH, MULTIROW, HEADERTABLE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_TABLE), (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_DOWNLOAD'), 'HOST_GL_UPLOAD',  0, 'ID', NULL, NULL, NULL, NULL, NULL, NULL, NULL, 15, 0, 0);
								
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_DOWNLOAD')),  'HOSTGLCODE',      		0, 'N', NULL, NULL, NULL, NULL, '0',  NULL, NULL, NULL, NULL, 'M');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_DOWNLOAD')),  'ACCOUNTTYPE',             0, 'N', NULL, NULL, NULL, NULL, '1',  NULL, NULL, NULL, NULL, 'M');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_DOWNLOAD')),  'LOANTYPE',      		    0, 'N', NULL, NULL, NULL, NULL, '2',  NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_DOWNLOAD')),  'COSTCENTRECODE',      	0, 'N', NULL, NULL, NULL, NULL, '3',  NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_DOWNLOAD')),  'PROFITCENTRECODE',       	0, 'N', NULL, NULL, NULL, NULL, '4',  NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_DOWNLOAD')),  'OPENEDDATE',      	    0, 'N', NULL, NULL, NULL, NULL, '5',  NULL, NULL, NULL, 'dd-MMM-yyyy', 'M');
			    INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_DOWNLOAD')),  'ALLOWMANUALENTRIES',      0, 'N', NULL, NULL, NULL, NULL, '6',  NULL, NULL, NULL, NULL, 'M');
			    INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_DOWNLOAD')),  'GLDESCRIPTION',           0, 'N', NULL, NULL, NULL, NULL, '7',  NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_DOWNLOAD')),  'STATUS',                  0, 'N', NULL, NULL, NULL, NULL,  '8',  NULL, NULL, NULL, NULL, 'O');
			    INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_DOWNLOAD')),  'ERRORCODE',	            0, 'N', NULL, NULL, NULL, NULL, '9', NULL, NULL, NULL,  NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_DOWNLOAD')),  'ERRORDESC',	            0, 'N', NULL, NULL, NULL, NULL, '10', NULL, NULL, NULL,  NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_DOWNLOAD')),  'CREATEDON',	            0, 'N', NULL, NULL, NULL, NULL, '11', NULL, NULL, NULL,  'dd-MMM-yyyy', 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_DOWNLOAD')),  'CREATEDNAME',	            0, 'N', NULL, NULL, NULL, NULL, '12', NULL, NULL, NULL,  NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_DOWNLOAD')),  'APPROVEDON',	            0, 'N', NULL, NULL, NULL, NULL, '13', NULL, NULL, NULL,  'dd-MMM-yyyy', 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOST_GL_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOST_GL_DOWNLOAD')),  'APPROVEDNAME',	        0, 'N', NULL, NULL, NULL, NULL, '14', NULL, NULL, NULL,  NULL, 'O');]]>
		 </sql>
	</changeSet>
	
	<changeSet id="ST#840.6" author="sainaveen.y">
		<sql>
			<![CDATA[
				DELETE FROM SECROLEGROUPS WHERE GRPID IN (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'HOST_GL_UPLOAD_MAKER');
				DELETE FROM SECROLEGROUPS WHERE GRPID IN (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'HOST_GL_UPLOAD_APPROVER');

				DELETE FROM SECROLES WHERE ROLECD ='HOST_GL_UPLOAD_MAKER';
				DELETE FROM SECROLES WHERE ROLECD ='HOST_GL_UPLOAD_APPROVER';

				DELETE FROM SECGROUPRIGHTS WHERE GRPID IN (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'HOST_GL_UPLOAD_MAKER');
				DELETE FROM SECGROUPRIGHTS WHERE GRPID IN (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'HOST_GL_UPLOAD_APPROVER');

				DELETE FROM SECGROUPS WHERE GRPCODE ='HOST_GL_UPLOAD_MAKER';
				DELETE FROM SECGROUPS WHERE GRPCODE ='HOST_GL_UPLOAD_APPROVER';

				DELETE FROM SECRIGHTS WHERE RIGHTNAME ='menu_Item_BulkHostGLUpload_Maker';
				DELETE FROM SECRIGHTS WHERE RIGHTNAME ='menu_Item_BulkHostGLUpload_Approver';

				INSERT INTO SECRIGHTS(RIGHTID, RIGHTTYPE, RIGHTNAME, PAGE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES ((SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 0, 'menu_Item_BulkHostGLUpload_Maker', 'MENU', 1, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				INSERT INTO SECRIGHTS(RIGHTID, RIGHTTYPE, RIGHTNAME, PAGE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES ((SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 0, 'menu_Item_BulkHostGLUpload_Approver', 'MENU', 1, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				
				INSERT INTO SECGROUPS(GRPID, GRPCODE, GRPDESC, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(GRPID)+1 FROM SECGROUPS), 'HOST_GL_UPLOAD_MAKER', 'WF Maker for Host GL Upload', 0, 1000, current_timestamp, 'Approved', null, null, null, null, null, 0);
				INSERT INTO SECGROUPS(GRPID, GRPCODE, GRPDESC, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(GRPID)+1 FROM SECGROUPS), 'HOST_GL_UPLOAD_APPROVER', 'WF Approver for Host GL Upload', 0, 1000, current_timestamp, 'Approved', null, null, null, null, null, 0);

				INSERT INTO SECGROUPRIGHTS (GRPRIGHTID, GRPID, RIGHTID, ACCESSTYPE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'HOST_GL_UPLOAD_MAKER'),    (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'menu_Item_BulkHostGLUpload_Maker'), 1, 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				INSERT INTO SECGROUPRIGHTS (GRPRIGHTID, GRPID, RIGHTID, ACCESSTYPE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'HOST_GL_UPLOAD_APPROVER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'menu_Item_BulkHostGLUpload_Approver'), 1, 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);

				INSERT INTO SECROLES (ROLEID, ROLEAPP, ROLECD, ROLEDESC, ROLECATEGORY, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(ROLEID)+1 FROM SECROLES), 1, 'HOST_GL_UPLOAD_MAKER', 'Maker role from Host GL Upload', '', 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0); 
				INSERT INTO SECROLES (ROLEID, ROLEAPP, ROLECD, ROLEDESC, ROLECATEGORY, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(ROLEID)+1 FROM SECROLES), 1, 'HOST_GL_UPLOAD_APPROVER', 'Approver role from Host GL Upload',	'', 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);

				INSERT INTO SECROLEGROUPS (ROLEGRPID, GRPID, ROLEID, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID)VALUES ((SELECT MAX(ROLEGRPID)+1 FROM SECROLEGROUPS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'HOST_GL_UPLOAD_MAKER'),    (SELECT ROLEID FROM SECROLES WHERE ROLECD = 'HOST_GL_UPLOAD_MAKER'),    0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				INSERT INTO SECROLEGROUPS (ROLEGRPID, GRPID, ROLEID, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID)VALUES ((SELECT MAX(ROLEGRPID)+1 FROM SECROLEGROUPS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'HOST_GL_UPLOAD_APPROVER'), (SELECT ROLEID FROM SECROLES WHERE ROLECD = 'HOST_GL_UPLOAD_APPROVER'), 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
			]]>
		</sql>
	</changeSet> 
	
	<changeSet id="ST#840.7" author="sainaveen.y">
		<addColumn tableName="AccountMapping">
			<column name="GLDescription" type="varchar(50)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="ST#840.8" author="sainaveen.y">
		<addColumn tableName="AccountMapping_Temp">
			<column name="GLDescription" type="varchar(50)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="ST#840.9_pre" author="sainaveen.y" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'accountmapping_view');
 			]]>
		</sql>
	</changeSet>
	
	<changeSet id="ST#840.9" author="sainaveen.y">
		<createView replaceIfExists="true" viewName="ACCOUNTMAPPING_VIEW">
			<![CDATA[
				SELECT AM.ACCOUNT
					, AM.HOSTACCOUNT
					, AM.PROFITCENTERID
					, AM.COSTCENTERID
					, AM.FINTYPE
					, AM.ACCOUNTTYPE 
                    , PC.PROFITCENTERCODE
                    , PC.PROFITCENTERDESC	
                    , CC.COSTCENTERCODE	
                    , CC.COSTCENTERDESC	
                    , RAT.ACTYPEDESC ACCOUNTTYPEDESC	
                    , RFT.FINTYPEDESC
                    , AM.OPENEDDATE
                    , AM.CLOSEDDATE					
					, AM.STATUS 
					, AM.ALLOWEDMANUALENTRY
					, AM.VERSION
					, AM.CREATEDBY
					, AM.CREATEDON                                                                           
					, AM.APPROVEDBY
					, AM.APPROVEDON 
					, AM.LASTMNTBY 
					, AM.LASTMNTON 
					, AM.RECORDSTATUS 
					, AM.ROLECODE 
					, AM.NEXTROLECODE 
					, AM.TASKID 
					, AM.NEXTTASKID 
					, AM.RECORDTYPE 
					, AM.WORKFLOWID
					, AM.GLDESCRIPTION
				FROM ACCOUNTMAPPING_TEMP AM
				LEFT JOIN PROFITCENTERS PC ON PC.PROFITCENTERID = AM.PROFITCENTERID
				LEFT JOIN COSTCENTERS CC ON CC.COSTCENTERID = AM.COSTCENTERID
				LEFT JOIN RMTACCOUNTTYPES RAT ON RAT.ACTYPE = AM.ACCOUNTTYPE
				LEFT JOIN RMTFINANCETYPES RFT ON RFT.FINTYPE = AM.FINTYPE
				UNION ALL
				SELECT AM.ACCOUNT
					, AM.HOSTACCOUNT
					, AM.PROFITCENTERID
					, AM.COSTCENTERID
					, AM.FINTYPE
					, AM.ACCOUNTTYPE 
                    , PC.PROFITCENTERCODE
                    , PC.PROFITCENTERDESC	
                    , CC.COSTCENTERCODE	
                    , CC.COSTCENTERDESC	
                    , RAT.ACTYPEDESC ACCOUNTTYPEDESC	
                    , RFT.FINTYPEDESC
                    , AM.OPENEDDATE
                    , AM.CLOSEDDATE					
					, AM.STATUS 
					, AM.ALLOWEDMANUALENTRY
					, AM.VERSION
					, AM.CREATEDBY
					, AM.CREATEDON                                                                           
					, AM.APPROVEDBY
					, AM.APPROVEDON 
					, AM.LASTMNTBY 
					, AM.LASTMNTON 
					, AM.RECORDSTATUS 
					, AM.ROLECODE 
					, AM.NEXTROLECODE 
					, AM.TASKID 
					, AM.NEXTTASKID 
					, AM.RECORDTYPE 
					, AM.WORKFLOWID
					, AM.GLDESCRIPTION
				FROM ACCOUNTMAPPING AM
				LEFT JOIN PROFITCENTERS PC ON PC.PROFITCENTERID = AM.PROFITCENTERID   
				LEFT JOIN COSTCENTERS CC ON CC.COSTCENTERID = AM.COSTCENTERID 
				LEFT JOIN RMTACCOUNTTYPES RAT ON RAT.ACTYPE = AM.ACCOUNTTYPE  
				LEFT JOIN RMTFINANCETYPES RFT ON RFT.FINTYPE = AM.FINTYPE
        	 	WHERE NOT EXISTS (SELECT 1 FROM ACCOUNTMAPPING_TEMP WHERE ACCOUNT = AM.ACCOUNT)
			]]>
		</createView>
	</changeSet>
	
	<changeSet id="ST#840.9_post" author="sainaveen.y" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'accountmapping_view');
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="ST#840.10_pre" author="sainaveen.y" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'accountmapping_aview');
			 ]]>
		</sql>
	</changeSet>
	
	<changeSet id="ST#840.10" author="sainaveen.y">
		<createView replaceIfExists="true" viewName="ACCOUNTMAPPING_AVIEW">
			<![CDATA[
				SELECT AM.ACCOUNT
					, AM.HOSTACCOUNT
					, AM.PROFITCENTERID
					, AM.COSTCENTERID
					, AM.FINTYPE
					, AM.ACCOUNTTYPE 
                    , PC.PROFITCENTERCODE
                    , PC.PROFITCENTERDESC	
                    , CC.COSTCENTERCODE	
                    , CC.COSTCENTERDESC	
                    , RAT.ACTYPEDESC ACCOUNTTYPEDESC	
                    , RFT.FINTYPEDESC
                    , AM.OPENEDDATE
                    , AM.CLOSEDDATE					
					, AM.STATUS 
					, AM.ALLOWEDMANUALENTRY
					, AM.VERSION
					, AM.CREATEDBY
					, AM.CREATEDON                                                                           
					, AM.APPROVEDBY
					, AM.APPROVEDON 
					, AM.LASTMNTBY 
					, AM.LASTMNTON 
					, AM.RECORDSTATUS 
					, AM.ROLECODE 
					, AM.NEXTROLECODE 
					, AM.TASKID 
					, AM.NEXTTASKID 
					, AM.RECORDTYPE 
					, AM.WORKFLOWID
					, AM.GLDESCRIPTION
				FROM ACCOUNTMAPPING AM   
				LEFT JOIN PROFITCENTERS PC ON  PC.PROFITCENTERID = AM.PROFITCENTERID   
				LEFT JOIN COSTCENTERS CC ON  CC.COSTCENTERID = AM.COSTCENTERID 
				LEFT JOIN RMTACCOUNTTYPES RAT ON  RAT.ACTYPE = AM.ACCOUNTTYPE  
				LEFT JOIN RMTFINANCETYPES RFT ON RFT.FINTYPE = AM.FINTYPE
			]]>
		</createView>
	</changeSet>
	
	<changeSet id="ST#840.10_post" author="sainaveen.y" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'accountmapping_aview');
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="ST#840.11" author="sainaveen.y">
		<sql>
			<![CDATA[
			    DELETE FROM SECGROUPRIGHTS WHERE RIGHTID = (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'AccountMappingDialog_GLDescription');
				DELETE FROM SECRIGHTS WHERE RIGHTNAME = 'AccountMappingDialog_GLDescription';
				
				INSERT INTO SECRIGHTS (RIGHTID, RIGHTTYPE, RIGHTNAME, PAGE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES ((SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'AccountMappingDialog_GLDescription', 'AccountMappingDialog', 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				INSERT INTO SECGROUPRIGHTS (GRPRIGHTID, GRPID, RIGHTID, ACCESSTYPE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES ((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'ACCOUNTMAPPING_MAKER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'AccountMappingDialog_GLDescription'), 1, 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
			]]>
		</sql>
	</changeSet>
	
</databaseChangeLog>