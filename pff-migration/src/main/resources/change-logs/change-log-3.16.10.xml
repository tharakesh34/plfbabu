<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />

	<changeSet id="01" author="Madhubabu" >
		<sql>
	Delete from BMTAEEvents where AEEventCode='JVPOST';
	insert into BMTAEEvents values ('JVPOST','Miscellaneous Postings',1,1007,current_timestamp,'Aproved','','','','','',0,1,1,1);
</sql>
</changeSet>
<changeSet id="02" author="Prasad">
    <createView viewName="DM_APPLICANT_DETAILS_VIEW" replaceIfExists="true">
        SELECT DISTINCT T1.custcorebank CUSTOMERID,
			CASE WHEN FP.CUSTID IS NOT NULL THEN 'APPLICANT' WHEN FJ.CUSTCIF IS NOT NULL THEN 'CO APPLICANT' WHEN FG.GUARANTORCIF IS NOT NULL  THEN 'GUARANTEER' ELSE 'APPLICANT' END CUST_TYPE,
			T1.CUSTCRCPR PANNO, CUSTADDRHNBR ADDRESS1,T2.CUSTFLATNBR ADDRESS2,CUSTADDRSTREET ADDRESS3,CUSTADDRLINE1 ADDRESS4,CUSTADDRCITY 
			CITY,CUSTADDRPROVINCE STATE,CUSTADDRCOUNTRY COUNTRY,CUSTADDRZIP ZIPCODE,CUSTADDRTYPE ADDRESSTYPE,CUSTEMAIL EMAIL,T41.PHONENUMBER 
			PHONE1,T42.PHONENUMBER PHONE2,T4.PHONENUMBER MOBILE,T5.PHONENUMBER FAX,
			CASE WHEN T1.CUSTCOREBANK IS NULL THEN 'N' ELSE 'Y' END EXISTING_CUST_FLAG,
			CASE WHEN CUSTCTGCODE='RETAIL' THEN 'I' ELSE 'C' END INDIV_CORP_FLAG,
			ROUND(MONTHS_BETWEEN( (SELECT TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')  SYSPARMVALUE FROM SMTPARAMETERS WHERE 
			SYSPARMCODE='APP_DATE'),T1.CUSTDOB)/12) AGE,CUSTDOB DOB,CUSTFNAME FNAME,CUSTMNAME MNAME,CUSTLNAME LNAME,GENDERDESC 
			GENDER,CUSTMARITALSTS MARITAL_STATUS,NOOFDEPENDENTS NO_OF_DEPENDENT,
			ROUND(MONTHS_BETWEEN( (SELECT TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')  SYSPARMVALUE FROM SMTPARAMETERS WHERE 
			SYSPARMCODE='APP_DATE'),T7.CUSTEMPFROM)/12) YEARS_CURRENT_JOB,NULL YEARS_PREV_JOB,NULL QUALIFICATION,NULL RESIDENCETYPE,
			NULL YEARS_CURR_RESI,E.EMPNAME EMPLOYER_DESC,NULL COMPANY_TYPE,T1.CUSTINDUSTRY INDUSTRYID,NULL NATURE_OF_BUSINESS,
			T7.CUSTEMPTYPE EMPLOYMENT_TYPE,T7.CUSTEMPDESG EMPDESG,NULL OCCUPATION,
			 UDF_CONVERTCURRENCY(T1.CUSTTOTALINCOME,'INR','INR')  ANNUAL_INCOME,NULL GUARDIAN,NULL BUSINESSDATE,'N' PROCESSED_FLAG,
			NULL PROCESS_DATE,NULL SEGMENTS,CUSTSHRTNAME CUSTOMERNAME,NULL CONTACT_PERSON_NAME,T1.custtypecode CONSTITUTION,
			BBD.BANKCODE CUST_BANK_NAME,NULL CUST_BANK_BRANCH,NULL EMI_CARD_LIMIT,NULL EMI_CARD_ACCEPT_FLAG,NULL EMI_CARD_SWIPE_FLAG,
			NULL EMI_CARD_ELIG,NULL EMI_CARD_NO,NULL BANK_ECS_MANDATE,
			CASE WHEN M.CUSTID IS NOT NULL THEN 'Y' ELSE 'N' END OPEN_ECS_AVLB,
			M.STARTDATE OPEN_ECS_DATE,
			(SELECT EXTRACT(YEAR FROM (TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')))  SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE') 
			BUSINESS_YEAR,CUSTSALUTATIONCODE TITLE,CUSTEMPNAME COMP_NAME,CUSTEMPFROM  YEARS_CURR_JOB,NULL GRADE,NULL FAMILY_CODE,
			NULL MINOR,NULL GUARDIAN_NEW,CUSTCRCPR UCIN_NO,NULL PREFERRED_ELIGIBILITY,NULL PREFERRED_CARD_ACCEPTANCE,
			NULL PREFERRED_CARD_LIMIT,CUSTDFTBRANCH CUST_BRANCHID,NULL BATCH_ID 
			FROM CUSTOMERS T1 
			LEFT JOIN CUSTOMERADDRESSES T2 ON T1.CUSTID=T2.CUSTID AND CUSTADDRPRIORITY=5
			LEFT JOIN CUSTOMEREMAILS T3 ON T3.CUSTID=T1.CUSTID AND CUSTEMAILPRIORITY=5
			LEFT JOIN CUSTOMERPHONENUMBERS T41 ON T41.PHONECUSTID=T1.CUSTID AND T41.PHONETYPEPRIORITY=5
			LEFT JOIN CUSTOMERPHONENUMBERS T42 ON T42.PHONECUSTID=T1.CUSTID AND T42.PHONETYPEPRIORITY=4
			LEFT JOIN CUSTOMERPHONENUMBERS T4 ON T4.PHONECUSTID=T1.CUSTID AND T4.PHONETYPECODE ='MOBILE'
			LEFT JOIN CUSTOMERPHONENUMBERS T5 ON T5.PHONECUSTID=T1.CUSTID AND T5.PHONETYPECODE= 'FAX'
			LEFT JOIN BMTGENDERS T6 ON T6.GENDERCODE=T1.CUSTGENDERCODE
			LEFT JOIN CUSTOMEREMPDETAILS T7 ON T7.CUSTID = T1.CUSTID AND CURRENTEMPLOYER=1
			LEFT JOIN (SELECT DISTINCT CUSTID FROM FINPFTDETAILS) FP ON FP.CUSTID = T1.CUSTID 
			LEFT JOIN (SELECT DISTINCT CUSTCIF FROM  FINJOINTACCOUNTDETAILS FJ) FJ ON FJ.CUSTCIF = T1.CUSTCIF AND FJ.CUSTCIF  IS NOT NULL
			LEFT JOIN (SELECT DISTINCT GUARANTORCIF FROM FINGUARANTORSDETAILS )FG ON FG.GUARANTORCIF = T1.CUSTCIF AND FG.GUARANTORCIF  IS NOT NULL
			LEFT JOIN EMPLOYERDETAIL E ON E.EMPLOYERID = T7.CUSTEMPNAME
			LEFT JOIN (SELECT CUSTID,MAX(STARTDATE)STARTDATE FROM MANDATES M WHERE OPENMANDATE=1  AND MANDATETYPE='ECS' GROUP BY CUSTID)M ON M.CUSTID = T1.CUSTID
			LEFT JOIN (SELECT B.CUSTID,B.BANKBRANCHID FROM (
			SELECT CUSTID,MAX(LASTMNTON)LASTMNTON 
			FROM BENEFICIARY GROUP BY CUSTID )T  INNER JOIN BENEFICIARY B ON B.CUSTID=T.CUSTID AND B.LASTMNTON=T.LASTMNTON) B ON B.CUSTID =T1.CUSTID
			LEFT JOIN BANKBRANCHES BB ON BB.BANKBRANCHID = B.BANKBRANCHID
			LEFT JOIN BMTBANKDETAIL BBD ON BBD.BANKCODE =BB.BANKCODE
			where T1.custcorebank is not null
    </createView>
</changeSet>
<changeSet id="03" author="Prasad">
    <createView viewName="RPT_SOA_TXNDETAILS_VIEW" replaceIfExists="true">
       <![CDATA[ Select T1.Finreference,Schdate,Particulars,Debit,Credit,ccyMinorccyunits,ccyEditField,
		 (Select to_date(sysparmvalue, 'YYYY-MM-DD')  sysparmvalue from smtparameters where SYSPARMCODE='APP_DATE') APP_DATE ,Ordby
		 from ( 
     Select T1.Finreference,Schdate,  'Amount Financed - Payable ('||T1.Finreference||')' Particulars,0  Debit,
			 T1.DisbAmount+(CASE WHEN T1.Schdate = T2.FInStartDate Then T2.feechargeamt else 0 End ) Credit,1 Ordby       
	   from finscheduledetails T1 inner join
          financemain t2 on t1.finreference = t2.finreference
	   where (t2.closingstatus!='C' or t2.closingstatus is null) and 	T1.Disbonschdate=1
      union all
      Select T1.Finreference,T1.LLDate,'Amount Paid Vide '||PaymentType||' :'|| (case when PaymentType in ('CHEQUE','DD') then LLREFERENCENO else Transactionref end)||'('||T1.Finreference||')' ,
    AmtToBeReleased Debit, 0 credit,2 Ordby
    from FINADVANCEPAYMENTS T1 inner join Financemain T2 on T2.Finreference = T1.Finreference
    where (Status not in ('CANCELED','REJECTED') or Status is null)
       union all
		Select T1.Finreference,Schdate, 'Due for Installment '||T1.INSTNUMBER||' ('||T1.Finreference||')'  Particulars,
			  T1.Repayamount-T1.PartialPaidamt Debit, 0  Credit,3 Ordby       
	   from finscheduledetails T1 inner join
          financemain t2 on t1.finreference = t2.finreference
	   where (BPIORHOLIDAY!='H' or BPIORHOLIDAY!='B' or BPIORHOLIDAY is null) and (t2.closingstatus!='C' or t2.closingstatus is null) and 
			 schdate<=(Select to_date(sysparmvalue, 'YYYY-MM-DD')  sysparmvalue from smtparameters where SYSPARMCODE='APP_DATE') and 	T1.Disbonschdate=0
       and T1.Finreference||schdate not in ( Select  T1.Finreference||max(T2.schdate)maxschdate
                                              from financemain T1 inner join 
                                              Finscheduledetails T2 on T1.Finreference = T2.Finreference
                                              where T1.closingstatus='E'
                                              group by T1.Finreference)
  union all
  Select t2.finreference,Schdate,FeeTypeDesc ||'- Due ('||T2.Finreference||')', SchAmount Debit, 0 credit,4 Ordby from finfeescheduledetail T1 
  Inner Join FinFeeDetail T2 on T1.FeeID = T2.FeeID
  Inner Join FeeTypes T3 On T2.FeeTypeid = T3.FeeTypeId 
  inner join financemain t4 on t4.FINREFERENCE =t2.FINREFERENCE
  where SchAmount!=0 and (t4.closingstatus!='C' or t4.closingstatus is null) 
  and  schdate<=(Select to_date(sysparmvalue, 'YYYY-MM-DD')  sysparmvalue from smtparameters where SYSPARMCODE='APP_DATE')  	
union all
     Select T1.Finreference,Schdate,  'Part Prepayment Amount ('||T1.Finreference||')' Particulars,
			T1.PartialPaidamt Debit,0 Credit,5 Ordby       
	   from finscheduledetails T1 inner join
          financemain t2 on t1.finreference = t2.finreference
	   where T1.PartialPaidamt !=0 and  
			 schdate<=(Select to_date(sysparmvalue, 'YYYY-MM-DD')  sysparmvalue from smtparameters where SYSPARMCODE='APP_DATE')  
      union all
  Select T1.Finreference,T2.FInApprovedDate,'Broken Period Interest Receivable- Due('||T1.Finreference||')' Particulars,
			 Repayamount Debit, 0 Credit,6 Ordby
	   from finscheduledetails T1
          inner join Financemain T2 on T2.Finreference = T1.Finreference
	   where BPIORHOLIDAY='B' and Repayamount!=0 and (t2.closingstatus!='C' or t2.closingstatus is null)
  union all
    Select T.Finreference,T1.PostDate,'Amount Paid Vide '||T1.PaymentType||' :'|| (case when T1.PaymentType in ('CHEQUE','DD') then T1.Favournumber else T1.Transactionref end)||'('||T.Finreference||')' ,
    T1.PaymentAmount Debit, 0 credit,7 Ordby
    from paymentheader T inner join
         paymentinstructions T1 on T1.Paymentid =T.Paymentid inner join
         Financemain T2 on T2.Finreference = T.Finreference
        where (T1.Status!='CANCELED' or T1.Status is null) 
              and T1.PostDate<=(Select to_date(sysparmvalue, 'YYYY-MM-DD')  sysparmvalue from smtparameters where SYSPARMCODE='APP_DATE') 
  union all
	Select REFERENCE,T1.Receiptdate,(Case when PAYMENTTYPE NOT in ('EXCESS','CASH') then 'Payment Recieved vide '||PAYMENTTYPE ||' No.:'||PAYMENTREF||' '||FavourNumber ||'('||REFERENCE||')'
										 when PAYMENTTYPE in ('EXCESS') then 'Amount Adjusted ('||REFERENCE||')' 
										 when PAYMENTTYPE in ('CASH') then 'Cash received Vide Receipt No.'||PAYMENTREF ||'('||REFERENCE||')' end) Particulars,
			    Case when PAYMENTTYPE NOT in ('EXCESS') then 0  when PAYMENTTYPE in ('EXCESS') then Amount end debit,Amount credit,8 Ordby
		from FINRECEIPTHEADER T1 inner join 
			 FINRECEIPTDETAIL T2 on T1.RECEIPTID =T2.RECEIPTID 	
       Where (T1.ReceiptModeStatus Not IN ('C') or T1.ReceiptModeStatus is null)
	union all 	
       
        Select REFERENCE,Bouncedate,(Case when PAYMENTTYPE NOT in ('EXCESS','CASH') then 'Payment Bounced For '||PAYMENTTYPE ||' No.:'||FavourNumber ||' ('||REFERENCE||')' 
										 when PAYMENTTYPE in ('CASH') then 'Cash Bounced For Receipt No.'||PAYMENTREF ||'('||REFERENCE||')' end) Particulars,
			   Amount debit, 0 credit,9 Ordby
		from FINRECEIPTHEADER T1 inner join 
         FINRECEIPTDETAIL T2 on T1.RECEIPTID =T2.RECEIPTID And T1.ReceiptMode = T2.PaymentType  inner join
         ManualAdvise T3 on T3.RECEIPTID = T1.RECEIPTID 
       Where T1.ReceiptModeStatus  IN ('B') and T3.Advisetype=1 and T3.Bounceid>0
  union all
		SELECT FINREFERENCE,M.POSTDATE,(CASE WHEN F.FEETYPEID IS NOT NULL THEN FEETYPEDESC 
		else 'Bounce' end) ||'- Due ('||Finreference||')' ,m.ADVISEAMOUNT Debit ,0 Credit ,10 Ordby
		FROM MANUALADVISE M
		LEFT JOIN FEETYPES F ON F.FEETYPEID = M.FEETYPEID 	
		where (M.AdviseType <> 2 or M.AdviseType is null) and 	m.ADVISEAMOUNT >0 and RECEIPTID not in (Select RECEIPTID from PRESENTMENTDETAILS) 
    union all   
    SELECT M.FINREFERENCE,M.POSTDATE,'Bounce - Due for Installment:'||T5.InstNumber||' ('||M.Finreference||')' ,m.ADVISEAMOUNT Debit ,0 Credit ,11 Ordby
		FROM MANUALADVISE M
    INNER Join PRESENTMENTDETAILS T4 on T4.RECEIPTID = M.RECEIPTID and M.RECEIPTID !=0 and T4.RECEIPTID !=0
    INNER Join FINSCHEDULEDETAILS T5 on T4.FInreference = T5.FInreference and T4.schdate = T5.schdate
		where (M.AdviseType <> 2 or M.AdviseType is null) and	m.ADVISEAMOUNT >0 and FEETYPEID not in (Select FEETYPEID from FEETYPES)
  union all
  	SELECT FINREFERENCE,M.POSTDATE, FEETYPEDESC  ||'- Payable ('||Finreference||')' ,0 Debit ,m.ADVISEAMOUNT Credit ,12 Ordby
		FROM MANUALADVISE M
		INNER JOIN FEETYPES F ON F.FEETYPEID = M.FEETYPEID 	
		where M.AdviseType = 2 	and 	m.ADVISEAMOUNT >0  
	union all	  
  Select t2.Finreference,t1.Movementdate,
'Waived Amount '|| (CASE WHEN F.FEETYPEID IS NOT NULL THEN FEETYPEDESC 
		else 'Bounce' end)||'('||t2.Finreference||')' Particulars ,0,t2.WaivedAmount,13 Ordby
from manualadvisemovements t1 
inner join manualadvise t2 on t1.Adviseid = t2.Adviseid
LEFT JOIN FEETYPES F ON F.FEETYPEID = t2.FEETYPEID 
where t2.WaivedAmount>0
union all
    Select T1.Finreference,T3.finstartdate,
    CASE WHEN Feetypedesc is not null Then FeeTypeDesc Else ProductDesc End  ||'- Due ('||T1.Finreference||')', RemainingFee+PaidAmount Debit, 0 credit,14 Ordby
    from finfeedetail T1 
    Left join feetypes T2 on T1.Feetypeid = T2.Feetypeid
    inner join Financemain T3 on T3.Finreference = T1.Finreference
    Left join VasRecording T4 on T1.VasReference = T4.VasReference
    Left Join VasStructure T5 on T4.ProductCode = T5.ProductCode     
    where Originationfee=1 and feeSchedulemethod in ('DISB','POSP') and (RemainingFee+PaidAmount)!=0 and (t3.closingstatus!='C' or t3.closingstatus is null)
union all
    Select T1.Finreference,T1.postdate,
    CASE WHEN Feetypedesc is not null Then FeeTypeDesc Else ProductDesc End  ||'- Due ('||T1.Finreference||')', PaidAmount Debit, 0 credit,15 Ordby
    from finfeedetail T1 
    Left join feetypes T2 on T1.Feetypeid = T2.Feetypeid
    inner join Financemain T3 on T3.Finreference = T1.Finreference
    Left join VasRecording T4 on T1.VasReference = T4.VasReference
    Left Join VasStructure T5 on T4.ProductCode = T5.ProductCode     
    where  (feeSchedulemethod not in ('DISB','POSP') or feeSchedulemethod is null)   and (PaidAmount)!=0 and (t3.closingstatus!='C' or t3.closingstatus is null)

	union all 	
		Select t1.finreference, FinODSchdDate, 'Penalty Due Created for Past due till date ' || to_char(t1.FINODTILLDATE, 'dd/mm/yyyy') Particulars, 
		t1.TotPenaltyAmt Debit, 0 credit,16 Ordby
		From FinODDetails T1 inner join Financemain T2 on T1.Finreference = T2.Finreference where TOtPenaltyAmt > 0 and   (t2.closingstatus!='C' or t2.closingstatus is null)
  union all
  Select T2.Reference,T2.Receiptdate,'TDS Adjustment('||T2.Reference||')' Particulars,0 Debit,T1.PaidAmount credit,17 ordby
  from RECEIPTALLOCATIONDETAIL T1
  inner join FINRECEIPTHEADER T2 on T2.RECEIPTID  = T1.RECEIPTID where T1.ALLOCATIONTYPE='TDS'
  and (T2.ReceiptModeStatus Not IN ('C') or T2.ReceiptModeStatus is null)
  union all  
  Select distinct T2.Reference,Bouncedate,'TDS Adjustment Reversal('||T2.Reference||')' Particulars,T5.TDSSCHDPAYNOW Debit,0 credit, 18 ordby
  from FINRECEIPTHEADER T2
  inner join FINRECEIPTDETAIL T3 on T3.RECEIPTID = T2.RECEIPTID
  inner join finrepayheader T4 on T3.Receiptseqid = T4.Receiptseqid
  inner join (Select repayid,sum(TDSSCHDPAYNOW) TDSSCHDPAYNOW from FinRepayscheduledetail
  where TDSSCHDPAYNOW!=0
  group by repayid) T5 on T5.repayid =T4.repayid
  where T3.Status ='B' 
  union all
  Select FS.Finreference,FS.schdate,'Foreclosure Amount ('||FS.Finreference||')' Particulars,FS.Repayamount Debit,0 credit,19 ordby 
  from Finscheduledetails FS inner join (
  Select  T1.Finreference,max(T2.schdate)maxschdate
  from financemain T1 inner join 
  Finscheduledetails T2 on T1.Finreference = T2.Finreference
  where T1.closingstatus='E' 
  group by T1.Finreference) MAS on 
  MAS.Finreference = FS.Finreference and MAS.maxschdate = FS.schdate
	)T1 
	 inner join finpftdetails t2 on t2.Finreference=t1.Finreference
	 inner join RMTCURRENCIES C on C.ccycode= T2.finccy where (Debit!=0 or credit !=0)]]>
    </createView>
</changeSet>
<changeSet id="4" author="Irfan">
		<addColumn tableName="VASRECORDING">
			<column name="PaidAmt" type="decimal(18,0)"/>
			<column name="WaivedAmt" type="decimal(18,0)"/>
		</addColumn>
	</changeSet>
	
	<changeSet id="5" author="Irfan">
		<addColumn tableName="VASRECORDING_TEMP">
			<column name="PaidAmt" type="decimal(18,0)"/>
			<column name="WaivedAmt" type="decimal(18,0)"/>
		</addColumn>
	</changeSet>
	<changeSet id="6" author="Irfan">
	<sql>
		Update VASRECORDING set PaidAmt=0;
		Update VASRECORDING set WaivedAmt=0;
		Update VASRECORDING_TEMP set PaidAmt=0;
		Update VASRECORDING_TEMP set WaivedAmt=0;
	</sql>
	</changeSet>
	<changeSet id="7" author="Irfan">
	 <createView viewName="VASRECORDING_VIEW" replaceIfExists="true">
	 		SELECT    T1.ProductCode, T1.PostingAgainst, T1.PrimaryLinkRef, T1.VasReference, T1.Fee, T1.RenewalFee, T1.FeePaymentMode,
          T1.ValueDate, T1.AccrualTillDate, T1.RecurringDate, T1.DsaId, T1.DmaId, T1.FulfilOfficerId,T1.ReferralId,
          T1.Version, T1.LastMntBy, T1.LastMntOn, T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId,
          T1.NextTaskId, T1.RecordType, T1.WorkflowId ,T2.ProductDesc , T3.ROfficerDesc DsaIdDesc,
          T4.ROfficerDesc DmaIdDesc,T5.ROfficerDesc FulfilOfficerIdDesc,T6.ROfficerDesc ReferralIdDesc,
          T7.ProductType, T7.ProductTypeDesc,  T8.ProductCtg, T8.ProductCtgDesc ,T9.DealerName ManufacturerDesc,VasStatus,FinanceProcess, T1.PaidAmt, T1.WaivedAmt
          
          FROM   VASRecording_Temp  T1 LEFT OUTER JOIN
          VasStructure  T2 ON T1.ProductCode = T2.ProductCode LEFT OUTER JOIN
          RelationshipOfficers  T3 ON T1.DsaId = T3.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T4 ON T1.DmaId = T4.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T5 ON T1.FulfilOfficerId = T5.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T6 ON T1.ReferralId = T6.ROfficerCode INNER JOIN 
          VasProductType  T7 ON T7.ProductType = T2.ProductType INNER JOIN
          VasProductCategory  T8 ON T7.ProductCtg = T8.ProductCtg  LEFT OUTER JOIN
          AMTVehicleDealer T9 ON T2.ManufacturerId = T9.DealerId
UNION ALL
SELECT    T1.ProductCode, T1.PostingAgainst, T1.PrimaryLinkRef, T1.VasReference, T1.Fee, T1.RenewalFee, T1.FeePaymentMode,
          T1.ValueDate, T1.AccrualTillDate, T1.RecurringDate, T1.DsaId, T1.DmaId, T1.FulfilOfficerId,T1.ReferralId,
          T1.Version, T1.LastMntBy, T1.LastMntOn, T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId,
          T1.NextTaskId, T1.RecordType, T1.WorkflowId ,T2.ProductDesc , T3.ROfficerDesc DsaIdDesc,
          T4.ROfficerDesc DmaIdDesc,T5.ROfficerDesc FulfilOfficerIdDesc,T6.ROfficerDesc ReferralIdDesc,
          T7.ProductType, T7.ProductTypeDesc,  T8.ProductCtg, T8.ProductCtgDesc ,T9.DealerName ManufacturerDesc,VasStatus,FinanceProcess, T1.PaidAmt, T1.WaivedAmt
          
          FROM   VASRecording  T1 LEFT OUTER JOIN
          VasStructure  T2 ON T1.ProductCode = T2.ProductCode LEFT OUTER JOIN
          RelationshipOfficers  T3 ON T1.DsaId = T3.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T4 ON T1.DmaId = T4.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T5 ON T1.FulfilOfficerId = T5.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T6 ON T1.ReferralId = T6.ROfficerCode INNER JOIN 
          VasProductType  T7 ON T7.ProductType = T2.ProductType INNER JOIN
          VasProductCategory  T8 ON T7.ProductCtg = T8.ProductCtg  LEFT OUTER JOIN
          AMTVehicleDealer T9 ON T2.ManufacturerId = T9.DealerId
          
          WHERE     NOT EXISTS
                    (SELECT     1  FROM          VASRecording_Temp WHERE      VasReference = T1.VasReference)
	 
	 </createView>
	</changeSet>
	<changeSet id="8" author="Irfan">
		<createView viewName="VASRECORDING_AVIEW" replaceIfExists="true">
		
		SELECT    T1.ProductCode, T1.PostingAgainst, T1.PrimaryLinkRef, T1.VasReference, T1.Fee, T1.RenewalFee, T1.FeePaymentMode,
          T1.ValueDate, T1.AccrualTillDate, T1.RecurringDate, T1.DsaId, T1.DmaId, T1.FulfilOfficerId,T1.ReferralId,
          T1.Version, T1.LastMntBy, T1.LastMntOn, T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId,
          T1.NextTaskId, T1.RecordType, T1.WorkflowId ,T2.ProductDesc , T3.ROfficerDesc DsaIdDesc,
          T4.ROfficerDesc DmaIdDesc,T5.ROfficerDesc FulfilOfficerIdDesc,T6.ROfficerDesc ReferralIdDesc,
          T7.ProductType, T7.ProductTypeDesc,  T8.ProductCtg, T8.ProductCtgDesc ,T9.DealerName ManufacturerDesc,VasStatus,FinanceProcess, T1.PaidAmt, T1.WaivedAmt
          
          FROM   VASRecording  T1 LEFT OUTER JOIN
          VasStructure  T2 ON T1.ProductCode = T2.ProductCode LEFT OUTER JOIN
          RelationshipOfficers  T3 ON T1.DsaId = T3.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T4 ON T1.DmaId = T4.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T5 ON T1.FulfilOfficerId = T5.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T6 ON T1.ReferralId = T6.ROfficerCode INNER JOIN 
          VasProductType  T7 ON T7.ProductType = T2.ProductType INNER JOIN
          VasProductCategory  T8 ON T7.ProductCtg = T8.ProductCtg LEFT OUTER JOIN
          AMTVehicleDealer T9 ON T2.ManufacturerId = T9.DealerId
		
		</createView>
	</changeSet>
	<changeSet id="9" author="Irfan">
		<createView viewName="VASRECORDING_TVIEW" replaceIfExists="true">
		
		SELECT    T1.ProductCode, T1.PostingAgainst, T1.PrimaryLinkRef, T1.VasReference, T1.Fee, T1.RenewalFee, T1.FeePaymentMode,
          T1.ValueDate, T1.AccrualTillDate, T1.RecurringDate, T1.DsaId, T1.DmaId, T1.FulfilOfficerId,T1.ReferralId,
          T1.Version, T1.LastMntBy, T1.LastMntOn, T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId,
          T1.NextTaskId, T1.RecordType, T1.WorkflowId ,T2.ProductDesc , T3.ROfficerDesc DsaIdDesc,
          T4.ROfficerDesc DmaIdDesc,T5.ROfficerDesc FulfilOfficerIdDesc,T6.ROfficerDesc ReferralIdDesc,
          T7.ProductType, T7.ProductTypeDesc,  T8.ProductCtg, T8.ProductCtgDesc ,T9.DealerName ManufacturerDesc,VasStatus,FinanceProcess, T2.FeeAccounting, T1.PaidAmt, T1.WaivedAmt
          FROM   VASRecording_Temp  T1 LEFT OUTER JOIN
          VasStructure  T2 ON T1.ProductCode = T2.ProductCode LEFT OUTER JOIN
          RelationshipOfficers  T3 ON T1.DsaId = T3.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T4 ON T1.DmaId = T4.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T5 ON T1.FulfilOfficerId = T5.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T6 ON T1.ReferralId = T6.ROfficerCode INNER JOIN 
          VasProductType  T7 ON T7.ProductType = T2.ProductType INNER JOIN
          VasProductCategory  T8 ON T7.ProductCtg = T8.ProductCtg LEFT OUTER JOIN
          AMTVehicleDealer T9 ON T2.ManufacturerId = T9.DealerId
		
		</createView>
	</changeSet>
	<changeSet id="10" author="Irfan">
			<sql>
				UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
				UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS);
				INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'VASRecordingDialog_WaivedAmt','VASRecordingDialog',0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0;
				INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='VASRECORDING_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='VASRecordingDialog_WaivedAmt'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
				UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
				UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS);
			</sql>
		
		</changeSet>
</databaseChangeLog>