<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />

	<changeSet id="01" author="Madhubabu" >
		<sql>
	Delete from BMTAEEvents where AEEventCode='JVPOST';
	insert into BMTAEEvents values ('JVPOST','Miscellaneous Postings',1,1007,current_timestamp,'Aproved','','','','','',0,1,1,1);
</sql>
</changeSet>
<changeSet id="02" author="Prasad" dbms="oracle">
    <createView viewName="DM_APPLICANT_DETAILS_VIEW" replaceIfExists="true">
        SELECT DISTINCT T1.custcorebank CUSTOMERID,
			CASE WHEN FP.CUSTID IS NOT NULL THEN 'APPLICANT' WHEN FJ.CUSTCIF IS NOT NULL THEN 'CO APPLICANT' WHEN FG.GUARANTORCIF IS NOT NULL  THEN 'GUARANTEER' ELSE 'APPLICANT' END CUST_TYPE,
			T1.CUSTCRCPR PANNO, CUSTADDRHNBR ADDRESS1,T2.CUSTFLATNBR ADDRESS2,CUSTADDRSTREET ADDRESS3,CUSTADDRLINE1 ADDRESS4,CUSTADDRCITY 
			CITY,CUSTADDRPROVINCE STATE,CUSTADDRCOUNTRY COUNTRY,CUSTADDRZIP ZIPCODE,CUSTADDRTYPE ADDRESSTYPE,CUSTEMAIL EMAIL,T41.PHONENUMBER 
			PHONE1,T42.PHONENUMBER PHONE2,T4.PHONENUMBER MOBILE,T5.PHONENUMBER FAX,
			CASE WHEN T1.CUSTCOREBANK IS NULL THEN 'N' ELSE 'Y' END EXISTING_CUST_FLAG,
			CASE WHEN CUSTCTGCODE='RETAIL' THEN 'I' ELSE 'C' END INDIV_CORP_FLAG,
			ROUND(MONTHS_BETWEEN( (SELECT TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')  SYSPARMVALUE FROM SMTPARAMETERS WHERE 
			SYSPARMCODE='APP_DATE'),T1.CUSTDOB)/12) AGE,CUSTDOB DOB,CUSTFNAME FNAME,CUSTMNAME MNAME,CUSTLNAME LNAME,GENDERDESC 
			GENDER,CUSTMARITALSTS MARITAL_STATUS,NOOFDEPENDENTS NO_OF_DEPENDENT,
			ROUND(MONTHS_BETWEEN( (SELECT TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')  SYSPARMVALUE FROM SMTPARAMETERS WHERE 
			SYSPARMCODE='APP_DATE'),T7.CUSTEMPFROM)/12) YEARS_CURRENT_JOB,NULL YEARS_PREV_JOB,NULL QUALIFICATION,NULL RESIDENCETYPE,
			NULL YEARS_CURR_RESI,E.EMPNAME EMPLOYER_DESC,NULL COMPANY_TYPE,T1.CUSTINDUSTRY INDUSTRYID,NULL NATURE_OF_BUSINESS,
			T7.CUSTEMPTYPE EMPLOYMENT_TYPE,T7.CUSTEMPDESG EMPDESG,NULL OCCUPATION,
			 UDF_CONVERTCURRENCY(T1.CUSTTOTALINCOME,'INR','INR')  ANNUAL_INCOME,NULL GUARDIAN,NULL BUSINESSDATE,'N' PROCESSED_FLAG,
			NULL PROCESS_DATE,NULL SEGMENTS,CUSTSHRTNAME CUSTOMERNAME,NULL CONTACT_PERSON_NAME,T1.custtypecode CONSTITUTION,
			BBD.BANKCODE CUST_BANK_NAME,NULL CUST_BANK_BRANCH,NULL EMI_CARD_LIMIT,NULL EMI_CARD_ACCEPT_FLAG,NULL EMI_CARD_SWIPE_FLAG,
			NULL EMI_CARD_ELIG,NULL EMI_CARD_NO,NULL BANK_ECS_MANDATE,
			CASE WHEN M.CUSTID IS NOT NULL THEN 'Y' ELSE 'N' END OPEN_ECS_AVLB,
			M.STARTDATE OPEN_ECS_DATE,
			(SELECT EXTRACT(YEAR FROM (TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')))  SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE') 
			BUSINESS_YEAR,CUSTSALUTATIONCODE TITLE,CUSTEMPNAME COMP_NAME,CUSTEMPFROM  YEARS_CURR_JOB,NULL GRADE,NULL FAMILY_CODE,
			NULL MINOR,NULL GUARDIAN_NEW,CUSTCRCPR UCIN_NO,NULL PREFERRED_ELIGIBILITY,NULL PREFERRED_CARD_ACCEPTANCE,
			NULL PREFERRED_CARD_LIMIT,CUSTDFTBRANCH CUST_BRANCHID,NULL BATCH_ID 
			FROM CUSTOMERS T1 
			LEFT JOIN CUSTOMERADDRESSES T2 ON T1.CUSTID=T2.CUSTID AND CUSTADDRPRIORITY=5
			LEFT JOIN CUSTOMEREMAILS T3 ON T3.CUSTID=T1.CUSTID AND CUSTEMAILPRIORITY=5
			LEFT JOIN CUSTOMERPHONENUMBERS T41 ON T41.PHONECUSTID=T1.CUSTID AND T41.PHONETYPEPRIORITY=5
			LEFT JOIN CUSTOMERPHONENUMBERS T42 ON T42.PHONECUSTID=T1.CUSTID AND T42.PHONETYPEPRIORITY=4
			LEFT JOIN CUSTOMERPHONENUMBERS T4 ON T4.PHONECUSTID=T1.CUSTID AND T4.PHONETYPECODE ='MOBILE'
			LEFT JOIN CUSTOMERPHONENUMBERS T5 ON T5.PHONECUSTID=T1.CUSTID AND T5.PHONETYPECODE= 'FAX'
			LEFT JOIN BMTGENDERS T6 ON T6.GENDERCODE=T1.CUSTGENDERCODE
			LEFT JOIN CUSTOMEREMPDETAILS T7 ON T7.CUSTID = T1.CUSTID AND CURRENTEMPLOYER=1
			LEFT JOIN (SELECT DISTINCT CUSTID FROM FINPFTDETAILS) FP ON FP.CUSTID = T1.CUSTID 
			LEFT JOIN (SELECT DISTINCT CUSTCIF FROM  FINJOINTACCOUNTDETAILS FJ) FJ ON FJ.CUSTCIF = T1.CUSTCIF AND FJ.CUSTCIF  IS NOT NULL
			LEFT JOIN (SELECT DISTINCT GUARANTORCIF FROM FINGUARANTORSDETAILS )FG ON FG.GUARANTORCIF = T1.CUSTCIF AND FG.GUARANTORCIF  IS NOT NULL
			LEFT JOIN EMPLOYERDETAIL E ON E.EMPLOYERID = T7.CUSTEMPNAME
			LEFT JOIN (SELECT CUSTID,MAX(STARTDATE)STARTDATE FROM MANDATES M WHERE OPENMANDATE=1  AND MANDATETYPE='ECS' GROUP BY CUSTID)M ON M.CUSTID = T1.CUSTID
			LEFT JOIN (SELECT B.CUSTID,B.BANKBRANCHID FROM (
			SELECT CUSTID,MAX(LASTMNTON)LASTMNTON 
			FROM BENEFICIARY GROUP BY CUSTID )T  INNER JOIN BENEFICIARY B ON B.CUSTID=T.CUSTID AND B.LASTMNTON=T.LASTMNTON) B ON B.CUSTID =T1.CUSTID
			LEFT JOIN BANKBRANCHES BB ON BB.BANKBRANCHID = B.BANKBRANCHID
			LEFT JOIN BMTBANKDETAIL BBD ON BBD.BANKCODE =BB.BANKCODE
			where T1.custcorebank is not null
    </createView>
</changeSet>
<changeSet id="02" author="Prasad" dbms="mssql">
    <createView viewName="DM_APPLICANT_DETAILS_VIEW" replaceIfExists="true">
        SELECT DISTINCT T1.custcorebank CUSTOMERID,
			CASE WHEN FP.CUSTID IS NOT NULL THEN 'APPLICANT' WHEN FJ.CUSTCIF IS NOT NULL THEN 'CO APPLICANT' WHEN FG.GUARANTORCIF IS NOT NULL  THEN 'GUARANTEER' ELSE 'APPLICANT' END CUST_TYPE,
			T1.CUSTCRCPR PANNO, CUSTADDRHNBR ADDRESS1,T2.CUSTFLATNBR ADDRESS2,CUSTADDRSTREET ADDRESS3,CUSTADDRLINE1 ADDRESS4,CUSTADDRCITY 
			CITY,CUSTADDRPROVINCE STATE,CUSTADDRCOUNTRY COUNTRY,CUSTADDRZIP ZIPCODE,CUSTADDRTYPE ADDRESSTYPE,CUSTEMAIL EMAIL,T41.PHONENUMBER 
			PHONE1,T42.PHONENUMBER PHONE2,T4.PHONENUMBER MOBILE,T5.PHONENUMBER FAX,
			CASE WHEN T1.CUSTCOREBANK IS NULL THEN 'N' ELSE 'Y' END EXISTING_CUST_FLAG,
			CASE WHEN CUSTCTGCODE='RETAIL' THEN 'I' ELSE 'C' END INDIV_CORP_FLAG,
			ROUND(DATEDIFF(month, (SELECT SYSPARMVALUE  SYSPARMVALUE FROM SMTPARAMETERS WHERE 
			SYSPARMCODE='APP_DATE'),T1.CUSTDOB)/12,2) AGE,CUSTDOB DOB,CUSTFNAME FNAME,CUSTMNAME MNAME,CUSTLNAME LNAME,GENDERDESC 
			GENDER,CUSTMARITALSTS MARITAL_STATUS,NOOFDEPENDENTS NO_OF_DEPENDENT,
			ROUND(DATEDIFF( month,(SELECT SYSPARMVALUE  SYSPARMVALUE FROM SMTPARAMETERS WHERE 
			SYSPARMCODE='APP_DATE'),T7.CUSTEMPFROM)/12,2) YEARS_CURRENT_JOB,NULL YEARS_PREV_JOB,NULL QUALIFICATION,NULL RESIDENCETYPE,
			NULL YEARS_CURR_RESI,E.EMPNAME EMPLOYER_DESC,NULL COMPANY_TYPE,T1.CUSTINDUSTRY INDUSTRYID,NULL NATURE_OF_BUSINESS,
			T7.CUSTEMPTYPE EMPLOYMENT_TYPE,T7.CUSTEMPDESG EMPDESG,NULL OCCUPATION,
			dbo.UDF_CONVERTCURRENCY(T1.CUSTTOTALINCOME,'INR','INR')  ANNUAL_INCOME,NULL GUARDIAN,NULL BUSINESSDATE,'N' PROCESSED_FLAG,
			NULL PROCESS_DATE,NULL SEGMENTS,CUSTSHRTNAME CUSTOMERNAME,NULL CONTACT_PERSON_NAME,T1.custtypecode CONSTITUTION,
			BBD.BANKCODE CUST_BANK_NAME,NULL CUST_BANK_BRANCH,NULL EMI_CARD_LIMIT,NULL EMI_CARD_ACCEPT_FLAG,NULL EMI_CARD_SWIPE_FLAG,
			NULL EMI_CARD_ELIG,NULL EMI_CARD_NO,NULL BANK_ECS_MANDATE,
			CASE WHEN M.CUSTID IS NOT NULL THEN 'Y' ELSE 'N' END OPEN_ECS_AVLB,
			M.STARTDATE OPEN_ECS_DATE,
			(SELECT SYSPARMVALUE  SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE') 
			BUSINESS_YEAR,CUSTSALUTATIONCODE TITLE,CUSTEMPNAME COMP_NAME,CUSTEMPFROM  YEARS_CURR_JOB,NULL GRADE,NULL FAMILY_CODE,
			NULL MINOR,NULL GUARDIAN_NEW,CUSTCRCPR UCIN_NO,NULL PREFERRED_ELIGIBILITY,NULL PREFERRED_CARD_ACCEPTANCE,
			NULL PREFERRED_CARD_LIMIT,CUSTDFTBRANCH CUST_BRANCHID,NULL BATCH_ID 
			FROM CUSTOMERS T1 
			LEFT JOIN CUSTOMERADDRESSES T2 ON T1.CUSTID=T2.CUSTID AND CUSTADDRPRIORITY=5
			LEFT JOIN CUSTOMEREMAILS T3 ON T3.CUSTID=T1.CUSTID AND CUSTEMAILPRIORITY=5
			LEFT JOIN CUSTOMERPHONENUMBERS T41 ON T41.PHONECUSTID=T1.CUSTID AND T41.PHONETYPEPRIORITY=5
			LEFT JOIN CUSTOMERPHONENUMBERS T42 ON T42.PHONECUSTID=T1.CUSTID AND T42.PHONETYPEPRIORITY=4
			LEFT JOIN CUSTOMERPHONENUMBERS T4 ON T4.PHONECUSTID=T1.CUSTID AND T4.PHONETYPECODE ='MOBILE'
			LEFT JOIN CUSTOMERPHONENUMBERS T5 ON T5.PHONECUSTID=T1.CUSTID AND T5.PHONETYPECODE= 'FAX'
			LEFT JOIN BMTGENDERS T6 ON T6.GENDERCODE=T1.CUSTGENDERCODE
			LEFT JOIN CUSTOMEREMPDETAILS T7 ON T7.CUSTID = T1.CUSTID AND CURRENTEMPLOYER=1
			LEFT JOIN (SELECT DISTINCT CUSTID FROM FINPFTDETAILS) FP ON FP.CUSTID = T1.CUSTID 
			LEFT JOIN (SELECT DISTINCT CUSTCIF FROM  FINJOINTACCOUNTDETAILS FJ) FJ ON FJ.CUSTCIF = T1.CUSTCIF AND FJ.CUSTCIF  IS NOT NULL
			LEFT JOIN (SELECT DISTINCT GUARANTORCIF FROM FINGUARANTORSDETAILS )FG ON FG.GUARANTORCIF = T1.CUSTCIF AND FG.GUARANTORCIF  IS NOT NULL
			LEFT JOIN EMPLOYERDETAIL E ON E.EMPLOYERID = T7.CUSTEMPNAME
			LEFT JOIN (SELECT CUSTID,MAX(STARTDATE)STARTDATE FROM MANDATES M WHERE OPENMANDATE=1  AND MANDATETYPE='ECS' GROUP BY CUSTID)M ON M.CUSTID = T1.CUSTID
			LEFT JOIN (SELECT B.CUSTID,B.BANKBRANCHID FROM (
			SELECT CUSTID,MAX(LASTMNTON)LASTMNTON 
			FROM BENEFICIARY GROUP BY CUSTID )T  INNER JOIN BENEFICIARY B ON B.CUSTID=T.CUSTID AND B.LASTMNTON=T.LASTMNTON) B ON B.CUSTID =T1.CUSTID
			LEFT JOIN BANKBRANCHES BB ON BB.BANKBRANCHID = B.BANKBRANCHID
			LEFT JOIN BMTBANKDETAIL BBD ON BBD.BANKCODE =BB.BANKCODE
			where T1.custcorebank is not null
    </createView>
</changeSet>
<changeSet id="03" author="Prasad" dbms="oracle">
    <createView viewName="RPT_SOA_TXNDETAILS_VIEW" replaceIfExists="true">
       <![CDATA[ Select T1.Finreference,Schdate,Particulars,Debit,Credit,ccyMinorccyunits,ccyEditField,
		 (Select to_date(sysparmvalue, 'YYYY-MM-DD')  sysparmvalue from smtparameters where SYSPARMCODE='APP_DATE') APP_DATE ,Ordby
		 from ( 
     Select T1.Finreference,Schdate,  'Amount Financed - Payable ('||T1.Finreference||')' Particulars,0  Debit,
			 T1.DisbAmount+(CASE WHEN T1.Schdate = T2.FInStartDate Then T2.feechargeamt else 0 End ) Credit,1 Ordby       
	   from finscheduledetails T1 inner join
          financemain t2 on t1.finreference = t2.finreference
	   where (t2.closingstatus!='C' or t2.closingstatus is null) and 	T1.Disbonschdate=1
      union all
      Select T1.Finreference,T1.LLDate,'Amount Paid Vide '||PaymentType||' :'|| (case when PaymentType in ('CHEQUE','DD') then LLREFERENCENO else Transactionref end)||'('||T1.Finreference||')' ,
    AmtToBeReleased Debit, 0 credit,2 Ordby
    from FINADVANCEPAYMENTS T1 inner join Financemain T2 on T2.Finreference = T1.Finreference
    where (Status not in ('CANCELED','REJECTED') or Status is null)
       union all
		Select T1.Finreference,Schdate, 'Due for Installment '||T1.INSTNUMBER||' ('||T1.Finreference||')'  Particulars,
			  T1.Repayamount-T1.PartialPaidamt Debit, 0  Credit,3 Ordby       
	   from finscheduledetails T1 inner join
          financemain t2 on t1.finreference = t2.finreference
	   where (BPIORHOLIDAY!='H' or BPIORHOLIDAY!='B' or BPIORHOLIDAY is null) and (t2.closingstatus!='C' or t2.closingstatus is null) and 
			 schdate<=(Select to_date(sysparmvalue, 'YYYY-MM-DD')  sysparmvalue from smtparameters where SYSPARMCODE='APP_DATE') and 	T1.Disbonschdate=0
       and T1.Finreference||schdate not in ( Select  T1.Finreference||max(T2.schdate)maxschdate
                                              from financemain T1 inner join 
                                              Finscheduledetails T2 on T1.Finreference = T2.Finreference
                                              where T1.closingstatus='E'
                                              group by T1.Finreference)
  union all
  Select t2.finreference,Schdate,FeeTypeDesc ||'- Due ('||T2.Finreference||')', SchAmount Debit, 0 credit,4 Ordby from finfeescheduledetail T1 
  Inner Join FinFeeDetail T2 on T1.FeeID = T2.FeeID
  Inner Join FeeTypes T3 On T2.FeeTypeid = T3.FeeTypeId 
  inner join financemain t4 on t4.FINREFERENCE =t2.FINREFERENCE
  where SchAmount!=0 and (t4.closingstatus!='C' or t4.closingstatus is null) 
  and  schdate<=(Select to_date(sysparmvalue, 'YYYY-MM-DD')  sysparmvalue from smtparameters where SYSPARMCODE='APP_DATE')  	
union all
     Select T1.Finreference,Schdate,  'Part Prepayment Amount ('||T1.Finreference||')' Particulars,
			T1.PartialPaidamt Debit,0 Credit,5 Ordby       
	   from finscheduledetails T1 inner join
          financemain t2 on t1.finreference = t2.finreference
	   where T1.PartialPaidamt !=0 and  
			 schdate<=(Select to_date(sysparmvalue, 'YYYY-MM-DD')  sysparmvalue from smtparameters where SYSPARMCODE='APP_DATE')  
      union all
  Select T1.Finreference,T2.FInApprovedDate,'Broken Period Interest Receivable- Due('||T1.Finreference||')' Particulars,
			 Repayamount Debit, 0 Credit,6 Ordby
	   from finscheduledetails T1
          inner join Financemain T2 on T2.Finreference = T1.Finreference
	   where BPIORHOLIDAY='B' and Repayamount!=0 and (t2.closingstatus!='C' or t2.closingstatus is null)
  union all
    Select T.Finreference,T1.PostDate,'Amount Paid Vide '||T1.PaymentType||' :'|| (case when T1.PaymentType in ('CHEQUE','DD') then T1.Favournumber else T1.Transactionref end)||'('||T.Finreference||')' ,
    T1.PaymentAmount Debit, 0 credit,7 Ordby
    from paymentheader T inner join
         paymentinstructions T1 on T1.Paymentid =T.Paymentid inner join
         Financemain T2 on T2.Finreference = T.Finreference
        where (T1.Status!='CANCELED' or T1.Status is null) 
              and T1.PostDate<=(Select to_date(sysparmvalue, 'YYYY-MM-DD')  sysparmvalue from smtparameters where SYSPARMCODE='APP_DATE') 
  union all
	Select REFERENCE,T1.Receiptdate,(Case when PAYMENTTYPE NOT in ('EXCESS','CASH') then 'Payment Recieved vide '||PAYMENTTYPE ||' No.:'||PAYMENTREF||' '||FavourNumber ||'('||REFERENCE||')'
										 when PAYMENTTYPE in ('EXCESS') then 'Amount Adjusted ('||REFERENCE||')' 
										 when PAYMENTTYPE in ('CASH') then 'Cash received Vide Receipt No.'||PAYMENTREF ||'('||REFERENCE||')' end) Particulars,
			    Case when PAYMENTTYPE NOT in ('EXCESS') then 0  when PAYMENTTYPE in ('EXCESS') then Amount end debit,Amount credit,8 Ordby
		from FINRECEIPTHEADER T1 inner join 
			 FINRECEIPTDETAIL T2 on T1.RECEIPTID =T2.RECEIPTID 	
       Where (T1.ReceiptModeStatus Not IN ('C') or T1.ReceiptModeStatus is null)
	union all 	
       
        Select REFERENCE,Bouncedate,(Case when PAYMENTTYPE NOT in ('EXCESS','CASH') then 'Payment Bounced For '||PAYMENTTYPE ||' No.:'||FavourNumber ||' ('||REFERENCE||')' 
										 when PAYMENTTYPE in ('CASH') then 'Cash Bounced For Receipt No.'||PAYMENTREF ||'('||REFERENCE||')' end) Particulars,
			   Amount debit, 0 credit,9 Ordby
		from FINRECEIPTHEADER T1 inner join 
         FINRECEIPTDETAIL T2 on T1.RECEIPTID =T2.RECEIPTID And T1.ReceiptMode = T2.PaymentType  inner join
         ManualAdvise T3 on T3.RECEIPTID = T1.RECEIPTID 
       Where T1.ReceiptModeStatus  IN ('B') and T3.Advisetype=1 and T3.Bounceid>0
  union all
		SELECT FINREFERENCE,M.POSTDATE,(CASE WHEN F.FEETYPEID IS NOT NULL THEN FEETYPEDESC 
		else 'Bounce' end) ||'- Due ('||Finreference||')' ,m.ADVISEAMOUNT Debit ,0 Credit ,10 Ordby
		FROM MANUALADVISE M
		LEFT JOIN FEETYPES F ON F.FEETYPEID = M.FEETYPEID 	
		where (M.AdviseType <> 2 or M.AdviseType is null) and 	m.ADVISEAMOUNT >0 and RECEIPTID not in (Select RECEIPTID from PRESENTMENTDETAILS) 
    union all   
    SELECT M.FINREFERENCE,M.POSTDATE,'Bounce - Due for Installment:'||T5.InstNumber||' ('||M.Finreference||')' ,m.ADVISEAMOUNT Debit ,0 Credit ,11 Ordby
		FROM MANUALADVISE M
    INNER Join PRESENTMENTDETAILS T4 on T4.RECEIPTID = M.RECEIPTID and M.RECEIPTID !=0 and T4.RECEIPTID !=0
    INNER Join FINSCHEDULEDETAILS T5 on T4.FInreference = T5.FInreference and T4.schdate = T5.schdate
		where (M.AdviseType <> 2 or M.AdviseType is null) and	m.ADVISEAMOUNT >0 and FEETYPEID not in (Select FEETYPEID from FEETYPES)
  union all
  	SELECT FINREFERENCE,M.POSTDATE, FEETYPEDESC  ||'- Payable ('||Finreference||')' ,0 Debit ,m.ADVISEAMOUNT Credit ,12 Ordby
		FROM MANUALADVISE M
		INNER JOIN FEETYPES F ON F.FEETYPEID = M.FEETYPEID 	
		where M.AdviseType = 2 	and 	m.ADVISEAMOUNT >0  
	union all	  
  Select t2.Finreference,t1.Movementdate,
'Waived Amount '|| (CASE WHEN F.FEETYPEID IS NOT NULL THEN FEETYPEDESC 
		else 'Bounce' end)||'('||t2.Finreference||')' Particulars ,0,t2.WaivedAmount,13 Ordby
from manualadvisemovements t1 
inner join manualadvise t2 on t1.Adviseid = t2.Adviseid
LEFT JOIN FEETYPES F ON F.FEETYPEID = t2.FEETYPEID 
where t2.WaivedAmount>0
union all
    Select T1.Finreference,T3.finstartdate,
    CASE WHEN Feetypedesc is not null Then FeeTypeDesc Else ProductDesc End  ||'- Due ('||T1.Finreference||')', RemainingFee+PaidAmount Debit, 0 credit,14 Ordby
    from finfeedetail T1 
    Left join feetypes T2 on T1.Feetypeid = T2.Feetypeid
    inner join Financemain T3 on T3.Finreference = T1.Finreference
    Left join VasRecording T4 on T1.VasReference = T4.VasReference
    Left Join VasStructure T5 on T4.ProductCode = T5.ProductCode     
    where Originationfee=1 and feeSchedulemethod in ('DISB','POSP') and (RemainingFee+PaidAmount)!=0 and (t3.closingstatus!='C' or t3.closingstatus is null)
union all
    Select T1.Finreference,T1.postdate,
    CASE WHEN Feetypedesc is not null Then FeeTypeDesc Else ProductDesc End  ||'- Due ('||T1.Finreference||')', PaidAmount Debit, 0 credit,15 Ordby
    from finfeedetail T1 
    Left join feetypes T2 on T1.Feetypeid = T2.Feetypeid
    inner join Financemain T3 on T3.Finreference = T1.Finreference
    Left join VasRecording T4 on T1.VasReference = T4.VasReference
    Left Join VasStructure T5 on T4.ProductCode = T5.ProductCode     
    where  (feeSchedulemethod not in ('DISB','POSP') or feeSchedulemethod is null)   and (PaidAmount)!=0 and (t3.closingstatus!='C' or t3.closingstatus is null)

	union all 	
		Select t1.finreference, FinODSchdDate, 'Penalty Due Created for Past due till date ' || to_char(t1.FINODTILLDATE, 'dd/mm/yyyy') Particulars, 
		t1.TotPenaltyAmt Debit, 0 credit,16 Ordby
		From FinODDetails T1 inner join Financemain T2 on T1.Finreference = T2.Finreference where TOtPenaltyAmt > 0 and   (t2.closingstatus!='C' or t2.closingstatus is null)
  union all
  Select T2.Reference,T2.Receiptdate,'TDS Adjustment('||T2.Reference||')' Particulars,0 Debit,T1.PaidAmount credit,17 ordby
  from RECEIPTALLOCATIONDETAIL T1
  inner join FINRECEIPTHEADER T2 on T2.RECEIPTID  = T1.RECEIPTID where T1.ALLOCATIONTYPE='TDS'
  and (T2.ReceiptModeStatus Not IN ('C') or T2.ReceiptModeStatus is null)
  union all  
  Select distinct T2.Reference,Bouncedate,'TDS Adjustment Reversal('||T2.Reference||')' Particulars,T5.TDSSCHDPAYNOW Debit,0 credit, 18 ordby
  from FINRECEIPTHEADER T2
  inner join FINRECEIPTDETAIL T3 on T3.RECEIPTID = T2.RECEIPTID
  inner join finrepayheader T4 on T3.Receiptseqid = T4.Receiptseqid
  inner join (Select repayid,sum(TDSSCHDPAYNOW) TDSSCHDPAYNOW from FinRepayscheduledetail
  where TDSSCHDPAYNOW!=0
  group by repayid) T5 on T5.repayid =T4.repayid
  where T3.Status ='B' 
  union all
  Select FS.Finreference,FS.schdate,'Foreclosure Amount ('||FS.Finreference||')' Particulars,FS.Repayamount Debit,0 credit,19 ordby 
  from Finscheduledetails FS inner join (
  Select  T1.Finreference,max(T2.schdate)maxschdate
  from financemain T1 inner join 
  Finscheduledetails T2 on T1.Finreference = T2.Finreference
  where T1.closingstatus='E' 
  group by T1.Finreference) MAS on 
  MAS.Finreference = FS.Finreference and MAS.maxschdate = FS.schdate
	)T1 
	 inner join finpftdetails t2 on t2.Finreference=t1.Finreference
	 inner join RMTCURRENCIES C on C.ccycode= T2.finccy where (Debit!=0 or credit !=0)]]>
    </createView>
</changeSet>
<changeSet id="03" author="Prasad" dbms="mssql">
    <createView viewName="RPT_SOA_TXNDETAILS_VIEW" replaceIfExists="true">
       <![CDATA[ Select T1.Finreference,Schdate,Particulars,Debit,Credit,ccyMinorccyunits,ccyEditField,
		 (Select sysparmvalue  sysparmvalue from smtparameters where SYSPARMCODE='APP_DATE') APP_DATE ,Ordby
		 from ( 
     Select T1.Finreference,Schdate,  'Amount Financed - Payable ('+T1.Finreference+')' Particulars,0  Debit,
			 T1.DisbAmount+(CASE WHEN T1.Schdate = T2.FInStartDate Then T2.feechargeamt else 0 End ) Credit,1 Ordby       
	   from finscheduledetails T1 inner join
          financemain t2 on t1.finreference = t2.finreference
	   where (t2.closingstatus!='C' or t2.closingstatus is null) and 	T1.Disbonschdate=1
      union all
      Select T1.Finreference,T1.LLDate,'Amount Paid Vide '+PaymentType+' :'+ (case when PaymentType in ('CHEQUE','DD') then LLREFERENCENO else Transactionref end)+'('+T1.Finreference+')' ,
    AmtToBeReleased Debit, 0 credit,2 Ordby
    from FINADVANCEPAYMENTS T1 inner join Financemain T2 on T2.Finreference = T1.Finreference
    where (Status not in ('CANCELED','REJECTED') or Status is null)
       union all
		Select T1.Finreference,Schdate, 'Due for Installment '+T1.INSTNUMBER+' ('+T1.Finreference+')'  Particulars,
			  T1.Repayamount-T1.PartialPaidamt Debit, 0  Credit,3 Ordby       
	   from finscheduledetails T1 inner join
          financemain t2 on t1.finreference = t2.finreference
	   where (BPIORHOLIDAY!='H' or BPIORHOLIDAY!='B' or BPIORHOLIDAY is null) and (t2.closingstatus!='C' or t2.closingstatus is null) and 
			 schdate<=(Select sysparmvalue  sysparmvalue from smtparameters where SYSPARMCODE='APP_DATE') and 	T1.Disbonschdate=0
       and T1.Finreference+schdate not in ( Select  T1.Finreference+max(T2.schdate)maxschdate
                                              from financemain T1 inner join 
                                              Finscheduledetails T2 on T1.Finreference = T2.Finreference
                                              where T1.closingstatus='E'
                                              group by T1.Finreference)
  union all
  Select t2.finreference,Schdate,FeeTypeDesc +'- Due ('+T2.Finreference+')', SchAmount Debit, 0 credit,4 Ordby from finfeescheduledetail T1 
  Inner Join FinFeeDetail T2 on T1.FeeID = T2.FeeID
  Inner Join FeeTypes T3 On T2.FeeTypeid = T3.FeeTypeId 
  inner join financemain t4 on t4.FINREFERENCE =t2.FINREFERENCE
  where SchAmount!=0 and (t4.closingstatus!='C' or t4.closingstatus is null) 
  and  schdate<=(Select sysparmvalue  sysparmvalue from smtparameters where SYSPARMCODE='APP_DATE')  	
union all
     Select T1.Finreference,Schdate,  'Part Prepayment Amount ('+T1.Finreference+')' Particulars,
			T1.PartialPaidamt Debit,0 Credit,5 Ordby       
	   from finscheduledetails T1 inner join
          financemain t2 on t1.finreference = t2.finreference
	   where T1.PartialPaidamt !=0 and  
			 schdate<=(Select sysparmvalue  sysparmvalue from smtparameters where SYSPARMCODE='APP_DATE')  
      union all
  Select T1.Finreference,T2.FInApprovedDate,'Broken Period Interest Receivable- Due('+T1.Finreference+')' Particulars,
			 Repayamount Debit, 0 Credit,6 Ordby
	   from finscheduledetails T1
          inner join Financemain T2 on T2.Finreference = T1.Finreference
	   where BPIORHOLIDAY='B' and Repayamount!=0 and (t2.closingstatus!='C' or t2.closingstatus is null)
  union all
    Select T.Finreference,T1.PostDate,'Amount Paid Vide '+T1.PaymentType+' :'+ (case when T1.PaymentType in ('CHEQUE','DD') then T1.Favournumber else T1.Transactionref end)+'('+T.Finreference+')' ,
    T1.PaymentAmount Debit, 0 credit,7 Ordby
    from paymentheader T inner join
         paymentinstructions T1 on T1.Paymentid =T.Paymentid inner join
         Financemain T2 on T2.Finreference = T.Finreference
        where (T1.Status!='CANCELED' or T1.Status is null) 
              and T1.PostDate<=(Select sysparmvalue  sysparmvalue from smtparameters where SYSPARMCODE='APP_DATE') 
  union all
	Select REFERENCE,T1.Receiptdate,(Case when PAYMENTTYPE NOT in ('EXCESS','CASH') then 'Payment Recieved vide '+PAYMENTTYPE +' No.:'+PAYMENTREF+' '+FavourNumber +'('+REFERENCE+')'
										 when PAYMENTTYPE in ('EXCESS') then 'Amount Adjusted ('+REFERENCE+')' 
										 when PAYMENTTYPE in ('CASH') then 'Cash received Vide Receipt No.'+PAYMENTREF +'('+REFERENCE+')' end) Particulars,
			    Case when PAYMENTTYPE NOT in ('EXCESS') then 0  when PAYMENTTYPE in ('EXCESS') then Amount end debit,Amount credit,8 Ordby
		from FINRECEIPTHEADER T1 inner join 
			 FINRECEIPTDETAIL T2 on T1.RECEIPTID =T2.RECEIPTID 	
       Where (T1.ReceiptModeStatus Not IN ('C') or T1.ReceiptModeStatus is null)
	union all 	
       
        Select REFERENCE,Bouncedate,(Case when PAYMENTTYPE NOT in ('EXCESS','CASH') then 'Payment Bounced For '+PAYMENTTYPE +' No.:'+FavourNumber +' ('+REFERENCE+')' 
										 when PAYMENTTYPE in ('CASH') then 'Cash Bounced For Receipt No.'+PAYMENTREF +'('+REFERENCE+')' end) Particulars,
			   Amount debit, 0 credit,9 Ordby
		from FINRECEIPTHEADER T1 inner join 
         FINRECEIPTDETAIL T2 on T1.RECEIPTID =T2.RECEIPTID And T1.ReceiptMode = T2.PaymentType  inner join
         ManualAdvise T3 on T3.RECEIPTID = T1.RECEIPTID 
       Where T1.ReceiptModeStatus  IN ('B') and T3.Advisetype=1 and T3.Bounceid>0
  union all
		SELECT FINREFERENCE,M.POSTDATE,(CASE WHEN F.FEETYPEID IS NOT NULL THEN FEETYPEDESC 
		else 'Bounce' end) +'- Due ('+Finreference+')' ,m.ADVISEAMOUNT Debit ,0 Credit ,10 Ordby
		FROM MANUALADVISE M
		LEFT JOIN FEETYPES F ON F.FEETYPEID = M.FEETYPEID 	
		where (M.AdviseType <> 2 or M.AdviseType is null) and 	m.ADVISEAMOUNT >0 and RECEIPTID not in (Select RECEIPTID from PRESENTMENTDETAILS) 
    union all   
    SELECT M.FINREFERENCE,M.POSTDATE,'Bounce - Due for Installment:'+T5.InstNumber+' ('+M.Finreference+')' ,m.ADVISEAMOUNT Debit ,0 Credit ,11 Ordby
		FROM MANUALADVISE M
    INNER Join PRESENTMENTDETAILS T4 on T4.RECEIPTID = M.RECEIPTID and M.RECEIPTID !=0 and T4.RECEIPTID !=0
    INNER Join FINSCHEDULEDETAILS T5 on T4.FInreference = T5.FInreference and T4.schdate = T5.schdate
		where (M.AdviseType <> 2 or M.AdviseType is null) and	m.ADVISEAMOUNT >0 and FEETYPEID not in (Select FEETYPEID from FEETYPES)
  union all
  	SELECT FINREFERENCE,M.POSTDATE, FEETYPEDESC  +'- Payable ('+Finreference+')' ,0 Debit ,m.ADVISEAMOUNT Credit ,12 Ordby
		FROM MANUALADVISE M
		INNER JOIN FEETYPES F ON F.FEETYPEID = M.FEETYPEID 	
		where M.AdviseType = 2 	and 	m.ADVISEAMOUNT >0  
	union all	  
  Select t2.Finreference,t1.Movementdate,
'Waived Amount '+ (CASE WHEN F.FEETYPEID IS NOT NULL THEN FEETYPEDESC 
		else 'Bounce' end)+'('+t2.Finreference+')' Particulars ,0,t2.WaivedAmount,13 Ordby
from manualadvisemovements t1 
inner join manualadvise t2 on t1.Adviseid = t2.Adviseid
LEFT JOIN FEETYPES F ON F.FEETYPEID = t2.FEETYPEID 
where t2.WaivedAmount>0
union all
    Select T1.Finreference,T3.finstartdate,
    CASE WHEN Feetypedesc is not null Then FeeTypeDesc Else ProductDesc End  +'- Due ('+T1.Finreference+')', RemainingFee+PaidAmount Debit, 0 credit,14 Ordby
    from finfeedetail T1 
    Left join feetypes T2 on T1.Feetypeid = T2.Feetypeid
    inner join Financemain T3 on T3.Finreference = T1.Finreference
    Left join VasRecording T4 on T1.VasReference = T4.VasReference
    Left Join VasStructure T5 on T4.ProductCode = T5.ProductCode     
    where Originationfee=1 and feeSchedulemethod in ('DISB','POSP') and (RemainingFee+PaidAmount)!=0 and (t3.closingstatus!='C' or t3.closingstatus is null)
union all
    Select T1.Finreference,T1.postdate,
    CASE WHEN Feetypedesc is not null Then FeeTypeDesc Else ProductDesc End  +'- Due ('+T1.Finreference+')', PaidAmount Debit, 0 credit,15 Ordby
    from finfeedetail T1 
    Left join feetypes T2 on T1.Feetypeid = T2.Feetypeid
    inner join Financemain T3 on T3.Finreference = T1.Finreference
    Left join VasRecording T4 on T1.VasReference = T4.VasReference
    Left Join VasStructure T5 on T4.ProductCode = T5.ProductCode     
    where  (feeSchedulemethod not in ('DISB','POSP') or feeSchedulemethod is null)   and (PaidAmount)!=0 and (t3.closingstatus!='C' or t3.closingstatus is null)

	union all 	
		Select t1.finreference, FinODSchdDate, 'Penalty Due Created for Past due till date ' + t1.FINODTILLDATE Particulars, 
		t1.TotPenaltyAmt Debit, 0 credit,16 Ordby
		From FinODDetails T1 inner join Financemain T2 on T1.Finreference = T2.Finreference where TOtPenaltyAmt > 0 and   (t2.closingstatus!='C' or t2.closingstatus is null)
  union all
  Select T2.Reference,T2.Receiptdate,'TDS Adjustment('+T2.Reference+')' Particulars,0 Debit,T1.PaidAmount credit,17 ordby
  from RECEIPTALLOCATIONDETAIL T1
  inner join FINRECEIPTHEADER T2 on T2.RECEIPTID  = T1.RECEIPTID where T1.ALLOCATIONTYPE='TDS'
  and (T2.ReceiptModeStatus Not IN ('C') or T2.ReceiptModeStatus is null)
  union all  
  Select distinct T2.Reference,Bouncedate,'TDS Adjustment Reversal('+T2.Reference+')' Particulars,T5.TDSSCHDPAYNOW Debit,0 credit, 18 ordby
  from FINRECEIPTHEADER T2
  inner join FINRECEIPTDETAIL T3 on T3.RECEIPTID = T2.RECEIPTID
  inner join finrepayheader T4 on T3.Receiptseqid = T4.Receiptseqid
  inner join (Select repayid,sum(TDSSCHDPAYNOW) TDSSCHDPAYNOW from FinRepayscheduledetail
  where TDSSCHDPAYNOW!=0
  group by repayid) T5 on T5.repayid =T4.repayid
  where T3.Status ='B' 
  union all
  Select FS.Finreference,FS.schdate,'Foreclosure Amount ('+FS.Finreference+')' Particulars,FS.Repayamount Debit,0 credit,19 ordby 
  from Finscheduledetails FS inner join (
  Select  T1.Finreference,max(T2.schdate)maxschdate
  from financemain T1 inner join 
  Finscheduledetails T2 on T1.Finreference = T2.Finreference
  where T1.closingstatus='E' 
  group by T1.Finreference) MAS on 
  MAS.Finreference = FS.Finreference and MAS.maxschdate = FS.schdate
	)T1 
	 inner join finpftdetails t2 on t2.Finreference=t1.Finreference
	 inner join RMTCURRENCIES C on C.ccycode= T2.finccy where (Debit!=0 or credit !=0)]]>
    </createView>
</changeSet>
<changeSet id="4" author="Irfan">
		<addColumn tableName="VASRECORDING">
			<column name="PaidAmt" type="decimal(18,0)"/>
			<column name="WaivedAmt" type="decimal(18,0)"/>
		</addColumn>
	</changeSet>
	
	<changeSet id="5" author="Irfan">
		<addColumn tableName="VASRECORDING_TEMP">
			<column name="PaidAmt" type="decimal(18,0)"/>
			<column name="WaivedAmt" type="decimal(18,0)"/>
		</addColumn>
	</changeSet>
	<changeSet id="6" author="Irfan">
	<sql>
		Update VASRECORDING set PaidAmt=0;
		Update VASRECORDING set WaivedAmt=0;
		Update VASRECORDING_TEMP set PaidAmt=0;
		Update VASRECORDING_TEMP set WaivedAmt=0;
	</sql>
	</changeSet>
	<changeSet id="7" author="Irfan">
	 <createView viewName="VASRECORDING_VIEW" replaceIfExists="true">
	 		SELECT    T1.ProductCode, T1.PostingAgainst, T1.PrimaryLinkRef, T1.VasReference, T1.Fee, T1.RenewalFee, T1.FeePaymentMode,
          T1.ValueDate, T1.AccrualTillDate, T1.RecurringDate, T1.DsaId, T1.DmaId, T1.FulfilOfficerId,T1.ReferralId,
          T1.Version, T1.LastMntBy, T1.LastMntOn, T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId,
          T1.NextTaskId, T1.RecordType, T1.WorkflowId ,T2.ProductDesc , T3.ROfficerDesc DsaIdDesc,
          T4.ROfficerDesc DmaIdDesc,T5.ROfficerDesc FulfilOfficerIdDesc,T6.ROfficerDesc ReferralIdDesc,
          T7.ProductType, T7.ProductTypeDesc,  T8.ProductCtg, T8.ProductCtgDesc ,T9.DealerName ManufacturerDesc,VasStatus,FinanceProcess, T1.PaidAmt, T1.WaivedAmt
          
          FROM   VASRecording_Temp  T1 LEFT OUTER JOIN
          VasStructure  T2 ON T1.ProductCode = T2.ProductCode LEFT OUTER JOIN
          RelationshipOfficers  T3 ON T1.DsaId = T3.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T4 ON T1.DmaId = T4.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T5 ON T1.FulfilOfficerId = T5.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T6 ON T1.ReferralId = T6.ROfficerCode INNER JOIN 
          VasProductType  T7 ON T7.ProductType = T2.ProductType INNER JOIN
          VasProductCategory  T8 ON T7.ProductCtg = T8.ProductCtg  LEFT OUTER JOIN
          AMTVehicleDealer T9 ON T2.ManufacturerId = T9.DealerId
UNION ALL
SELECT    T1.ProductCode, T1.PostingAgainst, T1.PrimaryLinkRef, T1.VasReference, T1.Fee, T1.RenewalFee, T1.FeePaymentMode,
          T1.ValueDate, T1.AccrualTillDate, T1.RecurringDate, T1.DsaId, T1.DmaId, T1.FulfilOfficerId,T1.ReferralId,
          T1.Version, T1.LastMntBy, T1.LastMntOn, T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId,
          T1.NextTaskId, T1.RecordType, T1.WorkflowId ,T2.ProductDesc , T3.ROfficerDesc DsaIdDesc,
          T4.ROfficerDesc DmaIdDesc,T5.ROfficerDesc FulfilOfficerIdDesc,T6.ROfficerDesc ReferralIdDesc,
          T7.ProductType, T7.ProductTypeDesc,  T8.ProductCtg, T8.ProductCtgDesc ,T9.DealerName ManufacturerDesc,VasStatus,FinanceProcess, T1.PaidAmt, T1.WaivedAmt
          
          FROM   VASRecording  T1 LEFT OUTER JOIN
          VasStructure  T2 ON T1.ProductCode = T2.ProductCode LEFT OUTER JOIN
          RelationshipOfficers  T3 ON T1.DsaId = T3.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T4 ON T1.DmaId = T4.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T5 ON T1.FulfilOfficerId = T5.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T6 ON T1.ReferralId = T6.ROfficerCode INNER JOIN 
          VasProductType  T7 ON T7.ProductType = T2.ProductType INNER JOIN
          VasProductCategory  T8 ON T7.ProductCtg = T8.ProductCtg  LEFT OUTER JOIN
          AMTVehicleDealer T9 ON T2.ManufacturerId = T9.DealerId
          
          WHERE     NOT EXISTS
                    (SELECT     1  FROM          VASRecording_Temp WHERE      VasReference = T1.VasReference)
	 
	 </createView>
	</changeSet>
	<changeSet id="8" author="Irfan">
		<createView viewName="VASRECORDING_AVIEW" replaceIfExists="true">
		
		SELECT    T1.ProductCode, T1.PostingAgainst, T1.PrimaryLinkRef, T1.VasReference, T1.Fee, T1.RenewalFee, T1.FeePaymentMode,
          T1.ValueDate, T1.AccrualTillDate, T1.RecurringDate, T1.DsaId, T1.DmaId, T1.FulfilOfficerId,T1.ReferralId,
          T1.Version, T1.LastMntBy, T1.LastMntOn, T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId,
          T1.NextTaskId, T1.RecordType, T1.WorkflowId ,T2.ProductDesc , T3.ROfficerDesc DsaIdDesc,
          T4.ROfficerDesc DmaIdDesc,T5.ROfficerDesc FulfilOfficerIdDesc,T6.ROfficerDesc ReferralIdDesc,
          T7.ProductType, T7.ProductTypeDesc,  T8.ProductCtg, T8.ProductCtgDesc ,T9.DealerName ManufacturerDesc,VasStatus,FinanceProcess, T1.PaidAmt, T1.WaivedAmt
          
          FROM   VASRecording  T1 LEFT OUTER JOIN
          VasStructure  T2 ON T1.ProductCode = T2.ProductCode LEFT OUTER JOIN
          RelationshipOfficers  T3 ON T1.DsaId = T3.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T4 ON T1.DmaId = T4.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T5 ON T1.FulfilOfficerId = T5.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T6 ON T1.ReferralId = T6.ROfficerCode INNER JOIN 
          VasProductType  T7 ON T7.ProductType = T2.ProductType INNER JOIN
          VasProductCategory  T8 ON T7.ProductCtg = T8.ProductCtg LEFT OUTER JOIN
          AMTVehicleDealer T9 ON T2.ManufacturerId = T9.DealerId
		
		</createView>
	</changeSet>
	<changeSet id="9" author="Irfan">
		<createView viewName="VASRECORDING_TVIEW" replaceIfExists="true">
		
		SELECT    T1.ProductCode, T1.PostingAgainst, T1.PrimaryLinkRef, T1.VasReference, T1.Fee, T1.RenewalFee, T1.FeePaymentMode,
          T1.ValueDate, T1.AccrualTillDate, T1.RecurringDate, T1.DsaId, T1.DmaId, T1.FulfilOfficerId,T1.ReferralId,
          T1.Version, T1.LastMntBy, T1.LastMntOn, T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId,
          T1.NextTaskId, T1.RecordType, T1.WorkflowId ,T2.ProductDesc , T3.ROfficerDesc DsaIdDesc,
          T4.ROfficerDesc DmaIdDesc,T5.ROfficerDesc FulfilOfficerIdDesc,T6.ROfficerDesc ReferralIdDesc,
          T7.ProductType, T7.ProductTypeDesc,  T8.ProductCtg, T8.ProductCtgDesc ,T9.DealerName ManufacturerDesc,VasStatus,FinanceProcess, T2.FeeAccounting, T1.PaidAmt, T1.WaivedAmt
          FROM   VASRecording_Temp  T1 LEFT OUTER JOIN
          VasStructure  T2 ON T1.ProductCode = T2.ProductCode LEFT OUTER JOIN
          RelationshipOfficers  T3 ON T1.DsaId = T3.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T4 ON T1.DmaId = T4.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T5 ON T1.FulfilOfficerId = T5.ROfficerCode LEFT OUTER JOIN
          RelationshipOfficers  T6 ON T1.ReferralId = T6.ROfficerCode INNER JOIN 
          VasProductType  T7 ON T7.ProductType = T2.ProductType INNER JOIN
          VasProductCategory  T8 ON T7.ProductCtg = T8.ProductCtg LEFT OUTER JOIN
          AMTVehicleDealer T9 ON T2.ManufacturerId = T9.DealerId
		
		</createView>
	</changeSet>
	<changeSet id="10" author="Irfan">
			<sql>
				UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
				UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS);
				INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'VASRecordingDialog_WaivedAmt','VASRecordingDialog',0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0;
				INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='VASRECORDING_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='VASRecordingDialog_WaivedAmt'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
				UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
				UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS);
			</sql>
		
		</changeSet> 
		<changeSet id="11" author="Pruthvi">
		    <sql>
		        update REPORTFILTERFIELDS set fieldtype='DATE' where reportid in 
				(select reportid from REPORTCONFIGURATION where menuitemcode='menu_Item_TransactionEntryReport');
		    </sql>
		</changeSet>
		
	<changeSet id="12" author="Kesav">
	    <sql>
	       update ErrorDetails set ERRORMESSAGE = '{0} should after {1} and before {2}.' where ErrorCode = '90318';
	    </sql>
	</changeSet>
	<changeSet id="13" author="Jayant" dbms="oracle">
	    <sql splitStatements="false">
	        begin
	        	SP_INVALIDVIEWS;
	        	RESEED_SEQUENCE_TABLES;
	        end;
	    </sql>
	</changeSet>
	<changeSet id="14" author="murthy.y">
		<comment>
			<![CDATA[
				Update File Extensions into lower case
			]]>
		</comment>
		<sql>
			<![CDATA[
				update data_engine_config set FILEEXTENSION = '.csv' where FILEEXTENSION = '.CSV';
				update data_engine_config set FILEEXTENSION = '.xlsx' where FILEEXTENSION = '.XLSX';
			]]>
		</sql>
	</changeSet>
	<changeSet id="15" author="Jayant" dbms="oracle">
	    <sql splitStatements="false">
	        begin
	        	SP_INVALIDVIEWS;
	        	RESEED_SEQUENCE_TABLES;
	        end;
	    </sql>
	</changeSet>
	<changeSet id="34" author="Pruthvi" >
		<createView replaceIfExists="true" viewName="DM_APPLICATION_DETAILS_VIEW">

SELECT  ${call.substr}(T2.finreference,-7,7) APPLID,NULL CRM_DEALID,NULL CRSCOREDATE,
			NULL CIBILSCORE,NULL APPSCORE,NULL BEHSCORE,NULL DEVIATION_TYPE,NULL DEVIATION_FLAG,
			NULL DEVIATION_CODE,NULL DEVIATION_NAME,NULL REQ_TENURE,NULL REQ_LOAN_AMT,
			NULL LOAN_LIMIT,T1.TOTALPRISCHD/CCYMINORCCYUNITS APPROVE_LOAN_AMT,NULL LOAN_PURPOSE,
			T1.FINTYPE LOAN_TYPE,CASE WHEN T1.CLOSINGSTATUS='C' THEN T2.LASTMNTON ELSE NULL END CANCELLATIONDATE,
			NULL CANCEL_REASON,${call.substr}(T2.REPAYFRQ,1,1) FREQUENCY,T1.FINAPPROVEDDATE LOAN_APPROVAL_DATE,
			T2.FINCONTRACTDATE AGREEMENTDATE,
			CASE WHEN T1.CURREDUCINGRATE>999 THEN 999 ELSE T1.CURREDUCINGRATE END INTRATE,
			CASE WHEN T2.EFFECTIVERATEOFRETURN>999 THEN 999 ELSE T2.EFFECTIVERATEOFRETURN END FLAT_RATE,
			CASE WHEN T2.EFFECTIVERATEOFRETURN>999 THEN 999 ELSE T2.EFFECTIVERATEOFRETURN END IRR,
			NULL GROSS_LTV,NULL NET_LTV,NULL COF,
			NULL DEBT_BURDEN_RATIO,NULL FOIR_DB,NULL SCHEMEID,NULL SCHEMEDESC,NULL SCHEMEGROUPID,
			NULL SCHEME_GROUPG_DESC,NULL PRODUCT_CATEGORY,T1.FINCATEGORY PROD_TYPE,
			NULL PROMOTIONID,NULL PROGRAMID,NULL SURROGATE_FLAG,NULL SOURCING_CHANNEL_TYPE,
			NULL SOURCING_CHANNEL_NAME,NULL REFERAL_GROUP,NULL REFERAL_NAME,
			NULL COUNTRYID,NULL COUNTRY,NULL REGIONID,NULL REGION,NULL STATEID,
			NULL STATE,NULL CITYID,NULL CITY,T1.FINBRANCH BRANCHID,BRANCHDESC BRANCHDESC,
			NULL BROKER_NAME,NULL DME_NAME,NULL ASM_NAME,C.CUSTRO1 RSM_NAME,
			NULL CRDT_MGR_NAME,NULL ROID_NAME,
			NULL TLID_NAME,NULL BMID_NAME,NULL COID_NAME,NULL SUPPLIERID,
			NULL DLR_PARTICIPATION_RATE,NULL LOCAL_OUTSTATION_FLG,C.custcorebank CUSTOMERID,
			NULL BUSINESSDATE,
			'N' PROCESSED_FLAG,NULL PROCESS_DATE,
			T1.FINTYPE PRODUCT,NULL SEGMENTS,NULL CRM_STATUS,T1.FINSTARTDATE LOGINDATE,T1.FINAPPROVEDDATE APPR_REJ_DATE,
			CASE WHEN T1.CLOSINGSTATUS='C' THEN T2.LASTMNTON ELSE NULL END CANCEL_DATE,
			NULL FILE_STATUS,NULL FILE_HOLD_REASON,NULL QDPDONE,NULL ISHOLD,NULL BRANCH_INW_DATE,
			NULL BRANCH_HOLD_DATE,NULL CPU_INW_DATE,NULL CPU_HOLD_DATE,NULL SYSTEM_HOLD,NULL PSL_FLAG,
			NULL DOC_WAVE_FLAG,NULL CUSTOMER_SWIPE,NULL CUSTOMER_ACCEPTANCE,'PAN CARD' KYC_DOC_TYPE,
			CD.CUSTDOCTITLE KYC_DOC_ID,NULL BUSINESS_IRR,NULL INSPECTORNAME,NULL REGNUMBER,
			NULL BUSINESS_YEAR,NULL DEALID,NULL PRETAXIRR,NULL ODM_FLAG,NULL DI_DATE,
			NULL LAA_QDP_FLAG,NULL PREFERRED_CARD_ACCEPTANCE,
			NULL ORIG_AMTFIN,NULL ELC_FLAG,NULL ELC_LIMIT,NULL QDP_DONE_DATE,
			NULL LAA_DECENTRALIZED_FLAG,NULL FCU_FLAG,
			NULL MKTGID,NULL DM_MPID,NULL SWIPE_CARD_CODE,NULL SOURCE_CARD_CODE,
			NULL DII_USER_ID,NULL QDP_CHEQUE_ISSUE,NULL INTEREST_TYPE,
			NULL DII_DONE_DATE,NULL FINISH_DATE,NULL BATCH_ID 
			FROM FINPFTDETAILS T1
			INNER JOIN FINANCEMAIN T2 ON T1.FINREFERENCE=T2.FINREFERENCE
			INNER JOIN RMTBRANCHES T3 ON T3.BRANCHCODE=T1.FINBRANCH
			INNER JOIN CUSTOMERS C ON C.CUSTID = T2.CUSTID
			INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE=T2.FINCCY
			LEFT JOIN (SELECT DISTINCT CUSTID,CUSTDOCTITLE FROM CUSTOMERDOCUMENTS WHERE CUSTDOCCATEGORY='03') CD ON CD.CUSTID = C.CUSTID
			WHERE ${call.substr}(T2.finreference,-7,7) IS NOT NULL
	</createView>
		</changeSet>
		
		
	<changeSet id="35" author="Pruthvi" >
		<createView replaceIfExists="true" viewName="DM_BOUNCE_DETAILS_VIEW">	
		 SELECT ${call.substr}(T1.finreference,-7,7) APPLID,FAVOURNUMBER CHEQUEID,T1.FINREFERENCE AGREEMENTNO,
		T3.POSTDATE BOUNCE_DATE,T4.BounceCode BOUNCE_REASON,T3.ADVISEAMOUNT BOUNCE_AMT,
		NULL BUSINESSDATE,
		'N' PROCESSED_FLAG,NULL PROCESS_DATE,'' SEGMENTS,CAST(NULL AS NUMERIC(16,2)) BUSINESS_YEAR,'' CHEQUEDATE, NULL BATCH_ID
		FROM FINPFTDETAILS T1 
		INNER JOIN FINRECEIPTHEADER T ON T.REFERENCE = T1.FINREFERENCE 
		INNER JOIN FINRECEIPTDETAIL T2 ON T.RECEIPTID =T2.RECEIPTID AND T.RECEIPTMODE = T2.PAYMENTTYPE  
		INNER JOIN MANUALADVISE T3 ON T3.RECEIPTID = T.RECEIPTID 
		INNER JOIN BOUNCEREASONS T4 ON T4.BOUNCEID =T3.BOUNCEID
		WHERE T.RECEIPTMODESTATUS  IN ('B') AND T.RECEIPTMODE IN ('CHEQUE','DD') AND T3.ADVISETYPE=1 AND T3.BOUNCEID>0
			</createView>
		</changeSet>
				
	<changeSet id="36" author="Pruthvi" dbms="oracle" >
	<createView  replaceIfExists="true" viewName="DM_COAPPLICANT_DTLS_VIEW">
		<![CDATA[SELECT T1.CUSTID CUSTOMERID,T.APPLICANT_TYPE APPLICANT_TYPE,T1.CUSTCRCPR PAN_NO,
		NULL CUST_RELATION,T1.CUSTCTGCODE CUST_TYPE,
		CASE WHEN ROUND(MONTHS_BETWEEN((SELECT TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')  SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE'), T1.CUSTDOB)/12)<=99
		THEN ROUND(MONTHS_BETWEEN((SELECT TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')  SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE'), T1.CUSTDOB)/12) ELSE 99 END AGE,
		CUSTDOB DOB,CUSTFNAME FNAME,CUSTMNAME MNAME,CUSTLNAME LNAME,
		GENDERCODE GENDER,CUSTMARITALSTS MARITAL_STATUS,NOOFDEPENDENTS NO_OF_DEPENDENT,
		ROUND(MONTHS_BETWEEN( (SELECT TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')  SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE'),T7.CUSTEMPFROM)/12)  YRS_CURRENTJOB,
		NULL PREVIOUS_JOB_YEAR,NULL QUALIFICATION,E.EMPNAME EMPLOYER_DESC,
		NULL COMPANY_TYPE,T1.CUSTINDUSTRY INDUSTRYID,T1.CUSTSECTOR BUSINESS_NATURE,
		NULL OCCUPATION_CODE,NULL GUARDIAN,'N' PROCESS_FLAG,
		NULL PROCESS_DATE,CUSTEMPTYPE EMP_TYPE,NULL BUSINESSDATE,
		${add.schema}UDF_CONVERTCURRENCY(CUSTTOTALINCOME,'INR','INR')  INCOME,APPLID APPLID,NULL BATCH_ID 
		FROM CUSTOMERS T1 INNER JOIN 
		(SELECT DISTINCT 'CO APPLICANT' APPLICANT_TYPE,CUSTCIF,${call.substr}(finreference,-7,7) APPLID FROM FINJOINTACCOUNTDETAILS UNION
		SELECT DISTINCT 'GUARANTEER' APPLICANT_TYPE,GUARANTORCIF,${call.substr}(finreference,-7,7) APPLID FROM FINGUARANTORSDETAILS) T ON T.CUSTCIF =T1.CUSTCIF
		LEFT JOIN BMTGENDERS T2 ON T2.GENDERCODE=T1.CUSTGENDERCODE
		LEFT JOIN RMTCUSTTYPES T3 ON T3.CUSTTYPECODE=T1.CUSTTYPECODE
		LEFT JOIN CUSTOMEREMPDETAILS T7 ON T7.CUSTID = T1.CUSTID AND CURRENTEMPLOYER=1
		LEFT JOIN EMPLOYERDETAIL E ON E.EMPLOYERID = T7.CUSTEMPNAME]]>
	
	</createView>
		</changeSet>
		<changeSet id="36" author="Pruthvi" dbms="mssql" >
	<createView  replaceIfExists="true" viewName="DM_COAPPLICANT_DTLS_VIEW">
		<![CDATA[SELECT T1.CUSTID CUSTOMERID,T.APPLICANT_TYPE APPLICANT_TYPE,T1.CUSTCRCPR PAN_NO,
		NULL CUST_RELATION,T1.CUSTCTGCODE CUST_TYPE,
		CASE WHEN ROUND(DATEDIFF(month,(SELECT SYSPARMVALUE SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE'), T1.CUSTDOB)/12,2)<=99
		THEN ROUND(DATEDIFF(month,(SELECT SYSPARMVALUE  SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE'), T1.CUSTDOB)/12,2) ELSE 99 END AGE,
		CUSTDOB DOB,CUSTFNAME FNAME,CUSTMNAME MNAME,CUSTLNAME LNAME,
		GENDERCODE GENDER,CUSTMARITALSTS MARITAL_STATUS,NOOFDEPENDENTS NO_OF_DEPENDENT,
		ROUND(DATEDIFF(month, (SELECT SYSPARMVALUE  SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE'),T7.CUSTEMPFROM)/12,2)  YRS_CURRENTJOB,
		NULL PREVIOUS_JOB_YEAR,NULL QUALIFICATION,E.EMPNAME EMPLOYER_DESC,
		NULL COMPANY_TYPE,T1.CUSTINDUSTRY INDUSTRYID,T1.CUSTSECTOR BUSINESS_NATURE,
		NULL OCCUPATION_CODE,NULL GUARDIAN,'N' PROCESS_FLAG,
		NULL PROCESS_DATE,CUSTEMPTYPE EMP_TYPE,NULL BUSINESSDATE,
		${add.schema}UDF_CONVERTCURRENCY(CUSTTOTALINCOME,'INR','INR')  INCOME,APPLID APPLID,NULL BATCH_ID 
		FROM CUSTOMERS T1 INNER JOIN 
		(SELECT DISTINCT 'CO APPLICANT' APPLICANT_TYPE,CUSTCIF,${call.substr}(finreference,-7,7) APPLID FROM FINJOINTACCOUNTDETAILS UNION
		SELECT DISTINCT 'GUARANTEER' APPLICANT_TYPE,GUARANTORCIF,${call.substr}(finreference,-7,7) APPLID FROM FINGUARANTORSDETAILS) T ON T.CUSTCIF =T1.CUSTCIF
		LEFT JOIN BMTGENDERS T2 ON T2.GENDERCODE=T1.CUSTGENDERCODE
		LEFT JOIN RMTCUSTTYPES T3 ON T3.CUSTTYPECODE=T1.CUSTTYPECODE
		LEFT JOIN CUSTOMEREMPDETAILS T7 ON T7.CUSTID = T1.CUSTID AND CURRENTEMPLOYER=1
		LEFT JOIN EMPLOYERDETAIL E ON E.EMPLOYERID = T7.CUSTEMPNAME]]>
		</createView>
		</changeSet>
	<changeSet id="37" author="Pruthvi" dbms="oracle">
		<createView replaceIfExists="true" viewName="DM_DISB_DETAILS_DAILY_VIEW">	
		<![CDATA[SELECT T2.FINAPPROVEDDATE AGREEMENTDATE,${call.substr}(T2.finreference,-7,7) APPLID,T2.FINREFERENCE AGREEMENTNO,
			T3.DISBSEQ DISBURSEMENTNO,T3.DISBDATE DISBURSEMENTDATE,NULL PARENT_AGREEMENTNO,
			T2.FINAMOUNT/CCYMINORCCYUNITS  AMTFIN,(T2.FINAMOUNT - T2.DOWNPAYMENT + T2.FEECHARGEAMT)/CCYMINORCCYUNITS  NET_AMTFIN,
			T7.DISBAMOUNT/CCYMINORCCYUNITS  DISBURSEDAMT,
			CASE WHEN T2.FINASSETVALUE=T2.FINCURRASSETVALUE THEN 'FULLY DISBURSED' ELSE 'PARTIALLY DISBURSED' END DISB_STATUS,
			T1.FIRSTREPAYDATE FIRST_DUE_DATE,ROUND(MONTHS_BETWEEN( T2.MATURITYDATE,T2.FINSTARTDATE)) GROSS_TENURE,T1.NOINST NET_TENURE,
			T2.MATURITYDATE MATURITYDATE,T2.LASTREPAYDATE EXPIRYDATE,NULL NO_OF_ADV_INSTL,
			NULL ADV_EMI_AMT,T2.FIRSTREPAY EMI,T2.FINREPAYMETHOD REPAYMENT_MODE,
			T2.FINTYPE PRODUCTFLAG,P.PROMOTIONID PROMOTIONID,NULL ICICI_LOMBARD,
			NULL BAGIC,NULL BALIC_CHARGES,
			NULL BUSINESSDATE,
			'N' PROCESSED_FLAG,
			NULL PROCESS_DATE,
			NULL SEGMENTS,T9.TOTALFEE/CCYMINORCCYUNITS FEE,NULL DEALER_SUBV,NULL MANU_SUBV_DED,NULL MANU_SUBV_NDED,
			T2.BPIAMOUNT/CCYMINORCCYUNITS PREEMI,
			NULL EXISTING_LANNO,NULL MORTGAGE_FEE,NULL COMMITMENT_FEE,T10.PROCES_FEE/CCYMINORCCYUNITS  PROCESSING_FEE,
			NULL PRE_EMI_RECEIVABLE,T2.INSURANCEAMT/CCYMINORCCYUNITS INSURANCE,
			T2.FINREPAYMETHOD PAYMENTMODE,CASE when ${call.substr}(T2.REPAYFRQ,1,1)='Y' then 'A' else ${call.substr}(T2.REPAYFRQ,1,1) end FREQ,
			NULL CHEQUENUM,${call.substr}(FA.BENEFICIARYACCNO,1,16)  CUST_ACCT_NO,T5.BANKNAME BANKNAME,T6.MICR MICRCODE,NULL BUSINESS_YEAR,
			NULL EMI_CHARGE,NULL PDC_CHARGE,CASE WHEN T2.EFFECTIVERATEOFRETURN>999 THEN 999 ELSE T2.EFFECTIVERATEOFRETURN END IRR_PER,
			T9.TOTALFEE/CCYMINORCCYUNITS FEE_WL,
			NULL ELC_CHARGE,NULL CREDIT_VIDYA_FEES,NULL BATCH_ID 
			FROM FINANCEMAIN T2 
			INNER JOIN FINPFTDETAILS T1 ON T1.FINREFERENCE=T2.FINREFERENCE
			INNER JOIN FINDISBURSEMENTDETAILS T3 ON T3.FINREFERENCE=T2.FINREFERENCE
			INNER JOIN RMTFINANCETYPES T4 ON T4.FINTYPE=T2.FINTYPE
			LEFT JOIN BANKBRANCHES T6 ON T6.BRANCHCODE=T2.FINBRANCH 
			LEFT JOIN BMTBANKDETAIL T5 ON T5.BANKCODE=T6.BANKCODE
			LEFT JOIN PROMOTIONS P ON P.PROMOTIONCODE = T2.PROMOTIONCODE
			INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE=T2.FINCCY
			LEFT JOIN (SELECT FINREFERENCE,SUM(DISBAMOUNT) DISBAMOUNT
			FROM FINDISBURSEMENTDETAILS
			WHERE DISBDATE<=(SELECT TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')  SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE')
			GROUP BY FINREFERENCE)T7 ON T7.FINREFERENCE=T2.FINREFERENCE
			LEFT JOIN (SELECT FINREFERENCE,SUM(BALANCEAMT)BALANCEAMT FROM FINEXCESSAMOUNT 
			WHERE AMOUNTTYPE = 'A' GROUP BY FINREFERENCE)T8 ON T8.FINREFERENCE=T2.FINREFERENCE
			LEFT JOIN (SELECT FINREFERENCE,SUM(ACTUALAMOUNT-WAIVEDAMOUNT)TOTALFEE FROM FINFEEDETAIL
			GROUP BY FINREFERENCE)T9 ON T9.FINREFERENCE=T2.FINREFERENCE
			LEFT JOIN (SELECT FINREFERENCE,SUM(ACTUALAMOUNT-WAIVEDAMOUNT)PROCES_FEE 
			FROM FINFEEDETAIL F 
			INNER JOIN FEETYPES FT ON F.FEETYPEID = FT.FEETYPEID
			WHERE FT.FEETYPECODE='PROCFEE'
			GROUP BY FINREFERENCE)T10 ON T10.FINREFERENCE=T2.FINREFERENCE
			LEFT JOIN (SELECT FA.FINREFERENCE,FA.BENEFICIARYACCNO FROM (
			SELECT FINREFERENCE,MAX(PAYMENTSEQ) MAXPAYMENTSEQ FROM FINADVANCEPAYMENTS
			GROUP BY FINREFERENCE)T 
			INNER JOIN FINADVANCEPAYMENTS FA ON FA.FINREFERENCE=T.FINREFERENCE AND FA.PAYMENTSEQ = T.MAXPAYMENTSEQ)FA ON FA.FINREFERENCE=T2.FINREFERENCE]]>
			</createView>
		</changeSet>
		<changeSet id="37" author="Pruthvi" dbms="mssql">
		<createView replaceIfExists="true" viewName="DM_DISB_DETAILS_DAILY_VIEW">	
		<![CDATA[SELECT T2.FINAPPROVEDDATE AGREEMENTDATE,${call.substr}(T2.finreference,-7,7) APPLID,T2.FINREFERENCE AGREEMENTNO,
			T3.DISBSEQ DISBURSEMENTNO,T3.DISBDATE DISBURSEMENTDATE,NULL PARENT_AGREEMENTNO,
			T2.FINAMOUNT/CCYMINORCCYUNITS  AMTFIN,(T2.FINAMOUNT - T2.DOWNPAYMENT + T2.FEECHARGEAMT)/CCYMINORCCYUNITS  NET_AMTFIN,
			T7.DISBAMOUNT/CCYMINORCCYUNITS  DISBURSEDAMT,
			CASE WHEN T2.FINASSETVALUE=T2.FINCURRASSETVALUE THEN 'FULLY DISBURSED' ELSE 'PARTIALLY DISBURSED' END DISB_STATUS,
			T1.FIRSTREPAYDATE FIRST_DUE_DATE,ROUND(DATEDIFF(month, T2.MATURITYDATE,T2.FINSTARTDATE),2) GROSS_TENURE,T1.NOINST NET_TENURE,
			T2.MATURITYDATE MATURITYDATE,T2.LASTREPAYDATE EXPIRYDATE,NULL NO_OF_ADV_INSTL,
			NULL ADV_EMI_AMT,T2.FIRSTREPAY EMI,T2.FINREPAYMETHOD REPAYMENT_MODE,
			T2.FINTYPE PRODUCTFLAG,P.PROMOTIONID PROMOTIONID,NULL ICICI_LOMBARD,
			NULL BAGIC,NULL BALIC_CHARGES,
			NULL BUSINESSDATE,
			'N' PROCESSED_FLAG,
			NULL PROCESS_DATE,
			NULL SEGMENTS,T9.TOTALFEE/CCYMINORCCYUNITS FEE,NULL DEALER_SUBV,NULL MANU_SUBV_DED,NULL MANU_SUBV_NDED,
			T2.BPIAMOUNT/CCYMINORCCYUNITS PREEMI,
			NULL EXISTING_LANNO,NULL MORTGAGE_FEE,NULL COMMITMENT_FEE,T10.PROCES_FEE/CCYMINORCCYUNITS  PROCESSING_FEE,
			NULL PRE_EMI_RECEIVABLE,T2.INSURANCEAMT/CCYMINORCCYUNITS INSURANCE,
			T2.FINREPAYMETHOD PAYMENTMODE,CASE when ${call.substr}(T2.REPAYFRQ,1,1)='Y' then 'A' else ${call.substr}(T2.REPAYFRQ,1,1) end FREQ,
			NULL CHEQUENUM,${call.substr}(FA.BENEFICIARYACCNO,1,16)  CUST_ACCT_NO,T5.BANKNAME BANKNAME,T6.MICR MICRCODE,NULL BUSINESS_YEAR,
			NULL EMI_CHARGE,NULL PDC_CHARGE,CASE WHEN T2.EFFECTIVERATEOFRETURN>999 THEN 999 ELSE T2.EFFECTIVERATEOFRETURN END IRR_PER,
			T9.TOTALFEE/CCYMINORCCYUNITS FEE_WL,
			NULL ELC_CHARGE,NULL CREDIT_VIDYA_FEES,NULL BATCH_ID 
			FROM FINANCEMAIN T2 
			INNER JOIN FINPFTDETAILS T1 ON T1.FINREFERENCE=T2.FINREFERENCE
			INNER JOIN FINDISBURSEMENTDETAILS T3 ON T3.FINREFERENCE=T2.FINREFERENCE
			INNER JOIN RMTFINANCETYPES T4 ON T4.FINTYPE=T2.FINTYPE
			LEFT JOIN BANKBRANCHES T6 ON T6.BRANCHCODE=T2.FINBRANCH 
			LEFT JOIN BMTBANKDETAIL T5 ON T5.BANKCODE=T6.BANKCODE
			LEFT JOIN PROMOTIONS P ON P.PROMOTIONCODE = T2.PROMOTIONCODE
			INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE=T2.FINCCY
			LEFT JOIN (SELECT FINREFERENCE,SUM(DISBAMOUNT) DISBAMOUNT
			FROM FINDISBURSEMENTDETAILS
			WHERE DISBDATE<=(SELECT SYSPARMVALUE  SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE')
			GROUP BY FINREFERENCE)T7 ON T7.FINREFERENCE=T2.FINREFERENCE
			LEFT JOIN (SELECT FINREFERENCE,SUM(BALANCEAMT)BALANCEAMT FROM FINEXCESSAMOUNT 
			WHERE AMOUNTTYPE = 'A' GROUP BY FINREFERENCE)T8 ON T8.FINREFERENCE=T2.FINREFERENCE
			LEFT JOIN (SELECT FINREFERENCE,SUM(ACTUALAMOUNT-WAIVEDAMOUNT)TOTALFEE FROM FINFEEDETAIL
			GROUP BY FINREFERENCE)T9 ON T9.FINREFERENCE=T2.FINREFERENCE
			LEFT JOIN (SELECT FINREFERENCE,SUM(ACTUALAMOUNT-WAIVEDAMOUNT)PROCES_FEE 
			FROM FINFEEDETAIL F 
			INNER JOIN FEETYPES FT ON F.FEETYPEID = FT.FEETYPEID
			WHERE FT.FEETYPECODE='PROCFEE'
			GROUP BY FINREFERENCE)T10 ON T10.FINREFERENCE=T2.FINREFERENCE
			LEFT JOIN (SELECT FA.FINREFERENCE,FA.BENEFICIARYACCNO FROM (
			SELECT FINREFERENCE,MAX(PAYMENTSEQ) MAXPAYMENTSEQ FROM FINADVANCEPAYMENTS
			GROUP BY FINREFERENCE)T 
			INNER JOIN FINADVANCEPAYMENTS FA ON FA.FINREFERENCE=T.FINREFERENCE AND FA.PAYMENTSEQ = T.MAXPAYMENTSEQ)FA ON FA.FINREFERENCE=T2.FINREFERENCE]]>
			</createView>
		</changeSet>
				
	<changeSet id="38" author="Pruthvi" >
		<createView replaceIfExists="true" viewName="DM_HTS_UNADJUSTED_AMT_VIEW">	
		SELECT ${call.substr}(T1.finreference,-7,7) APPLID, BALANCEAMT/CCYMINORCCYUNITS  UNADJUSTED_AMOUNT,
		NULL BUSINESSDATE,NULL BATCH_ID 
		FROM FINANCEMAIN T1 
		INNER JOIN (SELECT FINREFERENCE,SUM(BALANCEAMT)BALANCEAMT FROM FINEXCESSAMOUNT
		GROUP BY FINREFERENCE)T2 ON T1.FINREFERENCE =T2.FINREFERENCE
		INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T1.FINCCY
			</createView>
		</changeSet>
		
				
	<changeSet id="39" author="Pruthvi" >
		<createView replaceIfExists="true" viewName="DM_INSURANCE_DETAILS_VIEW">	
		SELECT ${call.substr}(T1.finreference,-7,7) APPLID,T1.FINREFERENCE AGREEMENTNO,NULL ASSETID,T2.HOSTFEETYPECODE 
			INSURANCE_TYPE,T2.VASFEEAMT INSUR_PREMIUM,NULL INSURANCE_RENEWAL_DATE,NULL BUSINESSDATE,'N' PROCESSED_FLAG,NULL PROCESS_DATE,NULL  
			SEGMENTS,NULL BUSINESS_YEAR,NULL POLICY_TENURE,NULL SUM_ASSURED,NULL NOMINEE_NAME,NULL GOOD_HEALTH,NULL CRITICAL_ILLNESS_FLAG, 
			NULL RELATIONSHIP,NULL NOMINEE_ADDRESS,NULL NOMINEE_RELATION,NULL NOMINEE_DOB,NULL NOMINEE_AGE,NULL NOMINEE_CONTACTNO,NULL 
			NOMINEE_NAME2,NULL NOMINEE_ADDRESS2,NULL NOMINEE_RELATION2,NULL NOMINEE_DOB2,NULL NOMINEE_AGE2,NULL NOMINEE_CONTACTNO2,NULL 
			DFGH,NULL BATCH_ID 
			FROM FINANCEMAIN T1 
			INNER JOIN (SELECT T1.FINREFERENCE,HOSTFEETYPECODE,SUM(ACTUALAMOUNT-WAIVEDAMOUNT)VASFEEAMT FROM FINFEEDETAIL T1 
			LEFT JOIN FEETYPES T2 ON T1.FEETYPEID = T2.FEETYPEID
			LEFT JOIN VASRECORDING T4 ON T1.VASREFERENCE = T4.VASREFERENCE
			WHERE HOSTFEETYPECODE IS NOT NULL 
			GROUP BY T1.FINREFERENCE,HOSTFEETYPECODE) T2 ON T1.FINREFERENCE = T2.FINREFERENCE
			</createView>
		</changeSet>
		
				
	<changeSet id="40" author="Pruthvi" >
		<createView replaceIfExists="true" viewName="DM_LEA_DOC_DTLE_VIEW">	
		SELECT ${call.substr}(T1.finreference,-7,7)  AGREEMENTID,NULL APPLICABLE,
			${call.substr}(T2.finreference,-7,7)  APPLID,NULL APPROVED_BY,NULL AUTHDATE,NULL AUTHID,NULL AWB_NO,NULL BRANCHSTATUS,
			CAST(NULL AS NUMERIC(8,0)) CONSTITUTION,NULL COURIER_NAME,'N' CRITICAL,'P' CUSTOMER_TYPE,
			C.custcorebank  CUSTOMERID,NULL DATE_BRANCH_STATUS,NULL DATELASTUPDT,NULL DOC_CLASSFN,NULL DOC_RETRIEVAL_STATUS,
			CAST(NULL AS NUMERIC(8,0)) DOCID,NULL DOCTYPE,NULL FILE_BARCODE,NULL MAKERDATE,NULL MAKERID,NULL MC_STATUS,NULL NEW_FLAG,
			NULL ORIGINALS,NULL PACKET_TRACKER_NO,NULL PROPERTY_ADDRESS,DOCCATEGORY PROPERTY_CODE,NULL REASON,
			CASE WHEN DOCUMENT_STATUS='COMPLETED' THEN 'Y' ELSE 'N' END RECEIVED,NULL RECEIVEDDATE,NULL REJECTION_REASONS,
			NULL RELEASED_DATE,NULL RELEASED_REMARKS,D.DESCRIPTION REMARKS,'PBD' STAGE,D.RECEIVABLEDATE TARGETDATE,NULL TITLE_DOCUMENT,
			CAST(NULL AS NUMERIC(8,0)) TXNDOCID,NULL VALIDTILLDATE,NULL VAP_LOAN_FLAG,NULL BUSINESSDATE,'N' PROCESSFLAG,NULL PROCESSDATE,
			NULL SEGMENT,NULL REVISED_TARGET_DATE,NULL BATCH_ID
			FROM (SELECT T.FINREFERENCE,COVENANTTYPE DOCCATEGORY,(CASE WHEN ALWWAIVER=1 THEN NULL ELSE T.RECEIVABLEDATE END) RECEIVABLEDATE,
			CASE WHEN ALWWAIVER=1 THEN 'WAIVED' ELSE 'PENDING' END DOCUMENT_STATUS,DESCRIPTION FROM FINCOVENANTTYPE T
			WHERE T.FINREFERENCE${call.concatenate}COVENANTTYPE NOT IN (SELECT REFERENCEID${call.concatenate}DOCCATEGORY  FROM DOCUMENTDETAILS DD)
            UNION ALL
			SELECT REFERENCEID FINREFERENCE,DD.DOCCATEGORY,NULL,'COMPLETED',DESCRIPTION FROM DOCUMENTDETAILS DD 
			LEFT JOIN FINCOVENANTTYPE FC ON FC.FINREFERENCE=DD.REFERENCEID AND FC.COVENANTTYPE = DD.DOCCATEGORY)D 
			INNER JOIN FINPFTDETAILS T1 ON T1.FINREFERENCE=D.FINREFERENCE
			INNER JOIN Customers C on C.custid = T1.custid
			INNER JOIN FINANCEMAIN T2 ON T1.FINREFERENCE=T2.FINREFERENCE
			WHERE ${call.substr}(T1.finreference,-7,7) IS NOT NULL
			</createView>
		</changeSet>
		
				
	<changeSet id="41" author="Pruthvi" >
		<createView replaceIfExists="true" viewName="DM_LOANWISE_CHARGE_DTLS_VIEW">	
		SELECT ${call.substr}(T1.finreference,-7,7)  AGREEMENTID,M.ADVISEID TXNADVICEID,
  Coalesce(M.FEETYPEID,m.bounceid) CHARGEID,NULL CHARGECODEID,coalesce(F.FEETYPEDESC,b.reason) CHARGEDESC,M.ADVISEAMOUNT/CCYMINORCCYUNITS CHARGEAMT,NULL STATUS,
		NULL AMTINPROCESS,M.PAIDAMOUNT/CCYMINORCCYUNITS TXNADJUSTEDAMT,
    M.ADVISEAMOUNT/CCYMINORCCYUNITS ADVICEAMT,M.POSTDATE ADVICEDATE,NULL BUSINESSDATE,
		NULL  PROCESSDATE,'N' PROCESSED_FLAG,'' SEGMENT,NULL BATCH_ID
		FROM FINPFTDETAILS T1
		INNER JOIN FINANCEMAIN T2 ON T1.FINREFERENCE=T2.FINREFERENCE
    INNER JOIN (Select FINREFERENCE,'01'${call.concatenate}FeeId ADVISEID,FEETYPEID,
           (ActualAmount-waivedAmount)ADVISEAMOUNT,PAIDAMOUNT,POSTDATE,null bounceid from finfeedetail 
           where FEETYPEID>0 union all
    Select FINREFERENCE,'02'${call.concatenate}ADVISEID,FEETYPEID,ADVISEAMOUNT,PAIDAMOUNT,POSTDATE,bounceid
    from MANUALADVISE) M ON M.FINREFERENCE=T1.FINREFERENCE
	INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T1.FINCCY
    LEFT JOIN FEETYPES F ON F.FEETYPEID = M.FEETYPEID 	
    left join bouncereasons b on b.bounceid = m.bounceid
    WHERE ${call.substr}(T1.finreference,-7,7) IS NOT NULL
			</createView>
		</changeSet>
		
				
	<changeSet id="42" author="Pruthvi" >
		<createView replaceIfExists="true" viewName="DM_LOANWISE_REPAYSCHEDULE_VIEW">	
		SELECT T1.FINREFERENCE AGREEMENTNO,${call.substr}(T1.finreference,-7,7) AGREEMENTID,
		${call.substr}(T1.finreference,-7,7)${call.concatenate}T2.INSTNUMBER PROPINSTLID,T2.INSTNUMBER EMI_NO,T2.SCHDATE DUEDATE,
		T2.BALANCEFORPFTCAL/CCYMINORCCYUNITS  OPENING_PRINCIPAL,
		T2.REPAYAMOUNT/CCYMINORCCYUNITS  INSTALMENT_AMT,
		T2.PRINCIPALSCHD/CCYMINORCCYUNITS  PRINCIPAL_AMT,
		T2.PROFITSCHD/CCYMINORCCYUNITS  INTEREST_AMT,
		T2.CLOSINGBALANCE/CCYMINORCCYUNITS  CLOSING_PRINCIPAL,T2.SCHDMETHOD INSTAL_TYPE,
		NULL TOTAL_AMOUNT_DUE,
		T1.FINASSETVALUE/CCYMINORCCYUNITS DROPLINE_LIMIT,
		(FINASSETVALUE-FINCURRASSETVALUE)/CCYMINORCCYUNITS ACT_AVAILABLE_LIMIT,
		FP.TOTALPRISCHD/CCYMINORCCYUNITS ACT_UTILISATION_LIMIT,CASE WHEN BPIORHOLIDAY='H' THEN 'Y' ELSE 'N' END EMI_HOLIDAY,
		NULL BATCH_ID,
		NULL BUSINESSDATE
		FROM FINANCEMAIN T1
		INNER JOIN FINPFTDETAILS FP ON T1.FINREFERENCE=FP.FINREFERENCE
		INNER JOIN FINSCHEDULEDETAILS T2 ON T1.FINREFERENCE=T2.FINREFERENCE
		INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T1.FINCCY
    WHERE DISBONSCHDATE=0 and repayamount>0
			</createView>
		</changeSet>
		
				
	<changeSet id="43" author="Pruthvi" dbms="oracle">
		<createView replaceIfExists="true" viewName="DM_LOAN_DETAILS_DAILY_VIEW">	
		SELECT ${call.substr}(T1.finreference,-7,7) APPLID,T1.FINREFERENCE AGREEMENTNO,T3.CUSTID CUSTOMERID,
		EFFECTIVERATEOFRETURN CUSTOMER_YIELD,
		CASE WHEN T1.FINISACTIVE =1 THEN 'ACTIVE' WHEN T1.CLOSINGSTATUS='C' 
		THEN 'CANCELLED' ELSE 'CLOSED' END STATUS,T4.NPABUCKETID NPA_STAGE,NULL LMS_BUCKET,
		NULL COLL_BUCKET,NULL INSURANCE_APPLIED_FLG,
		NULL BUSINESSDATE,
		'N' PROCESSED_FLAG,NULL PROCESS_DATE,
		'LMS-DII' SEGMENTS,T1.MATURITYDATE CLOSUREDATE,
		NULL TOPUP_AMT,(SELECT EXTRACT(YEAR FROM (TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')))SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE') BUSINESS_YEAR,
		M.MANDATEID PDCID,NULL PCFLAG,
		CASE WHEN T1.PRODUCTCATEGORY='ODFCLITY' THEN 'Y' ELSE 'N' END OD_FLAG,
		T1.REPAYMARGIN MARGIN,T1.REPAYSPECIALRATE SPECIALMARGIN,NULL FIXEDTENOR,
		NULL CEEFFECTIVEDATE,T1.REPAYPROFITRATE EFF_RATE,T2.CURREDUCINGRATE PLRRATE,NULL PARTY_CODE,
		COALESCE(T3.CUSTFNAME,'')${call.concatenate}' '${call.concatenate}COALESCE(T3.CUSTMNAME,'')${call.concatenate}' '${call.concatenate}COALESCE(T3.CUSTLNAME,'') PARTY_NAME,
		NULL ZONE,NULL COLLECTION_CENTRE,NULL VIRTUAL_ACCOUNT_NUMBER,
		CASE WHEN T1.schedulemethod='EQUAL' and T1.stepfinance=0 then 'E'
    WHEN T1.schedulemethod='PFT' then 'T'
    WHEN T1.schedulemethod='PRI_PFT' and T1.stepfinance=0 then 'P'
    WHEN T1.schedulemethod='EQUAL' and T1.stepfinance=1 then 'G'
    WHEN T1.schedulemethod='PRI_PFT' and T1.stepfinance=1 then 'R' END INSTALLMENT_TYPE,NULL COMPANYTYPE,
		T1.TOTALPROFIT/CCYMINORCCYUNITS FIANANCE_CHARGES,T1.APPLICATIONNO FILENO,NULL NO_OF_PDCS,
		T9.VasFeeAmt/CCYMINORCCYUNITS LIFEINSURANCE,T6.REMAININGFEE/CCYMINORCCYUNITS SHORTRECEIVED,T3.CUSTSHRTNAME IN_FAVOUR_OFF,NULL MKTGID,
		T7.BALANCEAMT/CCYMINORCCYUNITS PRE_EMI_INT_500071,NULL LOAN_PURPOSE_DTL,NULL LOAN_PURPOSE_DESC,
		T8.TOT_FEE/CCYMINORCCYUNITS LOGIN_FEES,NULL VC_REFERRAL_CD,NULL VC_REFERRAL_NAME,
		NULL PROC_FEES2,T1.FINREPAYMETHOD INSTRUMENT_TYPE,NULL LAN_BARCODE,T1.FINSTARTDATE INTSTART_DATE_REGULAR,
		T1.BPIAMOUNT/CCYMINORCCYUNITS  BPI_RECEIVABLE,NULL BPI_PAYABLE,
		CASE WHEN M.OPENMANDATE=1 THEN 'Y' ELSE 'N' END OPEN_FACILITY_FLAG,NULL BATCH_ID 
		FROM FINANCEMAIN T1
		INNER JOIN FINPFTDETAILS T2 ON T1.FINREFERENCE=T2.FINREFERENCE
		INNER JOIN CUSTOMERS T3 ON T3.CUSTID=T1.CUSTID
		INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T2.FINCCY
		LEFT JOIN FINPROVISIONS T4 ON T4.FINREFERENCE=T1.FINREFERENCE
		LEFT JOIN MANDATES M ON M.ORGREFERENCE =T1.FINREFERENCE AND M.MANDATEID = T1.MANDATEID
		LEFT JOIN (SELECT T1.FINREFERENCE , SUM(REMAININGFEE)REMAININGFEE FROM FINFEEDETAIL T1
		WHERE FEESCHEDULEMETHOD = 'DISB'
		GROUP BY T1.FINREFERENCE) T6 ON T1.FINREFERENCE=T6.FINREFERENCE
		LEFT JOIN (SELECT T1.FINREFERENCE , SUM(BALANCEAMT)BALANCEAMT FROM FINEXCESSAMOUNT T1
		WHERE AMOUNTTYPE = 'A' 
		GROUP BY T1.FINREFERENCE) T7 ON T1.FINREFERENCE=T7.FINREFERENCE
		LEFT JOIN (SELECT T1.FINREFERENCE , SUM(ACTUALAMOUNT-WAIVEDAMOUNT)TOT_FEE FROM FINFEEDETAIL T1
		GROUP BY T1.FINREFERENCE) T8 ON T1.FINREFERENCE=T8.FINREFERENCE
    LEFT JOIN (Select T1.Finreference,SUM(ActualAmount-WaivedAmount)VasFeeAmt from finfeedetail T1 
    Left join feetypes T2 on T1.Feetypeid = T2.Feetypeid
    Left join VasRecording T4 on T1.VasReference = T4.VasReference group by T1.Finreference)T9 ON T1.FINREFERENCE=T9.FINREFERENCE
			</createView>
		</changeSet>
	<changeSet id="43" author="Pruthvi" dbms="mssql">
		<createView replaceIfExists="true" viewName="DM_LOAN_DETAILS_DAILY_VIEW">	
		SELECT ${call.substr}(T1.finreference,-7,7) APPLID,T1.FINREFERENCE AGREEMENTNO,T3.CUSTID CUSTOMERID,
		EFFECTIVERATEOFRETURN CUSTOMER_YIELD,
		CASE WHEN T1.FINISACTIVE =1 THEN 'ACTIVE' WHEN T1.CLOSINGSTATUS='C' 
		THEN 'CANCELLED' ELSE 'CLOSED' END STATUS,T4.NPABUCKETID NPA_STAGE,NULL LMS_BUCKET,
		NULL COLL_BUCKET,NULL INSURANCE_APPLIED_FLG,
		NULL BUSINESSDATE,
		'N' PROCESSED_FLAG,NULL PROCESS_DATE,
		'LMS-DII' SEGMENTS,T1.MATURITYDATE CLOSUREDATE,
		NULL TOPUP_AMT,(SELECT SYSPARMVALUE SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE') BUSINESS_YEAR,
		M.MANDATEID PDCID,NULL PCFLAG,
		CASE WHEN T1.PRODUCTCATEGORY='ODFCLITY' THEN 'Y' ELSE 'N' END OD_FLAG,
		T1.REPAYMARGIN MARGIN,T1.REPAYSPECIALRATE SPECIALMARGIN,NULL FIXEDTENOR,
		NULL CEEFFECTIVEDATE,T1.REPAYPROFITRATE EFF_RATE,T2.CURREDUCINGRATE PLRRATE,NULL PARTY_CODE,
		COALESCE(T3.CUSTFNAME,'')${call.concatenate}' '${call.concatenate}COALESCE(T3.CUSTMNAME,'')${call.concatenate}' '${call.concatenate}COALESCE(T3.CUSTLNAME,'') PARTY_NAME,
		NULL ZONE,NULL COLLECTION_CENTRE,NULL VIRTUAL_ACCOUNT_NUMBER,
		CASE WHEN T1.schedulemethod='EQUAL' and T1.stepfinance=0 then 'E'
    WHEN T1.schedulemethod='PFT' then 'T'
    WHEN T1.schedulemethod='PRI_PFT' and T1.stepfinance=0 then 'P'
    WHEN T1.schedulemethod='EQUAL' and T1.stepfinance=1 then 'G'
    WHEN T1.schedulemethod='PRI_PFT' and T1.stepfinance=1 then 'R' END INSTALLMENT_TYPE,NULL COMPANYTYPE,
		T1.TOTALPROFIT/CCYMINORCCYUNITS FIANANCE_CHARGES,T1.APPLICATIONNO FILENO,NULL NO_OF_PDCS,
		T9.VasFeeAmt/CCYMINORCCYUNITS LIFEINSURANCE,T6.REMAININGFEE/CCYMINORCCYUNITS SHORTRECEIVED,T3.CUSTSHRTNAME IN_FAVOUR_OFF,NULL MKTGID,
		T7.BALANCEAMT/CCYMINORCCYUNITS PRE_EMI_INT_500071,NULL LOAN_PURPOSE_DTL,NULL LOAN_PURPOSE_DESC,
		T8.TOT_FEE/CCYMINORCCYUNITS LOGIN_FEES,NULL VC_REFERRAL_CD,NULL VC_REFERRAL_NAME,
		NULL PROC_FEES2,T1.FINREPAYMETHOD INSTRUMENT_TYPE,NULL LAN_BARCODE,T1.FINSTARTDATE INTSTART_DATE_REGULAR,
		T1.BPIAMOUNT/CCYMINORCCYUNITS  BPI_RECEIVABLE,NULL BPI_PAYABLE,
		CASE WHEN M.OPENMANDATE=1 THEN 'Y' ELSE 'N' END OPEN_FACILITY_FLAG,NULL BATCH_ID 
		FROM FINANCEMAIN T1
		INNER JOIN FINPFTDETAILS T2 ON T1.FINREFERENCE=T2.FINREFERENCE
		INNER JOIN CUSTOMERS T3 ON T3.CUSTID=T1.CUSTID
		INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T2.FINCCY
		LEFT JOIN FINPROVISIONS T4 ON T4.FINREFERENCE=T1.FINREFERENCE
		LEFT JOIN MANDATES M ON M.ORGREFERENCE =T1.FINREFERENCE AND M.MANDATEID = T1.MANDATEID
		LEFT JOIN (SELECT T1.FINREFERENCE , SUM(REMAININGFEE)REMAININGFEE FROM FINFEEDETAIL T1
		WHERE FEESCHEDULEMETHOD = 'DISB'
		GROUP BY T1.FINREFERENCE) T6 ON T1.FINREFERENCE=T6.FINREFERENCE
		LEFT JOIN (SELECT T1.FINREFERENCE , SUM(BALANCEAMT)BALANCEAMT FROM FINEXCESSAMOUNT T1
		WHERE AMOUNTTYPE = 'A' 
		GROUP BY T1.FINREFERENCE) T7 ON T1.FINREFERENCE=T7.FINREFERENCE
		LEFT JOIN (SELECT T1.FINREFERENCE , SUM(ACTUALAMOUNT-WAIVEDAMOUNT)TOT_FEE FROM FINFEEDETAIL T1
		GROUP BY T1.FINREFERENCE) T8 ON T1.FINREFERENCE=T8.FINREFERENCE
    LEFT JOIN (Select T1.Finreference,SUM(ActualAmount-WaivedAmount)VasFeeAmt from finfeedetail T1 
    Left join feetypes T2 on T1.Feetypeid = T2.Feetypeid
    Left join VasRecording T4 on T1.VasReference = T4.VasReference group by T1.Finreference)T9 ON T1.FINREFERENCE=T9.FINREFERENCE
			</createView>
		</changeSet>
				
	<changeSet id="44" author="Pruthvi" >
		<createView replaceIfExists="true" viewName="DM_LOAN_VOUCHER_DETAILS_VIEW">	
		SELECT NULL MODULEID,Case when DSM.FIELDCODEVALUE_char is not null then DSM.FIELDCODEVALUE_char else 'X' end STAGEID,
  P.LINKEDTRANID ${call.concatenate} '-'${call.concatenate}TRANSORDER LEA_VOUCHERID,NULL FA_VOUCHERID,
    Case when DSM.FIELDCODEVALUE_char is not null then DSM.FIELDCODEVALUE_char else 'X' end VOUCHERTYPE,P.POSTDATE VOUCHERDATE,P.VALUEDATE VALUEDATE,RB.BANKREFNO BRANCHID,RB.BRANCHCODE BRANCH_CODE,
    RB.BRANCHDESC BRANCHDESC,RCP.BUSINESSAREA BUSINESS_AREA,AM.PROFITCENTERID PROFIT_CENTRE,FM.FINTYPE PRODUCT_FLAG,
    NULL SCHEMEID,PM.PROMOTIONDESC SCHEMEDESC,NULL ASSIGNMENT,${call.substr}(fm.finreference,-7,7) AGREEMENTID,FM.FINREFERENCE AGREEMENTNO,FM.FINAPPROVEDDATE AGREEMENTDATE,
    FP.FIRSTDISBDATE DISBURSALDATE,FM.FINISACTIVE LOAN_STATUS,FPR.NPABUCKETID NPA_STAGEID,
    ${call.substr}(P.ACCOUNT,1,12) FINNONE_GLID,AT.ACTYPEDESC GROUPGLDESC,AM.HOSTACCOUNT SAPGL_CODE,
    AM.COSTCENTERID COST_CENTRE,
    COALESCE(CASE WHEN P.DRORCR='D' THEN P.POSTAMOUNT END,0) DRAMT,
    COALESCE(CASE WHEN P.DRORCR='C' THEN P.POSTAMOUNT END,0) CRAMT,
    P.DRORCR DRCR_FLAG,P.POSTAMOUNT DRCR_AMT,P.TRANDESC NARRATION,
    NULL CHEQUEID,
    NULL BUSINESSDATE,
    NULL PROCESSDATE,
    NULL SEGMENT,'N' PROCESSED_FLAG,NULL BATCH_ID
    FROM POSTINGS P 
    INNER JOIN FINANCEMAIN FM ON FM.FINREFERENCE=P.FINREFERENCE
    INNER JOIN FINPFTDETAILS FP ON FM.FINREFERENCE=FP.FINREFERENCE
    INNER JOIN RMTBRANCHES RB ON RB.BRANCHCODE = FM.FINBRANCH
    LEFT JOIN RMTCOUNTRYVSPROVINCE RCP ON RCP.CPPROVINCE = RB.BRANCHPROVINCE
    INNER JOIN ACCOUNTMAPPING AM  ON AM.ACCOUNT = P.ACCOUNT
    INNER JOIN RMTACCOUNTTYPES AT   ON AT.ACTYPE = AM.ACCOUNTTYPE
    LEFT JOIN PROMOTIONS PM ON PM.PROMOTIONCODE = FM.PROMOTIONCODE
    LEFT JOIN FINPROVISIONS FPR ON FPR.FINREFERENCE = FM.PROMOTIONCODE
    LEFT JOIN DataMart_Stage_Mapping DSM on DSM.FieldCode = P.FINEVENT and DSM.FieldType='Event'
			</createView>
		</changeSet>
		
				
	<changeSet id="45" author="Pruthvi" >
		<createView replaceIfExists="true" viewName="DM_PREPAYMENT_DETAILS_VIEW">	
		SELECT ${call.substr}(T2.finreference,-7,7)  APPLID,T1.FINREFERENCE AGREEMENTNO,T3.Receiptid PREPAYMENTID,NULL PREPAYMENT_RATE,NULL PREPAYMENT_TYPE,
		NULL PREPAYMENT_PENALTY_DUE,NULL PREPAYMENT_PENALTY_PAID,NULL PREPAYMENT_AMT,
		NULL BUSINESSDATE,'N' PROCESSED_FLAG,
		NULL PROCESS_DATE,
		'' SEGMENTS,'' PREPAYMENT_DATE,CAST(NULL AS NUMERIC(8,0)) BUSINESS_YEAR, NULL BATCH_ID 
		FROM FINPFTDETAILS T1
		INNER JOIN FINANCEMAIN T2 ON T1.FINREFERENCE=T2.FINREFERENCE
    inner join Finreceiptheader T3 on T3.Reference = T1.FINREFERENCE
			</createView>
		</changeSet>
		
				
	<changeSet id="46" author="Pruthvi" >
		<createView replaceIfExists="true" viewName="DM_RESCH_DETAILS_DAILY_VIEW">	
		SELECT  ${call.substr}(T2.finreference,-7,7) APPLID,T2.FINREFERENCE AGREEMENTNO,
		CASE WHEN FINASSETVALUE - FINCURRASSETVALUE > 0 THEN 'PARTIALLY DISBURSED' ELSE 'FULLY DISBURSED' END DISB_STATUS,
		T1.NOINST GROSS_TENURE, T1.NOINST NET_TENURE,T2.MATURITYDATE MATURITYDATE,T2.LASTREPAYDATE EXPIRYDATE,T1.FIRSTREPAYAMT/CCYMINORCCYUNITS  EMI, 
		T2.FINREPAYMETHOD REPAYMENT_MODE,T1.FINTYPE PRODUCTFLAG,
		NULL BUSINESSDATE,'N' PROCESSED_FLAG,
		NULL PROCESS_DATE,
		NULL SEGMENTS,${call.substr}(T2.REPAYFRQ,1,1) FREQ,
		CASE WHEN T1.FINISACTIVE =1 THEN 'ACTIVE' WHEN T1.CLOSINGSTATUS='C' THEN 'CANCELLED' ELSE 'CLOSED' END LOAN_STATUS,T1.MATURITYDATE CLOSUREDATE,
		T1.CUSTCIF CUST_ACCT_NO,T7.BANKNAME BANKNAME,T6.MICR MICRCODE,T6.BRANCHDESC CUST_BANK_BRANCH,
		T8.PCCITYNAME  CUST_BANK_CITY,NULL BUSINESS_YEAR,T3.MANDATEID PDCID,NULL PCFLAG,NULL TIE_UP,
		CASE WHEN REPAYMARGIN>999 THEN 999 ELSE REPAYMARGIN END MARGIN,T2.REPAYSPECIALRATE SPECIALMARGIN,
		T2.NUMBEROFTERMS FIXEDTENOR,NULL CEEFFECTIVEDATE,CASE WHEN T2.EFFECTIVERATEOFRETURN>999 THEN 999 ELSE T2.EFFECTIVERATEOFRETURN END  EFF_RATE,T1.CURREDUCINGRATE 

PLRRATE,
		NULL TIE_UP_WITH,CASE WHEN T1.FINISACTIVE=0 THEN LATESTRPYDATE ELSE NULL END DATE_OF_CLOSURE,T3.Inputdate PDCMS_SEQ_GENERATED_DATE,
		T3.Inputdate INSTRUMENT_DATA_ENTRY_DATE,T2.FINAPPROVEDDATE PAYMENT_AUTHORIZATION_DATE, NULL BATCH_ID
		FROM FINPFTDETAILS T1
		INNER JOIN FINANCEMAIN T2 ON T1.FINREFERENCE=T2.FINREFERENCE
		INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T2.FINCCY
		INNER JOIN MANDATES T3 ON T3.ORGREFERENCE = T2.FINREFERENCE AND T3.ACTIVE=1
		INNER JOIN BANKBRANCHES T6 ON T6.BANKBRANCHID=T3.BANKBRANCHID 
		INNER JOIN BMTBANKDETAIL T7 ON T7.BANKCODE=T6.BANKCODE
		LEFT JOIN RMTPROVINCEVSCITY T8 ON T8.PCCITY = T6.CITY
			</createView>
		</changeSet>
		
				
	<changeSet id="47" author="Pruthvi" dbms="oracle">
		<createView replaceIfExists="true" viewName="DM_SEND_SOA_EMAIL_VIEW">	
		SELECT T1.FINREFERENCE AGREEMENTNO,T1.CUSTID CUSTOMERID,T4.CUSTEMAIL EMAILID,${call.substr}(T2.finreference,-7,7) AGREEMENTID,
		${call.substr}(T2.finreference,-7,7) PROCESSID,
		(SELECT TO_DATE(SYSPARMVALUE, 'YYYY-MM-DD')  SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE')  GENERATION_DATE,
		NULL PROCESSED,T1.FINTYPE PRODUCTFLAG,NULL GROUPID,T5.ACTIVECNT+T6.CLOSECNT TOTAL_LAN,T6.CLOSECNT TOTAL_CLOSED_LAN,T5.ACTIVECNT TOTAL_ACTIVE_LAN,NULL SWIPE_FLAG,NULL 
		EMI_CARD_NO,T1.LATESTDISBDATE DISBURSEMENT_DATE,NULL SUPPLIERID,NULL SUPPLIERDESC,TOTALPRISCHD/CCYMINORCCYUNITS   AMT_FIN,
		FIRSTREPAYAMT/CCYMINORCCYUNITS  EMI,NEXTREPAYDATE NEXT_EMI_DUE_DATE,NULL CHEQUE_BOUNCE_CHARGE, NULL BATCH_ID 
		FROM FINPFTDETAILS T1
		INNER JOIN FINANCEMAIN T2 ON T1.FINREFERENCE=T2.FINREFERENCE
		INNER JOIN CUSTOMERS T3 ON T3.CUSTID=T1.CUSTID
		INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T2.FINCCY
		LEFT JOIN CUSTOMEREMAILS T4 ON T4.CUSTID=T3.CUSTID AND CUSTEMAILPRIORITY=5
		LEFT JOIN (SELECT CUSTID,COUNT(*)ACTIVECNT FROM FINPFTDETAILS
				WHERE (FINISACTIVE=1) GROUP BY CUSTID)T5 ON T1.CUSTID =T5.CUSTID  
		LEFT JOIN (SELECT CUSTID,COUNT(*)CLOSECNT FROM FINPFTDETAILS
				WHERE (FINISACTIVE!=1)GROUP BY CUSTID)T6 ON T1.CUSTID =T6.CUSTID
			</createView>
		</changeSet>
		<changeSet id="47" author="Pruthvi" dbms="mssql">
		<createView replaceIfExists="true" viewName="DM_SEND_SOA_EMAIL_VIEW">	
		SELECT T1.FINREFERENCE AGREEMENTNO,T1.CUSTID CUSTOMERID,T4.CUSTEMAIL EMAILID,${call.substr}(T2.finreference,-7,7) AGREEMENTID,
		${call.substr}(T2.finreference,-7,7) PROCESSID,
		(SELECT SYSPARMVALUE SYSPARMVALUE FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE')  GENERATION_DATE,
		NULL PROCESSED,T1.FINTYPE PRODUCTFLAG,NULL GROUPID,T5.ACTIVECNT+T6.CLOSECNT TOTAL_LAN,T6.CLOSECNT TOTAL_CLOSED_LAN,T5.ACTIVECNT TOTAL_ACTIVE_LAN,NULL SWIPE_FLAG,NULL 
		EMI_CARD_NO,T1.LATESTDISBDATE DISBURSEMENT_DATE,NULL SUPPLIERID,NULL SUPPLIERDESC,TOTALPRISCHD/CCYMINORCCYUNITS   AMT_FIN,
		FIRSTREPAYAMT/CCYMINORCCYUNITS  EMI,NEXTREPAYDATE NEXT_EMI_DUE_DATE,NULL CHEQUE_BOUNCE_CHARGE, NULL BATCH_ID 
		FROM FINPFTDETAILS T1
		INNER JOIN FINANCEMAIN T2 ON T1.FINREFERENCE=T2.FINREFERENCE
		INNER JOIN CUSTOMERS T3 ON T3.CUSTID=T1.CUSTID
		INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T2.FINCCY
		LEFT JOIN CUSTOMEREMAILS T4 ON T4.CUSTID=T3.CUSTID AND CUSTEMAILPRIORITY=5
		LEFT JOIN (SELECT CUSTID,COUNT(*)ACTIVECNT FROM FINPFTDETAILS
				WHERE (FINISACTIVE=1) GROUP BY CUSTID)T5 ON T1.CUSTID =T5.CUSTID  
		LEFT JOIN (SELECT CUSTID,COUNT(*)CLOSECNT FROM FINPFTDETAILS
				WHERE (FINISACTIVE!=1)GROUP BY CUSTID)T6 ON T1.CUSTID =T6.CUSTID
			</createView>
		</changeSet>	
				
	<changeSet id="48" author="Pruthvi" >
		<createView replaceIfExists="true" viewName="DM_SUBQ_DISB_DETAILS_VIEW">	
		SELECT T2.FINAPPROVEDDATE AGREEMENTDATE, ${call.substr}(T2.finreference,-7,7) APPLID,
		T2.FINREFERENCE AGREEMENTNO,T3.DISBSEQ DISBURSEMENTNO,T3.DISBDATE DISBURSEMENTDATE,NULL PARENT_AGREEMENTNO,
		T2.FINAMOUNT/CCYMINORCCYUNITS   AMTFIN, NULL NET_AMTFIN,T3.DISBAMOUNT/CCYMINORCCYUNITS  DISBURSEDAMT,
		T3.DISBISACTIVE DISB_STATUS,T1.FIRSTREPAYDATE FIRST_DUE_DATE,NULL GROSS_TENURE,
		NULL NET_TENURE,T2.MATURITYDATE MATURITYDATE,T2.MATURITYDATE EXPIRYDATE,NULL NO_OF_ADV_INSTL,  
		NULL ADV_EMI_AMT,T2.FIRSTREPAY EMI,T2.FINREPAYMETHOD REPAYMENT_MODE,
		T2.FINTYPE PRODUCTFLAG,NULL PROMOTIONID,NULL  ICICI_LOMBARD,NULL  BAGIC,NULL  BALIC_CHARGES,
		NULL BUSINESSDATE,
		'N' PROCESSED_FLAG,NULL PROCESS_DATE,NULL SEGMENTS,
		NULL  FEE,NULL  DEALER_SUBV,NULL  MANU_SUBV_DED,NULL  MANU_SUBV_NDED,NULL  PREEMI,NULL EXISTING_LANNO,NULL MORTGAGE_FEE,NULL COMMITMENT_FEE,
		NULL PROCESSING_FEE,NULL PRE_EMI_RECEIVABLE,NULL INSURANCE,NULL PAYMENTMODE,${call.substr}(T2.REPAYFRQ,1,1) FREQ,NULL CHEQUENUM,NULL BATCH_ID 
		FROM  FINPFTDETAILS T1 INNER JOIN FINANCEMAIN T2 ON T1.FINREFERENCE=T2.FINREFERENCE
    	INNER JOIN FINDISBURSEMENTDETAILS T3 ON T3.FINREFERENCE=T1.FINREFERENCE
		INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T2.FINCCY
			</createView>
		</changeSet>
		
				
	<changeSet id="49" author="Pruthvi" >
		<createView replaceIfExists="true" viewName="DM_WRITEOFF_DETAILS_VIEW">	
		SELECT  ${call.substr}(T2.finreference,-7,7) APPLID,
		T2.FINREFERENCE AGREEMENTNO,WRITEOFFDATE CHARGEOFF_DT,NULL CHARGEOFF_FLG,
		T1.REMARKS CHARGEOFF_REASON,NULL SETTLEMENT_LOSS,
		(WRITEOFFPRINCIPAL+WRITEOFFPROFIT)/CCYMINORCCYUNITS   GROSS_WRITEOFF_AMT,
		(WRITEOFFPRINCIPAL+WRITEOFFPROFIT)/CCYMINORCCYUNITS   NET_WRITEOFF_AMT,
		NULL BUSINESSDATE,
		'N' PROCESSED_FLAG,NULL PROCESS_DATE,NULL SEGMENTS,
		NULL RECEIPT_ON_CHARGEOFF,NULL BUSINESS_YEAR, NULL BATCH_ID 
		FROM FINWRITEOFFDETAIL T1
		INNER JOIN FINANCEMAIN T2 ON T1.FINREFERENCE=T2.FINREFERENCE
		INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T2.FINCCY
			</createView>
		</changeSet>
		
				
	<changeSet id="50" author="Pruthvi" dbms="oracle">
		<createView replaceIfExists="true" viewName="FORECLOSURECHARGES_VIEW">	
		select 
		${call.substr}(T1.finreference,-7,7) AGREEMENTID,t4.BAL_PRINCIPAL/CCYMINORCCYUNITS  BAL_PRINCIPAL,
    null RESEDUL_VALUE,T4.INSTALLMENTS INSTALLMENTS,T4.ADVICES ADVICES,
    t4.PENALTY/CCYMINORCCYUNITS   PENALTY,
    t4.INTREST_ON_TERMINATION/CCYMINORCCYUNITS  INTREST_ON_TERMINATION,null FLOATINTREST_ON_TERMINATION,
		t4.OVER_DUES/CCYMINORCCYUNITS OVER_DUES,
    t4.OVER_DUES/CCYMINORCCYUNITS CURRENT_OVERDUES,
    t4.CURRENT_WAVEOFFAMT/CCYMINORCCYUNITS CURRENT_WAVEOFFAMT,null OVER_DISTANCE_CHARGES,
		0 INTREST_ON_TERMINATION_PER_DAY,
    t1.PFTACCRUED/CCYMINORCCYUNITS INTREST_ACCRUALS,
    t4.EXCESS_AMOUNT/CCYMINORCCYUNITS EXCESS_AMOUNT,null EXCESS_REFUND,
		null ADVICE,null REBATE,null ADVINSTL,null EXCESSPRINPMNT,null SDAMT,
		null SDINT,null EXCESS_INTREST_RATE,null VAT_ON_FORECLOSURE,null UNDER_DISTANCE_CHARGES,
		T3.NET_PAYBALE/CCYMINORCCYUNITS NET_PAYBALE,
    t3.TotalFeeAmount/CCYMINORCCYUNITS WAIVEOFFAMOUNT,'Foreclosure' ACTIVITY,t3.AUTHORIZEDON AUTHORIZEDON,null COMMITMENT_FEE,null ORIGINATION_FEE,
		null PRE_EMI,(Select to_date(sysparmvalue, 'YYYY-MM-DD')  sysparmvalue from smtparameters where SYSPARMCODE='APP_DATE') BUSINESS_DATE,
		null CHEQUEID,t1.CLOSINGSTATUS STATUS,
    T4.INTEREST_WAIVE_OFF/CCYMINORCCYUNITS INTEREST_WAIVE_OFF,
    T4.BALANCE_PRIN_WAIVE_OFF/CCYMINORCCYUNITS BALANCE_PRIN_WAIVE_OFF,
		t4.INSTALLMET_INT_WAIVE_OFF/CCYMINORCCYUNITS  INSTALLMET_INT_WAIVE_OFF,
    t4.INTEREST_WAIVE_OFF/CCYMINORCCYUNITS WOFF_CURRMONTH_INT,
    t4.WOFF_OVERDUE_CHARGE/CCYMINORCCYUNITS  WOFF_OVERDUE_CHARGE,
    T4.WOFF_CHQBOUNCE_CHARGES/CCYMINORCCYUNITS WOFF_CHQBOUNCE_CHARGES,
		T4.WOFF_OTHERS/CCYMINORCCYUNITS WOFF_OTHERS,
    T4.BALANCE_PRIN_WAIVE_OFF/CCYMINORCCYUNITS INSTALLMENT_PRIN_WAIVE_OFF,
    null WOFF_PARKING_CHARGES,null TOT_OTHER_REPO_CHARGES,
		null WOFF_OTHER_REPO_CHARGES,null TOT_REPOSESSION_CHARGES,null WOFF_REPOSESSION_CHARGES,null TOT_PARKING_CHARGES,null BATCH_ID
		from Finpftdetails t1
		INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T1.FINCCY
    inner join (Select reference,sum(TotFeeAmount)TotalFeeAmount,sum(ReceiptAmount-coalesce(WaviedAmt,0)) NET_PAYBALE,
                MAX(Receiptdate) AUTHORIZEDON from FINRECEIPTHEADER 
                where receiptpurpose = 'EarlySettlement' 
                group by reference)T3 on T3.reference =T1.finreference
    left join  ( Select T1.reference,Count( Case when T3.Finevent='SchdlRepayment' then  T4.Schdate end)INSTALLMENTS,
                        SUM(PriAmount)BAL_PRINCIPAL,SUM(PFTAmount)INTREST_ON_TERMINATION,
                         sum(Coalesce( Case when T3.Finevent='E' then  RepayAMount end,0))EXCESS_AMOUNT,
                         Count( case when m.movementid is not null then m.movementid end)ADVICES,
                         SUM(Case when RA.AllocationType='ODC' THEN RA.PaidAMount end)PENALTY,
                         SUM(Case when RA.AllocationType='LPFT' THEN RA.PaidAMount end)OVER_DUES,
                         SUM(Case when RA.AllocationType is not null THEN RA.WaivedAMount end)CURRENT_WAVEOFFAMT,
                         SUM(Case when RA.AllocationType='PFT' THEN RA.WaivedAMount end)INTEREST_WAIVE_OFF,
                         SUM(Case when RA.AllocationType='PRI' THEN RA.WaivedAMount end)BALANCE_PRIN_WAIVE_OFF,
                         SUM(Case when RA.AllocationType='LPFT' THEN RA.WaivedAMount end)INSTALLMET_INT_WAIVE_OFF,
                         SUM(Case when RA.AllocationType='ODC' THEN RA.WaivedAMount end)WOFF_OVERDUE_CHARGE,
                         SUM(Case when RA.AllocationType='BOUNCE' THEN RA.WaivedAMount end)WOFF_CHQBOUNCE_CHARGES,
                         SUM(Case when RA.AllocationType  not in ('BOUNCE','PFT','PRI','LPFT','ODC') THEN RA.WaivedAMount end)WOFF_OTHERS
                  from FINRECEIPTHEADER T1 inner join 
                         FINRECEIPTDETAIL T2 on T1.RECEIPTID =T2.RECEIPTID inner join 
                         Finrepayheader T3 on T3.Receiptseqid = T2.Receiptseqid  inner join 
                         Finrepayscheduledetail T4 on T4.repayid = T3.repayid left join
                         Manualadvisemovements M on M.Receiptseqid = T2.Receiptseqid left join
                         Receiptallocationdetail RA on RA.RECEIPTID =T1.RECEIPTID
                  where T1.receiptpurpose = 'EarlySettlement'
                        group by T1.reference) T4 on T4.reference =T1.finreference
			</createView>
		</changeSet>
		<changeSet id="50" author="Pruthvi" dbms="mssql">
		<createView replaceIfExists="true" viewName="FORECLOSURECHARGES_VIEW">	
		select 
		${call.substr}(T1.finreference,-7,7) AGREEMENTID,t4.BAL_PRINCIPAL/CCYMINORCCYUNITS  BAL_PRINCIPAL,
    null RESEDUL_VALUE,T4.INSTALLMENTS INSTALLMENTS,T4.ADVICES ADVICES,
    t4.PENALTY/CCYMINORCCYUNITS   PENALTY,
    t4.INTREST_ON_TERMINATION/CCYMINORCCYUNITS  INTREST_ON_TERMINATION,null FLOATINTREST_ON_TERMINATION,
		t4.OVER_DUES/CCYMINORCCYUNITS OVER_DUES,
    t4.OVER_DUES/CCYMINORCCYUNITS CURRENT_OVERDUES,
    t4.CURRENT_WAVEOFFAMT/CCYMINORCCYUNITS CURRENT_WAVEOFFAMT,null OVER_DISTANCE_CHARGES,
		0 INTREST_ON_TERMINATION_PER_DAY,
    t1.PFTACCRUED/CCYMINORCCYUNITS INTREST_ACCRUALS,
    t4.EXCESS_AMOUNT/CCYMINORCCYUNITS EXCESS_AMOUNT,null EXCESS_REFUND,
		null ADVICE,null REBATE,null ADVINSTL,null EXCESSPRINPMNT,null SDAMT,
		null SDINT,null EXCESS_INTREST_RATE,null VAT_ON_FORECLOSURE,null UNDER_DISTANCE_CHARGES,
		T3.NET_PAYBALE/CCYMINORCCYUNITS NET_PAYBALE,
    t3.TotalFeeAmount/CCYMINORCCYUNITS WAIVEOFFAMOUNT,'Foreclosure' ACTIVITY,t3.AUTHORIZEDON AUTHORIZEDON,null COMMITMENT_FEE,null ORIGINATION_FEE,
		null PRE_EMI,(Select to_date(sysparmvalue, 'YYYY-MM-DD')  sysparmvalue from smtparameters where SYSPARMCODE='APP_DATE') BUSINESS_DATE,
		null CHEQUEID,t1.CLOSINGSTATUS STATUS,
    T4.INTEREST_WAIVE_OFF/CCYMINORCCYUNITS INTEREST_WAIVE_OFF,
    T4.BALANCE_PRIN_WAIVE_OFF/CCYMINORCCYUNITS BALANCE_PRIN_WAIVE_OFF,
		t4.INSTALLMET_INT_WAIVE_OFF/CCYMINORCCYUNITS  INSTALLMET_INT_WAIVE_OFF,
    t4.INTEREST_WAIVE_OFF/CCYMINORCCYUNITS WOFF_CURRMONTH_INT,
    t4.WOFF_OVERDUE_CHARGE/CCYMINORCCYUNITS  WOFF_OVERDUE_CHARGE,
    T4.WOFF_CHQBOUNCE_CHARGES/CCYMINORCCYUNITS WOFF_CHQBOUNCE_CHARGES,
		T4.WOFF_OTHERS/CCYMINORCCYUNITS WOFF_OTHERS,
    T4.BALANCE_PRIN_WAIVE_OFF/CCYMINORCCYUNITS INSTALLMENT_PRIN_WAIVE_OFF,
    null WOFF_PARKING_CHARGES,null TOT_OTHER_REPO_CHARGES,
		null WOFF_OTHER_REPO_CHARGES,null TOT_REPOSESSION_CHARGES,null WOFF_REPOSESSION_CHARGES,null TOT_PARKING_CHARGES,null BATCH_ID
		from Finpftdetails t1
		INNER JOIN RMTCURRENCIES RC ON RC.CCYCODE= T1.FINCCY
    inner join (Select reference,sum(TotFeeAmount)TotalFeeAmount,sum(ReceiptAmount-coalesce(WaviedAmt,0)) NET_PAYBALE,
                MAX(Receiptdate) AUTHORIZEDON from FINRECEIPTHEADER 
                where receiptpurpose = 'EarlySettlement' 
                group by reference)T3 on T3.reference =T1.finreference
    left join  ( Select T1.reference,Count( Case when T3.Finevent='SchdlRepayment' then  T4.Schdate end)INSTALLMENTS,
                        SUM(PriAmount)BAL_PRINCIPAL,SUM(PFTAmount)INTREST_ON_TERMINATION,
                         sum(Coalesce( Case when T3.Finevent='E' then  RepayAMount end,0))EXCESS_AMOUNT,
                         Count( case when m.movementid is not null then m.movementid end)ADVICES,
                         SUM(Case when RA.AllocationType='ODC' THEN RA.PaidAMount end)PENALTY,
                         SUM(Case when RA.AllocationType='LPFT' THEN RA.PaidAMount end)OVER_DUES,
                         SUM(Case when RA.AllocationType is not null THEN RA.WaivedAMount end)CURRENT_WAVEOFFAMT,
                         SUM(Case when RA.AllocationType='PFT' THEN RA.WaivedAMount end)INTEREST_WAIVE_OFF,
                         SUM(Case when RA.AllocationType='PRI' THEN RA.WaivedAMount end)BALANCE_PRIN_WAIVE_OFF,
                         SUM(Case when RA.AllocationType='LPFT' THEN RA.WaivedAMount end)INSTALLMET_INT_WAIVE_OFF,
                         SUM(Case when RA.AllocationType='ODC' THEN RA.WaivedAMount end)WOFF_OVERDUE_CHARGE,
                         SUM(Case when RA.AllocationType='BOUNCE' THEN RA.WaivedAMount end)WOFF_CHQBOUNCE_CHARGES,
                         SUM(Case when RA.AllocationType  not in ('BOUNCE','PFT','PRI','LPFT','ODC') THEN RA.WaivedAMount end)WOFF_OTHERS
                  from FINRECEIPTHEADER T1 inner join 
                         FINRECEIPTDETAIL T2 on T1.RECEIPTID =T2.RECEIPTID inner join 
                         Finrepayheader T3 on T3.Receiptseqid = T2.Receiptseqid  inner join 
                         Finrepayscheduledetail T4 on T4.repayid = T3.repayid left join
                         Manualadvisemovements M on M.Receiptseqid = T2.Receiptseqid left join
                         Receiptallocationdetail RA on RA.RECEIPTID =T1.RECEIPTID
                  where T1.receiptpurpose = 'EarlySettlement'
                        group by T1.reference) T4 on T4.reference =T1.finreference
			</createView>
		</changeSet>
		
	<changeSet id="51" author="Pruthvi" >
		<createView replaceIfExists="true" viewName="POSTINGS_VIEW">
		SELECT    T1.LinkedTranId, T1.Postref, T1.PostingId, T1.finReference, T1.FinEvent, T1.PostDate, T1.ValueDate,
	  		T1.AppValueDate,T1.AppDate, T1.TranCode, T1.RevTranCode, T1.DrOrCr, 
                    T1.Account, T1.PostAmount, T1.PostStatus, T1.ErrorId, T1.ErrorMsg, T2.AEEventCodeDesc LovDescEventCodeName, 
                    T1.ShadowPosting, T1.TranDesc, T1.AmountType, T1.AcCcy, T1.PostBranch, T1.Userbranch, T1.TranOrderID, T1.TransOrder
				FROM          Postings T1 INNER JOIN
                     BMTAEEvents T2 ON T1.FinEvent = T2.AEEventCode  
                     inner join financemain T3 on T3.finreference=T1.finreference
  union all
  SELECT    T1.LinkedTranId, T1.Postref, T1.PostingId, T3.Primarylinkref, T1.FinEvent, T1.PostDate, T1.ValueDate,
	  		T1.AppValueDate,T1.AppDate, T1.TranCode, T1.RevTranCode, T1.DrOrCr, 
                    T1.Account, T1.PostAmount, T1.PostStatus, T1.ErrorId, T1.ErrorMsg, T2.AEEventCodeDesc LovDescEventCodeName, 
                    T1.ShadowPosting, T1.TranDesc, T1.AmountType, T1.AcCcy, T1.PostBranch, T1.Userbranch, T1.TranOrderID, T1.TransOrder
				FROM          Postings T1 INNER JOIN
                     BMTAEEvents T2 ON T1.FinEvent = T2.AEEventCode
                     inner join vasrecording T3 on T3.vasreference=T1.finreference
					</createView>
		</changeSet>
</databaseChangeLog>