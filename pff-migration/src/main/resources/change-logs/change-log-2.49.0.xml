<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />

<changeSet id="01" author="Madhubabu">
<createView viewName="CUSTOMERBANKINFO_VIEW" replaceIfExists="true">

SELECT     T1.BankId,T1.CustID, T1.BankName, T1.AccountNumber, T1.AccountType,T1.SalaryAccount, T1.Version, T1.LastMntBy, T1.LastMntOn,
				     T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType,T1.WorkflowId,
				     T3.BankName lovDescBankName,T4.ValueDesc lovDescAccountType
		  FROM       CustomerBankInfo_Temp T1 INNER JOIN 
		             BMTBankDetail T3 ON T3.BankCode = T1.BankName INNER JOIN
		             RMTLovFieldDetail T4 ON T4.FieldCodeValue = T1.AccountType  and T4.fieldCode='ACC_TYPE'
		UNION ALL
		
		  SELECT     T1.BankId,T1.CustID, T1.BankName, T1.AccountNumber, T1.AccountType,T1.SalaryAccount, T1.Version, T1.LastMntBy, T1.LastMntOn,
				     T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType,T1.WorkflowId,
				     T3.BankName lovDescBankName,T4.ValueDesc lovDescAccountType
		  FROM       CustomerBankInfo T1 INNER JOIN 
		             BMTBankDetail T3 ON T3.BankCode = T1.BankName INNER JOIN
		             RMTLovFieldDetail T4 ON T4.FieldCodeValue = T1.AccountType and T4.fieldCode='ACC_TYPE'
		WHERE     NOT EXISTS (SELECT 1 FROM CustomerBankInfo_TEMP WHERE BankId = T1.BankId)

</createView>
<createView viewName="CUSTOMERBANKINFO_VIEW" replaceIfExists="true">

SELECT     T1.BankId,T1.CustID, T1.BankName, T1.AccountNumber, T1.AccountType,T1.SalaryAccount, T1.Version, T1.LastMntBy, T1.LastMntOn,
		     T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType,T1.WorkflowId,
		     T3.BankName lovDescBankName,T4.ValueDesc lovDescAccountType
  FROM       CustomerBankInfo T1 INNER JOIN 
             BMTBankDetail T3 ON T3.BankCode = T1.BankName INNER JOIN
             RMTLovFieldDetail T4 ON T4.FieldCodeValue = T1.AccountType and T4.fieldCode='ACC_TYPE' 
</createView>

</changeSet>


<changeSet id="02" author="Madhubabu">
<createView viewName="CUSTOMERBANKINFO_AVIEW" replaceIfExists="true">
SELECT     T1.BankId,T1.CustID, T1.BankName, T1.AccountNumber, T1.AccountType,T1.SalaryAccount, T1.Version, T1.LastMntBy, T1.LastMntOn,
		     T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType,T1.WorkflowId,
		     T3.BankName lovDescBankName,T4.ValueDesc lovDescAccountType
  FROM       CustomerBankInfo T1 INNER JOIN 
             BMTBankDetail T3 ON T3.BankCode = T1.BankName INNER JOIN
             RMTLovFieldDetail T4 ON T4.FieldCodeValue = T1.AccountType and T4.fieldCode='ACC_TYPE' 
 </createView>
 </changeSet> 
 
 <changeSet id="03" author="Madhubabu">
<createView viewName="CUSTOMERBANKINFO_VIEW" replaceIfExists="true">

SELECT     T1.BankId,T1.CustID, T1.BankName, T1.AccountNumber, T1.AccountType,T1.SalaryAccount, T1.Version, T1.LastMntBy, T1.LastMntOn,
				     T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType,T1.WorkflowId,
				     T3.BankName lovDescBankName,T4.ValueDesc lovDescAccountType
		  FROM       CustomerBankInfo_Temp T1 INNER JOIN 
		             BMTBankDetail T3 ON T3.BankCode = T1.BankName INNER JOIN
		             RMTLovFieldDetail T4 ON T4.FieldCodeValue = T1.AccountType  and T4.fieldCode='ACC_TYPE'
		UNION ALL
		
		  SELECT     T1.BankId,T1.CustID, T1.BankName, T1.AccountNumber, T1.AccountType,T1.SalaryAccount, T1.Version, T1.LastMntBy, T1.LastMntOn,
				     T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType,T1.WorkflowId,
				     T3.BankName lovDescBankName,T4.ValueDesc lovDescAccountType
		  FROM       CustomerBankInfo T1 INNER JOIN 
		             BMTBankDetail T3 ON T3.BankCode = T1.BankName INNER JOIN
		             RMTLovFieldDetail T4 ON T4.FieldCodeValue = T1.AccountType and T4.fieldCode='ACC_TYPE'
		WHERE     NOT EXISTS (SELECT 1 FROM CustomerBankInfo_TEMP WHERE BankId = T1.BankId)

</createView>
</changeSet>
<changeSet id="04" author="Madhubabu">
<sql>
update SMTparameters set rolecode = NULL , nextrolecode = NULL, taskid = NULL , nexttaskid = NULL , recordtype = NULL where sysparmcode =  'HOLDEMI_MAXDAYS';
</sql>
</changeSet>

	<changeSet author="Kesav" id="05">
		<sql>
			Insert into ReportList Values('Promotion', 'Promotion', 'listheader_PromotionCode.label,listheader_PromotionDesc.label,listheader_FinType.label,listheader_PromotionStartDate.label,listheader_PromotionEndDate.label,listheader_RecordStatus.label,listheader_RecordType.label','promotionCode,promotionDesc,finType,startDate,endDate,recordStatus,recordType','String,String,String,Date,Date,String,String','', 'ReportList07', 'Promotions', 'Solution Factory',0, 1000, Current_TimeStamp, 'Approved', null, null, null, null, null, 0,0);
		</sql>
	</changeSet>
	<changeSet author="Madhubabu" id="06">
		<sql>
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS),(SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='COLLATERALSETUP_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='button_CoOwnerDetailDialog_btnUploadCoOwnerProof'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
			Update SeqSecGroupRights Set SeqNo = (Select MAX(GrpRightID) + 1 from SecGroupRights);
		</sql>
	</changeSet>
	
<changeSet id="07" author="Irfan">
	<createTable tableName="LoanStatusCodes">
		<column name="StatusId" type="bigint">
			<constraints nullable="false"/>
		</column>
		<column name="StatusCode" type="varchar(20)">
		<constraints nullable="false"/>
		</column>
		<column name="StatusDesc" type="varchar(8)">
		<constraints nullable="false"/>
		</column>
		<column name="DueFrom" type="int">
		<constraints nullable="false"/>
		</column>
		<column name="DueTo" type="int">
		<constraints nullable="false"/>
		</column>
		<column name="SuspendProfit" type="bit">
		<constraints nullable="false"/>
		</column>
		<column name="Version" type="int" >
		<constraints nullable="false"/>
		</column>
		<column name="LastMntBy" type="bigint"/>
		<column name="LastMntOn" type="datetime"/>
		<column name="RecordStatus" type="varchar(50)"/>
		<column name="RoleCode" type="varchar(100)"/>
		<column name="NextRoleCode" type="varchar(200)"/>
		<column name="TaskId" type="varchar(50)"/>
		<column name="NextTaskId" type="varchar(200)"/>
		<column name="RecordType" type="varchar(50)"/>
		<column name="WorkflowId" type="bigint"/>
	</createTable>
	
	<createTable tableName="LoanStatusCodes_Temp">
		<column name="StatusId" type="bigint">
			<constraints nullable="false"/>
		</column>
		<column name="StatusCode" type="varchar(20)">
		<constraints nullable="false"/>
		</column>
		<column name="StatusDesc" type="varchar(8)">
		<constraints nullable="false"/>
		</column>
		<column name="DueFrom" type="int">
		<constraints nullable="false"/>
		</column>
		<column name="DueTo" type="int">
		<constraints nullable="false"/>
		</column>
		<column name="SuspendProfit" type="bit">
		<constraints nullable="false"/>
		</column>
		<column name="Version" type="int" >
		<constraints nullable="false"/>
		</column>
		<column name="LastMntBy" type="bigint"/>
		<column name="LastMntOn" type="datetime"/>
		<column name="RecordStatus" type="varchar(50)"/>
		<column name="RoleCode" type="varchar(100)"/>
		<column name="NextRoleCode" type="varchar(200)"/>
		<column name="TaskId" type="varchar(50)"/>
		<column name="NextTaskId" type="varchar(200)"/>
		<column name="RecordType" type="varchar(50)"/>
		<column name="WorkflowId" type="bigint"/>
	</createTable>
	
	<createTable tableName="LoanTypeStatusCodes">
		<column name="StatusId" type="bigint">
			<constraints nullable="false"/>
		</column>
		<column name="FinType" type="varchar(8)">
		<constraints nullable="false"/>
		</column>
		<column name="DueFrom" type="int">
		<constraints nullable="false"/>
		</column>
		<column name="DueTO" type="int">
		<constraints nullable="false"/>
		</column>
		<column name="Version" type="int" >
		<constraints nullable="false"/>
		</column>
		<column name="LastMntBy" type="bigint"/>
		<column name="LastMntOn" type="datetime"/>
		<column name="RecordStatus" type="varchar(50)"/>
		<column name="RoleCode" type="varchar(100)"/>
		<column name="NextRoleCode" type="varchar(200)"/>
		<column name="TaskId" type="varchar(50)"/>
		<column name="NextTaskId" type="varchar(200)"/>
		<column name="RecordType" type="varchar(50)"/>
		<column name="WorkflowId" type="bigint"/>
	</createTable>
	<createTable tableName="LoanTypeStatusCodes_Temp">
		<column name="StatusId" type="bigint">
			<constraints nullable="false"/>
		</column>
		<column name="FinType" type="varchar(8)">
		<constraints nullable="false"/>
		</column>
		<column name="DueFrom" type="int">
		<constraints nullable="false"/>
		</column>
		<column name="DueTO" type="int">
		<constraints nullable="false"/>
		</column>
		<column name="Version" type="int" >
		<constraints nullable="false"/>
		</column>
		<column name="LastMntBy" type="bigint"/>
		<column name="LastMntOn" type="datetime"/>
		<column name="RecordStatus" type="varchar(50)"/>
		<column name="RoleCode" type="varchar(100)"/>
		<column name="NextRoleCode" type="varchar(200)"/>
		<column name="TaskId" type="varchar(50)"/>
		<column name="NextTaskId" type="varchar(200)"/>
		<column name="RecordType" type="varchar(50)"/>
		<column name="WorkflowId" type="bigint"/>
	</createTable>
</changeSet>

<changeSet id="08" author="Irfan">
<createView viewName="LoanStatusCodes_View" replaceIfExists="true">

SELECT    StatusId, StatusCode, StatusDesc, DueFrom, DueTo, SuspendProfit, Version, LastMntBy, LastMntOn, RecordStatus, RoleCode, NextRoleCode, TaskId, 
                      NextTaskId, RecordType, WorkflowId
FROM         LoanStatusCodes_TEMP
UNION ALL
SELECT    StatusId, StatusCode, StatusDesc, DueFrom, DueTo, SuspendProfit, Version, LastMntBy, LastMntOn, RecordStatus, RoleCode, NextRoleCode, TaskId, 
                      NextTaskId, RecordType, WorkflowId
FROM         LoanStatusCodes
WHERE     NOT EXISTS
                          (SELECT     1
                            FROM          LoanStatusCodes_TEMP
                            WHERE      StatusId = LoanStatusCodes.StatusId)

</createView>
</changeSet>

<changeSet id="09" author="Irfan">
<createView viewName="LoanStatusCodes_AView" replaceIfExists="true">

SELECT    StatusId, StatusCode, StatusDesc, DueFrom, DueTo, SuspendProfit, Version, LastMntBy, LastMntOn, RecordStatus, RoleCode, NextRoleCode, TaskId, 
                      NextTaskId, RecordType, WorkflowId
FROM         LoanStatusCodes

</createView>
</changeSet>

<changeSet id="10" author="Irfan">
<createView viewName="LoanTypeStatusCodes_View" replaceIfExists="true">

SELECT    StatusId, FinType, DueFrom, DueTo, Version, LastMntBy, LastMntOn, RecordStatus, RoleCode, NextRoleCode, TaskId, 
                      NextTaskId, RecordType, WorkflowId
FROM         LoanTypeStatusCodes_TEMP
UNION ALL
SELECT    StatusId, FinType, DueFrom, DueTo, Version, LastMntBy, LastMntOn, RecordStatus, RoleCode, NextRoleCode, TaskId, 
                      NextTaskId, RecordType, WorkflowId
FROM         LoanTypeStatusCodes
WHERE     NOT EXISTS
                          (SELECT     1
                            FROM          LoanTypeStatusCodes_TEMP
                            WHERE      StatusId = LoanTypeStatusCodes.StatusId)

</createView>
</changeSet>
<changeSet id="11" author="Irfan">
	<createView viewName="LoanTypeStatusCodes_AView" replaceIfExists="true">
SELECT    StatusId, FinType, DueFrom, DueTo, Version, LastMntBy, LastMntOn, RecordStatus, RoleCode, NextRoleCode, TaskId, 
                      NextTaskId, RecordType, WorkflowId
FROM         LoanTypeStatusCodes
    </createView>
 </changeSet>  
 <changeSet id="12" author="Irfan">
 	<addPrimaryKey tableName="LoanStatusCodes" constraintName="PK_LoanStatusCodes" columnNames="StatusId"/>
 	<addPrimaryKey tableName="LoanStatusCodes_Temp" constraintName="PK_LoanStatusCodes_Temp" columnNames="StatusId"/>
 	<addUniqueConstraint tableName="LoanStatusCodes" columnNames="StatusCode" constraintName="UK_LoanStatusCodes"/>
 	<addUniqueConstraint tableName="LoanStatusCodes_Temp" columnNames="StatusCode" constraintName="UK_LoanStatusCodes_Temp"/>
 </changeSet>   
 <changeSet id="13" author="Irfan">
 	<addPrimaryKey tableName="LoanTypeStatusCodes" constraintName="PK_LoanTypeStatusCodes" columnNames="StatusId,FinType"/>
 	<addPrimaryKey tableName="LoanTypeStatusCodes_Temp" constraintName="PK_LoanTypeStatusCodes_Temp" columnNames="StatusId,FinType"/>
 </changeSet>  
 <changeSet id="14" author="Irfan"> 
     <dropPrimaryKey tableName="LoanTypeStatusCodes" constraintName="PK_LoanTypeStatusCodes"/>   
     <dropPrimaryKey tableName="LoanTypeStatusCodes_Temp" constraintName="PK_LoanTypeStatusCodes_Temp"/>  
     <dropView viewName="LoanTypeStatusCodes_View"/>     
     <dropView viewName="LoanTypeStatusCodes_AView"/>    
  	<dropTable tableName="LoanTypeStatusCodes" /> 
  	<dropTable tableName="LoanTypeStatusCodes_Temp" /> 
  </changeSet>
  <changeSet id="15" author="Irfan">
	<createTable tableName="LoanTypeStatusCodes">
		<column name="StatusId" type="bigint">
			<constraints nullable="false"/>
		</column>
		<column name="StatusCode" type="varchar(20)">
		<constraints nullable="false"/>
		</column>
		<column name="FinType" type="varchar(8)">
		<constraints nullable="false"/>
		</column>
		<column name="DueFrom" type="int">
		<constraints nullable="false"/>
		</column>
		<column name="DueTO" type="int">
		<constraints nullable="false"/>
		</column>
		<column name="Version" type="int" >
		<constraints nullable="false"/>
		</column>
		<column name="LastMntBy" type="bigint"/>
		<column name="LastMntOn" type="datetime"/>
		<column name="RecordStatus" type="varchar(50)"/>
		<column name="RoleCode" type="varchar(100)"/>
		<column name="NextRoleCode" type="varchar(200)"/>
		<column name="TaskId" type="varchar(50)"/>
		<column name="NextTaskId" type="varchar(200)"/>
		<column name="RecordType" type="varchar(50)"/>
		<column name="WorkflowId" type="bigint"/>
	</createTable>
	<createTable tableName="LoanTypeStatusCodes_Temp">
		<column name="StatusId" type="bigint">
			<constraints nullable="false"/>
		</column>
		<column name="StatusCode" type="varchar(20)">
		<constraints nullable="false"/>
		</column>
		<column name="FinType" type="varchar(8)">
		<constraints nullable="false"/>
		</column>
		<column name="DueFrom" type="int">
		<constraints nullable="false"/>
		</column>
		<column name="DueTO" type="int">
		<constraints nullable="false"/>
		</column>
		<column name="Version" type="int" >
		<constraints nullable="false"/>
		</column>
		<column name="LastMntBy" type="bigint"/>
		<column name="LastMntOn" type="datetime"/>
		<column name="RecordStatus" type="varchar(50)"/>
		<column name="RoleCode" type="varchar(100)"/>
		<column name="NextRoleCode" type="varchar(200)"/>
		<column name="TaskId" type="varchar(50)"/>
		<column name="NextTaskId" type="varchar(200)"/>
		<column name="RecordType" type="varchar(50)"/>
		<column name="WorkflowId" type="bigint"/>
	</createTable>
</changeSet> 
 <changeSet id="16" author="Irfan">
 	<addPrimaryKey tableName="LoanTypeStatusCodes" constraintName="PK_LoanTypeStatusCodes" columnNames="StatusId,StatusCode"/>
 	<addPrimaryKey tableName="LoanTypeStatusCodes_Temp" constraintName="PK_LoanTypeStatusCodes_Temp" columnNames="StatusId,StatusCode"/>  
</changeSet>	
<changeSet id="17" author="Irfan">
<createView viewName="LoanTypeStatusCodes_View" replaceIfExists="true">

SELECT    StatusId, StatusCode, FinType, DueFrom, DueTo, Version, LastMntBy, LastMntOn, RecordStatus, RoleCode, NextRoleCode, TaskId, 
                      NextTaskId, RecordType, WorkflowId
FROM         LoanTypeStatusCodes_TEMP
UNION ALL
SELECT    StatusId, StatusCode,FinType, DueFrom, DueTo, Version, LastMntBy, LastMntOn, RecordStatus, RoleCode, NextRoleCode, TaskId, 
                      NextTaskId, RecordType, WorkflowId
FROM         LoanTypeStatusCodes
WHERE     NOT EXISTS
                          (SELECT     1
                            FROM          LoanTypeStatusCodes_TEMP
                            WHERE      StatusId = LoanTypeStatusCodes.StatusId)

</createView>
</changeSet>
<changeSet id="18" author="Irfan">
	<createView viewName="LoanTypeStatusCodes_AView" replaceIfExists="true">
SELECT    StatusId, StatusCode, FinType, DueFrom, DueTo, Version, LastMntBy, LastMntOn, RecordStatus, RoleCode, NextRoleCode, TaskId, 
                      NextTaskId, RecordType, WorkflowId
FROM         LoanTypeStatusCodes
    </createView>
 </changeSet>  
</databaseChangeLog>