<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />

	<changeSet id="01" author="Surekha">
		<sql>
			update SMTDivisionDetail set divisionCodeDesc='Bajaj Finance Service' where divisionCode='BFSD';
		</sql>
	</changeSet>

	<changeSet id="02" author="Durgaprasad G">
		<addColumn tableName="PRESENTMENTDETAILS">
			<column name="ErrorCode" type="varchar(10)" />
			<column name="ErrorDesc" type="varchar(250)" />
		</addColumn>
	</changeSet>
	
		<changeSet id="03" author="Durgaprasad G">
		<addColumn tableName="PRESENTMENTDETAILS_TEMP">
			<column name="ErrorCode" type="varchar(10)" />
			<column name="ErrorDesc" type="varchar(250)" />
		</addColumn>
	</changeSet>
	
	
<changeSet id="04" author="Durgaprasad g">
		<createView viewName="PRESENTMENTDETAILS_AVIEW" replaceIfExists="true">
  SELECT		T1.ID, T1.PRESENTMENTID, T1.PRESENTMENTREF, T1.FINREFERENCE, T1.SCHDATE, T1.MANDATEID, T1.SCHAMTDUE, T1.SCHPRIDUE, T1.SCHPFTDUE, T1.SCHFEEDUE, T1.SCHINSDUE,
							T1.schPenaltyDue, T1.advanceAmt, T1.excessID, T1.adviseAmt, T1.presentmentAmt, T1.ExcludeReason, T1. TDSAMOUNT, T1.bounceID, T1.emiNo, T1.status,
							T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId,T2.MANDATETYPE,T3.FINTYPE,T4.FINTYPEDESC,
      						T5.CUSTSHRTNAME CUSTOMERNAME  ,T1.ReceiptID, T1.ECSRETURN, T1.ErrorCode, T1.ErrorDesc 
				FROM 		PRESENTMENTDETAILS    T1  INNER JOIN 
							MANDATES  T2 ON T1.MANDATEID = T2.MANDATEID INNER JOIN 
							FINANCEMAIN T3 ON T1.FINREFERENCE = T3.FINREFERENCE INNER JOIN 
							RMTFINANCETYPES T4 ON T3.FINTYPE  = T4.FINTYPE INNER JOIN 
							CUSTOMERS T5 ON T5.CUSTID  = T3.CUSTID
							
	</createView>
</changeSet>							

<changeSet id="05" author="Durgaprasad g">
		<createView viewName="PRESENTMENTDETAILS_VIEW" replaceIfExists="true">
			SELECT		T1.ID, T1.PRESENTMENTID, T1.PRESENTMENTREF, T1.FINREFERENCE, T1.SCHDATE, T1.MANDATEID, T1.SCHAMTDUE, T1.SCHPRIDUE, T1.SCHPFTDUE, T1.SCHFEEDUE, T1.SCHINSDUE,
										T1.schPenaltyDue, T1.advanceAmt, T1.excessID, T1.adviseAmt, T1.presentmentAmt, T1.ExcludeReason, T1. TDSAMOUNT, T1.bounceID, T1.emiNo, T1.status,
										T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId,
										T2.MANDATETYPE,T3.FINTYPE,T4.FINTYPEDESC, T5.CUSTSHRTNAME CUSTOMERNAME, T1.ReceiptID ,T1.ECSRETURN,
										T1.ErrorCode, T1.ErrorDesc 
							FROM 		PRESENTMENTDETAILS_TEMP  T1  INNER JOIN 
										MANDATES  T2 ON T1.MANDATEID = T2.MANDATEID INNER JOIN 
										FINANCEMAIN T3 ON T1.FINREFERENCE = T3.FINREFERENCE INNER JOIN 
										RMTFINANCETYPES T4 ON T3.FINTYPE  = T4.FINTYPE INNER JOIN 
										CUSTOMERS T5 ON T5.CUSTID  = T3.CUSTID
			UNION ALL

			SELECT		T1.ID, T1.PRESENTMENTID, T1.PRESENTMENTREF, T1.FINREFERENCE, T1.SCHDATE, T1.MANDATEID, T1.SCHAMTDUE, T1.SCHPRIDUE, T1.SCHPFTDUE, T1.SCHFEEDUE, T1.SCHINSDUE,
										T1.schPenaltyDue, T1.advanceAmt, T1.excessID, T1.adviseAmt, T1.presentmentAmt, T1.ExcludeReason, T1. TDSAMOUNT, T1.bounceID, T1.emiNo, T1.status,
										T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId,
										T2.MANDATETYPE,T3.FINTYPE,T4.FINTYPEDESC, T5.CUSTSHRTNAME CUSTOMERNAME , T1.ReceiptID ,T1.ECSRETURN,
										T1.ErrorCode, T1.ErrorDesc 
							FROM 		PRESENTMENTDETAILS    T1  INNER JOIN 
										MANDATES  T2 ON T1.MANDATEID = T2.MANDATEID INNER JOIN 
										FINANCEMAIN T3 ON T1.FINREFERENCE = T3.FINREFERENCE INNER JOIN 
										RMTFINANCETYPES T4 ON T3.FINTYPE  = T4.FINTYPE INNER JOIN 
										CUSTOMERS T5 ON T5.CUSTID  = T3.CUSTID
			WHERE     NOT EXISTS (SELECT 1 FROM PRESENTMENTDETAILS_TEMP WHERE ID = T1.ID)
	</createView>
</changeSet>	
	
	
	<changeSet id="06" author="Durgaprasad g">
		<modifyDataType tableName="PRESENTMENTDETAILS" columnName="ErrorDesc"
			newDataType="varchar(1000)" />
	</changeSet>
	
	<changeSet id="07" author="Durgaprasad g">
		<modifyDataType tableName="PRESENTMENTDETAILS_TEMP" columnName="ErrorDesc"
			newDataType="varchar(1000)" />
	</changeSet>
	
	
<changeSet id="08" author="Durgaprasad g">
<sql>
	DELETE  from RBFIELDDETAILS Where RBMODULE = 'BOUNCE' ANd RBFLDNAME = 'rd_paymentType';
	INSERT INTO RBFIELDDETAILS VALUES ('BOUNCE','BOUNCE','rd_paymentType','Mandate Types','nvarchar',8,'0','1','FINRECEIPTDETAIL','static,global,dbvalue','');
</sql>
</changeSet>

   <changeSet id="09" author="Manojkumar.P">
		<createView viewName="DE_DISBURSE_FILE_CONTROL_VIEW" replaceIfExists="true">
		 SELECT DISTINCT(DS.ID), DC.NAME, DC.UPLOADPATH FILELOCATION, DS.FILENAME, DS.VALUEDATE, DS.STATUS, 
			PB.ALWFILEDOWNLOAD,  PB.PARTNERBANKID, PB.PARTNERBANKCODE, PB.PARTNERBANKNAME, FA.PAYMENTTYPE
			FROM DATA_ENGINE_CONFIG DC
			INNER JOIN DATA_ENGINE_STATUS DS ON DS.NAME = DC.NAME 
			INNER JOIN DISBURSEMENT_REQUESTS DR ON DR.BATCH_ID =DS.ID
      		INNER JOIN FINADVANCEPAYMENTS FA ON FA.PAYMENTID = DR.DISBURSEMENT_ID
			INNER JOIN PARTNERBANKS PB ON PB.PARTNERBANKID=FA.PARTNERBANKID
      		ORDER BY DS.ID DESC
	</createView>	
	</changeSet>
   <changeSet id="10" author="Madhubabu">
		<createView viewName="ACCOUNTS_VIEW" replaceIfExists="true">
		SELECT     T1.AccountId, T1.AcCcy, T1.AcType, T1.AcBranch, T1.AcCustId, T1.AcFullName, T1.AcShortName, T1.AcPurpose, T1.InternalAc, T1.CustSysAc, 
                      T1.SHADOWBAL, T1.ACBALANCE, T1.AcOpenDate, T1.AcCloseDate, 
                      T1.AcLastCustTrnDate, T1.AcLastSysTrnDate, T1.AcActive, T1.AcBlocked, T1.AcClosed, T1.HostAcNumber, T1.Version, T1.LastMntBy, T1.LastMntOn, 
                      T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId, 
                      Customers.CustCIF lovDescCustCIF,  RMTBranches.BranchDesc lovDescBranchCodeName, 
                       RMTAccountTypes.AcTypeDesc lovDescAccTypeDesc
FROM          Accounts_Temp T1 LEFT OUTER JOIN
                       Customers ON T1.AcCustId =  Customers.CustID AND T1.AcCustId =  Customers.CustID INNER JOIN
                       RMTBranches ON T1.AcBranch =  RMTBranches.BranchCode AND T1.AcBranch =  RMTBranches.BranchCode INNER JOIN
                       RMTAccountTypes ON T1.AcType =  RMTAccountTypes.AcType AND T1.AcType =  RMTAccountTypes.AcType
UNION ALL
SELECT     T1.AccountId, T1.AcCcy, T1.AcType, T1.AcBranch, T1.AcCustId, T1.AcFullName, T1.AcShortName, T1.AcPurpose, T1.InternalAc, T1.CustSysAc, 
                      T1.SHADOWBAL, T1.ACBALANCE, T1.AcOpenDate, T1.AcCloseDate, 
                      T1.AcLastCustTrnDate, T1.AcLastSysTrnDate, T1.AcActive, T1.AcBlocked, T1.AcClosed, T1.HostAcNumber, T1.Version, T1.LastMntBy, T1.LastMntOn, 
                      T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId, 
                      Customers.CustCIF lovDescCustCIF,  RMTBranches.BranchDesc lovDescBranchCodeName, 
                       RMTAccountTypes.AcTypeDesc lovDescAccTypeDesc
FROM          Accounts T1 LEFT OUTER JOIN
                       Customers ON T1.AcCustId =  Customers.CustID AND T1.AcCustId =  Customers.CustID INNER JOIN
                       RMTBranches ON T1.AcBranch =  RMTBranches.BranchCode AND T1.AcBranch =  RMTBranches.BranchCode INNER JOIN
                       RMTAccountTypes ON T1.AcType =  RMTAccountTypes.AcType AND T1.AcType =  RMTAccountTypes.AcType
WHERE     NOT EXISTS
                          (SELECT     1
                            FROM          Accounts_TEMP
                            WHERE      AccountId = T1.AccountId)
	</createView>	
	</changeSet>
	
	<changeSet id="11" author="Madhubabu">
<sql>
Update wifFinanceMain set FinCurrAssetValue = (select SUM(DisbAmount) from wifFinDisbursementDetails D  WHERE wifFinanceMain.FinReference = D.FinReference);
Update wifFinanceMain set FinCurrAssetValue = FinCurrAssetValue-DownPayment;
Update wiffinancemain_temp set FinCurrAssetValue = (select SUM(DisbAmount) from wifFinDisbursementDetails_temp D  WHERE wifFinanceMain_Temp.FinReference = D.FinReference);
Update wiffinancemain_temp set FinCurrAssetValue = FinCurrAssetValue-DownPayment;
Update wiffinancemain_temp set FinCurrAssetValue = 0 WHERE FinCurrAssetValue IS NULL;
Update wifFinanceMain set FinCurrAssetValue = 0 WHERE FinCurrAssetValue IS NULL;
</sql>
</changeSet>

     <changeSet id="12" author="ManojKumar.P">
		<dropTable tableName="DISBURSMENT_UPLOAD_MAPPING"/>
	</changeSet> 
	
	<changeSet id="13" author="ManojKumar.P" >
	<createView viewName="DE_DISBURSE_FILE_CONTROL_VIEW" replaceIfExists="true">
		 SELECT DISTINCT(DS.ID), DC.NAME, DC.UPLOADPATH FILELOCATION, DS.FILENAME, DS.ENDTIME, DS.STATUS, 
			PB.ALWFILEDOWNLOAD,  PB.PARTNERBANKID, PB.PARTNERBANKCODE, PB.PARTNERBANKNAME, FA.PAYMENTTYPE
			FROM DATA_ENGINE_CONFIG DC
			INNER JOIN DATA_ENGINE_STATUS DS ON DS.NAME = DC.NAME 
			INNER JOIN DISBURSEMENT_REQUESTS DR ON DR.BATCH_ID =DS.ID
      		INNER JOIN FINADVANCEPAYMENTS FA ON FA.PAYMENTID = DR.DISBURSEMENT_ID
			INNER JOIN PARTNERBANKS PB ON PB.PARTNERBANKID=FA.PARTNERBANKID
      		ORDER BY DS.ID DESC
	</createView>	
	</changeSet>
	
	<changeSet id="14" author="ManojKumar.P">
	<createView viewName="DE_FILE_CONTROL_VIEW" replaceIfExists="true">
		SELECT DS.ID, DC.NAME, DC.UPLOADPATH FILELOCATION, DS.FILENAME, DS.ENDTIME, DS.STATUS 
		FROM DATA_ENGINE_CONFIG DC
		INNER JOIN DATA_ENGINE_STATUS DS ON DS.NAME = DC.NAME 
		ORDER BY DS.ID DESC
	</createView>	
	</changeSet>
	<changeSet id="15" author="Surekha">
	<sql>
		update ReportList set FieldLabels='listheader_FinType.label,listheader_FinTypeDesc.label,listheader_FinCcy.label,listheader_FinDaysCalType.label,listheader_FinSchdMthd.label,listheader_FInIsAlwGrace.label,listheader_FinDivision.label,listheader_RecordStatus.label,listheader_RecordType.label,listheader_LovDescProductCodeDesc.label' , FieldValues='finType,finTypeDesc,finCcy,finDaysCalType,finSchdMthd,fInIsAlwGrace,finDivision,recordStatus,recordType,lovDescProductCodeDesc' , FieldType='String,String,String,String,String,boolean,String,String,String,String' , reportFileName='ReportList10' where Code='FinanceType';
	</sql>
	</changeSet>
	<changeSet id="16" author="Surekha">
	<sql>
		update ReportList set FieldLabels='listheader_FinType.label,listheader_FinTypeDesc.label,listheader_FinCcy.label,listheader_FinDaysCalType.label,listheader_FinSchdMthd.label,listheader_FInIsAlwGrace.label,listheader_FinDivision.label,listheader_RecordStatus.label,listheader_RecordType.label' , FieldValues='finType,finTypeDesc,finCcy,finDaysCalType,finSchdMthd,fInIsAlwGrace,finDivision,recordStatus,recordType' , FieldType='String,String,String,String,String,boolean,String,String,String' , reportFileName='ReportList09' where Code='FinanceType';
	</sql>
		</changeSet>
		
	 <changeSet id="17" author="Manojkumar.P">
		<sql>
		DELETE FROM DATA_ENGINE_PROCESS_LOG;
		DELETE FROM DATA_ENGINE_LOG;
		DELETE FROM DATA_ENGINE_STATUS;
		
		DELETE FROM DATA_ENGINE_COLUMN where TABLEID IN (select ID from DATA_ENGINE_TABLE WHERE CONFIGID = (select ID from DATA_ENGINE_CONFIG where Name = 'MANDATES_EXPORT'));
		DELETE FROM DATA_ENGINE_TABLE where CONFIGID IN (select ID from DATA_ENGINE_CONFIG where Name = 'MANDATES_EXPORT');
		DELETE FROM DATA_ENGINE_CONFIG where Name = 'MANDATES_EXPORT';
		
		INSERT INTO DATA_ENGINE_CONFIG VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_CONFIG),'MANDATES_EXPORT', 'Mandates export', 2, NULL, NULL, NULL, ',' , 0, 0, 'Mandate Sequence No.,Customer Name,Branch,Product,Application ID,LAN No.,EMI Amount,Open Flag,Account Holder Name,MICR Code,Account No.,Account Type,Updation Date,User ID,First Due Date,EMI End Date,Open End Date,Open Upper Limit,Bank Name,Mandate Debit Amount,Start Date,End Date,Application Form No.,Customer Code,Repayment Mode,Mandate No.', 'Row:{INSTRUMENT AUTO DATA ENTRY REPORT}Row:{User:${USER_ID}}Row:{Business Date:${SYS_DATE_DD-MMM-YYYY}}Row:{Branch Name:${FILTER_BRANCHCODE}}Row:{FromDate:${FILTER_FROMDATE},  ToDate:${FILTER_TODATE}}ROW:{EMPTY_ROW}',  '', 'A', '/opt/PFF/mandates/request', 'MANDATE_', '.CSV', 0, NULL, '${SEQ_DATE_FILE}', NULL, 0, NULL, 1, 1); 
		INSERT INTO DATA_ENGINE_TABLE  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_TABLE), (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT'), 'MANDATE_REQUESTS',  0, 'ID', 'ID IN (:ID)', 'UPDATE MANDATE_REQUESTS SET BATCH_ID = :FILEID, STATUS = ''AC'' WHERE ID IN (:ID)QUERY:UPDATE MANDATES M SET M.STATUS = ''AC'' WHERE EXISTS (select 1 from MANDATE_REQUESTS MR where MR.MANDATEID = M.MANDATEID AND MR.STATUS = ''AC'')', NULL, NULL, NULL, NULL, NULL, 0, 0, 0);
		INSERT INTO DATA_ENGINE_TABLE  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_TABLE), (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT'), 'DATA_ENGINE_PROCESS_LOG',  	1,	'ID', 		NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0, 0);
		
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'BANK_SEQ',				0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, NULL);	
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'CUSTOMER_NAME',		0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, NULL);
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'BRANCH_NAME',			0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, NULL);
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'FINTYPE',				0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, NULL);
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'APPLICATION_NUMBER',	0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, NULL);
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'FINREFERENCE',			0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, NULL);
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'EMI',					0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, NULL);
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'OPENFLAG',				0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, NULL);
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'ACCT_HOLDER_NAME',		0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, NULL);
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'MICR_CODE',			0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, NULL);
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'ACCT_NUMBER',			0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, NULL);
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'ACCT_TYPE',			0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, NULL);
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'EXTRACTION_DATE',		0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, 'DATE:dd-MMM-yyyy');
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'USERNAME',				1, 'N', NULL, NULL, NULL, '${USER_NAME}', 	 0, NULL, NULL, NULL, NULL);
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'EFFECTIVE_DATE',		0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, 'DATE:dd-MMM-yyyy');
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'EMI_ENDDATE',			0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, 'DATE:dd-MMM-yyyy');
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'OPEN_ENDDATE',			0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, 'DATE:dd-MMM-yyyy');
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'UPPER_LIMIT',			0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, NULL);
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'BANKNAME',				0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, NULL);
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'DEBIT_AMOUNT',			0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, NULL);
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'START_DATE',			0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, 'DATE:dd-MMM-yyyy');
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'END_DATE',				0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, 'DATE:dd-MMM-yyyy');
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'APPLICATION_NUMBER',	0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, NULL);
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'CUSTCIF',				0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, NULL);
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'MANDATE_TYPE',			0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, NULL);
		INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'MANDATE_REQUESTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT')),	'ID',					0, 'N', NULL, NULL, NULL, NULL, 0, NULL, NULL, NULL, NULL);
		
		
		UPDATE SEQ_DATA_ENGINE_CONFIG SET SeqNo=(Select coalesce(MAX(ID), 1) FROM DATA_ENGINE_CONFIG);
		UPDATE SEQ_DATA_ENGINE_TABLE  SET SeqNo=(Select coalesce(MAX(ID), 1) FROM DATA_ENGINE_TABLE);
		UPDATE SEQ_DATA_ENGINE_COLUMN SET SeqNo=(Select coalesce(MAX(ID), 1) FROM DATA_ENGINE_COLUMN);
		UPDATE SEQ_DATA_ENGINE_STATUS SET SeqNo=(Select coalesce(MAX(ID), 1) FROM DATA_ENGINE_STATUS);
		</sql>
	</changeSet>
		
	
	<changeSet id="18" author="Jayant">    
	    <createIndex tableName="DOCUMENTDETAILS" indexName="ix_DD_DocModule">
	        <column name="DocModule" type="nvarchar(50)"/>
	    </createIndex>
	    <createIndex tableName="DOCUMENTDETAILS" indexName="ix_DD_FinEvent">
	        <column name="FinEvent" type="nvarchar(50)"/>
	    </createIndex>
	    <createIndex tableName="DOCUMENTDETAILS_Temp" indexName="ix_DD_ReferenceId_T">
	        <column name="ReferenceId" type="nvarchar(50)"/>
	    </createIndex>
	     <createIndex tableName="DOCUMENTDETAILS_Temp" indexName="ix_DD_DocModule_T">
	        <column name="DocModule" type="nvarchar(50)"/>
	    </createIndex>
	     <createIndex tableName="DOCUMENTDETAILS_Temp" indexName="ix_DD_FinEvent_T">
	        <column name="FinEvent" type="nvarchar(50)"/>
	    </createIndex>
	</changeSet>
	<changeSet id="19" author="Jayant">
	    <!-- <dropIndex tableName="CUSTOMERDOCUMENTS" indexName="IX_CD_CUST_TIT_CAT_ID"/> -->
	    <createIndex tableName="CUSTOMERDOCUMENTS" indexName="IX_CD_CUST_TIT_CAT_ID">
	        <column name="CUSTDOCTITLE" type="nvarchar(50)"/>
	        <column name="CUSTDOCCATEGORY" type="nvarchar(50)"/>
	        <column name="CUSTID" type="bigint"/>
	    </createIndex>
	     <dropIndex tableName="CUSTOMERDOCUMENTS_TEMP" indexName="IX_CD_CUST_TIT_CAT_ID"/>
	     <createIndex tableName="CUSTOMERDOCUMENTS_TEMP" indexName="IX_CD_CUST_TIT_CAT_ID">
	           <column name="CUSTDOCTITLE" type="nvarchar(50)"/>
	        <column name="CUSTDOCCATEGORY" type="nvarchar(50)"/>
	        <column name="CUSTID" type="bigint"/>
	    </createIndex>
	</changeSet>
	<changeSet id="20" author="Jayant">
	    <createIndex tableName="rmtfinancetypes" indexName="ix_fin_type_division">
	        <column name="FinDivision" type="nvarchar(50)"/>
	    </createIndex>
	</changeSet>
	<changeSet id="21" author="Jayant">
		<createIndex tableName="FinanceMain" indexName="ix_fin_main_active_branch">
	        <column name="FinIsActive" type="boolean"/>
	         <column name="FinBranch" type="varchar(50)"/>
	    </createIndex>
	    <createIndex tableName="FinanceMain" indexName="IX_FM_Cust_ID">
	        <column name="CustID" type="bigint"/>
	    </createIndex>
	</changeSet>
	<changeSet id="22" author="Jayant">
	    <dropIndex tableName="SECLOGINLOG" indexName="IX_SECLOG_SESSIONID"/>
	</changeSet>
	<changeSet id="23" author="Jayant">
	     <dropIndex tableName="SECUSEROPERATIONS" indexName="IX_UO_UID_OID"/>
	     <addUniqueConstraint tableName="secuseroperations" columnNames="usrid, oprid" constraintName="uk_user_oper"/>
	    <createIndex tableName="secuseroperations" indexName="ix_user_oper_user_id">
	        <column name="usrid" type="bigint"/>
	    </createIndex>
		 <createIndex tableName="secuseroperations" indexName="ix_user_oper_oper_id">
	        <column name="oprid" type="bigint"/>
	    </createIndex>
	</changeSet>
	<changeSet id="24" author="Jayant">
	     <addUniqueConstraint tableName="secoperations" columnNames="oprcode" constraintName="uk_oper_code"/>
	</changeSet>
	<changeSet id="25" author="Jayant">
	     <dropIndex tableName="SECOPERATIONROLES" indexName="IX_OR_OID_RID"/>
	     <addUniqueConstraint tableName="secoperationroles" columnNames="oprid, roleid" constraintName="uk_oper_role"/>
	       <createIndex tableName="secoperationroles" indexName="ix_oper_role_oper_id">
	        <column name="oprid" type="bigint"/>
	    </createIndex>
		 <createIndex tableName="secoperationroles" indexName="ix_oper_role_role_id">
	        <column name="roleid" type="bigint"/>
	    </createIndex>
	</changeSet>
	<changeSet id="26" author="Jayant">
	      <addUniqueConstraint tableName="secroles" columnNames="rolecd, roleapp" constraintName="uk_role_code_app"/>
	</changeSet>
	<changeSet id="27" author="Jayant">
	       <createIndex tableName="SecRoleGroups" indexName="IX_SRG_RID">
	        <column name="RoleID" type="bigint"/>
	    </createIndex>
		 <createIndex tableName="secrolegroups" indexName="ix_role_group_group_id">
	        <column name="grpid" type="bigint"/>
	    </createIndex>
	</changeSet>
	<changeSet id="28" author="Jayant">
	    <dropIndex tableName="SecGroupRights" indexName="IX_SGR_GID"/>
	    <createIndex tableName="SecGroupRights" indexName="IX_SGR_GID">
	        <column name="GrpID" type="bigint"/>
	    </createIndex>
	    <dropIndex tableName="SecGroupRights" indexName="IX_group_right_right_id"/>
		 <createIndex tableName="secgrouprights" indexName="ix_group_right_right_id">
	        <column name="rightid" type="bigint"/>
	    </createIndex>
	    <dropUniqueConstraint tableName="SecGroupRights" constraintName="IDXSECGROUPRIGHTS_GRPANDRIGHT" />
	    <addUniqueConstraint tableName="secgrouprights" columnNames="grpid,rightid" constraintName="uk_group_right"/>
	</changeSet>
	<changeSet id="29" author="Jayant">
	       <createIndex tableName="secrights" indexName="ix_rights_page_right_type">
	        <column name="PAGE" type="varchar(50)"/>
	        <column name="RIGHTTYPE" type="int"/>
	    </createIndex>
	</changeSet>
	<changeSet id="30" author="Jayant">
	    <sql>
	        DELETE  from SECURITYUSERDIVBRANCH where rowid not in ( SELECT MIN(rowid) FROM SECURITYUSERDIVBRANCH GROUP BY USRID,USERDIVISION,USERBRANCH );
	    	alter table SECURITYUSERDIVBRANCH add constraint PK_SECUSRDIVBRANCH primary key (USRID,USERDIVISION,USERBRANCH);
	    </sql>
	</changeSet>
	<changeSet id="31" author="Jayant">
	    <createIndex tableName="OFFLINEUSRMESSAGESBACKUP" indexName="IX_OLUMB_TOUSRID">
	        <column name="TOUSRID" type="varchar(50)"/>
	    </createIndex>
	</changeSet>
	<changeSet id="32" author="Jayant">
	    <sql>
	        alter table TATNotificationCodes add constraint PK_TATNotificationCodes primary key (TatNotificationId);
	    </sql>
	</changeSet>
	<changeSet id="33" author="Jayant">
	    <createIndex tableName="Notes" indexName="ix_Note_Modulename">
	        <column name="MODULENAME" type="varchar(50)"/>
	    </createIndex>
	    <createIndex tableName="Notes" indexName="ix_Note_Reference">
	        <column name="Reference" type="varchar(50)"/>
	    </createIndex>
	 	<createIndex tableName="Notes" indexName="ix_Note_RemarkType">
	        <column name="RemarkType" type="char(1)"/>
	    </createIndex>
	    <createIndex tableName="Notes" indexName="ix_Note_InputBy">
	        <column name="InputBy" type="bigint"/>
	    </createIndex>
	</changeSet>
	<changeSet id="34" author="Jayant">
	    
	    	
	    <createIndex tableName="CUSTOMERS" indexName="IX_CUST_CRCPR_ID">
	        <column name="CUSTCRCPR" type="nvarchar(20)" />
	        <column name="CUSTID" type="bigint"/>
	    </createIndex>
	   
	    <createIndex tableName="CUSTOMERS_TEMP" indexName="IX_CUST_T_CRCPR_ID">
	        <column name="CUSTCRCPR" type="nvarchar(20)" />
	        <column name="CUSTID" type="bigint"/>
	    </createIndex>
	</changeSet>

<changeSet id="35" author="Siva">
		<addColumn tableName="FinRepayDetails">
			<column name="FinSchdTdsPaid" type="decimal(18,0)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="36" author="Siva">
		<addColumn tableName="FINREPAYSCHEDULEDETAIL">
			<column name="TdsSchdPayNow" type="decimal(18,0)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="37" author="Siva">
		<addColumn tableName="FINREPAYSCHEDULEDETAIL_TEMP">
			<column name="TdsSchdPayNow" type="decimal(18,0)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="38" author="Siva">
		<addColumn tableName="FINSCHEDULEDETAILS">
			<column name="TDSPaid" type="decimal(18,0)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="39" author="Siva">
		<addColumn tableName="FINSCHEDULEDETAILS_TEMP">
			<column name="TDSPaid" type="decimal(18,0)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="40" author="Siva">
		<addColumn tableName="FINSCHEDULEDETAILS_PA">
			<column name="TDSPaid" type="decimal(18,0)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="41" author="Siva">
		<addColumn tableName="FINSCHEDULEDETAILS_LOG">
			<column name="TDSPaid" type="decimal(18,0)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="42" author="Siva">
		<addColumn tableName="REJECTFINSCHEDULEDETAILS">
			<column name="TDSPaid" type="decimal(18,0)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="43" author="Siva">
		<addColumn tableName="WIFFINSCHEDULEDETAILS">
			<column name="TDSPaid" type="decimal(18,0)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="44" author="Siva">
		<addColumn tableName="WIFFINSCHEDULEDETAILS_TEMP">
			<column name="TDSPaid" type="decimal(18,0)" />
		</addColumn>
	</changeSet>
	
	
	<changeSet id="45" author="Siva">
			<createView viewName="FINSCHEDULEDETAILS_AVIEW" replaceIfExists="true">
	  SELECT     T1.FinReference, T1.SchSeq, T1.SchDate, T1.PftOnSchDate, T1.RepayOnSchDate, T1.CpzOnSchDate, T1.RvwOnSchDate, T1.DisbOnSchDate, 
	                     T1.DownpaymentOnSchDate, T1.BalanceForPftCal, T1.BaseRate, T1.SplRate, T1.ActRate, T1.NoOfDays, T1.DayFactor, T1.ProfitCalc, T1.ProfitSchd, 
	                      T1.PrincipalSchd, T1.RepayAmount, T1.ProfitBalance, T1.DisbAmount, T1.CpzAmount, T1.DownPaymentAmount,  
	                      T1.ClosingBalance, T1.ProfitFraction, T1.PrvRepayAmount, T1.SchdPftPaid, T1.SchPftPaid, T1.SchdPriPaid, T1.SchPriPaid, 
	                      T1.Specifier, T1.DefSchdDate, T1.SchdMethod, T1.MrgRate, 
	                      T1.CalOnIndRate,T1.FeeChargeAmt, T1.CalculatedRate, T1.EarlyPaidBal, T1.EarlyPaid, T1.RefundOrWaiver, T1.WriteoffPrincipal, 
	                      T1.WriteoffProfit, T1.OrgPft, T1.OrgPri, T1.OrgEndBal, T1.OrgPlanPft, T1.FeeSchd, T1.SchdFeePaid, T1.SchdFeeOS, T1.InsSchd, T1. SchdInsPaid, 
	                       T1.AdvPftRate , T1.AdvProfit ,  T1.AdvRepayAmount , T1.AdvBaseRate , T1.AdvMargin , T1.AdvCalRate, T1.SuplRent ,  T1.IncrCost ,  T1.SuplRentPaid ,  T1.IncrCostPaid ,
	                       T1.RolloverOnSchDate,  T1.RolloverAmount,  T1.RolloverAmountPaid, T1.TDSAmount, T1.TDSPaid,
	                       T1.PftDaysBasis,T1.WriteoffIns,T1.WriteoffIncrCost,T1.WriteoffSuplRent,T1.WriteoffSchFee,T1.InsuranceAmt, T1.InstNumber, T1.BpiOrHoliday, T1.FrqDate,T1.PresentmentId
	
	FROM         FinScheduleDetails  T1							
		</createView>
	</changeSet>		
	
	<changeSet id="46" author="Siva">
			<createView viewName="FINSCHEDULEDETAILS_TVIEW" replaceIfExists="true">
	  SELECT     T1.FinReference, T1.SchSeq, T1.SchDate, T1.PftOnSchDate, T1.RepayOnSchDate, T1.CpzOnSchDate, T1.RvwOnSchDate, T1.DisbOnSchDate, 
	                     T1.DownpaymentOnSchDate, T1.BalanceForPftCal, T1.BaseRate, T1.SplRate, T1.ActRate, T1.NoOfDays, T1.DayFactor, T1.ProfitCalc, T1.ProfitSchd, 
	                      T1.PrincipalSchd, T1.RepayAmount, T1.ProfitBalance, T1.DisbAmount, T1.CpzAmount, T1.DownPaymentAmount,  
	                      T1.ClosingBalance, T1.ProfitFraction, T1.PrvRepayAmount, T1.SchdPftPaid, T1.SchPftPaid, T1.SchdPriPaid, T1.SchPriPaid, 
	                      T1.Specifier, T1.DefSchdDate, T1.SchdMethod, T1.MrgRate, 
	                      T1.CalOnIndRate,T1.FeeChargeAmt, T1.CalculatedRate, T1.EarlyPaidBal, T1.EarlyPaid, T1.RefundOrWaiver, T1.WriteoffPrincipal, 
	                      T1.WriteoffProfit, T1.OrgPft, T1.OrgPri, T1.OrgEndBal, T1.OrgPlanPft, T1.FeeSchd, T1.SchdFeePaid, T1.SchdFeeOS, T1.InsSchd, T1. SchdInsPaid, 
	                       T1.AdvPftRate , T1.AdvProfit ,  T1.AdvRepayAmount , T1.AdvBaseRate , T1.AdvMargin , T1.AdvCalRate, T1.SuplRent ,  T1.IncrCost ,  T1.SuplRentPaid ,  T1.IncrCostPaid ,
	                       T1.RolloverOnSchDate,  T1.RolloverAmount,  T1.RolloverAmountPaid, T1.TDSAmount, T1.TDSPaid,
	                       T1.PftDaysBasis,T1.WriteoffIns,T1.WriteoffIncrCost,T1.WriteoffSuplRent,T1.WriteoffSchFee,T1.InsuranceAmt, T1.InstNumber, T1.BpiOrHoliday, T1.FrqDate,T1.PresentmentId
	
					FROM         FinScheduleDetails_Temp  T1							
		</createView>
	</changeSet>		
	
	<changeSet id="47" author="Siva">
			<createView viewName="FINSCHEDULEDETAILS_VIEW" replaceIfExists="true">
	  SELECT     T1.FinReference, T1.SchSeq, T1.SchDate, T1.PftOnSchDate, T1.RepayOnSchDate, T1.CpzOnSchDate, T1.RvwOnSchDate, T1.DisbOnSchDate, 
	                     T1.DownpaymentOnSchDate, T1.BalanceForPftCal, T1.BaseRate, T1.SplRate, T1.ActRate, T1.NoOfDays, T1.DayFactor, T1.ProfitCalc, T1.ProfitSchd, 
	                      T1.PrincipalSchd, T1.RepayAmount, T1.ProfitBalance, T1.DisbAmount, T1.CpzAmount, T1.DownPaymentAmount,  
	                      T1.ClosingBalance, T1.ProfitFraction, T1.PrvRepayAmount, T1.SchdPftPaid, T1.SchPftPaid, T1.SchdPriPaid, T1.SchPriPaid, 
	                      T1.Specifier, T1.DefSchdDate, T1.SchdMethod, T1.MrgRate, 
	                      T1.CalOnIndRate,T1.FeeChargeAmt, T1.CalculatedRate, T1.EarlyPaidBal, T1.EarlyPaid, T1.RefundOrWaiver, T1.WriteoffPrincipal, 
	                      T1.WriteoffProfit, T1.OrgPft, T1.OrgPri, T1.OrgEndBal, T1.OrgPlanPft, T1.FeeSchd, T1.SchdFeePaid, T1.SchdFeeOS, T1.InsSchd, T1. SchdInsPaid, 
	                       T1.AdvPftRate , T1.AdvProfit ,  T1.AdvRepayAmount , T1.AdvBaseRate , T1.AdvMargin , T1.AdvCalRate, T1.SuplRent ,  T1.IncrCost ,  T1.SuplRentPaid ,  T1.IncrCostPaid ,
	                       T1.RolloverOnSchDate,  T1.RolloverAmount,  T1.RolloverAmountPaid, T1.TDSAmount, T1.TDSPaid,
	                       T1.PftDaysBasis,T1.WriteoffIns,T1.WriteoffIncrCost,T1.WriteoffSuplRent,T1.WriteoffSchFee,T1.InsuranceAmt, T1.InstNumber, T1.BpiOrHoliday, T1.FrqDate,T1.PresentmentId
	
	FROM         FinScheduleDetails_Temp  T1
	UNION ALL
	SELECT     T1.FinReference, T1.SchSeq, T1.SchDate, T1.PftOnSchDate, T1.RepayOnSchDate, T1.CpzOnSchDate, T1.RvwOnSchDate, T1.DisbOnSchDate, 
	                     T1.DownpaymentOnSchDate, T1.BalanceForPftCal, T1.BaseRate, T1.SplRate, T1.ActRate, T1.NoOfDays, T1.DayFactor, T1.ProfitCalc, T1.ProfitSchd, 
	                      T1.PrincipalSchd, T1.RepayAmount, T1.ProfitBalance, T1.DisbAmount, T1.CpzAmount, T1.DownPaymentAmount,  
	                      T1.ClosingBalance, T1.ProfitFraction, T1.PrvRepayAmount, T1.SchdPftPaid, T1.SchPftPaid, T1.SchdPriPaid, T1.SchPriPaid, 
	                      T1.Specifier, T1.DefSchdDate, T1.SchdMethod, T1.MrgRate, 
	                      T1.CalOnIndRate,T1.FeeChargeAmt, T1.CalculatedRate, T1.EarlyPaidBal, T1.EarlyPaid, T1.RefundOrWaiver, T1.WriteoffPrincipal, 
	                      T1.WriteoffProfit, T1.OrgPft, T1.OrgPri, T1.OrgEndBal, T1.OrgPlanPft, T1.FeeSchd, T1.SchdFeePaid, T1.SchdFeeOS, T1.InsSchd, T1. SchdInsPaid, 
	                       T1.AdvPftRate , T1.AdvProfit ,  T1.AdvRepayAmount , T1.AdvBaseRate , T1.AdvMargin , T1.AdvCalRate, T1.SuplRent ,  T1.IncrCost ,  T1.SuplRentPaid ,  T1.IncrCostPaid ,
	                       T1.RolloverOnSchDate,  T1.RolloverAmount,  T1.RolloverAmountPaid, T1.TDSAmount, T1.TDSPaid,
	                       T1.PftDaysBasis,T1.WriteoffIns,T1.WriteoffIncrCost,T1.WriteoffSuplRent,T1.WriteoffSchFee,T1.InsuranceAmt, T1.InstNumber, T1.BpiOrHoliday, T1.FrqDate,T1.PresentmentId
	
	FROM         FinScheduleDetails  T1
	WHERE     NOT EXISTS
	                          (SELECT     1
	                            FROM          FinScheduleDetails_Temp
	                            WHERE      FinReference = T1.FinReference)						
		</createView>
	</changeSet>		
	
	<changeSet id="48" author="Siva">
			<createView viewName="WIFFINSCHEDULEDETAILS_TVIEW" replaceIfExists="true">
	  SELECT     T1.FinReference, T1.SchSeq, T1.SchDate, T1.PftOnSchDate, T1.RepayOnSchDate, T1.CpzOnSchDate, T1.RvwOnSchDate, T1.DisbOnSchDate, 
	                     T1.DownpaymentOnSchDate, T1.BalanceForPftCal, T1.BaseRate, T1.SplRate, T1.ActRate, T1.NoOfDays, T1.DayFactor, T1.ProfitCalc, T1.ProfitSchd, 
	                      T1.PrincipalSchd, T1.RepayAmount, T1.ProfitBalance, T1.DisbAmount, T1.CpzAmount, T1.DownPaymentAmount,  
	                      T1.ClosingBalance, T1.ProfitFraction, T1.PrvRepayAmount, T1.SchdPftPaid, T1.SchPftPaid, T1.SchdPriPaid, T1.SchPriPaid, 
	                      T1.Specifier, T1.DefSchdDate, T1.SchdMethod, T1.MrgRate,  
	                      T1.CalOnIndRate,T1.FeeChargeAmt, T1.CalculatedRate, T1.OrgPft, T1.OrgPri, T1.OrgEndBal, T1.OrgPlanPft, T1.FeeSchd, T1.SchdFeePaid, T1.SchdFeeOS, T1.InsSchd, T1. SchdInsPaid, 
	                       T1.AdvPftRate , T1.AdvProfit ,  T1.AdvRepayAmount , T1.AdvBaseRate , T1.AdvMargin , T1.AdvCalRate, T1.SuplRent ,  T1.IncrCost ,  T1.SuplRentPaid ,  T1.IncrCostPaid ,
	                       T1.RolloverOnSchDate,  T1.RolloverAmount,  T1.RolloverAmountPaid, T1.TDSAmount, T1.TDSPaid,
	                       T1.PftDaysBasis,T1.InsuranceAmt, T1.InstNumber, T1.BpiOrHoliday, T1.FrqDate
		FROM         WIFFinScheduleDetails_Temp T1					
		</createView>
	</changeSet>		
	
	<changeSet id="49" author="Siva">
			<createView viewName="WIFFINSCHEDULEDETAILS_VIEW" replaceIfExists="true">
	  SELECT     T1.FinReference, T1.SchSeq, T1.SchDate, T1.PftOnSchDate, T1.RepayOnSchDate, T1.CpzOnSchDate, T1.RvwOnSchDate, T1.DisbOnSchDate, 
	                     T1.DownpaymentOnSchDate, T1.BalanceForPftCal, T1.BaseRate, T1.SplRate, T1.ActRate, T1.NoOfDays, T1.DayFactor, T1.ProfitCalc, T1.ProfitSchd, 
	                      T1.PrincipalSchd, T1.RepayAmount, T1.ProfitBalance, T1.DisbAmount, T1.CpzAmount, T1.DownPaymentAmount,  
	                      T1.ClosingBalance, T1.ProfitFraction, T1.PrvRepayAmount, T1.SchdPftPaid, T1.SchPftPaid, T1.SchdPriPaid, T1.SchPriPaid, 
	                      T1.Specifier, T1.DefSchdDate, T1.SchdMethod, T1.MrgRate, 
	                      T1.CalOnIndRate,T1.FeeChargeAmt, T1.CalculatedRate, T1.OrgPft, T1.OrgPri, T1.OrgEndBal, T1.OrgPlanPft, T1.FeeSchd, T1.SchdFeePaid, T1.SchdFeeOS, T1.InsSchd, T1. SchdInsPaid, 
	                       T1.AdvPftRate , T1.AdvProfit ,  T1.AdvRepayAmount , T1.AdvBaseRate , T1.AdvMargin , T1.AdvCalRate, T1.SuplRent ,  T1.IncrCost ,  T1.SuplRentPaid ,  T1.IncrCostPaid ,
	                       T1.RolloverOnSchDate,  T1.RolloverAmount,  T1.RolloverAmountPaid, T1.TDSAmount, T1.TDSPaid,
	                       T1.PftDaysBasis,T1.InsuranceAmt, T1.InstNumber, T1.BpiOrHoliday, T1.FrqDate
	
		FROM         WIFFinScheduleDetails_Temp T1
		UNION ALL
				SELECT     T1.FinReference, T1.SchSeq, T1.SchDate, T1.PftOnSchDate, T1.RepayOnSchDate, T1.CpzOnSchDate, T1.RvwOnSchDate, T1.DisbOnSchDate, 
	                     T1.DownpaymentOnSchDate, T1.BalanceForPftCal, T1.BaseRate, T1.SplRate, T1.ActRate, T1.NoOfDays, T1.DayFactor, T1.ProfitCalc, T1.ProfitSchd, 
	                      T1.PrincipalSchd, T1.RepayAmount, T1.ProfitBalance, T1.DisbAmount, T1.CpzAmount, T1.DownPaymentAmount,  
	                      T1.ClosingBalance, T1.ProfitFraction, T1.PrvRepayAmount, T1.SchdPftPaid, T1.SchPftPaid, T1.SchdPriPaid, T1.SchPriPaid, 
	                      T1.Specifier, T1.DefSchdDate, T1.SchdMethod, T1.MrgRate, 
	                      T1.CalOnIndRate,T1.FeeChargeAmt, T1.CalculatedRate, T1.OrgPft, T1.OrgPri, T1.OrgEndBal, T1.OrgPlanPft, T1.FeeSchd, T1.SchdFeePaid, T1.SchdFeeOS, T1.InsSchd, T1. SchdInsPaid, 
	                       T1.AdvPftRate , T1.AdvProfit ,  T1.AdvRepayAmount , T1.AdvBaseRate , T1.AdvMargin , T1.AdvCalRate, T1.SuplRent ,  T1.IncrCost ,  T1.SuplRentPaid ,  T1.IncrCostPaid ,
	                       T1.RolloverOnSchDate,  T1.RolloverAmount,  T1.RolloverAmountPaid, T1.TDSAmount, T1.TDSPaid,
	                       T1.PftDaysBasis,T1.InsuranceAmt, T1.InstNumber, T1.BpiOrHoliday, T1.FrqDate
	
		FROM         WIFFinScheduleDetails T1
		WHERE     NOT EXISTS
	                          (SELECT     1
	                            FROM          WIFFinScheduleDetails_Temp
	                            WHERE      FinReference = T1.FinReference)				
		</createView>
	</changeSet>		
	
	
	<changeSet id="50" author="Siva">
	<sql>
		UPDATE  FinRepayDetails SET FinSchdTdsPaid = 0;
		UPDATE  FINREPAYSCHEDULEDETAIL SET TdsSchdPayNow = 0;
		UPDATE  FINREPAYSCHEDULEDETAIL_TEMP SET TdsSchdPayNow = 0;
		UPDATE  FINSCHEDULEDETAILS SET TDSPaid = 0;
		UPDATE  FINSCHEDULEDETAILS_TEMP SET TDSPaid = 0;
		UPDATE  FINSCHEDULEDETAILS_PA SET TDSPaid = 0;
		UPDATE  FINSCHEDULEDETAILS_LOG SET TDSPaid = 0;
		UPDATE  REJECTFINSCHEDULEDETAILS SET TDSPaid = 0;
		UPDATE  WIFFINSCHEDULEDETAILS SET TDSPaid = 0;
		UPDATE  WIFFINSCHEDULEDETAILS_TEMP SET TDSPaid = 0;
	</sql>
	</changeSet>
	<changeSet id="51" author="Kesav">
	<sql>
		UPDATE BMTAEevents SET MANDATORY = 1 WHERE AEEVENTCODE = 'ADDDBSN';
	</sql>
	</changeSet>
	
	
		<changeSet id="52" author="Durgaprasad G">
		<addColumn tableName="PRESENTMENTDETAILS">
			<column name="ManualAdviseId" type="bigint" />
		</addColumn>
	</changeSet>
	
		<changeSet id="53" author="Durgaprasad G">
		<addColumn tableName="PRESENTMENTDETAILS_TEMP">
			<column name="ManualAdviseId" type="bigint" />
		</addColumn>
	</changeSet>
	
<changeSet id="54" author="Durgaprasad g">
		<createView viewName="PRESENTMENTDETAILS_AVIEW" replaceIfExists="true">
  SELECT		T1.ID, T1.PRESENTMENTID, T1.PRESENTMENTREF, T1.FINREFERENCE, T1.SCHDATE, T1.MANDATEID, T1.SCHAMTDUE, T1.SCHPRIDUE, T1.SCHPFTDUE, T1.SCHFEEDUE, T1.SCHINSDUE,
							T1.schPenaltyDue, T1.advanceAmt, T1.excessID, T1.adviseAmt, T1.presentmentAmt, T1.ExcludeReason, T1. TDSAMOUNT, T1.bounceID, T1.emiNo, T1.status,
							T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId,T2.MANDATETYPE,T3.FINTYPE,T4.FINTYPEDESC,
      						T5.CUSTSHRTNAME CUSTOMERNAME  ,T1.ReceiptID, T1.ECSRETURN, T1.ErrorCode, T1.ErrorDesc, T1.ManualAdviseId 
				FROM 		PRESENTMENTDETAILS    T1  INNER JOIN 
							MANDATES  T2 ON T1.MANDATEID = T2.MANDATEID INNER JOIN 
							FINANCEMAIN T3 ON T1.FINREFERENCE = T3.FINREFERENCE INNER JOIN 
							RMTFINANCETYPES T4 ON T3.FINTYPE  = T4.FINTYPE INNER JOIN 
							CUSTOMERS T5 ON T5.CUSTID  = T3.CUSTID
							
	</createView>
</changeSet>							

<changeSet id="55" author="Durgaprasad g">
		<createView viewName="PRESENTMENTDETAILS_VIEW" replaceIfExists="true">
			SELECT		T1.ID, T1.PRESENTMENTID, T1.PRESENTMENTREF, T1.FINREFERENCE, T1.SCHDATE, T1.MANDATEID, T1.SCHAMTDUE, T1.SCHPRIDUE, T1.SCHPFTDUE, T1.SCHFEEDUE, T1.SCHINSDUE,
										T1.schPenaltyDue, T1.advanceAmt, T1.excessID, T1.adviseAmt, T1.presentmentAmt, T1.ExcludeReason, T1. TDSAMOUNT, T1.bounceID, T1.emiNo, T1.status,
										T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId,
										T2.MANDATETYPE,T3.FINTYPE,T4.FINTYPEDESC, T5.CUSTSHRTNAME CUSTOMERNAME, T1.ReceiptID ,T1.ECSRETURN,
										T1.ErrorCode, T1.ErrorDesc, T1.ManualAdviseId  
							FROM 		PRESENTMENTDETAILS_TEMP  T1  INNER JOIN 
										MANDATES  T2 ON T1.MANDATEID = T2.MANDATEID INNER JOIN 
										FINANCEMAIN T3 ON T1.FINREFERENCE = T3.FINREFERENCE INNER JOIN 
										RMTFINANCETYPES T4 ON T3.FINTYPE  = T4.FINTYPE INNER JOIN 
										CUSTOMERS T5 ON T5.CUSTID  = T3.CUSTID
			UNION ALL

			SELECT		T1.ID, T1.PRESENTMENTID, T1.PRESENTMENTREF, T1.FINREFERENCE, T1.SCHDATE, T1.MANDATEID, T1.SCHAMTDUE, T1.SCHPRIDUE, T1.SCHPFTDUE, T1.SCHFEEDUE, T1.SCHINSDUE,
										T1.schPenaltyDue, T1.advanceAmt, T1.excessID, T1.adviseAmt, T1.presentmentAmt, T1.ExcludeReason, T1. TDSAMOUNT, T1.bounceID, T1.emiNo, T1.status,
										T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId,
										T2.MANDATETYPE,T3.FINTYPE,T4.FINTYPEDESC, T5.CUSTSHRTNAME CUSTOMERNAME , T1.ReceiptID ,T1.ECSRETURN,
										T1.ErrorCode, T1.ErrorDesc, T1.ManualAdviseId  
							FROM 		PRESENTMENTDETAILS    T1  INNER JOIN 
										MANDATES  T2 ON T1.MANDATEID = T2.MANDATEID INNER JOIN 
										FINANCEMAIN T3 ON T1.FINREFERENCE = T3.FINREFERENCE INNER JOIN 
										RMTFINANCETYPES T4 ON T3.FINTYPE  = T4.FINTYPE INNER JOIN 
										CUSTOMERS T5 ON T5.CUSTID  = T3.CUSTID
			WHERE     NOT EXISTS (SELECT 1 FROM PRESENTMENTDETAILS_TEMP WHERE ID = T1.ID)
	</createView>
</changeSet>
				
<changeSet id="56" author="Irfan">
	<createView viewName="MANUALADVISE_AVIEW" replaceIfExists="true">
	SELECT		T1.AdviseID, T1.AdviseType, T1.FinReference, T1.FeeTypeID, T1.Sequence,
  				T1.AdviseAmount, T1.PaidAmount, T1.WaivedAmount, T1.Remarks, T1.ValueDate, T1.PostDate,
  					T1.Version, T1.LastMntBy, T1.LastMntOn, T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, 
                      T1.NextTaskId, T1.RecordType, T1.WorkflowId, T2.FeeTypeDesc, T2.FeeTypeCode, T1.BounceID, T1.ReceiptID,T3.BOUNCECODE
				FROM    	ManualAdvise  T1
       			LEFT JOIN FEETYPES T2 ON T1.FeeTypeID = T2.FeeTypeID
				LEFT JOIN BOUNCEREASONS T3 ON T1.BounceID = T3.BOUNCEID	
	</createView>

</changeSet>
<changeSet id="57" author="Prasad">
	<createView viewName="RPT_SOA_TXNDETAILS_VIEW" replaceIfExists="true">
	<![CDATA[Select T1.Finreference,Schdate,Particulars,Debit,Credit,ccyMinorccyunits,ccyEditField,
		 (Select to_date(sysparmvalue, 'YYYY-MM-DD')  sysparmvalue from smtparameters where SYSPARMCODE='APP_DATE') APP_DATE 
		 from ( 
			Select Finreference,Schdate, (case when Disbonschdate=1 then 'Amount Financed - Payable ('||Finreference||')' 
									     when BPIORHOLIDAY='B' then 'Broken Period Interest Receivable -Due('||Finreference||')' else 
											  'Due for Installment '||INSTNUMBER||' ('||Finreference||')' end) Particulars,
			 case when Disbonschdate=1 then 0 else Repayamount end Debit,
			 case when Disbonschdate=1 then DisbAmount else 0 end Credit
	   from finscheduledetails  
	   where (BPIORHOLIDAY!='H' or BPIORHOLIDAY is null) and 
			 schdate<=(Select to_date(sysparmvalue, 'YYYY-MM-DD')  sysparmvalue from smtparameters where SYSPARMCODE='APP_DATE')  			 
	union 	
		SELECT FINREFERENCE,M.VALUEDATE,(CASE WHEN F.FEETYPEID IS NOT NULL THEN FEETYPEDESC 
		else 'Bounce' end) ||'- Due ('||Finreference||')' ,m.ADVISEAMOUNT Debit ,0 Credit 
		FROM MANUALADVISE M
		LEFT JOIN FEETYPES F ON F.FEETYPEID = M.FEETYPEID 	
		LEFT JOIN BOUNCEREASONS T3 ON M.BounceID = T3.BOUNCEID		
	union	
		Select REFERENCE,Receiveddate,(Case when PAYMENTTYPE NOT in ('EXCESS','CASH') then 'Payment Recieved vide '||PAYMENTTYPE ||' No.:'||CHEQUEACNO ||'('||REFERENCE||')'
										 when PAYMENTTYPE in ('EXCESS') then 'Amount Adjusted ('||REFERENCE||')' 
										 when PAYMENTTYPE in ('CASH') then 'Cash received Vide Receipt No.'||CHEQUEACNO ||'('||REFERENCE||')' end) Particulars,
			    Case when PAYMENTTYPE NOT in ('EXCESS') then 0  when PAYMENTTYPE in ('EXCESS') then Amount end debit,Amount credit
		from FINRECEIPTHEADER T1 inner join 
			 FINRECEIPTDETAIL T2 on T1.RECEIPTID =T2.RECEIPTID			 
	union 	
		Select finreference, FinODSchdDate, 'Penalty Due Created for Past due till date ' || FINODTILLDATE Particulars, 
		TotPenaltyAmt Debit, 0 credit
		From FinODDetails where TOtPenaltyAmt > 0 
	)T1 
	 inner join finpftdetails t2 on t2.Finreference=t1.Finreference
	 inner join RMTCURRENCIES C on C.ccycode= T2.finccy]]>
	</createView>

</changeSet>

</databaseChangeLog>