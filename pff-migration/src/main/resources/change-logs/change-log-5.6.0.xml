<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value="" dbms="oracle" />
	<property name="add.schema" value="" dbms="postgresql" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PLFAVANSEQC.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()" dbms="postgresql" />

	<changeSet id="pre_run_for_pgp" author="Adarsh" runAlways="true" dbms="postgresql">
		<sql>
			Set search_path = plf,public,pg_catalog;
		</sql>
	</changeSet>

	<changeSet id="01" author="shekar.b">
		<addColumn tableName="RMTFINANCETYPES">
			<column name="AlwPlannedEmiInGrc" type="boolean" />
		</addColumn>
	</changeSet>

	<changeSet id="02" author="shekar.b">
		<addColumn tableName="RMTFINANCETYPES_Temp">
			<column name="AlwPlannedEmiInGrc" type="boolean" />
		</addColumn>
	</changeSet>

	<changeSet id="2.1" author="Thirupathi.m" dbms="postgresql, oracle">
		<addDefaultValue columnName="AlwPlannedEmiInGrc" tableName="RMTFINANCETYPES" defaultValue="0" />
		<addDefaultValue columnName="AlwPlannedEmiInGrc" tableName="RMTFINANCETYPES_Temp" defaultValue="0" />
	</changeSet>

	<changeSet id="2.2" author="Thirupathi.m" dbms="mssql">
		<sql>
			<![CDATA[
				ALTER TABLE RMTFINANCETYPES ADD CONSTRAINT DF_RMTFNNCTYPS_APEIG DEFAULT 0 FOR AlwPlannedEmiInGrc;
				ALTER TABLE RMTFINANCETYPES_Temp ADD CONSTRAINT DF_RMTFNNCTYPS_T_APEIG DEFAULT 0 FOR AlwPlannedEmiInGrc;
			]]>
		</sql>
	</changeSet>

	<changeSet id="03" author="shekar.b">
		<sql>
			<![CDATA[
				Update RMTFinanceTypes set AlwPlannedEmiInGrc = 0;
				Update RMTFinanceTypes_Temp set AlwPlannedEmiInGrc = 0;
			]]>
		</sql>
	</changeSet>

	<changeSet id="3.1" author="shekar.b">
		<addNotNullConstraint tableName="RMTFinanceTypes" columnName="AlwPlannedEmiInGrc" columnDataType="boolean" />
		<addNotNullConstraint tableName="RMTFINANCETYPES_Temp" columnName="AlwPlannedEmiInGrc"
			columnDataType="boolean" />
	</changeSet>

	<changeSet id="04_pre" author="shekar.b" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'rmtfinancetypes_view');
		 	]]>
		</sql>
	</changeSet>

	<changeSet id="04" author="shekar.b">
		<createView viewName="RMTFINANCETYPES_VIEW" replaceIfExists="true">
		  <![CDATA[
			SELECT t1.fintype,
			t1.fincategory,
			t1.fintypedesc,
			t1.finccy,
			t1.findayscaltype,
			t1.finactype,
			t1.fincontingentactype,
			t1.finisgenref,
			t1.finmaxamount,
			t1.finminamount,
			t1.finisopennewfinac,
			t1.findftstmtfrq,
			t1.finisalwmd,
			t1.finschdmthd,
			t1.finisalwgrace,
			t1.finhistretension,
			t1.equalrepayment,
			t1.finratetype,
			t1.finbaserate,
			t1.finsplrate,
			t1.finintrate,
			t1.finminrate,
			t1.finmaxrate,
			t1.findftintfrq,
			t1.finisintcpz,
			t1.fincpzfrq,
			t1.finisrvwalw,
			t1.finrvwfrq,
			t1.fingrcratetype,
			t1.fingrcbaserate,
			t1.fingrcsplrate,
			t1.fingrcintrate,
			t1.fingrcminrate,
			t1.fingrcmaxrate,
			t1.fingrcdftintfrq,
			t1.fingrcisintcpz,
			t1.fingrccpzfrq,
			t1.fingrcisrvwalw,
			t1.fingrcrvwfrq,
			t1.finminterm,
			t1.finmaxterm,
			t1.findftterms,
			t1.finrpyfrq,
			t1.finrepaymethod,
			t1.finisalwpartialrpy,
			t1.finisalwdifferment,
			t1.finmaxdifferment,
			t1.finisalwearlyrpy,
			t1.finisalwearlysettle,
			t1.finodrpytries,
			t1.finearlypayrule,
			t1.finearlysettlerule,
			t1.findepositrestrictedto,
			t1.finaebuyorinception,
			t1.finaesellormaturity,
			t1.finisactive,
			t1.version,
			t1.lastmntby,
			t1.lastmnton,
			t1.recordstatus,
			t1.rolecode,
			t1.nextrolecode,
			t1.taskid,
			t1.nexttaskid,
			t1.recordtype,
			t1.workflowid,
			t1.stepfinance,
			t1.steppingmandatory,
			t1.alwmanualsteps,
			t1.alwdsteppolicies,
			t1.dftsteppolicy,
			t4.actypedesc AS lovdescfincontingentactypename,
			t5.actypedesc AS lovdescfinactypename,
			t1.finisdwpayrequired,
			t1.finrvwrateapplfor,
			t1.finalwratechangeanydate,
			t1.finisintcpzatgrcend,
			t1.finelgrulecode,
			t1.limitelgrulecode,
			t1.finschcalcodeonrvw,
			t1.alwplandeferment,
			t1.plandefercount,
			t1.finassettype,
			t1.pftpayactype,
			t1.finisopenpftpayacc,
			t31.actypedesc AS lovdescpftpayactypename,
			t1.finisalwgrcrepay,
			t1.fingrcschdmthd,
			t1.fingrcmargin,
			t1.finmargin,
			t1.finscheduleon,
			t1.fingrcscheduleon,
			t1.fincommitmentreq,
			t1.fincollateralreq,
			t1.findepreciationreq,
			t1.findepreciationfrq,
			t1.finbankcontingentactype,
			t1.finprovisionactype,
			t38.actypedesc AS lovdescfinbankcontactypename,
			t39.actypedesc AS lovdescfinprovisionactypename,
			t1.allowriainvestment,
			t1.overridelimit,
			t1.limitrequired,
			t1.fincommitmentovrride,
			t1.fincollateralovrride,
			t1.finpftunchanged,
			t1.applyodpenalty,
			t1.odincgrcdays,
			t1.odchargetype,
			t1.odgracedays,
			t1.odchargecalon,
			t1.odchargeamtorperc,
			t1.odallowwaiver,
			t1.odmaxwaiverperc,
			t1.findivision,
			t48.divisioncodedesc AS lovdescfindivisionname,
			t48.entitycode AS lovdescentitycode,
			t1.finsuspactype,
			t49.actypedesc AS lovdescfinsuspactypename,
			t1.product,
			t1.startdate,
			t1.enddate,
			t1.allowdownpaypgm,
			t1.fintypedesc AS lovdescpromofintypedesc,
			t1.remarks,
			t1.alwearlypaymethods,
			t1.pastduepftcalmthd,
			t1.pastduepftmargin,
			t1.alwadvancerent,
			t1.grcadvbaserate,
			t1.grcadvmargin,
			t1.grcadvpftrate,
			t1.rpyadvbaserate,
			t1.rpyadvmargin,
			t1.rpyadvpftrate,
			t1.rolloverfinance,
			t1.rolloverfrq,
			t1.downpayrule,
			t59.rulecode AS downpayrulecode,
			t59.rulecodedesc AS downpayruledesc,
			t1.finsusptrigger,
			t1.finsuspremarks,
			t1.alwmultipartydisb,
			t1.collateraltype,
			t1.tdsapplicable,
			t1.manualschedule,
			t1.applygrcpricing,
			t1.grcpricingmethod,
			t1.applyrpypricing,
			t1.rpypricingmethod,
			t1.rpyhierarchy,
			t67.rulecode AS grcpricingmethoddesc,
			t68.rulecode AS rpypricingmethoddesc,
			t1.droplineod,
			t1.droppingmethod,
			t1.ratechganyday,
			t1.finrepaypftonfrq,
			t1.alwbpi,
			t1.bpitreatment,
			t1.pftdueschon,
			t1.planemihalw,
			t1.planemihmethod,
			t1.planemihmaxperyear,
			t1.planemihmax,
			t1.planemihlockperiod,
			t1.planemicpz,
			t1.unplanemihlockperiod,
			t1.unplanemicpz,
			t1.reagecpz,
			t1.fddlockperiod,
			t1.alwdrpymethods,
			t1.maxunplannedemi,
			t1.maxreageholidays,
			t1.roundingmode,
			t1.roundingtarget,
			t1.frequencydays,
			t1.quickdisb,
			t1.alwmaxdisbcheckreq,
			t1.alwreage,
			t1.alwunplanemiholiday,
			t1.profitcenterid,
			t69.profitcentercode,
			t69.profitcenterdesc,
			t1.productcategory,
			t2.productdesc AS fincategorydesc,
			t1.developerfinance,
			t1.costoffunds,
			t1.chequecapturereq,
			t1.finltvcheck,
			t1.partiallysecured,
			t1.alwadvemi,
			t1.advemiminterms,
			t1.advemimaxterms,
			t1.advemidftterms,
			t1.advemischdmthd,
			t1.bpipftdaysbasis,
			t1.eligibilitymethods,
			t1.alwhybridrate,
			t1.fixedratetenor,
			t1.odmincapamount,
			t1.odrulecode,
			t1.alwzerointacc,
			t1.autorejectiondays,
			t1.taxnomand,
			t1.putcallrequired,
			t1.grcadvintersetreq,
			t1.grcadvtype,
			t1.grcadvminterms,
			t1.grcadvmaxterms,
			t1.grcadvdefaultterms,
			t1.advintersetreq,
			t1.advtype,
			t1.advminterms,
			t1.advmaxterms,
			t1.advdefaultterms,
			t1.advstage,
			t1.dsfreq,
			t1.cashcollateralreq,
			t1.tdsallowtomodify,
			t1.tdsapplicableto,
			t1.alwvan,
			t1.vanallocationmethod,
			t1.allowdrawingpower,
			t1.allowrevolving,
			t1.alwsanctionamt,
			t1.alwsanctionamtoverride,
			t1.sanbsdschdle,
			t1.finisratervwatgrcend,
			t1.schdonpmtcal,
			t1.autoapprove,
			t1.AlwPlannedEmiInGrc
		   FROM rmtfinancetypes_temp t1
			 LEFT JOIN bmtproduct t2 ON t1.fincategory = t2.productcode
			 LEFT JOIN rmtaccounttypes t4 ON t1.fincontingentactype = t4.actype
			 LEFT JOIN rmtaccounttypes t38 ON t1.finbankcontingentactype = t38.actype
			 LEFT JOIN rmtaccounttypes t39 ON t1.finprovisionactype = t39.actype
			 LEFT JOIN rmtaccounttypes t5 ON t1.finactype = t5.actype
			 LEFT JOIN rmtaccounttypes t31 ON t1.pftpayactype = t31.actype
			 LEFT JOIN smtdivisiondetail t48 ON t1.findivision = t48.divisioncode
			 LEFT JOIN rmtaccounttypes t49 ON t1.finsuspactype = t49.actype
			 LEFT JOIN rules t59 ON t1.downpayrule = t59.ruleid
			 LEFT JOIN rules t67 ON t1.grcpricingmethod = t67.ruleid
			 LEFT JOIN rules t68 ON t1.rpypricingmethod = t68.ruleid
			 LEFT JOIN profitcenters t69 ON t69.profitcenterid = t1.profitcenterid
		UNION ALL
		 SELECT t1.fintype,
			t1.fincategory,
			t1.fintypedesc,
			t1.finccy,
			t1.findayscaltype,
			t1.finactype,
			t1.fincontingentactype,
			t1.finisgenref,
			t1.finmaxamount,
			t1.finminamount,
			t1.finisopennewfinac,
			t1.findftstmtfrq,
			t1.finisalwmd,
			t1.finschdmthd,
			t1.finisalwgrace,
			t1.finhistretension,
			t1.equalrepayment,
			t1.finratetype,
			t1.finbaserate,
			t1.finsplrate,
			t1.finintrate,
			t1.finminrate,
			t1.finmaxrate,
			t1.findftintfrq,
			t1.finisintcpz,
			t1.fincpzfrq,
			t1.finisrvwalw,
			t1.finrvwfrq,
			t1.fingrcratetype,
			t1.fingrcbaserate,
			t1.fingrcsplrate,
			t1.fingrcintrate,
			t1.fingrcminrate,
			t1.fingrcmaxrate,
			t1.fingrcdftintfrq,
			t1.fingrcisintcpz,
			t1.fingrccpzfrq,
			t1.fingrcisrvwalw,
			t1.fingrcrvwfrq,
			t1.finminterm,
			t1.finmaxterm,
			t1.findftterms,
			t1.finrpyfrq,
			t1.finrepaymethod,
			t1.finisalwpartialrpy,
			t1.finisalwdifferment,
			t1.finmaxdifferment,
			t1.finisalwearlyrpy,
			t1.finisalwearlysettle,
			t1.finodrpytries,
			t1.finearlypayrule,
			t1.finearlysettlerule,
			t1.findepositrestrictedto,
			t1.finaebuyorinception,
			t1.finaesellormaturity,
			t1.finisactive,
			t1.version,
			t1.lastmntby,
			t1.lastmnton,
			t1.recordstatus,
			t1.rolecode,
			t1.nextrolecode,
			t1.taskid,
			t1.nexttaskid,
			t1.recordtype,
			t1.workflowid,
			t1.stepfinance,
			t1.steppingmandatory,
			t1.alwmanualsteps,
			t1.alwdsteppolicies,
			t1.dftsteppolicy,
			t4.actypedesc AS lovdescfincontingentactypename,
			t5.actypedesc AS lovdescfinactypename,
			t1.finisdwpayrequired,
			t1.finrvwrateapplfor,
			t1.finalwratechangeanydate,
			t1.finisintcpzatgrcend,
			t1.finelgrulecode,
			t1.limitelgrulecode,
			t1.finschcalcodeonrvw,
			t1.alwplandeferment,
			t1.plandefercount,
			t1.finassettype,
			t1.pftpayactype,
			t1.finisopenpftpayacc,
			t31.actypedesc AS lovdescpftpayactypename,
			t1.finisalwgrcrepay,
			t1.fingrcschdmthd,
			t1.fingrcmargin,
			t1.finmargin,
			t1.finscheduleon,
			t1.fingrcscheduleon,
			t1.fincommitmentreq,
			t1.fincollateralreq,
			t1.findepreciationreq,
			t1.findepreciationfrq,
			t1.finbankcontingentactype,
			t1.finprovisionactype,
			t38.actypedesc AS lovdescfinbankcontactypename,
			t39.actypedesc AS lovdescfinprovisionactypename,
			t1.allowriainvestment,
			t1.overridelimit,
			t1.limitrequired,
			t1.fincommitmentovrride,
			t1.fincollateralovrride,
			t1.finpftunchanged,
			t1.applyodpenalty,
			t1.odincgrcdays,
			t1.odchargetype,
			t1.odgracedays,
			t1.odchargecalon,
			t1.odchargeamtorperc,
			t1.odallowwaiver,
			t1.odmaxwaiverperc,
			t1.findivision,
			t48.divisioncodedesc AS lovdescfindivisionname,
			t48.entitycode AS lovdescentitycode,
			t1.finsuspactype,
			t49.actypedesc AS lovdescfinsuspactypename,
			t1.product,
			t1.startdate,
			t1.enddate,
			t1.allowdownpaypgm,
			t1.fintypedesc AS lovdescpromofintypedesc,
			t1.remarks,
			t1.alwearlypaymethods,
			t1.pastduepftcalmthd,
			t1.pastduepftmargin,
			t1.alwadvancerent,
			t1.grcadvbaserate,
			t1.grcadvmargin,
			t1.grcadvpftrate,
			t1.rpyadvbaserate,
			t1.rpyadvmargin,
			t1.rpyadvpftrate,
			t1.rolloverfinance,
			t1.rolloverfrq,
			t1.downpayrule,
			t59.rulecode AS downpayrulecode,
			t59.rulecodedesc AS downpayruledesc,
			t1.finsusptrigger,
			t1.finsuspremarks,
			t1.alwmultipartydisb,
			t1.collateraltype,
			t1.tdsapplicable,
			t1.manualschedule,
			t1.applygrcpricing,
			t1.grcpricingmethod,
			t1.applyrpypricing,
			t1.rpypricingmethod,
			t1.rpyhierarchy,
			t67.rulecode AS grcpricingmethoddesc,
			t68.rulecode AS rpypricingmethoddesc,
			t1.droplineod,
			t1.droppingmethod,
			t1.ratechganyday,
			t1.finrepaypftonfrq,
			t1.alwbpi,
			t1.bpitreatment,
			t1.pftdueschon,
			t1.planemihalw,
			t1.planemihmethod,
			t1.planemihmaxperyear,
			t1.planemihmax,
			t1.planemihlockperiod,
			t1.planemicpz,
			t1.unplanemihlockperiod,
			t1.unplanemicpz,
			t1.reagecpz,
			t1.fddlockperiod,
			t1.alwdrpymethods,
			t1.maxunplannedemi,
			t1.maxreageholidays,
			t1.roundingmode,
			t1.roundingtarget,
			t1.frequencydays,
			t1.quickdisb,
			t1.alwmaxdisbcheckreq,
			t1.alwreage,
			t1.alwunplanemiholiday,
			t1.profitcenterid,
			t69.profitcentercode,
			t69.profitcenterdesc,
			t1.productcategory,
			t2.productdesc AS fincategorydesc,
			t1.developerfinance,
			t1.costoffunds,
			t1.chequecapturereq,
			t1.finltvcheck,
			t1.partiallysecured,
			t1.alwadvemi,
			t1.advemiminterms,
			t1.advemimaxterms,
			t1.advemidftterms,
			t1.advemischdmthd,
			t1.bpipftdaysbasis,
			t1.eligibilitymethods,
			t1.alwhybridrate,
			t1.fixedratetenor,
			t1.odmincapamount,
			t1.odrulecode,
			t1.alwzerointacc,
			t1.autorejectiondays,
			t1.taxnomand,
			t1.putcallrequired,
			t1.grcadvintersetreq,
			t1.grcadvtype,
			t1.grcadvminterms,
			t1.grcadvmaxterms,
			t1.grcadvdefaultterms,
			t1.advintersetreq,
			t1.advtype,
			t1.advminterms,
			t1.advmaxterms,
			t1.advdefaultterms,
			t1.advstage,
			t1.dsfreq,
			t1.cashcollateralreq,
			t1.tdsallowtomodify,
			t1.tdsapplicableto,
			t1.alwvan,
			t1.vanallocationmethod,
			t1.allowdrawingpower,
			t1.allowrevolving,
			t1.alwsanctionamt,
			t1.alwsanctionamtoverride,
			t1.sanbsdschdle,
			t1.finisratervwatgrcend,
			t1.schdonpmtcal,
			t1.autoapprove,
			t1.AlwPlannedEmiInGrc
		   FROM rmtfinancetypes t1
			 LEFT JOIN bmtproduct t2 ON t1.fincategory = t2.productcode
			 LEFT JOIN rmtaccounttypes t4 ON t1.fincontingentactype = t4.actype
			 LEFT JOIN rmtaccounttypes t38 ON t1.finbankcontingentactype = t38.actype
			 LEFT JOIN rmtaccounttypes t39 ON t1.finprovisionactype = t39.actype
			 LEFT JOIN rmtaccounttypes t5 ON t1.finactype = t5.actype
			 LEFT JOIN rmtaccounttypes t31 ON t1.pftpayactype = t31.actype
			 LEFT JOIN smtdivisiondetail t48 ON t1.findivision = t48.divisioncode
			 LEFT JOIN rmtaccounttypes t49 ON t1.finsuspactype = t49.actype
			 LEFT JOIN rules t59 ON t1.downpayrule = t59.ruleid
			 LEFT JOIN rules t67 ON t1.grcpricingmethod = t67.ruleid
			 LEFT JOIN rules t68 ON t1.rpypricingmethod = t68.ruleid
			 LEFT JOIN profitcenters t69 ON t69.profitcenterid = t1.profitcenterid
			 WHERE NOT (EXISTS ( SELECT 1 AS expr1
				 FROM rmtfinancetypes_temp
				  WHERE rmtfinancetypes_temp.fintype = t1.fintype))
			]]>
		</createView>
	</changeSet>

	<changeSet id="04_post" author="Shinde.b" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'rmtfinancetypes_view');
			]]>
		</sql>
	</changeSet>

	<changeSet id="05_pre" author="shekar.b" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'rmtfinancetypes_aview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="05" author="shekar.b">
		<createView viewName="RMTFINANCETYPES_AVIEW" replaceIfExists="true">
			<![CDATA[ 
			SELECT t1.fintype,
			t1.fincategory,
			t1.fintypedesc,
			t1.finccy,
			t1.findayscaltype,
			t1.finactype,
			t1.fincontingentactype,
			t1.finisgenref,
			t1.finmaxamount,
			t1.finminamount,
			t1.finisopennewfinac,
			t1.findftstmtfrq,
			t1.finisalwmd,
			t1.finschdmthd,
			t1.finisalwgrace,
			t1.finhistretension,
			t1.equalrepayment,
			t1.finratetype,
			t1.finbaserate,
			t1.finsplrate,
			t1.finintrate,
			t1.finminrate,
			t1.finmaxrate,
			t1.findftintfrq,
			t1.finisintcpz,
			t1.fincpzfrq,
			t1.finisrvwalw,
			t1.finrvwfrq,
			t1.fingrcratetype,
			t1.fingrcbaserate,
			t1.fingrcsplrate,
			t1.fingrcintrate,
			t1.fingrcminrate,
			t1.fingrcmaxrate,
			t1.fingrcdftintfrq,
			t1.fingrcisintcpz,
			t1.fingrccpzfrq,
			t1.fingrcisrvwalw,
			t1.fingrcrvwfrq,
			t1.finminterm,
			t1.finmaxterm,
			t1.findftterms,
			t1.finrpyfrq,
			t1.finrepaymethod,
			t1.finisalwpartialrpy,
			t1.finisalwdifferment,
			t1.finmaxdifferment,
			t1.finisalwearlyrpy,
			t1.finisalwearlysettle,
			t1.finodrpytries,
			t1.finearlypayrule,
			t1.finearlysettlerule,
			t1.findepositrestrictedto,
			t1.finaebuyorinception,
			t1.finaesellormaturity,
			t1.finisactive,
			t1.version,
			t1.lastmntby,
			t1.lastmnton,
			t1.recordstatus,
			t1.rolecode,
			t1.nextrolecode,
			t1.taskid,
			t1.nexttaskid,
			t1.recordtype,
			t1.workflowid,
			t1.stepfinance,
			t1.steppingmandatory,
			t1.alwmanualsteps,
			t1.alwdsteppolicies,
			t1.dftsteppolicy,
			t4.actypedesc AS lovdescfincontingentactypename,
			t5.actypedesc AS lovdescfinactypename,
			t1.finisdwpayrequired,
			t1.finrvwrateapplfor,
			t1.finalwratechangeanydate,
			t1.finisintcpzatgrcend,
			t1.finelgrulecode,
			t1.limitelgrulecode,
			t1.finschcalcodeonrvw,
			t1.alwplandeferment,
			t1.plandefercount,
			t1.finassettype,
			t1.pftpayactype,
			t1.finisopenpftpayacc,
			t31.actypedesc AS lovdescpftpayactypename,
			t1.finisalwgrcrepay,
			t1.fingrcschdmthd,
			t1.fingrcmargin,
			t1.finmargin,
			t1.finscheduleon,
			t1.fingrcscheduleon,
			t1.fincommitmentreq,
			t1.fincollateralreq,
			t1.findepreciationreq,
			t1.findepreciationfrq,
			t1.finbankcontingentactype,
			t1.finprovisionactype,
			t38.actypedesc AS lovdescfinbankcontactypename,
			t39.actypedesc AS lovdescfinprovisionactypename,
			t1.allowriainvestment,
			t1.overridelimit,
			t1.limitrequired,
			t1.fincommitmentovrride,
			t1.fincollateralovrride,
			t1.finpftunchanged,
			t1.applyodpenalty,
			t1.odincgrcdays,
			t1.odchargetype,
			t1.odgracedays,
			t1.odchargecalon,
			t1.odchargeamtorperc,
			t1.odallowwaiver,
			t1.odmaxwaiverperc,
			t1.findivision,
			t48.divisioncodedesc AS lovdescfindivisionname,
			t48.entitycode AS lovdescentitycode,
			t1.finsuspactype,
			t49.actypedesc AS lovdescfinsuspactypename,
			t1.product,
			t1.startdate,
			t1.enddate,
			t1.allowdownpaypgm,
			t1.remarks,
			t1.alwearlypaymethods,
			t1.pastduepftcalmthd,
			t1.pastduepftmargin,
			t1.alwadvancerent,
			t1.grcadvbaserate,
			t1.grcadvmargin,
			t1.grcadvpftrate,
			t1.rpyadvbaserate,
			t1.rpyadvmargin,
			t1.rpyadvpftrate,
			t1.rolloverfinance,
			t1.rolloverfrq,
			t1.downpayrule,
			t59.rulecode AS downpayrulecode,
			t59.rulecodedesc AS downpayruledesc,
			t1.finsusptrigger,
			t1.finsuspremarks,
			t1.alwmultipartydisb,
			t1.collateraltype,
			t1.tdsapplicable,
			t1.manualschedule,
			t1.applygrcpricing,
			t1.grcpricingmethod,
			t1.applyrpypricing,
			t1.rpypricingmethod,
			t1.rpyhierarchy,
			t67.rulecode AS grcpricingmethoddesc,
			t68.rulecode AS rpypricingmethoddesc,
			t1.droplineod,
			t1.droppingmethod,
			t1.ratechganyday,
			t1.finrepaypftonfrq,
			t1.alwbpi,
			t1.bpitreatment,
			t1.pftdueschon,
			t1.planemihalw,
			t1.planemihmethod,
			t1.planemihmaxperyear,
			t1.planemihmax,
			t1.planemihlockperiod,
			t1.planemicpz,
			t1.unplanemihlockperiod,
			t1.unplanemicpz,
			t1.reagecpz,
			t1.fddlockperiod,
			t1.alwdrpymethods,
			t1.maxunplannedemi,
			t1.maxreageholidays,
			t1.roundingmode,
			t1.roundingtarget,
			t1.frequencydays,
			t1.quickdisb,
			t1.alwreage,
			t1.alwunplanemiholiday,
			t1.alwmaxdisbcheckreq,
			t1.fintypedesc AS lovdescpromofintypedesc,
			t1.profitcenterid,
			t69.profitcentercode,
			t69.profitcenterdesc,
			t1.productcategory,
			t2.productdesc AS fincategorydesc,
			t1.developerfinance,
			t1.costoffunds,
			t1.chequecapturereq,
			t1.finltvcheck,
			t1.partiallysecured,
			t1.alwadvemi,
			t1.advemiminterms,
			t1.advemimaxterms,
			t1.advemidftterms,
			t1.advemischdmthd,
			t1.bpipftdaysbasis,
			t1.eligibilitymethods,
			t1.alwhybridrate,
			t1.fixedratetenor,
			t1.odmincapamount,
			t1.odrulecode,
			t1.alwzerointacc,
			t1.autorejectiondays,
			t1.taxnomand,
			t1.putcallrequired,
			t1.grcadvintersetreq,
			t1.grcadvtype,
			t1.grcadvminterms,
			t1.grcadvmaxterms,
			t1.grcadvdefaultterms,
			t1.advintersetreq,
			t1.advtype,
			t1.advminterms,
			t1.advmaxterms,
			t1.advdefaultterms,
			t1.advstage,
			t1.dsfreq,
			t1.cashcollateralreq,
			t1.tdsallowtomodify,
			t1.tdsapplicableto,
			t1.alwvan,
			t1.vanallocationmethod,
			t1.allowdrawingpower,
			t1.allowrevolving,
			t1.alwsanctionamt,
			t1.alwsanctionamtoverride,
			t1.sanbsdschdle,
			t1.finisratervwatgrcend,
			t1.schdonpmtcal,
			t1.autoapprove,
			t1.AlwPlannedEmiInGrc
		   FROM rmtfinancetypes t1
			 LEFT JOIN bmtproduct t2 ON t1.fincategory = t2.productcode
			 LEFT JOIN rmtaccounttypes t4 ON t1.fincontingentactype = t4.actype
			 LEFT JOIN rmtaccounttypes t38 ON t1.finbankcontingentactype = t38.actype
			 LEFT JOIN rmtaccounttypes t39 ON t1.finprovisionactype = t39.actype
			 LEFT JOIN rmtaccounttypes t5 ON t1.finactype = t5.actype
			 LEFT JOIN rmtaccounttypes t31 ON t1.pftpayactype = t31.actype
			 LEFT JOIN smtdivisiondetail t48 ON t1.findivision = t48.divisioncode
			 LEFT JOIN rmtaccounttypes t49 ON t1.finsuspactype = t49.actype
			 LEFT JOIN rules t59 ON t1.downpayrule = t59.ruleid
			 LEFT JOIN rules t67 ON t1.grcpricingmethod = t67.ruleid
			 LEFT JOIN rules t68 ON t1.rpypricingmethod = t68.ruleid
			 LEFT JOIN profitcenters t69 ON t69.profitcenterid = t1.profitcenterid
			]]>
		</createView>
	</changeSet>

	<changeSet id="05_post" author="shekar.b" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'rmtfinancetypes_aview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="06_pre" author="shekar.b" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'rmtfinancetypes_orgview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="06" author="shekar.b">
		<createView viewName="RMTFINANCETYPES_ORGVIEW" replaceIfExists="true">
			<![CDATA[ 
				SELECT t1.fintype,
			    t1.fincategory,
			    t1.fintypedesc,
			    t1.finccy,
			    t1.findayscaltype,
			    t1.finactype,
			    t1.fincontingentactype,
			    t1.finisgenref,
			    t1.finmaxamount,
			    t1.finminamount,
			    t1.finisopennewfinac,
			    t1.finisalwmd,
			    t1.finschdmthd,
			    t1.finisalwgrace,
			    t1.equalrepayment,
			    t1.finratetype,
			    t1.finbaserate,
			    t1.finsplrate,
			    t1.finintrate,
			    t1.finminrate,
			    t1.finmaxrate,
			    t1.findftintfrq,
			    t1.finisintcpz,
			    t1.fincpzfrq,
			    t1.finisrvwalw,
			    t1.finrvwfrq,
			    t1.fingrcratetype,
			    t1.fingrcbaserate,
			    t1.fingrcsplrate,
			    t1.fingrcintrate,
			    t1.fingrcminrate,
			    t1.fingrcmaxrate,
			    t1.fingrcdftintfrq,
			    t1.fingrcisintcpz,
			    t1.fingrccpzfrq,
			    t1.fingrcisrvwalw,
			    t1.fingrcrvwfrq,
			    t1.finminterm,
			    t1.finmaxterm,
			    t1.findftterms,
			    t1.finrpyfrq,
			    t1.finrepaymethod,
			    t1.finisalwdifferment,
			    t1.finmaxdifferment,
			    t1.finisactive,
			    t1.stepfinance,
			    t1.steppingmandatory,
			    t1.alwmanualsteps,
			    t1.alwdsteppolicies,
			    t1.dftsteppolicy,
			    t1.finisdwpayrequired,
			    t1.finrvwrateapplfor,
			    t1.finalwratechangeanydate,
			    t1.finisintcpzatgrcend,
			    t1.finschcalcodeonrvw,
			    t1.alwplandeferment,
			    t1.plandefercount,
			    t1.pftpayactype,
			    t1.finisopenpftpayacc,
			    t1.finisalwgrcrepay,
			    t1.fingrcschdmthd,
			    t1.fingrcmargin,
			    t1.finmargin,
			    t1.fincommitmentreq,
			    t1.fincollateralreq,
			    t1.findepreciationreq,
			    t1.findepreciationfrq,
			    t1.finbankcontingentactype,
			    t1.finprovisionactype,
			    t1.allowriainvestment,
			    t1.overridelimit,
			    t1.limitrequired,
			    t1.fincommitmentovrride,
			    t1.fincollateralovrride,
			    t1.finrepaypftonfrq,
			    t1.finpftunchanged,
			    t1.applyodpenalty,
			    t1.odincgrcdays,
			    t1.odchargetype,
			    t1.odgracedays,
			    t1.odchargecalon,
			    t1.odchargeamtorperc,
			    t1.odallowwaiver,
			    t1.odmaxwaiverperc,
			    t1.findivision,
			    t3.divisioncodedesc AS lovdescfindivisionname,
			    t1.finsuspactype,
			    t1.product,
			    t1.startdate,
			    t1.enddate,
			    t1.allowdownpaypgm,
			    t1.fintypedesc AS lovdescpromofintypedesc,
			    t1.remarks,
			    t4.policydesc AS lovdescdftsteppolicyname,
			    t1.pastduepftcalmthd,
			    t1.pastduepftmargin,
			    t1.alwadvancerent,
			    t1.grcadvbaserate,
			    t1.grcadvmargin,
			    t1.grcadvpftrate,
			    t1.rpyadvbaserate,
			    t1.rpyadvmargin,
			    t1.rpyadvpftrate,
			    t1.rolloverfinance,
			    t1.rolloverfrq,
			    t1.downpayrule,
			    t1.alwmultipartydisb,
			    t1.collateraltype,
			    t1.tdsapplicable,
			    t5.rulecode AS downpayrulecode,
			    t5.rulecodedesc AS downpayruledesc,
			    t1.applygrcpricing,
			    t1.applyrpypricing,
			    t6.rulecode AS grcpricingmethoddesc,
			    t7.rulecode AS rpypricingmethoddesc,
			    t1.droplineod,
			    t1.droppingmethod,
			    t1.ratechganyday,
			    t4.steptype AS dftsteppolicytype,
			    t1.manualschedule,
			    t1.alwbpi,
			    t1.bpitreatment,
			    t1.pftdueschon,
			    t1.planemihalw,
			    t1.planemihmethod,
			    t1.planemihmaxperyear,
			    t1.planemihmax,
			    t1.planemihlockperiod,
			    t1.planemicpz,
			    t1.unplanemihlockperiod,
			    t1.unplanemicpz,
			    t1.reagecpz,
			    t1.fddlockperiod,
			    t1.alwdrpymethods,
			    t1.maxunplannedemi,
			    t1.maxreageholidays,
			    t1.roundingmode,
			    t1.roundingtarget,
			    t1.frequencydays,
			    t1.quickdisb,
			    t1.alwreage,
			    t1.alwunplanemiholiday,
			    t1.alwmaxdisbcheckreq,
			    t1.productcategory,
			    t1.rpyhierarchy,
			    t1.developerfinance,
			    t3.entitycode AS lovdescentitycode,
			    t8.entitydesc AS lovdescentitydesc,
			    t1.costoffunds,
			    t1.chequecapturereq,
			    t1.finltvcheck,
			    t1.partiallysecured,
			    t1.alwadvemi,
			    t1.advemiminterms,
			    t1.advemimaxterms,
			    t1.advemidftterms,
			    t1.advemischdmthd,
			    t1.bpipftdaysbasis,
			    t1.eligibilitymethods,
			    t1.alwhybridrate,
			    t1.fixedratetenor,
			    t1.odmincapamount,
			    t1.odrulecode,
			    t1.alwzerointacc,
			    t1.finisalwpartialrpy,
			    t1.autorejectiondays,
			    t1.taxnomand,
			    t1.putcallrequired,
			    t1.grcadvintersetreq,
			    t1.grcadvtype,
			    t1.grcadvminterms,
			    t1.grcadvmaxterms,
			    t1.grcadvdefaultterms,
			    t1.advintersetreq,
			    t1.advtype,
			    t1.advminterms,
			    t1.advmaxterms,
			    t1.advdefaultterms,
			    t1.advstage,
			    t1.dsfreq,
			    t1.cashcollateralreq,
			    t1.alwearlypaymethods,
			    t1.tdsallowtomodify,
			    t1.tdsapplicableto,
			    t1.alwvan,
			    t1.vanallocationmethod,
			    t1.allowdrawingpower,
			    t1.allowrevolving,
			    t1.alwsanctionamt,
			    t1.alwsanctionamtoverride,
			    t1.sanbsdschdle,
			    t1.finisratervwatgrcend,
			    t1.schdonpmtcal,
			    t1.autoapprove,
			    t1.alwplannedemiingrc
			    FROM rmtfinancetypes t1
			    JOIN smtdivisiondetail t3 ON t1.findivision = t3.divisioncode
			    LEFT JOIN steppolicyheader t4 ON t1.dftsteppolicy = t4.policycode
			    LEFT JOIN rules t5 ON t1.downpayrule = t5.ruleid
			    LEFT JOIN rules t6 ON t1.grcpricingmethod = t6.ruleid
			    LEFT JOIN rules t7 ON t1.rpypricingmethod = t7.ruleid
			    LEFT JOIN entity t8 ON t3.entitycode = t8.entitycode
			]]>
		</createView>
	</changeSet>

	<changeSet id="06_post" author="shekar.b" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'rmtfinancetypes_orgview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="08" author="Thirupathi.m">
		<addColumn tableName="FinanceMain_temp">
			<column name="planEMIHAlwInGrace" type="boolean" />
		</addColumn>
	</changeSet>

	<changeSet id="09" author="Thirupathi.m">
		<addColumn tableName="FinanceMain">
			<column name="planEMIHAlwInGrace" type="boolean" />
		</addColumn>
	</changeSet>

	<changeSet id="10" author="Thirupathi.m">
		<sql>
			<![CDATA[
				Update FinanceMain set planEMIHAlwInGrace = 0;
				Update FinanceMain_temp set planEMIHAlwInGrace = 0;
			]]>
		</sql>
	</changeSet>

	<changeSet id="10.0" author="Thirupathi.m">
		<addNotNullConstraint tableName="FinanceMain" columnName="planEMIHAlwInGrace" columnDataType="boolean" />
		<addNotNullConstraint tableName="FinanceMain_temp" columnName="planEMIHAlwInGrace"
			columnDataType="boolean" />
	</changeSet>


	<changeSet id="10.1" author="Thirupathi.m" dbms="postgresql, oracle">
		<addDefaultValue columnName="planEMIHAlwInGrace" tableName="FinanceMain" defaultValue="0" />
		<addDefaultValue columnName="planEMIHAlwInGrace" tableName="FinanceMain_temp" defaultValue="0" />
	</changeSet>

	<changeSet id="10.2" author="Thirupathi.m" dbms="mssql">
		<sql>
			<![CDATA[
				ALTER TABLE FinanceMain ADD CONSTRAINT DF_FinanceMain_plnEMIHAlwInGrc DEFAULT 0 FOR planEMIHAlwInGrace;
				ALTER TABLE FinanceMain_temp ADD CONSTRAINT DF_FinnceMin_t_plnEMIHAlwInGrc DEFAULT 0 FOR planEMIHAlwInGrace;
			]]>
		</sql>
	</changeSet>

	<changeSet id="11_pre" author="Thirupathi.m" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'financemain_tview');
		 	]]>
		</sql>
	</changeSet>

	<changeSet id="11" author="Thirupathi.m">
		<createView viewName="financemain_tview" replaceIfExists="true">
		   <![CDATA[
				  SELECT t1.finreference,
					t1.investmentref,
					t1.numberofterms,
					t1.grcperiodenddate,
					t1.allowgrcperiod,
					t1.gracebaserate,
					t1.gracespecialrate,
					t1.grcpftrate,
					t1.grcpftfrq,
					t1.nextgrcpftdate,
					t1.allowgrcpftrvw,
					t1.grcpftrvwfrq,
					t1.nextgrcpftrvwdate,
					t1.allowgrccpz,
					t1.grccpzfrq,
					t1.nextgrccpzdate,
					t1.repaybaserate,
					t1.repayspecialrate,
					t1.repayprofitrate,
					t1.repayfrq,
					t1.nextrepaydate,
					t1.repaypftfrq,
					t1.nextrepaypftdate,
					t1.allowrepayrvw,
					t1.repayrvwfrq,
					t1.nextrepayrvwdate,
					t1.allowrepaycpz,
					t1.repaycpzfrq,
					t1.nextrepaycpzdate,
					t1.maturitydate,
					t1.cpzatgraceend,
					t1.downpayment,
					t1.graceflatamount,
					t1.reqrepayamount,
					t1.totalprofit,
					t1.totalcpz,
					t1.totalgrosspft,
					t1.totalgrossgrcpft,
					t1.totalgracepft,
					t1.totalgracecpz,
					t1.grcratebasis,
					t1.repayratebasis,
					t1.fintype,
					t1.finremarks,
					t1.finccy,
					t1.schedulemethod,
					t1.profitdaysbasis,
					t1.reqmaturity,
					t1.calterms,
					t1.calmaturity,
					t1.firstrepay,
					t1.lastrepay,
					t1.finstartdate,
					t1.finamount,
					t1.finamount + t1.feechargeamt - t1.downpayment AS lovdescfinancingamount,
					t1.finrepaymentamount,
					t1.custid,
					t1.defferments,
					t1.plandefercount,
					t1.finbranch,
					t1.finsourceid,
					t1.alloweddefrpychange,
					t1.availeddefrpychange,
					t1.alloweddeffrqchange,
					t1.availeddeffrqchange,
					t1.recaltype,
					t1.finassetvalue,
					t1.disbaccountid,
					t1.repayaccountid,
					t1.finisactive,
					t1.limitvalid,
					t1.overridelimit,
					t1.securitydeposit,
					t1.version,
					t1.lastmntby,
					t1.lastmnton,
					t1.recordstatus,
					t1.rolecode,
					t1.nextrolecode,
					t1.taskid,
					t1.nexttaskid,
					t1.recordtype,
					t1.workflowid,
					t7.fintypedesc AS lovdescfintypename,
					t7.finmaxamount AS lovdescfinmaxamt,
					t7.finminamount AS lovdescfinminamount,
					t1.mindownpayperc,
					t7.finisalwdifferment AS lovdescfinalwdeferment,
					t7.finisdwpayrequired AS lovdescdwnpayreq,
					t7.finmaxdifferment AS lovdescfinmaxdifferment,
					t12.branchdesc AS lovdescfinbranchname,
					t12.branchprovince AS finbranchprovincecode,
					t1.lastrepaydate,
					t1.lastrepaypftdate,
					t1.lastrepayrvwdate,
					t1.lastrepaycpzdate,
					t1.allowgrcrepay,
					t1.grcschdmthd,
					t1.grcmargin,
					t1.repaymargin,
					t1.fincurrassetvalue,
					t1.fincommitmentref,
					t1.finlimitref,
					t1.depreciationfrq,
					t1.fincontractdate,
					t1.nextdepdate,
					t1.lastdepdate,
					t1.finaccount,
					t1.fincustpftaccount,
					t17.acrtilllbd AS lovdescaccruedtilllbd,
					t7.finrvwrateapplfor,
					t1.totalrepayamt,
					t1.closingstatus,
					t1.finapproveddate,
					t1.feechargeamt,
					t1.blacklisted,
					t1.finrepaypftonfrq,
					t1.anualizedpercrate,
					t1.effectiverateofreturn,
					t1.migratedfinance,
					t1.schedulemaintained,
					t1.scheduleregenerated,
					t1.finpurpose,
					t39.loanpurposedesc AS lovdescfinpurposename,
					t1.finstatus,
					t1.finstsreason,
					t1.initiateuser,
					t1.bankname,
					t1.iban,
					t1.accounttype,
					t1.ddareferenceno,
					t7.finscheduleon AS lovdescfinscheduleon,
					t1.custdsr,
					t1.jointaccount,
					t1.jointcustid,
					t1.downpaybank,
					t1.downpaysupl,
					t1.downpayaccount,
					t1.securitycollateral,
					t1.approved,
					t1.discrepancy,
					t1.limitapproved,
					t1.graceterms,
					t7.findivision AS lovdescfindivision,
					t1.rcdmaintainsts,
					t1.finrepaymethod,
					t1.grcprofitdaysbasis,
					t1.stepfinance,
					t1.steptype,
					t1.steppolicy,
					t1.alwmanualsteps,
					t1.noofsteps,
					t1.linkedfinref,
					t1.nextuserid,
					t1.priority,
					t24.policydesc AS lovdescsteppolicyname,
					t1.grcminrate,
					t1.grcmaxrate,
					t1.rpyminrate,
					t1.rpymaxrate,
					t1.deviationapproval,
					t1.manualschedule,
					t1.takeoverfinance,
					t1.grcadvbaserate,
					t1.grcadvmargin,
					t1.grcadvpftrate,
					t1.rpyadvbaserate,
					t1.rpyadvmargin,
					t1.rpyadvpftrate,
					t1.supplementrent,
					t1.increasedcost,
					t1.creditinsamt,
					t1.rolloverfrq,
					t1.nextrolloverdate,
					t27.custstsdescription,
					t1.shariastatus,
					t1.initiatedate,
					t1.finpreapprovedref,
					t1.mmaid,
					t1.accountsofficer,
					t1.feeaccountid,
					t1.fincancelac,
					t28.dealername AS lovdescaccountsofficer,
					t28.dealercity AS lovdescsourcecity,
					t1.dsacode,
					t30.rofficerdesc AS dsacodedesc,
					t1.tdsapplicable,
					t1.mandateid,
					t1.droplinefrq,
					t1.firstdroplinedate,
					t1.pftservicingodlimit,
					t1.insuranceamt,
					t1.deductinsdisb,
					t1.alwbpi,
					t1.bpitreatment,
					t1.planemihalw,
					t1.planemihmethod,
					t1.planemihmaxperyear,
					t1.planemihmax,
					t1.planemihlockperiod,
					t1.planemicpz,
					t1.calroundingmode,
					t1.alwmultidisb,
					t1.applicationno,
					t1.referralid,
					t33.rofficerdesc AS referraliddesc,
					t1.dmacode,
					t34.rofficerdesc AS dmacodedesc,
					t1.salesdepartment,
					t35.deptdesc AS salesdepartmentdesc,
					t1.quickdisb,
					t1.wifreference,
					t1.unplanemihlockperiod,
					t1.unplanemicpz,
					t1.reagecpz,
					t1.maxunplannedemi,
					t1.maxreageholidays,
					t1.availedunplanemi,
					t1.availedreageh,
					t1.bpiamount,
					t1.deductfeedisb,
					t1.rvwrateapplfor,
					t1.schcalonrvw,
					t1.pastduepftcalmthd,
					t1.pastduepftmargin,
					t1.droppingmethod,
					t1.ratechganyday,
					t1.promotioncode,
					t1.restructureloan,
					t1.oldfinreference,
					t1.reagebucket,
					t1.fincategory,
					t1.productcategory,
					t1.roundingtarget,
					t36.entitycode AS lovdescentitycode,
					t1.eligibilitymethod,
					t38.fieldcodevalue AS loveligibilitymethod,
					t38.valuedesc AS lovdesceligibilitymethod,
					t1.employeename,
					t37.rofficerdesc AS employeenamedesc,
					t1.samplingrequired,
					t1.legalrequired,
					t1.grcmaxamount,
					t1.connector,
					t40.dealername AS connectorcode,
					t40.dealercity AS connectordesc,
					t1.advanceemi,
					t1.advemiterms,
					t1.bpipftdaysbasis,
					t1.fixedratetenor,
					t1.fixedtenorrate,
					t12.branchtel AS finbranchcontact,
					t1.processattributes,
					t1.businessvertical,
					bv.code AS businessverticalcode,
					bv.description AS businessverticaldesc,
					t1.grcadvtype,
					t1.grcadvterms,
					t1.advtype,
					t1.advterms,
					t1.advstage,
					t1.tdspercentage,
					t1.tdsstartdate,
					t1.tdsenddate,
					t1.tdslimitamt,
					t1.vanreq,
					t1.vancode,
					t1.allowdrawingpower,
					t1.allowrevolving,
					t1.sanbsdschdle,
					t1.promotionseqid,
					t1.svamount,
					t1.cbamount,
					t1.appliedloanamt,
					t1.finisratervwatgrcend,
					t1.planEMIHAlwInGrace
				   FROM financemain_temp t1
					 JOIN rmtfinancetypes t7 ON t1.fintype  = t7.fintype 
					 LEFT JOIN rmtbranches t12 ON t1.finbranch  = t12.branchcode 
					 LEFT JOIN finpftdetails t17 ON t17.finreference  = t1.finreference 
					 LEFT JOIN steppolicyheader t24 ON t1.steppolicy  = t24.policycode 
					 LEFT JOIN bmtcuststatuscodes t27 ON t1.finstatus  = t27.custstscode 
					 LEFT JOIN amtvehicledealer t28 ON t1.accountsofficer = t28.dealerid
					 LEFT JOIN relationshipofficers t30 ON t1.dsacode  = t30.rofficercode 
					 LEFT JOIN relationshipofficers t33 ON t1.referralid  = t33.rofficercode 
					 LEFT JOIN relationshipofficers t34 ON t1.dmacode  = t34.rofficercode 
					 LEFT JOIN bmtdepartments t35 ON t1.salesdepartment  = t35.deptcode 
					 LEFT JOIN smtdivisiondetail t36 ON t7.findivision  = t36.divisioncode 
					 LEFT JOIN relationshipofficers t37 ON t1.employeename  = t37.rofficercode 
					 LEFT JOIN rmtlovfielddetail t38 ON t1.eligibilitymethod = t38.fieldcodeid AND t38.fieldcode  = 'ELGMETHOD' 
					 LEFT JOIN loanpurposes t39 ON t1.finpurpose  = t39.loanpurposecode 
					 LEFT JOIN amtvehicledealer t40 ON t1.connector = t40.dealerid
					 LEFT JOIN business_vertical bv ON bv.id = t1.businessvertical
			]]>
		</createView>
	</changeSet>

	<changeSet id="11_post" author="Thirupathi.m" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'financemain_tview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="12_pre" author="Thirupathi.m" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'financemain_aview');
		 	]]>
		</sql>
	</changeSet>

	<changeSet id="12" author="Thirupathi.m">
		<createView viewName="financemain_aview" replaceIfExists="true">
		 <![CDATA[ 
			  SELECT t1.finreference,
			    t1.investmentref,
			    t1.numberofterms,
			    t1.grcperiodenddate,
			    t1.allowgrcperiod,
			    t1.gracebaserate,
			    t1.gracespecialrate,
			    t1.grcpftrate,
			    t1.grcpftfrq,
			    t1.nextgrcpftdate,
			    t1.allowgrcpftrvw,
			    t1.grcpftrvwfrq,
			    t1.nextgrcpftrvwdate,
			    t1.allowgrccpz,
			    t1.grccpzfrq,
			    t1.nextgrccpzdate,
			    t1.repaybaserate,
			    t1.repayspecialrate,
			    t1.repayprofitrate,
			    t1.repayfrq,
			    t1.nextrepaydate,
			    t1.repaypftfrq,
			    t1.nextrepaypftdate,
			    t1.allowrepayrvw,
			    t1.repayrvwfrq,
			    t1.nextrepayrvwdate,
			    t1.allowrepaycpz,
			    t1.repaycpzfrq,
			    t1.nextrepaycpzdate,
			    t1.maturitydate,
			    t1.cpzatgraceend,
			    t1.downpayment,
			    t1.graceflatamount,
			    t1.reqrepayamount,
			    t1.totalprofit,
			    t1.totalcpz,
			    t1.totalgrosspft,
			    t1.totalgrossgrcpft,
			    t1.totalgracepft,
			    t1.totalgracecpz,
			    t1.grcratebasis,
			    t1.repayratebasis,
			    t1.fintype,
			    t1.finremarks,
			    t1.finccy,
			    t1.schedulemethod,
			    t1.profitdaysbasis,
			    t1.reqmaturity,
			    t1.calterms,
			    t1.calmaturity,
			    t1.firstrepay,
			    t1.lastrepay,
			    t1.finstartdate,
			    t1.finamount,
			    t1.finamount + t1.feechargeamt - t1.downpayment AS lovdescfinancingamount,
			    t1.finrepaymentamount,
			    t1.custid,
			    t1.defferments,
			    t1.plandefercount,
			    t1.finbranch,
			    t1.finsourceid,
			    t1.alloweddefrpychange,
			    t1.availeddefrpychange,
			    t1.alloweddeffrqchange,
			    t1.availeddeffrqchange,
			    t1.recaltype,
			    t1.finassetvalue,
			    t1.disbaccountid,
			    t1.repayaccountid,
			    t1.finisactive,
			    t1.limitvalid,
			    t1.overridelimit,
			    t1.securitydeposit,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t7.fintypedesc AS lovdescfintypename,
			    t7.finmaxamount AS lovdescfinmaxamt,
			    t7.finminamount AS lovdescfinminamount,
			    t1.mindownpayperc,
			    t7.finisalwdifferment AS lovdescfinalwdeferment,
			    t7.finisdwpayrequired AS lovdescdwnpayreq,
			    t7.finmaxdifferment AS lovdescfinmaxdifferment,
			    t12.branchdesc AS lovdescfinbranchname,
			    t12.branchprovince AS finbranchprovincecode,
			    t1.lastrepaydate,
			    t1.lastrepaypftdate,
			    t1.lastrepayrvwdate,
			    t1.lastrepaycpzdate,
			    t1.allowgrcrepay,
			    t1.grcschdmthd,
			    t1.grcmargin,
			    t1.repaymargin,
			    t1.fincurrassetvalue,
			    t1.fincommitmentref,
			    t1.finlimitref,
			    t1.depreciationfrq,
			    t1.fincontractdate,
			    t1.nextdepdate,
			    t1.lastdepdate,
			    t1.finaccount,
			    t1.fincustpftaccount,
			    t17.acrtilllbd AS lovdescaccruedtilllbd,
			    t7.finrvwrateapplfor,
			    t1.totalrepayamt,
			    t1.closingstatus,
			    t1.finapproveddate,
			    t1.feechargeamt,
			    t1.blacklisted,
			    t1.finrepaypftonfrq,
			    t1.anualizedpercrate,
			    t1.effectiverateofreturn,
			    t1.migratedfinance,
			    t1.schedulemaintained,
			    t1.scheduleregenerated,
			    t1.finpurpose,
			    t39.loanpurposedesc AS lovdescfinpurposename,
			    t1.finstatus,
			    t1.finstsreason,
			    t1.initiateuser,
			    t1.bankname,
			    t1.iban,
			    t1.accounttype,
			    t1.ddareferenceno,
			    t7.finscheduleon AS lovdescfinscheduleon,
			    t1.custdsr,
			    t1.jointaccount,
			    t1.jointcustid,
			    t1.downpaybank,
			    t1.downpaysupl,
			    t1.downpayaccount,
			    t1.securitycollateral,
			    t1.approved,
			    t1.discrepancy,
			    t1.limitapproved,
			    t1.graceterms,
			    t7.findivision AS lovdescfindivision,
			    t1.rcdmaintainsts,
			    t1.finrepaymethod,
			    t1.grcprofitdaysbasis,
			    t1.stepfinance,
			    t1.steptype,
			    t1.steppolicy,
			    t1.alwmanualsteps,
			    t1.noofsteps,
			    t1.linkedfinref,
			    t1.nextuserid,
			    t1.priority,
			    t24.policydesc AS lovdescsteppolicyname,
			    t1.grcminrate,
			    t1.grcmaxrate,
			    t1.rpyminrate,
			    t1.rpymaxrate,
			    t1.deviationapproval,
			    t1.manualschedule,
			    t1.takeoverfinance,
			    t1.grcadvbaserate,
			    t1.grcadvmargin,
			    t1.grcadvpftrate,
			    t1.rpyadvbaserate,
			    t1.rpyadvmargin,
			    t1.rpyadvpftrate,
			    t1.supplementrent,
			    t1.increasedcost,
			    t1.creditinsamt,
			    t1.rolloverfrq,
			    t1.nextrolloverdate,
			    t27.custstsdescription,
			    t1.shariastatus,
			    t1.initiatedate,
			    t1.finpreapprovedref,
			    t1.mmaid,
			    t1.accountsofficer,
			    t1.feeaccountid,
			    t1.fincancelac,
			    t28.dealername AS lovdescaccountsofficer,
			    t28.dealercity AS lovdescsourcecity,
			    t1.dsacode,
			    t30.rofficerdesc AS dsacodedesc,
			    t1.tdsapplicable,
			    t1.mandateid,
			    t1.droplinefrq,
			    t1.firstdroplinedate,
			    t1.pftservicingodlimit,
			    t1.insuranceamt,
			    t1.deductinsdisb,
			    t1.alwbpi,
			    t1.bpitreatment,
			    t1.planemihalw,
			    t1.planemihmethod,
			    t1.planemihmaxperyear,
			    t1.planemihmax,
			    t1.planemihlockperiod,
			    t1.planemicpz,
			    t1.calroundingmode,
			    t1.alwmultidisb,
			    t1.applicationno,
			    t1.referralid,
			    t33.rofficerdesc AS referraliddesc,
			    t1.dmacode,
			    t34.rofficerdesc AS dmacodedesc,
			    t1.salesdepartment,
			    t35.deptdesc AS salesdepartmentdesc,
			    t1.quickdisb,
			    t1.wifreference,
			    t1.unplanemihlockperiod,
			    t1.unplanemicpz,
			    t1.reagecpz,
			    t1.maxunplannedemi,
			    t1.maxreageholidays,
			    t1.availedunplanemi,
			    t1.availedreageh,
			    t1.bpiamount,
			    t1.deductfeedisb,
			    t1.rvwrateapplfor,
			    t1.schcalonrvw,
			    t1.pastduepftcalmthd,
			    t1.pastduepftmargin,
			    t1.droppingmethod,
			    t1.ratechganyday,
			    t1.promotioncode,
			    t1.restructureloan,
			    t1.oldfinreference,
			    t1.reagebucket,
			    t1.fincategory,
			    t1.productcategory,
			    t1.roundingtarget,
			    t36.entitycode AS lovdescentitycode,
			    t1.eligibilitymethod,
			    t38.fieldcodevalue AS loveligibilitymethod,
			    t38.valuedesc AS lovdesceligibilitymethod,
			    t1.employeename,
			    t37.rofficerdesc AS employeenamedesc,
			    t1.samplingrequired,
			    t1.legalrequired,
			    t1.grcmaxamount,
			    t1.connector,
			    t40.dealername AS connectorcode,
			    t40.dealercity AS connectordesc,
			    t1.advanceemi,
			    t1.advemiterms,
			    t1.bpipftdaysbasis,
			    t1.fixedratetenor,
			    t1.fixedtenorrate,
			    t12.branchtel AS finbranchcontact,
			    t1.processattributes,
			    t1.businessvertical,
			    bv.code AS businessverticalcode,
			    bv.description AS businessverticaldesc,
			    t1.grcadvtype,
			    t1.grcadvterms,
			    t1.advtype,
			    t1.advterms,
			    t1.advstage,
			    t1.tdspercentage,
			    t1.tdsstartdate,
			    t1.tdsenddate,
			    t1.tdslimitamt,
			    t1.vanreq,
			    t1.vancode,
			    t1.allowdrawingpower,
			    t1.allowrevolving,
			    t1.sanbsdschdle,
			    t1.promotionseqid,
			    t1.svamount,
			    t1.cbamount,
			    t1.appliedloanamt,
			    t1.finisratervwatgrcend,
				t1.planEMIHAlwInGrace
			   FROM financemain t1
			     JOIN rmtfinancetypes t7 ON t1.fintype = t7.fintype 
			     LEFT JOIN rmtbranches t12 ON t1.finbranch  = t12.branchcode 
			     LEFT JOIN finpftdetails t17 ON t17.finreference  = t1.finreference 
			     LEFT JOIN steppolicyheader t24 ON t1.steppolicy  = t24.policycode 
			     LEFT JOIN bmtcuststatuscodes t27 ON t1.finstatus  = t27.custstscode 
			     LEFT JOIN amtvehicledealer t28 ON t1.accountsofficer = t28.dealerid
			     LEFT JOIN relationshipofficers t30 ON t1.dsacode  = t30.rofficercode 
			     LEFT JOIN relationshipofficers t33 ON t1.referralid  = t33.rofficercode 
			     LEFT JOIN relationshipofficers t34 ON t1.dmacode  = t34.rofficercode 
			     LEFT JOIN bmtdepartments t35 ON t1.salesdepartment  = t35.deptcode 
			     LEFT JOIN smtdivisiondetail t36 ON t7.findivision  = t36.divisioncode 
			     LEFT JOIN relationshipofficers t37 ON t1.employeename  = t37.rofficercode 
			     LEFT JOIN rmtlovfielddetail t38 ON t1.eligibilitymethod = t38.fieldcodeid AND t38.fieldcode  = 'ELGMETHOD' 
			     LEFT JOIN loanpurposes t39 ON t1.finpurpose  = t39.loanpurposecode 
			     LEFT JOIN amtvehicledealer t40 ON t1.connector = t40.dealerid
			     LEFT JOIN business_vertical bv ON bv.id = t1.businessvertical
			 ]]>
		</createView>
	</changeSet>

	<changeSet id="12_post" author="Thirupathi.m" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'financemain_aview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="13_pre" author="thirupathi" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'financemain_view');
			]]>
		</sql>
	</changeSet>

	<changeSet id="13" author="Thirupathi.m">
		<createView viewName="financemain_view" replaceIfExists="true">
			<![CDATA[
					SELECT t1.finreference,
				    t1.investmentref,
				    t1.numberofterms,
				    t1.grcperiodenddate,
				    t1.allowgrcperiod,
				    t1.gracebaserate,
				    t1.gracespecialrate,
				    t1.grcpftrate,
				    t1.grcpftfrq,
				    t1.nextgrcpftdate,
				    t1.allowgrcpftrvw,
				    t1.grcpftrvwfrq,
				    t1.nextgrcpftrvwdate,
				    t1.allowgrccpz,
				    t1.grccpzfrq,
				    t1.nextgrccpzdate,
				    t1.repaybaserate,
				    t1.repayspecialrate,
				    t1.repayprofitrate,
				    t1.repayfrq,
				    t1.nextrepaydate,
				    t1.repaypftfrq,
				    t1.nextrepaypftdate,
				    t1.allowrepayrvw,
				    t1.repayrvwfrq,
				    t1.nextrepayrvwdate,
				    t1.allowrepaycpz,
				    t1.repaycpzfrq,
				    t1.nextrepaycpzdate,
				    t1.maturitydate,
				    t1.cpzatgraceend,
				    t1.downpayment,
				    t1.graceflatamount,
				    t1.reqrepayamount,
				    t1.totalprofit,
				    t1.totalcpz,
				    t1.totalgrosspft,
				    t1.totalgrossgrcpft,
				    t1.totalgracepft,
				    t1.totalgracecpz,
				    t1.grcratebasis,
				    t1.repayratebasis,
				    t1.fintype,
				    t1.finremarks,
				    t1.finccy,
				    t1.schedulemethod,
				    t1.profitdaysbasis,
				    t1.reqmaturity,
				    t1.calterms,
				    t1.calmaturity,
				    t1.firstrepay,
				    t1.lastrepay,
				    t1.finstartdate,
				    t1.finamount,
				    t1.finamount + t1.feechargeamt - t1.downpayment AS lovdescfinancingamount,
				    t1.finrepaymentamount,
				    t1.custid,
				    t1.defferments,
				    t1.plandefercount,
				    t1.finbranch,
				    t1.finsourceid,
				    t1.alloweddefrpychange,
				    t1.availeddefrpychange,
				    t1.alloweddeffrqchange,
				    t1.availeddeffrqchange,
				    t1.recaltype,
				    t1.finassetvalue,
				    t1.disbaccountid,
				    t1.repayaccountid,
				    t1.finisactive,
				    t1.limitvalid,
				    t1.overridelimit,
				    t1.securitydeposit,
				    t1.version,
				    t1.lastmntby,
				    t1.lastmnton,
				    t1.recordstatus,
				    t1.rolecode,
				    t1.nextrolecode,
				    t1.taskid,
				    t1.nexttaskid,
				    t1.recordtype,
				    t1.workflowid,
				    t7.fintypedesc AS lovdescfintypename,
				    t7.finmaxamount AS lovdescfinmaxamt,
				    t7.finminamount AS lovdescfinminamount,
				    t1.mindownpayperc,
				    t7.finisalwdifferment AS lovdescfinalwdeferment,
				    t7.finisdwpayrequired AS lovdescdwnpayreq,
				    t7.finmaxdifferment AS lovdescfinmaxdifferment,
				    t12.branchdesc AS lovdescfinbranchname,
				    t12.branchprovince AS finbranchprovincecode,
				    t1.lastrepaydate,
				    t1.lastrepaypftdate,
				    t1.lastrepayrvwdate,
				    t1.lastrepaycpzdate,
				    t1.allowgrcrepay,
				    t1.grcschdmthd,
				    t1.grcmargin,
				    t1.repaymargin,
				    t1.fincurrassetvalue,
				    t1.fincommitmentref,
				    t1.finlimitref,
				    t1.depreciationfrq,
				    t1.fincontractdate,
				    t1.nextdepdate,
				    t1.lastdepdate,
				    t1.finaccount,
				    t1.fincustpftaccount,
				    t17.acrtilllbd AS lovdescaccruedtilllbd,
				    t7.finrvwrateapplfor,
				    t1.totalrepayamt,
				    t1.closingstatus,
				    t1.finapproveddate,
				    t1.feechargeamt,
				    t1.blacklisted,
				    t1.finrepaypftonfrq,
				    t1.anualizedpercrate,
				    t1.effectiverateofreturn,
				    t1.migratedfinance,
				    t1.schedulemaintained,
				    t1.scheduleregenerated,
				    t1.finpurpose,
				    t39.loanpurposedesc AS lovdescfinpurposename,
				    t1.finstatus,
				    t1.finstsreason,
				    t1.initiateuser,
				    t1.bankname,
				    t1.iban,
				    t1.accounttype,
				    t1.ddareferenceno,
				    t7.finscheduleon AS lovdescfinscheduleon,
				    t1.custdsr,
				    t1.jointaccount,
				    t1.jointcustid,
				    t1.downpaybank,
				    t1.downpaysupl,
				    t1.downpayaccount,
				    t1.securitycollateral,
				    t1.approved,
				    t1.discrepancy,
				    t1.limitapproved,
				    t1.graceterms,
				    t7.findivision AS lovdescfindivision,
				    t1.rcdmaintainsts,
				    t1.finrepaymethod,
				    t1.grcprofitdaysbasis,
				    t1.stepfinance,
				    t1.steptype,
				    t1.steppolicy,
				    t1.alwmanualsteps,
				    t1.noofsteps,
				    t1.linkedfinref,
				    t1.nextuserid,
				    t1.priority,
				    t24.policydesc AS lovdescsteppolicyname,
				    t1.grcminrate,
				    t1.grcmaxrate,
				    t1.rpyminrate,
				    t1.rpymaxrate,
				    t1.deviationapproval,
				    t1.manualschedule,
				    t1.takeoverfinance,
				    t1.grcadvbaserate,
				    t1.grcadvmargin,
				    t1.grcadvpftrate,
				    t1.rpyadvbaserate,
				    t1.rpyadvmargin,
				    t1.rpyadvpftrate,
				    t1.supplementrent,
				    t1.increasedcost,
				    t1.creditinsamt,
				    t1.rolloverfrq,
				    t1.nextrolloverdate,
				    t27.custstsdescription,
				    t1.shariastatus,
				    t1.initiatedate,
				    t1.finpreapprovedref,
				    t1.mmaid,
				    t1.accountsofficer,
				    t1.feeaccountid,
				    t1.fincancelac,
				    t28.dealername AS lovdescaccountsofficer,
				    t28.dealercity AS lovdescsourcecity,
				    t1.dsacode,
				    t30.rofficerdesc AS dsacodedesc,
				    t1.tdsapplicable,
				    t1.mandateid,
				    t1.droplinefrq,
				    t1.firstdroplinedate,
				    t1.pftservicingodlimit,
				    t1.insuranceamt,
				    t1.deductinsdisb,
				    t1.alwbpi,
				    t1.bpitreatment,
				    t1.planemihalw,
				    t1.planemihmethod,
				    t1.planemihmaxperyear,
				    t1.planemihmax,
				    t1.planemihlockperiod,
				    t1.planemicpz,
				    t1.calroundingmode,
				    t1.alwmultidisb,
				    t1.applicationno,
				    t1.referralid,
				    t33.rofficerdesc AS referraliddesc,
				    t1.dmacode,
				    t34.rofficerdesc AS dmacodedesc,
				    t1.salesdepartment,
				    t35.deptdesc AS salesdepartmentdesc,
				    t1.quickdisb,
				    t1.wifreference,
				    t1.unplanemihlockperiod,
				    t1.unplanemicpz,
				    t1.reagecpz,
				    t1.maxunplannedemi,
				    t1.maxreageholidays,
				    t1.availedunplanemi,
				    t1.availedreageh,
				    t1.bpiamount,
				    t1.deductfeedisb,
				    t1.rvwrateapplfor,
				    t1.schcalonrvw,
				    t1.pastduepftcalmthd,
				    t1.pastduepftmargin,
				    t1.droppingmethod,
				    t1.ratechganyday,
				    t1.promotioncode,
				    t1.restructureloan,
				    t1.oldfinreference,
				    t1.reagebucket,
				    t1.fincategory,
				    t1.productcategory,
				    t1.roundingtarget,
				    t36.entitycode AS lovdescentitycode,
				    t1.eligibilitymethod,
				    t38.fieldcodevalue AS loveligibilitymethod,
				    t38.valuedesc AS lovdesceligibilitymethod,
				    t1.employeename,
				    t37.rofficerdesc AS employeenamedesc,
				    t1.samplingrequired,
				    t1.legalrequired,
				    t1.grcmaxamount,
				    t1.connector,
				    t40.dealername AS connectorcode,
				    t40.dealercity AS connectordesc,
				    t1.advanceemi,
				    t1.advemiterms,
				    t1.bpipftdaysbasis,
				    t1.fixedratetenor,
				    t1.fixedtenorrate,
				    t12.branchtel AS finbranchcontact,
				    t1.processattributes,
				    t1.businessvertical,
				    bv.code AS businessverticalcode,
				    bv.description AS businessverticaldesc,
				    t1.grcadvtype,
				    t1.grcadvterms,
				    t1.advtype,
				    t1.advterms,
				    t1.advstage,
				    t1.tdspercentage,
				    t1.tdsstartdate,
				    t1.tdsenddate,
				    t1.tdslimitamt,
				    t1.vanreq,
				    t1.vancode,
				    t1.allowdrawingpower,
				    t1.allowrevolving,
				    t1.sanbsdschdle,
				    t1.promotionseqid,
				    t1.svamount,
				    t1.cbamount,
				    t1.appliedloanamt,
				    t1.finisratervwatgrcend,
					t1.planEMIHAlwInGrace
				   FROM financemain_temp t1
				     JOIN rmtfinancetypes t7 ON t1.fintype  = t7.fintype 
				     LEFT JOIN rmtbranches t12 ON t1.finbranch  = t12.branchcode 
				     LEFT JOIN finpftdetails t17 ON t17.finreference  = t1.finreference 
				     LEFT JOIN steppolicyheader t24 ON t1.steppolicy  = t24.policycode 
				     LEFT JOIN bmtcuststatuscodes t27 ON t1.finstatus  = t27.custstscode 
				     LEFT JOIN amtvehicledealer t28 ON t1.accountsofficer = t28.dealerid
				     LEFT JOIN relationshipofficers t30 ON t1.dsacode  = t30.rofficercode 
				     LEFT JOIN relationshipofficers t33 ON t1.referralid  = t33.rofficercode 
				     LEFT JOIN relationshipofficers t34 ON t1.dmacode  = t34.rofficercode 
				     LEFT JOIN bmtdepartments t35 ON t1.salesdepartment  = t35.deptcode 
				     LEFT JOIN smtdivisiondetail t36 ON t7.findivision  = t36.divisioncode 
				     LEFT JOIN relationshipofficers t37 ON t1.employeename  = t37.rofficercode 
				     LEFT JOIN rmtlovfielddetail t38 ON t1.eligibilitymethod = t38.fieldcodeid AND t38.fieldcode  = 'ELGMETHOD' 
				     LEFT JOIN loanpurposes t39 ON t1.finpurpose  = t39.loanpurposecode 
				     LEFT JOIN amtvehicledealer t40 ON t1.connector = t40.dealerid
				     LEFT JOIN business_vertical bv ON bv.id = t1.businessvertical
				UNION ALL
				 SELECT t1.finreference,
				    t1.investmentref,
				    t1.numberofterms,
				    t1.grcperiodenddate,
				    t1.allowgrcperiod,
				    t1.gracebaserate,
				    t1.gracespecialrate,
				    t1.grcpftrate,
				    t1.grcpftfrq,
				    t1.nextgrcpftdate,
				    t1.allowgrcpftrvw,
				    t1.grcpftrvwfrq,
				    t1.nextgrcpftrvwdate,
				    t1.allowgrccpz,
				    t1.grccpzfrq,
				    t1.nextgrccpzdate,
				    t1.repaybaserate,
				    t1.repayspecialrate,
				    t1.repayprofitrate,
				    t1.repayfrq,
				    t1.nextrepaydate,
				    t1.repaypftfrq,
				    t1.nextrepaypftdate,
				    t1.allowrepayrvw,
				    t1.repayrvwfrq,
				    t1.nextrepayrvwdate,
				    t1.allowrepaycpz,
				    t1.repaycpzfrq,
				    t1.nextrepaycpzdate,
				    t1.maturitydate,
				    t1.cpzatgraceend,
				    t1.downpayment,
				    t1.graceflatamount,
				    t1.reqrepayamount,
				    t1.totalprofit,
				    t1.totalcpz,
				    t1.totalgrosspft,
				    t1.totalgrossgrcpft,
				    t1.totalgracepft,
				    t1.totalgracecpz,
				    t1.grcratebasis,
				    t1.repayratebasis,
				    t1.fintype,
				    t1.finremarks,
				    t1.finccy,
				    t1.schedulemethod,
				    t1.profitdaysbasis,
				    t1.reqmaturity,
				    t1.calterms,
				    t1.calmaturity,
				    t1.firstrepay,
				    t1.lastrepay,
				    t1.finstartdate,
				    t1.finamount,
				    t1.finamount + t1.feechargeamt - t1.downpayment AS lovdescfinancingamount,
				    t1.finrepaymentamount,
				    t1.custid,
				    t1.defferments,
				    t1.plandefercount,
				    t1.finbranch,
				    t1.finsourceid,
				    t1.alloweddefrpychange,
				    t1.availeddefrpychange,
				    t1.alloweddeffrqchange,
				    t1.availeddeffrqchange,
				    t1.recaltype,
				    t1.finassetvalue,
				    t1.disbaccountid,
				    t1.repayaccountid,
				    t1.finisactive,
				    t1.limitvalid,
				    t1.overridelimit,
				    t1.securitydeposit,
				    t1.version,
				    t1.lastmntby,
				    t1.lastmnton,
				    t1.recordstatus,
				    t1.rolecode,
				    t1.nextrolecode,
				    t1.taskid,
				    t1.nexttaskid,
				    t1.recordtype,
				    t1.workflowid,
				    t7.fintypedesc AS lovdescfintypename,
				    t7.finmaxamount AS lovdescfinmaxamt,
				    t7.finminamount AS lovdescfinminamount,
				    t1.mindownpayperc,
				    t7.finisalwdifferment AS lovdescfinalwdeferment,
				    t7.finisdwpayrequired AS lovdescdwnpayreq,
				    t7.finmaxdifferment AS lovdescfinmaxdifferment,
				    t12.branchdesc AS lovdescfinbranchname,
				    t12.branchprovince AS finbranchprovincecode,
				    t1.lastrepaydate,
				    t1.lastrepaypftdate,
				    t1.lastrepayrvwdate,
				    t1.lastrepaycpzdate,
				    t1.allowgrcrepay,
				    t1.grcschdmthd,
				    t1.grcmargin,
				    t1.repaymargin,
				    t1.fincurrassetvalue,
				    t1.fincommitmentref,
				    t1.finlimitref,
				    t1.depreciationfrq,
				    t1.fincontractdate,
				    t1.nextdepdate,
				    t1.lastdepdate,
				    t1.finaccount,
				    t1.fincustpftaccount,
				    t17.acrtilllbd AS lovdescaccruedtilllbd,
				    t7.finrvwrateapplfor,
				    t1.totalrepayamt,
				    t1.closingstatus,
				    t1.finapproveddate,
				    t1.feechargeamt,
				    t1.blacklisted,
				    t1.finrepaypftonfrq,
				    t1.anualizedpercrate,
				    t1.effectiverateofreturn,
				    t1.migratedfinance,
				    t1.schedulemaintained,
				    t1.scheduleregenerated,
				    t1.finpurpose,
				    t39.loanpurposedesc AS lovdescfinpurposename,
				    t1.finstatus,
				    t1.finstsreason,
				    t1.initiateuser,
				    t1.bankname,
				    t1.iban,
				    t1.accounttype,
				    t1.ddareferenceno,
				    t7.finscheduleon AS lovdescfinscheduleon,
				    t1.custdsr,
				    t1.jointaccount,
				    t1.jointcustid,
				    t1.downpaybank,
				    t1.downpaysupl,
				    t1.downpayaccount,
				    t1.securitycollateral,
				    t1.approved,
				    t1.discrepancy,
				    t1.limitapproved,
				    t1.graceterms,
				    t7.findivision AS lovdescfindivision,
				    t1.rcdmaintainsts,
				    t1.finrepaymethod,
				    t1.grcprofitdaysbasis,
				    t1.stepfinance,
				    t1.steptype,
				    t1.steppolicy,
				    t1.alwmanualsteps,
				    t1.noofsteps,
				    t1.linkedfinref,
				    t1.nextuserid,
				    t1.priority,
				    t24.policydesc AS lovdescsteppolicyname,
				    t1.grcminrate,
				    t1.grcmaxrate,
				    t1.rpyminrate,
				    t1.rpymaxrate,
				    t1.deviationapproval,
				    t1.manualschedule,
				    t1.takeoverfinance,
				    t1.grcadvbaserate,
				    t1.grcadvmargin,
				    t1.grcadvpftrate,
				    t1.rpyadvbaserate,
				    t1.rpyadvmargin,
				    t1.rpyadvpftrate,
				    t1.supplementrent,
				    t1.increasedcost,
				    t1.creditinsamt,
				    t1.rolloverfrq,
				    t1.nextrolloverdate,
				    t27.custstsdescription,
				    t1.shariastatus,
				    t1.initiatedate,
				    t1.finpreapprovedref,
				    t1.mmaid,
				    t1.accountsofficer,
				    t1.feeaccountid,
				    t1.fincancelac,
				    t28.dealername AS lovdescaccountsofficer,
				    t28.dealercity AS lovdescsourcecity,
				    t1.dsacode,
				    t30.rofficerdesc AS dsacodedesc,
				    t1.tdsapplicable,
				    t1.mandateid,
				    t1.droplinefrq,
				    t1.firstdroplinedate,
				    t1.pftservicingodlimit,
				    t1.insuranceamt,
				    t1.deductinsdisb,
				    t1.alwbpi,
				    t1.bpitreatment,
				    t1.planemihalw,
				    t1.planemihmethod,
				    t1.planemihmaxperyear,
				    t1.planemihmax,
				    t1.planemihlockperiod,
				    t1.planemicpz,
				    t1.calroundingmode,
				    t1.alwmultidisb,
				    t1.applicationno,
				    t1.referralid,
				    t33.rofficerdesc AS referraliddesc,
				    t1.dmacode,
				    t34.rofficerdesc AS dmacodedesc,
				    t1.salesdepartment,
				    t35.deptdesc AS salesdepartmentdesc,
				    t1.quickdisb,
				    t1.wifreference,
				    t1.unplanemihlockperiod,
				    t1.unplanemicpz,
				    t1.reagecpz,
				    t1.maxunplannedemi,
				    t1.maxreageholidays,
				    t1.availedunplanemi,
				    t1.availedreageh,
				    t1.bpiamount,
				    t1.deductfeedisb,
				    t1.rvwrateapplfor,
				    t1.schcalonrvw,
				    t1.pastduepftcalmthd,
				    t1.pastduepftmargin,
				    t1.droppingmethod,
				    t1.ratechganyday,
				    t1.promotioncode,
				    t1.restructureloan,
				    t1.oldfinreference,
				    t1.reagebucket,
				    t1.fincategory,
				    t1.productcategory,
				    t1.roundingtarget,
				    t36.entitycode AS lovdescentitycode,
				    t1.eligibilitymethod,
				    t38.fieldcodevalue AS loveligibilitymethod,
				    t38.valuedesc AS lovdesceligibilitymethod,
				    t1.employeename,
				    t37.rofficerdesc AS employeenamedesc,
				    t1.samplingrequired,
				    t1.legalrequired,
				    t1.grcmaxamount,
				    t1.connector,
				    t40.dealername AS connectorcode,
				    t40.dealercity AS connectordesc,
				    t1.advanceemi,
				    t1.advemiterms,
				    t1.bpipftdaysbasis,
				    t1.fixedratetenor,
				    t1.fixedtenorrate,
				    t12.branchtel AS finbranchcontact,
				    t1.processattributes,
				    t1.businessvertical,
				    bv.code AS businessverticalcode,
				    bv.description AS businessverticaldesc,
				    t1.grcadvtype,
				    t1.grcadvterms,
				    t1.advtype,
				    t1.advterms,
				    t1.advstage,
				    t1.tdspercentage,
				    t1.tdsstartdate,
				    t1.tdsenddate,
				    t1.tdslimitamt,
				    t1.vanreq,
				    t1.vancode,
				    t1.allowdrawingpower,
				    t1.allowrevolving,
				    t1.sanbsdschdle,
				    t1.promotionseqid,
				    t1.svamount,
				    t1.cbamount,
				    t1.appliedloanamt,
				    t1.finisratervwatgrcend,
					t1.planEMIHAlwInGrace
				   FROM financemain t1
				     JOIN rmtfinancetypes t7 ON t1.fintype  = t7.fintype 
				     LEFT JOIN rmtbranches t12 ON t1.finbranch  = t12.branchcode 
				     LEFT JOIN finpftdetails t17 ON t17.finreference  = t1.finreference 
				     LEFT JOIN steppolicyheader t24 ON t1.steppolicy  = t24.policycode 
				     LEFT JOIN bmtcuststatuscodes t27 ON t1.finstatus  = t27.custstscode 
				     LEFT JOIN amtvehicledealer t28 ON t1.accountsofficer = t28.dealerid
				     LEFT JOIN relationshipofficers t30 ON t1.dsacode  = t30.rofficercode 
				     LEFT JOIN relationshipofficers t33 ON t1.referralid  = t33.rofficercode 
				     LEFT JOIN relationshipofficers t34 ON t1.dmacode  = t34.rofficercode 
				     LEFT JOIN bmtdepartments t35 ON t1.salesdepartment  = t35.deptcode 
				     LEFT JOIN smtdivisiondetail t36 ON t7.findivision  = t36.divisioncode 
				     LEFT JOIN relationshipofficers t37 ON t1.employeename  = t37.rofficercode 
				     LEFT JOIN rmtlovfielddetail t38 ON t1.eligibilitymethod = t38.fieldcodeid AND t38.fieldcode  = 'ELGMETHOD' 
				     LEFT JOIN loanpurposes t39 ON t1.finpurpose  = t39.loanpurposecode 
				     LEFT JOIN amtvehicledealer t40 ON t1.connector = t40.dealerid
				     LEFT JOIN business_vertical bv ON bv.id = t1.businessvertical
				     WHERE NOT (EXISTS ( SELECT 1
				           FROM financemain_temp
				          WHERE financemain_temp.finreference  = t1.finreference ))
				   ]]>
		</createView>
	</changeSet>

	<changeSet id="13_post" author="thirupathi" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'financemain_view');
			]]>
		</sql>
	</changeSet>

	<changeSet id="13.1" author="thirupathi">
		<sql>
			<![CDATA[
				Update SeqSecRights set SeqNo = (Select max(RightId) from SecRights);
				
				Insert into SecRights values((Select max(RightId) + 1 from SecRights), 3, 'FinanceMainDialog_AlwPlannedEmiHolidayInGrace', 'FinanceMainDialog', 0, 1000, current_timestamp, 'Approved', '', '', '', '', '', 0);
				
				Update SeqSecRights set SeqNo = (Select max(RightId) from SecRights);
			]]>
		</sql>
	</changeSet>

	<changeSet id="14" author="saikumar.b">
		<addColumn tableName="FinAdvancePayments">
			<column name="HoldDisbursement" type="boolean" />
		</addColumn>
	</changeSet>

	<changeSet id="15" author="saikumar.b">
		<addColumn tableName="FinAdvancePayments_temp">
			<column name="HoldDisbursement" type="boolean" />
		</addColumn>
	</changeSet>

	<changeSet id="16" author="saikumar.b">
		<sql>
			<![CDATA[
				UPDATE FINADVANCEPAYMENTS SET HOLDDISBURSEMENT = 0  WHERE HOLDDISBURSEMENT IS NULL;
				UPDATE FINADVANCEPAYMENTS_TEMP SET HOLDDISBURSEMENT = 0  WHERE HOLDDISBURSEMENT IS NULL;
			]]>
		</sql>
	</changeSet>

	<changeSet id="16.1" author="saikumar.b" dbms="mssql">
		<sql>
			<![CDATA[	
				ALTER TABLE FINADVANCEPAYMENTS ADD CONSTRAINT DF_FINADVNPYMT_HLDDISBRSMNT DEFAULT 0 FOR HOLDDISBURSEMENT;
				ALTER TABLE FINADVANCEPAYMENTS_TEMP ADD CONSTRAINT DF_FINADVNPYMT_TMP_HLDDISBRMT DEFAULT 0 FOR HOLDDISBURSEMENT;
			]]>
		</sql>
	</changeSet>

	<changeSet id="16.2" author="satyanarayana.g" dbms="postgresql, oracle">
		<addDefaultValue columnName="HoldDisbursement" tableName="FINADVANCEPAYMENTS" defaultValue="0" />
		<addDefaultValue columnName="HoldDisbursement" tableName="FINADVANCEPAYMENTS_TEMP" defaultValue="0" />
	</changeSet>

	<changeSet id="17_pre" author="satyanarayana.g" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'finadvancepayments_aview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="17" author="saikumar.b">
		<comment> HoldDisbursement column added in FinAdvancePayments</comment>
		<createView viewName="FINADVANCEPAYMENTS_AVIEW" replaceIfExists="true">
			<![CDATA[
				SELECT T1.FINREFERENCE,
				T1.PAYMENTID,
				T1.PAYMENTSEQ,
				T1.PAYMENTDETAIL,
				T1.AMTTOBERELEASED,
				T1.LIABILITYHOLDNAME,
				T1.TRANSACTIONREF,
				T1.BENEFICIARYNAME,
				T1.BENEFICIARYACCNO,
				T1.REENTERBENEFICIARYACCNO,
				T1.DESCRIPTION,
				T1.PAYMENTTYPE,
				T1.LLREFERENCENO,
				T1.LLDATE,
				T1.CUSTCONTRIBUTION,
				T1.SELLERCONTRIBUTION,
				T1.REMARKS,
				T1.DISBDATE,
				T1.DISBSEQ,
				T1.VERSION,
				T1.LASTMNTBY,
				T1.LASTMNTON,
				T1.RECORDSTATUS,
				T1.ROLECODE,
				T1.NEXTROLECODE,
				T1.TASKID,
				T1.NEXTTASKID,
				T1.RECORDTYPE,
				T1.WORKFLOWID,
				T1.BANKCODE,
				T1.PAYABLELOC,
				T1.PRINTINGLOC,
				T1.VALUEDATE,
				T1.BANKBRANCHID,
				T1.PHONECOUNTRYCODE,
				T1.PHONEAREACODE,
				T1.PHONENUMBER,
				T1.CLEARINGDATE,
				T1.STATUS,
				T1.ACTIVE,
				T1.INPUTDATE,
				T1.DISBCCY,
				T1.POISSUED,
				T3.BANKCODE BRANCHBANKCODE,
				T31.BANKNAME BRANCHBANKNAME,
				T3.BRANCHCODE,
				T3.BRANCHDESC,
				T3.IFSC,
				T3.CITY,
				T4.BANKNAME,
				T1.PARTNERBANKID,
				T5.PARTNERBANKCODE,
				T5.PARTNERBANKNAME,
				T1.LINKEDTRANID,
				T5.ACTYPE PARTNERBANKACTYPE,
				T5.ACCOUNTNO PARTNERBANKAC,
				T6.BRANCHDESC PRINTINGLOCDESC,
				T1.REJECTREASON,
				T1.REALIZATIONDATE,
				T1.HOLDDISBURSEMENT
				FROM FINADVANCEPAYMENTS T1
				LEFT JOIN BANKBRANCHES T3 ON T1.BANKBRANCHID = T3.BANKBRANCHID
				LEFT JOIN BMTBANKDETAIL T31 ON T31.BANKCODE = T3.BANKCODE
				LEFT JOIN BMTBANKDETAIL T4 ON T1.BANKCODE = T4.BANKCODE
				LEFT JOIN PARTNERBANKS T5 ON T5.PARTNERBANKID = T1.PARTNERBANKID
				LEFT JOIN BANKBRANCHES T6 ON T6.BRANCHCODE = T1.PRINTINGLOC
					]]>
		</createView>
	</changeSet>

	<changeSet id="17_post" author="satyanarayana.g" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'finadvancepayments_aview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="18_pre" author="satyanarayana.g" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'finadvancepayments_tview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="18" author="saikumar.b">
		<comment> HoldDisbursement column added in FinAdvancePayments</comment>
		<createView viewName="FINADVANCEPAYMENTS_TVIEW" replaceIfExists="true">
			<![CDATA[
				SELECT T1.FINREFERENCE,
				T1.PAYMENTID,
				T1.PAYMENTSEQ,
				T1.PAYMENTDETAIL,
				T1.AMTTOBERELEASED,
				T1.LIABILITYHOLDNAME,
				T1.TRANSACTIONREF,
				T1.BENEFICIARYNAME,
				T1.BENEFICIARYACCNO,
				T1.REENTERBENEFICIARYACCNO,
				T1.DESCRIPTION,
				T1.PAYMENTTYPE,
				T1.LLREFERENCENO,
				T1.LLDATE,
				T1.CUSTCONTRIBUTION,
				T1.SELLERCONTRIBUTION,
				T1.REMARKS,
				T1.DISBDATE,
				T1.DISBSEQ,
				T1.VERSION,
				T1.LASTMNTBY,
				T1.LASTMNTON,
				T1.RECORDSTATUS,
				T1.ROLECODE,
				T1.NEXTROLECODE,
				T1.TASKID,
				T1.NEXTTASKID,
				T1.RECORDTYPE,
				T1.WORKFLOWID,
				T1.BANKCODE,
				T1.PAYABLELOC,
				T1.PRINTINGLOC,
				T1.VALUEDATE,
				T1.BANKBRANCHID,
				T1.PHONECOUNTRYCODE,
				T1.PHONEAREACODE,
				T1.PHONENUMBER,
				T1.CLEARINGDATE,
				T1.STATUS,
				T1.ACTIVE,
				T1.INPUTDATE,
				T1.DISBCCY,
				T1.POISSUED,
				T3.BANKCODE BRANCHBANKCODE,
				T31.BANKNAME BRANCHBANKNAME,
				T3.BRANCHCODE,
				T3.BRANCHDESC,
				T3.IFSC,
				T3.CITY,
				T4.BANKNAME,
				T1.PARTNERBANKID,
				T5.PARTNERBANKCODE,
				T5.PARTNERBANKNAME,
				T1.LINKEDTRANID,
				T5.ACTYPE PARTNERBANKACTYPE,
				T5.ACCOUNTNO PARTNERBANKAC,
				T6.BRANCHDESC PRINTINGLOCDESC,
				T1.REJECTREASON,
				T1.REALIZATIONDATE,
				T1.HOLDDISBURSEMENT
				FROM FINADVANCEPAYMENTS_TEMP T1
				LEFT JOIN BANKBRANCHES T3 ON T1.BANKBRANCHID = T3.BANKBRANCHID
				LEFT JOIN BMTBANKDETAIL T31 ON T31.BANKCODE = T3.BANKCODE
				LEFT JOIN BMTBANKDETAIL T4 ON T1.BANKCODE = T4.BANKCODE
				LEFT JOIN PARTNERBANKS T5 ON T5.PARTNERBANKID = T1.PARTNERBANKID
				LEFT JOIN BANKBRANCHES T6 ON T6.BRANCHCODE = T1.PRINTINGLOC
				  ]]>
		</createView>
	</changeSet>

	<changeSet id="18_post" author="satyanarayana.g" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'finadvancepayments_tview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="19_pre" author="satyanarayana.g" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'finadvancepayments_view');
			]]>
		</sql>
	</changeSet>

	<changeSet id="19" author="saikumar.b">
		<comment> HoldDisbursement column added in FinAdvancePayments</comment>
		<createView viewName="FINADVANCEPAYMENTS_VIEW" replaceIfExists="true">
			<![CDATA[
				SELECT T1.FINREFERENCE,
				T1.PAYMENTID,
				T1.PAYMENTSEQ,
				T1.PAYMENTDETAIL,
				T1.AMTTOBERELEASED,
				T1.LIABILITYHOLDNAME,
				T1.TRANSACTIONREF,
				T1.BENEFICIARYNAME,
				T1.BENEFICIARYACCNO,
				T1.REENTERBENEFICIARYACCNO,
				T1.DESCRIPTION,
				T1.PAYMENTTYPE,
				T1.LLREFERENCENO,
				T1.LLDATE,
				T1.CUSTCONTRIBUTION,
				T1.SELLERCONTRIBUTION,
				T1.REMARKS,
				T1.DISBDATE,
				T1.DISBSEQ,
				T1.VERSION,
				T1.LASTMNTBY,
				T1.LASTMNTON,
				T1.RECORDSTATUS,
				T1.ROLECODE,
				T1.NEXTROLECODE,
				T1.TASKID,
				T1.NEXTTASKID,
				T1.RECORDTYPE,
				T1.WORKFLOWID,
				T1.BANKCODE,
				T1.PAYABLELOC,
				T1.PRINTINGLOC,
				T1.VALUEDATE,
				T1.BANKBRANCHID,
				T1.PHONECOUNTRYCODE,
				T1.PHONEAREACODE,
				T1.PHONENUMBER,
				T1.CLEARINGDATE,
				T1.STATUS,
				T1.ACTIVE,
				T1.INPUTDATE,
				T1.DISBCCY,
				T1.POISSUED,
				T3.BANKCODE BRANCHBANKCODE,
				T31.BANKNAME BRANCHBANKNAME,
				T3.BRANCHCODE,
				T3.BRANCHDESC,
				T3.IFSC,
				T3.CITY,
				T4.BANKNAME,
				T1.PARTNERBANKID,
				T5.PARTNERBANKCODE,
				T5.PARTNERBANKNAME,
				T1.LINKEDTRANID,
				T5.ACTYPE PARTNERBANKACTYPE,
				T5.ACCOUNTNO PARTNERBANKAC,
				T6.BRANCHDESC PRINTINGLOCDESC,
				T1.REJECTREASON,
				T1.REALIZATIONDATE,
				T1.HOLDDISBURSEMENT
				FROM FINADVANCEPAYMENTS_TEMP T1
				LEFT JOIN BANKBRANCHES T3 ON T1.BANKBRANCHID = T3.BANKBRANCHID
				LEFT JOIN BMTBANKDETAIL T31 ON T31.BANKCODE = T3.BANKCODE
				LEFT JOIN BMTBANKDETAIL T4 ON T1.BANKCODE = T4.BANKCODE
				LEFT JOIN PARTNERBANKS T5 ON T5.PARTNERBANKID = T1.PARTNERBANKID
				LEFT JOIN BANKBRANCHES T6 ON T6.BRANCHCODE = T1.PRINTINGLOC
				UNION ALL
				SELECT T1.FINREFERENCE,
				T1.PAYMENTID,
				T1.PAYMENTSEQ,
				T1.PAYMENTDETAIL,
				T1.AMTTOBERELEASED,
				T1.LIABILITYHOLDNAME,
				T1.TRANSACTIONREF,
				T1.BENEFICIARYNAME,
				T1.BENEFICIARYACCNO,
				T1.REENTERBENEFICIARYACCNO,
				T1.DESCRIPTION,
				T1.PAYMENTTYPE,
				T1.LLREFERENCENO,
				T1.LLDATE,
				T1.CUSTCONTRIBUTION,
				T1.SELLERCONTRIBUTION,
				T1.REMARKS,
				T1.DISBDATE,
				T1.DISBSEQ,
				T1.VERSION,
				T1.LASTMNTBY,
				T1.LASTMNTON,
				T1.RECORDSTATUS,
				T1.ROLECODE,
				T1.NEXTROLECODE,
				T1.TASKID,
				T1.NEXTTASKID,
				T1.RECORDTYPE,
				T1.WORKFLOWID,
				T1.BANKCODE,
				T1.PAYABLELOC,
				T1.PRINTINGLOC,
				T1.VALUEDATE,
				T1.BANKBRANCHID,
				T1.PHONECOUNTRYCODE,
				T1.PHONEAREACODE,
				T1.PHONENUMBER,
				T1.CLEARINGDATE,
				T1.STATUS,
				T1.ACTIVE,
				T1.INPUTDATE,
				T1.DISBCCY,
				T1.POISSUED,
				T3.BANKCODE BRANCHBANKCODE,
				T31.BANKNAME BRANCHBANKNAME,
				T3.BRANCHCODE,
				T3.BRANCHDESC,
				T3.IFSC,
				T3.CITY,
				T4.BANKNAME,
				T1.PARTNERBANKID,
				T5.PARTNERBANKCODE,
				T5.PARTNERBANKNAME,
				T1.LINKEDTRANID,
				T5.ACTYPE PARTNERBANKACTYPE,
				T5.ACCOUNTNO PARTNERBANKAC,
				T6.BRANCHDESC PRINTINGLOCDESC,
				T1.REJECTREASON,
				T1.REALIZATIONDATE,
				T1.HOLDDISBURSEMENT
				FROM FINADVANCEPAYMENTS T1
				LEFT JOIN BANKBRANCHES T3 ON T1.BANKBRANCHID = T3.BANKBRANCHID
				LEFT JOIN BMTBANKDETAIL T31 ON T31.BANKCODE = T3.BANKCODE
				LEFT JOIN BMTBANKDETAIL T4 ON T1.BANKCODE = T4.BANKCODE
				LEFT JOIN PARTNERBANKS T5 ON T5.PARTNERBANKID = T1.PARTNERBANKID
				LEFT JOIN BANKBRANCHES T6 ON T6.BRANCHCODE = T1.PRINTINGLOC
				WHERE NOT (EXISTS ( SELECT 1
				FROM FINADVANCEPAYMENTS_TEMP
				WHERE FINADVANCEPAYMENTS_TEMP.FINREFERENCE = T1.FINREFERENCE AND FINADVANCEPAYMENTS_TEMP.PAYMENTSEQ = T1.PAYMENTSEQ))
			      ]]>
		</createView>
	</changeSet>

	<changeSet id="19_post" author="satyanarayana.g" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'finadvancepayments_view');
			]]>
		</sql>
	</changeSet>

	<changeSet id="20_pre" author="satyanarayana.g" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'finadvancepayments_custaview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="20" author="saikumar">
		<comment> HoldDisbursement column added in FinAdvancePayments</comment>
		<createView viewName="finadvancepayments_custaview" replaceIfExists="true">
			<![CDATA[
			  SELECT  T1.FINREFERENCE,
				T1.PAYMENTID, 
				T1.PAYMENTSEQ, 
				T1.BENEFICIARYNAME,
				T1.BENEFICIARYACCNO,
				T1.PAYMENTTYPE,
				T1.LLDATE, 
				T1.DISBSEQ,
				T1.BANKBRANCHID,
				T1.STATUS,
				T1.DISBCCY,
				T1.POISSUED,
				T3.BANKCODE BRANCHBANKCODE,
				T31.BANKNAME BRANCHBANKNAME,
				T3.BRANCHCODE,
				T3.BRANCHDESC,
				T3.IFSC,
				T3.CITY,
				T3.MICR,
				T1.PARTNERBANKID,
				T5.PARTNERBANKCODE,
				T5.PARTNERBANKNAME,
				T1.LINKEDTRANID ,
				T5.ACTYPE PARTNERBANKACTYPE, 
				T5.ACCOUNTNO PARTNERBANKAC,
				T6.CUSTID,
				T1.HOLDDISBURSEMENT 
				FROM  	 FINADVANCEPAYMENTS T1 LEFT OUTER JOIN
				BANKBRANCHES T3 ON T1.BANKBRANCHID = T3.BANKBRANCHID  LEFT OUTER JOIN
				BMTBANKDETAIL T31 ON T31.BANKCODE=T3.BANKCODE LEFT OUTER JOIN		 
				BMTBANKDETAIL T4  ON T1.BANKCODE=T4.BANKCODE	LEFT OUTER JOIN
				PARTNERBANKS T5 ON T5.PARTNERBANKID=T1.PARTNERBANKID LEFT JOIN
				FINANCEMAIN T6 ON T1.FINREFERENCE = T6.FINREFERENCE
				]]>
		</createView>
	</changeSet>

	<changeSet id="20_post" author="satyanarayana.g" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'finadvancepayments_custaview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="21_pre" author="satyanarayana.g" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'finadvancepayments_adview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="21" author="satyanarayana.g">
		<comment> HoldDisbursement column added in FinAdvancePayments</comment>
		<createView viewName="FINADVANCEPAYMENTS_ADVIEW" replaceIfExists="true">
			<![CDATA[
				SELECT	T1.PAYMENTID,
				T1.FINREFERENCE, 
				T1. PAYMENTSEQ, 
				T1.DISBSEQ, 
				T1.PAYMENTDETAIL, 
				T1.AMTTOBERELEASED, 
				T1.LIABILITYHOLDNAME, 
				T1.BENEFICIARYNAME, 
				T1.BENEFICIARYACCNO,
				T1.DESCRIPTION, 
				T1.PAYMENTTYPE, 
				T1.BANKCODE, 
				T1.LLREFERENCENO, 
				T1.LLDATE, 
				T1.CUSTCONTRIBUTION,
				T1.SELLERCONTRIBUTION, 
				T1.REMARKS, 
				T1.PAYABLELOC,
				T1.PRINTINGLOC,
				T1.VALUEDATE,
				T1.BANKBRANCHID, 
				T1.PHONECOUNTRYCODE,
				T1.PHONEAREACODE, 
				T1.PHONENUMBER, 
				T1.CLEARINGDATE,
				T1.STATUS, 
				T1.ACTIVE, 
				T1.INPUTDATE,
				T1.DISBCCY, 
				T1.POISSUED, 
				T1.PARTNERBANKID, 
				T1.LINKEDTRANID, 
				T1.TRANSACTIONREF,
				T1.VERSION, 
				T1.LASTMNTBY,
				T1.LASTMNTON, 
				T1.RECORDSTATUS, 
				T1.ROLECODE, 
				T1.NEXTROLECODE,
				T1.TASKID,
				T1.NEXTTASKID, 
				T1.RECORDTYPE,
				T1.WORKFLOWID,
				T3.FINTYPE,
				T4.BANKCODE BRANCHBANKCODE, 
				T4.BRANCHCODE, 
				T4.BRANCHDESC, 
				T4.IFSC, 
				T4.CITY, 
				T4.MICR,
				T5.BANKNAME BRANCHBANKNAME,
				T6.BANKNAME, 
				T7.PARTNERBANKCODE, 
				T7.PARTNERBANKNAME, 
				T7.ACTYPE PARTNERBANKACTYPE,
				T7.ACCOUNTNO PARTNERBANKAC,
				T7.FILENAME,
				T7.ALWFILEDOWNLOAD,
				T1.HOLDDISBURSEMENT
				FROM FINADVANCEPAYMENTS T1
				INNER JOIN FINANCEMAIN T3 ON T3.FINREFERENCE = T1.FINREFERENCE
				LEFT OUTER JOIN	BANKBRANCHES T4 ON T1.BANKBRANCHID = T4.BANKBRANCHID
				LEFT OUTER JOIN	BMTBANKDETAIL T5 ON T5.BANKCODE = T4.BANKCODE 
				LEFT OUTER JOIN	BMTBANKDETAIL T6  ON T1.BANKCODE = T6.BANKCODE
				LEFT OUTER JOIN	PARTNERBANKS T7 ON T7.PARTNERBANKID = T1.PARTNERBANKID
				 ]]>
		</createView>
	</changeSet>

	<changeSet id="21_post" author="satyanarayana.g" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'finadvancepayments_adview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="22" author="saikumar">
		<sql>
			<![CDATA[
			     UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
				 UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS);	
				 
           		 DELETE FROM SECGROUPRIGHTS WHERE RIGHTID IN (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='FinAdvancePaymentsDialog_holdDisbIsActive');
			     DELETE FROM SECRIGHTS WHERE RIGHTNAME='FinAdvancePaymentsDialog_holdDisbIsActive';
			     
			     INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 0, 'FinAdvancePaymentsDialog_holdDisbIsActive','FinAdvancePaymentsDialog',0,1000,CURRENT_TIMESTAMP,'','','','','','',0 FROM SEQSECRIGHTS WHERE 0=0;
				 INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='FinAdvancePayments_Maker') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='FinAdvancePaymentsDialog_holdDisbIsActive'), 1, 0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
				 
				 UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
				 UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS);
			]]>
		</sql>
	</changeSet>

	<changeSet id="23_pre" author="satyanarayana.g" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'int_disbursement_request_view');
			]]>
		</sql>
	</changeSet>

	<changeSet id="23" author="saikumar.b">
		<comment> HoldDisbursement column added in int_disbursement_request_view</comment>
		<createView viewName="INT_DISBURSEMENT_REQUEST_VIEW" replaceIfExists="true">
			<![CDATA[
				SELECT FA.PAYMENTID,
				FA.FINREFERENCE,
				'D' CHANNEL,
				0 PROVIDERID,
				CASE
				WHEN FA.PAYMENTTYPE = 'NEFT'
				THEN 'N'
				WHEN FA.PAYMENTTYPE = 'RTGS'
				THEN 'R'
				WHEN
				FA.PAYMENTTYPE = 'DD'
				THEN 'D'
				WHEN FA.PAYMENTTYPE = 'CHEQUE'
				THEN 'C'
				ELSE FA.PAYMENTTYPE
				END DISBURSEMENT_TYPE,
				FA.AMTTOBERELEASED,
				FA.DISBDATE,
				FA.LLDATE,
				FA.PAYABLELOC,
				FA.PRINTINGLOC,
				CU.CUSTCIF,
				CU.CUSTSHRTNAME,
				'' CUSTOMER_MOBILE,
				CE.CUSTEMAIL CUSTOMER_EMAIL,
				CS.CPPROVINCENAME CUSTOMER_STATE,
				CC.PCCITYNAME CUSTOMER_CITY,
				'' CUSTOMER_ADDRESS1,
				'' CUSTOMER_ADDRESS2,
				'' CUSTOMER_ADDRESS3,
				'' CUSTOMER_ADDRESS4,
				'' CUSTOMER_ADDRESS5,
				BD.BANKNAME,
				BB.BRANCHCODE,
				BB.BRANCHDESC,
				PBD.CPPROVINCENAME BENFICIARY_BRANCH_STATE,
				PBD.PCCITYNAME BENFICIARY_BRANCH_CITY,
				BB.MICR MICR_CODE,
				BB.IFSC IFSC_CODE,
				FA.BENEFICIARYACCNO,
				CASE
				WHEN FA.PAYMENTTYPE = 'CHEQUE'
				OR FA.PAYMENTTYPE = 'DD'
				THEN
				FA.LIABILITYHOLDNAME
				ELSE FA.BENEFICIARYNAME
				END BENEFICIARYNAME,
				(FA.PHONECOUNTRYCODE ${call.concatenate} FA.PHONEAREACODE) ${call.concatenate} FA.PHONENUMBER BENEFICIARY_MOBILE,
				BCE.CUSTEMAIL BENFICIRY_EMAIL,
				BRS.CPPROVINCENAME BENFICIARY_STATE,
				BRC.PCCITYNAME BENFICIARY_CITY,
				BRCA.CustAddrHNbr ${call.concatenate}','${call.concatenate} BRCA.CustAddrStreet ${call.concatenate}','${call.concatenate} BRC.PCCITYNAME ${call.concatenate}','${call.concatenate} BRS.CPPROVINCENAME  BENFICIARY_ADDRESS1,
				'' BENFICIARY_ADDRESS2,
				'' BENFICIARY_ADDRESS3,
				'' BENFICIARY_ADDRESS4,
				'' BENFICIARY_ADDRESS5,
				'' PAYMENT_DETAIL1,
				'' PAYMENT_DETAIL2,
				'' PAYMENT_DETAIL3,
				'' PAYMENT_DETAIL4,
				'' PAYMENT_DETAIL5,
				'' PAYMENT_DETAIL6,
				'' PAYMENT_DETAIL7,
				FA.STATUS,
				FA.DESCRIPTION REMARKS,
				FA.PAYMENTTYPE,
				FM.FINTYPE,
				PB.PARTNERBANKID
				PARTNERBANK_ID,
				PB.PARTNERBANKCODE PARTNERBANK_CODE,
				FA.INPUTDATE,
				PB.ALWFILEDOWNLOAD,
				PB.FILENAME,
				FM.FINISACTIVE,
				SMD.ENTITYCODE,
				FA.HOLDDISBURSEMENT HOLDDISBURSEMENT,
				PB.ACCOUNTNO PARTNERBANK_ACCOUNT
				FROM FINADVANCEPAYMENTS FA
				JOIN
				(SELECT FINANCEMAIN_TEMP.CUSTID,
				FINANCEMAIN_TEMP.FINREFERENCE,
				FINANCEMAIN_TEMP.FINTYPE,
				FINANCEMAIN_TEMP.FINISACTIVE
				FROM FINANCEMAIN_TEMP
				UNION ALL
				SELECT T2.CUSTID,
				T2.FINREFERENCE,
				T2.FINTYPE,
				T2.FINISACTIVE
				FROM FINANCEMAIN T2
				WHERE NOT (EXISTS
				( SELECT 1 FROM
				FINANCEMAIN_TEMP T3 WHERE T3.FINREFERENCE = T2.FINREFERENCE))) FM
				ON FM.FINREFERENCE = FA.FINREFERENCE
				JOIN CUSTOMERS CU ON CU.CUSTID = FM.CUSTID	
				JOIN RMTCURRENCIES CCY ON CCY.CCYCODE	= FA.DISBCCY
				JOIN PARTNERBANKS PB ON PB.PARTNERBANKID = FA.PARTNERBANKID
				LEFT JOIN CUSTOMEREMAILS CE	ON CE.CUSTID = CU.CUSTID AND CE.CUSTEMAILPRIORITY = 5
				LEFT JOIN CUSTOMERADDRESSES CA ON CA.CUSTID = CE.CUSTID	AND CA.CUSTADDRPRIORITY = 5
				LEFT JOIN RMTPROVINCEVSCITY CC ON CC.PCCITY = CA.CUSTADDRCITY
				LEFT JOIN RMTCOUNTRYVSPROVINCE CS ON CS.CPPROVINCE = CC.PCPROVINCE
				LEFT JOIN BANKBRANCHES BB ON BB.BANKBRANCHID = FA.BANKBRANCHID
				LEFT JOIN BMTBANKDETAIL BD ON BD.BANKCODE =	BB.BANKCODE
				LEFT JOIN ( SELECT PB_1.PARTNERBANKID,	
				PBD_1.BANKNAME,
				PBB.BRANCHDESC,
				PBBRC.PCCITYNAME,
				PBBRS.CPPROVINCENAME FROM PARTNERBANKS PB_1
				JOIN BANKBRANCHES PBB ON PBB.BRANCHCODE = PB_1.BANKBRANCHCODE
				JOIN BMTBANKDETAIL PBD_1 ON PBD_1.BANKCODE = PBB.BANKCODE
				LEFT JOIN RMTPROVINCEVSCITY PBBRC ON PBBRC.PCCITY = PBB.CITY
				LEFT JOIN RMTCOUNTRYVSPROVINCE PBBRS ON PBBRS.CPPROVINCE = PBBRC.PCPROVINCE
				) PBD ON PBD.PARTNERBANKID = PB.PARTNERBANKID
				LEFT JOIN BENEFICIARY BR ON BR.BANKBRANCHID = FA.BANKBRANCHID AND
				BR.ACCNUMBER = FA.BENEFICIARYACCNO AND BR.CUSTID = FM.CUSTID
				LEFT JOIN CUSTOMERS BC ON BC.CUSTID = BR.CUSTID
				LEFT JOIN CUSTOMEREMAILS BCE ON BCE.CUSTID = CU.CUSTID
				AND BCE.CUSTEMAILPRIORITY = 5
				LEFT JOIN CUSTOMERADDRESSES	BRCA ON	BRCA.CUSTID = BR.CUSTID
				AND BRCA.CUSTADDRPRIORITY = 5
				LEFT JOIN RMTPROVINCEVSCITY BRC	ON BRC.PCCITY =	BRCA.CUSTADDRCITY
				LEFT JOIN RMTCOUNTRYVSPROVINCE BRS ON BRS.CPPROVINCE = BRC.PCPROVINCE
				LEFT JOIN RMTFINANCETYPES RFT ON FM.FINTYPE = RFT.FINTYPE
				LEFT JOIN SMTDIVISIONDETAIL SMD	ON RFT.FINDIVISION = SMD.DIVISIONCODE
				WHERE FA.STATUS = 'APPROVED' AND NOT (FA.PAYMENTID IN ( 
				SELECT DISBURSEMENT_REQUESTS.DISBURSEMENT_ID FROM DISBURSEMENT_REQUESTS))
				AND NOT	(FA.PAYMENTID IN ( SELECT FINADVANCEPAYMENTS_TEMP.PAYMENTID FROM FINADVANCEPAYMENTS_TEMP))
				UNION ALL
				SELECT
				PI.PAYMENTINSTRUCTIONID PAYMENTID,
				PH.FINREFERENCE,
				PH.PAYMENTTYPE CHANNEL,
				0 PROVIDERID,
				CASE
				WHEN PI.PAYMENTTYPE =
				'NEFT'
				THEN 'N'
				WHEN PI.PAYMENTTYPE = 'RTGS'
				THEN 'R'
				WHEN PI.PAYMENTTYPE = 'DD'
				THEN 'D'
				WHEN PI.PAYMENTTYPE = 'CHEQUE'
				THEN 'C'
				ELSE PI.PAYMENTTYPE
				END DISBURSEMENT_TYPE,
				PI.PAYMENTAMOUNT  AMTTOBERELEASED,
				PI.POSTDATE
				DISBDATE,
				PI.POSTDATE LLDATE,
				PI.PAYABLELOC,
				PI.PRINTINGLOC,
				CU.CUSTCIF,
				CU.CUSTSHRTNAME,
				'' CUSTOMER_MOBILE,
				CE.CUSTEMAIL
				CUSTOMER_EMAIL,
				CS.CPPROVINCENAME CUSTOMER_STATE,
				CC.PCCITYNAME CUSTOMER_CITY,
				'' CUSTOMER_ADDRESS1,
				'' CUSTOMER_ADDRESS2,
				'' CUSTOMER_ADDRESS3,
				'' CUSTOMER_ADDRESS4,
				'' CUSTOMER_ADDRESS5,
				BD.BANKNAME,
				BB.BRANCHCODE,
				BB.BRANCHDESC,
				BBRS.CPPROVINCENAME BENFICIARY_BRANCH_STATE,
				BBRC.PCCITYNAME BENFICIARY_BRANCH_CITY,
				BB.MICR MICR_CODE,
				BB.IFSC IFSC_CODE,
				PI.ACCOUNTNO BENEFICIARYACCNO,
				CASE
				WHEN PI.PAYMENTTYPE = 'CHEQUE'
				OR PI.PAYMENTTYPE = 'DD'
				THEN
				PI.FAVOURNAME
				ELSE PI.ACCTHOLDERNAME
				END BENEFICIARYNAME,
				PI.PHONECOUNTRYCODE ${call.concatenate} PI.PHONENUMBER BENEFICIARY_MOBILE,
				BCE.CUSTEMAIL BENFICIRY_EMAIL,
				BRS.CPPROVINCENAME BENFICIARY_STATE,
				BRC.PCCITYNAME BENFICIARY_CITY,
				'' BENFICIARY_ADDRESS1,
				'' BENFICIARY_ADDRESS2,
				'' BENFICIARY_ADDRESS3,
				'' BENFICIARY_ADDRESS4,
				'' BENFICIARY_ADDRESS5,
				'' PAYMENT_DETAIL1,
				'' PAYMENT_DETAIL2,
				'' PAYMENT_DETAIL3,
				'' PAYMENT_DETAIL4,
				'' PAYMENT_DETAIL5,
				'' PAYMENT_DETAIL6,
				'' PAYMENT_DETAIL7,
				PI.STATUS,
				PI.REMARKS,
				PI.PAYMENTTYPE,
				FM.FINTYPE,
				PB.PARTNERBANKID PARTNERBANK_ID,
				PB.PARTNERBANKCODE
				PARTNERBANK_CODE,
				PI.POSTDATE INPUTDATE,
				PB.ALWFILEDOWNLOAD,
				PB.FILENAME,
				FM.FINISACTIVE,
				SMD.ENTITYCODE,
				0 HOLDDISBURSEMENT,
				PB.ACCOUNTNO
				PARTNERBANK_ACCOUNTNO
				FROM PAYMENTINSTRUCTIONS PI
				JOIN PAYMENTHEADER PH ON PH.PAYMENTID = PI.PAYMENTID
				JOIN (SELECT
				FINANCEMAIN.CUSTID,
				FINANCEMAIN.FINREFERENCE,
				FINANCEMAIN.FINTYPE,
				FINANCEMAIN.FINISACTIVE
				FROM FINANCEMAIN
				UNION ALL
				SELECT T2.CUSTID,
				T2.FINREFERENCE,
				T2.FINTYPE,
				T2.FINISACTIVE
				FROM FINANCEMAIN_TEMP T2
				WHERE NOT (EXISTS
				( SELECT 1 FROM
				FINANCEMAIN_TEMP T3 WHERE T3.FINREFERENCE = T2.FINREFERENCE))) FM ON FM.FINREFERENCE = PH.FINREFERENCE
				JOIN CUSTOMERS CU ON CU.CUSTID = FM.CUSTID
				JOIN RMTCURRENCIES CCY ON CCY.CCYCODE = PI.PAYMENTCCY
				JOIN PARTNERBANKS PB ON PB.PARTNERBANKID = PI.PARTNERBANKID
				LEFT JOIN CUSTOMEREMAILS CE ON CE.CUSTID = CU.CUSTID AND CE.CUSTEMAILPRIORITY = 5
				LEFT JOIN CUSTOMERADDRESSES CA ON CA.CUSTID = CE.CUSTID AND CA.CUSTADDRPRIORITY = 5
				LEFT JOIN RMTPROVINCEVSCITY CC ON CC.PCCITY = CA.CUSTADDRCITY
				LEFT JOIN RMTCOUNTRYVSPROVINCE CS ON CS.CPPROVINCE = CC.PCPROVINCE
				LEFT JOIN CUSTOMERPHONENUMBERS CM ON CM.PHONECUSTID = CU.CUSTID
				AND CM.PHONETYPECODE = 'MOBILE1' AND CM.PHONETYPEPRIORITY = 5
				LEFT JOIN BANKBRANCHES BB ON BB.BANKBRANCHID = PI.BANKBRANCHID
				LEFT JOIN BMTBANKDETAIL BD ON BD.BANKCODE = BB.BANKCODE
				LEFT JOIN RMTPROVINCEVSCITY	BBRC ON BBRC.PCCITY = BB.CITY
				LEFT JOIN RMTCOUNTRYVSPROVINCE BBRS	ON BBRS.CPPROVINCE = BBRC.PCPROVINCE
				LEFT JOIN BENEFICIARY BR ON BR.BANKBRANCHID = PI.BANKBRANCHID
				AND BR.ACCNUMBER = PI.ACCOUNTNO	AND BR.CUSTID = FM.CUSTID
				LEFT JOIN CUSTOMERS BC ON BC.CUSTID = BR.CUSTID
				LEFT JOIN CUSTOMEREMAILS BCE ON	BCE.CUSTID = CU.CUSTID AND BCE.CUSTEMAILPRIORITY = 5
				LEFT JOIN CUSTOMERADDRESSES BRCA ON BRCA.CUSTID = BR.CUSTID	AND	BRCA.CUSTADDRPRIORITY = 5
				LEFT JOIN RMTPROVINCEVSCITY BRC	ON BRC.PCCITY = BRCA.CUSTADDRCITY
				LEFT JOIN RMTCOUNTRYVSPROVINCE BRS ON BRS.CPPROVINCE = BRC.PCPROVINCE
				LEFT JOIN RMTFINANCETYPES RFT ON FM.FINTYPE = RFT.FINTYPE
				LEFT JOIN SMTDIVISIONDETAIL SMD	ON RFT.FINDIVISION = SMD.DIVISIONCODE
				WHERE PI.STATUS = 'APPROVED'
				AND NOT
				(PI.PAYMENTINSTRUCTIONID IN
				( SELECT DISBURSEMENT_REQUESTS.DISBURSEMENT_ID FROM
				DISBURSEMENT_REQUESTS
				))
				UNION ALL
				SELECT PI.ID PAYMENTID,
				VR.PRIMARYLINKREF FINREFERENCE,
				'I' CHANNEL,
				PI.PROVIDERID,
				CASE
				WHEN
				PI.PAYMENTTYPE = 'NEFT'
				THEN 'N'
				WHEN PI.PAYMENTTYPE = 'RTGS'
				THEN 'R'
				WHEN PI.PAYMENTTYPE = 'DD'
				THEN 'D'
				WHEN
				PI.PAYMENTTYPE = 'CHEQUE'
				THEN 'C'
				ELSE PI.PAYMENTTYPE
				END DISBURSEMENT_TYPE,
				PI.PAYMENTAMOUNT  AMTTOBERELEASED,
				PI.PAYMENTDATE DISBDATE,
				PI.PAYMENTDATE LLDATE,
				'' PAYABLELOC,
				'' PRINTINGLOC,
				'' CUSTCIF,
				'' CUSTSHRTNAME,
				'' CUSTOMER_MOBILE,
				'' CUSTOMER_EMAIL,
				'' CUSTOMER_STATE,
				'' CUSTOMER_CITY,
				'' CUSTOMER_ADDRESS1,
				'' CUSTOMER_ADDRESS2,
				'' CUSTOMER_ADDRESS3,
				'' CUSTOMER_ADDRESS4,
				'' CUSTOMER_ADDRESS5,
				BD.BANKNAME,
				BB.BRANCHCODE,
				BB.BRANCHDESC,
				BBRS.CPPROVINCENAME BENFICIARY_BRANCH_STATE,
				BBRC.PCCITYNAME BENFICIARY_BRANCH_CITY,
				BB.MICR MICR_CODE,
				BB.IFSC IFSC_CODE,
				VPA.ACCOUNTNUMBER BENEFICIARYACCNO,
				AVD.DEALERNAME BENEFICIARYNAME,
				AVD.DEALERTELEPHONE
				BENEFICIARY_MOBILE,
				AVD.EMAIL BENFICIRY_EMAIL,
				BRS.CPPROVINCENAME BENFICIARY_STATE,
				BRC.PCCITYNAME BENFICIARY_CITY,
				AVD.DEALERADDRESS1 BENFICIARY_ADDRESS1,
				AVD.DEALERADDRESS2 BENFICIARY_ADDRESS2,
				AVD.DEALERADDRESS3 BENFICIARY_ADDRESS3,
				'' BENFICIARY_ADDRESS4,
				'' BENFICIARY_ADDRESS5,
				'' PAYMENT_DETAIL1,
				'' PAYMENT_DETAIL2,
				'' PAYMENT_DETAIL3,
				'' PAYMENT_DETAIL4,
				'' PAYMENT_DETAIL5,
				'' PAYMENT_DETAIL6,
				'' PAYMENT_DETAIL7,
				PI.STATUS,
				PI.REMARKS,
				PI.PAYMENTTYPE,
				'' FINTYPE,
				PB.PARTNERBANKID PARTNERBANK_ID,
				PB.PARTNERBANKCODE PARTNERBANK_CODE,
				PI.PAYMENTDATE INPUTDATE,
				PB.ALWFILEDOWNLOAD,
				PB.FILENAME,
				1 FINISACTIVE,
				PI.ENTITYCODE,
				0 HOLDDISBURSEMENT,
				PB.ACCOUNTNO PARTNERBANK_ACCOUNT
				FROM INSURANCEPAYMENTINSTRUCTIONS PI
				JOIN RMTCURRENCIES CCY ON CCY.CCYCODE = PI.PAYMENTCCY
				JOIN PARTNERBANKS PB ON	PB.PARTNERBANKID = PI.PARTNERBANKID
				JOIN VASPROVIDERACCDETAIL VPA ON VPA.PROVIDERID = PI.PROVIDERID
				JOIN AMTVEHICLEDEALER AVD ON AVD.DEALERID = VPA.PROVIDERID
				JOIN VASRECORDING VR ON VR.PAYMENTINSID = PI.ID
				LEFT JOIN BANKBRANCHES BB ON BB.BANKBRANCHID = VPA.BANKBRANCHID
				LEFT JOIN BMTBANKDETAIL BD ON BD.BANKCODE = BB.BANKCODE
				LEFT JOIN RMTPROVINCEVSCITY BBRC ON BBRC.PCCITY	= BB.CITY
				LEFT JOIN RMTCOUNTRYVSPROVINCE BBRS	ON BBRS.CPPROVINCE = BBRC.PCPROVINCE
				LEFT JOIN RMTPROVINCEVSCITY BRC	ON BRC.PCCITY =	AVD.DEALERCITY
				LEFT JOIN RMTCOUNTRYVSPROVINCE BRS ON BRS.CPPROVINCE = BRC.PCPROVINCE
				WHERE PI.STATUS = 'APPROVED' AND PI.PAYMENTAMOUNT > 0
				AND NOT (PI.ID IN( SELECT DISBURSEMENT_REQUESTS.DISBURSEMENT_ID FROM DISBURSEMENT_REQUESTS))
						]]>
		</createView>
	</changeSet>

	<changeSet id="23_post" author="satyanarayana.g" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'int_disbursement_request_view');
			]]>
		</sql>
	</changeSet>

	<changeSet id="24" author="saikumar">
		<sql>
			<![CDATA[
				 UPDATE SECRIGHTS SET RIGHTTYPE=3 WHERE RIGHTNAME='FinAdvancePaymentsDialog_holdDisbIsActive' AND PAGE='FinAdvancePaymentsDialog';
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#482.1" author="Gopal.p">
		<renameTable newTableName="batch_process_status_bkp" oldTableName="batch_process_status" />
	</changeSet>

	<changeSet id="ST#482.2" author="Gopal.p">
		<createTable tableName="BATCH_PROCESS_STATUS">
			<column name="Id" type="bigint" autoIncrement="true">
				<constraints nullable="false" />
			</column>
			<column name="Name" type="varchar(100)">
				<constraints nullable="false" />
			</column>
			<column name="Status" type="char(1)">
				<constraints nullable="false" />
			</column>
			<column name="RunningStatus" type="smallint" />
			<column name="FileName" type="varchar(100)" />
			<column name="Reference" type="varchar(100)" />
			<column name="ValueDate" type="datetime" />
			<column name="TotalRecords" type="int">
				<constraints nullable="false" />
			</column>
			<column name="ProcessedRecords" type="int">
				<constraints nullable="false" />
			</column>
			<column name="SuccessRecords" type="int">
				<constraints nullable="false" />
			</column>
			<column name="FailedRecords" type="int">
				<constraints nullable="false" />
			</column>
			<column name="StartTime" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="EndTime" type="datetime" />
			<column name="Remarks" type="varchar(2000)" />
		</createTable>
	</changeSet>

	<changeSet id="ST#482.3" author="Gopal.p">
		<addPrimaryKey columnNames="Id" constraintName="PK_BATCH_PROCESS_STATUS_ID" tableName="BATCH_PROCESS_STATUS" />
	</changeSet>

	<changeSet id="ST#482.4" author="Gopal.p" dbms="postgresql, oracle">
		<addDefaultValue columnName="RunningStatus" tableName="BATCH_PROCESS_STATUS" defaultValue="1" />
		<addDefaultValue columnName="TotalRecords" tableName="BATCH_PROCESS_STATUS" defaultValue="0" />
		<addDefaultValue columnName="ProcessedRecords" tableName="BATCH_PROCESS_STATUS" defaultValue="0" />
		<addDefaultValue columnName="SuccessRecords" tableName="BATCH_PROCESS_STATUS" defaultValue="0" />
		<addDefaultValue columnName="FailedRecords" tableName="BATCH_PROCESS_STATUS" defaultValue="0" />
	</changeSet>

	<changeSet id="ST#482.5" author="Gopal.p" dbms="mssql">
		<sql>
			<![CDATA[
				ALTER TABLE BATCH_PROCESS_STATUS add constraint DF_BATCH_PROCESS_STATUS_RS default 1 for RunningStatus;
				ALTER TABLE BATCH_PROCESS_STATUS add constraint DF_BATCH_PROCESS_STATUS_TR default 0 for TotalRecords;
				ALTER TABLE	BATCH_PROCESS_STATUS add constraint DF_BATCH_PROCESS_STATUS_PR default 0 for ProcessedRecords;
				ALTER TABLE BATCH_PROCESS_STATUS add constraint DF_BATCH_PROCESS_STATUS_SR default 0 for SuccessRecords;
				ALTER TABLE BATCH_PROCESS_STATUS add constraint DF_BATCH_PROCESS_STATUS_FR default 0 for FailedRecords;
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#482.6" author="Gopal.p">
		<sql>
			<![CDATA[
				INSERT INTO BATCH_PROCESS_STATUS (NAME, STATUS, STARTTIME, ENDTIME, REMARKS, RUNNINGSTATUS) SELECT BATCHNAME, STATUS, STARTTIME, ENDTIME, REMARKS, 0 FROM BATCH_PROCESS_STATUS_BKP;
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#235.1" author="Gopal.p">
		<addColumn tableName="EODCONFIG">
			<column name="AutoEodRequired" type="smallint" />
			<column name="EODStartJobFrequency" type="varchar(100)" />
			<column name="EnableAutoEod" type="smallint" />
			<column name="EODAutoDisable" type="smallint" />
			<column name="SendEmailRequired" type="smallint" />
			<column name="SMTPHost" type="varchar(100)" />
			<column name="SMTPPort" type="varchar(10)" />
			<column name="SMTPAutenticationRequired" type="smallint" />
			<column name="SMTPUserName" type="varchar(100)" />
			<column name="SMTPPwd" type="varchar(500)" />
			<column name="EncryptionType" type="varchar(20)" />
			<column name="FromEmailAddress" type="varchar(100)" />
			<column name="FromName" type="varchar(100)" />
			<column name="ToEmailAddress" type="varchar(1000)" />
			<column name="CCEmailAddress" type="varchar(1000)" />
		</addColumn>
	</changeSet>

	<changeSet id="ST#235.2" author="Gopal.p">
		<addColumn tableName="EODCONFIG_TEMP">
			<column name="AutoEodRequired" type="smallint" />
			<column name="EODStartJobFrequency" type="varchar(100)" />
			<column name="EnableAutoEod" type="smallint" />
			<column name="EODAutoDisable" type="smallint" />
			<column name="SendEmailRequired" type="smallint" />
			<column name="SMTPHost" type="varchar(100)" />
			<column name="SMTPPort" type="varchar(10)" />
			<column name="SMTPAutenticationRequired" type="smallint" />
			<column name="SMTPUserName" type="varchar(100)" />
			<column name="SMTPPwd" type="varchar(500)" />
			<column name="EncryptionType" type="varchar(20)" />
			<column name="FromEmailAddress" type="varchar(100)" />
			<column name="FromName" type="varchar(100)" />
			<column name="ToEmailAddress" type="varchar(1000)" />
			<column name="CCEmailAddress" type="varchar(1000)" />
		</addColumn>
	</changeSet>

	<changeSet id="ST#235.3" author="Gopal.p" dbms="mssql">
		<sql>
			<![CDATA[	
				ALTER TABLE EODCONFIG ADD CONSTRAINT DF_EODCONFIG_AUTOEOD DEFAULT 0 FOR autoEodRequired;
				ALTER TABLE EODCONFIG_TEMP ADD CONSTRAINT DF_EODCONFIG_TEMP_AUTOEOD DEFAULT 0 FOR autoEodRequired;
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#235.4" author="Gopal.p" dbms="postgresql, oracle">
		<addDefaultValue columnName="autoEodRequired" tableName="EODCONFIG" defaultValue="0" />
		<addDefaultValue columnName="autoEodRequired" tableName="EODCONFIG_TEMP" defaultValue="0" />
	</changeSet>

	<changeSet id="ST#235.5_pre" author="Gopal.p" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'eodconfig_view');
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#235.5" author="Gopal.p">
		<createView viewName="EODCONFIG_VIEW" replaceIfExists="true">
			<![CDATA[
				SELECT T1.EODCONFIGID,
						T1.EXTMNTHREQUIRED,
						T1.MNTHEXTTO,
						T1.ACTIVE,
						T1.INEXTMNTH,
						T1.PRVEXTMNTH,
						T1.VERSION,
						T1.LASTMNTBY,
						T1.LASTMNTON,
						T1.RECORDSTATUS,
						T1.ROLECODE,
						T1.NEXTROLECODE,
						T1.TASKID,
						T1.NEXTTASKID,
						T1.RECORDTYPE,
						T1.WORKFLOWID,
						T1.AUTOEODREQUIRED,
						T1.EODSTARTJOBFREQUENCY,
						T1.ENABLEAUTOEOD,
						T1.EODAutoDisable,
						T1.SENDEMAILREQUIRED,
						T1.SMTPHOST,
						T1.SMTPPORT,
						T1.SMTPAUTENTICATIONREQUIRED,
						T1.SMTPUSERNAME,
						T1.SMTPPWD,
						T1.ENCRYPTIONTYPE,
						T1.FROMEMAILADDRESS,
						T1.FROMNAME,
						T1.TOEMAILADDRESS,
						T1.CCEMAILADDRESS
					FROM EODCONFIG_TEMP T1
					UNION ALL
				SELECT T1.EODCONFIGID,
						T1.EXTMNTHREQUIRED,
						T1.MNTHEXTTO,
						T1.ACTIVE,
						T1.INEXTMNTH,
						T1.PRVEXTMNTH,
						T1.VERSION,
						T1.LASTMNTBY,
						T1.LASTMNTON,
						T1.RECORDSTATUS,
						T1.ROLECODE,
						T1.NEXTROLECODE,
						T1.TASKID,
						T1.NEXTTASKID,
						T1.RECORDTYPE,
						T1.WORKFLOWID,
						T1.AUTOEODREQUIRED,
						T1.EODSTARTJOBFREQUENCY,
						T1.ENABLEAUTOEOD,
						T1.EODAutoDisable,
						T1.SENDEMAILREQUIRED,
						T1.SMTPHOST,
						T1.SMTPPORT,
						T1.SMTPAUTENTICATIONREQUIRED,
						T1.SMTPUSERNAME,
						T1.SMTPPWD,
						T1.ENCRYPTIONTYPE,
						T1.FROMEMAILADDRESS,
						T1.FROMNAME,
						T1.TOEMAILADDRESS,
						T1.CCEMAILADDRESS
					FROM EODCONFIG T1
					WHERE NOT (EXISTS ( SELECT 1
					FROM EODCONFIG_TEMP
					WHERE EODCONFIG_TEMP.EODCONFIGID = T1.EODCONFIGID))
			]]>
		</createView>
	</changeSet>

	<changeSet id="ST#235.5_post" author="Gopal.p" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'eodconfig_view');
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#235.6_pre" author="Gopal.p" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'eodconfig_aview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#235.6" author="Gopal.p">
		<createView viewName="EODCONFIG_AVIEW" replaceIfExists="true">
			<![CDATA[
				SELECT T1.EODCONFIGID,
						T1.EXTMNTHREQUIRED,
						T1.MNTHEXTTO,
						T1.ACTIVE,
						T1.INEXTMNTH,
						T1.PRVEXTMNTH,
						T1.VERSION,
						T1.LASTMNTBY,
						T1.LASTMNTON,
						T1.RECORDSTATUS,
						T1.ROLECODE,
						T1.NEXTROLECODE,
						T1.TASKID,
						T1.NEXTTASKID,
						T1.RECORDTYPE,
						T1.WORKFLOWID,
						T1.AUTOEODREQUIRED,
						T1.EODSTARTJOBFREQUENCY,
						T1.ENABLEAUTOEOD,
						T1.EODAutoDisable,
						T1.SENDEMAILREQUIRED,
						T1.SMTPHOST,
						T1.SMTPPORT,
						T1.SMTPAUTENTICATIONREQUIRED,
						T1.SMTPUSERNAME,
						T1.SMTPPWD,
						T1.ENCRYPTIONTYPE,
						T1.FROMEMAILADDRESS,
						T1.FROMNAME,
						T1.TOEMAILADDRESS,
						T1.CCEMAILADDRESS
					FROM EODCONFIG T1
			]]>
		</createView>
	</changeSet>

	<changeSet id="ST#235.6_post" author="Gopal.p" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'eodconfig_aview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#235.7" author="Gopal.p">
		<createIndex tableName="BATCH_PROCESS_STATUS" indexName="IDX_BATCH_PROCESS_STATUS_NAME">
			<column name="Name" type="varchar(100)" />
		</createIndex>
	</changeSet>

	<changeSet id="ST#235.3.1" author="Gopal.p" dbms="mssql">
		<sql>
			<![CDATA[	
				UPDATE EODCONFIG set autoEodRequired = 0, enableAutoEod = 0, sendEmailRequired = 0, sMTPAutenticationRequired = 0;
				UPDATE EODCONFIG_TEMP set autoEodRequired = 0, enableAutoEod = 0, sendEmailRequired = 0, sMTPAutenticationRequired = 0;
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#235.3.2" author="Gopal.p" dbms="mssql">
		<sql>
			<![CDATA[	
				ALTER TABLE EODCONFIG ADD CONSTRAINT DF_EODCONFIG_enableAutoEod DEFAULT 0 FOR enableAutoEod;
				ALTER TABLE EODCONFIG ADD CONSTRAINT DF_EODCONFIG_sendEmailRequired DEFAULT 0 FOR sendEmailRequired;
				ALTER TABLE EODCONFIG ADD CONSTRAINT DF_EODCONFIG_sMTPAutentctnRqrd DEFAULT 0 FOR sMTPAutenticationRequired;
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#235.3.3" author="Gopal.p" dbms="mssql">
		<sql>
			<![CDATA[	
				ALTER TABLE EODCONFIG_TEMP ADD CONSTRAINT DF_EODCONFIG_T_enableAutoEod DEFAULT 0 FOR enableAutoEod;
				ALTER TABLE EODCONFIG_TEMP ADD CONSTRAINT DF_EODCONFIG_T_sendEmailRequrd DEFAULT 0 FOR sendEmailRequired;
				ALTER TABLE EODCONFIG_TEMP ADD CONSTRAINT DF_EODCNFG_T_sMTPAutentctnRqrd DEFAULT 0 FOR sMTPAutenticationRequired;
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#235.4.1" author="Gopal.p" dbms="postgresql, oracle">
		<addDefaultValue columnName="enableAutoEod" tableName="EODCONFIG" defaultValue="0" />
		<addDefaultValue columnName="sendEmailRequired" tableName="EODCONFIG" defaultValue="0" />
		<addDefaultValue columnName="sMTPAutenticationRequired" tableName="EODCONFIG" defaultValue="0" />
	</changeSet>

	<changeSet id="ST#235.4.2" author="Gopal.p" dbms="postgresql, oracle">
		<addDefaultValue columnName="enableAutoEod" tableName="EODCONFIG_TEMP" defaultValue="0" />
		<addDefaultValue columnName="sendEmailRequired" tableName="EODCONFIG_TEMP" defaultValue="0" />
		<addDefaultValue columnName="sMTPAutenticationRequired" tableName="EODCONFIG_TEMP" defaultValue="0" />
	</changeSet>

	<changeSet id="ST#714.01" author="thirupathi.m">
		<sql>
			<![CDATA[	
				DELETE FROM DATA_ENGINE_LOG WHERE ID IN (SELECT ID FROM DATA_ENGINE_STATUS WHERE NAME ='NEWCOVENANTS_UPLOADBY_REFERENCE');
				DELETE FROM DATA_ENGINE_DOWNLOAD_HISTORY WHERE ID IN (SELECT ID FROM DATA_ENGINE_STATUS WHERE NAME ='NEWCOVENANTS_UPLOADBY_REFERENCE');
				DELETE FROM DATA_ENGINE_STATUS WHERE NAME ='NEWCOVENANTS_UPLOADBY_REFERENCE';
				DELETE FROM DATA_ENGINE_COLUMN where TABLEID IN (select ID from DATA_ENGINE_TABLE WHERE CONFIGID = (select ID from DATA_ENGINE_CONFIG where Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE'));
				DELETE FROM DATA_ENGINE_TABLE where CONFIGID IN (select ID from DATA_ENGINE_CONFIG where Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE');
				DELETE FROM DATA_ENGINE_CONFIG where Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE';
													
				Insert into DATA_ENGINE_CONFIG  values ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_CONFIG),'NEWCOVENANTS_UPLOADBY_REFERENCE', ' New Fin Covenant',12,'Covenants',null,null,null,0,1, null,null, null,'C','/opt/Covenant/data', 'FinCovenant_','.xls',0, current_timestamp,null,null,'0',null,1,1);
				Insert into DATA_ENGINE_TABLE values ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_TABLE),(Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE'),'COVENANTS',1,'ID',null, null,null,null,null,null,null,6,0,0);
				INSERT INTO DATA_ENGINE_COLUMN  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'COVENANTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE')), 'Catagory', 0, 'N', NULL, NULL, NULL, NULL, '0', NULL, NULL, NULL, NULL, 'M');
				INSERT INTO DATA_ENGINE_COLUMN  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'COVENANTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE')), 'CovenantType', 0, 'N', NULL, NULL, NULL, NULL, '1', NULL, NULL, NULL, NULL, 'M');
				INSERT INTO DATA_ENGINE_COLUMN  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'COVENANTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE')), 'Description', 0, 'N', NULL, NULL, NULL, NULL, '2', NULL, NULL, NULL, NULL, 'O');	
				INSERT INTO DATA_ENGINE_COLUMN  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'COVENANTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE')), 'MandatoryRole', 0, 'N', NULL, NULL, NULL, NULL, '3', NULL, NULL, NULL, NULL, 'O');	
				INSERT INTO DATA_ENGINE_COLUMN  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'COVENANTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE')), 'AlwWaiver', 0, 'N', NULL, NULL, NULL, NULL, '4', NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'COVENANTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE')), 'AlwPostpone', 0, 'N', NULL, NULL, NULL, NULL, '5', NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'COVENANTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE')), 'ReceivableDate', 0, 'N', NULL, NULL, NULL, NULL, '6', NULL, NULL, NULL, 'yyyy-MM-dd', 'O');
				INSERT INTO DATA_ENGINE_COLUMN  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'COVENANTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE')), 'AlwOtc', 0, 'N', NULL, NULL, NULL, NULL, '7', NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'COVENANTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE')), 'IsInternal', 0, 'N', NULL, NULL, NULL, NULL, '8', NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'COVENANTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE')), 'DocumentReceived', 0, 'N', NULL, NULL, NULL, NULL, '9', NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'COVENANTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE')), 'Frequency', 0, 'N', NULL, NULL, NULL, NULL, '10', NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'COVENANTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE')), 'AlertsRequired', 0, 'N', NULL, NULL, NULL, NULL, '11', NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'COVENANTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE')), 'AlertType', 0, 'N', NULL, NULL, NULL, NULL, '12', NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'COVENANTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE')), 'AlertRoles', 0, 'N', NULL, NULL, NULL, NULL, '13', NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'COVENANTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE')), 'Gracedays', 0, 'N', NULL, NULL, NULL, NULL, '14', NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'COVENANTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE')), 'AlertDays', 0, 'N', NULL, NULL, NULL, NULL, '15', NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'COVENANTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE')), 'Remarks', 0, 'N', NULL, NULL, NULL, NULL, '16', NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'COVENANTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE')), 'AdditionaliField2', 0, 'N', NULL, NULL, NULL, NULL, '17', NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'COVENANTS' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'NEWCOVENANTS_UPLOADBY_REFERENCE')), 'AdditionaliField3', 0, 'N', NULL, NULL, NULL, NULL, '18', NULL, NULL, NULL, NULL, 'O');
									
				UPDATE SEQ_DATA_ENGINE_CONFIG SET SeqNo=(Select coalesce(MAX(ID), 1) FROM DATA_ENGINE_CONFIG);
				UPDATE SEQ_DATA_ENGINE_TABLE  SET SeqNo=(Select coalesce(MAX(ID), 1) FROM DATA_ENGINE_TABLE);
				UPDATE SEQ_DATA_ENGINE_COLUMN SET SeqNo=(Select coalesce(MAX(ID), 1) FROM DATA_ENGINE_COLUMN);
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#235.5.0" author="Gopalswamy.M">
		<addColumn tableName="EODCONFIG">
			<column name="EmailNotifReqrd" type="smallint" />
		</addColumn>
	</changeSet>

	<changeSet id="ST#235.5.1" author="Gopalswamy.M">
		<addColumn tableName="EODCONFIG">
			<column name="PublishNotifReqrd" type="smallint" />
		</addColumn>
	</changeSet>

	<changeSet id="ST#235.5.2" author="Gopalswamy.M">
		<addColumn tableName="EODCONFIG">
			<column name="ReminderFrequency" type="varchar(100)" />
		</addColumn>
	</changeSet>

	<changeSet id="ST#235.5.3" author="Gopalswamy.M">
		<addColumn tableName="EODCONFIG">
			<column name="DelayNotifyReq" type="smallint" />
		</addColumn>
	</changeSet>

	<changeSet id="ST#235.5.4" author="Gopalswamy.M">
		<addColumn tableName="EODCONFIG">
			<column name="DelayFrequency" type="varchar(100)" />
		</addColumn>
	</changeSet>

	<changeSet id="ST#235.5.5" author="Gopalswamy.M">
		<addColumn tableName="EODCONFIG">
			<column name="BroadCastNotifyType" type="varchar(10)" />
		</addColumn>
	</changeSet>

	<changeSet id="ST#235.5.6" author="Gopalswamy.M">
		<addColumn tableName="EODCONFIG">
			<column name="BroadCastNotifier" type="varchar(1000)" />
		</addColumn>
	</changeSet>


	<changeSet id="ST#235.6.0" author="Gopalswamy.M">
		<addColumn tableName="EODCONFIG_TEMP">
			<column name="EmailNotifReqrd" type="smallint" />
		</addColumn>
	</changeSet>

	<changeSet id="ST#235.6.1" author="Gopalswamy.M">
		<addColumn tableName="EODCONFIG_TEMP">
			<column name="PublishNotifReqrd" type="smallint" />
		</addColumn>
	</changeSet>

	<changeSet id="ST#235.6.2" author="Gopalswamy.M">
		<addColumn tableName="EODCONFIG_TEMP">
			<column name="ReminderFrequency" type="varchar(100)" />
		</addColumn>
	</changeSet>

	<changeSet id="ST#235.6.3" author="Gopalswamy.M">
		<addColumn tableName="EODCONFIG_TEMP">
			<column name="DelayNotifyReq" type="smallint" />
		</addColumn>
	</changeSet>

	<changeSet id="ST#235.6.4" author="Gopalswamy.M">
		<addColumn tableName="EODCONFIG_TEMP">
			<column name="DelayFrequency" type="varchar(100)" />
		</addColumn>
	</changeSet>

	<changeSet id="ST#235.6.5" author="Gopalswamy.M">
		<addColumn tableName="EODCONFIG_TEMP">
			<column name="BroadCastNotifyType" type="varchar(10)" />
		</addColumn>
	</changeSet>

	<changeSet id="ST#235.6.6" author="Gopalswamy.M">
		<addColumn tableName="EODCONFIG_TEMP">
			<column name="BroadCastNotifier" type="varchar(1000)" />
		</addColumn>
	</changeSet>

	<changeSet id="ST#235.7" author="Gopalswamy.M" dbms="mssql">
		<sql>
			<![CDATA[	
				UPDATE EODCONFIG set emailNotifReqrd = 0, publishNotifReqrd = 0, delayNotifyReq = 0;
				UPDATE EODCONFIG_TEMP set emailNotifReqrd = 0, publishNotifReqrd = 0, delayNotifyReq = 0;
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#235.8" author="Gopalswamy.M" dbms="postgresql, oracle">
		<addDefaultValue columnName="emailNotifReqrd" tableName="EODCONFIG" defaultValue="0" />
		<addDefaultValue columnName="publishNotifReqrd" tableName="EODCONFIG" defaultValue="0" />
		<addDefaultValue columnName="delayNotifyReq" tableName="EODCONFIG" defaultValue="0" />
	</changeSet>

	<changeSet id="ST#235.9" author="Gopalswamy.M" dbms="postgresql, oracle">
		<addDefaultValue columnName="emailNotifReqrd" tableName="EODCONFIG_TEMP" defaultValue="0" />
		<addDefaultValue columnName="publishNotifReqrd" tableName="EODCONFIG_TEMP" defaultValue="0" />
		<addDefaultValue columnName="delayNotifyReq" tableName="EODCONFIG_TEMP" defaultValue="0" />
	</changeSet>

	<changeSet id="ST#235.10" author="Gopalswamy.M" dbms="mssql">
		<sql>
			<![CDATA[	
				ALTER TABLE EODCONFIG ADD CONSTRAINT DF_EODCONFIG_emailNotifReqrd DEFAULT 0 FOR emailNotifReqrd;
				ALTER TABLE EODCONFIG ADD CONSTRAINT DF_EODCONFIG_publishNotifReqrd DEFAULT 0 FOR publishNotifReqrd;
				ALTER TABLE EODCONFIG ADD CONSTRAINT DF_EODCONFIG_delayNotifyReq DEFAULT 0 FOR delayNotifyReq;
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#235.11" author="Gopalswamy.M" dbms="mssql">
		<sql>
			<![CDATA[	
				ALTER TABLE EODCONFIG_TEMP ADD CONSTRAINT DF_EODCONFIG_T_emailNotifReqrd DEFAULT 0 FOR emailNotifReqrd;
				ALTER TABLE EODCONFIG_TEMP ADD CONSTRAINT DF_EODCONFIG_T_publishNotifRqd DEFAULT 0 FOR publishNotifReqrd;
				ALTER TABLE EODCONFIG_TEMP ADD CONSTRAINT DF_EODCONFIG_T_delayNotifyReq DEFAULT 0 FOR delayNotifyReq;
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#235.12_pre" author="Gopalswamy.M" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'eodconfig_view');
			]]>
		</sql>
	</changeSet>


	<changeSet id="ST#235.12_pre" author="Gopalswamy.M" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'eodconfig_view');
			]]>
		</sql>
	</changeSet>


	<changeSet id="ST#235.12" author="Gopalswamy.M">
		<createView viewName="EODCONFIG_VIEW" replaceIfExists="true">
			<![CDATA[
				SELECT T1.EODCONFIGID,
						T1.EXTMNTHREQUIRED,
						T1.MNTHEXTTO,
						T1.ACTIVE,
						T1.INEXTMNTH,
						T1.PRVEXTMNTH,
						T1.VERSION,
						T1.LASTMNTBY,
						T1.LASTMNTON,
						T1.RECORDSTATUS,
						T1.ROLECODE,
						T1.NEXTROLECODE,
						T1.TASKID,
						T1.NEXTTASKID,
						T1.RECORDTYPE,
						T1.WORKFLOWID,
						T1.AUTOEODREQUIRED,
						T1.EODSTARTJOBFREQUENCY,
						T1.ENABLEAUTOEOD,
						T1.EODAutoDisable,
						T1.SENDEMAILREQUIRED,
						T1.SMTPHOST,
						T1.SMTPPORT,
						T1.SMTPAUTENTICATIONREQUIRED,
						T1.SMTPUSERNAME,
						T1.SMTPPWD,
						T1.ENCRYPTIONTYPE,
						T1.FROMEMAILADDRESS,
						T1.FROMNAME,
						T1.TOEMAILADDRESS,
						T1.CCEMAILADDRESS,
						T1.EMAILNOTIFREQRD,
						T1.PUBLISHNOTIFREQRD,
						T1.REMINDERFREQUENCY,
						T1.DELAYNOTIFYREQ,
						T1.DELAYFREQUENCY,
						T1.BROADCASTNOTIFYTYPE,
						T1.BROADCASTNOTIFIER
					FROM EODCONFIG_TEMP T1
					UNION ALL
				SELECT T1.EODCONFIGID,
						T1.EXTMNTHREQUIRED,
						T1.MNTHEXTTO,
						T1.ACTIVE,
						T1.INEXTMNTH,
						T1.PRVEXTMNTH,
						T1.VERSION,
						T1.LASTMNTBY,
						T1.LASTMNTON,
						T1.RECORDSTATUS,
						T1.ROLECODE,
						T1.NEXTROLECODE,
						T1.TASKID,
						T1.NEXTTASKID,
						T1.RECORDTYPE,
						T1.WORKFLOWID,
						T1.AUTOEODREQUIRED,
						T1.EODSTARTJOBFREQUENCY,
						T1.ENABLEAUTOEOD,
						T1.EODAutoDisable,
						T1.SENDEMAILREQUIRED,
						T1.SMTPHOST,
						T1.SMTPPORT,
						T1.SMTPAUTENTICATIONREQUIRED,
						T1.SMTPUSERNAME,
						T1.SMTPPWD,
						T1.ENCRYPTIONTYPE,
						T1.FROMEMAILADDRESS,
						T1.FROMNAME,
						T1.TOEMAILADDRESS,
						T1.CCEMAILADDRESS,
						T1.EMAILNOTIFREQRD,
						T1.PUBLISHNOTIFREQRD,
						T1.REMINDERFREQUENCY,
						T1.DELAYNOTIFYREQ,
						T1.DELAYFREQUENCY,
						T1.BROADCASTNOTIFYTYPE,
						T1.BROADCASTNOTIFIER
					FROM EODCONFIG T1
					WHERE NOT (EXISTS ( SELECT 1
					FROM EODCONFIG_TEMP
					WHERE EODCONFIG_TEMP.EODCONFIGID = T1.EODCONFIGID))
			]]>
		</createView>
	</changeSet>

	<changeSet id="ST#235.12_post" author="Gopalswamy.M" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'eodconfig_view');
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#235.13_pre" author="Gopalswamy.M" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'eodconfig_aview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#235.13" author="Gopalswamy.M">
		<createView viewName="EODCONFIG_AVIEW" replaceIfExists="true">
			<![CDATA[
				SELECT T1.EODCONFIGID,
						T1.EXTMNTHREQUIRED,
						T1.MNTHEXTTO,
						T1.ACTIVE,
						T1.INEXTMNTH,
						T1.PRVEXTMNTH,
						T1.VERSION,
						T1.LASTMNTBY,
						T1.LASTMNTON,
						T1.RECORDSTATUS,
						T1.ROLECODE,
						T1.NEXTROLECODE,
						T1.TASKID,
						T1.NEXTTASKID,
						T1.RECORDTYPE,
						T1.WORKFLOWID,
						T1.AUTOEODREQUIRED,
						T1.EODSTARTJOBFREQUENCY,
						T1.ENABLEAUTOEOD,
						T1.EODAutoDisable,
						T1.SENDEMAILREQUIRED,
						T1.SMTPHOST,
						T1.SMTPPORT,
						T1.SMTPAUTENTICATIONREQUIRED,
						T1.SMTPUSERNAME,
						T1.SMTPPWD,
						T1.ENCRYPTIONTYPE,
						T1.FROMEMAILADDRESS,
						T1.FROMNAME,
						T1.TOEMAILADDRESS,
						T1.CCEMAILADDRESS,
						T1.EMAILNOTIFREQRD,
						T1.PUBLISHNOTIFREQRD,
						T1.REMINDERFREQUENCY,
						T1.DELAYNOTIFYREQ,
						T1.DELAYFREQUENCY,
						T1.BROADCASTNOTIFYTYPE,
						T1.BROADCASTNOTIFIER
					FROM EODCONFIG T1
			]]>
		</createView>
	</changeSet>

	<changeSet id="ST#235.13_post" author="Gopalswamy.M" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'eodconfig_aview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#912" author="murthy.y">
		<sql>
			<![CDATA[
				DELETE 	FROM BMTAMOUNTCODES WHERE ALLOWEDEVENT='EXPENSE';
				DELETE 	FROM BMTAEEVENTS WHERE AEEVENTCODE='EXPENSE';
				
				DELETE 	FROM BMTAEEVENTS WHERE AEEVENTCODE='INDAS'; 
 
				INSERT INTO BMTAEEVENTS(AEEVENTCODE, AEEVENTCODEDESC, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID, ACTIVE) VALUES ('EXPENSE', 'Accounting on Expense Upload', 1, 1000, CURRENT_TIMESTAMP, 'APPROVED', NULL, NULL, NULL, NULL, NULL, 0, 1);
				INSERT INTO BMTAMOUNTCODES (ALLOWEDEVENT, ALLOWEDRIA, AMOUNTCODE, AMOUNTCODEDESC, AMOUNTCODEISACTIVE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES ('EXPENSE', 0, 'ae_expense', 'EXPENSES', 1, 1, 1005, CURRENT_TIMESTAMP, 'APPROVED', NULL, NULL, NULL, NULL, NULL, 0);
				
				INSERT INTO BMTAEEVENTS(AEEVENTCODE, AEEVENTCODEDESC, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID, ACTIVE) VALUES ('INDAS', 'Accounting on Amortization Process on Month END', 1, 1000, CURRENT_TIMESTAMP, 'APPROVED', NULL, NULL, NULL, NULL, NULL, 0, 1);
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#912.1" author="murthy.y">
		<sql>
			<![CDATA[
				delete  from CategoryWiseEvents where AeEventCode='EXPENSE' and CategoryCode ='C';
				delete  from CategoryWiseEvents where AeEventCode='EXPENSE' and CategoryCode ='F';
				delete  from CategoryWiseEvents where AeEventCode='EXPENSE' and CategoryCode ='O';
				delete  from CategoryWiseEvents where AeEventCode='EXPENSE' and CategoryCode ='S';

				INSERT INTO CategoryWiseEvents (AEEventCode, CategoryCode, Active, Mandatory, SeqOrder) VALUES ('EXPENSE', 'C', 1, 0, (select max(SeqOrder)+1 from CategoryWiseEvents));
				INSERT INTO CategoryWiseEvents (AEEventCode, CategoryCode, Active, Mandatory, SeqOrder) VALUES ('EXPENSE', 'F', 1, 0, (select max(SeqOrder)+2 from CategoryWiseEvents));
				INSERT INTO CategoryWiseEvents (AEEventCode, CategoryCode, Active, Mandatory, SeqOrder) VALUES ('EXPENSE', 'O', 1, 0, (select max(SeqOrder)+3 from CategoryWiseEvents));
				INSERT INTO CategoryWiseEvents (AEEventCode, CategoryCode, Active, Mandatory, SeqOrder) VALUES ('EXPENSE', 'S', 1, 0, (select max(SeqOrder)+4 from CategoryWiseEvents));
				
				delete  from CategoryWiseEvents where AeEventCode='INDAS' and CategoryCode ='C';
				delete  from CategoryWiseEvents where AeEventCode='INDAS' and CategoryCode ='F';
				delete  from CategoryWiseEvents where AeEventCode='INDAS' and CategoryCode ='O';
				delete  from CategoryWiseEvents where AeEventCode='INDAS' and CategoryCode ='S';

				INSERT INTO CategoryWiseEvents (AEEventCode, CategoryCode, Active, Mandatory, SeqOrder) VALUES ('INDAS', 'C', 1, 0, (select max(SeqOrder)+1 from CategoryWiseEvents));
				INSERT INTO CategoryWiseEvents (AEEventCode, CategoryCode, Active, Mandatory, SeqOrder) VALUES ('INDAS', 'F', 1, 0, (select max(SeqOrder)+2 from CategoryWiseEvents));
				INSERT INTO CategoryWiseEvents (AEEventCode, CategoryCode, Active, Mandatory, SeqOrder) VALUES ('INDAS', 'O', 1, 0, (select max(SeqOrder)+3 from CategoryWiseEvents));
				INSERT INTO CategoryWiseEvents (AEEventCode, CategoryCode, Active, Mandatory, SeqOrder) VALUES ('INDAS', 'S', 1, 0, (select max(SeqOrder)+4 from CategoryWiseEvents));
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#714" author="thirupathi.m" dbms="postgresql">
		<sql>
			<![CDATA[
				update data_engine_column set RuleForValue = 'if((DocumentReceived == '''')){Result = 0;  return;} else {Result = DocumentReceived;  return;}' where name = 'DocumentReceived' and tableid in (select id from data_engine_table where configid in (select id from data_engine_config where name = 'NEWCOVENANTS_UPLOADBY_REFERENCE'));
			]]>
		</sql>
	</changeSet>

	<changeSet author="Sai Varun.R" id="DE#874.1">
		<addUniqueConstraint columnNames="FieldCode,FieldCodeValue" constraintName="uk_rmtlovfielddetail"
			tableName="RMTLOVFIELDDETAIL" />
	</changeSet>

	<changeSet author="Sai Varun.R" id="DE#874.2">
		<addUniqueConstraint columnNames="FieldCode,FieldCodeValue" constraintName="uk_rmtlovfielddetail_temp"
			tableName="RMTLOVFIELDDETAIL_TEMP" />
	</changeSet>

	<changeSet id="ST#235.15" author="Gopal.p">
		<sql>
    <![CDATA[
        Insert into SMTPARAMETERS (SYSPARMCODE, SYSPARMDESC, SYSPARMTYPE, SYSPARMMAINT, SYSPARMVALUE, SYSPARMLENGTH, SYSPARMDEC, SYSPARMLIST, SYSPARMVALDMOD, SYSPARMDESCRIPTION, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) values ('EOD_START_ON_SAMEDAY', 'Allow eod only next business date and system date matched', 'String', 1, 'N', 1, 0, null, null, 'Allow eod only next business date and system date matched', 1, 1000, current_timestamp, 'Approved', null, null, null, null, null, 0);
        Insert into SMTPARAMETERS (SYSPARMCODE, SYSPARMDESC, SYSPARMTYPE, SYSPARMMAINT, SYSPARMVALUE, SYSPARMLENGTH, SYSPARMDEC, SYSPARMLIST, SYSPARMVALDMOD, SYSPARMDESCRIPTION, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) values ('ALLOW_MULITIPLE_EODS_ON_SAMEDAY', 'This parameter should be N for production', 'String', 1, 'N', 1, 0, null, null, 'This parameter should be N for production', 1, 1000, current_timestamp, 'Approved', null, null, null, null, null, 0);
     ]]>
		</sql>
	</changeSet>

</databaseChangeLog>