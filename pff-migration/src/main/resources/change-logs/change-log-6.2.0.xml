<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value="" dbms="oracle" />
	<property name="add.schema" value="" dbms="postgresql" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PLFAVANSEQC.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()" dbms="postgresql" />

	<changeSet id="pre_run_for_pgp" author="nagavamsi.p" runAlways="true" dbms="postgresql">
		<sql>
			Set search_path = plf,public,pg_catalog;
		</sql>
	</changeSet>

	<changeSet id="ST#93" author="nagavamsi.p">
		<addColumn tableName="AccountMapping_Temp">
			<column name="OpenedDate" type="datetime" />
			<column name="ClosedDate" type="datetime" />
			<column name="Status" type="varchar(8)" />
			<column name="AllowedManualEntry" type="Char(1)" />
			<column name="CreatedBy" type="bigint" />
			<column name="CreatedOn" type="datetime" />
			<column name="ApprovedBy" type="bigint" />
			<column name="ApprovedOn" type="datetime" />
		</addColumn>
	</changeSet>

	<changeSet id="ST#93.1" author="nagavamsi.p">
		<sql>
			<![CDATA[  
				UPDATE ACCOUNTMAPPING_TEMP SET OPENEDDATE = (SELECT CAST(SYSPARMVALUE AS DATE) FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE');
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#93.1.1" author="nagavamsi.p">
		<addNotNullConstraint tableName="AccountMapping_Temp" columnName="OpenedDate"
			columnDataType="datetime" />
	</changeSet>

	<changeSet id="ST#93.1.2" author="nagavamsi.p">
		<sql>
			<![CDATA[  
				UPDATE ACCOUNTMAPPING_TEMP SET STATUS = 'O';
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#93.1.3" author="nagavamsi.p">
		<addNotNullConstraint tableName="AccountMapping_Temp" columnName="Status"
			columnDataType="varchar(8)" />
	</changeSet>

	<changeSet id="ST#93.1.4" author="nagavamsi.p">
		<sql>
			<![CDATA[  
				UPDATE ACCOUNTMAPPING_TEMP SET ALLOWEDMANUALENTRY = 'B';
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#93.1.5" author="nagavamsi.p">
		<addNotNullConstraint tableName="AccountMapping_Temp" columnName="AllowedManualEntry"
			columnDataType="Char(1)" />
	</changeSet>

	<changeSet id="ST#93.1.6" author="nagavamsi.p">
		<sql>
			<![CDATA[  
				UPDATE ACCOUNTMAPPING_TEMP SET CREATEDBY = LASTMNTBY WHERE CREATEDBY IS NULL;
				UPDATE ACCOUNTMAPPING_TEMP SET CREATEDON = LASTMNTON WHERE CREATEDON IS NULL;
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#93.1.7" author="nagavamsi.p">
		<addNotNullConstraint tableName="AccountMapping_Temp" columnName="CreatedBy"
			columnDataType="bigint" />
	</changeSet>

	<changeSet id="ST#93.1.8" author="nagavamsi.p">
		<addNotNullConstraint tableName="AccountMapping_Temp" columnName="CreatedOn"
			columnDataType="datetime" />
	</changeSet>

	<changeSet id="ST#93.2" author="nagavamsi.p">
		<addColumn tableName="AccountMapping">
			<column name="OpenedDate" type="datetime" />
			<column name="ClosedDate" type="datetime" />
			<column name="Status" type="varchar(8)" />
			<column name="AllowedManualEntry" type="Char(1)" />
			<column name="CreatedBy" type="bigint" />
			<column name="CreatedOn" type="datetime" />
			<column name="ApprovedBy" type="bigint" />
			<column name="ApprovedOn" type="datetime" />
		</addColumn>
	</changeSet>

	<changeSet id="ST#93.2.1" author="nagavamsi.p">
		<sql>
			<![CDATA[  
				UPDATE ACCOUNTMAPPING SET OPENEDDATE = (SELECT CAST(SYSPARMVALUE DATE) FROM SMTPARAMETERS WHERE SYSPARMCODE='APP_DATE');
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#93.2.2" author="nagavamsi.p">
		<addNotNullConstraint tableName="AccountMapping" columnName="OpenedDate"
			columnDataType="datetime" />
	</changeSet>

	<changeSet id="ST#93.2.3" author="nagavamsi.p">
		<sql>
			<![CDATA[  
				UPDATE ACCOUNTMAPPING SET STATUS = 'O';
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#93.2.4" author="nagavamsi.p">
		<addNotNullConstraint tableName="AccountMapping" columnName="Status" columnDataType="varchar(8)" />
	</changeSet>

	<changeSet id="ST#93.2.5" author="nagavamsi.p">
		<sql>
		<![CDATA[  
			UPDATE ACCOUNTMAPPING SET ALLOWEDMANUALENTRY  = 'B';
		]]>
		</sql>
	</changeSet>

	<changeSet id="ST#93.2.6" author="nagavamsi.p">
		<addNotNullConstraint tableName="AccountMapping" columnName="AllowedManualEntry"
			columnDataType="Char(1)" />
	</changeSet>

	<changeSet id="ST#93.2.7" author="nagavamsi.p">
		<sql>
			<![CDATA[  
				UPDATE ACCOUNTMAPPING SET CREATEDBY = LASTMNTBY WHERE CREATEDBY IS NULL;
				UPDATE ACCOUNTMAPPING SET CREATEDON = LASTMNTON WHERE CREATEDON IS NULL;
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#93.2.8" author="nagavamsi.p">
		<addNotNullConstraint tableName="AccountMapping" columnName="CreatedBy" columnDataType="bigint" />
	</changeSet>

	<changeSet id="ST#93.2.9" author="nagavamsi.p">
		<addNotNullConstraint tableName="AccountMapping" columnName="CreatedOn" columnDataType="datetime" />
	</changeSet>

	<changeSet id="ST#93.3.1_pre" author="nagavamsi.p" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'accountmapping_view');
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#93.3.1" author="nagavamsi.p">
		<createView replaceIfExists="true" viewName="ACCOUNTMAPPING_VIEW">
			<![CDATA[
				SELECT AM.ACCOUNT
					, AM.HOSTACCOUNT
					, AM.PROFITCENTERID
					, AM.COSTCENTERID
					, AM.FINTYPE
					, AM.ACCOUNTTYPE 
                    , PC.PROFITCENTERCODE
                    , PC.PROFITCENTERDESC	
                    , CC.COSTCENTERCODE	
                    , CC.COSTCENTERDESC	
                    , RAT.ACTYPEDESC ACCOUNTTYPEDESC	
                    , RFT.FINTYPEDESC
                    , AM.OPENEDDATE
                    , AM.CLOSEDDATE					
					, AM.STATUS 
					, AM.ALLOWEDMANUALENTRY
					, AM.VERSION
					, AM.CREATEDBY
					, AM.CREATEDON                                                                           
					, AM.APPROVEDBY
					, AM.APPROVEDON 
					, AM.LASTMNTBY 
					, AM.LASTMNTON 
					, AM.RECORDSTATUS 
					, AM.ROLECODE 
					, AM.NEXTROLECODE 
					, AM.TASKID 
					, AM.NEXTTASKID 
					, AM.RECORDTYPE 
					, AM.WORKFLOWID
				FROM ACCOUNTMAPPING_TEMP AM
				LEFT JOIN PROFITCENTERS PC ON PC.PROFITCENTERID = AM.PROFITCENTERID
				LEFT JOIN COSTCENTERS CC ON CC.COSTCENTERID = AM.COSTCENTERID
				LEFT JOIN RMTACCOUNTTYPES RAT ON RAT.ACTYPE = AM.ACCOUNTTYPE
				LEFT JOIN RMTFINANCETYPES RFT ON RFT.FINTYPE = AM.FINTYPE
				UNION ALL
				SELECT AM.ACCOUNT
					, AM.HOSTACCOUNT
					, AM.PROFITCENTERID
					, AM.COSTCENTERID
					, AM.FINTYPE
					, AM.ACCOUNTTYPE 
                    , PC.PROFITCENTERCODE
                    , PC.PROFITCENTERDESC	
                    , CC.COSTCENTERCODE	
                    , CC.COSTCENTERDESC	
                    , RAT.ACTYPEDESC ACCOUNTTYPEDESC	
                    , RFT.FINTYPEDESC
                    , AM.OPENEDDATE
                    , AM.CLOSEDDATE					
					, AM.STATUS 
					, AM.ALLOWEDMANUALENTRY
					, AM.VERSION
					, AM.CREATEDBY
					, AM.CREATEDON                                                                           
					, AM.APPROVEDBY
					, AM.APPROVEDON 
					, AM.LASTMNTBY 
					, AM.LASTMNTON 
					, AM.RECORDSTATUS 
					, AM.ROLECODE 
					, AM.NEXTROLECODE 
					, AM.TASKID 
					, AM.NEXTTASKID 
					, AM.RECORDTYPE 
					, AM.WORKFLOWID
				FROM ACCOUNTMAPPING  AM
				LEFT JOIN PROFITCENTERS PC ON PC.PROFITCENTERID = AM.PROFITCENTERID   
				LEFT JOIN COSTCENTERS CC ON CC.COSTCENTERID = AM.COSTCENTERID 
				LEFT JOIN RMTACCOUNTTYPES RAT ON RAT.ACTYPE = AM.ACCOUNTTYPE  
				LEFT JOIN RMTFINANCETYPES RFT ON RFT.FINTYPE = AM.FINTYPE
        	 	WHERE NOT EXISTS (SELECT 1 FROM ACCOUNTMAPPING_TEMP WHERE ACCOUNT = AM.ACCOUNT)
			]]>
		</createView>
	</changeSet>

	<changeSet id="ST#93.3.1_post" author="nagavamsi.p" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'accountmapping_view');
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#93.4.1_pre" author="nagavamsi.p" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'accountmapping_aview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#93.4.1" author="nagavamsi.p">
		<createView replaceIfExists="true" viewName="ACCOUNTMAPPING_AVIEW">
			<![CDATA[
				SELECT AM.ACCOUNT
					, AM.HOSTACCOUNT
					, AM.PROFITCENTERID
					, AM.COSTCENTERID
					, AM.FINTYPE
					, AM.ACCOUNTTYPE 
                    , PC.PROFITCENTERCODE
                    , PC.PROFITCENTERDESC	
                    , CC.COSTCENTERCODE	
                    , CC.COSTCENTERDESC	
                    , RAT.ACTYPEDESC ACCOUNTTYPEDESC	
                    , RFT.FINTYPEDESC
                    , AM.OPENEDDATE
                    , AM.CLOSEDDATE					
					, AM.STATUS 
					, AM.ALLOWEDMANUALENTRY
					, AM.VERSION
					, AM.CREATEDBY
					, AM.CREATEDON                                                                           
					, AM.APPROVEDBY
					, AM.APPROVEDON 
					, AM.LASTMNTBY 
					, AM.LASTMNTON 
					, AM.RECORDSTATUS 
					, AM.ROLECODE 
					, AM.NEXTROLECODE 
					, AM.TASKID 
					, AM.NEXTTASKID 
					, AM.RECORDTYPE 
					, AM.WORKFLOWID
				FROM ACCOUNTMAPPING AM   
				LEFT OUTER JOIN PROFITCENTERS PC ON  PC.PROFITCENTERID = AM.PROFITCENTERID   
				LEFT OUTER JOIN COSTCENTERS CC ON  CC.COSTCENTERID = AM.COSTCENTERID 
				LEFT OUTER JOIN RMTACCOUNTTYPES RAT ON  RAT.ACTYPE = AM.ACCOUNTTYPE  
				LEFT OUTER JOIN RMTFINANCETYPES RFT ON RFT.FINTYPE = AM.FINTYPE
			]]>
		</createView>
	</changeSet>

	<changeSet id="ST#93.4.1_post" author="nagavamsi.p" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'accountmapping_aview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#93.5" author="nagavamsi.p">
		<sql>
			<![CDATA[
			    DELETE FROM SECGROUPRIGHTS WHERE RIGHTID = (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'AccountMappingDialog_AllowedManualEntry');
			    DELETE FROM SECGROUPRIGHTS WHERE RIGHTID = (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'AccountMappingDialog_OpenedDate');
			    DELETE FROM SECGROUPRIGHTS WHERE RIGHTID = (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'AccountMappingDialog_ClosedDate');
			    DELETE FROM SECGROUPRIGHTS WHERE RIGHTID = (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'AccountMappingDialog_Status');
			    
				DELETE FROM SECRIGHTS WHERE RIGHTNAME = 'AccountMappingDialog_AllowedManualEntry';
				DELETE FROM SECRIGHTS WHERE RIGHTNAME = 'AccountMappingDialog_OpenedDate';
				DELETE FROM SECRIGHTS WHERE RIGHTNAME = 'AccountMappingDialog_ClosedDate';
				DELETE FROM SECRIGHTS WHERE RIGHTNAME = 'AccountMappingDialog_Status';
				
				INSERT INTO SECRIGHTS (RIGHTID, RIGHTTYPE, RIGHTNAME, PAGE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES ((SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'AccountMappingDialog_AllowedManualEntry', 'AccountMappingDialog', 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				INSERT INTO SECRIGHTS (RIGHTID, RIGHTTYPE, RIGHTNAME, PAGE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES ((SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'AccountMappingDialog_OpenedDate', 'AccountMappingDialog', 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				INSERT INTO SECRIGHTS (RIGHTID, RIGHTTYPE, RIGHTNAME, PAGE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES ((SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'AccountMappingDialog_ClosedDate', 'AccountMappingDialog', 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				INSERT INTO SECRIGHTS (RIGHTID, RIGHTTYPE, RIGHTNAME, PAGE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES ((SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'AccountMappingDialog_Status', 'AccountMappingDialog', 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);

				INSERT INTO SECGROUPRIGHTS (RIGHTID, RIGHTTYPE, RIGHTNAME, PAGE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES ((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'ACCOUNTMAPPING_MAKER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'AccountMappingDialog_AllowedManualEntry'), 1, 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				INSERT INTO SECGROUPRIGHTS (RIGHTID, RIGHTTYPE, RIGHTNAME, PAGE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES ((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'ACCOUNTMAPPING_MAKER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'AccountMappingDialog_OpenedDate'), 1, 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				INSERT INTO SECGROUPRIGHTS (RIGHTID, RIGHTTYPE, RIGHTNAME, PAGE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES ((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'ACCOUNTMAPPING_MAKER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'AccountMappingDialog_ClosedDate'), 1, 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				INSERT INTO SECGROUPRIGHTS (RIGHTID, RIGHTTYPE, RIGHTNAME, PAGE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES ((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'ACCOUNTMAPPING_MAKER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'AccountMappingDialog_Status'), 1, 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
			]]>
		</sql>
	</changeSet>

	<!-- ================ FEETYPES MAIN =================== -->
	<changeSet id="ST#103" author="vasudevarao.s">
		<addColumn tableName="FEETYPES">
			<column name="PayableLinkTo" type="varchar(30)" />
			<column name="RecvFeeTypeId" type="bigint" />
		</addColumn>
	</changeSet>

	<changeSet id="ST#103.01" author="vasudevarao.s">
		<sql>
			<![CDATA[	
				UPDATE FEETYPES SET RECVFEETYPEID = 0;
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#103.02" author="vasudevarao.s" dbms="mssql">
		<sql>
			<![CDATA[	
				ALTER TABLE FEETYPES ADD CONSTRAINT DF_FT_RECVFEETYPEID DEFAULT 0 FOR RECVFEETYPEID;
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#103.03" author="vasudevarao.s" dbms="postgresql, oracle">
		<addDefaultValue columnName="RecvFeeTypeId" tableName="FeeTypes" defaultValue="0" />
	</changeSet>

	<!-- ================ FEETYPES TEMP =================== -->

	<changeSet id="ST#103.04" author="vasudevarao.s">
		<addColumn tableName="FEETYPES_TEMP">
			<column name="PayableLinkTo" type="varchar(30)" />
			<column name="RecvFeeTypeId" type="Bigint" />
		</addColumn>
	</changeSet>

	<changeSet id="ST#103.01.01" author="vasudevarao.s">
		<sql>
			<![CDATA[	
				UPDATE FEETYPES_TEMP SET RECVFEETYPEID = 0;
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#103.05" author="vasudevarao.s" dbms="mssql">
		<sql>
			<![CDATA[	
				ALTER TABLE FEETYPES_TEMP ADD CONSTRAINT DF_FT_T_RECVFEETYPEID DEFAULT 0 FOR RECVFEETYPEID;
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#103.06" author="vasudevarao.s" dbms="postgresql, oracle">
		<addDefaultValue columnName="RecvFeeTypeId" tableName="FEETYPES_TEMP" defaultValue="0" />
	</changeSet>

	<!-- ================ FEETYPES AVIEW =================== -->

	<changeSet id="ST#103.08_pre" author="vasudevarao.s" dbms="postgresql">
		<sql>
		<![CDATA[
			select deps_save_and_drop_dependencies ('plf', 'feetypes_aview');
		]]>
		</sql>
	</changeSet>

	<changeSet id="ST#103.08" author="vasudevarao.s">
		<createView viewName="FEETYPES_AVIEW" replaceIfExists="true">
			<![CDATA[
				SELECT T1.FEETYPEID
					, T1.FEETYPECODE
					, T1.FEETYPEDESC
					, T1.MANUALADVICE
					, T1.REFUNDABLE
					, T1.ADVISETYPE
					, T1.ACCOUNTSETID
					, T1.HOSTFEETYPECODE
					, T1.TAXAPPLICABLE
					, T1.TAXCOMPONENT
					, T1.ACTIVE
					, T1.VERSION
					, T1.LASTMNTBY
					, T1.LASTMNTON
					, T1.RECORDSTATUS
					, T1.ROLECODE
					, T1.NEXTROLECODE
					, T1.TASKID
					, T1.NEXTTASKID
					, T1.RECORDTYPE
					, T1.WORKFLOWID
					, T2.ACCOUNTSETCODE
					, T2.ACCOUNTSETCODENAME
					, T1.AMORTZREQ
					, T1.DUEACCREQ
					, T1.DUEACCSET
	        		, T3.ACCOUNTSETCODE DUEACCTSETCODE
					, T3.ACCOUNTSETCODENAME DUEACCTSETCODENAME
					, T1.TDSREQ
					, T1.FEEINCOMEOREXPENSE 
		    		, T1.ACTYPE 
		    		, T4.ACTYPEDESC
					, T1.PAYABLELINKTO
					, T1.RECVFEETYPEID
				FROM FEETYPES T1
				LEFT JOIN RMTACCOUNTINGSET T2 ON T2.ACCOUNTSETID = T1.ACCOUNTSETID
          		LEFT JOIN RMTACCOUNTINGSET T3 ON T3.ACCOUNTSETID = T1.DUEACCSET
          		LEFT JOIN RMTACCOUNTTYPES T4 ON T4.ACTYPE = T1.ACTYPE
			]]>
    	</createView>
	</changeSet>

	<changeSet id="ST#103.08_post" author="vasudevarao.s" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'feetypes_aview');
			]]>
		</sql>
	</changeSet>

	<!-- ================ FEETYPES TVIEW =================== -->

	<changeSet id="ST#103.09_pre" author="vasudevarao.s" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'feetypes_tview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#103.09" author="vasudevarao.s">
		<createView viewName="FEETYPES_TVIEW" replaceIfExists="true">
			<![CDATA[
				SELECT T1.FEETYPEID
					, T1.FEETYPECODE
					, T1.FEETYPEDESC
					, T1.MANUALADVICE
					, T1.REFUNDABLE
					, T1.ADVISETYPE
					, T1.ACCOUNTSETID
					, T1.HOSTFEETYPECODE
					, T1.TAXAPPLICABLE
					, T1.TAXCOMPONENT
					, T1.ACTIVE
					, T1.VERSION
					, T1.LASTMNTBY
					, T1.LASTMNTON
					, T1.RECORDSTATUS
					, T1.ROLECODE
					, T1.NEXTROLECODE
					, T1.TASKID
					, T1.NEXTTASKID
					, T1.RECORDTYPE
					, T1.WORKFLOWID
					, T2.ACCOUNTSETCODE
					, T2.ACCOUNTSETCODENAME
					, T1.AMORTZREQ
					, T1.DUEACCREQ
					, T1.DUEACCSET
	        		, T3.ACCOUNTSETCODE DUEACCTSETCODE
					, T3.ACCOUNTSETCODENAME DUEACCTSETCODENAME
					, T1.TDSREQ
					, T1.FEEINCOMEOREXPENSE 
		    		, T1.ACTYPE 
		    		, T4.ACTYPEDESC
					, T1.PAYABLELINKTO
					, T1.RECVFEETYPEID
				FROM FEETYPES_TEMP T1
				LEFT JOIN RMTACCOUNTINGSET T2 ON T2.ACCOUNTSETID = T1.ACCOUNTSETID
           		LEFT JOIN RMTACCOUNTINGSET T3 ON T3.ACCOUNTSETID = T1.DUEACCSET
           		LEFT JOIN RMTACCOUNTTYPES T4 ON T4.ACTYPE = T1.ACTYPE
			]]>
   		</createView>
	</changeSet>

	<changeSet id="ST#103.09_post" author="vasudevarao.s" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'feetypes_tview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#103.10" author="vasudevarao.s">
		<sql>
			<![CDATA[
				DELETE FROM SECGROUPRIGHTS WHERE GRPID = (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'FEETYPE_MAKER') AND RIGHTID = (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'FeeTypeDialog_PayableLinkTo');
				DELETE FROM SECGROUPRIGHTS WHERE GRPID = (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'FEETYPE_MAKER') AND RIGHTID = (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'FeeTypeDialog_ReceivableType');

				DELETE FROM SECRIGHTS WHERE RightName = 'FeeTypeDialog_AdviseCategory';
				DELETE FROM SECRIGHTS WHERE RightName = 'FeeTypeDialog_ReceivableType';

				INSERT INTO SECRIGHTS (RIGHTID, RIGHTTYPE, RIGHTNAME, PAGE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES ((SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'FeeTypeDialog_PayableLinkTo','FeeTypeDialog', 0, 1000, CURRENT_TIMESTAMP, 'Approved', null, null, null, null, null, 0);
				INSERT INTO SECRIGHTS (RIGHTID, RIGHTTYPE, RIGHTNAME, PAGE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES ((SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'FeeTypeDialog_ReceivableType','FeeTypeDialog', 0, 1000, CURRENT_TIMESTAMP, 'Approved', null, null, null, null, null, 0);

				INSERT INTO SECGROUPRIGHTS (GRPRIGHTID, GRPID, RIGHTID, ACCESSTYPE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES ((SELECT MAX(GRPRIGHTID) + 1 FROM SECGROUPRIGHTS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'FEETYPE_MAKER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'FeeTypeDialog_PayableLinkTo'),  1, 1, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				INSERT INTO SECGROUPRIGHTS (GRPRIGHTID, GRPID, RIGHTID, ACCESSTYPE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES ((SELECT MAX(GRPRIGHTID) + 1 FROM SECGROUPRIGHTS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'FEETYPE_MAKER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'FeeTypeDialog_ReceivableType'), 1, 1, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
	 		]]>
		</sql>
	</changeSet>

	<changeSet id="ST#103.11_pre" author="vasudevarao.s" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'feetypes_view');
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#103.11" author="vasudevarao.s">
		<createView viewName="FEETYPES_VIEW" replaceIfExists="true">
			<![CDATA[
				SELECT T1.FEETYPEID
					, T1.FEETYPECODE
					, T1.FEETYPEDESC
					, T1.MANUALADVICE
					, T1.REFUNDABLE
					, T1.ADVISETYPE
					, T1.ACCOUNTSETID
					, T1.HOSTFEETYPECODE
					, T1.TAXAPPLICABLE
					, T1.TAXCOMPONENT
					, T1.ACTIVE
					, T1.VERSION
					, T1.LASTMNTBY
					, T1.LASTMNTON
					, T1.RECORDSTATUS
					, T1.ROLECODE
					, T1.NEXTROLECODE
					, T1.TASKID
					, T1.NEXTTASKID
					, T1.RECORDTYPE
					, T1.WORKFLOWID
					, T2.ACCOUNTSETCODE
					, T2.ACCOUNTSETCODENAME
					, T1.AMORTZREQ
					, T1.DUEACCREQ
					, T1.DUEACCSET
					, T3.ACCOUNTSETCODE DUEACCTSETCODE
					, T3.ACCOUNTSETCODENAME DUEACCTSETCODENAME
					, T1.TDSREQ
					, T1.FEEINCOMEOREXPENSE 
					, T1.ACTYPE 
					, T4.ACTYPEDESC
					, T1.PAYABLELINKTO
					, T1.RECVFEETYPEID
					, T5.FEETYPEDESC RECVFEETYPEDESC
					, T5.FEETYPECODE RECVFEETYPECODE
				FROM FEETYPES_TEMP T1
				LEFT JOIN RMTACCOUNTINGSET T2 ON T2.ACCOUNTSETID = T1.ACCOUNTSETID
				LEFT JOIN RMTACCOUNTINGSET T3 ON T3.ACCOUNTSETID = T1.DUEACCSET
				LEFT JOIN RMTACCOUNTTYPES T4 ON T4.ACTYPE = T1.ACTYPE
				LEFT JOIN FEETYPES T5 ON T5.FEETYPEID = T1.RECVFEETYPEID
				UNION ALL
				SELECT T1.FEETYPEID
					, T1.FEETYPECODE
					, T1.FEETYPEDESC
					, T1.MANUALADVICE
					, T1.REFUNDABLE
					, T1.ADVISETYPE
					, T1.ACCOUNTSETID
					, T1.HOSTFEETYPECODE
					, T1.TAXAPPLICABLE
					, T1.TAXCOMPONENT
					, T1.ACTIVE
					, T1.VERSION
					, T1.LASTMNTBY
					, T1.LASTMNTON
					, T1.RECORDSTATUS
					, T1.ROLECODE
					, T1.NEXTROLECODE
					, T1.TASKID
					, T1.NEXTTASKID
					, T1.RECORDTYPE
					, T1.WORKFLOWID
					, T2.ACCOUNTSETCODE
					, T2.ACCOUNTSETCODENAME
					, T1.AMORTZREQ
					, T1.DUEACCREQ
					, T1.DUEACCSET
					, T3.ACCOUNTSETCODE DUEACCTSETCODE
					, T3.ACCOUNTSETCODENAME DUEACCTSETCODENAME
					, T1.TDSREQ
					, T1.FEEINCOMEOREXPENSE 
					, T1.ACTYPE 
					, T4.ACTYPEDESC
					, T1.PAYABLELINKTO
					, T1.RECVFEETYPEID
					, T5.FEETYPEDESC RECVFEETYPEDESC
					, T5.FEETYPECODE RECVFEETYPECODE
				FROM FEETYPES T1
				LEFT JOIN RMTACCOUNTINGSET T2 ON T2.ACCOUNTSETID = T1.ACCOUNTSETID
				LEFT JOIN RMTACCOUNTINGSET T3 ON T3.ACCOUNTSETID = T1.DUEACCSET
				LEFT JOIN RMTACCOUNTTYPES T4 ON T4.ACTYPE = T1.ACTYPE
				LEFT JOIN FEETYPES T5 ON T5.FEETYPEID = T1.RECVFEETYPEID
				WHERE NOT (EXISTS (SELECT 1 FROM FEETYPES_TEMP WHERE FEETYPES_TEMP.FEETYPEID = T1.FEETYPEID))
			]]>
    	</createView>
	</changeSet>

	<changeSet id="ST#103.11_post" author="vasudevarao.s" dbms="postgresql">
		<sql>
		<![CDATA[
			select deps_restore_dependencies ('plf', 'feetypes_view');
		]]>
		</sql>
	</changeSet>

	<changeSet id="ST#103.02.01" author="vasudevarao.s">
		<sql>
			<![CDATA[ 
				DELETE FROM ERRORDETAILS WHERE CODE = '90006';
			
				INSERT INTO ERRORDETAILS (CODE, LANGUAGE, SEVERITY, MESSAGE, EXTENDEDMESSAGE, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID,NEXTTASKID, RECORDTYPE, WORKFLOWID, LASTMNTON, LASTMNTBY, VERSION) VALUES(90006, 'EN', 'W', 'This combination of data is already exists. Try another.', 'Cannot proceed further', 'Approved', null, null, null, null, null, 0, CURRENT_TIMESTAMP, 1000, 0);
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#103.03.12_pre" author="vasudevarao.s" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'manualadvise_aview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#103.03.12" author="vasudevarao.s">
		<createView viewName="MANUALADVISE_AVIEW" replaceIfExists="true">
			<![CDATA[
	 			SELECT T1.ADVISEID
					, T1.ADVISETYPE
					, FM.FINID
					, FM.FINREFERENCE
					, T1.FEETYPEID
					, T1.SEQUENCE
					, T1.ADVISEAMOUNT
					, T1.PAIDAMOUNT
					, T1.WAIVEDAMOUNT
					, T1.REMARKS
					, T1.VALUEDATE
					, T1.POSTDATE
					, T1.VERSION
					, T1.LASTMNTBY
					, T1.LASTMNTON
					, T1.RECORDSTATUS
					, T1.ROLECODE
					, T1.NEXTROLECODE
					, T1.TASKID
					, T1.NEXTTASKID
					, T1.RECORDTYPE
					, T1.WORKFLOWID
					, T2.FEETYPEDESC
					, T2.FEETYPECODE
					, T1.BOUNCEID
					, T1.RECEIPTID
					, T3.BOUNCECODE
					, T1.RESERVEDAMT
					, T1.BALANCEAMT
					, T3.REASON BOUNCECODEDESC
					, COALESCE(T2.TAXAPPLICABLE, 0) TAXAPPLICABLE
					, COALESCE(T2.TDSREQ, 0) TDSREQ
					, T2.TAXCOMPONENT
					, T1.PAIDCGST
					, T1.PAIDSGST
					, T1.PAIDIGST
					, T1.PAIDUGST
					, T1.WAIVEDCGST
					, T1.WAIVEDSGST
					, T1.WAIVEDUGST
					, T1.WAIVEDIGST
					, T1.WAIVEDCESS
					, T1.PAIDCESS
					, T1.FINSOURCE
					, T1.DUECREATION
					, T1.LINKEDTRANID
					, T1.TDSPAID
					, T1.HOLDDUE
					, T1.PRESENTMENTID
					, T1.STATUS
					, T1.REASON
					, T1.DUEDATE
					, T2.PAYABLELINKTO
				FROM MANUALADVISE T1
				INNER JOIN FINANCEMAIN FM ON FM.FINID = T1.FINID
				LEFT JOIN FEETYPES T2 ON T1.FEETYPEID = T2.FEETYPEID
				LEFT JOIN BOUNCEREASONS T3 ON T1.BOUNCEID = T3.BOUNCEID
			]]>
		</createView>
	</changeSet>

	<changeSet id="ST#103.03.12_post" author="vasudevarao.s" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'manualadvise_aview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#103.04.13_pre" author="vasudevarao.s" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'manualadvise_view');
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#103.04.13" author="vasudevarao.s">
		<createView viewName="MANUALADVISE_VIEW" replaceIfExists="true">
			<![CDATA[
	 			SELECT T1.ADVISEID
					, T1.ADVISETYPE
					, FM.FINID
					, FM.FINREFERENCE
					, T1.FEETYPEID
					, T1.SEQUENCE
					, T1.ADVISEAMOUNT
					, T1.PAIDAMOUNT
					, T1.WAIVEDAMOUNT
					, T1.REMARKS
					, T1.VALUEDATE
					, T1.POSTDATE
					, T1.VERSION
					, T1.LASTMNTBY
					, T1.LASTMNTON
					, T1.RECORDSTATUS
					, T1.ROLECODE
					, T1.NEXTROLECODE
					, T1.TASKID
					, T1.NEXTTASKID
					, T1.RECORDTYPE
					, T1.WORKFLOWID
					, T2.FEETYPEDESC
					, T2.FEETYPECODE
					, T1.BOUNCEID
					, T1.RECEIPTID
					, T3.BOUNCECODE
					, T1.RESERVEDAMT
					, T1.BALANCEAMT
					, T3.REASON BOUNCECODEDESC
					, COALESCE(T2.TAXAPPLICABLE, 0) TAXAPPLICABLE
					, T2.TAXCOMPONENT
					, COALESCE(T2.TDSREQ, 0) TDSREQ
					, T1.PAIDCGST
					, T1.PAIDSGST
					, T1.PAIDIGST
					, T1.PAIDUGST
					, T1.WAIVEDCGST
					, T1.WAIVEDSGST
					, T1.WAIVEDUGST
					, T1.WAIVEDIGST
					, T1.WAIVEDCESS
					, T1.PAIDCESS
					, T1.FINSOURCE
					, T1.DUECREATION
					, T1.LINKEDTRANID
					, T1.TDSPAID
					, T1.HOLDDUE
					, T1.PRESENTMENTID
					, T1.STATUS
					, T1.REASON
					, T1.DUEDATE
					, T2.PAYABLELINKTO
				FROM MANUALADVISE_TEMP T1
				INNER JOIN FINANCEMAIN FM ON FM.FINID = T1.FINID
				LEFT JOIN FEETYPES T2 ON T1.FEETYPEID = T2.FEETYPEID
				LEFT JOIN BOUNCEREASONS T3 ON T1.BOUNCEID = T3.BOUNCEID
				UNION ALL
				SELECT T1.ADVISEID
					, T1.ADVISETYPE
					, FM.FINID
					, FM.FINREFERENCE
					, T1.FEETYPEID
					, T1.SEQUENCE
					, T1.ADVISEAMOUNT
					, T1.PAIDAMOUNT
					, T1.WAIVEDAMOUNT
					, T1.REMARKS
					, T1.VALUEDATE
					, T1.POSTDATE
					, T1.VERSION
					, T1.LASTMNTBY
					, T1.LASTMNTON
					, T1.RECORDSTATUS
					, T1.ROLECODE
					, T1.NEXTROLECODE
					, T1.TASKID
					, T1.NEXTTASKID
					, T1.RECORDTYPE
					, T1.WORKFLOWID
					, T2.FEETYPEDESC
					, T2.FEETYPECODE
					, T1.BOUNCEID
					, T1.RECEIPTID
					, T3.BOUNCECODE
					, T1.RESERVEDAMT
					, T1.BALANCEAMT
					, T3.REASON BOUNCECODEDESC
					, COALESCE(T2.TAXAPPLICABLE, 0) TAXAPPLICABLE
					, T2.TAXCOMPONENT
					, COALESCE(T2.TDSREQ, 0) TDSREQ
					, T1.PAIDCGST
					, T1.PAIDSGST
					, T1.PAIDIGST
					, T1.PAIDUGST
					, T1.WAIVEDCGST
					, T1.WAIVEDSGST
					, T1.WAIVEDUGST
					, T1.WAIVEDIGST
					, T1.WAIVEDCESS
					, T1.PAIDCESS
					, T1.FINSOURCE
					, T1.DUECREATION
					, T1.LINKEDTRANID
					, T1.TDSPAID
					, T1.HOLDDUE
					, T1.PRESENTMENTID
					, T1.STATUS
					, T1.REASON
					, T1.DUEDATE
					, T2.PAYABLELINKTO
				FROM MANUALADVISE T1
				INNER JOIN FINANCEMAIN FM ON FM.FINID = T1.FINID
				LEFT JOIN FEETYPES T2 ON T1.FEETYPEID = T2.FEETYPEID
				LEFT JOIN BOUNCEREASONS T3 ON T1.BOUNCEID = T3.BOUNCEID
				WHERE NOT EXISTS (SELECT 1 FROM MANUALADVISE_TEMP
				WHERE MANUALADVISE_TEMP.ADVISEID = T1.ADVISEID)
			]]>
		</createView>
	</changeSet>

	<changeSet id="ST#103.04.13_post" author="vasudevarao.s" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'manualadvise_view');
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#103.05.14_pre" author="vasudevarao.s" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'manualadvise_tview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="ST#103.05.14" author="vasudevarao.s">
		<createView viewName="MANUALADVISE_TVIEW" replaceIfExists="true">
			<![CDATA[
	 			SELECT T1.ADVISEID
					, T1.ADVISETYPE
					, FM.FINID
					, FM.FINREFERENCE
					, T1.FEETYPEID
					, T1.SEQUENCE
					, T1.ADVISEAMOUNT
					, T1.PAIDAMOUNT
					, T1.WAIVEDAMOUNT
					, T1.REMARKS
					, T1.VALUEDATE
					, T1.POSTDATE
					, T1.VERSION
					, T1.LASTMNTBY
					, T1.LASTMNTON
					, T1.RECORDSTATUS
					, T1.ROLECODE
					, T1.NEXTROLECODE
					, T1.TASKID
					, T1.NEXTTASKID
					, T1.RECORDTYPE
					, T1.WORKFLOWID
					, T2.FEETYPEDESC
					, T2.FEETYPECODE
					, T1.BOUNCEID
					, T1.RECEIPTID
					, T3.BOUNCECODE
					, T1.RESERVEDAMT
					, T1.BALANCEAMT
					, T3.REASON AS BOUNCECODEDESC
					, COALESCE(T2.TAXAPPLICABLE, 0) TAXAPPLICABLE
					, COALESCE(T2.TDSREQ, 0) TDSREQ
					, T2.TAXCOMPONENT
					, T1.PAIDCGST
					, T1.PAIDSGST
					, T1.PAIDIGST
					, T1.PAIDUGST
					, T1.WAIVEDCGST
					, T1.WAIVEDSGST
					, T1.WAIVEDUGST
					, T1.WAIVEDIGST
					, T1.WAIVEDCESS
					, T1.PAIDCESS
					, T1.FINSOURCE
					, T1.DUECREATION
					, T1.LINKEDTRANID
					, T1.TDSPAID
					, T1.HOLDDUE
					, T1.PRESENTMENTID
					, T1.STATUS
					, T1.REASON
					, T1.DUEDATE
					, T2.PAYABLELINKTO
				FROM MANUALADVISE_TEMP T1
				INNER JOIN FINANCEMAIN FM ON FM.FINID = T1.FINID
				LEFT JOIN FEETYPES T2 ON T1.FEETYPEID = T2.FEETYPEID
				LEFT JOIN BOUNCEREASONS T3 ON T1.BOUNCEID = T3.BOUNCEID
			]]>
		</createView>
	</changeSet>

	<changeSet id="ST#103.05.14_post" author="vasudevarao.s" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'manualadvise_tview');
			]]>
		</sql>
	</changeSet>
	
</databaseChangeLog>	