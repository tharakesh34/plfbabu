<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />

	<changeSet id="01" author="Irfan">
		<sql>
			INSERT INTO ErrorDetails VALUES('60204','EN','E','Loan Cannot be Processed
			for Reversal of Payment. Loan is in In-Active
			State.','','Approved','','','','','',0,CURRENT_TIMESTAMP,1000,0);
			INSERT INTO ErrorDetails VALUES('60205','EN','E','Not allowed to
			Reverse the transaction, because of insufficient balance on
			Excess','','Approved','','','','','',0,CURRENT_TIMESTAMP,1000,0);
			INSERT INTO ErrorDetails VALUES('60206','EN','E','Loan was maintained
			after this Repayment
			done.','','Approved','','','','','',0,CURRENT_TIMESTAMP,1000,0);
			INSERT INTO ErrorDetails VALUES('60207','EN','E','Log Entry Details
			are not correct. Please contact
			Adminstrator.','','Approved','','','','','',0,CURRENT_TIMESTAMP,1000,0);
			INSERT INTO ErrorDetails VALUES('60208','EN','E','No Receipt Found to
			Reverse the
			Transaction.','','Approved','','','','','',0,CURRENT_TIMESTAMP,1000,0);
		</sql>
	</changeSet>
	<changeSet id="02" author="manojkumar.p">
		<sql>
			UPDATE DATA_ENGINE_TABLE SET RECORDLENGTH = 16 WHERE ID IN
			(SELECT ID FROM DATA_ENGINE_TABLE WHERE CONFIGID IN (SELECT ID FROM
			DATA_ENGINE_CONFIG WHERE NAME = 'DISB_HDFC_IMPORT'));
			UPDATE
			DATA_ENGINE_TABLE SET RECORDLENGTH = 16 WHERE ID IN (SELECT ID FROM
			DATA_ENGINE_TABLE WHERE CONFIGID IN (SELECT ID FROM
			DATA_ENGINE_CONFIG WHERE NAME = 'DISB_OTHER_IMPORT'));
		</sql>
	</changeSet>
	<changeSet id="03" author="manojkumar.p">
		<sql>
			UPDATE DATA_ENGINE_TABLE SET RECORDLENGTH = 16 WHERE ID IN
			(SELECT ID FROM DATA_ENGINE_TABLE WHERE CONFIGID IN (SELECT ID FROM
			DATA_ENGINE_CONFIG WHERE NAME = 'DISB_HDFC_IMPORT'));
			UPDATE
			DATA_ENGINE_TABLE SET RECORDLENGTH = 3 WHERE ID IN (SELECT ID FROM
			DATA_ENGINE_TABLE WHERE CONFIGID IN (SELECT ID FROM
			DATA_ENGINE_CONFIG WHERE NAME = 'DISB_OTHER_IMPORT'));
		</sql>
	</changeSet>
	<changeSet id="04" author="pruthvi">
		<sql>
			update reportfilterfields set multiselectsearch='0'
			where reportid=(select reportid from reportconfiguration where
			menuitemcode='menu_Item_PaymentSchedule') and fieldid='2';
		</sql>
	</changeSet>

	<changeSet id="05" author="Madhubabu">
		<createView replaceIfExists="true" viewName="PresentmentDownload_View">
			     select EntityCode, MandateType, BankID, SCHDATE, Sum(PresentmentAmt) PresentmentAmt, Count(*) count from (
			select 1 EntityCode, MandateType, SUBSTR(MICR,4,3) BANKID, SCHDATE, PresentmentAmt 
			from PresentmentDetails T1 
			Inner Join Mandates T2 on T1.MandateID = T2.MandateID 
			Inner Join BankBranches T3 on T3.BankBranchID = T2.BankBranchID 
			where ExcludeReason = 0
			) t 
			group BY EntityCode, MandateType, BankID ,SCHDATE
		</createView>
	</changeSet>	
	
	<changeSet id="6" author="Siva">
		<createTable tableName="ManualAdviseMovements_Temp">
			<column name="MovementID" type="bigint">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="AdviseID" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="MovementDate" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="MovementAmount" type="decimal(18,0)">
				<constraints nullable="false" />
			</column>
			<column name="PaidAmount" type="decimal(18,0)">
				<constraints nullable="false" />
			</column>
			<column name="WaivedAmount" type="decimal(18,0)">
				<constraints nullable="false" />
			</column>
			<column name="Status" type="char(1)" />
			<column name="ReceiptID" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="ReceiptSeqID" type="bigint">
				<constraints nullable="false" />
			</column>
		</createTable>
	</changeSet>
	
	<changeSet id="7" author="Siva">
		<sql>
			DELETE FROM ManualAdviseMovements;
		</sql>
	</changeSet>

	<changeSet id="8" author="Siva">
		<addColumn tableName="ManualAdviseMovements">
			<column name="ReceiptID" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="ReceiptSeqID" type="bigint">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>
	<changeSet id="9.1" author="Siva" dbms="oracle">
	<sql>
	drop sequence SeqManualAdviseMovements;
	</sql>
	</changeSet>	
	
<changeSet id="9" author="Siva" dbms="oracle">	
   		<sql splitStatements="false">
     		 begin
              execute immediate 'CREATE SEQUENCE SeqManualAdviseMovements START WITH 1 INCREMENT BY 1 MAXVALUE 9223372036854775807 NOCYCLE';  
     		 end;  
     	 </sql>
 </changeSet>
 
 <changeSet id="10" author="Siva" dbms="postgresql">	
   		<sql splitStatements="false">
   			do $$
			 begin
   execute 'CREATE SEQUENCE SeqManualAdviseMovements START  1 INCREMENT BY 1 ';  
			 end;  
			$$;
	    </sql>
 </changeSet>
 
 	<changeSet id="11" author="Siva" dbms="mssql">
		<sql splitStatements="false">
			CREATE TABLE SeqManualAdviseMovements(
			SeqNo 				bigint IDENTITY(1,1) NOT NULL,
			Value 				int NOT NULL
			);	
		</sql>
	</changeSet>
	
	<changeSet id="12" author="Siva">
		<renameColumn columnDataType="bigint" newColumnName="ReceiptSeqID"
			oldColumnName="ReceiptID" tableName="FinExcessAmountReserve" />
	</changeSet>
	
	<changeSet id="13" author="Siva">
    	<sql>
    	
    		DELETE FROM finrepayinstruction_temp WHERE finreference IN (select FinReference from FinanceMain_Temp WHERE RcdMaintainSts = 'Receipt');
			DELETE FROM findisbursementdetails_temp WHERE finreference IN (select FinReference from FinanceMain_Temp WHERE RcdMaintainSts = 'Receipt');
			DELETE FROM finscheduledetails_temp WHERE finreference IN (select FinReference from FinanceMain_Temp WHERE RcdMaintainSts = 'Receipt');
			DELETE from FinanceMain_Temp WHERE RcdMaintainSts = 'Receipt';

	    	DELETE from FinExcessAmountReserve;
			UPDATE FinExcessAmount SET ReservedAmt = 0, UtilisedAmt = 0, BalanceAmt = Amount;
			DELETE FROM ManualAdviseMovements;
			DELETE FROM ManualAdviseMovements_Temp;
			DELETE FROM FinRepayScheduleDetail_Temp;
			DELETE FROM FinRepayScheduleDetail;
			DELETE FROM FinRepayHeader_Temp;
			DELETE FROM FinRepayHeader;
			DELETE FROM FinReceiptDetail_Temp;
			DELETE FROM FinReceiptDetail;
			DELETE FROM ReceiptAllocationDetail_Temp;
			DELETE FROM ReceiptAllocationDetail;
			DELETE FROM FinReceiptHeader_Temp;
			DELETE FROM FinReceiptHeader;
    	</sql>
	</changeSet>
	
	<changeSet id="14" author="Durgaprasad.g">
		<addColumn tableName="FINSCHEDULEDETAILS">
			<column name="PRESENTMENTID" type="bigint" />
		</addColumn>
	</changeSet>
	
</databaseChangeLog>