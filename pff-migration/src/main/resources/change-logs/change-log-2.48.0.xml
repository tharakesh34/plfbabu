<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />
	
<changeSet id="01" author="Surekha">
	<createTable tableName="SeqRmtAccounttypes">
		<column name="SeqNo" type="bigint" />
	</createTable>
</changeSet>
<changeSet id="02" author="Surekha">
	<sql>
		INSERT INTO SeqRmtAccounttypes VALUES(0);
	</sql>
</changeSet>
<changeSet id="03" author="Surekha">
	<addColumn tableName="RmtAccounttypes">
		<column name="AcTypeGrpId" type="bigint" defaultValueNumeric="0">
			<constraints nullable="false" />
		</column>
	</addColumn>
</changeSet>
<changeSet id="04" author="Surekha">
	<addColumn tableName="RmtAccounttypes_Temp">
		<column name="AcTypeGrpId" type="bigint" defaultValueNumeric="0">
			<constraints nullable="false" />
		</column>
	</addColumn>
</changeSet>
<changeSet id="05" author="Surekha">
	<createView viewName="RMTACCOUNTTYPES_VIEW" replaceIfExists="true">
		SELECT    T1.AcType, T1.AcTypeDesc,  T1.AcPurpose, T1.AcHeadCode, T1.InternalAc, T1.CustSysAc, T1.AcLmtCategory, T1.AcTypeIsActive, T1.Version, T1.LastMntBy, T1.LastMntOn, T1.RecordStatus, T1.RoleCode,
			 T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId,T1.AssertOrLiability,T1.OnBalanceSheet,T1.AllowOverDraw,T1.AcTypeGrpId,T2.GroupCode,T2.GroupDescription,T2.AcctTypeLevel
			 FROM         RMTAccountTypes_Temp T1 Left Join
									AccountTypeGroup T2 ON T1.AcTypeGrpId=T2.GroupId
			 UNION ALL
			SELECT    T1.AcType, T1.AcTypeDesc,  T1.AcPurpose, T1.AcHeadCode, T1.InternalAc, T1.CustSysAc, T1.AcLmtCategory, T1.AcTypeIsActive, T1.Version, T1.LastMntBy, T1.LastMntOn, T1.RecordStatus, T1.RoleCode,
			 T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId,T1.AssertOrLiability,T1.OnBalanceSheet,T1.AllowOverDraw,T1.AcTypeGrpId,T2.GroupCode,T2.GroupDescription,T2.AcctTypeLevel
			 FROM         RMTAccountTypes T1 Left Join
									AccountTypeGroup T2 ON T1.AcTypeGrpId=T2.GroupId
			 WHERE     (NOT EXISTS
			 (SELECT     1 Expr1
			 FROM          RMTAccountTypes_Temp
			 WHERE      (AcType = T1.AcType)))
	</createView>
</changeSet>
<changeSet id="06" author="Surekha">
	<createView viewName="RMTACCOUNTTYPES_AVIEW" replaceIfExists="true">
		SELECT    T1.AcType, T1.AcTypeDesc,  T1.AcPurpose, T1.AcHeadCode, T1.InternalAc, T1.CustSysAc, T1.AcLmtCategory, T1.AcTypeIsActive, T1.Version, T1.LastMntBy, T1.LastMntOn, T1.RecordStatus, T1.RoleCode,
			 T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId,T1.AssertOrLiability,T1.OnBalanceSheet,T1.AllowOverDraw,T1.AcTypeGrpId,T2.GroupCode,T2.GroupDescription,T2.AcctTypeLevel
			 FROM         RMTAccountTypes T1 Left Join
									AccountTypeGroup T2 ON T1.AcTypeGrpId=T2.GroupId
	</createView>
</changeSet>
	<changeSet id="07" author="Surekha">
		<dropTable tableName="SeqRmtAccounttypes"/>
	</changeSet>
<changeSet id="08" author="Irfan">
	<sql>
		Delete from ReportList where Code='PartnerBank';
		INSERT INTO ReportList Values('PartnerBank','PartnerBank','label_PartnerBankDialog_PartnerBankCode.value,label_PartnerBankList_BankCode.value,label_PartnerBankDialog_PartnerBankName.value,label_PartnerBankDialog_BankBranchCode.value,listheader_RecordStatus.label,listheader_RecordType.label','partnerBankCode,partnerBankName,bankCode,bankBranchCode,recordStatus,recordType','String,String,String,String,String,String','','ReportList05','Partner Bank Details','Application Masters',0,1000,CURRENT_TIMESTAMP,'Approved','','','','','',0,0);	
	</sql>
</changeSet>
<changeSet id="09" author="Irfan">
<sql>

	Update SeqSecRights Set SeqNo = (Select MAX(RightID) + 1 from SecRights);
	Update SeqSecGroupRights Set SeqNo = (Select MAX(GrpRightID) + 1 from SecGroupRights);

	INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 2, 'button_PartnerBankDialog_ModeDisbursment','PartnerBankDialog',0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0; 
	INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 2, 'button_PartnerBankDialog_ModePayments','PartnerBankDialog',0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0; 
	INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 2, 'button_PartnerBankDialog_ModeReceipts','PartnerBankDialog',0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0; 

	INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='PARTNERBANK_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='button_PartnerBankDialog_ModeDisbursment'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);																		
	INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='PARTNERBANK_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='button_PartnerBankDialog_ModePayments'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);																		
	INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='PARTNERBANK_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='button_PartnerBankDialog_ModeReceipts'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);

	Update SeqSecRights Set SeqNo = (Select MAX(RightID) + 1 from SecRights);
	Update SeqSecGroupRights Set SeqNo = (Select MAX(GrpRightID) + 1 from SecGroupRights);
</sql>
</changeSet>
<changeSet id="10" author="Subbarao" dbms="oracle">
		<sql>
			 Create table seqFinLogEntryDetail_bk as select * from seqFinLogEntryDetail;
			 DROP table seqFinLogEntryDetail;
		</sql>
</changeSet>
   		<changeSet id="10.1" author="Subbarao" dbms="oracle">	
   		<sql splitStatements="false">
   			 declare ex number;
     		 begin
     		 Select MAX(SeqNo)+1 into ex  from (Select SeqNo from seqFinLogEntryDetail_bk )T;
         	 execute immediate 'CREATE SEQUENCE seqFinLogEntryDetail START WITH ' || ex || ' INCREMENT BY 1 MAXVALUE 9223372036854775807 NOCYCLE';  
     		 end;  
     	</sql>
     	</changeSet>
     	<changeSet id="10.2" author="Subbarao" dbms="oracle">	
   		<sql>	 
     		 DROP table seqFinLogEntryDetail_bk;
		</sql>
		</changeSet>
	
 <changeSet id="11" author="Subbarao" dbms="mssql">
		<sql splitStatements="false">
			
			Select * into seqFinLogEntryDetail_bk  from seqFinLogEntryDetail;
			DROP table seqFinLogEntryDetail;
   			
			Declare @ex bigint;
			Set  @ex = (Select MAX(SeqNo)+1 from (Select SeqNo from seqFinLogEntryDetail_bk)T);
			CREATE TABLE seqFinLogEntryDetail(
			SeqNo 				bigint IDENTITY(1,1) NOT NULL,
			Value 				int NOT NULL
			);	
		
			Exec('DBCC CHECKIDENT(''seqFinLogEntryDetail'', RESEED,'+@ex+' )');
			
			DROP table seqFinLogEntryDetail_bk;
	</sql>
</changeSet>

	<changeSet author="Kesav" id="21">
		<addColumn tableName="FinanceMain">
			<column name="PromotionCode" type="varchar(8)"/>
		</addColumn>
	</changeSet>
	
	<changeSet author="Kesav" id="22">
		<addColumn tableName="FinanceMain_Temp">
			<column name="PromotionCode" type="varchar(8)"/>
		</addColumn>
	</changeSet>
	
	<changeSet author="Kesav" id="23">
		<addColumn tableName="FinanceMain_PA">
			<column name="PromotionCode" type="varchar(8)"/>
		</addColumn>
	</changeSet>

</databaseChangeLog>