<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />
	
	<changeSet id="pre_run_for_pgp" author="Jayant" runAlways="true" dbms="postgresql" >
		<sql>
			Set search_path = plf,public,pg_catalog;
		</sql>	
	</changeSet>
	
	<changeSet id="1" author="Prakash">
     <addColumn tableName="FinJointAccountDetails">
     	<column name="AuthoritySignatory" type="Boolean"/>
     	<column name="Sequence" type="Number(10,0)"/>
     </addColumn>
    </changeSet>
     
     <changeSet id="2" author="Prakash">
     <addColumn tableName="FinJointAccountDetails_Temp">
     	<column name="AuthoritySignatory" type="Boolean"/>
     	<column name="Sequence" type="Number(10,0)"/>
     </addColumn>
     </changeSet>
     
     <changeSet id="3" author="Prakash">
     <createView viewName="finjointaccountdetails_view" replaceIfExists="true">
		     	SELECT t1.jointaccountid,t1.finreference,t1.custcif,t1.includerepay,t1.repayaccountid,t1.CatOfcoApplicant,t1.AuthoritySignatory,t1.Sequence,
		    t1.version,t1.lastmntby,t1.lastmnton,t1.recordstatus,t1.rolecode,t1.nextrolecode,t1.taskid,t1.nexttaskid,
		    t1.recordtype,t1.workflowid,t2.usrlogin,t2.usrfname,t2.usrmname,t2.usrlname,t3.custshrtname AS lovdesccifname,t3.custid
		   FROM finjointaccountdetails_temp t1
		     JOIN secusers t2 ON t1.lastmntby = t2.usrid
		     JOIN customers t3 ON t1.custcif = t3.custcif
		UNION ALL
		 SELECT t1.jointaccountid,t1.finreference,t1.custcif,t1.includerepay,t1.repayaccountid,t1.CatOfcoApplicant,t1.AuthoritySignatory,t1.Sequence,
		    t1.version,t1.lastmntby,t1.lastmnton,t1.recordstatus,t1.rolecode,t1.nextrolecode,t1.taskid,t1.nexttaskid,
		    t1.recordtype,t1.workflowid,t2.usrlogin,t2.usrfname,t2.usrmname,t2.usrlname,t3.custshrtname AS lovdesccifname,t3.custid
		   FROM finjointaccountdetails t1
		     JOIN secusers t2 ON t1.lastmntby = t2.usrid
		     JOIN customers t3 ON t1.custcif = t3.custcif
		  WHERE NOT (EXISTS ( SELECT 1
		           FROM finjointaccountdetails_temp
		          WHERE finjointaccountdetails_temp.jointaccountid = t1.jointaccountid));
     </createView>
     </changeSet>
    
     <changeSet id="4" author="Prakash">
     <createView viewName="finjointaccountdetails_Tview" replaceIfExists="true">
		     	SELECT t1.jointaccountid,t1.finreference,t1.custcif,t1.includerepay,t1.repayaccountid,t1.CatOfcoApplicant,t1.AuthoritySignatory,t1.Sequence,
		    t1.version,t1.lastmntby,t1.lastmnton,t1.recordstatus,t1.rolecode,t1.nextrolecode,t1.taskid,t1.nexttaskid,
		    t1.recordtype,t1.workflowid,t2.usrlogin,t2.usrfname,t2.usrmname,t2.usrlname,t3.custshrtname AS lovdesccifname,t3.custid
		   FROM finjointaccountdetails_temp t1
		     JOIN secusers t2 ON t1.lastmntby = t2.usrid
		     JOIN customers t3 ON t1.custcif = t3.custcif
		
     </createView>
     </changeSet>
     
     <changeSet id="5" author="Prakash">
     <createView viewName="finjointaccountdetails_Aview" replaceIfExists="true">
		     	SELECT t1.jointaccountid,t1.finreference,t1.custcif,t1.includerepay,t1.repayaccountid,t1.CatOfcoApplicant,t1.AuthoritySignatory,t1.Sequence,
		    t1.version,t1.lastmntby,t1.lastmnton,t1.recordstatus,t1.rolecode,t1.nextrolecode,t1.taskid,t1.nexttaskid,
		    t1.recordtype,t1.workflowid,t2.usrlogin,t2.usrfname,t2.usrmname,t2.usrlname,t3.custshrtname AS lovdesccifname,t3.custid
		   FROM finjointaccountdetails t1
		     JOIN secusers t2 ON t1.lastmntby = t2.usrid
		     JOIN customers t3 ON t1.custcif = t3.custcif
		
     </createView>
     </changeSet>
     
     <changeSet id="6" author="Prakash">
     <sql>
     	delete from plf.BMTLovFIELDCODE where fieldcode = 'cofco-app' ;
     </sql>
	</changeSet>

	<changeSet id="7" author="Prakash">
     	<sql>
    	insert into RMTLovFieldDetail values(320,'CAT_COAPP','Husband','Husband',1,1,1000,current_timestamp,'Approved','','','','','',0,0,'');
		insert into RMTLovFieldDetail values(321,'CAT_COAPP','Wife','Wife',1,1,1000,current_timestamp,'Approved','','','','','',0,0,'');
		insert into RMTLovFieldDetail values(322,'CAT_COAPP','Mother','Mother',1,1,1000,current_timestamp,'Approved','','','','','',0,0,'');
		insert into RMTLovFieldDetail values(323,'CAT_COAPP','Father','Father',1,1,1000,current_timestamp,'Approved','','','','','',0,0,'');
		insert into RMTLovFieldDetail values(324,'CAT_COAPP','Son','Son',1,1,1000,current_timestamp,'Approved','','','','','',0,0,'');
		insert into RMTLovFieldDetail values(325,'CAT_COAPP','Daughter','Daughter',1,1,1000,current_timestamp,'Approved','','','','','',0,0,'');
		insert into RMTLovFieldDetail values(326,'CAT_COAPP','Self','Self',1,1,1000,current_timestamp,'Approved','','','','','',0,0,'');
     	</sql>
	</changeSet>
	
	<changeSet id="8" author="Durga Prasad D">
		<sql>
		delete from bmtlovfieldcode where fieldCode = 'PUR_LOAN';
		insert into bmtlovfieldcode values('PUR_LOAN', 'Purpose Of Loan', 'String', 1, 1, 1, 1007, CURRENT_TIMESTAMP, 'Approved','','','','','',0);

		delete from rmtlovfielddetail where fieldCode = 'PUR_LOAN';
		update seqrmtlovfielddetail set seqno = (Select Max(fieldcodeid) from rmtlovfielddetail);
		insert into rmtlovfielddetail values((Select Max(fieldcodeid)+1 from rmtlovfielddetail),(Select fieldcode from bmtlovfieldcode where fieldcode='PUR_LOAN'),'BT', 'Balance Transfer',1,1,1007, CURRENT_TIMESTAMP, 'Approved','','','','','',0, 0);
		insert into rmtlovfielddetail values((Select Max(fieldcodeid)+1 from rmtlovfielddetail),(Select fieldcode from bmtlovfieldcode where fieldcode='PUR_LOAN'),'LC', 'Loan Consolidation',1,1,1007, CURRENT_TIMESTAMP, 'Approved','','','','','',0, 0);
		insert into rmtlovfielddetail values((Select Max(fieldcodeid)+1 from rmtlovfielddetail),(Select fieldcode from bmtlovfieldcode where fieldcode='PUR_LOAN'),'CPP', 'Office/Commercial Property Purchase',1,1,1007, CURRENT_TIMESTAMP, 'Approved','','','','','',0, 0);
		insert into rmtlovfielddetail values((Select Max(fieldcodeid)+1 from rmtlovfielddetail),(Select fieldcode from bmtlovfieldcode where fieldcode='PUR_LOAN'),'BSEXON', 'Business Expansion - Online',1,1,1007, CURRENT_TIMESTAMP, 'Approved','','','','','',0, 0);										  
		insert into rmtlovfielddetail values((Select Max(fieldcodeid)+1 from rmtlovfielddetail),(Select fieldcode from bmtlovfieldcode where fieldcode='PUR_LOAN'), 'WC', 'Working Capital',1,1,1007, CURRENT_TIMESTAMP, 'Approved','','','','','',0, 0);										  
		insert into rmtlovfielddetail values((Select Max(fieldcodeid)+1 from rmtlovfielddetail),(Select fieldcode from bmtlovfieldcode where fieldcode='PUR_LOAN'),'BREX', 'Branch Expansion',1,1,1007, CURRENT_TIMESTAMP, 'Approved','','','','','',0, 0);										  
		insert into rmtlovfielddetail values((Select Max(fieldcodeid)+1 from rmtlovfielddetail),(Select fieldcode from bmtlovfieldcode where fieldcode='PUR_LOAN'),'BSEXOF', 'Business Expansion - Offline',1,1,1007, CURRENT_TIMESTAMP, 'Approved','','','','','',0, 0);										  
		insert into rmtlovfielddetail values((Select Max(fieldcodeid)+1 from rmtlovfielddetail),(Select fieldcode from bmtlovfieldcode where fieldcode='PUR_LOAN'),'INVP', 'Inventory Purchase',1,1,1007, CURRENT_TIMESTAMP, 'Approved','','','','','',0, 0);											  
		insert into rmtlovfielddetail values((Select Max(fieldcodeid)+1 from rmtlovfielddetail),(Select fieldcode from bmtlovfieldcode where fieldcode='PUR_LOAN'),'MACPUR', 'Machinery purchase',1,1,1007, CURRENT_TIMESTAMP, 'Approved','','','','','',0, 0);		  
		insert into rmtlovfielddetail values((Select Max(fieldcodeid)+1 from rmtlovfielddetail),(Select fieldcode from bmtlovfieldcode where fieldcode='PUR_LOAN'),'OTHERS', 'Others',1,1,1007, CURRENT_TIMESTAMP, 'Approved','','','','','',0, 0);	
		update seqrmtlovfielddetail set seqno = (Select Max(fieldcodeid) from rmtlovfielddetail);
		</sql>
	</changeSet>
	</databaseChangeLog>