<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />
	
	<changeSet id="1" author="Madhubabu">
	<createView viewName="FeePostings_View" replaceIfExists="true">
	SELECT     T1.PostId,T1.PostAgainst, T1.Reference, T1.FeeTyeCode,T1.PostingAmount,T1.PostDate, T1.ValueDate,T1.PartnerBankId ,T2.partnerBankName,T2.Accountno partnerBankAc,
             T2.acType partnerBankAcType ,T3.AccountSetId,T1.Remarks, T1.Version, T1.LastMntBy, T1.LastMntOn,T1.RecordStatus,T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId
			FROM    FeePostings_Temp T1 INNER JOIN
					PartnerBanks T2 ON T1.PartnerBankId = T2.PartnerBankId Left outer  Join
					Feetypes T3 ON T3.FeeTypeCode=rtrim(T1.FeeTyeCode) 
          
union all

SELECT     T1.PostId,T1.PostAgainst, T1.Reference, T1.FeeTyeCode,T1.PostingAmount,T1.PostDate, T1.ValueDate,T1.PartnerBankId ,T2.partnerBankName,T2.Accountno partnerBankAc,
            T2.acType partnerBankAcType , T3.AccountSetId,T1.Remarks, T1.Version, T1.LastMntBy, T1.LastMntOn,T1.RecordStatus,T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId
			FROM    FeePostings T1 INNER JOIN
					PartnerBanks T2 ON T1.PartnerBankId = T2.PartnerBankId Left outer  Join
					Feetypes T3 ON T3.FeeTypeCode=rtrim(T1.FeeTyeCode) 
          
 WHERE     (NOT EXISTS
                          (SELECT     1 Expr1
                            FROM           FeePostings_Temp
                            WHERE      (PostId = T1.PostId)))
	</createView>
	</changeSet>
	
	<changeSet id="2" author="Madhubabu">
	<createView viewName="FeePostings_TView" replaceIfExists="true">
	 SELECT     T1.PostId,T1.PostAgainst, T1.Reference, T1.FeeTyeCode,T1.PostingAmount,T1.PostDate, T1.ValueDate,T1.PartnerBankId ,T2.partnerBankName,T2.Accountno partnerBankAc,
             T2.acType partnerBankAcType ,T3.AccountSetId,T1.Remarks, T1.Version, T1.LastMntBy, T1.LastMntOn,T1.RecordStatus,T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId
			FROM    FeePostings_Temp T1 INNER JOIN
					PartnerBanks T2 ON T1.PartnerBankId = T2.PartnerBankId Left outer  Join
					Feetypes T3 ON T3.FeeTypeCode=rtrim(T1.FeeTyeCode)
	</createView>
	</changeSet>

	<changeSet id="3" author="Madhubabu">
	<createView viewName="FeePostings_AView" replaceIfExists="true">
	 SELECT     T1.PostId,T1.PostAgainst, T1.Reference, T1.FeeTyeCode,T1.PostingAmount,T1.PostDate, T1.ValueDate,T1.PartnerBankId ,T2.partnerBankName,T2.Accountno partnerBankAc,
             T2.acType partnerBankAcType ,T3.AccountSetId,T1.Remarks, T1.Version, T1.LastMntBy, T1.LastMntOn,T1.RecordStatus,T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId
			FROM    FeePostings T1 INNER JOIN
					PartnerBanks T2 ON T1.PartnerBankId = T2.PartnerBankId Left outer  Join
					Feetypes T3 ON T3.FeeTypeCode=rtrim(T1.FeeTyeCode) 	
	</createView>
	</changeSet>
	<changeSet id="4" author="Satya">
<sql>
UPDATE SEQSECGROUPS SET SEQNO= (SELECT MAX(GRPID) FROM SECGROUPS);
UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS);
UPDATE SEQSECROLEGROUPS SET SEQNO= (SELECT MAX(ROLEGRPID) FROM SECROLEGROUPS);

INSERT INTO SecGroups SELECT (SELECT MAX(GRPID)+1 FROM SECGROUPS), 'BUILDERPROJCET_VIEW', 'Allow to view BuilderProjcet', 0,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecGroups WHERE 0=0;
INSERT INTO SecGroups SELECT (SELECT MAX(GRPID)+1 FROM SECGROUPS), 'BUILDERPROJCET_MAKER', 'Maker for BuilderProjcet', 0,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecGroups WHERE 0=0;
INSERT INTO SecGroups SELECT (SELECT MAX(GRPID)+1 FROM SECGROUPS), 'BUILDERPROJCET_APPROVER', 'Approver for BuilderProjcet', 0,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecGroups WHERE 0=0;


INSERT INTO SecRights SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS),0,'menuItem_SystemMaster_BuilderProjcet','MENU',0,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecRights WHERE 0=0;
INSERT INTO SecRights SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS),0,'menuItem_SystemMaster_BuilderProjcetEnquiry','MENU',0,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecRights WHERE 0=0;
INSERT INTO SecRights SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS),2,'button_BuilderProjcetList_PrintList','BuilderProjcetList',0,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecRights WHERE 0=0;
INSERT INTO SecRights SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS),2,'button_BuilderProjcetList_NewBuilderProjcet','BuilderProjcetList',0,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecRights WHERE 0=0;
INSERT INTO SecRights SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS),2,'button_BuilderProjcetDialog_btnNew','BuilderProjcetDialog',0,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecRights WHERE 0=0;
INSERT INTO SecRights SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS),2,'button_BuilderProjcetDialog_btnEdit','BuilderProjcetDialog',0,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecRights WHERE 0=0;
INSERT INTO SecRights SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS),2,'button_BuilderProjcetDialog_btnDelete','BuilderProjcetDialog',0,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecRights WHERE 0=0;
INSERT INTO SecRights SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS),2,'button_BuilderProjcetDialog_btnSave','BuilderProjcetDialog',0,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecRights WHERE 0=0;
INSERT INTO SecRights SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS),3,'BuilderProjcetDialog_id','BuilderProjcetDialog',0,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecRights WHERE 0=0;
INSERT INTO SecRights SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS),3,'BuilderProjcetDialog_name','BuilderProjcetDialog',0,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecRights WHERE 0=0;
INSERT INTO SecRights SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS),3,'BuilderProjcetDialog_builderId','BuilderProjcetDialog',0,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecRights WHERE 0=0;
INSERT INTO SecRights SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS),3,'BuilderProjcetDialog_apfNo','BuilderProjcetDialog',0,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecRights WHERE 0=0;


INSERT INTO SecGroupRights SELECT (SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='BUILDERPROJCET_MAKER'), (select max(RightID) from SecRights WHERE RightName='menuCat_SystemMaster'),1,0,10000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SeqSecGroupRights WHERE 0=0;
INSERT INTO SecGroupRights SELECT (SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='BUILDERPROJCET_MAKER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='menuItem_SystemMaster_BuilderProjcet'),1,0,10000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecGroupRights WHERE 0=0;
INSERT INTO SecGroupRights SELECT (SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='BUILDERPROJCET_MAKER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='menuItem_SystemMaster_BuilderProjcetEnquiry'),1,0,10000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SeqSecGroupRights WHERE 0=0;
INSERT INTO SecGroupRights SELECT (SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='BUILDERPROJCET_MAKER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='button_BuilderProjcetList_NewBuilderProjcet'),1,0,10000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecGroupRights WHERE 0=0;
INSERT INTO SecGroupRights SELECT (SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='BUILDERPROJCET_MAKER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='button_BuilderProjcetDialog_btnDelete'),1,0,10000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecGroupRights WHERE 0=0;
INSERT INTO SecGroupRights SELECT (SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='BUILDERPROJCET_MAKER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='button_BuilderProjcetDialog_btnSave'),1,0,10000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecGroupRights WHERE 0=0;
INSERT INTO SecGroupRights SELECT (SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='BUILDERPROJCET_MAKER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='BuilderProjcetDialog_id'),1,0,10000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecGroupRights WHERE 0=0;
INSERT INTO SecGroupRights SELECT (SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='BUILDERPROJCET_MAKER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='BuilderProjcetDialog_name'),1,0,10000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecGroupRights WHERE 0=0;
INSERT INTO SecGroupRights SELECT (SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='BUILDERPROJCET_MAKER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='BuilderProjcetDialog_builderId'),1,0,10000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecGroupRights WHERE 0=0;
INSERT INTO SecGroupRights SELECT (SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='BUILDERPROJCET_MAKER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='BuilderProjcetDialog_apfNo'),1,0,10000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecGroupRights WHERE 0=0;
INSERT INTO SecGroupRights SELECT (SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='BUILDERPROJCET_APPROVER'), (select max(RightID) from SecRights WHERE RightName='menuCat_SystemMaster'),1,0,10000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecGroupRights WHERE 0=0;
INSERT INTO SecGroupRights SELECT (SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='BUILDERPROJCET_APPROVER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='menuItem_SystemMaster_BuilderProjcet'),1,0,10000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecGroupRights WHERE 0=0;
INSERT INTO SecGroupRights SELECT (SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='BUILDERPROJCET_APPROVER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='menuItem_SystemMaster_BuilderProjcetEnquiry'),1,0,10000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SeqSecGroupRights WHERE 0=0;
INSERT INTO SecGroupRights SELECT (SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='BUILDERPROJCET_APPROVER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='button_BuilderProjcetDialog_btnSave'),1,0,10000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecGroupRights WHERE 0=0;


INSERT INTO SecRoleGroups SELECT (Select MAX(RoleGrpID)+1 From SecRoleGroups), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='BUILDERPROJCET_MAKER'), (select roleid from SecRoles where RoleCd='MSTGRP1_MAKER'), 0,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecRoleGroups WHERE 0=0;
INSERT INTO SecRoleGroups SELECT (Select MAX(RoleGrpID)+1 From SecRoleGroups), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='BUILDERPROJCET_APPROVER'), (select roleid from SecRoles where RoleCd='MSTGRP1_APPROVER'), 0,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecRoleGroups WHERE 0=0;

UPDATE SEQSECGROUPS SET SEQNO= (SELECT MAX(GRPID) FROM SECGROUPS);
UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS);
UPDATE SEQSECROLEGROUPS SET SEQNO= (SELECT MAX(ROLEGRPID) FROM SECROLEGROUPS);
</sql>
</changeSet>

 <changeSet id="5" author="Satya" >
			<createTable tableName="BUILDERPROJCET">
			<column name="ID" type="bigint">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="NAME" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="BUILDERID" type="bigint" />
                       <column name="APFNO" type="varchar(20)" />
			<column name="Version" type="int">
				<constraints nullable="false" />
			</column>
			<column name="LastMntBy" type="bigint" />
			<column name="LastMntOn" type="datetime" />
			<column name="RecordStatus" type="varchar(50)" />
			<column name="RoleCode" type="varchar(100)" />
			<column name="NextRoleCode" type="varchar(200)" />
			<column name="TaskId" type="varchar(50)" />
			<column name="NextTaskId" type="varchar(200)" />
			<column name="RecordType" type="varchar(50)" />
			<column name="WorkflowId" type="bigint" />   
		</createTable> 
	</changeSet>
	        <changeSet id="6" author="satya">
		<addForeignKeyConstraint constraintName="FK_BuilderCompany"
			referencedTableName="BUILDERCOMPANY" referencedColumnNames="ID"
			baseTableName="BUILDERPROJCET" baseColumnNames="BUILDERID" />
	</changeSet>
		<changeSet id="7" author="Satya">
	<createTable tableName="BUILDERPROJCET_TEMP">
			<column name="ID" type="bigint">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="NAME" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="BUILDERID" type="bigint" />
			<column name="APFNO" type="varchar(20)" />
			<column name="Version" type="int">
				<constraints nullable="false" />
			</column>
			<column name="LastMntBy" type="bigint" />
			<column name="LastMntOn" type="datetime" />
			<column name="RecordStatus" type="varchar(50)" />
			<column name="RoleCode" type="varchar(100)" />
			<column name="NextRoleCode" type="varchar(200)" />
			<column name="TaskId" type="varchar(50)" />
			<column name="NextTaskId" type="varchar(200)" />
			<column name="RecordType" type="varchar(50)" />
			<column name="WorkflowId" type="bigint" />   
		</createTable> 
	</changeSet>

<changeSet id="8" author="satya">
		<addForeignKeyConstraint constraintName="FK_BuilderCompany_TEMP"
			referencedTableName="BUILDERCOMPANY" referencedColumnNames="ID"
			baseTableName="BUILDERPROJCET_TEMP" baseColumnNames="BUILDERID" />
	</changeSet>



<changeSet id="9" author="Satya">
	<createView viewName="BuilderProjcet_AView" replaceIfExists="true">
SELECT		T1.Id, T1.Name, T1.BuilderId,T1.APFNO		
			, T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId
FROM    	BuilderProjcet T1
</createView>
</changeSet>

<changeSet id="10" author="Satya">
	<createView viewName="BuilderProjcet_TView" replaceIfExists="true">
SELECT		T1.Id, T1.Name, T1.BuilderId,T1.APFNO		
			, T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId
FROM    	BuilderProjcet_Temp T1
</createView>
</changeSet>

	<changeSet id="11" author="Satya">
	<createView viewName="BuilderProjcet_View" replaceIfExists="true">
SELECT		T1.Id, T1.Name, T1.BuilderId,T1.APFNO	
			, T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId
FROM    	BuilderProjcet_Temp  T1 
UNION ALL

SELECT		T1.Id, T1.Name, T1.BuilderId,T1.APFNO	
			, T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId
FROM    	BuilderProjcet  T1 
WHERE     NOT EXISTS (SELECT 1 FROM BuilderProjcet_TEMP WHERE Id = T1.Id)
</createView>
</changeSet>

<changeSet id="12" author="Satya" dbms="oracle">
	<sql splitStatements="false">
		begin
		execute immediate 'CREATE SEQUENCE
		SeqBuilderProjcet START WITH 1 INCREMENT
		BY 1 MAXVALUE
		9223372036854775807 NOCYCLE';
		end;
	</sql>
</changeSet>

	<changeSet id="12" author="Satya" dbms="postgresql">
		<sql splitStatements="false">
			do $$
			begin
			execute 'CREATE SEQUENCE
			SeqBuilderProjcet START 1 INCREMENT BY 1 ';
			end;
			$$;
		</sql>
	</changeSet>

	<changeSet id="12" author="Satya" dbms="mssql">
		<sql splitStatements="false">
			CREATE TABLE SeqBuilderProjcet(
			SeqNo bigint
			IDENTITY(1,1) NOT NULL,
			Value int NOT NULL
			);
		</sql>
	</changeSet>
	<changeSet id="13" author="Madhubabu">
	<sql>
		update errordetails set errormessage='{0} Already had one Phone Number with {1}' where errorcode='90287';
	</sql>
	</changeSet>
	
	<changeSet id="14" author="Durgaprasad G">
	 <createView viewName="INT_MANDATE_REQUEST_VIEW" replaceIfExists="true">
		  SELECT M.MANDATEID, 
				BD.BANKCODE,
				BD.BANKNAME,
				BB.BRANCHCODE,
				BB.BRANCHDESC,
				CUST.CUSTCIF,
				CUST.CUSTSHRTNAME,
				RMTFINTYPE.FINTYPE AS FINTYPE ,
				FIN.FINREFERENCE ,
				(SELECT MAX(REPAYAMOUNT+FEESCHD)
				  FROM FINSCHEDULEDETAILS
				  WHERE FINREFERENCE =FIN.FINREFERENCE
				  AND REPAYONSCHDATE =1
				  )/100 EMI,
				  CASE M.OPENMANDATE
				    WHEN 1
				    THEN 'New Open ECS'
				    ELSE 'No Open ECS'
				  END OPENMANDATE,
				M.ACCNUMBER,
				M.ACCTYPE,
				M.ACCHOLDERNAME,
				BB.MICR,
				(SELECT MIN(FIRSTREPAYDATE) FIRSTDUEDATE
				    FROM FINPFTDETAILS
				    WHERE FINREFERENCE=FIN.FINREFERENCE
				    ) FIRSTDUEDATE,
				(SELECT MAX(MATURITYDATE) EMIENDDATE
				  FROM FINPFTDETAILS
				  WHERE FINREFERENCE=FIN.FINREFERENCE
				  ) EMIENDDATE,
				  COALESCE (M.MAXLIMIT, 0)/100 MAXLIMIT,
				    (SELECT SUM(REPAYAMOUNT+FEESCHD) MANDATEDEBITAMOUNT
				  FROM FINSCHEDULEDETAILS
				  WHERE FINREFERENCE IN
				    (SELECT FINREFERENCE FROM FINANCEMAIN WHERE MANDATEID=M.MANDATEID
				    )
				  AND REPAYONSCHDATE =1
				  )/100 DEBITAMOUNT,
				  M.STARTDATE,
				  M.EXPIRYDATE,
				  FIN.APPLICATIONNO,
				  M.MANDATETYPE,
				  M.STATUS,
				  M.INPUTDATE,
				  M.RECORDSTATUS,
				  M.RECORDTYPE,
		      M.MANDATECCY,
		      CCY.CCYMINORCCYUNITS
				FROM MANDATES M
				INNER JOIN BANKBRANCHES BB ON BB.BANKBRANCHID = M.BANKBRANCHID
				INNER JOIN BMTBANKDETAIL BD ON BD.BANKCODE=BB.BANKCODE 
				INNER JOIN CUSTOMERS CUST   ON CUST.CUSTID = M.CUSTID
		    LEFT OUTER JOIN RMTCURRENCIES CCY ON CCY.CCYCODE = M.MANDATECCY
				LEFT OUTER JOIN FINANCEMAIN FIN ON M.ORGREFERENCE=FIN.FINREFERENCE
				LEFT OUTER JOIN RMTFINANCETYPES RMTFINTYPE ON FIN.FINTYPE =RMTFINTYPE.FINTYPE 
				WHERE M.STATUS = 'NEW'
	 </createView>
	</changeSet>
</databaseChangeLog>