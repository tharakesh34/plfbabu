<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />
 
	 <changeSet id="01" author="Madhubabu">
		<createView replaceIfExists="true" viewName="FINADVANCEPAYMENTS_VIEW">
 SELECT   T1.FinReference,T1.paymentId, T1.PaymentSeq, T1.PaymentDetail, T1.AmtToBeReleased, T1.LiabilityHoldName,
         T1.BeneficiaryName, T1.BeneficiaryAccNo, T1.Description, T1.PaymentType, T1.LLReferenceNo,
         T1.LLDate, T1.CustContribution, T1.SellerContribution, T1.Remarks,T1.DisbDate,T1.DisbSeq,
         T1.Version, T1.LastMntBy, T1.LastMntOn, T1.RecordStatus, T1.RoleCode,
         T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId,T1.BankCode,T1.PayableLoc,T1.PrintingLoc,
		 T1.ValueDate,T1.BankBranchID,T1.PhoneCountryCode,T1.PhoneAreaCode,T1.PhoneNumber,T1.ClearingDate,T1.Status,T1.Active,
		 T1.InputDate,T1.DisbCCy,T1.POIssued,
		 T3.BankCode BranchBankCode,T31.BankName BranchBankName,T3.BranchCode,T3.BranchDesc,T3.IFSC,T3.City, 
		 T4.BankName,T1.PartnerbankId,T5.partnerbankCode,T5.PartnerBankName,T1.LinkedTranId  
		 FROM  FinAdvancePayments_Temp T1 LEFT OUTER JOIN
		 BankBranches T3 ON T1.BankBranchID = T3.BankBranchID  LEFT OUTER JOIN
		 BMTBankDetail T31 ON T31.BankCode=T3.BankCode LEFT OUTER JOIN		 
		 BMTBankDetail T4  ON T1.BankCode=T4.BankCode	LEFT OUTER JOIN
		 PARTNERBANKS T5 ON T5.PartnerBankId=T1.PartnerbankId
    
UNION ALL
SELECT   T1.FinReference,T1.paymentId, T1.PaymentSeq, T1.PaymentDetail, T1.AmtToBeReleased, T1.LiabilityHoldName,
         T1.BeneficiaryName, T1.BeneficiaryAccNo, T1.Description, T1.PaymentType, T1.LLReferenceNo,
         T1.LLDate, T1.CustContribution, T1.SellerContribution, T1.Remarks,T1.DisbDate,T1.DisbSeq,
         T1.Version, T1.LastMntBy, T1.LastMntOn, T1.RecordStatus, T1.RoleCode,
         T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId ,T1.BankCode,T1.PayableLoc,T1.PrintingLoc,
		 T1.ValueDate,T1.BankBranchID,T1.PhoneCountryCode,T1.PhoneAreaCode,T1.PhoneNumber,T1.ClearingDate,T1.Status,T1.Active,
		 T1.InputDate,T1.DisbCCy,T1.POIssued,
		 T3.BankCode BranchBankCode,T31.BankName BranchBankName,T3.BranchCode,T3.BranchDesc,T3.IFSC,T3.City, 
		 T4.BankName,T1.PartnerbankId,T5.partnerbankCode,T5.PartnerBankName,T1.LinkedTranId   	 	
		 FROM  FinAdvancePayments T1  LEFT OUTER JOIN
		 BankBranches T3 ON T1.BankBranchID = T3.BankBranchID  LEFT OUTER JOIN
		 BMTBankDetail T31 ON T31.BankCode=T3.BankCode LEFT OUTER JOIN		 
		 BMTBankDetail T4  ON T1.BankCode=T4.BankCode		LEFT OUTER JOIN
         PARTNERBANKS T5 ON T5.PartnerBankId=T1.PartnerbankId	
WHERE NOT EXISTS 
                 (SELECT 1 FROM  FinAdvancePayments_Temp WHERE FinReference = T1.FinReference and PaymentSeq = T1.PaymentSeq)
		</createView>
	</changeSet>
	<changeSet id="02" author="Madhubabu">
		<createView replaceIfExists="true" viewName="FINADVANCEPAYMENTS_TVIEW">
  SELECT   T1.FinReference,T1.PaymentId, T1.PaymentSeq, T1.PaymentDetail, T1.AmtToBeReleased, T1.LiabilityHoldName,
         T1.BeneficiaryName, T1.BeneficiaryAccNo, T1.Description, T1.PaymentType, T1.LLReferenceNo,
         T1.LLDate, T1.CustContribution, T1.SellerContribution, T1.Remarks,T1.DisbDate,T1.DisbSeq,
         T1.Version, T1.LastMntBy, T1.LastMntOn, T1.RecordStatus, T1.RoleCode,
         T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId,T1.BankCode,T1.PayableLoc,T1.PrintingLoc,
		 T1.ValueDate,T1.BankBranchID,T1.PhoneCountryCode,T1.PhoneAreaCode,T1.PhoneNumber,T1.ClearingDate,T1.Status,T1.Active,
		 T1.InputDate,T1.DisbCCy,T1.POIssued,
		 T3.BankCode BranchBankCode,T31.BankName BranchBankName,T3.BranchCode,T3.BranchDesc,T3.IFSC,T3.City, 
		 T4.BankName,T1.PartnerbankId,T5.partnerbankCode,T5.PartnerBankName,T1.LinkedTranId 	     
		 FROM FinAdvancePayments_Temp T1 LEFT OUTER JOIN
		 BankBranches T3 ON T1.BankBranchID = T3.BankBranchID  LEFT OUTER JOIN
		 BMTBankDetail T31 ON T31.BankCode=T3.BankCode LEFT OUTER JOIN		 
		 BMTBankDetail T4  ON T1.BankCode=T4.BankCode LEFT OUTER JOIN
		 PARTNERBANKS T5 ON T5.PartnerBankId=T1.PartnerbankId
		</createView>
	</changeSet>
	<changeSet id="03" author="Madhubabu">
		<createView replaceIfExists="true" viewName="FINADVANCEPAYMENTS_AVIEW">
		SELECT   T1.FinReference,T1.paymentid, T1.PaymentSeq, T1.PaymentDetail, T1.AmtToBeReleased, T1.LiabilityHoldName,
         T1.BeneficiaryName, T1.BeneficiaryAccNo, T1.Description, T1.PaymentType, T1.LLReferenceNo,
         T1.LLDate, T1.CustContribution, T1.SellerContribution, T1.Remarks,T1.DisbDate,T1.DisbSeq,
         T1.Version, T1.LastMntBy, T1.LastMntOn, T1.RecordStatus, T1.RoleCode,
         T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId,T1.BankCode,T1.PayableLoc,T1.PrintingLoc,
		 T1.ValueDate,T1.BankBranchID,T1.PhoneCountryCode,T1.PhoneAreaCode,T1.PhoneNumber,T1.ClearingDate,T1.Status,T1.Active,
		 T1.InputDate,T1.DisbCCy,T1.POIssued,
		 T3.BankCode BranchBankCode,T31.BankName BranchBankName,T3.BranchCode,T3.BranchDesc,T3.IFSC,T3.City, 
		 T4.BankName,T1.PartnerbankId,T5.partnerbankCode,T5.PartnerBankName,T1.LinkedTranId  	     
		 FROM  FinAdvancePayments T1 LEFT OUTER JOIN
		 BankBranches T3 ON T1.BankBranchID = T3.BankBranchID  LEFT OUTER JOIN
		 BMTBankDetail T31 ON T31.BankCode=T3.BankCode LEFT OUTER JOIN		 
		BMTBankDetail T4  ON T1.BankCode=T4.BankCode LEFT OUTER JOIN
		 PARTNERBANKS T5 ON T5.PartnerBankId=T1.PartnerbankId
		</createView>
	</changeSet>
	
	<changeSet id="04" author="murthy.y">
		<createView viewName="DE_FILE_CONTROL_VIEW" replaceIfExists="true">
		  SELECT DS.ID, DC.NAME, DC.UPLOADPATH FILELOCATION, DS.FILENAME,  DS.STATUS 
		  FROM DATA_ENGINE_CONFIG DC
		  INNER JOIN DATA_ENGINE_STATUS DS ON DS.NAME = DC.NAME 
		  ORDER BY DS.ID
	  </createView>
	</changeSet>
	
	<changeSet id="05" author="Amit">
		<sql>
			UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM
			SECRIGHTS);
			UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT
			MAX(GRPRIGHTID) FROM
			SECGROUPRIGHTS);

			INSERT INTO SECRIGHTS SELECT
			(SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 2,
			'EmploymentTypeDialog_EmpTypeIsActive','EmploymentTypeDialog',0,1000,CURRENT_TIMESTAMP,'
			',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0;

			INSERT INTO
			SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM
			SECGROUPRIGHTS),
			(SELECT GRPID FROM SECGROUPS WHERE
			GRPCODE='EMPLOYMENTTYPE_MAKER')
			,(SELECT RIGHTID FROM SECRIGHTS WHERE
			RIGHTNAME='EmploymentTypeDialog_EmpTypeIsActive'), 1,
			0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);


			UPDATE
			SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
			UPDATE
			SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM
			SECGROUPRIGHTS);

		</sql>
	</changeSet>
	
	<changeSet id="06" author="murthy.y">
		<dropView viewName="MANDATE_FILE_DOWNLOAD_VIEW"/>
	</changeSet>
	
	<changeSet id="07" author="Kesav">
		<createView viewName="FINTYPEPARTNERBANKS_AVIEW" replaceIfExists="true">
		  SELECT	 T1.ID, T1.FinType, T1.Purpose, T1.PaymentMode, T1.PartnerBankID	, T1.Version , 
					 T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId,
					 T2.PARTNERBANKCODE, T2.PARTNERBANKNAME
			FROM     FinTypePartnerBanks  T1 
					 LEFT JOIN PartnerBanks T2  ON T1.PartnerBankID =  T2.PartnerBankID
	  </createView>
	</changeSet>
	
	<changeSet id="08" author="murthy.y">
		<createView viewName="DE_DISBURSE_FILE_CONTROL_VIEW" replaceIfExists="true">
		 SELECT DS.ID, DC.NAME, DC.UPLOADPATH FILELOCATION, DS.FILENAME,  DS.STATUS, PB.PARTNERBANKID, PB.ALWFILEDOWNLOAD, PB.PARTNERBANKNAME
		  FROM DATA_ENGINE_CONFIG DC
		  INNER JOIN DATA_ENGINE_STATUS DS ON DS.NAME = DC.NAME 
		  INNER JOIN DATA_ENGINE_PROCESS_LOG PL ON PL.FILEID=DS.ID
		  INNER JOIN PARTNERBANKS PB ON PB.PARTNERBANKID=PL.REFID2
	  </createView>
	</changeSet>
	
	
</databaseChangeLog>