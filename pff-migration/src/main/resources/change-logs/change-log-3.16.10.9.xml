<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />

	 <changeSet id="1" author="murthy.y">
		<sql>
			<![CDATA[
				UPDATE DATA_ENGINE_CONFIG set ACTIVE = 0  where Name IN ('ME_BMTPRODUCT', 'ME_RMTBRANCHES');
			]]>
		</sql>
	</changeSet>
	<changeSet id="2" author="Durga Prasad D">
	    <sql>
	       Delete from ErrorDetails where ErrorCode = '90350';
	       INSERT INTO ErrorDetails VALUES('90350','EN','E','{0} should be after {1} and on/before {2}.','','Approved','','','','','',0,CURRENT_TIMESTAMP,1000,0);
	    </sql>
	</changeSet>
	<changeSet id="3" author="Durga Prasad D" dbms="oracle">
    <createView viewName="LIMITLINES_VIEW" replaceIfExists="true">
	Select T.DetailId, T.LimitHeaderId, T1.RuleCode,T1.RuleValue,T1.CustomerId,T1.CustomerGroup,T.LimitLine,R.SqlRule,R.RuleCodeDesc  LimitLineDesc,T.GroupCode, T.
	LimitStructureDetailsID,T.LimitChkMethod, T.ExpiryDate, T.LimitSanctioned,  T.ReservedLimit, T.UtilisedLimit,T.LimitCheck,NVL(T.Revolving,0)Revolving ,T1.LimitCcy  Currency,T.Version , T.
	CreatedBy,T.CreatedOn,T.LastMntBy, T.LastMntOn, T.RecordStatus, T.RoleCode, T.NextRoleCode, T.TaskId, T.NextTaskId, T.RecordType, T.WorkflowId from 
	LimitDetails_AView  T INNER JOIN
	LimitHeader  T1 ON T1.HeaderId=T.LimitHeaderId  Left Outer Join 
	Rules R ON T.LimitLine= R.RuleCode and RuleModule='LMTLINE' where  T1.Active=1
    </createView>
    </changeSet>
    <changeSet id="3" author="Durga Prasad D" dbms="mssql">
    <createView viewName="LIMITLINES_VIEW" replaceIfExists="true">
	Select T.DetailId, T.LimitHeaderId, T1.RuleCode,T1.RuleValue,T1.CustomerId,T1.CustomerGroup,T.LimitLine,R.SqlRule,R.RuleCodeDesc  LimitLineDesc,T.GroupCode, T.
	LimitStructureDetailsID,T.LimitChkMethod, T.ExpiryDate, T.LimitSanctioned,  T.ReservedLimit, T.UtilisedLimit,T.LimitCheck,COALESCE(T.Revolving,0)Revolving ,T1.LimitCcy  Currency,T.Version , T.
	CreatedBy,T.CreatedOn,T.LastMntBy, T.LastMntOn, T.RecordStatus, T.RoleCode, T.NextRoleCode, T.TaskId, T.NextTaskId, T.RecordType, T.WorkflowId from 
	LimitDetails_AView  T INNER JOIN
	LimitHeader  T1 ON T1.HeaderId=T.LimitHeaderId  Left Outer Join 
	Rules R ON T.LimitLine= R.RuleCode and RuleModule='LMTLINE' where  T1.Active=1
    </createView>
    </changeSet>
     <changeSet id="3" author="Durga Prasad D" dbms="postgresql">
    <createView viewName="LIMITLINES_VIEW" replaceIfExists="true">
	Select T.DetailId, T.LimitHeaderId, T1.RuleCode,T1.RuleValue,T1.CustomerId,T1.CustomerGroup,T.LimitLine,R.SqlRule,R.RuleCodeDesc  LimitLineDesc,T.GroupCode, T.
	LimitStructureDetailsID,T.LimitChkMethod, T.ExpiryDate, T.LimitSanctioned,  T.ReservedLimit, T.UtilisedLimit,T.LimitCheck,COALESCE(T.Revolving,0)Revolving ,T1.LimitCcy  Currency,T.Version , T.
	CreatedBy,T.CreatedOn,T.LastMntBy, T.LastMntOn, T.RecordStatus, T.RoleCode, T.NextRoleCode, T.TaskId, T.NextTaskId, T.RecordType, T.WorkflowId from 
	LimitDetails_AView  T INNER JOIN
	LimitHeader  T1 ON T1.HeaderId=T.LimitHeaderId  Left Outer Join 
	Rules R ON T.LimitLine= R.RuleCode and RuleModule='LMTLINE' where  T1.Active=1
    </createView>
    </changeSet>
	<changeSet id="4" author="Jayant" dbms="oracle">
	    <sql splitStatements="false">
	        begin
	        	SP_INVALIDVIEWS;
	        	RESEED_SEQUENCE_TABLES;
	        end;
	    </sql>
	</changeSet>
	<changeSet id="5" author="murthy.y">
		<createIndex indexName="IDX_DES_NAME" tableName="DATA_ENGINE_STATUS">
			<column name="NAME" type="varchar(100)"/>
		</createIndex>
	</changeSet>
	<changeSet id="6" author="Jayant" dbms="oracle">
	    <sql splitStatements="false">
	        begin
	        	SP_INVALIDVIEWS;
	        	RESEED_SEQUENCE_TABLES;
	        end;
	    </sql>
	</changeSet>
</databaseChangeLog>