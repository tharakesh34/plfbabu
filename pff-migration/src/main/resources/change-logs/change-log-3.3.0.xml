<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />
	
	<changeSet id="01" author="Irfan">
		<sql>
		UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
		UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS); 
		
		INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'FeeTypeDialog_AdviseType','FeeTypeDialog',0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0;
		INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='FEETYPE_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='FeeTypeDialog_AdviseType'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
		
		UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
		UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS); 
		</sql>
	</changeSet>
	<changeSet id="02.0" author="Jayant">
	    <dropIndex tableName="FINPFTDETAILS" indexName="IX_FINPFTDTL_CUST_ACTIVE"  />
	</changeSet>
	<changeSet id="02" author="Jayant">
	    <createIndex tableName="FINPFTDETAILS" indexName="IX_FINPFTDTL_CUST_ACTIVE">
	        <column name="CUSTID" type="bigint"/>
	        <column name="FINISACTIVE" type="boolean"/>
	    </createIndex>
	</changeSet>
	<changeSet id="03.0" author="Jayant">
	    <dropIndex tableName="FINANCEMAIN" indexName="IX_FM_CUST_ID"  />
	</changeSet>
	<changeSet id="03" author="Jayant">
	    <createIndex tableName="FINANCEMAIN" indexName="IX_FM_CUST_ID">
	        <column name="CUSTID" type="bigint"/>
	        <column name="FINISACTIVE" type="boolean"/>
	    </createIndex>
	</changeSet>
	<!--
	 <changeSet id="03" author="Jayant">
	    <createIndex tableName="FINFEEDETAIL" indexName="IX_FEEDETAIL_FINREF">
	        <column name="FINREFERENCE" type="bigint"/>
	    </createIndex>
	</changeSet> -->
	<changeSet id="04.0" author="Jayant">
	    <dropIndex tableName="FINFEEDETAIL" indexName="IX_FEEDETAIL_FEETYPE"  />
	</changeSet>
	<changeSet id="04" author="Jayant">
	    <createIndex tableName="FINFEEDETAIL" indexName="IX_FEEDETAIL_FEETYPE">
	        <column name="FEETYPEID" type="bigint"/>
	        <column name="FEEID" type="bigint"/>
	    </createIndex>
	</changeSet>
	<changeSet id="05.0" author="Jayant">
	    <dropIndex tableName="FINFEEDETAIL" indexName="IX_FEEDETAIL_FINREF"  />
	</changeSet>
	<changeSet id="05" author="Jayant">
	    <createIndex tableName="FINFEEDETAIL" indexName="IX_FEEDETAIL_FINREF">
	        <column name="FINREFERENCE" type="VARCHAR2(20)"/>
	        <column name="FEEID" type="bigint"/>
	    </createIndex>
	</changeSet>
	<changeSet id="06.0" author="Jayant">
	    <dropIndex tableName="FININSURANCES" indexName="IX_FININSURANCE_FINREF_INSID"  />
	</changeSet>
	<changeSet id="06" author="Jayant">
	    <createIndex tableName="FININSURANCES" indexName="IX_FININSURANCE_FINREF_INSID">
	        <column name="REFERENCE" type="VARCHAR2(20)"/>
	        <column name="INSID" type="VARCHAR2(20)"/>
	    </createIndex>
	</changeSet>
	<changeSet id="07" author="Jayant">
	    <createIndex tableName="DPDBUCKETSCONFIG" indexName="IX_DPDBUCKET_PROD_BUCKET_DAYS">
	        <column name="PRODUCTCODE" type="VARCHAR2(8)"/>
	        <column name="BUCKETID" type="bigint"/>
	        <column name="DUEDAYS" type="int"/>
	    </createIndex>
	</changeSet>
	<changeSet id="08" author="Jayant">
	    <createIndex tableName="DPDBUCKETSCONFIG" indexName="IX_DPDBUCKET_PROD_DAYS">
	        <column name="PRODUCTCODE" type="VARCHAR2(8)"/>
	        <column name="DUEDAYS" type="int"/>
	    </createIndex>
	</changeSet>
	<changeSet id="08.1" author="Jayant">
	    <sql>
	    	INSERT INTO "PLF"."SMTPARAMETERS" (SYSPARMCODE, SYSPARMDESC, SYSPARMTYPE, SYSPARMMAINT, SYSPARMVALUE, SYSPARMLENGTH, 
	    	SYSPARMDEC, SYSPARMDESCRIPTION, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, WORKFLOWID) 
	    	VALUES ('AMZ_POSTING_EVENT', 'Accrual / Amortization Posting Date 0:Daily 1: APP Month End 2: APP Extended Month End', 
	    	'int', '1', '0', '1', '0', 'Accrual / Amortization Posting Date 0:Daily 1: APP Month End 2: APP Extended Month End', '1',
	    	'1000', TO_DATE('2017-05-02 00:00:00', 'YYYY-MM-DD HH24:MI:SS'), 'Approved', '0');    
	    </sql>
	</changeSet>
	<changeSet id="09" author="Jayant">
	    <createIndex tableName="PRESENTMENTDETAILS" indexName="IX_PRESENTMENTDTL_REF_DATE">
	        <column name="FINREFERENCE" type="VARCHAR2(20)"/>
	        <column name="SCHDATE" type="DATETIME"/>
	    </createIndex>
	</changeSet>
	<changeSet id="10" author="Jayant">
	    <createIndex tableName="PRESENTMENTDETAILS" indexName="IX_PRESENTMENTDTL_MID">
	        <column name="MANDATEID" type="bigint"/>
	    </createIndex>
	</changeSet>
	<changeSet id="11" author="Jayant">
	    <createIndex tableName="PRESENTMENTDETAILS" indexName="IX_PRESENTMENTDTL_PID_FINREF">
	        <column name="PRESENTMENTID" type="bigint"/>
	        <column name="FINREFERENCE" type="VARCHAR2(20)"/>
	        <column name="SCHDATE" type="DATETIME"/> 
	    </createIndex>
	</changeSet>
	<changeSet id="12" author="Jayant">
	    <createIndex tableName="PRESENTMENTHEADER" indexName="IX_PRESENTMENTHDR_PBID">
	        <column name="PARTNERBANKID" type="bigint"/>
	    </createIndex>
	</changeSet>
	<changeSet id="13" author="Jayant">
	    <createIndex tableName="PRESENTMENTHEADER" indexName="IX_PRESENTMENTHDR_PDATE">
	        <column name="PRESENTMENTDATE" type="DATETIME"/>   
	    </createIndex>
	</changeSet>
	<changeSet id="14.0" author="Jayant">
	    <dropIndex tableName="FINANCEMAIN" indexName="IX_FM_RCD_MNT_STS"  />
	</changeSet>
	<changeSet id="14" author="Jayant">
	    <createIndex tableName="FINANCEMAIN" indexName="IX_FM_CID_FINREF">
	        <column name="CUSTID" type="bigint"/>
	        <column name="FINREFERENCE" type="VARCHAR2(20)"/>
	    </createIndex>
	</changeSet>
	<changeSet id="16" author="Madhubabu">
	   <sql>
	   	Update SeqSecRights set SeqNo = (select MAX(RightID) from SecRights);
		Update SeqSecGroupRights set SeqNo = (select MAX(GrpRightID) from SecGroupRights);
	  	INSERT INTO SecRights SELECT (select (SeqNo+1) from SeqSecRights),3,'JVPostingDialog_PostingAgainst','JVPostingDialog',0,1000,'2017-01-03 12:41:37','Approved',' ',' ',' ',' ',' ',0 FROM SeqSecRights WHERE 0=0;
     	INSERT INTO SecRights SELECT (select (SeqNo+2) from SeqSecRights),3,'JVPostingDialog_Reference','JVPostingDialog',0,1000,'2017-01-03 12:41:37','Approved',' ',' ',' ',' ',' ',0 FROM SeqSecRights WHERE 0=0;
		INSERT INTO SecGroupRights SELECT (select (SeqNo+1) from SeqSecGroupRights), (select Grpid from SecGroups where grpcode='JVPOSTINGS_MAKER'), (select rightid from secrights where rightname='JVPostingDialog_PostingAgainst'),1,0,10000,'2017-01-03 12:41:37','Approved',' ',' ',' ',' ',' ',0 FROM SeqSecGroupRights WHERE 0=0;
		INSERT INTO SecGroupRights SELECT (select (SeqNo+2) from SeqSecGroupRights), (select Grpid from SecGroups where grpcode='JVPOSTINGS_MAKER'), (select rightid from secrights where rightname='JVPostingDialog_Reference'),1,0,10000,'2017-01-03 12:41:37','Approved',' ',' ',' ',' ',' ',0 FROM SeqSecGroupRights WHERE 0=0;
		Update SeqSecRights set SeqNo = (select MAX(RightID) from SecRights);
		Update SeqSecGroupRights set SeqNo = (select MAX(GrpRightID) from SecGroupRights);
	   </sql>
	   </changeSet>
	   	<changeSet id="15" author="Surekha">
		<sql>
 			INSERT INTO ErrorDetails VALUES ('WMAN01','EN','W','{0} Customer already having {1} open Mandates ','','Approved','','','','','',0,null,1000,0);  
		</sql>
	</changeSet>
	<changeSet id="17" author="SreeRavali">
		<sql>
			
			Update SeqSecGroups Set SeqNo = (Select MAX(GrpID) + 1 from SecGroups);
			Update SeqSecGroupRights Set SeqNo = (Select MAX(GrpRightID) + 1 from SecGroupRights);
			Update SeqSecRoleGroups Set SeqNo = (Select MAX(RoleGrpID) + 1 from SecRoleGroups);
		
			
			INSERT INTO SecGroups Values ((Select MAX(GrpID)+1 From SecGroups), 'ErrorDetail_MAKER','WF Maker for ErrorDetail', 1, 1000, CURRENT_TIMESTAMP, NULL, NULL, NULL, NULL, NULL, NULL,0);
			INSERT INTO SecGroups Values ((Select MAX(GrpID)+1 From SecGroups), 'ErrorDetail_APPROVER','WF Maker for ErrorDetail', 1, 1000, CURRENT_TIMESTAMP, NULL, NULL, NULL, NULL, NULL, NULL,0);
			
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'ErrorDetail_MAKER'), (Select RightID from SecRights where RightName = 'menuItem_ErrorDetail_ErrorDetail'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'ErrorDetail_MAKER'), (Select RightID from SecRights where RightName = 'button_ErrorDetailDialog_btnEdit'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'ErrorDetail_MAKER'), (Select RightID from SecRights where RightName = 'button_ErrorDetailDialog_btnSave'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'ErrorDetail_MAKER'), (Select RightID from SecRights where RightName = 'ErrorDetailDialog_ErrorSeverity'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'ErrorDetail_MAKER'), (Select RightID from SecRights where RightName = 'ErrorDetailDialog_ErrorMessage'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'ErrorDetail_APPROVER'), (Select RightID from SecRights where RightName = 'menuItem_ErrorDetail_ErrorDetail'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'ErrorDetail_APPROVER'), (Select RightID from SecRights where RightName = 'button_ErrorDetailDialog_btnSave'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
		
			-- Security Role Groups
			INSERT INTO SecRoleGroups values((Select MAX(RoleGrpID)+1 From SecRoleGroups),(Select GrpId  From SecGroups Where GrpCode='ErrorDetail_MAKER'), (Select  RoleID  From SecRoles Where RoleCd='MSTGRP1_MAKER'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0); 
			INSERT INTO SecRoleGroups values((Select MAX(RoleGrpID)+1 From SecRoleGroups),(Select GrpId  From SecGroups Where GrpCode='ErrorDetail_APPROVER'), (Select  RoleID  From SecRoles Where RoleCd='MSTGRP1_APPROVER'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0); 
		
			Update SeqSecGroups Set SeqNo = (Select MAX(GrpID) + 1 from SecGroups);
			Update SeqSecGroupRights Set SeqNo = (Select MAX(GrpRightID) + 1 from SecGroupRights);
			Update SeqSecRoleGroups Set SeqNo = (Select MAX(RoleGrpID) + 1 from SecRoleGroups);
		</sql>
	</changeSet>
	 <!-- <changeSet id="18" author="SreeRavali">
		<sql>
		Update SeqSecGroupRights Set SeqNo = (Select MAX(GrpRightID) + 1 from SecGroupRights);
		
		Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'ErrorDetail_MAKER'), (Select RightID from SecRights where RightName = 'menuCat_ApplicationMaster'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
		Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'ErrorDetail_APPROVER'), (Select RightID from SecRights where RightName = 'menuCat_ApplicationMaster'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
		
		Update SeqSecGroupRights Set SeqNo = (Select MAX(GrpRightID) + 1 from SecGroupRights);
	</sql>
	</changeSet> -->
	 <changeSet id="19" author="Madhubabu" >
	<addColumn tableName="jvpostings_temp">
		<column name="Reference" type="nvarchar(20)"/>
		<column name="PostAgainst" type="char(5)"/>
	</addColumn>
	</changeSet>
	<changeSet id="20" author="Madhubabu" >
	<addColumn tableName="jvpostings">
		<column name="Reference" type="nvarchar(20)"/>
		<column name="PostAgainst" type="char(5)"/>
	</addColumn>
	</changeSet>
	
	<changeSet author="Madhubabu" id="21">
		<createView replaceIfExists="true" viewName="JVPOSTINGS_VIEW">
          SELECT     T1.BatchReference, T1.Batch, T1.Filename, T1.DebitCount, T1.CreditsCount, T1.TotDebitsByBatchCcy, T1.TotCreditsByBatchCcy, T1.BatchPurpose, T1.Currency, 
                      T1.ExchangeRateType, T1.ValidationStatus, T1.Version, T1.LastMntBy, T1.LastMntOn, T2.UsrLogin, T2.UsrFName, T2.UsrMName, T2.UsrLName, T1.RecordStatus, 
                      T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId, T3.CcyEditField  CurrencyEditField, T3.CcyDesc  CurrencyDesc, 
                      T1.BatchPostingStatus, T3.CcyNumber, T1.Branch, T1.PostingDate,T1.expReference,T1.Reference,T1.PostAgainst

FROM         JVPostings_Temp  T1 INNER JOIN
                      SecUsers  T2 ON T1.LastMntBy = T2.UsrID INNER JOIN
                      RMTCurrencies  T3 ON T1.Currency = T3.CcyCode
UNION ALL
SELECT     T1.BatchReference, T1.Batch, T1.Filename, T1.DebitCount, T1.CreditsCount, T1.TotDebitsByBatchCcy, T1.TotCreditsByBatchCcy, T1.BatchPurpose, T1.Currency, 
                      T1.ExchangeRateType, T1.ValidationStatus, T1.Version, T1.LastMntBy, T1.LastMntOn, T2.UsrLogin, T2.UsrFName, T2.UsrMName, T2.UsrLName, T1.RecordStatus, 
                      T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId, T3.CcyEditField  CurrencyEditField, T3.CcyDesc  CurrencyDesc, 
                      T1.BatchPostingStatus, T3.CcyNumber, T1.Branch, T1.PostingDate,T1.expReference,T1.Reference,T1.PostAgainst

FROM         JVPostings  T1 INNER JOIN
                    SecUsers  T2 ON T1.LastMntBy = T2.UsrID INNER JOIN
                      RMTCurrencies  T3 ON T1.Currency = T3.CcyCode
WHERE     NOT EXISTS
                          (SELECT     1
                            FROM          JVPostings_TEMP
                            WHERE      BatchReference = T1.BatchReference)
          
        </createView>
	</changeSet>
	<changeSet author="Madhubabu" id="22">
		<createView replaceIfExists="true" viewName="JVPOSTINGS_TVIEW">
          SELECT     T1.BatchReference, T1.Batch, T1.Filename, T1.DebitCount, T1.CreditsCount, T1.TotDebitsByBatchCcy, T1.TotCreditsByBatchCcy, T1.BatchPurpose, T1.Currency, 
                      T1.ExchangeRateType, T1.ValidationStatus, T1.Version, T1.LastMntBy, T1.LastMntOn, T2.UsrLogin, T2.UsrFName, T2.UsrMName, T2.UsrLName, T1.RecordStatus, 
                      T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId,
                      T1.BatchPostingStatus,T1.Branch, T1.PostingDate,T1.expReference,T1.Reference,T1.PostAgainst
FROM          JVPostings_Temp T1 INNER JOIN
                       SecUsers T2 ON T1.LastMntBy = T2.UsrID
          
        </createView>
	</changeSet>
	<changeSet author="Madhubabu" id="23">
		<createView replaceIfExists="true" viewName="JVPOSTINGS_AVIEW">
          SELECT     T1.BatchReference, T1.Batch, T1.Filename, T1.DebitCount, T1.CreditsCount, T1.TotDebitsByBatchCcy, T1.TotCreditsByBatchCcy, T1.BatchPurpose, T1.Currency, 
                      T1.ExchangeRateType, T1.ValidationStatus, T1.Version, T1.LastMntBy, T1.LastMntOn, T2.UsrLogin, T2.UsrFName, T2.UsrMName, T2.UsrLName, T1.RecordStatus, 
                      T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId, T3.CcyEditField  CurrencyEditField, T3.CcyDesc  CurrencyDesc, 
                      T1.BatchPostingStatus, T3.CcyNumber, T1.Branch, T1.PostingDate,T1.expReference,T1.Reference,T1.PostAgainst
FROM                  JVPostings  T1 INNER JOIN
                      SecUsers  T2 ON T1.LastMntBy = T2.UsrID INNER JOIN
                      RMTCurrencies  T3 ON T1.Currency = T3.CcyCode
          
        </createView>
	</changeSet>
		<changeSet id="24" author="Surekha">
		<sql>
			update RBFieldDetails set RBFLDTABLENAME='', RBSTFLDS='static,global' , MODULECODE='' where RBModule='BOUNCE' and RBFLDNAME='MandateType';
		</sql>
	</changeSet>
	
			<changeSet id="25" author="DURGAPRASAD G">
		<addColumn tableName="PRESENTMENTDETAILS">
			<column name="BOUNCERETURNCODE" type="VARCHAR2(8)"/>
		</addColumn>
	</changeSet>	
		<changeSet id="26" author="DURGAPRASAD G">
		<addColumn tableName="PRESENTMENTDETAILS_TEMP">
			<column name="BOUNCERETURNCODE" type="VARCHAR2(8)"/>
		</addColumn>
	</changeSet>	
		<changeSet id="27" author="Madhubabu">
		<sql>
	Update SeqSecRoleGroups Set SeqNo = (Select MAX(RoleGrpID) + 1 from SecRoleGroups);
	insert into secrolegroups values((select max(rolegrpid)+1 from secrolegroups),(select grpid from secgroups where grpcode='FINANCE_REFERENCEDETAIL_MAKER'),
	(select roleid from secroles where rolecd='MSTGRP1_MAKER'),0,1000,current_timestamp,'','','','','','',0);
	Update SeqSecRoleGroups Set SeqNo = (Select MAX(RoleGrpID) + 1 from SecRoleGroups);
		</sql>
	</changeSet>	
	
</databaseChangeLog>