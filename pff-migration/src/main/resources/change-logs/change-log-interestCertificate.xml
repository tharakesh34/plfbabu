<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />

	<changeSet id="1" author="somasekhar">
	 <createView replaceIfExists="true" viewName="INTERESTCERTIFICATE">
       select T2.CUSTSHRTNAME as CUSTNAME,T3.CUSTADDRHNBR ,T3.CUSTADDRSTREET,T11.COUNTRYDESC,
		T12.CPPROVINCENAME as CUSTADDRSTATE,T13.PCCITYNAME as CUSTADDRCITY,T3.CUSTADDRZIP,
		T1.FINREFERENCE,T4.CUSTEMAIL,T5.PHONENUMBER as CUSTPHONENUMBER,T6.FINTYPEDESC,(select string_agg(TE.CUSTSHRTNAME,','ORDER BY TE.CUSTSHRTNAME )
		from CUSTOMERS TE where CUSTCIF in (select CUSTCIF from FINJOINTACCOUNTDETAILS T7 where T7.FINREFERENCE=T1.FINREFERENCE)) COAPPLICANT,
		T8.FINASSETVALUE,T8.EFFECTIVERATEOFRETURN as EFFECTIVERATE ,T10.ENTITYCODE,T10.ENTITYDESC,T10.PANNUMBER as ENTITYPANNUMBER,T10.ENTITYADDRHNBR,T10.ENTITYFLATNBR,T10.ENTITYADDRSTREET,
		T14.CPPROVINCENAME as ENTITYSTATE,T15.PCCITYNAME as ENTITYCITY,
		T1.FINPOSTDATE,T1.FINSCHDPFTPAID,T1.FINSCHDPRIPAID,T8.FINCCY,T8.finAssetValue as FinAmount,T8.fintype
		from FINREPAYDETAILS T1 
		inner join FINANCEMAIN T8 on T8.FINREFERENCE =T1.FINREFERENCE 
		inner join CUSTOMERS T2 on T2.CUSTID=T8.CUSTID 
		inner join CUSTOMERADDRESSES T3 on T3.CUSTID=T8.CUSTID and T3.CUSTADDRPRIORITY=5
		inner join CUSTOMEREMAILS T4 on T4.CUSTID=T8.CUSTID and T4.CUSTEMAILPRIORITY=5
		inner join CUSTOMERPHONENUMBERS T5 on T5.PHONECUSTID=T8.CUSTID and T5.PHONETYPEPRIORITY=5
		inner join RMTFINANCETYPES T6 on T6.FINTYPE=T8.FINTYPE
		inner join SMTDIVISIONDETAIL T9 on T9.DIVISIONCODE=T6.FINDIVISION
		inner join ENTITY T10 on T10.ENTITYCODE=T9.ENTITYCODE
		inner join BMTCOUNTRIES T11 on T11.COUNTRYCODE=T3.CUSTADDRCOUNTRY
		inner join RMTCOUNTRYVSPROVINCE T12 on T12.CPPROVINCE=T3.CUSTADDRPROVINCE
		inner join RMTPROVINCEVSCITY T13 on T13.PCCITY=T3.CUSTADDRCITY
		inner join RMTCOUNTRYVSPROVINCE T14 on T14.CPPROVINCE=T10.STATECODE
		inner join RMTPROVINCEVSCITY T15 on T15.PCCITY=T10.CITYCODE	 
	 </createView>
	</changeSet>
	
	<changeSet id="2" author="somasekhar">
	 <sql>
	 
	  
	  insert into SecRights values((select max(rightid) from secrights)+1,0,'menuItem_CustomerTemplates_Prov_Certificate','MENU',1,1000,CURRENT_timestamp,'','','','','','',0);
	  insert into SecRights values((select max(rightid) from secrights)+1,0,'menuItem_CustomerTemplates_InterestCertificate','MENU',1,1000,CURRENT_timestamp,'','','','','','',0);
	  
	  insert into Secgroups values((select max(grpid) from secgroups)+1,'InterestCertificate_MAKER','Maker for Interest Certificate',0,1000,CURRENT_timestamp,'','','','','','',0);
      insert into Secgroups values((select max(grpid) from secgroups)+1,'InterestCertificate_APPROVER','Aprover for Interest Certificate',0,1000,CURRENT_timestamp,'','','','','','',0);
	  
	  
	  insert into secgrouprights values((select max(grprightid) from secgrouprights)+1,(select grpid from secgroups where grpcode='InterestCertificate_MAKER'),(select rightid from secrights where rightname='menuItem_CustomerTemplates_Prov_Certificate'),1,0,1000,current_timestamp,'Aproved','','','','','',0);
	  insert into secgrouprights values((select max(grprightid) from secgrouprights)+1,(select grpid from secgroups where grpcode='InterestCertificate_MAKER'),(select rightid from secrights where rightname='menuItem_CustomerTemplates_InterestCertificate'),1,0,1000,current_timestamp,'Aproved','','','','','',0);
	  
	  insert into secgrouprights values((select max(grprightid) from secgrouprights)+1,(select grpid from secgroups where grpcode='InterestCertificate_APPROVER'),(select rightid from secrights where rightname='menuItem_CustomerTemplates_Prov_Certificate'),1,0,1000,current_timestamp,'Aproved','','','','','',0);
	  insert into secgrouprights values((select max(grprightid) from secgrouprights)+1,(select grpid from secgroups where grpcode='InterestCertificate_APPROVER'),(select rightid from secrights where rightname='menuItem_CustomerTemplates_InterestCertificate'),1,0,1000,current_timestamp,'Aproved','','','','','',0);
	  
	  
	  Update SeqSecRights set SeqNo = (select MAX(RightID) from SecRights);
	  Update SeqSecGroups set SeqNo = (select MAX(GrpID) from SecGroups);
	  Update SeqSecGroupRights set SeqNo = (select MAX(GrpRightID) from SecGroupRights);
	  
	 </sql>
	</changeSet>
	
	<changeSet id="3" author="somasekhar">
	 <createView replaceIfExists="true" viewName="INTERESTCERTIFICATE">
	    select T2.CUSTSHRTNAME as CUSTNAME,T3.CUSTADDRHNBR ,T3.CUSTADDRSTREET,T11.COUNTRYDESC,
		T12.CPPROVINCENAME as CUSTADDRSTATE,T13.PCCITYNAME as CUSTADDRCITY,T3.CUSTADDRZIP,
		T1.FINREFERENCE,T4.CUSTEMAIL,T5.PHONENUMBER as CUSTPHONENUMBER,T6.FINTYPEDESC,(select string_agg(TE.CUSTSHRTNAME,', 'ORDER BY TE.CUSTSHRTNAME)
		from CUSTOMERS TE where CUSTCIF in (select CUSTCIF from FINJOINTACCOUNTDETAILS T7 where T7.FINREFERENCE=T1.FINREFERENCE)) COAPPLICANT,
		T8.FINASSETVALUE,T8.EFFECTIVERATEOFRETURN as EFFECTIVERATE ,T10.ENTITYCODE,T10.ENTITYDESC,T10.PANNUMBER as ENTITYPANNUMBER,T10.ENTITYADDRHNBR,T10.ENTITYFLATNBR,T10.ENTITYADDRSTREET,
		T14.CPPROVINCENAME as ENTITYSTATE,T15.PCCITYNAME as ENTITYCITY,T10.pincode as entityZip,
		T1.FINPOSTDATE,T1.FINSCHDPFTPAID,T1.FINSCHDPRIPAID,T8.FINCCY,T8.finAssetValue as FinAmount,T8.fintype
		from FINREPAYDETAILS T1 
		inner join FINANCEMAIN T8 on T8.FINREFERENCE =T1.FINREFERENCE 
		inner join CUSTOMERS T2 on T2.CUSTID=T8.CUSTID 
		inner join CUSTOMERADDRESSES T3 on T3.CUSTID=T8.CUSTID and T3.CUSTADDRPRIORITY=5
		inner join CUSTOMEREMAILS T4 on T4.CUSTID=T8.CUSTID and T4.CUSTEMAILPRIORITY=5
		inner join CUSTOMERPHONENUMBERS T5 on T5.PHONECUSTID=T8.CUSTID and T5.PHONETYPEPRIORITY=5
		inner join RMTFINANCETYPES T6 on T6.FINTYPE=T8.FINTYPE
		inner join SMTDIVISIONDETAIL T9 on T9.DIVISIONCODE=T6.FINDIVISION
		inner join ENTITY T10 on T10.ENTITYCODE=T9.ENTITYCODE
		inner join BMTCOUNTRIES T11 on T11.COUNTRYCODE=T3.CUSTADDRCOUNTRY
		inner join RMTCOUNTRYVSPROVINCE T12 on T12.CPPROVINCE=T3.CUSTADDRPROVINCE
		inner join RMTPROVINCEVSCITY T13 on T13.PCCITY=T3.CUSTADDRCITY
		inner join RMTCOUNTRYVSPROVINCE T14 on T14.CPPROVINCE=T10.STATECODE
		inner join RMTPROVINCEVSCITY T15 on T15.PCCITY=T10.CITYCODE
	 </createView>
	</changeSet>
	
	<changeSet id="4" author="somasekhar">
	 <dropView viewName="INTERESTCERTIFICATE"/>
	</changeSet>
	
	<changeSet id="5" author="somasekhar">
	 <createView replaceIfExists="true" viewName="INTERESTCERTIFICATE_VIEW">
	  select T2.CUSTSHRTNAME as CUSTNAME,T3.CUSTADDRHNBR ,T3.CUSTADDRSTREET,T11.COUNTRYDESC,
		T12.CPPROVINCENAME as CUSTADDRSTATE,T13.PCCITYNAME as CUSTADDRCITY,T3.CUSTADDRZIP,
		T1.FINREFERENCE,T4.CUSTEMAIL,T5.PHONENUMBER as CUSTPHONENUMBER,T6.FINTYPEDESC,(select string_agg(TE.CUSTSHRTNAME,', 'ORDER BY TE.CUSTSHRTNAME)
		from CUSTOMERS TE where CUSTCIF in (select CUSTCIF from FINJOINTACCOUNTDETAILS T7 where T7.FINREFERENCE=T1.FINREFERENCE)) COAPPLICANT,
		T8.FINASSETVALUE,T8.EFFECTIVERATEOFRETURN as EFFECTIVERATE ,T10.ENTITYCODE,T10.ENTITYDESC,T10.PANNUMBER as ENTITYPANNUMBER,T10.ENTITYADDRHNBR,T10.ENTITYFLATNBR,T10.ENTITYADDRSTREET,
		T14.CPPROVINCENAME as ENTITYSTATE,T15.PCCITYNAME as ENTITYCITY,T10.pincode as entityZip,
		T1.FINPOSTDATE,T1.FINSCHDPFTPAID,T1.FINSCHDPRIPAID,T8.FINCCY,T8.finAssetValue as FinAmount,T8.fintype,t3.CUSTFLATNBR
		from FINREPAYDETAILS T1 
		inner join FINANCEMAIN T8 on T8.FINREFERENCE =T1.FINREFERENCE 
		inner join CUSTOMERS T2 on T2.CUSTID=T8.CUSTID 
		inner join CUSTOMERADDRESSES T3 on T3.CUSTID=T8.CUSTID and T3.CUSTADDRPRIORITY=5
		inner join CUSTOMEREMAILS T4 on T4.CUSTID=T8.CUSTID and T4.CUSTEMAILPRIORITY=5
		inner join CUSTOMERPHONENUMBERS T5 on T5.PHONECUSTID=T8.CUSTID and T5.PHONETYPEPRIORITY=5
		inner join RMTFINANCETYPES T6 on T6.FINTYPE=T8.FINTYPE
		inner join SMTDIVISIONDETAIL T9 on T9.DIVISIONCODE=T6.FINDIVISION
		inner join ENTITY T10 on T10.ENTITYCODE=T9.ENTITYCODE
		inner join BMTCOUNTRIES T11 on T11.COUNTRYCODE=T3.CUSTADDRCOUNTRY
		inner join RMTCOUNTRYVSPROVINCE T12 on T12.CPPROVINCE=T3.CUSTADDRPROVINCE
		inner join RMTPROVINCEVSCITY T13 on T13.PCCITY=T3.CUSTADDRCITY
		inner join RMTCOUNTRYVSPROVINCE T14 on T14.CPPROVINCE=T10.STATECODE
		inner join RMTPROVINCEVSCITY T15 on T15.PCCITY=T10.CITYCODE
	 </createView>
	</changeSet>
	
	<changeSet id="6" author="somasekhar">
	 <createView replaceIfExists="true" viewName="INTERESTCERTIFICATE_VIEW">
	  select T2.CUSTSHRTNAME as CUSTNAME,T3.CUSTADDRHNBR ,T3.CUSTADDRSTREET,T11.COUNTRYDESC,
		T12.CPPROVINCENAME as CUSTADDRSTATE,T13.PCCITYNAME as CUSTADDRCITY,T3.CUSTADDRZIP,
		T8.FINREFERENCE,T4.CUSTEMAIL,T5.PHONENUMBER as CUSTPHONENUMBER,T6.FINTYPEDESC,(select string_agg(TE.CUSTSHRTNAME,', 'ORDER BY TE.CUSTSHRTNAME)
		from CUSTOMERS TE where CUSTCIF in (select CUSTCIF from FINJOINTACCOUNTDETAILS T7 where T7.FINREFERENCE=T8.FINREFERENCE)) COAPPLICANT,
		T8.FINASSETVALUE,T8.EFFECTIVERATEOFRETURN as EFFECTIVERATE ,T10.ENTITYCODE,T10.ENTITYDESC,T10.PANNUMBER as ENTITYPANNUMBER,T10.ENTITYADDRHNBR,T10.ENTITYFLATNBR,T10.ENTITYADDRSTREET,
		T14.CPPROVINCENAME as ENTITYSTATE,T15.PCCITYNAME as ENTITYCITY,T10.pincode as entityZip,
		T1.FINPOSTDATE,T1.FINSCHDPFTPAID,T1.FINSCHDPRIPAID,T8.FINCCY,T8.finAssetValue as FinAmount,T8.fintype,t3.CUSTFLATNBR
		from  FINANCEMAIN T8
		left join FINREPAYDETAILS T1 on T8.FINREFERENCE =T1.FINREFERENCE 
		inner join CUSTOMERS T2 on T2.CUSTID=T8.CUSTID 
		left join CUSTOMERADDRESSES T3 on T3.CUSTID=T8.CUSTID and T3.CUSTADDRPRIORITY=5
		left join CUSTOMEREMAILS T4 on T4.CUSTID=T8.CUSTID and T4.CUSTEMAILPRIORITY=5
		left join CUSTOMERPHONENUMBERS T5 on T5.PHONECUSTID=T8.CUSTID and T5.PHONETYPEPRIORITY=5
		inner join RMTFINANCETYPES T6 on T6.FINTYPE=T8.FINTYPE
		inner join SMTDIVISIONDETAIL T9 on T9.DIVISIONCODE=T6.FINDIVISION
		inner join ENTITY T10 on T10.ENTITYCODE=T9.ENTITYCODE
		left join BMTCOUNTRIES T11 on T11.COUNTRYCODE=T3.CUSTADDRCOUNTRY
		left join RMTCOUNTRYVSPROVINCE T12 on T12.CPPROVINCE=T3.CUSTADDRPROVINCE
		left join RMTPROVINCEVSCITY T13 on T13.PCCITY=T3.CUSTADDRCITY
		left join RMTCOUNTRYVSPROVINCE T14 on T14.CPPROVINCE=T10.STATECODE
		inner join RMTPROVINCEVSCITY T15 on T15.PCCITY=T10.CITYCODE
	 </createView>
	</changeSet>
</databaseChangeLog>