<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />
	
		<changeSet author="Kesav" id="01">
		<renameColumn columnDataType="varchar2(15)" newColumnName="ProfitCenterID"
			oldColumnName="ProfitCentre" tableName="PartnerBanks" />
	</changeSet>
	<changeSet author="Kesav" id="02">
		<renameColumn columnDataType="varchar2(15)" newColumnName="CostCenterID"
			oldColumnName="CrossCentre" tableName="PartnerBanks" />
	</changeSet>
	
	<changeSet author="Kesav" id="03">
		<renameColumn columnDataType="varchar2(15)" newColumnName="ProfitCenterID"
			oldColumnName="ProfitCentre" tableName="PartnerBanks_Temp" />
	</changeSet>
	<changeSet author="Kesav" id="04">
		<renameColumn columnDataType="varchar2(15)" newColumnName="CostCenterID"
			oldColumnName="CrossCentre" tableName="PartnerBanks_Temp" />
	</changeSet>
	
	<changeSet author="Kesav" id="05">
		<createView viewName="PARTNERBANKS_AVIEW" replaceIfExists="true">
			SELECT 		T1.PartnerBankId, T1.PartnerBankCode, T1.PartnerBankName, T1.BankCode, T1.BankBranchCode, T1.BranchMICRCode, T1.BranchIFSCCode, T1.BranchCity, T1.UtilityCode, T1.AccountNo, T1.AcType,
						T1.AlwFileDownload, T1.AlwDisb, T1.AlwPayment, T1.AlwReceipt, T1.InFavourLength, T1.Active, T1.Version , T1.LastMntBy, T1.LastMntOn, T1.RecordStatus, 
						T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId,T2.BankName BankCodeName,T3.BranchDesc BankBranchCodeName,
						T4.AcTypeDesc AcTypeName,T1.HostGLCode, T1.ProfitCenterID, T1.CostCenterID
			FROM    	PartnerBanks  T1 INNER JOIN
						BMTBANKDETAIL T2  on T1.BANKCODE=T2.BANKCODE INNER JOIN
						BankBranches T3  ON T1.BankBranchCode = T3.BranchCode and T1.bankcode=T3.bankcode INNER JOIN
						RMTACCOUNTTYPES T4 on T1.ACTYPE = T4.ACTYPE
						
		</createView>
	</changeSet>
	
	<changeSet author="Kesav" id="06">
		<createView viewName="PARTNERBANKS_VIEW" replaceIfExists="true">
			SELECT 		T1.PartnerBankId, T1.PartnerBankCode, T1.PartnerBankName, T1.BankCode, T1.BankBranchCode, T1.BranchMICRCode, T1.BranchIFSCCode, T1.BranchCity, T1.UtilityCode, 
						T1.AccountNo, T1.AcType, T1.AlwFileDownload, T1.AlwDisb, T1.AlwPayment, T1.AlwReceipt, T1.InFavourLength, T1.Active, T1.Version , T1.LastMntBy, T1.LastMntOn,
						T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId,T2.BankName BankCodeName,T3.BranchDesc BankBranchCodeName,
						T4.AcTypeDesc AcTypeName,T1.HostGLCode, T1.ProfitCenterID, T1.CostCenterID
			FROM    	PARTNERBANKS_Temp  T1 INNER JOIN
						BMTBANKDETAIL T2  on T1.BANKCODE=T2.BANKCODE inner join
						BankBranches T3  ON T1.BankBranchCode = T3.BranchCode and T1.bankcode=T3.bankcode INNER JOIN
						RMTAccountTypes T4 ON T1.AcType = T4.AcType
			UNION ALL
			SELECT 		T1.PartnerBankId, T1.PartnerBankCode, T1.PartnerBankName, T1.BankCode, T1.BankBranchCode, T1.BranchMICRCode, T1.BranchIFSCCode, T1.BranchCity, T1.UtilityCode,
						T1.AccountNo, T1.AcType, T1.AlwFileDownload, T1.AlwDisb, T1.AlwPayment, T1.AlwReceipt, T1.InFavourLength, T1.Active, T1.Version , T1.LastMntBy, T1.LastMntOn, 
						T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId,T2.BankName BankCodeName,T3.BranchDesc BankBranchCodeName,
						T4.AcTypeDesc AcTypeName,T1.HostGLCode, T1.ProfitCenterID, T1.CostCenterID
			FROM    	PartnerBanks  T1 INNER JOIN
			            BMTBankDetail T2  ON T1.BankCode=T2.BankCode INNER JOIN
						BankBranches T3  ON T1.BankBranchCode = T3.BranchCode and T1.bankcode=T3.bankcode INNER JOIN
						RMTAccountTypes T4 ON T1.AcType = T4.AcType						
			WHERE     	NOT EXISTS (SELECT 1 FROM PartnerBanks_TEMP WHERE PartnerBankId = T1.PartnerBankId)						
		</createView>
	</changeSet>
	<changeSet author="Durga Prasad D" id="08">
		<sql>
		INSERT INTO ErrorDetails VALUES('90268','EN','E','{0} should be equal to {1} for feeCode:{2}.','','Approved','','','','','',0,CURRENT_TIMESTAMP,1000,0);
		INSERT INTO ErrorDetails VALUES('90269','EN','E','{0} is not applicable for feeCode:{1}.','','Approved','','','','','',0,CURRENT_TIMESTAMP,1000,0);
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="10">
		<addColumn tableName="AccountMapping">
			<column name="ProfitCenterID" type="bigint"/>
			<column name="CostCenterID" type="bigint"/>
		</addColumn>
	</changeSet>
	
	<changeSet author="Kesav" id="11">
		<addColumn tableName="AccountMapping_Temp">
			<column name="ProfitCenterID" type="bigint"/>
			<column name="CostCenterID" type="bigint"/>
		</addColumn>
	</changeSet>
	<changeSet id="16" author="Srikanth">
		<sql>
		Delete From ErrorDetails where ErrorCode in('90103','90263'); 
		INSERT INTO ErrorDetails VALUES('90103','EN','E','Invalid guarantor customer with cif {0}.','','Approved','','','','','',0,CURRENT_TIMESTAMP,1000,0);
		INSERT INTO ErrorDetails VALUES('90263','EN','E','Partner bankId should be match with configured LoanType and disbursement type.','','Approved','','','','','',0,CURRENT_TIMESTAMP,1000,0);
		INSERT INTO ErrorDetails VALUES('90264','EN','E','{0} should be equal to configured value in Loantype i.e {1}.','','Approved','','','','','',0,CURRENT_TIMESTAMP,1000,0);
		</sql>
	</changeSet>
	
	<changeSet id="07" author="Manojkumar.P">
		<createView viewName="DE_DISBURSE_FILE_CONTROL_VIEW" replaceIfExists="true">
			SELECT DISTINCT(DS.ID), DC.NAME, DC.UPLOADPATH FILELOCATION, DS.FILENAME,  DS.STATUS, 
			PB.ALWFILEDOWNLOAD,  PB.PARTNERBANKID, PB.PARTNERBANKCODE, PB.PARTNERBANKNAME, PL.REFNO2 PAYMENTTYPE
			FROM DATA_ENGINE_CONFIG DC
			INNER JOIN DATA_ENGINE_STATUS DS ON DS.NAME = DC.NAME 
			INNER JOIN DATA_ENGINE_PROCESS_LOG PL ON PL.FILEID=DS.ID
			INNER JOIN PARTNERBANKS PB ON PB.PARTNERBANKID=PL.REFID2 
      		ORDER BY DS.ID DESC
		</createView>
	</changeSet>
	
	<changeSet id="15" author="Manojkumar.P">
	 	<sql>
	   	 UPDATE DATA_ENGINE_COLUMN SET DERIVEDFROM = '${USER_NAME}', REFERENCECOLUMN = NULL  WHERE ID = (SELECT ID FROM DATA_ENGINE_COLUMN WHERE TABLEID = (SELECT ID FROM DATA_ENGINE_TABLE WHERE CONFIGID IN (SELECT ID FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT') AND NAME ='INTERFACE_MANDATE_REG_VIEW') AND NAME = 'USERNAME');
	     UPDATE DATA_ENGINE_CONFIG SET FILEPREFIXNAME = '${PAYMENT_TYPE}', FILENAMEFORMAT = '${PARTNER_BANK_CODE}, ${ddMMYYH24MM}', FILEEXTENSION = '.CSV' WHERE NAME = 'DISB_OTHER_NEFT_RTGS_EXPORT';
		 UPDATE DATA_ENGINE_CONFIG SET FILEPREFIXNAME = '${PAYMENT_TYPE}', FILENAMEFORMAT = '${PARTNER_BANK_CODE}, ${ddMMYYH24MM}', FILEEXTENSION = '.CSV' WHERE NAME = 'DISB_OTHER_CHEQUE_DD_EXPORT';
	 	</sql>
	</changeSet>
	
	<changeSet id="09" author="Amit">
		<addForeignKeyConstraint constraintName="FK_EMYRDTL_RMTEmpTypes"
			baseTableName="EmployerDetail" baseColumnNames="EMPINDUSTRY"
			referencedTableName="RMTEmpTypes" referencedColumnNames="EMPTYPE" />
	</changeSet>
	
	<changeSet id="12" author="Amit">
		<addForeignKeyConstraint constraintName="FK_EMYRDTL_TEMP_RMTEmpTypes"
			baseTableName="EMPLOYERDETAIL_TEMP" baseColumnNames="EMPINDUSTRY"
			referencedTableName="RMTEmpTypes" referencedColumnNames="EMPTYPE" />
	</changeSet>

	<changeSet id="13" author="Prakash">
		<addForeignKeyConstraint constraintName="FK_CustEmpDtls_GenDes"
			baseTableName="CustomerEmpDetails" baseColumnNames="CustEmpDesg"
			referencedTableName="RMTGenDesignations" referencedColumnNames="GenDesignation" />
	</changeSet>
   
   <changeSet id="14" author="Prakash">
		<addForeignKeyConstraint constraintName="FK_CustEmpDtls_Temp_GenDes"
			baseTableName="CustomerEmpDetails_Temp" baseColumnNames="CustEmpDesg"
			referencedTableName="RMTGenDesignations" referencedColumnNames="GenDesignation" />
	</changeSet>
</databaseChangeLog>