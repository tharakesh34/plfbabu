<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />
	
		<changeSet author="Kesav" id="01">
		<renameColumn columnDataType="varchar2(15)" newColumnName="ProfitCenterID"
			oldColumnName="ProfitCentre" tableName="PartnerBanks" />
	</changeSet>
	<changeSet author="Kesav" id="02">
		<renameColumn columnDataType="varchar2(15)" newColumnName="CostCenterID"
			oldColumnName="CrossCentre" tableName="PartnerBanks" />
	</changeSet>
	
	<changeSet author="Kesav" id="03">
		<renameColumn columnDataType="varchar2(15)" newColumnName="ProfitCenterID"
			oldColumnName="ProfitCentre" tableName="PartnerBanks_Temp" />
	</changeSet>
	<changeSet author="Kesav" id="04">
		<renameColumn columnDataType="varchar2(15)" newColumnName="CostCenterID"
			oldColumnName="CrossCentre" tableName="PartnerBanks_Temp" />
	</changeSet>
	
	<changeSet author="Kesav" id="05">
		<createView viewName="PARTNERBANKS_AVIEW" replaceIfExists="true">
			SELECT 		T1.PartnerBankId, T1.PartnerBankCode, T1.PartnerBankName, T1.BankCode, T1.BankBranchCode, T1.BranchMICRCode, T1.BranchIFSCCode, T1.BranchCity, T1.UtilityCode, T1.AccountNo, T1.AcType,
						T1.AlwFileDownload, T1.AlwDisb, T1.AlwPayment, T1.AlwReceipt, T1.InFavourLength, T1.Active, T1.Version , T1.LastMntBy, T1.LastMntOn, T1.RecordStatus, 
						T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId,T2.BankName BankCodeName,T3.BranchDesc BankBranchCodeName,
						T4.AcTypeDesc AcTypeName,T1.HostGLCode, T1.ProfitCenterID, T1.CostCenterID
			FROM    	PartnerBanks  T1 INNER JOIN
						BMTBANKDETAIL T2  on T1.BANKCODE=T2.BANKCODE INNER JOIN
						BankBranches T3  ON T1.BankBranchCode = T3.BranchCode and T1.bankcode=T3.bankcode INNER JOIN
						RMTACCOUNTTYPES T4 on T1.ACTYPE = T4.ACTYPE
						
		</createView>
	</changeSet>
	
	<changeSet author="Kesav" id="06">
		<createView viewName="PARTNERBANKS_VIEW" replaceIfExists="true">
			SELECT 		T1.PartnerBankId, T1.PartnerBankCode, T1.PartnerBankName, T1.BankCode, T1.BankBranchCode, T1.BranchMICRCode, T1.BranchIFSCCode, T1.BranchCity, T1.UtilityCode, 
						T1.AccountNo, T1.AcType, T1.AlwFileDownload, T1.AlwDisb, T1.AlwPayment, T1.AlwReceipt, T1.InFavourLength, T1.Active, T1.Version , T1.LastMntBy, T1.LastMntOn,
						T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId,T2.BankName BankCodeName,T3.BranchDesc BankBranchCodeName,
						T4.AcTypeDesc AcTypeName,T1.HostGLCode, T1.ProfitCenterID, T1.CostCenterID
			FROM    	PARTNERBANKS_Temp  T1 INNER JOIN
						BMTBANKDETAIL T2  on T1.BANKCODE=T2.BANKCODE inner join
						BankBranches T3  ON T1.BankBranchCode = T3.BranchCode and T1.bankcode=T3.bankcode INNER JOIN
						RMTAccountTypes T4 ON T1.AcType = T4.AcType
			UNION ALL
			SELECT 		T1.PartnerBankId, T1.PartnerBankCode, T1.PartnerBankName, T1.BankCode, T1.BankBranchCode, T1.BranchMICRCode, T1.BranchIFSCCode, T1.BranchCity, T1.UtilityCode,
						T1.AccountNo, T1.AcType, T1.AlwFileDownload, T1.AlwDisb, T1.AlwPayment, T1.AlwReceipt, T1.InFavourLength, T1.Active, T1.Version , T1.LastMntBy, T1.LastMntOn, 
						T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId,T2.BankName BankCodeName,T3.BranchDesc BankBranchCodeName,
						T4.AcTypeDesc AcTypeName,T1.HostGLCode, T1.ProfitCenterID, T1.CostCenterID
			FROM    	PartnerBanks  T1 INNER JOIN
			            BMTBankDetail T2  ON T1.BankCode=T2.BankCode INNER JOIN
						BankBranches T3  ON T1.BankBranchCode = T3.BranchCode and T1.bankcode=T3.bankcode INNER JOIN
						RMTAccountTypes T4 ON T1.AcType = T4.AcType						
			WHERE     	NOT EXISTS (SELECT 1 FROM PartnerBanks_TEMP WHERE PartnerBankId = T1.PartnerBankId)						
		</createView>
	</changeSet>
	<changeSet author="Durga Prasad D" id="08">
		<sql>
		INSERT INTO ErrorDetails VALUES('90268','EN','E','{0} should be equal to {1} for feeCode:{2}.','','Approved','','','','','',0,CURRENT_TIMESTAMP,1000,0);
		INSERT INTO ErrorDetails VALUES('90269','EN','E','{0} is not applicable for feeCode:{1}.','','Approved','','','','','',0,CURRENT_TIMESTAMP,1000,0);
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="10">
		<addColumn tableName="AccountMapping">
			<column name="ProfitCenterID" type="bigint"/>
			<column name="CostCenterID" type="bigint"/>
		</addColumn>
	</changeSet>
	
	<changeSet author="Kesav" id="11">
		<addColumn tableName="AccountMapping_Temp">
			<column name="ProfitCenterID" type="bigint"/>
			<column name="CostCenterID" type="bigint"/>
		</addColumn>
	</changeSet>
	<changeSet id="16" author="Srikanth">
		<sql>
		Delete From ErrorDetails where ErrorCode in('90103','90263'); 
		INSERT INTO ErrorDetails VALUES('90103','EN','E','Invalid guarantor customer with cif {0}.','','Approved','','','','','',0,CURRENT_TIMESTAMP,1000,0);
		INSERT INTO ErrorDetails VALUES('90263','EN','E','Partner bankId should be match with configured LoanType and disbursement type.','','Approved','','','','','',0,CURRENT_TIMESTAMP,1000,0);
		INSERT INTO ErrorDetails VALUES('90264','EN','E','{0} should be equal to configured value in Loantype i.e {1}.','','Approved','','','','','',0,CURRENT_TIMESTAMP,1000,0);
		</sql>
	</changeSet>
	
	<changeSet id="07" author="Manojkumar.P">
		<createView viewName="DE_DISBURSE_FILE_CONTROL_VIEW" replaceIfExists="true">
			SELECT DISTINCT(DS.ID), DC.NAME, DC.UPLOADPATH FILELOCATION, DS.FILENAME,  DS.STATUS, 
			PB.ALWFILEDOWNLOAD,  PB.PARTNERBANKID, PB.PARTNERBANKCODE, PB.PARTNERBANKNAME, PL.REFNO2 PAYMENTTYPE
			FROM DATA_ENGINE_CONFIG DC
			INNER JOIN DATA_ENGINE_STATUS DS ON DS.NAME = DC.NAME 
			INNER JOIN DATA_ENGINE_PROCESS_LOG PL ON PL.FILEID=DS.ID
			INNER JOIN PARTNERBANKS PB ON PB.PARTNERBANKID=PL.REFID2 
      		ORDER BY DS.ID DESC
		</createView>
	</changeSet>
	
	<changeSet id="15" author="Manojkumar.P">
	 	<sql>
	   	 UPDATE DATA_ENGINE_COLUMN SET DERIVEDFROM = '${USER_NAME}', REFERENCECOLUMN = NULL  WHERE ID = (SELECT ID FROM DATA_ENGINE_COLUMN WHERE TABLEID = (SELECT ID FROM DATA_ENGINE_TABLE WHERE CONFIGID IN (SELECT ID FROM DATA_ENGINE_CONFIG WHERE Name = 'MANDATES_EXPORT') AND NAME ='INTERFACE_MANDATE_REG_VIEW') AND NAME = 'USERNAME');
	     UPDATE DATA_ENGINE_CONFIG SET FILEPREFIXNAME = '${PAYMENT_TYPE}', FILENAMEFORMAT = '${PARTNER_BANK_CODE}, ${ddMMYYH24MM}', FILEEXTENSION = '.CSV' WHERE NAME = 'DISB_OTHER_NEFT_RTGS_EXPORT';
		 UPDATE DATA_ENGINE_CONFIG SET FILEPREFIXNAME = '${PAYMENT_TYPE}', FILENAMEFORMAT = '${PARTNER_BANK_CODE}, ${ddMMYYH24MM}', FILEEXTENSION = '.CSV' WHERE NAME = 'DISB_OTHER_CHEQUE_DD_EXPORT';
	 	</sql>
	</changeSet>
	
	<changeSet id="09" author="Amit">
		<addForeignKeyConstraint constraintName="FK_EMYRDTL_RMTEmpTypes"
			baseTableName="EmployerDetail" baseColumnNames="EMPINDUSTRY"
			referencedTableName="RMTEmpTypes" referencedColumnNames="EMPTYPE" />
	</changeSet>
	
	<changeSet id="12" author="Amit">
		<addForeignKeyConstraint constraintName="FK_EMYRDTL_TEMP_RMTEmpTypes"
			baseTableName="EMPLOYERDETAIL_TEMP" baseColumnNames="EMPINDUSTRY"
			referencedTableName="RMTEmpTypes" referencedColumnNames="EMPTYPE" />
	</changeSet>

	<changeSet id="13" author="Prakash">
		<addForeignKeyConstraint constraintName="FK_CustEmpDtls_GenDes"
			baseTableName="CustomerEmpDetails" baseColumnNames="CustEmpDesg"
			referencedTableName="RMTGenDesignations" referencedColumnNames="GenDesignation" />
	</changeSet>
   
   <changeSet id="14" author="Prakash">
		<addForeignKeyConstraint constraintName="FK_CustEmpDtls_Temp_GenDes"
			baseTableName="CustomerEmpDetails_Temp" baseColumnNames="CustEmpDesg"
			referencedTableName="RMTGenDesignations" referencedColumnNames="GenDesignation" />
	</changeSet>
	
	<changeSet id="17" author="Durgaprasad G">
		<addColumn tableName="SMTDIVISIONDETAIL">
			<column name="ENTITYCODE" type="varchar(8)"/>
		</addColumn>
	</changeSet>
	
	<changeSet id="18" author="Kesav">
		<createView viewName="AccountMapping_View" replaceIfExists="true">
				SELECT		T1.Account, T1.HostAccount, T1.ProfitCenterID, T1.CostCenterID,		
				            T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, 
				          	T1.NextTaskId, T1.RecordType, T1.WorkflowId,
				          	T2.PROFITCENTERCODE, T2.PROFITCENTERDESC,
				          	T3.COSTCENTERCODE, T3.COSTCENTERDESC
				FROM    	AccountMapping_Temp  T1  INNER JOIN
				         	ProfitCenters T2 ON T1.ProfitCenterID = T2.ProfitCenterID  INNER JOIN
				         	CostCenters T3 ON T1.CostCenterID = T3.CostCenterID
				UNION ALL
				
				SELECT		T1.Account, T1.HostAccount, T1.ProfitCenterID, T1.CostCenterID,		
				          	T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, 
				         	T1.NextTaskId, T1.RecordType, T1.WorkflowId,
				          	T2.PROFITCENTERCODE, T2.PROFITCENTERDESC,
				          	T3.COSTCENTERCODE, T3.COSTCENTERDESC
				FROM    	AccountMapping  T1  INNER JOIN
				          	ProfitCenters T2 ON T1.ProfitCenterID = T2.ProfitCenterID  INNER JOIN
				          	CostCenters T3 ON T1.CostCenterID = T3.CostCenterID
				          
				WHERE     	NOT EXISTS (SELECT 1 FROM AccountMapping_TEMP WHERE Account = T1.Account)
		</createView>
	</changeSet>
	
	<changeSet id="19" author="Kesav">
		<createView viewName="AccountMapping_AView" replaceIfExists="true">
				SELECT		T1.Account, T1.HostAccount, T1.ProfitCenterID, T1.CostCenterID,		
				          	T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, 
				         	T1.NextTaskId, T1.RecordType, T1.WorkflowId,
				          	T2.PROFITCENTERCODE, T2.PROFITCENTERDESC,
				          	T3.COSTCENTERCODE, T3.COSTCENTERDESC
				FROM    	AccountMapping  T1  INNER JOIN
				          	ProfitCenters T2 ON T1.ProfitCenterID = T2.ProfitCenterID  INNER JOIN
				          	CostCenters T3 ON T1.CostCenterID = T3.CostCenterID
		</createView>
	</changeSet>
	
	<changeSet id="20" author="Kesav">
		<createView viewName="AccountMapping_View" replaceIfExists="true">
				SELECT		T1.Account, T1.HostAccount, T1.ProfitCenterID, T1.CostCenterID,	T1.FinType,	
				            T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, 
				          	T1.NextTaskId, T1.RecordType, T1.WorkflowId,
				          	T2.PROFITCENTERCODE, T2.PROFITCENTERDESC,
				          	T3.COSTCENTERCODE, T3.COSTCENTERDESC
				FROM    	AccountMapping_Temp  T1  INNER JOIN
				         	ProfitCenters T2 ON T1.ProfitCenterID = T2.ProfitCenterID  INNER JOIN
				         	CostCenters T3 ON T1.CostCenterID = T3.CostCenterID
				UNION ALL
				
				SELECT		T1.Account, T1.HostAccount, T1.ProfitCenterID, T1.CostCenterID,	T1.FinType,	
				          	T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, 
				         	T1.NextTaskId, T1.RecordType, T1.WorkflowId,
				          	T2.PROFITCENTERCODE, T2.PROFITCENTERDESC,
				          	T3.COSTCENTERCODE, T3.COSTCENTERDESC
				FROM    	AccountMapping  T1  INNER JOIN
				          	ProfitCenters T2 ON T1.ProfitCenterID = T2.ProfitCenterID  INNER JOIN
				          	CostCenters T3 ON T1.CostCenterID = T3.CostCenterID
				          
				WHERE     	NOT EXISTS (SELECT 1 FROM AccountMapping_TEMP WHERE Account = T1.Account)
		</createView>
	</changeSet>
	
	<changeSet id="21" author="Kesav">
		<createView viewName="AccountMapping_AView" replaceIfExists="true">
				SELECT		T1.Account, T1.HostAccount, T1.ProfitCenterID, T1.CostCenterID,	T1.FinType,	
				          	T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, 
				         	T1.NextTaskId, T1.RecordType, T1.WorkflowId,
				          	T2.PROFITCENTERCODE, T2.PROFITCENTERDESC,
				          	T3.COSTCENTERCODE, T3.COSTCENTERDESC
				FROM    	AccountMapping  T1  INNER JOIN
				          	ProfitCenters T2 ON T1.ProfitCenterID = T2.ProfitCenterID  INNER JOIN
				          	CostCenters T3 ON T1.CostCenterID = T3.CostCenterID
		</createView>
	</changeSet>
	
		<changeSet id="22" author="Durgaprasad G">
		<dropNotNullConstraint tableName="PRESENTMENTHEADER"
			columnName="PARTNERBANKID" columnDataType="NUMBER(19)" />
	  </changeSet>
	  
	  <changeSet id="24" author="Siva">
		<addColumn tableName="FinRepayScheduleDetail">
			<column name="PftSchdWaivedNow" type="decimal(18,0)" />
			<column name="LatePftSchdWaivedNow" type="decimal(18,0)" />
			<column name="PriSchdWaivedNow" type="decimal(18,0)" />
			<column name="SchdFeeWaivedNow" type="decimal(18,0)" />
			<column name="SchdInsWaivedNow" type="decimal(18,0)" />
			<column name="SchdSuplRentWaivedNow" type="decimal(18,0)" />
			<column name="SchdIncrCostWaivedNow" type="decimal(18,0)" />
		</addColumn>
	</changeSet>
	 <changeSet id="25" author="Siva">
		<addColumn tableName="FinRepayScheduleDetail_Temp">
			<column name="PftSchdWaivedNow" type="decimal(18,0)" />
			<column name="LatePftSchdWaivedNow" type="decimal(18,0)" />
			<column name="PriSchdWaivedNow" type="decimal(18,0)" />
			<column name="SchdFeeWaivedNow" type="decimal(18,0)" />
			<column name="SchdInsWaivedNow" type="decimal(18,0)" />
			<column name="SchdSuplRentWaivedNow" type="decimal(18,0)" />
			<column name="SchdIncrCostWaivedNow" type="decimal(18,0)" />
		</addColumn>
	</changeSet>
	<changeSet id="26" author="Prasad">
		<addColumn tableName="FinPftDetails">
			<column name="FutureRpyPri" type="decimal(18,0)" />
			<column name="FutureRpyPft" type="decimal(18,0)" />
			<column name="TotChargesPaid" type="decimal(18,0)" />
			<column name="LinkedFinRef" type="varchar(500)" />
			<column name="ClosedLinkedFinRef" type="varchar(500)" />
			<column name="UpFrontFee" type="decimal(18,0)" />
			<column name="LastDisbDate" type="Datetime" />
			<column name="BounceAmtDue" type="decimal(18,0)" />
			<column name="BounceAmtPaid" type="decimal(18,0)" />
			<column name="BounceAmt" type="decimal(18,0)" />
			<column name="ReceivableAdvise" type="decimal(18,0)" />
			<column name="ExcessAmtBal" type="decimal(18,0)" />
			<column name="EMIInAdvanceBal" type="decimal(18,0)" />
			<column name="ReceivableAdviseBal" type="decimal(18,0)" />
			<column name="PayableAdviseBal" type="decimal(18,0)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="27" author="Prasad">
		<addColumn tableName="FinPftDetails_Temp">
			<column name="FutureRpyPri" type="decimal(18,0)" />
			<column name="FutureRpyPft" type="decimal(18,0)" />
			<column name="TotChargesPaid" type="decimal(18,0)" />
			<column name="LinkedFinRef" type="varchar(500)" />
			<column name="ClosedLinkedFinRef" type="varchar(500)" />
			<column name="UpFrontFee" type="decimal(18,0)" />
			<column name="LastDisbDate" type="Datetime" />
			<column name="BounceAmtDue" type="decimal(18,0)" />
			<column name="BounceAmtPaid" type="decimal(18,0)" />
			<column name="BounceAmt" type="decimal(18,0)" />
			<column name="ReceivableAdvise" type="decimal(18,0)" />
			<column name="ExcessAmtBal" type="decimal(18,0)" />
			<column name="EMIInAdvanceBal" type="decimal(18,0)" />
			<column name="ReceivableAdviseBal" type="decimal(18,0)" />
			<column name="PayableAdviseBal" type="decimal(18,0)" />
		</addColumn>
	</changeSet>
	
		<changeSet id="28" author="Prasad">
		<addColumn tableName="FinPftDetails_SnapShot">
			<column name="FutureRpyPri" type="decimal(18,0)" />
			<column name="FutureRpyPft" type="decimal(18,0)" />
			<column name="TotChargesPaid" type="decimal(18,0)" />
			<column name="LinkedFinRef" type="varchar(500)" />
			<column name="ClosedLinkedFinRef" type="varchar(500)" />
			<column name="UpFrontFee" type="decimal(18,0)" />
			<column name="LastDisbDate" type="Datetime" />
			<column name="BounceAmtDue" type="decimal(18,0)" />
			<column name="BounceAmtPaid" type="decimal(18,0)" />
			<column name="BounceAmt" type="decimal(18,0)" />
			<column name="ReceivableAdvise" type="decimal(18,0)" />
			<column name="ExcessAmtBal" type="decimal(18,0)" />
			<column name="EMIInAdvanceBal" type="decimal(18,0)" />
			<column name="ReceivableAdviseBal" type="decimal(18,0)" />
			<column name="PayableAdviseBal" type="decimal(18,0)" />
		</addColumn>
	</changeSet>
	<changeSet id="29" author="Prasad">
		<createView viewName="RPT_SOA_LOAN_VIEW" replaceIfExists="true">
				 Select FM.FinReference,FM.finamount/100 LoanAmount,
		   FM.RepayBaseRate PLRRate,FM.repaymargin Variance,FM.EffectiveRateOfReturn IRR,FP.CURREDUCINGRATE ROI,
		   FP.noinst Tenure,(TotalPriPaid + TotalPftPaid)/100 EMIReceived,
		   0.00 PreferredCardLimit,(PRVRPYSCHPRI + PRVRPYSCHPFT)/100 PrevInstAmt,
		   FM.RepayRateBasis intRateType,FP.LastDisbDate LastDisbursalDate,
		   FP.FirstRepayDate FirstDueDate,FP.MaturityDate EndInstallmentDate,
		   '0.00/ 0' AdvInstAmt,(Case when FP.FinIsActive = 1 then 'Active' when FM.closingstatus='C' then 'Cancelled' else 'Closed' END) Status,(FutureRpyPri+FutureRpyPft)/100 FutureInstAmt,
		   FP.Futureinst FutureInstNo,FP.FutureRpyPri/100 FuturePriComponent,FP.FutureRpyPft/100 Future_inst_comp,
		   FP.totchargespaid/100 Charge_coll_cust,
		   FP.UpFrontFee Upfront_int_cust,	0 Int_paid_Dealer_upfront,'' Pre_emi_Int_Paid,
		   '' Repo_Status,'' Repo_Date,'' Sale_Date,'' Release_Date,(Case when FP.finisactive =0 then FP.LATESTRPYDATE else FP.maturitydate end)  Closure_Date
	From FinanceMain FM inner join
		 FinPftDetails FP on FP.FinReference = FM.FinReference
		</createView>
	</changeSet>
	<changeSet id="30" author="Prasad">
		<createView viewName="RPT_SOA_FINSMRY_VIEW" replaceIfExists="true">
				 Select FinReference,'Instalment Amount' comp,(TdSchdPft+TdSchdPri)/100 due,(TdSchdPriPaid+TdSchdPftPaid)/100 Receipt from FinPftDetails union all
	Select FinReference,'Principal Component' comp,	TdSchdPri/100 due,TdSchdPriPaid/100 Receipt from FinPftDetails  union all
	Select FinReference,'Interest Component' comp,coalesce(TdSchdPft,0)/100 due,coalesce(TdSchdPftPaid,0)/100 Receipt from FinPftDetails  union all
	Select FinReference,'Late Payment Penalty' comp,coalesce(PenaltyDue,0)/100 due,	coalesce(PenaltyPaid,0)/100 Receipt from FinPftDetails union all
	Select FinReference,'Bounce Charges' comp,coalesce(BounceAmt,0)/100 due,coalesce(BounceAmtPaid,0)/100 Receipt from FinPftDetails union all
  Select Finreference,'Other Receivables' comp, coalesce(receivableAdviseBal,0)/100 due,coalesce(receivableadvise,0)/100 Receipt  from FinPftDetails union all
   Select Finreference,'Unadjusted Amount' comp,coalesce((excessAmtBal + emiInAdvanceBal),0)/100 due,coalesce((excessAmt+ emiInAdvance),0)/100 Receipt from FinPftDetails union all
    Select Finreference,'Other Payables' comp, coalesce(payableAdviseBal,0)/100 due,coalesce(payableAdvise,0)/100 Receipt from FinPftDetails
		</createView>
	</changeSet>
	<changeSet id="31" author="Prasad">
		<createView viewName="RPT_SOA_CUSTOMER_VIEW" replaceIfExists="true">
				Select  T1.FinReference,T1.FinPurpose,T1.Finstartdate,t4.branchdesc FinBranch,productdesc FinType,'' Interest_Type,T1.LinkedFinRef Linked_Agreement_No,
		T1.ClosedLinkedFinRef Closed_Linked_Agree_No,T.CustFName,T.CustMName,
		CustLName,T.CustCIF,t.CustID,CustAddrHNbr,CustFlatNbr,CustAddrStreet,
		CustPOBox,CustAddrCity,CustAddrProvince,CustAddrCountry,''PropertyDetails,''PropertyAddress,PhoneCountryCode,
		PhoneAreaCode,T.PhoneNumber ,CustEMail,ActiveCnt,CloseCnt,Tot from (
		Select CustFName,CustMName,CustLName,CustCIF,t1.CustID,CustAddrHNbr,CustFlatNbr,CustAddrStreet,
		CustPOBox,CustAddrCity,CustAddrProvince,CustAddrCountry,PhoneCountryCode,
		PhoneAreaCode,T3.PhoneNumber ,CustEMail,ActiveCnt,CloseCnt,ActiveCnt+coalesce(CloseCnt,0) Tot
		from Customers T1 Left join
		CustomerAddresses T2 ON t1.CustID =T2.CustID and t2.custAddrPriority=5 Left join
		CustomerPhoneNumbers T3 ON t1.CustID =T3.PhoneCustID  and PHONETYPEPRIORITY=5 Left join
		CustomerEMails T4 on T4.CustID =T1.CustID and CustEmailPriority=5 Left join
		(Select CustID,COUNT(*)ActiveCnt from FinPftDetails
		where (FinIsActive=1) group by CustID)T5 ON T1.CustID =T5.CustID  Left join
		(Select CustID,COUNT(*)CloseCnt from FinPftDetails
		where (FinIsActive!=1)group by CustID)T6 ON T1.CustID =T6.CustID)T Left join
		finpftdetails T1 on T.CustID=T1.CustID inner join
		RMTFinanceTypes T2 on T1.FinType =T2.FinType inner join
	  BMTProduct T3 on T3.ProductCode =T2.FinCategory inner join
	  RMTBRANCHES T4 on T4.branchcode = T1.FinBranch
		</createView>
	</changeSet>
	<changeSet id="32" author="Prasad">
		<createView viewName="RPT_SOA_TXNDETAILS_VIEW" replaceIfExists="true">
				 Select Finreference,Schdate, (case when Disbonschdate=1 then 'Amount Financed - Payable ('||Finreference||')' 
		when BPIORHOLIDAY='B' then 'Broken Period Interest Receivable -Due('||Finreference||')' else 
		'Due for Installment '||INSTNUMBER||' ('||Finreference||')' end) Particulars,case when Disbonschdate=1 then 0 else Repayamount/100 end Debit,
		case when Disbonschdate=1 then DisbAmount/100 else 0 end Credit
		from finscheduledetails  where (BPIORHOLIDAY!='H' or BPIORHOLIDAY is null)  union 
		Select finreference,m.lastmnton,feetypedesc ||'- Due ('||Finreference||')' ,m.ADVISEAMOUNT/100 Debit ,0 Credit from manualadvise m
		inner join FEETYPES f on f.feetypeid = m.feetypeid union
		Select REFERENCE,VALUEDATE,(Case when PAYMENTTYPE in ('DD','N') then cast('Payment Recieved vide '||PAYMENTTYPE||' No.:'||CHEQUEACNO||'('||REFERENCE||')' as varchar(700))
		when PAYMENTTYPE in ('E') then cast('Amount Adjusted ('||REFERENCE||')'as varchar(700)) end) Particulars,
		Case when PAYMENTTYPE in ('DD','N') then 0  when PAYMENTTYPE in ('E') then Amount/100 end debit,
		Case when PAYMENTTYPE in ('DD','N') then Amount/100   when PAYMENTTYPE in ('E') then Amount/100 end credit
		from FINRECEIPTHEADER T1 inner join 
		FINRECEIPTDETAIL T2 on T1.RECEIPTID =T2.RECEIPTID
		</createView>
	</changeSet>
	<changeSet id="34" author="Kesav">
		<createView viewName="PRESENTMENTDETAILS_AVIEW" replaceIfExists="true">
				SELECT		T1.Id, T1.PresentmentId, T1.FinReference, T1.SchDate, T1.MandateId, T1.SchAmtDue, T1.schPriDue, T1.schPftDue, T1.schFeeDue, T1.schInsDue,
							T1.schPenaltyDue, T1.advanceAmt, T1.excessID, T1.adviseAmt, T1.presentmentAmt, T1.ExcludeReason, T1.bounceID, T1.emiNo, T1.auxiliary1, T1.auxiliary2, T1.status,
							T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId, T1.NextTaskId, T1.RecordType, T1.WorkflowId,
      						T2.MANDATETYPE,T3.FINTYPE,T4.FINTYPEDESC, T5.CUSTSHRTNAME CUSTOMERNAME 
				FROM 		PRESENTMENTDETAILS    T1  INNER JOIN 
							MANDATES  T2 ON T1.MANDATEID = T2.MANDATEID INNER JOIN 
							FINANCEMAIN T3 ON T1.FINREFERENCE = T3.FINREFERENCE INNER JOIN 
							RMTFINANCETYPES T4 ON T3.FINTYPE  = T4.FINTYPE INNER JOIN 
							CUSTOMERS T5 ON T5.CUSTID  = T3.CUSTID
		</createView>
	</changeSet>
</databaseChangeLog>