<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value="" dbms="oracle" />
	<property name="add.schema" value="" dbms="postgresql" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PLFAVANSEQC.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()" dbms="postgresql" />

	<changeSet id="pre_run_for_pgp1" author="Gopal.p" runAlways="true" dbms="postgresql">
		<sql>
			Set search_path = plf,plfaudit,public,pg_catalog;
		</sql>
	</changeSet>

	<changeSet id="01.1" author="saikrishna.b">
		<createTable tableName="HOLD_MARKING_UPLOAD">
			<column name="Id" type="bigint" autoIncrement="true">
				<constraints nullable="false" />
			</column>
			<column name="HeaderId" type="bigint" />
			<column name="RecordSeq" type="bigint" />
			<column name="FinID" type="bigint" />
			<column name="Type" type="varchar(10)" />
			<column name="AccountNumber" type="varchar(20)" />
			<column name="Amount" type="decimal(18,0)" />
			<column name="Reference" type="varchar(20)" />
			<column name="Remarks" type="varchar(500)" />
			<column name="Progress" type="int" />
			<column name="Status" type="char(1)" />
			<column name="ErrorCode" type="varchar(20)" />
			<column name="ErrorDesc" type="varchar(2000)" />
		</createTable>
	</changeSet>
	
	<changeSet id="02.1" author="saikrishna.b">
		<addPrimaryKey tableName="HOLD_MARKING_UPLOAD" columnNames="Id" constraintName="PK_HOLD_MARKING_UPLOAD_ID" />
	</changeSet> 
	
	
	 <changeSet id="03" author="saikrishna.b">
		<createTable tableName="HOLD_MARKING_UPLOAD_LOG">
			<column name="Id" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="HeaderId" type="bigint" />
			<column name="FinID" type="bigint" />
			<column name="Type" type="varchar(10)" />
			<column name="AccountNumber" type="varchar(20)" />
			<column name="Amount" type="decimal(18,0)" />
			<column name="Reference" type="varchar(20)" />
			<column name="Remarks" type="varchar(500)" />
			<column name="Progress" type="int" />
			<column name="Status" type="char(1)" />
			<column name="ErrorCode" type="varchar(20)" />
			<column name="ErrorDesc" type="varchar(2000)" />
			<column name="CreatedOn" type="datetime" />
			<column name="CreatedBy" type="bigint" />
			<column name="ApprovedOn" type="datetime" />
			<column name="ApprovedBy" type="bigint" />
		</createTable>
	</changeSet>

	<changeSet id="04" author="saikrishna.b">
		<addPrimaryKey tableName="HOLD_MARKING_UPLOAD_LOG" columnNames="Id" constraintName="PK_HOLD_MARKING_UPLOAD_LOG_ID" />
	</changeSet>
	
	<changeSet id="05" author="saikrishna.b">
		<sql>
			<![CDATA[
				DELETE FROM DATA_ENGINE_LOG WHERE STATUSID IN (SELECT ID FROM DATA_ENGINE_STATUS WHERE NAME ='HOLD_MARKING_UPLOAD');
 				DELETE FROM DATA_ENGINE_DOWNLOAD_HISTORY WHERE ID IN (SELECT ID FROM DATA_ENGINE_STATUS WHERE NAME ='HOLD_MARKING_UPLOAD');
 				DELETE FROM DATA_ENGINE_STATUS WHERE NAME ='HOLD_MARKING_UPLOAD';
 				
				DELETE FROM DATA_ENGINE_COLUMN WHERE TABLEID IN (SELECT ID FROM DATA_ENGINE_TABLE WHERE CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOLD_MARKING_UPLOAD'));
				DELETE FROM DATA_ENGINE_TABLE WHERE CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOLD_MARKING_UPLOAD');
				DELETE FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOLD_MARKING_UPLOAD';

                INSERT INTO DATA_ENGINE_CONFIG (ID, NAME, DESCRIPTION, PARSER, WORKSHEET, TEXTQUALIFIER, ROWDELIMITER, COLUMNDELIMITER, STARTINGROW, SKIPHEADERROW, FIELDNAMES, HEADER, TRAILER, UPLOADLOCATION, UPLOADPATH, FILEPREFIXNAME, FILEEXTENSION, FILESEQUENCENO, LASTPROCESSEDON, FILENAMEFORMAT, CRONEXPRESSION, NOTIFICATIONSTATUSEMAIL, POSTEVENT, BACKUPFILE, ACTIVE, MAXRECORDS) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_CONFIG), 'HOLD_MARKING_UPLOAD', 'Hold Marking Upload File.', 12, 'HOLD_MARKING', null, null, ',', 0, 1, null, 'ROW:{Type, Account Number, Amount, Reference, Remarks}', null, 'C', '/opt/PFF/BASE/hdfc/HoldMarkingUpload/upload', 'HOLD_MARKING_', '.xlsx', 0, CURRENT_TIMESTAMP, '${ddmm},.${SEQ_DATE_FILE}', NULL, 0, NULL, 1, 1, 10000);

				INSERT INTO DATA_ENGINE_TABLE (ID, CONFIGID, NAME, OPERATION, KEYFIELDS, FILTER, STATUSUPDATE, SKIPROWS, IDENTIFIER, DESCRIPTION, STARTINDEX, ENDINDEX, RECORDLENGTH, MULTIROW, HEADERTABLE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_TABLE), (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOLD_MARKING_UPLOAD'), 'HOLD_MARKING_UPLOAD', 1, 'HEADERID', NULL, NULL, NULL, NULL, NULL, NULL, NULL, 5, 0, 0);

				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOLD_MARKING_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOLD_MARKING_UPLOAD')), 'type',  			0, 'N', NULL, NULL,  NULL,            NULL, '0',  NULL, NULL, NULL, NULL, 'M');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOLD_MARKING_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOLD_MARKING_UPLOAD')), 'accountNumber',    0, 'N', NULL, NULL,  NULL,            NULL, '1',  NULL, NULL, NULL, NULL, 'M');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOLD_MARKING_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOLD_MARKING_UPLOAD')), 'amount', 	     	0, 'N', NULL, NULL,  NULL,            NULL, '2',  NULL, NULL, NULL, NULL, 'M');
			 	INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOLD_MARKING_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOLD_MARKING_UPLOAD')), 'reference', 	    0, 'N', NULL, NULL,  NULL,            NULL, '3',  NULL, NULL, NULL, NULL, 'M');
			 	INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOLD_MARKING_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOLD_MARKING_UPLOAD')), 'remarks', 	     	0, 'N', NULL, NULL,  NULL,            NULL, '4',  NULL, NULL, NULL, NULL, 'O');
			 ]]>
		</sql>
	</changeSet>
	
	<changeSet id="06" author="saikrishna.b">
		<sql>
			<![CDATA[
				DELETE FROM DATA_ENGINE_LOG WHERE STATUSID IN (SELECT ID FROM DATA_ENGINE_STATUS WHERE NAME ='HOLD_MARKING_TEMPLATE');
 				DELETE FROM DATA_ENGINE_DOWNLOAD_HISTORY WHERE ID IN (SELECT ID FROM DATA_ENGINE_STATUS WHERE NAME ='HOLD_MARKING_TEMPLATE');
 				DELETE FROM DATA_ENGINE_STATUS WHERE NAME ='HOLD_MARKING_TEMPLATE';
							
				DELETE FROM DATA_ENGINE_COLUMN WHERE TABLEID IN (SELECT ID FROM DATA_ENGINE_TABLE WHERE CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOLD_MARKING_TEMPLATE'));
				DELETE FROM DATA_ENGINE_TABLE WHERE CONFIGID IN (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOLD_MARKING_TEMPLATE');
				DELETE FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOLD_MARKING_TEMPLATE';
							
				INSERT INTO DATA_ENGINE_CONFIG (ID, NAME, DESCRIPTION, PARSER, WORKSHEET, TEXTQUALIFIER, ROWDELIMITER, COLUMNDELIMITER, STARTINGROW, SKIPHEADERROW, FIELDNAMES, HEADER, TRAILER, UPLOADLOCATION, UPLOADPATH, FILEPREFIXNAME, FILEEXTENSION, FILESEQUENCENO, LASTPROCESSEDON, FILENAMEFORMAT, CRONEXPRESSION, NOTIFICATIONSTATUSEMAIL, POSTEVENT, BACKUPFILE, ACTIVE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_CONFIG), 'HOLD_MARKING_TEMPLATE', 'Hold Marking template download', 5, 'HOLD_MARKING', NULL, NULL, ',' , 0, 0, NULL, 'ROW:{Type, Account Number, Amount, Reference, Remarks}',  '', 'A', '/opt/PFF/BASE/hdfc/HoldMarkingUpload/template', 'HOLD_MARKING_', '.xlsx', 0, current_timestamp, '${ddMMYYYYHms}', NULL, 0, NULL, 1, 1);

				INSERT INTO DATA_ENGINE_TABLE (ID, CONFIGID, NAME, OPERATION, KEYFIELDS, FILTER, STATUSUPDATE, SKIPROWS, IDENTIFIER, DESCRIPTION, STARTINDEX, ENDINDEX, RECORDLENGTH, MULTIROW, HEADERTABLE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_TABLE), (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOLD_MARKING_TEMPLATE'), 'HOLD_MARKING_UPLOAD',  0, 'ID', 'HEADERID = :HEADERID', NULL, NULL, NULL, NULL, NULL, NULL, 5, 0, 0);
				
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOLD_MARKING_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOLD_MARKING_TEMPLATE')), 'TYPE', 			0, 'N', NULL, NULL, NULL, NULL, '0',  NULL, NULL, NULL, NULL,  'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOLD_MARKING_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOLD_MARKING_TEMPLATE')), 'ACCOUNTNUMBER',  0, 'N', NULL, NULL, NULL, NULL, '1',  NULL, NULL, NULL, NULL,  'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOLD_MARKING_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOLD_MARKING_TEMPLATE')), 'AMOUNT',      	0, 'N', NULL, NULL, NULL, NULL, '2',  NULL, NULL, NULL, NULL,  'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOLD_MARKING_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOLD_MARKING_TEMPLATE')), 'REFERENCE',      0, 'N', NULL, NULL, NULL, NULL, '3',  NULL, NULL, NULL, NULL,  'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'HOLD_MARKING_UPLOAD' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'HOLD_MARKING_TEMPLATE')), 'REMARKS',      	0, 'N', NULL, NULL, NULL, NULL, '4',  NULL, NULL, NULL, NULL,  'O');
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="07" author="saikrishna.b">
		<sql>
			<![CDATA[
				DELETE FROM SECROLEGROUPS WHERE GRPID IN (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'HOLD_MARKING_UPLOAD_MAKER');
				DELETE FROM SECROLEGROUPS WHERE GRPID IN (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'HOLD_MARKING_UPLOAD_APPROVER');
				DELETE FROM SECROLEGROUPS WHERE GRPID IN (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'HOLD_MARKING_UPLOAD_VIEW');

				DELETE FROM SECROLES WHERE ROLECD ='HOLD_MARKING_UPLOAD_MAKER';
				DELETE FROM SECROLES WHERE ROLECD ='HOLD_MARKING_UPLOAD_APPROVER';
				DELETE FROM SECROLES WHERE ROLECD ='HOLD_MARKING_UPLOAD_VIEW';

				DELETE FROM SECGROUPRIGHTS WHERE GRPID IN (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'HOLD_MARKING_UPLOAD_MAKER');
				DELETE FROM SECGROUPRIGHTS WHERE GRPID IN (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'HOLD_MARKING_UPLOAD_APPROVER');
				DELETE FROM SECGROUPRIGHTS WHERE GRPID IN (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'HOLD_MARKING_UPLOAD_VIEW');

				DELETE FROM SECGROUPS WHERE GRPCODE ='HOLD_MARKING_UPLOAD_MAKER';
				DELETE FROM SECGROUPS WHERE GRPCODE ='HOLD_MARKING_UPLOAD_APPROVER';
				DELETE FROM SECGROUPS WHERE GRPCODE ='HOLD_MARKING_UPLOAD_VIEW';

				DELETE FROM SECRIGHTS WHERE RIGHTNAME ='menu_Item_HoldMarkingUpload_Maker';
				DELETE FROM SECRIGHTS WHERE RIGHTNAME ='menu_Item_HoldMarkingUpload_Approver';

				INSERT INTO SECRIGHTS (RIGHTID, RIGHTTYPE, RIGHTNAME, PAGE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES ((SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 0, 'menu_Item_HoldMarkingUpload_Maker',    'MENU', 1, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				INSERT INTO SECRIGHTS (RIGHTID, RIGHTTYPE, RIGHTNAME, PAGE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES ((SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 0, 'menu_Item_HoldMarkingUpload_Approver', 'MENU', 1, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				
				INSERT INTO SECGROUPS (GRPID, GRPCODE, GRPDESC, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(GRPID)+1 FROM SECGROUPS),  'HOLD_MARKING_UPLOAD_MAKER',    'WF Maker for Hold Marking Upload',       0, 1000, current_timestamp, 'Approved', null, null, null, null, null, 0);
				INSERT INTO SECGROUPS (GRPID, GRPCODE, GRPDESC, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(GRPID)+1 FROM SECGROUPS),  'HOLD_MARKING_UPLOAD_APPROVER', 'WF Approver for Hold Marking Upload',    0, 1000, current_timestamp, 'Approved', null, null, null, null, null, 0);
                INSERT INTO SECGROUPS (GRPID, GRPCODE, GRPDESC, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(GRPID)+1 FROM SECGROUPS),  'HOLD_MARKING_UPLOAD_VIEW', 	   'Menu group for Hold Marking Upload',     0, 1000, current_timestamp, 'Approved', null, null, null, null, null, 0);

				INSERT INTO SECGROUPRIGHTS (GRPRIGHTID, GRPID, RIGHTID, ACCESSTYPE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'HOLD_MARKING_UPLOAD_MAKER'),    (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'menu_Item_HoldMarkingUpload_Maker'),        1, 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				INSERT INTO SECGROUPRIGHTS (GRPRIGHTID, GRPID, RIGHTID, ACCESSTYPE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'HOLD_MARKING_UPLOAD_APPROVER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'menu_Item_HoldMarkingUpload_Approver'),     1, 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				INSERT INTO SECGROUPRIGHTS (GRPRIGHTID, GRPID, RIGHTID, ACCESSTYPE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'HOLD_MARKING_UPLOAD_VIEW'),     (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'menu_Item_HoldMarkingUpload_Maker'), 		1, 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				INSERT INTO SECGROUPRIGHTS (GRPRIGHTID, GRPID, RIGHTID, ACCESSTYPE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'HOLD_MARKING_UPLOAD_VIEW'), 	  (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'menu_Item_HoldMarkingUpload_Approver'), 	1, 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);

				INSERT INTO SECROLES (ROLEID, ROLEAPP, ROLECD, ROLEDESC, ROLECATEGORY, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(ROLEID)+1 FROM SECROLES), 1, 'HOLD_MARKING_UPLOAD_MAKER',    'Maker role from Hold Marking Upload',     '', 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0); 
				INSERT INTO SECROLES (ROLEID, ROLEAPP, ROLECD, ROLEDESC, ROLECATEGORY, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(ROLEID)+1 FROM SECROLES), 1, 'HOLD_MARKING_UPLOAD_APPROVER', 'Approver role from Hold Marking Upload',  '', 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				INSERT INTO SECROLES (ROLEID, ROLEAPP, ROLECD, ROLEDESC, ROLECATEGORY, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(ROLEID)+1 FROM SECROLES), 1, 'HOLD_MARKING_UPLOAD_VIEW',     'Menu role for Hold Marking Upload',       '', 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);

				INSERT INTO SECROLEGROUPS (ROLEGRPID, GRPID, ROLEID, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID)VALUES ((SELECT MAX(ROLEGRPID)+1 FROM SECROLEGROUPS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'HOLD_MARKING_UPLOAD_MAKER'),    (SELECT ROLEID FROM SECROLES WHERE ROLECD = 'HOLD_MARKING_UPLOAD_MAKER'),    0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				INSERT INTO SECROLEGROUPS (ROLEGRPID, GRPID, ROLEID, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID)VALUES ((SELECT MAX(ROLEGRPID)+1 FROM SECROLEGROUPS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'HOLD_MARKING_UPLOAD_APPROVER'), (SELECT ROLEID FROM SECROLES WHERE ROLECD = 'HOLD_MARKING_UPLOAD_APPROVER'), 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				INSERT INTO SECROLEGROUPS (ROLEGRPID, GRPID, ROLEID, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID)VALUES ((SELECT MAX(ROLEGRPID)+1 FROM SECROLEGROUPS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'HOLD_MARKING_UPLOAD_VIEW'), 	 (SELECT ROLEID FROM SECROLES WHERE ROLECD = 'HOLD_MARKING_UPLOAD_VIEW'), 	  0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="08.1" author="saikrishna.b">
		<createSequence sequenceName="SEQ_HOLD_MARKING_HEADER_HOLDID" startValue="1001" maxValue="9223372036854775807"
			incrementBy="1" />
	</changeSet>

	<changeSet id="09.1" author="saikrishna.b">
		<createSequence sequenceName="SEQ_HOLD_MARKING_HEADER_ID" startValue="1" maxValue="9223372036854775807"
			incrementBy="1" />
	</changeSet> 
	
	<changeSet id="10.1" author="saikrishna.b">
		<createTable tableName="HOLD_MARKING_HEADER">
			<column name="ID" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="HoldID" type="bigint" />
			<column name="FinID" type="bigint" />
			<column name="FinReference" type="Varchar(20)">
				<constraints nullable="false" />
			</column>
			<column name="HoldReference" type="bigint" />
			<column name="AccountNumber" type="varchar(20)" />
			<column name="HoldAmount" type="decimal(18,0)" />
			<column name="ReleaseAmount" type="decimal(18,0)" />
			<column name="Balance" type="decimal(18,0)" />
		</createTable>
	</changeSet>
	
	<changeSet id="11.1" author="saikrishna.b">
		<addPrimaryKey constraintName="PK_HMH_ID" tableName="HOLD_MARKING_HEADER" columnNames="ID" />
	</changeSet>
	
	<changeSet id="12.1" author="saikrishna.b">
		<addUniqueConstraint tableName="HOLD_MARKING_HEADER" columnNames="HoldID"
			constraintName="uk_Hold_Marking_Header_HoldId" />
	</changeSet>
	
	 <changeSet id="13" author="saikrishna.b">
		<createTable tableName="HOLD_MARKING_DETAILS">
			<column name="ID" type="bigint"  autoIncrement="true">
				<constraints nullable="false" />
			</column>
			<column name="HeaderID" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="HoldID" type="bigint" />
			<column name="FinID" type="bigint" />
			<column name="FinReference" type="Varchar(20)">
				<constraints nullable="false" />
			</column>
			<column name="HoldType" type="varchar(10)" />
			<column name="Marking" type="Varchar(8)" />
			<column name="MovementDate" type="datetime" />
			<column name="Status" type="varchar(30)" />
			<column name="Amount" type="decimal(18,0)" />
			<column name="LogID" type="bigint" />
			<column name="HoldReleaseReason" type="Varchar(500)" />
			<column name="Version" type="int" />
			<column name="CreatedBy" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="CreatedOn" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="ApprovedBy" type="bigint" />
			<column name="ApprovedOn" type="datetime" />
			<column name="LastMntBy" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="LastMnton" type="datetime">
				<constraints nullable="false" />
			</column>
		</createTable>
	</changeSet>
	
	<changeSet id="14" author="saikrishna.b">
		<addPrimaryKey constraintName="PK_HMD_ID" tableName="HOLD_MARKING_DETAILS" columnNames="ID" />
	</changeSet>
</databaseChangeLog> 