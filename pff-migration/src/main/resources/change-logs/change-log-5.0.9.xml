<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value="" dbms="oracle" />
	<property name="add.schema" value="" dbms="postgresql" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PLFAVANSEQC.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()" dbms="postgresql" />

	<changeSet id="pre_run_for_pgp" author="Adarsh" runAlways="true"
		dbms="postgresql">
		<sql>
			Set search_path = plf,public,pg_catalog;
		</sql>
	</changeSet>
	
	 <changeSet id="01" author="Durgaprasad G">
		<addColumn tableName="FINANCEMAIN">
			<column name="SanBsdSchdle" type="boolean" defaultValue="0"/>
		</addColumn>
	</changeSet>
	
	<changeSet id="02" author="Durgaprasad G">
		<addColumn tableName="FINANCEMAIN">
			<column name="PromotionSeqID" type="bigint" defaultValue="0"/>
		</addColumn>
	</changeSet>
	
	<changeSet id="03" author="Durgaprasad G">
		<addColumn tableName="FINANCEMAIN_PA">
			<column name="SanBsdSchdle" type="boolean" defaultValue="0"/>
		</addColumn>
	</changeSet>
	
		<changeSet id="04" author="Durgaprasad G">
		<addColumn tableName="FINANCEMAIN_PA">
			<column name="PromotionSeqID" type="bigint" defaultValue="0"/>
		</addColumn>
	</changeSet>
	
	<changeSet id="05" author="Durgaprasad G">
		<addColumn tableName="FINANCEMAIN_TEMP">
			<column name="SanBsdSchdle" type="boolean" defaultValue="0"/>
		</addColumn>
	</changeSet>
	
		<changeSet id="06" author="Durgaprasad G">
		<addColumn tableName="FINANCEMAIN_TEMP">
			<column name="PromotionSeqID" type="bigint" defaultValue="0"/>
		</addColumn>
	</changeSet>

	<changeSet id="07" author="Durgaprasad G">
		<createView viewName="financemain_aview" replaceIfExists="true">
			SELECT t1.finreference,
		    t1.investmentref,
		    t1.numberofterms,
		    t1.grcperiodenddate,
		    t1.allowgrcperiod,
		    t1.gracebaserate,
		    t1.gracespecialrate,
		    t1.grcpftrate,
		    t1.grcpftfrq,
		    t1.nextgrcpftdate,
		    t1.allowgrcpftrvw,
		    t1.grcpftrvwfrq,
		    t1.nextgrcpftrvwdate,
		    t1.allowgrccpz,
		    t1.grccpzfrq,
		    t1.nextgrccpzdate,
		    t1.repaybaserate,
		    t1.repayspecialrate,
		    t1.repayprofitrate,
		    t1.repayfrq,
		    t1.nextrepaydate,
		    t1.repaypftfrq,
		    t1.nextrepaypftdate,
		    t1.allowrepayrvw,
		    t1.repayrvwfrq,
		    t1.nextrepayrvwdate,
		    t1.allowrepaycpz,
		    t1.repaycpzfrq,
		    t1.nextrepaycpzdate,
		    t1.maturitydate,
		    t1.cpzatgraceend,
		    t1.downpayment,
		    t1.graceflatamount,
		    t1.reqrepayamount,
		    t1.totalprofit,
		    t1.totalcpz,
		    t1.totalgrosspft,
		    t1.totalgrossgrcpft,
		    t1.totalgracepft,
		    t1.totalgracecpz,
		    t1.grcratebasis,
		    t1.repayratebasis,
		    t1.fintype,
		    t1.finremarks,
		    t1.finccy,
		    t1.schedulemethod,
		    t1.profitdaysbasis,
		    t1.reqmaturity,
		    t1.calterms,
		    t1.calmaturity,
		    t1.firstrepay,
		    t1.lastrepay,
		    t1.finstartdate,
		    t1.finamount,
		    t1.finamount + t1.feechargeamt - t1.downpayment AS lovdescfinancingamount,
		    t1.finrepaymentamount,
		    t1.custid,
		    t1.defferments,
		    t1.plandefercount,
		    t1.finbranch,
		    t1.finsourceid,
		    t1.alloweddefrpychange,
		    t1.availeddefrpychange,
		    t1.alloweddeffrqchange,
		    t1.availeddeffrqchange,
		    t1.recaltype,
		    t1.finassetvalue,
		    t1.disbaccountid,
		    t1.repayaccountid,
		    t1.finisactive,
		    t1.limitvalid,
		    t1.overridelimit,
		    t1.securitydeposit,
		    t1.version,
		    t1.lastmntby,
		    t1.lastmnton,
		    t1.recordstatus,
		    t1.rolecode,
		    t1.nextrolecode,
		    t1.taskid,
		    t1.nexttaskid,
		    t1.recordtype,
		    t1.workflowid,
		    t7.fintypedesc AS lovdescfintypename,
		    t7.finmaxamount AS lovdescfinmaxamt,
		    t7.finminamount AS lovdescfinminamount,
		    t1.mindownpayperc,
		    t7.finisalwdifferment AS lovdescfinalwdeferment,
		    t7.finisdwpayrequired AS lovdescdwnpayreq,
		    t7.finmaxdifferment AS lovdescfinmaxdifferment,
		    t12.branchdesc AS lovdescfinbranchname,
		    t12.branchprovince AS finbranchprovincecode,
		    t1.lastrepaydate,
		    t1.lastrepaypftdate,
		    t1.lastrepayrvwdate,
		    t1.lastrepaycpzdate,
		    t1.allowgrcrepay,
		    t1.grcschdmthd,
		    t1.grcmargin,
		    t1.repaymargin,
		    t1.fincurrassetvalue,
		    t1.fincommitmentref,
		    t1.finlimitref,
		    t1.depreciationfrq,
		    t1.fincontractdate,
		    t1.nextdepdate,
		    t1.lastdepdate,
		    t1.finaccount,
		    t1.fincustpftaccount,
		    t17.acrtilllbd AS lovdescaccruedtilllbd,
		    t7.finrvwrateapplfor,
		    t1.totalrepayamt,
		    t1.closingstatus,
		    t1.finapproveddate,
		    t1.feechargeamt,
		    t1.blacklisted,
		    t1.finrepaypftonfrq,
		    t1.anualizedpercrate,
		    t1.effectiverateofreturn,
		    t1.migratedfinance,
		    t1.schedulemaintained,
		    t1.scheduleregenerated,
		    t1.finpurpose,
		    t39.loanpurposedesc AS lovdescfinpurposename,
		    t1.finstatus,
		    t1.finstsreason,
		    t1.initiateuser,
		    t1.bankname,
		    t1.iban,
		    t1.accounttype,
		    t1.ddareferenceno,
		    t7.finscheduleon AS lovdescfinscheduleon,
		    t1.custdsr,
		    t1.jointaccount,
		    t1.jointcustid,
		    t1.downpaybank,
		    t1.downpaysupl,
		    t1.downpayaccount,
		    t1.securitycollateral,
		    t1.approved,
		    t1.discrepancy,
		    t1.limitapproved,
		    t1.graceterms,
		    t7.findivision AS lovdescfindivision,
		    t1.rcdmaintainsts,
		    t1.finrepaymethod,
		    t1.grcprofitdaysbasis,
		    t1.stepfinance,
		    t1.steptype,
		    t1.steppolicy,
		    t1.alwmanualsteps,
		    t1.noofsteps,
		    t1.linkedfinref,
		    t1.nextuserid,
		    t1.priority,
		    t24.policydesc AS lovdescsteppolicyname,
		    t1.grcminrate,
		    t1.grcmaxrate,
		    t1.rpyminrate,
		    t1.rpymaxrate,
		    t1.deviationapproval,
		    t1.manualschedule,
		    t1.takeoverfinance,
		    t1.grcadvbaserate,
		    t1.grcadvmargin,
		    t1.grcadvpftrate,
		    t1.rpyadvbaserate,
		    t1.rpyadvmargin,
		    t1.rpyadvpftrate,
		    t1.supplementrent,
		    t1.increasedcost,
		    t1.creditinsamt,
		    t1.rolloverfrq,
		    t1.nextrolloverdate,
		    t27.custstsdescription,
		    t1.shariastatus,
		    t1.initiatedate,
		    t1.finpreapprovedref,
		    t1.mmaid,
		    t1.accountsofficer,
		    t1.feeaccountid,
		    t1.fincancelac,
		    t28.dealername AS lovdescaccountsofficer,
		    t28.dealercity AS lovdescsourcecity,
		    t1.dsacode,
		    t30.rofficerdesc AS dsacodedesc,
		    t1.tdsapplicable,
		    t1.mandateid,
		    t1.droplinefrq,
		    t1.firstdroplinedate,
		    t1.pftservicingodlimit,
		    t1.insuranceamt,
		    t1.deductinsdisb,
		    t1.alwbpi,
		    t1.bpitreatment,
		    t1.planemihalw,
		    t1.planemihmethod,
		    t1.planemihmaxperyear,
		    t1.planemihmax,
		    t1.planemihlockperiod,
		    t1.planemicpz,
		    t1.calroundingmode,
		    t1.alwmultidisb,
		    t1.applicationno,
		    t1.referralid,
		    t33.rofficerdesc AS referraliddesc,
		    t1.dmacode,
		    t34.rofficerdesc AS dmacodedesc,
		    t1.salesdepartment,
		    t35.gendeptdesc AS salesdepartmentdesc,
		    t1.quickdisb,
		    t1.wifreference,
		    t1.unplanemihlockperiod,
		    t1.unplanemicpz,
		    t1.reagecpz,
		    t1.maxunplannedemi,
		    t1.maxreageholidays,
		    t1.availedunplanemi,
		    t1.availedreageh,
		    t1.bpiamount,
		    t1.deductfeedisb,
		    t1.rvwrateapplfor,
		    t1.schcalonrvw,
		    t1.pastduepftcalmthd,
		    t1.pastduepftmargin,
		    t1.droppingmethod,
		    t1.ratechganyday,
		    t1.promotioncode,
		    t1.restructureloan,
		    t1.oldfinreference,
		    t1.reagebucket,
		    t1.fincategory,
		    t1.productcategory,
		    t1.roundingtarget,
		    t36.entitycode AS lovdescentitycode,
		    t1.eligibilitymethod,
		    t38.fieldcodevalue AS loveligibilitymethod,
		    t38.valuedesc AS lovdesceligibilitymethod,
		    t1.employeename,
		    t37.rofficerdesc AS employeenamedesc,
		    t1.samplingrequired,
		    t1.legalrequired,
		    t1.grcmaxamount,
		    t1.connector,
		    t40.dealername AS connectorcode,
		    t40.dealercity AS connectordesc,
		    t1.advanceemi,
		    t1.advemiterms,
		    t1.bpipftdaysbasis,
		    t1.fixedratetenor,
		    t1.fixedtenorrate,
		    t12.branchtel AS finbranchcontact,
		    t1.processattributes,
		    t1.businessvertical,
		    bv.code AS businessverticalcode,
		    bv.description AS businessverticaldesc,
		    t1.grcadvtype,
		    t1.grcadvterms,
		    t1.advtype,
		    t1.advterms,
		    t1.advstage,
		    t1.tdspercentage,
		    t1.tdsstartdate,
		    t1.tdsenddate,
		    t1.tdslimitamt,
		    t1.vanreq,
		    t1.vancode,
		    t1.allowdrawingpower,
		    t1.allowrevolving,
		    t1.sanbsdschdle,
			t1.PromotionSeqID
		   FROM financemain t1
		     JOIN rmtfinancetypes t7 ON t1.fintype =  t7.fintype
		     LEFT JOIN rmtbranches t12 ON t1.finbranch =  t12.branchcode
		     LEFT JOIN finpftdetails t17 ON t17.finreference =  t1.finreference
		     LEFT JOIN steppolicyheader t24 ON t1.steppolicy =  t24.policycode
		     LEFT JOIN bmtcuststatuscodes t27 ON t1.finstatus =  t27.custstscode
		     LEFT JOIN amtvehicledealer t28 ON t1.accountsofficer = t28.dealerid
		     LEFT JOIN relationshipofficers t30 ON t1.dsacode =  t30.rofficercode
		     LEFT JOIN relationshipofficers t33 ON t1.referralid =  t33.rofficercode
		     LEFT JOIN relationshipofficers t34 ON t1.dmacode =  t34.rofficercode
		     LEFT JOIN rmtgendepartments t35 ON t1.salesdepartment =  t35.gendepartment
		     LEFT JOIN smtdivisiondetail t36 ON t7.findivision =  t36.divisioncode
		     LEFT JOIN relationshipofficers t37 ON t1.employeename =  t37.rofficercode
		     LEFT JOIN rmtlovfielddetail t38 ON t1.eligibilitymethod = t38.fieldcodeid AND t38.fieldcode =  'ELGMETHOD'
		     LEFT JOIN loanpurposes t39 ON t1.finpurpose =  t39.loanpurposecode
		     LEFT JOIN amtvehicledealer t40 ON t1.connector = t40.dealerid
		     LEFT JOIN business_vertical bv ON bv.id = t1.businessvertical
		</createView>
	</changeSet>

	<changeSet id="08" author="Durgaprasad G">
		<createView viewName="financemain_tview" replaceIfExists="true">
				SELECT t1.finreference,
			    t1.investmentref,
			    t1.numberofterms,
			    t1.grcperiodenddate,
			    t1.allowgrcperiod,
			    t1.gracebaserate,
			    t1.gracespecialrate,
			    t1.grcpftrate,
			    t1.grcpftfrq,
			    t1.nextgrcpftdate,
			    t1.allowgrcpftrvw,
			    t1.grcpftrvwfrq,
			    t1.nextgrcpftrvwdate,
			    t1.allowgrccpz,
			    t1.grccpzfrq,
			    t1.nextgrccpzdate,
			    t1.repaybaserate,
			    t1.repayspecialrate,
			    t1.repayprofitrate,
			    t1.repayfrq,
			    t1.nextrepaydate,
			    t1.repaypftfrq,
			    t1.nextrepaypftdate,
			    t1.allowrepayrvw,
			    t1.repayrvwfrq,
			    t1.nextrepayrvwdate,
			    t1.allowrepaycpz,
			    t1.repaycpzfrq,
			    t1.nextrepaycpzdate,
			    t1.maturitydate,
			    t1.cpzatgraceend,
			    t1.downpayment,
			    t1.graceflatamount,
			    t1.reqrepayamount,
			    t1.totalprofit,
			    t1.totalcpz,
			    t1.totalgrosspft,
			    t1.totalgrossgrcpft,
			    t1.totalgracepft,
			    t1.totalgracecpz,
			    t1.grcratebasis,
			    t1.repayratebasis,
			    t1.fintype,
			    t1.finremarks,
			    t1.finccy,
			    t1.schedulemethod,
			    t1.profitdaysbasis,
			    t1.reqmaturity,
			    t1.calterms,
			    t1.calmaturity,
			    t1.firstrepay,
			    t1.lastrepay,
			    t1.finstartdate,
			    t1.finamount,
			    t1.finamount + t1.feechargeamt - t1.downpayment AS lovdescfinancingamount,
			    t1.finrepaymentamount,
			    t1.custid,
			    t1.defferments,
			    t1.plandefercount,
			    t1.finbranch,
			    t1.finsourceid,
			    t1.alloweddefrpychange,
			    t1.availeddefrpychange,
			    t1.alloweddeffrqchange,
			    t1.availeddeffrqchange,
			    t1.recaltype,
			    t1.finassetvalue,
			    t1.disbaccountid,
			    t1.repayaccountid,
			    t1.finisactive,
			    t1.limitvalid,
			    t1.overridelimit,
			    t1.securitydeposit,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t7.fintypedesc AS lovdescfintypename,
			    t7.finmaxamount AS lovdescfinmaxamt,
			    t7.finminamount AS lovdescfinminamount,
			    t1.mindownpayperc,
			    t7.finisalwdifferment AS lovdescfinalwdeferment,
			    t7.finisdwpayrequired AS lovdescdwnpayreq,
			    t7.finmaxdifferment AS lovdescfinmaxdifferment,
			    t12.branchdesc AS lovdescfinbranchname,
			    t12.branchprovince AS finbranchprovincecode,
			    t1.lastrepaydate,
			    t1.lastrepaypftdate,
			    t1.lastrepayrvwdate,
			    t1.lastrepaycpzdate,
			    t1.allowgrcrepay,
			    t1.grcschdmthd,
			    t1.grcmargin,
			    t1.repaymargin,
			    t1.fincurrassetvalue,
			    t1.fincommitmentref,
			    t1.finlimitref,
			    t1.depreciationfrq,
			    t1.fincontractdate,
			    t1.nextdepdate,
			    t1.lastdepdate,
			    t1.finaccount,
			    t1.fincustpftaccount,
			    t17.acrtilllbd AS lovdescaccruedtilllbd,
			    t7.finrvwrateapplfor,
			    t1.totalrepayamt,
			    t1.closingstatus,
			    t1.finapproveddate,
			    t1.feechargeamt,
			    t1.blacklisted,
			    t1.finrepaypftonfrq,
			    t1.anualizedpercrate,
			    t1.effectiverateofreturn,
			    t1.migratedfinance,
			    t1.schedulemaintained,
			    t1.scheduleregenerated,
			    t1.finpurpose,
			    t39.loanpurposedesc AS lovdescfinpurposename,
			    t1.finstatus,
			    t1.finstsreason,
			    t1.initiateuser,
			    t1.bankname,
			    t1.iban,
			    t1.accounttype,
			    t1.ddareferenceno,
			    t7.finscheduleon AS lovdescfinscheduleon,
			    t1.custdsr,
			    t1.jointaccount,
			    t1.jointcustid,
			    t1.downpaybank,
			    t1.downpaysupl,
			    t1.downpayaccount,
			    t1.securitycollateral,
			    t1.approved,
			    t1.discrepancy,
			    t1.limitapproved,
			    t1.graceterms,
			    t7.findivision AS lovdescfindivision,
			    t1.rcdmaintainsts,
			    t1.finrepaymethod,
			    t1.grcprofitdaysbasis,
			    t1.stepfinance,
			    t1.steptype,
			    t1.steppolicy,
			    t1.alwmanualsteps,
			    t1.noofsteps,
			    t1.linkedfinref,
			    t1.nextuserid,
			    t1.priority,
			    t24.policydesc AS lovdescsteppolicyname,
			    t1.grcminrate,
			    t1.grcmaxrate,
			    t1.rpyminrate,
			    t1.rpymaxrate,
			    t1.deviationapproval,
			    t1.manualschedule,
			    t1.takeoverfinance,
			    t1.grcadvbaserate,
			    t1.grcadvmargin,
			    t1.grcadvpftrate,
			    t1.rpyadvbaserate,
			    t1.rpyadvmargin,
			    t1.rpyadvpftrate,
			    t1.supplementrent,
			    t1.increasedcost,
			    t1.creditinsamt,
			    t1.rolloverfrq,
			    t1.nextrolloverdate,
			    t27.custstsdescription,
			    t1.shariastatus,
			    t1.initiatedate,
			    t1.finpreapprovedref,
			    t1.mmaid,
			    t1.accountsofficer,
			    t1.feeaccountid,
			    t1.fincancelac,
			    t28.dealername AS lovdescaccountsofficer,
			    t28.dealercity AS lovdescsourcecity,
			    t1.dsacode,
			    t30.rofficerdesc AS dsacodedesc,
			    t1.tdsapplicable,
			    t1.mandateid,
			    t1.droplinefrq,
			    t1.firstdroplinedate,
			    t1.pftservicingodlimit,
			    t1.insuranceamt,
			    t1.deductinsdisb,
			    t1.alwbpi,
			    t1.bpitreatment,
			    t1.planemihalw,
			    t1.planemihmethod,
			    t1.planemihmaxperyear,
			    t1.planemihmax,
			    t1.planemihlockperiod,
			    t1.planemicpz,
			    t1.calroundingmode,
			    t1.alwmultidisb,
			    t1.applicationno,
			    t1.referralid,
			    t33.rofficerdesc AS referraliddesc,
			    t1.dmacode,
			    t34.rofficerdesc AS dmacodedesc,
			    t1.salesdepartment,
			    t35.gendeptdesc AS salesdepartmentdesc,
			    t1.quickdisb,
			    t1.wifreference,
			    t1.unplanemihlockperiod,
			    t1.unplanemicpz,
			    t1.reagecpz,
			    t1.maxunplannedemi,
			    t1.maxreageholidays,
			    t1.availedunplanemi,
			    t1.availedreageh,
			    t1.bpiamount,
			    t1.deductfeedisb,
			    t1.rvwrateapplfor,
			    t1.schcalonrvw,
			    t1.pastduepftcalmthd,
			    t1.pastduepftmargin,
			    t1.droppingmethod,
			    t1.ratechganyday,
			    t1.promotioncode,
			    t1.restructureloan,
			    t1.oldfinreference,
			    t1.reagebucket,
			    t1.fincategory,
			    t1.productcategory,
			    t1.roundingtarget,
			    t36.entitycode AS lovdescentitycode,
			    t1.eligibilitymethod,
			    t38.fieldcodevalue AS loveligibilitymethod,
			    t38.valuedesc AS lovdesceligibilitymethod,
			    t1.employeename,
			    t37.rofficerdesc AS employeenamedesc,
			    t1.samplingrequired,
			    t1.legalrequired,
			    t1.grcmaxamount,
			    t1.connector,
			    t40.dealername AS connectorcode,
			    t40.dealercity AS connectordesc,
			    t1.advanceemi,
			    t1.advemiterms,
			    t1.bpipftdaysbasis,
			    t1.fixedratetenor,
			    t1.fixedtenorrate,
			    t12.branchtel AS finbranchcontact,
			    t1.processattributes,
			    t1.businessvertical,
			    bv.code AS businessverticalcode,
			    bv.description AS businessverticaldesc,
			    t1.grcadvtype,
			    t1.grcadvterms,
			    t1.advtype,
			    t1.advterms,
			    t1.advstage,
			    t1.tdspercentage,
			    t1.tdsstartdate,
			    t1.tdsenddate,
			    t1.tdslimitamt,
			    t1.vanreq,
			    t1.vancode,
			    t1.allowdrawingpower,
			    t1.allowrevolving,
			    t1.sanbsdschdle,
				t1.PromotionSeqID
			   FROM financemain_temp t1
			     JOIN rmtfinancetypes t7 ON t1.fintype =  t7.fintype
			     LEFT JOIN rmtbranches t12 ON t1.finbranch =  t12.branchcode
			     LEFT JOIN finpftdetails t17 ON t17.finreference =  t1.finreference
			     LEFT JOIN steppolicyheader t24 ON t1.steppolicy =  t24.policycode
			     LEFT JOIN bmtcuststatuscodes t27 ON t1.finstatus =  t27.custstscode
			     LEFT JOIN amtvehicledealer t28 ON t1.accountsofficer = t28.dealerid
			     LEFT JOIN relationshipofficers t30 ON t1.dsacode =  t30.rofficercode
			     LEFT JOIN relationshipofficers t33 ON t1.referralid =  t33.rofficercode
			     LEFT JOIN relationshipofficers t34 ON t1.dmacode =  t34.rofficercode
			     LEFT JOIN rmtgendepartments t35 ON t1.salesdepartment =  t35.gendepartment
			     LEFT JOIN smtdivisiondetail t36 ON t7.findivision =  t36.divisioncode
			     LEFT JOIN relationshipofficers t37 ON t1.employeename =  t37.rofficercode
			     LEFT JOIN rmtlovfielddetail t38 ON t1.eligibilitymethod = t38.fieldcodeid AND t38.fieldcode =  'ELGMETHOD'
			     LEFT JOIN loanpurposes t39 ON t1.finpurpose =  t39.loanpurposecode
			     LEFT JOIN amtvehicledealer t40 ON t1.connector = t40.dealerid
			     LEFT JOIN business_vertical bv ON bv.id = t1.businessvertical
		</createView>
	</changeSet>
	

	<changeSet id="9.0_pre" author="Durgaprasad G" dbms="postgresql">
		<sql>
			<![CDATA[
					select deps_save_and_drop_dependencies ('plf', 'financemain_view');
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="09" author="Durgaprasad G">
		<createView viewName="financemain_view" replaceIfExists="true">
				SELECT t1.finreference,
			    t1.investmentref,
			    t1.numberofterms,
			    t1.grcperiodenddate,
			    t1.allowgrcperiod,
			    t1.gracebaserate,
			    t1.gracespecialrate,
			    t1.grcpftrate,
			    t1.grcpftfrq,
			    t1.nextgrcpftdate,
			    t1.allowgrcpftrvw,
			    t1.grcpftrvwfrq,
			    t1.nextgrcpftrvwdate,
			    t1.allowgrccpz,
			    t1.grccpzfrq,
			    t1.nextgrccpzdate,
			    t1.repaybaserate,
			    t1.repayspecialrate,
			    t1.repayprofitrate,
			    t1.repayfrq,
			    t1.nextrepaydate,
			    t1.repaypftfrq,
			    t1.nextrepaypftdate,
			    t1.allowrepayrvw,
			    t1.repayrvwfrq,
			    t1.nextrepayrvwdate,
			    t1.allowrepaycpz,
			    t1.repaycpzfrq,
			    t1.nextrepaycpzdate,
			    t1.maturitydate,
			    t1.cpzatgraceend,
			    t1.downpayment,
			    t1.graceflatamount,
			    t1.reqrepayamount,
			    t1.totalprofit,
			    t1.totalcpz,
			    t1.totalgrosspft,
			    t1.totalgrossgrcpft,
			    t1.totalgracepft,
			    t1.totalgracecpz,
			    t1.grcratebasis,
			    t1.repayratebasis,
			    t1.fintype,
			    t1.finremarks,
			    t1.finccy,
			    t1.schedulemethod,
			    t1.profitdaysbasis,
			    t1.reqmaturity,
			    t1.calterms,
			    t1.calmaturity,
			    t1.firstrepay,
			    t1.lastrepay,
			    t1.finstartdate,
			    t1.finamount,
			    t1.finamount + t1.feechargeamt - t1.downpayment AS lovdescfinancingamount,
			    t1.finrepaymentamount,
			    t1.custid,
			    t1.defferments,
			    t1.plandefercount,
			    t1.finbranch,
			    t1.finsourceid,
			    t1.alloweddefrpychange,
			    t1.availeddefrpychange,
			    t1.alloweddeffrqchange,
			    t1.availeddeffrqchange,
			    t1.recaltype,
			    t1.finassetvalue,
			    t1.disbaccountid,
			    t1.repayaccountid,
			    t1.finisactive,
			    t1.limitvalid,
			    t1.overridelimit,
			    t1.securitydeposit,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t7.fintypedesc AS lovdescfintypename,
			    t7.finmaxamount AS lovdescfinmaxamt,
			    t7.finminamount AS lovdescfinminamount,
			    t1.mindownpayperc,
			    t7.finisalwdifferment AS lovdescfinalwdeferment,
			    t7.finisdwpayrequired AS lovdescdwnpayreq,
			    t7.finmaxdifferment AS lovdescfinmaxdifferment,
			    t12.branchdesc AS lovdescfinbranchname,
			    t12.branchprovince AS finbranchprovincecode,
			    t1.lastrepaydate,
			    t1.lastrepaypftdate,
			    t1.lastrepayrvwdate,
			    t1.lastrepaycpzdate,
			    t1.allowgrcrepay,
			    t1.grcschdmthd,
			    t1.grcmargin,
			    t1.repaymargin,
			    t1.fincurrassetvalue,
			    t1.fincommitmentref,
			    t1.finlimitref,
			    t1.depreciationfrq,
			    t1.fincontractdate,
			    t1.nextdepdate,
			    t1.lastdepdate,
			    t1.finaccount,
			    t1.fincustpftaccount,
			    t17.acrtilllbd AS lovdescaccruedtilllbd,
			    t7.finrvwrateapplfor,
			    t1.totalrepayamt,
			    t1.closingstatus,
			    t1.finapproveddate,
			    t1.feechargeamt,
			    t1.blacklisted,
			    t1.finrepaypftonfrq,
			    t1.anualizedpercrate,
			    t1.effectiverateofreturn,
			    t1.migratedfinance,
			    t1.schedulemaintained,
			    t1.scheduleregenerated,
			    t1.finpurpose,
			    t39.loanpurposedesc AS lovdescfinpurposename,
			    t1.finstatus,
			    t1.finstsreason,
			    t1.initiateuser,
			    t1.bankname,
			    t1.iban,
			    t1.accounttype,
			    t1.ddareferenceno,
			    t7.finscheduleon AS lovdescfinscheduleon,
			    t1.custdsr,
			    t1.jointaccount,
			    t1.jointcustid,
			    t1.downpaybank,
			    t1.downpaysupl,
			    t1.downpayaccount,
			    t1.securitycollateral,
			    t1.approved,
			    t1.discrepancy,
			    t1.limitapproved,
			    t1.graceterms,
			    t7.findivision AS lovdescfindivision,
			    t1.rcdmaintainsts,
			    t1.finrepaymethod,
			    t1.grcprofitdaysbasis,
			    t1.stepfinance,
			    t1.steptype,
			    t1.steppolicy,
			    t1.alwmanualsteps,
			    t1.noofsteps,
			    t1.linkedfinref,
			    t1.nextuserid,
			    t1.priority,
			    t24.policydesc AS lovdescsteppolicyname,
			    t1.grcminrate,
			    t1.grcmaxrate,
			    t1.rpyminrate,
			    t1.rpymaxrate,
			    t1.deviationapproval,
			    t1.manualschedule,
			    t1.takeoverfinance,
			    t1.grcadvbaserate,
			    t1.grcadvmargin,
			    t1.grcadvpftrate,
			    t1.rpyadvbaserate,
			    t1.rpyadvmargin,
			    t1.rpyadvpftrate,
			    t1.supplementrent,
			    t1.increasedcost,
			    t1.creditinsamt,
			    t1.rolloverfrq,
			    t1.nextrolloverdate,
			    t27.custstsdescription,
			    t1.shariastatus,
			    t1.initiatedate,
			    t1.finpreapprovedref,
			    t1.mmaid,
			    t1.accountsofficer,
			    t1.feeaccountid,
			    t1.fincancelac,
			    t28.dealername AS lovdescaccountsofficer,
			    t28.dealercity AS lovdescsourcecity,
			    t1.dsacode,
			    t30.rofficerdesc AS dsacodedesc,
			    t1.tdsapplicable,
			    t1.mandateid,
			    t1.droplinefrq,
			    t1.firstdroplinedate,
			    t1.pftservicingodlimit,
			    t1.insuranceamt,
			    t1.deductinsdisb,
			    t1.alwbpi,
			    t1.bpitreatment,
			    t1.planemihalw,
			    t1.planemihmethod,
			    t1.planemihmaxperyear,
			    t1.planemihmax,
			    t1.planemihlockperiod,
			    t1.planemicpz,
			    t1.calroundingmode,
			    t1.alwmultidisb,
			    t1.applicationno,
			    t1.referralid,
			    t33.rofficerdesc AS referraliddesc,
			    t1.dmacode,
			    t34.rofficerdesc AS dmacodedesc,
			    t1.salesdepartment,
			    t35.gendeptdesc AS salesdepartmentdesc,
			    t1.quickdisb,
			    t1.wifreference,
			    t1.unplanemihlockperiod,
			    t1.unplanemicpz,
			    t1.reagecpz,
			    t1.maxunplannedemi,
			    t1.maxreageholidays,
			    t1.availedunplanemi,
			    t1.availedreageh,
			    t1.bpiamount,
			    t1.deductfeedisb,
			    t1.rvwrateapplfor,
			    t1.schcalonrvw,
			    t1.pastduepftcalmthd,
			    t1.pastduepftmargin,
			    t1.droppingmethod,
			    t1.ratechganyday,
			    t1.promotioncode,
			    t1.restructureloan,
			    t1.oldfinreference,
			    t1.reagebucket,
			    t1.fincategory,
			    t1.productcategory,
			    t1.roundingtarget,
			    t36.entitycode AS lovdescentitycode,
			    t1.eligibilitymethod,
			    t38.fieldcodevalue AS loveligibilitymethod,
			    t38.valuedesc AS lovdesceligibilitymethod,
			    t1.employeename,
			    t37.rofficerdesc AS employeenamedesc,
			    t1.samplingrequired,
			    t1.legalrequired,
			    t1.grcmaxamount,
			    t1.connector,
			    t40.dealername AS connectorcode,
			    t40.dealercity AS connectordesc,
			    t1.advanceemi,
			    t1.advemiterms,
			    t1.bpipftdaysbasis,
			    t1.fixedratetenor,
			    t1.fixedtenorrate,
			    t12.branchtel AS finbranchcontact,
			    t1.processattributes,
			    t1.businessvertical,
			    bv.code AS businessverticalcode,
			    bv.description AS businessverticaldesc,
			    t1.grcadvtype,
			    t1.grcadvterms,
			    t1.advtype,
			    t1.advterms,
			    t1.advstage,
			    t1.tdspercentage,
			    t1.tdsstartdate,
			    t1.tdsenddate,
			    t1.tdslimitamt,
			    t1.vanreq,
			    t1.vancode,
			    t1.allowdrawingpower,
			    t1.allowrevolving,
			    t1.sanbsdschdle,
				t1.PromotionSeqID
			   FROM financemain_temp t1
			     JOIN rmtfinancetypes t7 ON t1.fintype = t7.fintype
			     LEFT JOIN rmtbranches t12 ON t1.finbranch = t12.branchcode
			     LEFT JOIN finpftdetails t17 ON t17.finreference = t1.finreference
			     LEFT JOIN steppolicyheader t24 ON t1.steppolicy = t24.policycode
			     LEFT JOIN bmtcuststatuscodes t27 ON t1.finstatus = t27.custstscode
			     LEFT JOIN amtvehicledealer t28 ON t1.accountsofficer = t28.dealerid
			     LEFT JOIN relationshipofficers t30 ON t1.dsacode = t30.rofficercode
			     LEFT JOIN relationshipofficers t33 ON t1.referralid = t33.rofficercode
			     LEFT JOIN relationshipofficers t34 ON t1.dmacode = t34.rofficercode
			     LEFT JOIN rmtgendepartments t35 ON t1.salesdepartment = t35.gendepartment
			     LEFT JOIN smtdivisiondetail t36 ON t7.findivision = t36.divisioncode
			     LEFT JOIN relationshipofficers t37 ON t1.employeename = t37.rofficercode
			     LEFT JOIN rmtlovfielddetail t38 ON t1.eligibilitymethod = t38.fieldcodeid AND t38.fieldcode = 'ELGMETHOD'
			     LEFT JOIN loanpurposes t39 ON t1.finpurpose = t39.loanpurposecode
			     LEFT JOIN amtvehicledealer t40 ON t1.connector = t40.dealerid
			     LEFT JOIN business_vertical bv ON bv.id = t1.businessvertical
			UNION ALL
			 SELECT t1.finreference,
			    t1.investmentref,
			    t1.numberofterms,
			    t1.grcperiodenddate,
			    t1.allowgrcperiod,
			    t1.gracebaserate,
			    t1.gracespecialrate,
			    t1.grcpftrate,
			    t1.grcpftfrq,
			    t1.nextgrcpftdate,
			    t1.allowgrcpftrvw,
			    t1.grcpftrvwfrq,
			    t1.nextgrcpftrvwdate,
			    t1.allowgrccpz,
			    t1.grccpzfrq,
			    t1.nextgrccpzdate,
			    t1.repaybaserate,
			    t1.repayspecialrate,
			    t1.repayprofitrate,
			    t1.repayfrq,
			    t1.nextrepaydate,
			    t1.repaypftfrq,
			    t1.nextrepaypftdate,
			    t1.allowrepayrvw,
			    t1.repayrvwfrq,
			    t1.nextrepayrvwdate,
			    t1.allowrepaycpz,
			    t1.repaycpzfrq,
			    t1.nextrepaycpzdate,
			    t1.maturitydate,
			    t1.cpzatgraceend,
			    t1.downpayment,
			    t1.graceflatamount,
			    t1.reqrepayamount,
			    t1.totalprofit,
			    t1.totalcpz,
			    t1.totalgrosspft,
			    t1.totalgrossgrcpft,
			    t1.totalgracepft,
			    t1.totalgracecpz,
			    t1.grcratebasis,
			    t1.repayratebasis,
			    t1.fintype,
			    t1.finremarks,
			    t1.finccy,
			    t1.schedulemethod,
			    t1.profitdaysbasis,
			    t1.reqmaturity,
			    t1.calterms,
			    t1.calmaturity,
			    t1.firstrepay,
			    t1.lastrepay,
			    t1.finstartdate,
			    t1.finamount,
			    t1.finamount + t1.feechargeamt - t1.downpayment AS lovdescfinancingamount,
			    t1.finrepaymentamount,
			    t1.custid,
			    t1.defferments,
			    t1.plandefercount,
			    t1.finbranch,
			    t1.finsourceid,
			    t1.alloweddefrpychange,
			    t1.availeddefrpychange,
			    t1.alloweddeffrqchange,
			    t1.availeddeffrqchange,
			    t1.recaltype,
			    t1.finassetvalue,
			    t1.disbaccountid,
			    t1.repayaccountid,
			    t1.finisactive,
			    t1.limitvalid,
			    t1.overridelimit,
			    t1.securitydeposit,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t7.fintypedesc AS lovdescfintypename,
			    t7.finmaxamount AS lovdescfinmaxamt,
			    t7.finminamount AS lovdescfinminamount,
			    t1.mindownpayperc,
			    t7.finisalwdifferment AS lovdescfinalwdeferment,
			    t7.finisdwpayrequired AS lovdescdwnpayreq,
			    t7.finmaxdifferment AS lovdescfinmaxdifferment,
			    t12.branchdesc AS lovdescfinbranchname,
			    t12.branchprovince AS finbranchprovincecode,
			    t1.lastrepaydate,
			    t1.lastrepaypftdate,
			    t1.lastrepayrvwdate,
			    t1.lastrepaycpzdate,
			    t1.allowgrcrepay,
			    t1.grcschdmthd,
			    t1.grcmargin,
			    t1.repaymargin,
			    t1.fincurrassetvalue,
			    t1.fincommitmentref,
			    t1.finlimitref,
			    t1.depreciationfrq,
			    t1.fincontractdate,
			    t1.nextdepdate,
			    t1.lastdepdate,
			    t1.finaccount,
			    t1.fincustpftaccount,
			    t17.acrtilllbd AS lovdescaccruedtilllbd,
			    t7.finrvwrateapplfor,
			    t1.totalrepayamt,
			    t1.closingstatus,
			    t1.finapproveddate,
			    t1.feechargeamt,
			    t1.blacklisted,
			    t1.finrepaypftonfrq,
			    t1.anualizedpercrate,
			    t1.effectiverateofreturn,
			    t1.migratedfinance,
			    t1.schedulemaintained,
			    t1.scheduleregenerated,
			    t1.finpurpose,
			    t39.loanpurposedesc AS lovdescfinpurposename,
			    t1.finstatus,
			    t1.finstsreason,
			    t1.initiateuser,
			    t1.bankname,
			    t1.iban,
			    t1.accounttype,
			    t1.ddareferenceno,
			    t7.finscheduleon AS lovdescfinscheduleon,
			    t1.custdsr,
			    t1.jointaccount,
			    t1.jointcustid,
			    t1.downpaybank,
			    t1.downpaysupl,
			    t1.downpayaccount,
			    t1.securitycollateral,
			    t1.approved,
			    t1.discrepancy,
			    t1.limitapproved,
			    t1.graceterms,
			    t7.findivision AS lovdescfindivision,
			    t1.rcdmaintainsts,
			    t1.finrepaymethod,
			    t1.grcprofitdaysbasis,
			    t1.stepfinance,
			    t1.steptype,
			    t1.steppolicy,
			    t1.alwmanualsteps,
			    t1.noofsteps,
			    t1.linkedfinref,
			    t1.nextuserid,
			    t1.priority,
			    t24.policydesc AS lovdescsteppolicyname,
			    t1.grcminrate,
			    t1.grcmaxrate,
			    t1.rpyminrate,
			    t1.rpymaxrate,
			    t1.deviationapproval,
			    t1.manualschedule,
			    t1.takeoverfinance,
			    t1.grcadvbaserate,
			    t1.grcadvmargin,
			    t1.grcadvpftrate,
			    t1.rpyadvbaserate,
			    t1.rpyadvmargin,
			    t1.rpyadvpftrate,
			    t1.supplementrent,
			    t1.increasedcost,
			    t1.creditinsamt,
			    t1.rolloverfrq,
			    t1.nextrolloverdate,
			    t27.custstsdescription,
			    t1.shariastatus,
			    t1.initiatedate,
			    t1.finpreapprovedref,
			    t1.mmaid,
			    t1.accountsofficer,
			    t1.feeaccountid,
			    t1.fincancelac,
			    t28.dealername AS lovdescaccountsofficer,
			    t28.dealercity AS lovdescsourcecity,
			    t1.dsacode,
			    t30.rofficerdesc AS dsacodedesc,
			    t1.tdsapplicable,
			    t1.mandateid,
			    t1.droplinefrq,
			    t1.firstdroplinedate,
			    t1.pftservicingodlimit,
			    t1.insuranceamt,
			    t1.deductinsdisb,
			    t1.alwbpi,
			    t1.bpitreatment,
			    t1.planemihalw,
			    t1.planemihmethod,
			    t1.planemihmaxperyear,
			    t1.planemihmax,
			    t1.planemihlockperiod,
			    t1.planemicpz,
			    t1.calroundingmode,
			    t1.alwmultidisb,
			    t1.applicationno,
			    t1.referralid,
			    t33.rofficerdesc AS referraliddesc,
			    t1.dmacode,
			    t34.rofficerdesc AS dmacodedesc,
			    t1.salesdepartment,
			    t35.gendeptdesc AS salesdepartmentdesc,
			    t1.quickdisb,
			    t1.wifreference,
			    t1.unplanemihlockperiod,
			    t1.unplanemicpz,
			    t1.reagecpz,
			    t1.maxunplannedemi,
			    t1.maxreageholidays,
			    t1.availedunplanemi,
			    t1.availedreageh,
			    t1.bpiamount,
			    t1.deductfeedisb,
			    t1.rvwrateapplfor,
			    t1.schcalonrvw,
			    t1.pastduepftcalmthd,
			    t1.pastduepftmargin,
			    t1.droppingmethod,
			    t1.ratechganyday,
			    t1.promotioncode,
			    t1.restructureloan,
			    t1.oldfinreference,
			    t1.reagebucket,
			    t1.fincategory,
			    t1.productcategory,
			    t1.roundingtarget,
			    t36.entitycode AS lovdescentitycode,
			    t1.eligibilitymethod,
			    t38.fieldcodevalue AS loveligibilitymethod,
			    t38.valuedesc AS lovdesceligibilitymethod,
			    t1.employeename,
			    t37.rofficerdesc AS employeenamedesc,
			    t1.samplingrequired,
			    t1.legalrequired,
			    t1.grcmaxamount,
			    t1.connector,
			    t40.dealername AS connectorcode,
			    t40.dealercity AS connectordesc,
			    t1.advanceemi,
			    t1.advemiterms,
			    t1.bpipftdaysbasis,
			    t1.fixedratetenor,
			    t1.fixedtenorrate,
			    t12.branchtel AS finbranchcontact,
			    t1.processattributes,
			    t1.businessvertical,
			    bv.code AS businessverticalcode,
			    bv.description AS businessverticaldesc,
			    t1.grcadvtype,
			    t1.grcadvterms,
			    t1.advtype,
			    t1.advterms,
			    t1.advstage,
			    t1.tdspercentage,
			    t1.tdsstartdate,
			    t1.tdsenddate,
			    t1.tdslimitamt,
			    t1.vanreq,
			    t1.vancode,
			    t1.allowdrawingpower,
			    t1.allowrevolving,
			    t1.sanbsdschdle,
				t1.PromotionSeqID
			   FROM financemain t1
			     JOIN rmtfinancetypes t7 ON t1.fintype = t7.fintype
			     LEFT JOIN rmtbranches t12 ON t1.finbranch = t12.branchcode
			     LEFT JOIN finpftdetails t17 ON t17.finreference = t1.finreference
			     LEFT JOIN steppolicyheader t24 ON t1.steppolicy = t24.policycode
			     LEFT JOIN bmtcuststatuscodes t27 ON t1.finstatus = t27.custstscode
			     LEFT JOIN amtvehicledealer t28 ON t1.accountsofficer = t28.dealerid
			     LEFT JOIN relationshipofficers t30 ON t1.dsacode = t30.rofficercode
			     LEFT JOIN relationshipofficers t33 ON t1.referralid = t33.rofficercode
			     LEFT JOIN relationshipofficers t34 ON t1.dmacode = t34.rofficercode
			     LEFT JOIN rmtgendepartments t35 ON t1.salesdepartment = t35.gendepartment
			     LEFT JOIN smtdivisiondetail t36 ON t7.findivision = t36.divisioncode
			     LEFT JOIN relationshipofficers t37 ON t1.employeename = t37.rofficercode
			     LEFT JOIN rmtlovfielddetail t38 ON t1.eligibilitymethod = t38.fieldcodeid AND t38.fieldcode = 'ELGMETHOD'
			     LEFT JOIN loanpurposes t39 ON t1.finpurpose = t39.loanpurposecode
			     LEFT JOIN amtvehicledealer t40 ON t1.connector = t40.dealerid
			     LEFT JOIN business_vertical bv ON bv.id = t1.businessvertical
			  WHERE NOT (EXISTS ( SELECT 1
			           FROM financemain_temp
			          WHERE financemain_temp.finreference = t1.finreference))
		</createView>
	</changeSet>
	
	<changeSet id="9.0_post" author="Durgaprasad G" dbms="postgresql">
		<sql>
			<![CDATA[
					select deps_restore_dependencies ('plf', 'financemain_view');
			]]>
		</sql>
	</changeSet>
	
	
	<changeSet id="10" author="Durgaprasad G">
		<createView viewName="financemaintenance_aview" replaceIfExists="true">
			SELECT t1.finreference,
		    t1.finbranch,
		    t1.fintype,
		    t1.finccy,
		    t1.schedulemethod,
		    t1.profitdaysbasis,
		    t1.finstartdate,
		    t1.numberofterms,
		    t1.custid,
		    t1.finamount,
		    t1.maturitydate,
		    t1.finrepaymentamount,
		    t1.finisactive,
		    t1.blacklisted,
		    t1.feechargeamt,
		    t1.insuranceamt,
		    t1.graceterms,
		    t1.allowgrcperiod,
		    t1.grcperiodenddate,
		    t1.alwmultidisb,
		    t1.defferments,
		    t1.nextrolecode,
		    t1.recordstatus,
		    t1.recordtype,
		    t1.allowgrcpftrvw,
		    t1.allowrepayrvw,
		    t1.lastrepaydate,
		    t1.lastrepaypftdate,
		    t1.alloweddefrpychange,
		    t1.availeddefrpychange,
		    t1.migratedfinance,
		    t1.rcdmaintainsts,
		    t1.closingstatus,
		    t1.repayratebasis,
		    t1.manualschedule,
		    t1.takeoverfinance,
		    t1.nextrolloverdate,
		    t1.downpayment,
		    t1.planemihalw,
		    t1.fincurrassetvalue,
		    t1.finassetvalue,
		    t2.custcif AS lovdesccustcif,
		    t3.fincategory AS lovdescproductcodename,
		    t3.finisalwdifferment AS lovdescfinalwdeferment,
		    t4.productcategory,
		    t1.samplingrequired,
		    t1.advanceemi,
		    t1.advemiterms,
		    t1.bpipftdaysbasis AS bpiratebasis,
		    t1.sanbsdschdle,
			t1.PromotionSeqID
		   FROM financemain t1
		     JOIN customers t2 ON t1.custid = t2.custid
		     JOIN rmtfinancetypes t3 ON t1.fintype = t3.fintype
		     JOIN bmtproduct t4 ON t3.fincategory = t4.productcode
		</createView>
	</changeSet>
	
	<changeSet id="11" author="Durgaprasad G" dbms="postgresql,oracle">
		<createView viewName="financemaintenance_view" replaceIfExists="true">
					SELECT t1.finreference,
		    t1.finbranch,
		    t1.fintype,
		    t1.finccy,
		    t1.schedulemethod,
		    t1.profitdaysbasis,
		    t1.finstartdate,
		    t1.numberofterms,
		    t1.custid,
		    t1.finamount,
		    t1.maturitydate,
		    t1.finrepaymentamount,
		    t1.finisactive,
		    t1.blacklisted,
		    t1.feechargeamt,
		    t1.insuranceamt,
		    t1.graceterms,
		    t1.allowgrcperiod,
		    t1.grcperiodenddate,
		    t1.alwmultidisb,
		    t1.defferments,
		    t1.nextrolecode,
		    t1.recordstatus,
		    t1.recordtype,
		    t1.allowgrcpftrvw,
		    t1.allowrepayrvw,
		    t1.lastrepaydate,
		    t1.lastrepaypftdate,
		    t1.alloweddefrpychange,
		    t1.availeddefrpychange,
		    t1.rcdmaintainsts,
		    t1.migratedfinance,
		    t1.closingstatus,
		    t1.repayratebasis,
		    t1.manualschedule,
		    t1.fincurrassetvalue,
		    t1.takeoverfinance,
		    t1.nextrolloverdate,
		    t1.availedunplanemi,
		    t1.availedreageh,
		    t1.maxunplannedemi,
		    t1.maxreageholidays,
		    t1.downpayment,
		    t1.planemihalw,
		    t1.calterms,
		    t1.ratechganyday,
		    t1.finassetvalue,
		    t2.custcif AS lovdesccustcif,
		    t3.finisalwdifferment AS lovdescfinalwdeferment,
		    t3.findivision AS lovdescfindivision,
		    t3.fincategory AS lovdescproductcodename,
		    t4.productcategory,
		    COALESCE(t5.roledesc, fn_get_roledesc(t1.nextrolecode)) AS lovdescrequeststage,
		    COALESCE(t9.noinst, 0) AS noinst,
		    t1.samplingrequired,
		    t1.advemiterms,
		    t1.sanbsdschdle,
			t1.PromotionSeqID
		   FROM financemain_temp t1
		     JOIN customers t2 ON t1.custid = t2.custid
		     JOIN rmtfinancetypes t3 ON t1.fintype = t3.fintype
		     LEFT JOIN secroles t5 ON t1.nextrolecode = t5.rolecd
		     JOIN bmtproduct t4 ON t3.fincategory = t4.productcode
		     LEFT JOIN finpftdetails t9 ON t1.finreference = t9.finreference
		UNION ALL
		 SELECT t1.finreference,
		    t1.finbranch,
		    t1.fintype,
		    t1.finccy,
		    t1.schedulemethod,
		    t1.profitdaysbasis,
		    t1.finstartdate,
		    t1.numberofterms,
		    t1.custid,
		    t1.finamount,
		    t1.maturitydate,
		    t1.finrepaymentamount,
		    t1.finisactive,
		    t1.blacklisted,
		    t1.feechargeamt,
		    t1.insuranceamt,
		    t1.graceterms,
		    t1.allowgrcperiod,
		    t1.grcperiodenddate,
		    t1.alwmultidisb,
		    t1.defferments,
		    t1.nextrolecode,
		    t1.recordstatus,
		    t1.recordtype,
		    t1.allowgrcpftrvw,
		    t1.allowrepayrvw,
		    t1.lastrepaydate,
		    t1.lastrepaypftdate,
		    t1.alloweddefrpychange,
		    t1.availeddefrpychange,
		    t1.rcdmaintainsts,
		    t1.migratedfinance,
		    t1.closingstatus,
		    t1.repayratebasis,
		    t1.manualschedule,
		    t1.fincurrassetvalue,
		    t1.takeoverfinance,
		    t1.nextrolloverdate,
		    t1.availedunplanemi,
		    t1.availedreageh,
		    t1.maxunplannedemi,
		    t1.maxreageholidays,
		    t1.downpayment,
		    t1.planemihalw,
		    t1.calterms,
		    t1.ratechganyday,
		    t1.finassetvalue,
		    t2.custcif AS lovdesccustcif,
		    t3.finisalwdifferment AS lovdescfinalwdeferment,
		    t3.findivision AS lovdescfindivision,
		    t3.fincategory AS lovdescproductcodename,
		    t4.productcategory,
		    COALESCE(t5.roledesc, fn_get_roledesc(t1.nextrolecode)) AS lovdescrequeststage,
		    COALESCE(t9.noinst, 0) AS noinst,
		    t1.samplingrequired,
		    t1.advemiterms,
		    t1.sanbsdschdle,
			t1.PromotionSeqID
		   FROM financemain t1
		     JOIN customers t2 ON t1.custid = t2.custid
		     JOIN rmtfinancetypes t3 ON t1.fintype = t3.fintype
		     LEFT JOIN secroles t5 ON t1.nextrolecode = t5.rolecd
		     JOIN bmtproduct t4 ON t3.fincategory = t4.productcode
		     LEFT JOIN finpftdetails t9 ON t1.finreference = t9.finreference
		  WHERE NOT (EXISTS ( SELECT 1 AS expr1
		           FROM financemain_temp
		          WHERE financemain_temp.finreference = t1.finreference))
		</createView>
	</changeSet>
	
	<changeSet id="11" author="Durgaprasad G" dbms="mssql">
		<createView viewName="financemaintenance_view" replaceIfExists="true">
					SELECT t1.finreference,
		    t1.finbranch,
		    t1.fintype,
		    t1.finccy,
		    t1.schedulemethod,
		    t1.profitdaysbasis,
		    t1.finstartdate,
		    t1.numberofterms,
		    t1.custid,
		    t1.finamount,
		    t1.maturitydate,
		    t1.finrepaymentamount,
		    t1.finisactive,
		    t1.blacklisted,
		    t1.feechargeamt,
		    t1.insuranceamt,
		    t1.graceterms,
		    t1.allowgrcperiod,
		    t1.grcperiodenddate,
		    t1.alwmultidisb,
		    t1.defferments,
		    t1.nextrolecode,
		    t1.recordstatus,
		    t1.recordtype,
		    t1.allowgrcpftrvw,
		    t1.allowrepayrvw,
		    t1.lastrepaydate,
		    t1.lastrepaypftdate,
		    t1.alloweddefrpychange,
		    t1.availeddefrpychange,
		    t1.rcdmaintainsts,
		    t1.migratedfinance,
		    t1.closingstatus,
		    t1.repayratebasis,
		    t1.manualschedule,
		    t1.fincurrassetvalue,
		    t1.takeoverfinance,
		    t1.nextrolloverdate,
		    t1.availedunplanemi,
		    t1.availedreageh,
		    t1.maxunplannedemi,
		    t1.maxreageholidays,
		    t1.downpayment,
		    t1.planemihalw,
		    t1.calterms,
		    t1.ratechganyday,
		    t1.finassetvalue,
		    t2.custcif AS lovdesccustcif,
		    t3.finisalwdifferment AS lovdescfinalwdeferment,
		    t3.findivision AS lovdescfindivision,
		    t3.fincategory AS lovdescproductcodename,
		    t4.productcategory,
		    COALESCE(t5.roledesc, dbo.fn_get_roledesc(t1.nextrolecode)) AS lovdescrequeststage,
		    COALESCE(t9.noinst, 0) AS noinst,
		    t1.samplingrequired,
		    t1.advemiterms,
		    t1.sanbsdschdle,
			t1.PromotionSeqID
		   FROM financemain_temp t1
		     JOIN customers t2 ON t1.custid = t2.custid
		     JOIN rmtfinancetypes t3 ON t1.fintype = t3.fintype
		     LEFT JOIN secroles t5 ON t1.nextrolecode = t5.rolecd
		     JOIN bmtproduct t4 ON t3.fincategory = t4.productcode
		     LEFT JOIN finpftdetails t9 ON t1.finreference = t9.finreference
		UNION ALL
		 SELECT t1.finreference,
		    t1.finbranch,
		    t1.fintype,
		    t1.finccy,
		    t1.schedulemethod,
		    t1.profitdaysbasis,
		    t1.finstartdate,
		    t1.numberofterms,
		    t1.custid,
		    t1.finamount,
		    t1.maturitydate,
		    t1.finrepaymentamount,
		    t1.finisactive,
		    t1.blacklisted,
		    t1.feechargeamt,
		    t1.insuranceamt,
		    t1.graceterms,
		    t1.allowgrcperiod,
		    t1.grcperiodenddate,
		    t1.alwmultidisb,
		    t1.defferments,
		    t1.nextrolecode,
		    t1.recordstatus,
		    t1.recordtype,
		    t1.allowgrcpftrvw,
		    t1.allowrepayrvw,
		    t1.lastrepaydate,
		    t1.lastrepaypftdate,
		    t1.alloweddefrpychange,
		    t1.availeddefrpychange,
		    t1.rcdmaintainsts,
		    t1.migratedfinance,
		    t1.closingstatus,
		    t1.repayratebasis,
		    t1.manualschedule,
		    t1.fincurrassetvalue,
		    t1.takeoverfinance,
		    t1.nextrolloverdate,
		    t1.availedunplanemi,
		    t1.availedreageh,
		    t1.maxunplannedemi,
		    t1.maxreageholidays,
		    t1.downpayment,
		    t1.planemihalw,
		    t1.calterms,
		    t1.ratechganyday,
		    t1.finassetvalue,
		    t2.custcif AS lovdesccustcif,
		    t3.finisalwdifferment AS lovdescfinalwdeferment,
		    t3.findivision AS lovdescfindivision,
		    t3.fincategory AS lovdescproductcodename,
		    t4.productcategory,
		    COALESCE(t5.roledesc, dbo.fn_get_roledesc(t1.nextrolecode)) AS lovdescrequeststage,
		    COALESCE(t9.noinst, 0) AS noinst,
		    t1.samplingrequired,
		    t1.advemiterms,
		    t1.sanbsdschdle,
			t1.PromotionSeqID
		   FROM financemain t1
		     JOIN customers t2 ON t1.custid = t2.custid
		     JOIN rmtfinancetypes t3 ON t1.fintype = t3.fintype
		     LEFT JOIN secroles t5 ON t1.nextrolecode = t5.rolecd
		     JOIN bmtproduct t4 ON t3.fincategory = t4.productcode
		     LEFT JOIN finpftdetails t9 ON t1.finreference = t9.finreference
		  WHERE NOT (EXISTS ( SELECT 1 AS expr1
		           FROM financemain_temp
		          WHERE financemain_temp.finreference = t1.finreference))
		</createView>
	</changeSet>
	
	<changeSet id="12" author="Durgaprasad G">
		<sql>
			INSERT INTO bmtintratebasiscodes(
			intratebasiscode, intratebasisdesc, intratebasisisactive, version, lastmntby, lastmnton, recordstatus, rolecode, nextrolecode, taskid, nexttaskid, recordtype, workflowid)
			VALUES ('P/360', 'Periodicity (30D Periods )', 1, 0, 1000, Current_TimeStamp, 'Approved', null, null, null, null, null, 0);
		</sql>
	</changeSet>
	
	<changeSet id="10" author="satyanarayana.g">
		<addColumn tableName="WIFFINANCEMAIN">
			<column name="AllowDrawingPower" type="boolean" />
			<column name="AllowRevolving" type="boolean" />
		</addColumn>
	</changeSet>

	<changeSet id="11" author="satyanarayana.g">
		<addColumn tableName="WIFFINANCEMAIN_TEMP">
			<column name="AllowDrawingPower" type="boolean" />
			<column name="AllowRevolving" type="boolean" />
		</addColumn>
	</changeSet>

	<changeSet id="12" author="satyanarayana.g">
		<sql>
			<![CDATA[
				UPDATE WIFFINANCEMAIN Set AllowDrawingPower = 0  where AllowDrawingPower is null;
				UPDATE WIFFINANCEMAIN Set AllowRevolving = 0 where AllowDrawingPower is null;
				UPDATE WIFFINANCEMAIN_TEMP Set AllowDrawingPower = 0 where AllowDrawingPower is null;
				UPDATE WIFFINANCEMAIN_TEMP Set AllowRevolving = 0 where AllowDrawingPower is null;
			]]>
		</sql>
	</changeSet>

	<changeSet id="13.0" author="satyanarayana.g" dbms="mssql">
		<sql>
			<![CDATA[	
				ALTER TABLE WIFFINANCEMAIN ADD CONSTRAINT DF_WIFFINANCEMAIN_ALWDP DEFAULT 0 FOR ALLOWDRAWINGPOWER;
				ALTER TABLE WIFFINANCEMAIN ADD CONSTRAINT DF_WIFFINANCEMAIN_ALWRNG DEFAULT 0 FOR ALLOWREVOLVING;
				ALTER TABLE WIFFINANCEMAIN_TEMP ADD CONSTRAINT DF_WIFFINANCEMAIN_TEMP_ALWDP DEFAULT 0 FOR ALLOWDRAWINGPOWER;
				ALTER TABLE WIFFINANCEMAIN_TEMP ADD CONSTRAINT DF_WIFFINANCEMAIN_TEMP_ALWRNG DEFAULT 0 FOR ALLOWREVOLVING;
			]]>
		</sql>
	</changeSet>

	<changeSet id="14" author="satyanarayana.g" dbms="postgresql, oracle">
		<addDefaultValue columnName="AllowDrawingPower" tableName="WIFFINANCEMAIN" defaultValue="0" />
		<addDefaultValue columnName="AllowRevolving" tableName="WIFFINANCEMAIN" defaultValue="0" />
		<addDefaultValue columnName="AllowDrawingPower" tableName="WIFFINANCEMAIN_TEMP" defaultValue="0" />
		<addDefaultValue columnName="AllowRevolving" tableName="WIFFINANCEMAIN_TEMP" defaultValue="0" />
	</changeSet>
	
	<changeSet id="15_pre" author="satyanarayana.g" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'wiffinancemain_view');
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="15" author="satyanarayana.g">
		<createView viewName="WIFFINANCEMAIN_VIEW" replaceIfExists="true">
			SELECT T1.FINREFERENCE,
					T1.NUMBEROFTERMS,
					T1.GRCPERIODENDDATE,
					T1.ALLOWGRCPERIOD,
					T1.GRACEBASERATE,
					T1.GRACESPECIALRATE,
					T1.GRCPFTRATE,
					T1.GRCPFTFRQ,
					T1.NEXTGRCPFTDATE,
					T1.ALLOWGRCPFTRVW,
					T1.GRCPFTRVWFRQ,
					T1.NEXTGRCPFTRVWDATE,
					T1.ALLOWGRCCPZ,
					T1.GRCCPZFRQ,
					T1.NEXTGRCCPZDATE,
					T1.REPAYBASERATE,
					T1.REPAYSPECIALRATE,
					T1.REPAYPROFITRATE,
					T1.REPAYFRQ,
					T1.NEXTREPAYDATE,
					T1.REPAYPFTFRQ,
					T1.NEXTREPAYPFTDATE,
					T1.ALLOWREPAYRVW,
					T1.REPAYRVWFRQ,
					T1.NEXTREPAYRVWDATE,
					T1.ALLOWREPAYCPZ,
					T1.REPAYCPZFRQ,
					T1.NEXTREPAYCPZDATE,
					T1.MATURITYDATE,
					T1.CPZATGRACEEND,
					T1.DOWNPAYMENT,
					T1.GRACEFLATAMOUNT,
					T1.REQREPAYAMOUNT,
					T1.TOTALPROFIT,
					T1.TOTALCPZ,
					T1.TOTALGROSSPFT,
					T1.TOTALGRACEPFT,
					T1.TOTALGRACECPZ,
					T1.GRCRATEBASIS,
					T1.REPAYRATEBASIS,
					T1.FINTYPE,
					T1.FINREMARKS,
					T1.FINCCY,
					T1.SCHEDULEMETHOD,
					T1.PROFITDAYSBASIS,
					T1.REQMATURITY,
					T1.CALTERMS,
					T1.CALMATURITY,
					T1.FIRSTREPAY,
					T1.LASTREPAY,
					T1.FINSTARTDATE,
					T1.FINAMOUNT,
					T1.FINREPAYMENTAMOUNT,
					T1.CUSTID,
					T1.DEFFERMENTS,
					T1.PLANDEFERCOUNT,
					T1.FINISACTIVE,
					T1.VERSION,
					T1.LASTMNTBY,
					T1.LASTMNTON,
					T1.RECORDSTATUS,
					T1.ROLECODE,
					T1.NEXTROLECODE,
					T1.TASKID,
					T1.NEXTTASKID,
					T1.RECORDTYPE,
					T1.WORKFLOWID,
					T15.CUSTCIF   LOVDESCCUSTCIF,
					T7.FINTYPEDESC  LOVDESCFINTYPENAME,
					T1.FINBRANCH,
					T1.FINSOURCEID,
					T1.ALLOWEDDEFRPYCHANGE,
					T1.AVAILEDDEFRPYCHANGE,
					T1.ALLOWEDDEFFRQCHANGE,
					T1.AVAILEDDEFFRQCHANGE,
					T7.FINMAXAMOUNT   LOVDESCFINMAXAMT,
					T7.FINMINAMOUNT   LOVDESCFINMINAMOUNT,
					T7.FINISALWDIFFERMENT  LOVDESCFINALWDEFERMENT,
					T1.MINDOWNPAYPERC,
					T7.FINISDWPAYREQUIRED  LOVDESCDWNPAYREQ,
					T1.RECALTYPE,
					T1.FINASSETVALUE,
					T7.FINMAXDIFFERMENT  LOVDESCFINMAXDIFFERMENT,
					T1.LASTREPAYDATE,
					T1.LASTREPAYPFTDATE,
					T1.LASTREPAYRVWDATE,
					T1.LASTREPAYCPZDATE,
					T1.DISBACCOUNTID,
					T1.REPAYACCOUNTID,
					T1.ALLOWGRCREPAY,
					T1.GRCSCHDMTHD,
					T1.REPAYMARGIN,
					T1.GRCMARGIN,
					T1.DEPRECIATIONFRQ,
					T1.FINCOMMITMENTREF,
					T1.FINCURRASSETVALUE,
					T1.FINCONTRACTDATE,
					T1.NEXTDEPDATE,
					T1.LASTDEPDATE,
					T1.FINACCOUNT,
					T1.FINCUSTPFTACCOUNT,
					T7.FINRVWRATEAPPLFOR,
					T1.TOTALREPAYAMT,
					T1.CLOSINGSTATUS,
					T1.FINAPPROVEDDATE,
					T1.FINREPAYPFTONFRQ,
					T1.ANUALIZEDPERCRATE,
					T1.EFFECTIVERATEOFRETURN,
					T1.DOWNPAYBANK,
					T1.DOWNPAYSUPL,
					T7.FINDIVISION  LOVDESCFINDIVISIONNAME,
					T1.GRACETERMS,
					T14.FACILITYTYPE,
					T15.CUSTSHRTNAME  LOVDESCCUSTSHRTNAME,
					T16.BRANCHDESC   LOVDESCFINBRANCHNAME,
					T1.TOTALGROSSGRCPFT,
					T1.GRCPROFITDAYSBASIS,
					T1.STEPFINANCE,
					T1.STEPTYPE,
					T1.STEPPOLICY,
					T1.ALWMANUALSTEPS,
					T1.NOOFSTEPS,
					T1.LINKEDFINREF,
					T7.PRODUCT  LOVDESCFINPRODUCT,
					T1.GRCMINRATE,
					T1.GRCMAXRATE,
					T1.RPYMINRATE,
					T1.RPYMAXRATE,
					T1.MANUALSCHEDULE,
					T1.TAKEOVERFINANCE,
					T1.GRCADVBASERATE,
					T1.GRCADVMARGIN,
					T1.GRCADVPFTRATE,
					T1.RPYADVBASERATE,
					T1.RPYADVMARGIN,
					T1.RPYADVPFTRATE,
					T1.SUPPLEMENTRENT,
					T1.INCREASEDCOST,
					T1.FEEACCOUNTID,
					T1.TDSAPPLICABLE,
					T1.INSURANCEAMT,
					T1.DEDUCTINSDISB,
					T1.ALWBPI,
					T1.BPITREATMENT,
					T1.PLANEMIHALW,
					T1.PLANEMIHMETHOD,
					T1.PLANEMIHMAXPERYEAR,
					T1.PLANEMIHMAX,
					T1.PLANEMIHLOCKPERIOD,
					T1.PLANEMICPZ,
					T1.CALROUNDINGMODE,
					T1.ALWMULTIDISB,
					T1.BPIAMOUNT,
					T1.DEDUCTFEEDISB,
					T1.FEECHARGEAMT,
					T1.RVWRATEAPPLFOR,
					T1.SCHCALONRVW,
					T1.PASTDUEPFTCALMTHD,
					T1.PASTDUEPFTMARGIN,
					T1.DROPPINGMETHOD,
					T1.RATECHGANYDAY,
					T1.FINCATEGORY,
					T1.PRODUCTCATEGORY,
					T1.ROUNDINGTARGET,
					T1.GRCMAXAMOUNT,
					T1.ADVANCEEMI,
					T1.ADVEMITERMS,
					T1.BPIPFTDAYSBASIS,
					T1.FIXEDTENORRATE,
					T1.FIXEDRATETENOR,
					T1.GRCADVTYPE,
					T1.GRCADVTERMS,
					T1.ADVTYPE,
					T1.ADVTERMS,
					T1.ADVSTAGE,
					T1.ALLOWDRAWINGPOWER,
					T1.ALLOWREVOLVING
					FROM WIFFINANCEMAIN_TEMP T1
					LEFT JOIN WIFINDICATIVETERMDETAIL_TEMP T14 ON T14.FINREFERENCE = T1.FINREFERENCE
					LEFT JOIN CUSTOMERS T15 ON T15.CUSTID = T1.CUSTID
					JOIN RMTFINANCETYPES T7 ON T1.FINTYPE = T7.FINTYPE
					LEFT JOIN RMTBRANCHES T16 ON T1.FINBRANCH = T16.BRANCHCODE
					UNION ALL
					SELECT T1.FINREFERENCE,
					T1.NUMBEROFTERMS,
					T1.GRCPERIODENDDATE,
					T1.ALLOWGRCPERIOD,
					T1.GRACEBASERATE,
					T1.GRACESPECIALRATE,
					T1.GRCPFTRATE,
					T1.GRCPFTFRQ,
					T1.NEXTGRCPFTDATE,
					T1.ALLOWGRCPFTRVW,
					T1.GRCPFTRVWFRQ,
					T1.NEXTGRCPFTRVWDATE,
					T1.ALLOWGRCCPZ,
					T1.GRCCPZFRQ,
					T1.NEXTGRCCPZDATE,
					T1.REPAYBASERATE,
					T1.REPAYSPECIALRATE,
					T1.REPAYPROFITRATE,
					T1.REPAYFRQ,
					T1.NEXTREPAYDATE,
					T1.REPAYPFTFRQ,
					T1.NEXTREPAYPFTDATE,
					T1.ALLOWREPAYRVW,
					T1.REPAYRVWFRQ,
					T1.NEXTREPAYRVWDATE,
					T1.ALLOWREPAYCPZ,
					T1.REPAYCPZFRQ,
					T1.NEXTREPAYCPZDATE,
					T1.MATURITYDATE,
					T1.CPZATGRACEEND,
					T1.DOWNPAYMENT,
					T1.GRACEFLATAMOUNT,
					T1.REQREPAYAMOUNT,
					T1.TOTALPROFIT,
					T1.TOTALCPZ,
					T1.TOTALGROSSPFT,
					T1.TOTALGRACEPFT,
					T1.TOTALGRACECPZ,
					T1.GRCRATEBASIS,
					T1.REPAYRATEBASIS,
					T1.FINTYPE,
					T1.FINREMARKS,
					T1.FINCCY,
					T1.SCHEDULEMETHOD,
					T1.PROFITDAYSBASIS,
					T1.REQMATURITY,
					T1.CALTERMS,
					T1.CALMATURITY,
					T1.FIRSTREPAY,
					T1.LASTREPAY,
					T1.FINSTARTDATE,
					T1.FINAMOUNT,
					T1.FINREPAYMENTAMOUNT,
					T1.CUSTID,
					T1.DEFFERMENTS,
					T1.PLANDEFERCOUNT,
					T1.FINISACTIVE,
					T1.VERSION,
					T1.LASTMNTBY,
					T1.LASTMNTON,
					T1.RECORDSTATUS,
					T1.ROLECODE,
					T1.NEXTROLECODE,
					T1.TASKID,
					T1.NEXTTASKID,
					T1.RECORDTYPE,
					T1.WORKFLOWID,
					T15.CUSTCIF     LOVDESCCUSTCIF,
					T7.FINTYPEDESC  LOVDESCFINTYPENAME,
					T1.FINBRANCH,
					T1.FINSOURCEID,
					T1.ALLOWEDDEFRPYCHANGE,
					T1.AVAILEDDEFRPYCHANGE,
					T1.ALLOWEDDEFFRQCHANGE,
					T1.AVAILEDDEFFRQCHANGE,
					T7.FINMAXAMOUNT     LOVDESCFINMAXAMT,
					T7.FINMINAMOUNT     LOVDESCFINMINAMOUNT,
					T7.FINISALWDIFFERMENT  LOVDESCFINALWDEFERMENT,
					T1.MINDOWNPAYPERC,
					T7.FINISDWPAYREQUIRED  LOVDESCDWNPAYREQ,
					T1.RECALTYPE,
					T1.FINASSETVALUE,
					T7.FINMAXDIFFERMENT  LOVDESCFINMAXDIFFERMENT,
					T1.LASTREPAYDATE,
					T1.LASTREPAYPFTDATE,
					T1.LASTREPAYRVWDATE,
					T1.LASTREPAYCPZDATE,
					T1.DISBACCOUNTID,
					T1.REPAYACCOUNTID,
					T1.ALLOWGRCREPAY,
					T1.GRCSCHDMTHD,
					T1.REPAYMARGIN,
					T1.GRCMARGIN,
					T1.DEPRECIATIONFRQ,
					T1.FINCOMMITMENTREF,
					T1.FINCURRASSETVALUE,
					T1.FINCONTRACTDATE,
					T1.NEXTDEPDATE,
					T1.LASTDEPDATE,
					T1.FINACCOUNT,
					T1.FINCUSTPFTACCOUNT,
					T7.FINRVWRATEAPPLFOR,
					T1.TOTALREPAYAMT,
					T1.CLOSINGSTATUS,
					T1.FINAPPROVEDDATE,
					T1.FINREPAYPFTONFRQ,
					T1.ANUALIZEDPERCRATE,
					T1.EFFECTIVERATEOFRETURN,
					T1.DOWNPAYBANK,
					T1.DOWNPAYSUPL,
					T7.FINDIVISION  LOVDESCFINDIVISIONNAME,
					T1.GRACETERMS,
					T14.FACILITYTYPE,
					T15.CUSTSHRTNAME  LOVDESCCUSTSHRTNAME,
					T16.BRANCHDESC    LOVDESCFINBRANCHNAME,
					T1.TOTALGROSSGRCPFT,
					T1.GRCPROFITDAYSBASIS,
					T1.STEPFINANCE,
					T1.STEPTYPE,
					T1.STEPPOLICY,
					T1.ALWMANUALSTEPS,
					T1.NOOFSTEPS,
					T1.LINKEDFINREF,
					T7.PRODUCT  LOVDESCFINPRODUCT,
					T1.GRCMINRATE,
					T1.GRCMAXRATE,
					T1.RPYMINRATE,
					T1.RPYMAXRATE,
					T1.MANUALSCHEDULE,
					T1.TAKEOVERFINANCE,
					T1.GRCADVBASERATE,
					T1.GRCADVMARGIN,
					T1.GRCADVPFTRATE,
					T1.RPYADVBASERATE,
					T1.RPYADVMARGIN,
					T1.RPYADVPFTRATE,
					T1.SUPPLEMENTRENT,
					T1.INCREASEDCOST,
					T1.FEEACCOUNTID,
					T1.TDSAPPLICABLE,
					T1.INSURANCEAMT,
					T1.DEDUCTINSDISB,
					T1.ALWBPI,
					T1.BPITREATMENT,
					T1.PLANEMIHALW,
					T1.PLANEMIHMETHOD,
					T1.PLANEMIHMAXPERYEAR,
					T1.PLANEMIHMAX,
					T1.PLANEMIHLOCKPERIOD,
					T1.PLANEMICPZ,
					T1.CALROUNDINGMODE,
					T1.ALWMULTIDISB,
					T1.BPIAMOUNT,
					T1.DEDUCTFEEDISB,
					T1.FEECHARGEAMT,
					T1.RVWRATEAPPLFOR,
					T1.SCHCALONRVW,
					T1.PASTDUEPFTCALMTHD,
					T1.PASTDUEPFTMARGIN,
					T1.DROPPINGMETHOD,
					T1.RATECHGANYDAY,
					T1.FINCATEGORY,
					T1.PRODUCTCATEGORY,
					T1.ROUNDINGTARGET,
					T1.GRCMAXAMOUNT,
					T1.ADVANCEEMI,
					T1.ADVEMITERMS,
					T1.BPIPFTDAYSBASIS,
					T1.FIXEDTENORRATE,
					T1.FIXEDRATETENOR,
					T1.GRCADVTYPE,
					T1.GRCADVTERMS,
					T1.ADVTYPE,
					T1.ADVTERMS,
					T1.ADVSTAGE,
					T1.ALLOWDRAWINGPOWER,
					T1.ALLOWREVOLVING
					FROM WIFFINANCEMAIN T1
					LEFT JOIN WIFINDICATIVETERMDETAIL_TEMP T14 ON T14.FINREFERENCE = T1.FINREFERENCE
					LEFT JOIN CUSTOMERS T15 ON T15.CUSTID = T1.CUSTID
					JOIN RMTFINANCETYPES T7 ON T1.FINTYPE = T7.FINTYPE
					LEFT JOIN RMTBRANCHES T16 ON T1.FINBRANCH = T16.BRANCHCODE
					WHERE NOT (EXISTS (SELECT 1 FROM WIFFINANCEMAIN_TEMP WHERE WIFFINANCEMAIN_TEMP.FINREFERENCE = T1.FINREFERENCE ))
	</createView>
	</changeSet>

	<changeSet id="15_post" author="satyanarayana.g" dbms="postgresql">
		<sql>
			<![CDATA[
					select deps_restore_dependencies ('plf', 'wiffinancemain_view');
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="16_pre" author="satyanarayana.g" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'wiffinancemain_aview');
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="16" author="satyanarayana.g">
		<createView viewName="WIFFINANCEMAIN_AVIEW" replaceIfExists="true">
			SELECT T1.FINREFERENCE,
					T1.NUMBEROFTERMS,
					T1.GRCPERIODENDDATE,
					T1.ALLOWGRCPERIOD,
					T1.GRACEBASERATE,
					T1.GRACESPECIALRATE,
					T1.GRCPFTRATE,
					T1.GRCPFTFRQ,
					T1.NEXTGRCPFTDATE,
					T1.ALLOWGRCPFTRVW,
					T1.GRCPFTRVWFRQ,
					T1.NEXTGRCPFTRVWDATE,
					T1.ALLOWGRCCPZ,
					T1.GRCCPZFRQ,
					T1.NEXTGRCCPZDATE,
					T1.REPAYBASERATE,
					T1.REPAYSPECIALRATE,
					T1.REPAYPROFITRATE,
					T1.REPAYFRQ,
					T1.NEXTREPAYDATE,
					T1.REPAYPFTFRQ,
					T1.NEXTREPAYPFTDATE,
					T1.ALLOWREPAYRVW,
					T1.REPAYRVWFRQ,
					T1.NEXTREPAYRVWDATE,
					T1.ALLOWREPAYCPZ,
					T1.REPAYCPZFRQ,
					T1.NEXTREPAYCPZDATE,
					T1.MATURITYDATE,
					T1.CPZATGRACEEND,
					T1.DOWNPAYMENT,
					T1.GRACEFLATAMOUNT,
					T1.REQREPAYAMOUNT,
					T1.TOTALPROFIT,
					T1.TOTALCPZ,
					T1.TOTALGROSSPFT,
					T1.TOTALGRACEPFT,
					T1.TOTALGRACECPZ,
					T1.GRCRATEBASIS,
					T1.REPAYRATEBASIS,
					T1.FINTYPE,
					T1.FINREMARKS,
					T1.FINCCY,
					T1.SCHEDULEMETHOD,
					T1.PROFITDAYSBASIS,
					T1.REQMATURITY,
					T1.CALTERMS,
					T1.CALMATURITY,
					T1.FIRSTREPAY,
					T1.LASTREPAY,
					T1.FINSTARTDATE,
					T1.FINAMOUNT,
					T1.FINREPAYMENTAMOUNT,
					T1.CUSTID,
					T1.DEFFERMENTS,
					T1.PLANDEFERCOUNT,
					T1.FINISACTIVE,
					T1.VERSION,
					T1.LASTMNTBY,
					T1.LASTMNTON,
					T1.RECORDSTATUS,
					T1.ROLECODE,
					T1.NEXTROLECODE,
					T1.TASKID,
					T1.NEXTTASKID,
					T1.RECORDTYPE,
					T1.WORKFLOWID,
					T15.CUSTCIF   LOVDESCCUSTCIF,
					T7.FINTYPEDESC  LOVDESCFINTYPENAME,
					T1.FINBRANCH,
					T1.FINSOURCEID,
					T1.ALLOWEDDEFRPYCHANGE,
					T1.AVAILEDDEFRPYCHANGE,
					T1.ALLOWEDDEFFRQCHANGE,
					T1.AVAILEDDEFFRQCHANGE,
					T7.FINMAXAMOUNT        LOVDESCFINMAXAMT,
					T7.FINMINAMOUNT        LOVDESCFINMINAMOUNT,
					T7.FINISALWDIFFERMENT  LOVDESCFINALWDEFERMENT,
					T1.MINDOWNPAYPERC,
					T7.FINISDWPAYREQUIRED  LOVDESCDWNPAYREQ,
					T1.RECALTYPE,
					T1.FINASSETVALUE,
					T7.FINMAXDIFFERMENT  LOVDESCFINMAXDIFFERMENT,
					T1.LASTREPAYDATE,
					T1.LASTREPAYPFTDATE,
					T1.LASTREPAYRVWDATE,
					T1.LASTREPAYCPZDATE,
					T1.DISBACCOUNTID,
					T1.REPAYACCOUNTID,
					T1.ALLOWGRCREPAY,
					T1.GRCSCHDMTHD,
					T1.REPAYMARGIN,
					T1.GRCMARGIN,
					T1.DEPRECIATIONFRQ,
					T1.FINCOMMITMENTREF,
					T1.FINCURRASSETVALUE,
					T1.FINCONTRACTDATE,
					T1.NEXTDEPDATE,
					T1.LASTDEPDATE,
					T1.FINACCOUNT,
					T1.FINCUSTPFTACCOUNT,
					T7.FINRVWRATEAPPLFOR,
					T1.TOTALREPAYAMT,
					T1.CLOSINGSTATUS,
					T1.FINAPPROVEDDATE,
					T1.FINREPAYPFTONFRQ,
					T1.ANUALIZEDPERCRATE,
					T1.EFFECTIVERATEOFRETURN,
					T1.DOWNPAYBANK,
					T1.DOWNPAYSUPL,
					T7.FINDIVISION  LOVDESCFINDIVISIONNAME,
					T1.GRACETERMS,
					T14.FACILITYTYPE,
					T15.CUSTSHRTNAME  LOVDESCCUSTSHRTNAME,
					T16.BRANCHDESC    LOVDESCFINBRANCHNAME,
					T1.TOTALGROSSGRCPFT,
					T1.GRCPROFITDAYSBASIS,
					T1.STEPFINANCE,
					T1.STEPTYPE,
					T1.STEPPOLICY,
					T1.ALWMANUALSTEPS,
					T1.NOOFSTEPS,
					T1.LINKEDFINREF,
					T7.PRODUCT  LOVDESCFINPRODUCT,
					T1.GRCMINRATE,
					T1.GRCMAXRATE,
					T1.RPYMINRATE,
					T1.RPYMAXRATE,
					T1.MANUALSCHEDULE,
					T1.TAKEOVERFINANCE,
					T1.GRCADVBASERATE,
					T1.GRCADVMARGIN,
					T1.GRCADVPFTRATE,
					T1.RPYADVBASERATE,
					T1.RPYADVMARGIN,
					T1.RPYADVPFTRATE,
					T1.SUPPLEMENTRENT,
					T1.INCREASEDCOST,
					T1.FEEACCOUNTID,
					T1.TDSAPPLICABLE,
					T1.INSURANCEAMT,
					T1.DEDUCTINSDISB,
					T1.ALWBPI,
					T1.BPITREATMENT,
					T1.PLANEMIHALW,
					T1.PLANEMIHMETHOD,
					T1.PLANEMIHMAXPERYEAR,
					T1.PLANEMIHMAX,
					T1.PLANEMIHLOCKPERIOD,
					T1.PLANEMICPZ,
					T1.CALROUNDINGMODE,
					T1.ALWMULTIDISB,
					T1.BPIAMOUNT,
					T1.DEDUCTFEEDISB,
					T1.FEECHARGEAMT,
					T1.RVWRATEAPPLFOR,
					T1.SCHCALONRVW,
					T1.PASTDUEPFTCALMTHD,
					T1.PASTDUEPFTMARGIN,
					T1.DROPPINGMETHOD,
					T1.RATECHGANYDAY,
					T1.ROUNDINGTARGET,
					T1.GRCMAXAMOUNT,
					T1.ADVANCEEMI,
					T1.ADVEMITERMS,
					T1.BPIPFTDAYSBASIS AS BPIRATEBASIS,
					T1.GRCADVTYPE,
					T1.GRCADVTERMS,
					T1.ADVTYPE,
					T1.ADVTERMS,
					T1.ADVSTAGE,
					T1.ALLOWDRAWINGPOWER,
					T1.ALLOWREVOLVING
					FROM WIFFINANCEMAIN T1
					LEFT JOIN WIFINDICATIVETERMDETAIL_TEMP T14 ON T14.FINREFERENCE = T1.FINREFERENCE
					LEFT JOIN CUSTOMERS T15 ON T15.CUSTID = T1.CUSTID
					JOIN RMTFINANCETYPES T7 ON T1.FINTYPE = T7.FINTYPE
					LEFT JOIN RMTBRANCHES T16 ON T1.FINBRANCH = T16.BRANCHCODE
	</createView>
	</changeSet>

	<changeSet id="16_post" author="satyanarayana.g" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'wiffinancemain_aview');
			]]>
		</sql>
	</changeSet>
		
	<changeSet id="17" author="saikiran.v">
		<sql>
				<![CDATA[
					 update reportfilterfields set fielddbname='FINDIVISION' where reportid in (select reportid from reportconfiguration where menuitemcode='menu_Item_PutCallReport'
					 and fieldid=1); 
				]]>
		</sql>
 	</changeSet>
 	<changeSet id="18" author="saikiran.v">
		<sql>
				<![CDATA[
					INSERT INTO ErrorDetails VALUES('90498','EN','E','Early Settlement Already initiated','','Approved','','','','','',0,CURRENT_TIMESTAMP,1000,0);
				]]>
		</sql>
 	</changeSet>
	<changeSet id="19" author="saikiran.v">
		<sql>
				<![CDATA[
				  	DELETE from SMTparameters WHERE SYSPARMCODE='EXCLUDE_SUB_RECEIPT_MODE_VALUE';
					INSERT INTO SMTparameters  VALUES ('EXCLUDE_SUB_RECEIPT_MODE_VALUE', 'To exclude Sub Receipt Mode Values', 'String', '0', '', 1, 0, NULL, NULL,'To exclude Sub Receipt Mode Values From List', 1, 1000, CURRENT_TIMESTAMP,'Approved', '', '', '', '', '',0);
				]]>
		</sql>
 	</changeSet>

	<changeSet id="20" author="Durgaprasad G">
		<createTable tableName="IRRScheduleDetail">
			<column name="FinReference" type="varchar(20)">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="SchDate" type="datetime">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="ProfitCalc" type="decimal(18,0)" />
			<column name="PrincipalCalc" type="decimal(18,0)" />
			<column name="RepayAmount" type="decimal(18,0)" />
			<column name="ClosingBalance" type="decimal(18,0)" />
			<column name="GapInterst" type="decimal(18,0)" />
		</createTable>
	</changeSet>
	
	<changeSet id="21" author="Siva">
		<dropColumn tableName="BMTAEEVENTS" columnName="MANDATORY" />
		<dropColumn tableName="BMTAEEVENTS" columnName="ODAPPLICABLE" />
	</changeSet>

	<changeSet id="22" author="Siva">
		<createTable tableName="CategoryWiseEvents">
			<column name="AEEventCode" type="varchar2(8)">
				<constraints nullable="false" primaryKey="true" />
			</column>
			<column name="CategoryCode" type="char(1)">
				<constraints nullable="false" primaryKey="true" />
			</column>
			<column name="ACTIVE" type="NUMBER(1,0)">
				<constraints nullable="false" />
			</column>
			<column name="MANDATORY" type="NUMBER(1,0)">
				<constraints nullable="false" />
			</column>
			<column name="SeqOrder" type="NUMBER(2,0)">
				<constraints nullable="false" />
			</column>
		</createTable>
	</changeSet>

	<changeSet id="23" author="Siva">
		<createView viewName="CategoryWiseEvents_VIEW"
			replaceIfExists="true">
				SELECT            T1.AEEventCode, T1.CategoryCode  , T1.Active ,T1.Mandatory, T1.SeqOrder,T2.AEEventCodeDesc
				FROM        CategoryWiseEvents  T1 INNER JOIN 
				BMTAEEvents T2 ON T1.AEEventCode = T2.AEEventCode
	</createView>
	</changeSet>

	<changeSet id="24" author="Siva">
		<sql>
			INSERT INTO CategoryWiseEvents VALUES('ADDDBSF','F',1,0,1);
			INSERT INTO CategoryWiseEvents VALUES('ADDDBSN','F',1,1,2);
			INSERT INTO CategoryWiseEvents VALUES('ADDDBSP','F',1,1,3);
			INSERT INTO CategoryWiseEvents VALUES('AMZ','F',1,1,4);
			INSERT INTO CategoryWiseEvents VALUES('DEFRPY','F',1,1,5);
			INSERT INTO CategoryWiseEvents VALUES('DISBINS','F',1,1,6);
			INSERT INTO CategoryWiseEvents VALUES('EARLYPAY','F',1,1,7);
			INSERT INTO CategoryWiseEvents VALUES('EARLYSTL','F',1,1,8);
			INSERT INTO CategoryWiseEvents VALUES('EMIDAY','F',1,1,9);
			INSERT INTO CategoryWiseEvents VALUES('FEEPAY','F',1,1,10);
			INSERT INTO CategoryWiseEvents VALUES('INSTDATE','F',1,1,11);
			INSERT INTO CategoryWiseEvents VALUES('JVPOST','F',1,0,12);
			INSERT INTO CategoryWiseEvents VALUES('LATEPAY','F',1,1,13);
			INSERT INTO CategoryWiseEvents VALUES('MANFEE','F',1,1,14);
			INSERT INTO CategoryWiseEvents VALUES('PAYMTINS','F',1,1,15);
			INSERT INTO CategoryWiseEvents VALUES('RATCHG','F',1,1,16);
			INSERT INTO CategoryWiseEvents VALUES('REAGING','F',1,1,17);
			INSERT INTO CategoryWiseEvents VALUES('REPAY','F',1,1,18);
			INSERT INTO CategoryWiseEvents VALUES('SCDCHG','F',1,1,19);
			INSERT INTO CategoryWiseEvents VALUES('VASACRUL','F',1,1,20);
			INSERT INTO CategoryWiseEvents VALUES('VASFEE','F',1,1,21);
			INSERT INTO CategoryWiseEvents VALUES('WRITEOFF','F',1,1,22);

			INSERT INTO CategoryWiseEvents VALUES('ADDDBSF','O',1,0,1);
			INSERT INTO CategoryWiseEvents VALUES('ADDDBSN','O',1,1,2);
			INSERT INTO CategoryWiseEvents VALUES('ADDDBSP','O',1,1,3);
			INSERT INTO CategoryWiseEvents VALUES('AMZ','O',1,1,4);
			INSERT INTO CategoryWiseEvents VALUES('AMZPD','O',1,1,5);
			INSERT INTO CategoryWiseEvents VALUES('AMZSUSP','O',1,1,6);
			INSERT INTO CategoryWiseEvents VALUES('CANFIN','O',1,1,7);
			INSERT INTO CategoryWiseEvents VALUES('CMTDISB','O',1,1,8);
			INSERT INTO CategoryWiseEvents VALUES('JVPOST','O',1,0,9);
			INSERT INTO CategoryWiseEvents VALUES('LATEPAY','O',1,1,10);
			INSERT INTO CategoryWiseEvents VALUES('MANFEE','O',1,1,11);
			INSERT INTO CategoryWiseEvents VALUES('NORM_PD','O',1,1,12);
			INSERT INTO CategoryWiseEvents VALUES('NORM_PIS','O',1,1,13);
			INSERT INTO CategoryWiseEvents VALUES('PD_NORM','O',1,1,14);
			INSERT INTO CategoryWiseEvents VALUES('PD_PIS','O',1,1,15);
			INSERT INTO CategoryWiseEvents VALUES('PIS_NORM','O',1,1,16);
			INSERT INTO CategoryWiseEvents VALUES('PIS_PD','O',1,1,17);
			INSERT INTO CategoryWiseEvents VALUES('PROVSN','O',1,1,18);
			INSERT INTO CategoryWiseEvents VALUES('REPAY','O',1,1,19);
			INSERT INTO CategoryWiseEvents VALUES('WRITEBK','O',1,1,20);
			INSERT INTO CategoryWiseEvents VALUES('WRITEOFF','O',1,1,21);

			INSERT INTO CategoryWiseEvents VALUES('ADDDBSP','C',1,1,1);
			INSERT INTO CategoryWiseEvents VALUES('ADDDBSN','C',1,1,2);
			INSERT INTO CategoryWiseEvents VALUES('AMZ','C',1,1,3);
			INSERT INTO CategoryWiseEvents VALUES('AMZ_MON','C',1,1,4);
			INSERT INTO CategoryWiseEvents VALUES('COMPOUND','C',1,1,5);
			INSERT INTO CategoryWiseEvents VALUES('DISBINS','C',1,1,6);
			INSERT INTO CategoryWiseEvents VALUES('EARLYPAY','C',1,1,7);
			INSERT INTO CategoryWiseEvents VALUES('EARLYSTL','C',1,1,8);
			INSERT INTO CategoryWiseEvents VALUES('FEEPAY','C',1,1,9);
			INSERT INTO CategoryWiseEvents VALUES('LATEPAY','C',1,1,10);
			INSERT INTO CategoryWiseEvents VALUES('REPAY','C',1,0,11);
			INSERT INTO CategoryWiseEvents VALUES('STAGE','C',1,0,12);
			INSERT INTO CategoryWiseEvents VALUES('WRITEBK','C',1,1,13);
			INSERT INTO CategoryWiseEvents VALUES('WRITEOFF','C',1,1,14);

		</sql>
	</changeSet>
	
	<changeSet id="25" author="Siva">
		<sql>
		INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 0, 'menuItem_SolutionFactory_CDFinanceType','MENU',0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0; 
		INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='FINANCETYPE_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='menuItem_SolutionFactory_CDFinanceType'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
		INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='FINANCETYPE_APPROVER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='menuItem_SolutionFactory_CDFinanceType'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
		</sql>
	</changeSet>
	
	<changeSet id="26" author="Siva">
		<comment>New columns added for CD Schemes in Promotion</comment>
		<addColumn tableName="Promotions">
			<column name="ReferenceID" type="bigint" defaultValue="0" />
			<column name="OpenBalOnPV" type="boolean" defaultValue="0" />
			<column name="Tenor" type="int" defaultValue="0" />
			<column name="AdvEMITerms" type="int" defaultValue="0" />
			<column name="PftDaysBasis" type="varchar(8)" />
			<column name="SubventionMethod" type="varchar(8)" />
			<column name="SubventionRate" type="decimal(13,9)" defaultValue="0" />
			<column name="TaxApplicable" type="boolean" defaultValue="0" />
			<column name="CashbackMonth" type="int" defaultValue="0" />
			<column name="SchemeIRR" type="decimal(13,9)" defaultValue="0" />
		</addColumn>
		<addColumn tableName="Promotions_Temp">
			<column name="ReferenceID" type="bigint" defaultValue="0" />
			<column name="OpenBalOnPV" type="boolean" defaultValue="0" />
			<column name="Tenor" type="int" defaultValue="0" />
			<column name="AdvEMITerms" type="int" defaultValue="0" />
			<column name="PftDaysBasis" type="varchar(8)" />
			<column name="SubventionMethod" type="varchar(8)" />
			<column name="SubventionRate" type="decimal(13,9)" defaultValue="0" />
			<column name="TaxApplicable" type="boolean" defaultValue="0" />
			<column name="CashbackMonth" type="int" defaultValue="0" />
			<column name="SchemeIRR" type="decimal(13,9)" defaultValue="0" />
		</addColumn>
	</changeSet>
	<changeSet id="26.1" author="Siva">
		<comment>New columns added for CD Schemes in Promotion</comment>
		<addColumn tableName="Promotions">
			<column name="ProductCategory" type="varchar(8)" />
		</addColumn>
		<addColumn tableName="Promotions_Temp">
			<column name="ProductCategory" type="varchar(8)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="27.1" author="Siva">
		<createView viewName="Promotions_AView" replaceIfExists="true">
			SELECT t1.promotionid,
			    t1.promotioncode,
			    t1.promotiondesc,
			    t1.fintype,
			    t1.startdate,
			    t1.enddate,
			    t1.finisdwpayrequired,
			    t1.downpayrule,
			    t1.actualinterestrate,
			    t1.finbaserate,
			    t1.finsplrate,
			    t1.finmargin,
			    t1.applyrpypricing,
			    t1.rpypricingmethod,
			    t1.finminterm,
			    t1.finmaxterm,
			    t1.finminamount,
			    t1.finmaxamount,
			    t1.finminrate,
			    t1.finmaxrate,
			    t1.active,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.finccy,
			    t2.fincategory,
			    t2.fintypedesc,
			    t3.rulecode AS downpayrulecode,
			    t3.rulecodedesc AS downpayruledesc,
			    t4.rulecode AS rpypricingcode,
			    t4.rulecodedesc AS rpypricingdesc,
			    t1.ReferenceID, t1.OpenBalOnPV, t1.Tenor, t1.AdvEMITerms, t1.PftDaysBasis, t1.SubventionMethod, t1.SubventionRate,
			    t1.TaxApplicable, t1.CashbackMonth, t1.SchemeIRR,t1.ProductCategory
			   FROM promotions t1
			     JOIN rmtfinancetypes t2 ON t1.fintype = t2.fintype
			     LEFT JOIN rules t3 ON t1.downpayrule = t3.ruleid
			     LEFT JOIN rules t4 ON t1.rpypricingmethod = t4.ruleid
		</createView>
	</changeSet> 
	
	<changeSet id="28.1" author="Siva">
		<createView viewName="Promotions_TView" replaceIfExists="true">
			SELECT t1.promotionid,
			    t1.promotioncode,
			    t1.promotiondesc,
			    t1.fintype,
			    t1.startdate,
			    t1.enddate,
			    t1.finisdwpayrequired,
			    t1.downpayrule,
			    t1.actualinterestrate,
			    t1.finbaserate,
			    t1.finsplrate,
			    t1.finmargin,
			    t1.applyrpypricing,
			    t1.rpypricingmethod,
			    t1.finminterm,
			    t1.finmaxterm,
			    t1.finminamount,
			    t1.finmaxamount,
			    t1.finminrate,
			    t1.finmaxrate,
			    t1.active,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.finccy,
			    t2.fincategory,
			    t2.fintypedesc,
			    t3.rulecode AS downpayrulecode,
			    t3.rulecodedesc AS downpayruledesc,
			    t4.rulecode AS rpypricingcode,
			    t4.rulecodedesc AS rpypricingdesc,
			    t1.ReferenceID, t1.OpenBalOnPV, t1.Tenor, t1.AdvEMITerms, t1.PftDaysBasis, t1.SubventionMethod, t1.SubventionRate,
			    t1.TaxApplicable, t1.CashbackMonth, t1.SchemeIRR,t1.ProductCategory
			   FROM promotions_temp t1
			     JOIN rmtfinancetypes t2 ON t1.fintype = t2.fintype
			     LEFT JOIN rules t3 ON t1.downpayrule = t3.ruleid
			     LEFT JOIN rules t4 ON t1.rpypricingmethod = t4.ruleid
		</createView>
	</changeSet> 
	
	<changeSet id="29.1" author="Siva">
		<createView viewName="Promotions_View" replaceIfExists="true">
			SELECT t1.promotionid,
			    t1.promotioncode,
			    t1.promotiondesc,
			    t1.fintype,
			    t1.startdate,
			    t1.enddate,
			    t1.finisdwpayrequired,
			    t1.downpayrule,
			    t1.actualinterestrate,
			    t1.finbaserate,
			    t1.finsplrate,
			    t1.finmargin,
			    t1.applyrpypricing,
			    t1.rpypricingmethod,
			    t1.finminterm,
			    t1.finmaxterm,
			    t1.finminamount,
			    t1.finmaxamount,
			    t1.finminrate,
			    t1.finmaxrate,
			    t1.active,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.finccy,
			    t2.fincategory,
			    t2.fintypedesc,
			    t3.rulecode AS downpayrulecode,
			    t3.rulecodedesc AS downpayruledesc,
			    t4.rulecode AS rpypricingcode,
			    t4.rulecodedesc AS rpypricingdesc,
			    t1.ReferenceID, t1.OpenBalOnPV, t1.Tenor, t1.AdvEMITerms, t1.PftDaysBasis, t1.SubventionMethod, t1.SubventionRate,
			    t1.TaxApplicable, t1.CashbackMonth, t1.SchemeIRR,t1.ProductCategory
			   FROM promotions_temp t1
			     JOIN rmtfinancetypes t2 ON t1.fintype = t2.fintype
			     LEFT JOIN rules t3 ON t1.downpayrule = t3.ruleid
			     LEFT JOIN rules t4 ON t1.rpypricingmethod = t4.ruleid
			UNION ALL
			 SELECT t1.promotionid,
			    t1.promotioncode,
			    t1.promotiondesc,
			    t1.fintype,
			    t1.startdate,
			    t1.enddate,
			    t1.finisdwpayrequired,
			    t1.downpayrule,
			    t1.actualinterestrate,
			    t1.finbaserate,
			    t1.finsplrate,
			    t1.finmargin,
			    t1.applyrpypricing,
			    t1.rpypricingmethod,
			    t1.finminterm,
			    t1.finmaxterm,
			    t1.finminamount,
			    t1.finmaxamount,
			    t1.finminrate,
			    t1.finmaxrate,
			    t1.active,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.finccy,
			    t2.fincategory,
			    t2.fintypedesc,
			    t3.rulecode AS downpayrulecode,
			    t3.rulecodedesc AS downpayruledesc,
			    t4.rulecode AS rpypricingcode,
			    t4.rulecodedesc AS rpypricingdesc,
			    t1.ReferenceID, t1.OpenBalOnPV, t1.Tenor, t1.AdvEMITerms, t1.PftDaysBasis, t1.SubventionMethod, t1.SubventionRate,
			    t1.TaxApplicable, t1.CashbackMonth, t1.SchemeIRR,t1.ProductCategory
			   FROM promotions t1
			     JOIN rmtfinancetypes t2 ON t1.fintype = t2.fintype
			     LEFT JOIN rules t3 ON t1.downpayrule = t3.ruleid
			     LEFT JOIN rules t4 ON t1.rpypricingmethod = t4.ruleid
			  WHERE NOT (EXISTS ( SELECT 1
			           FROM promotions_temp
			          WHERE promotions_temp.promotioncode = t1.promotioncode AND promotions_temp.promotionid = t1.promotionid))
		</createView>
	</changeSet> 
	
	<changeSet id="30" author="Siva">
		<addColumn tableName="FinTypeFees">
			<column name="ReferenceId" type="bigint" defaultValue="0"/>
		</addColumn>
		<addColumn tableName="FinTypeFees_Temp">
			<column name="ReferenceId" type="bigint" defaultValue="0"/>
		</addColumn>
	</changeSet>
		
	<changeSet id="31" author="Siva">
		<createView viewName="FinTypeFees_AView" replaceIfExists="true">
			 SELECT t1.fintype,
			    t1.originationfee,
			    t1.finevent,
			    t1.feetypeid,
			    t1.feeorder,
			    t1.feeschedulemethod,
			    t1.calculationtype,
			    t1.rulecode,
			    t1.amount,
			    t1.percentage,
			    t1.calculateon,
			    t1.alwdeviation,
			    t1.maxwaiverperc,
			    t1.alwmodifyfee,
			    t1.alwmodifyfeeschdmthd,
			    t1.active,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t1.moduleid,
			    t1.alwpreincomization,
			    t2.feetypecode,
			    t2.feetypedesc,
			    t2.taxapplicable,
			    t2.taxcomponent,
			    t3.rulecodedesc AS ruledesc,
				t1.ReferenceId
			   FROM fintypefees t1
			     JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
			     LEFT JOIN rules t3 ON t1.rulecode = t3.rulecode AND t3.rulemodule= 'FEES' AND t1.finevent= t3.ruleevent
		</createView>
	</changeSet> 
	<changeSet id="32" author="Siva">
		<createView viewName="FinTypeFees_View" replaceIfExists="true">
			SELECT t1.fintype,
			    t1.originationfee,
			    t1.finevent,
			    t1.feetypeid,
			    t1.feeorder,
			    t1.feeschedulemethod,
			    t1.calculationtype,
			    t1.rulecode,
			    t1.amount,
			    t1.percentage,
			    t1.calculateon,
			    t1.alwdeviation,
			    t1.maxwaiverperc,
			    t1.alwmodifyfee,
			    t1.alwmodifyfeeschdmthd,
			    t1.active,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t1.moduleid,
			    t1.alwpreincomization,
			    t2.feetypecode,
			    t2.feetypedesc,
			    t2.taxapplicable,
			    t2.taxcomponent,
			    t3.rulecodedesc AS ruledesc,
				t1.ReferenceId
			   FROM fintypefees_temp t1
			     JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
			     LEFT JOIN rules t3 ON t1.rulecode= t3.rulecode AND t3.rulemodule= 'FEES' AND t1.finevent= t3.ruleevent
			UNION ALL
			 SELECT t1.fintype,
			    t1.originationfee,
			    t1.finevent,
			    t1.feetypeid,
			    t1.feeorder,
			    t1.feeschedulemethod,
			    t1.calculationtype,
			    t1.rulecode,
			    t1.amount,
			    t1.percentage,
			    t1.calculateon,
			    t1.alwdeviation,
			    t1.maxwaiverperc,
			    t1.alwmodifyfee,
			    t1.alwmodifyfeeschdmthd,
			    t1.active,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t1.moduleid,
			    t1.alwpreincomization,
			    t2.feetypecode,
			    t2.feetypedesc,
			    t2.taxapplicable,
			    t2.taxcomponent,
			    t3.rulecodedesc AS ruledesc,
				t1.ReferenceId
			   FROM fintypefees t1
			     JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
			     LEFT JOIN rules t3 ON t1.rulecode= t3.rulecode AND t3.rulemodule= 'FEES' AND t1.finevent= t3.ruleevent
			  WHERE NOT (EXISTS ( SELECT 1
			           FROM fintypefees_temp F
			          WHERE F.fintype= t1.fintype AND F.finevent= t1.finevent AND F.feetypeid = t1.feetypeid AND F.originationfee = t1.originationfee))
		</createView>
	</changeSet> 
	
	<changeSet id="33" author="Siva">
		<createSequence sequenceName="SeqPromotionScheme" incrementBy="1" startValue="1" minValue="1" maxValue="999999999999999999"/>
	</changeSet>
	
	<changeSet id="34" author="Siva">
		<sql>
					
			UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
			UPDATE SEQSECGROUPS SET SEQNO= (SELECT MAX(GRPID) FROM SECGROUPS);
			UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS); 
			UPDATE SEQSECROLEGROUPS SET SEQNO= (SELECT MAX(ROLEGRPID) FROM SECROLEGROUPS);

			INSERT INTO SECGROUPS SELECT (SELECT MAX(GRPID)+1 FROM SECGROUPS), 'CDSCHEME_MAKER', 'WF Maker for CD Scheme Maker', 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECGROUPS WHERE 0=0;
			INSERT INTO SECGROUPS SELECT (SELECT MAX(GRPID)+1 FROM SECGROUPS), 'CDSCHEME_APPROVER', 'WF Approver for CD Scheme Maker', 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECGROUPS WHERE 0=0;
			
			INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 0, 'menuItem_SolutionFactory_CDScheme','MENU',0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0; 
			INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'PromotionDialog_Tenor','PromotionDialog',0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0; 
			INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'PromotionDialog_AdvEMITerms','PromotionDialog',0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0; 
			INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'PromotionDialog_CashbackMonth','PromotionDialog',0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0; 
			INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'PromotionDialog_SubventionMethod','PromotionDialog',0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0; 
			INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'PromotionDialog_PftDaysBasis','PromotionDialog',0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0; 
			INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'PromotionDialog_SubventionRate','PromotionDialog',0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0; 
			INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'PromotionDialog_SchemeIRR','PromotionDialog',0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0; 
			INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 3, 'PromotionDialog_TaxApplicable','PromotionDialog',0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0; 
			
			
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CDSCHEME_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='PromotionDialog_PromotionCode'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CDSCHEME_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='PromotionDialog_PromotionDesc'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CDSCHEME_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='PromotionDialog_StartDate'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CDSCHEME_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='PromotionDialog_EndDate'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CDSCHEME_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='PromotionDialog_ActualInterestRate'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CDSCHEME_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='PromotionDialog_Tenor'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CDSCHEME_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='PromotionDialog_AdvEMITerms'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CDSCHEME_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='PromotionDialog_CashbackMonth'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CDSCHEME_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='PromotionDialog_SubventionMethod'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CDSCHEME_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='PromotionDialog_PftDaysBasis'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CDSCHEME_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='PromotionDialog_SubventionRate'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CDSCHEME_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='PromotionDialog_SchemeIRR'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CDSCHEME_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='PromotionDialog_TaxApplicable'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CDSCHEME_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='PromotionDialog_Active'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CDSCHEME_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='menuItem_SolutionFactory_CDScheme'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CDSCHEME_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='button_PromotionDialog_btnSave'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
			
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CDSCHEME_APPROVER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='menuItem_SolutionFactory_CDScheme'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CDSCHEME_APPROVER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='button_PromotionDialog_btnSave'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
					
			INSERT INTO SecRoleGroups values((Select MAX(RoleGrpID)+1 From SecRoleGroups),(Select GrpId  From SecGroups Where GrpCode='CDSCHEME_MAKER'), (Select  RoleID  From SecRoles Where RoleCd='MSTGRP1_MAKER'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0); 
			INSERT INTO SecRoleGroups values((Select MAX(RoleGrpID)+1 From SecRoleGroups),(Select GrpId  From SecGroups Where GrpCode='CDSCHEME_APPROVER'), (Select  RoleID  From SecRoles Where RoleCd='MSTGRP1_APPROVER'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0); 
					
			UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
			UPDATE SEQSECGROUPS SET SEQNO= (SELECT MAX(GRPID) FROM SECGROUPS);
			UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS); 
			UPDATE SEQSECROLEGROUPS SET SEQNO= (SELECT MAX(ROLEGRPID) FROM SECROLEGROUPS);
			
		</sql>
	</changeSet>
	
	<changeSet id="35" author="Siva">
		<comment>New columns added for CD Schemes in Promotion</comment>
		<addColumn tableName="Promotions">
			<column name="cashBackFromDealer" type="int" defaultValue="0" />
			<column name="cashBackToCustomer" type="int" defaultValue="0" />
		</addColumn>
		<addColumn tableName="Promotions_Temp">
			<column name="cashBackFromDealer" type="int" defaultValue="0" />
			<column name="cashBackToCustomer" type="int" defaultValue="0" />
		</addColumn>
	</changeSet>
	
	<changeSet id="36" author="Siva">
		<createView viewName="Promotions_AView" replaceIfExists="true">
			SELECT t1.promotionid,
			    t1.promotioncode,
			    t1.promotiondesc,
			    t1.fintype,
			    t1.startdate,
			    t1.enddate,
			    t1.finisdwpayrequired,
			    t1.downpayrule,
			    t1.actualinterestrate,
			    t1.finbaserate,
			    t1.finsplrate,
			    t1.finmargin,
			    t1.applyrpypricing,
			    t1.rpypricingmethod,
			    t1.finminterm,
			    t1.finmaxterm,
			    t1.finminamount,
			    t1.finmaxamount,
			    t1.finminrate,
			    t1.finmaxrate,
			    t1.active,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.finccy,
			    t2.fincategory,
			    t2.fintypedesc,
			    t3.rulecode AS downpayrulecode,
			    t3.rulecodedesc AS downpayruledesc,
			    t4.rulecode AS rpypricingcode,
			    t4.rulecodedesc AS rpypricingdesc,
			    t1.ReferenceID, t1.OpenBalOnPV, t1.Tenor, t1.AdvEMITerms, t1.PftDaysBasis, t1.SubventionRate,
			    t1.TaxApplicable, t1.cashBackFromDealer, t1.cashBackToCustomer, t2.ProductCategory
			   FROM promotions t1
			     JOIN rmtfinancetypes t2 ON t1.fintype = t2.fintype
			     LEFT JOIN rules t3 ON t1.downpayrule = t3.ruleid
			     LEFT JOIN rules t4 ON t1.rpypricingmethod = t4.ruleid
		</createView>
	</changeSet> 
	
	<changeSet id="37" author="Siva">
		<createView viewName="Promotions_TView" replaceIfExists="true">
			SELECT t1.promotionid,
			    t1.promotioncode,
			    t1.promotiondesc,
			    t1.fintype,
			    t1.startdate,
			    t1.enddate,
			    t1.finisdwpayrequired,
			    t1.downpayrule,
			    t1.actualinterestrate,
			    t1.finbaserate,
			    t1.finsplrate,
			    t1.finmargin,
			    t1.applyrpypricing,
			    t1.rpypricingmethod,
			    t1.finminterm,
			    t1.finmaxterm,
			    t1.finminamount,
			    t1.finmaxamount,
			    t1.finminrate,
			    t1.finmaxrate,
			    t1.active,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.finccy,
			    t2.fincategory,
			    t2.fintypedesc,
			    t3.rulecode AS downpayrulecode,
			    t3.rulecodedesc AS downpayruledesc,
			    t4.rulecode AS rpypricingcode,
			    t4.rulecodedesc AS rpypricingdesc,
			    t1.ReferenceID, t1.OpenBalOnPV, t1.Tenor, t1.AdvEMITerms, t1.PftDaysBasis, t1.SubventionRate,
			    t1.TaxApplicable, t1.cashBackFromDealer, t1.cashBackToCustomer, t2.ProductCategory
			   FROM promotions_temp t1
			     JOIN rmtfinancetypes t2 ON t1.fintype = t2.fintype
			     LEFT JOIN rules t3 ON t1.downpayrule = t3.ruleid
			     LEFT JOIN rules t4 ON t1.rpypricingmethod = t4.ruleid
		</createView>
	</changeSet> 
	
	<changeSet id="38" author="Siva">
		<createView viewName="Promotions_View" replaceIfExists="true">
			SELECT t1.promotionid,
			    t1.promotioncode,
			    t1.promotiondesc,
			    t1.fintype,
			    t1.startdate,
			    t1.enddate,
			    t1.finisdwpayrequired,
			    t1.downpayrule,
			    t1.actualinterestrate,
			    t1.finbaserate,
			    t1.finsplrate,
			    t1.finmargin,
			    t1.applyrpypricing,
			    t1.rpypricingmethod,
			    t1.finminterm,
			    t1.finmaxterm,
			    t1.finminamount,
			    t1.finmaxamount,
			    t1.finminrate,
			    t1.finmaxrate,
			    t1.active,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.finccy,
			    t2.fincategory,
			    t2.fintypedesc,
			    t3.rulecode AS downpayrulecode,
			    t3.rulecodedesc AS downpayruledesc,
			    t4.rulecode AS rpypricingcode,
			    t4.rulecodedesc AS rpypricingdesc,
			    t1.ReferenceID, t1.OpenBalOnPV, t1.Tenor, t1.AdvEMITerms, t1.PftDaysBasis, t1.SubventionRate,
			    t1.TaxApplicable, t1.cashBackFromDealer, t1.cashBackToCustomer, t2.ProductCategory
			   FROM promotions_temp t1
			     JOIN rmtfinancetypes t2 ON t1.fintype = t2.fintype
			     LEFT JOIN rules t3 ON t1.downpayrule = t3.ruleid
			     LEFT JOIN rules t4 ON t1.rpypricingmethod = t4.ruleid
			UNION ALL
			 SELECT t1.promotionid,
			    t1.promotioncode,
			    t1.promotiondesc,
			    t1.fintype,
			    t1.startdate,
			    t1.enddate,
			    t1.finisdwpayrequired,
			    t1.downpayrule,
			    t1.actualinterestrate,
			    t1.finbaserate,
			    t1.finsplrate,
			    t1.finmargin,
			    t1.applyrpypricing,
			    t1.rpypricingmethod,
			    t1.finminterm,
			    t1.finmaxterm,
			    t1.finminamount,
			    t1.finmaxamount,
			    t1.finminrate,
			    t1.finmaxrate,
			    t1.active,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.finccy,
			    t2.fincategory,
			    t2.fintypedesc,
			    t3.rulecode AS downpayrulecode,
			    t3.rulecodedesc AS downpayruledesc,
			    t4.rulecode AS rpypricingcode,
			    t4.rulecodedesc AS rpypricingdesc,
			    t1.ReferenceID, t1.OpenBalOnPV, t1.Tenor, t1.AdvEMITerms, t1.PftDaysBasis, t1.SubventionRate,
			    t1.TaxApplicable, t1.cashBackFromDealer, t1.cashBackToCustomer, t2.ProductCategory
			   FROM promotions t1
			     JOIN rmtfinancetypes t2 ON t1.fintype = t2.fintype
			     LEFT JOIN rules t3 ON t1.downpayrule = t3.ruleid
			     LEFT JOIN rules t4 ON t1.rpypricingmethod = t4.ruleid
			  WHERE NOT (EXISTS ( SELECT 1
			           FROM promotions_temp
			          WHERE promotions_temp.promotioncode = t1.promotioncode AND promotions_temp.promotionid = t1.promotionid))
		</createView>
	</changeSet> 
	
	<changeSet id="39" author="Siva">
		<dropColumn tableName="Promotions" columnName="SubventionMethod" />
		<dropColumn tableName="Promotions" columnName="CashbackMonth" />
		<dropColumn tableName="Promotions" columnName="SchemeIRR" />
		<dropColumn tableName="Promotions" columnName="ProductCategory" />
		
		<dropColumn tableName="Promotions_Temp" columnName="SubventionMethod" />
		<dropColumn tableName="Promotions_Temp" columnName="CashbackMonth" />
		<dropColumn tableName="Promotions_Temp" columnName="SchemeIRR" />
		<dropColumn tableName="Promotions_Temp" columnName="ProductCategory" />
	</changeSet>
	
	<changeSet id="40" author="satyanarayana.g">
		<sql>
			<![CDATA[
				UPDATE FINANCEMAIN Set PromotionSeqID = 0  where PromotionSeqID is null;
				UPDATE FINANCEMAIN_TEMP Set PromotionSeqID = 0 where PromotionSeqID is null;
				UPDATE FINANCEMAIN_PA Set PromotionSeqID = 0 where PromotionSeqID is null;
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="41" author="satyanarayana.g">
		<addColumn tableName="REJECTFINANCEMAIN">
			<column name="PromotionSeqID" type="bigint" defaultValue="0"/>
		</addColumn>
	</changeSet>

	<changeSet id="42" author="satyanarayana.g">
		<sql>
			<![CDATA[
				UPDATE REJECTFINANCEMAIN Set PromotionSeqID = 0  where PromotionSeqID is null;
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="43_pre" author="satyanarayana.g" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'rejectfinancemain_view');
			]]>
		</sql>
	</changeSet>

	<changeSet id="44" author="satyanarayana.g">
		<createView viewName="REJECTFINANCEMAIN_VIEW" replaceIfExists="true">
			SELECT F.FINREFERENCE,
					T.FINCATEGORY  LOVDESCPRODUCTCODENAME,
					F.FINTYPE,
					F.FINBRANCH,
					F.FINSTARTDATE,
					F.MATURITYDATE,
					F.NUMBEROFTERMS,
					F.FINCCY,
					F.FINAMOUNT,
					F.FINAMOUNT - F.DOWNPAYMENT + F.FEECHARGEAMT + F.INSURANCEAMT  FINANCINGAMOUNT,
					F.FEECHARGEAMT,
					F.INSURANCEAMT,
					F.FINAMOUNT - F.DOWNPAYMENT + F.FEECHARGEAMT + F.INSURANCEAMT - F.FINREPAYMENTAMOUNT  CURFINAMOUNT,
					F.DOWNPAYMENT,
					F.FINCURRASSETVALUE,
					F.FINASSETVALUE,
					F.ALLOWDRAWINGPOWER,
					F.PROMOTIONSEQID,
					C.CUSTCIF  LOVDESCCUSTCIF
					FROM REJECTFINANCEMAIN F
					LEFT JOIN CUSTOMERS C ON F.CUSTID = C.CUSTID
					LEFT JOIN RMTFINANCETYPES T ON F.FINTYPE = T.FINTYPE
	</createView>
	</changeSet>

	<changeSet id="44_post" author="satyanarayana.g" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'rejectfinancemain_view');
			]]>
		</sql>
	</changeSet>
	
	 <changeSet id="45" author="satyanarayana.g">
		<addColumn tableName="REJECTFINANCEMAIN">
			<column name="SanBsdSchdle" type="boolean" defaultValue="0"/>
		</addColumn>
	</changeSet>
	
	<changeSet id="46" author="satyanarayana.g">
		<sql>
			<![CDATA[
				UPDATE REJECTFINANCEMAIN Set SanBsdSchdle = 0  where SanBsdSchdle is null;
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="47_pre" author="satyanarayana.g" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'rejectfinancemain_view');
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="47" author="satyanarayana.g">
		<createView viewName="REJECTFINANCEMAIN_VIEW" replaceIfExists="true">
			SELECT F.FINREFERENCE,
					T.FINCATEGORY  LOVDESCPRODUCTCODENAME,
					F.FINTYPE,
					F.FINBRANCH,
					F.FINSTARTDATE,
					F.MATURITYDATE,
					F.NUMBEROFTERMS,
					F.FINCCY,
					F.FINAMOUNT,
					F.FINAMOUNT - F.DOWNPAYMENT + F.FEECHARGEAMT + F.INSURANCEAMT  FINANCINGAMOUNT,
					F.FEECHARGEAMT,
					F.INSURANCEAMT,
					F.FINAMOUNT - F.DOWNPAYMENT + F.FEECHARGEAMT + F.INSURANCEAMT - F.FINREPAYMENTAMOUNT  CURFINAMOUNT,
					F.DOWNPAYMENT,
					F.FINCURRASSETVALUE,
					F.FINASSETVALUE,
					F.ALLOWDRAWINGPOWER,
					F.PROMOTIONSEQID,
					F.SANBSDSCHDLE,
					C.CUSTCIF  LOVDESCCUSTCIF
					FROM REJECTFINANCEMAIN F
					LEFT JOIN CUSTOMERS C ON F.CUSTID = C.CUSTID
					LEFT JOIN RMTFINANCETYPES T ON F.FINTYPE = T.FINTYPE
	</createView>
	</changeSet>
	
	<changeSet id="47_post" author="satyanarayana.g" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'rejectfinancemain_view');
			]]>
		</sql>
	</changeSet>
	
	
	<changeSet id="48" author="Pruthvi">
		<sql>
		<![CDATA[
			delete from bmtintratebasiscodes where intratebasiscode='P/360';
			INSERT INTO bmtintratebasiscodes(
			intratebasiscode, intratebasisdesc, intratebasisisactive, version, lastmntby, lastmnton, recordstatus, rolecode, nextrolecode, taskid, nexttaskid, recordtype, workflowid)
			VALUES ('P/360', 'Periodicity (30D Periods )', 1, 0, 1000, current_timestamp, 'Approved', null, null, null, null, null, 0)
		]]>
		</sql>
	</changeSet>
	
	<changeSet id="49" author="Pruthvi" dbms="postgresql">
		<sql>
			<![CDATA[
	
				INSERT INTO promotions VALUES ((select max(promotionid)+1 from promotions), 'ECOMDD', 'ECOM Discounting', 'PTL', '2019-01-01 00:00:00', '2029-12-31 00:00:00', 0, 0,21.00, null, null, 0.00, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1000, current_timestamp, 'Approved', null, null, null, null, null, 0,
				1001, 1, 15, 4, 'P/360', 21.00, 1, 0, 0);
			 
				INSERT INTO promotions VALUES ((select max(promotionid)+1 from promotions), 'OFFLD', 'OFF-Line Discounting', 'PTL', '2019-01-01 00:00:00', '2029-12-31 00:00:00', 0, 0,
				21.00, null, null, 0.00, 0, 0, 0, 0,
				0, 0, 0, 0, 1, 1, 1000, current_timestamp, 'Approved', null, null, null, null, null, 0,
				1002, 1, 15, 4, 'P/360', 21.00, 1, 0, 0);

				INSERT INTO promotions VALUES ((select max(promotionid)+1 from promotions), 'OFFLXRC', 'OFF-Line Transfer to Customer', 'PTL', '2019-01-01 00:00:00', '2029-12-31 00:00:00', 0, 0,
				21.00, null, null, 0.00, 0, 0, 0, 0,
				0, 0, 0, 0, 1, 1, 1000, current_timestamp, 'Approved', null, null, null, null, null, 0,
				1003, 0, 15, 4, 'P/360', 11.31, 1, 0, 0);

				INSERT INTO promotions VALUES ((select max(promotionid)+1 from promotions), 'OFFLRTN', 'OFF-Line Subvention Retained', 'PTL', '2019-01-01 00:00:00', '2029-12-31 00:00:00', 0, 0,
				21.00, null, null, 0.00, 0, 0, 0, 0,
				0, 0, 0, 0, 1, 1, 1000, current_timestamp, 'Approved', null, null, null, null, null, 0,
				1004, 0, 15, 4, 'P/360', 21.00, 1, 3, 3);
			]]>
		</sql>
	</changeSet>

	<changeSet id="49" author="Pruthvi" dbms="mssql,oracle">
		<sql>
		<![CDATA[
			INSERT INTO promotions VALUES ((select coalesce(max(promotionid),0 + 1) from promotions), 'ECOMDD', 'ECOM Discounting', 'PTL', '2019-01-01 00:00:00', '2029-12-31 00:00:00', 0, 0,
	   		21.00, null, null, 0.00, 0, 0, 0, 0,0, 0, 0, 0, 1, 1, 1000, current_timestamp, 'Approved', null, null, null, null, null, 0,1001, 1, 15, 4, 'P/360', 21.00, 1, 0, 0);

			INSERT INTO promotions VALUES ((select max(promotionid)+1 from promotions), 'OFFLD', 'OFF-Line Discounting', 'PTL', '2019-01-01 00:00:00', '2029-12-31 00:00:00', 0, 0,
			21.00, null, null, 0.00, 0, 0, 0, 0,
			0, 0, 0, 0, 1, 1, 1000, current_timestamp, 'Approved', null, null, null, null, null, 0,
			1002, 1, 15, 4, 'P/360', 21.00, 1, 0, 0);

			INSERT INTO promotions VALUES ((select max(promotionid)+1 from promotions), 'OFFLXRC', 'OFF-Line Transfer to Customer', 'PTL', '2019-01-01 00:00:00', '2029-12-31 00:00:00', 0, 0,
			21.00, null, null, 0.00, 0, 0, 0, 0,
			0, 0, 0, 0, 1, 1, 1000, current_timestamp, 'Approved', null, null, null, null, null, 0,
			1003, 0, 15, 4, 'P/360', 11.31, 1, 0, 0);

			INSERT INTO promotions VALUES ((select max(promotionid)+1 from promotions), 'OFFLRTN', 'OFF-Line Subvention Retained', 'PTL', '2019-01-01 00:00:00', '2029-12-31 00:00:00', 0, 0,
			21.00, null, null, 0.00, 0, 0, 0, 0,
			0, 0, 0, 0, 1, 1, 1000, current_timestamp, 'Approved', null, null, null, null, null, 0,
			1004, 0, 15, 4, 'P/360', 21.00, 1, 3, 3);
			]]>
		</sql>
	</changeSet>

	<changeSet id="52" author="ADARSH">
		<addColumn tableName="FINANCEMAIN">
			<column name="SvAmount" type="Decimal(18,2)" defaultValue="0" />
		</addColumn>
	</changeSet>

	<changeSet id="53" author="ADARSH">
		<addColumn tableName="FINANCEMAIN">
			<column name="CBAmount" type="Decimal(18,2)" defaultValue="0" />
		</addColumn>
	</changeSet>

	<changeSet id="56" author="ADARSH">
		<addColumn tableName="FINANCEMAIN_PA">
			<column name="SvAmount" type="Decimal(18,2)" defaultValue="0" />
		</addColumn>
	</changeSet>

	<changeSet id="57" author="ADARSH">
		<addColumn tableName="FINANCEMAIN_PA">
			<column name="CBAmount" type="Decimal(18,2)" defaultValue="0" />
		</addColumn>
	</changeSet>

	<changeSet id="60" author="ADARSH">
		<addColumn tableName="FINANCEMAIN_TEMP">
			<column name="SvAmount" type="Decimal(18,2)" defaultValue="0" />
		</addColumn>
	</changeSet>

	<changeSet id="61" author="ADARSH">
		<addColumn tableName="FINANCEMAIN_TEMP">
			<column name="CBAmount" type="Decimal(18,2)" defaultValue="0" />
		</addColumn>
	</changeSet>

	<changeSet id="62" author="ADARSH">
		<createView replaceIfExists="true" viewName="financemain_aview"> SELECT t1.finreference,
    t1.investmentref,
    t1.numberofterms,
    t1.grcperiodenddate,
    t1.allowgrcperiod,
    t1.gracebaserate,
    t1.gracespecialrate,
    t1.grcpftrate,
    t1.grcpftfrq,
    t1.nextgrcpftdate,
    t1.allowgrcpftrvw,
    t1.grcpftrvwfrq,
    t1.nextgrcpftrvwdate,
    t1.allowgrccpz,
    t1.grccpzfrq,
    t1.nextgrccpzdate,
    t1.repaybaserate,
    t1.repayspecialrate,
    t1.repayprofitrate,
    t1.repayfrq,
    t1.nextrepaydate,
    t1.repaypftfrq,
    t1.nextrepaypftdate,
    t1.allowrepayrvw,
    t1.repayrvwfrq,
    t1.nextrepayrvwdate,
    t1.allowrepaycpz,
    t1.repaycpzfrq,
    t1.nextrepaycpzdate,
    t1.maturitydate,
    t1.cpzatgraceend,
    t1.downpayment,
    t1.graceflatamount,
    t1.reqrepayamount,
    t1.totalprofit,
    t1.totalcpz,
    t1.totalgrosspft,
    t1.totalgrossgrcpft,
    t1.totalgracepft,
    t1.totalgracecpz,
    t1.grcratebasis,
    t1.repayratebasis,
    t1.fintype,
    t1.finremarks,
    t1.finccy,
    t1.schedulemethod,
    t1.profitdaysbasis,
    t1.reqmaturity,
    t1.calterms,
    t1.calmaturity,
    t1.firstrepay,
    t1.lastrepay,
    t1.finstartdate,
    t1.finamount,
    t1.finamount + t1.feechargeamt - t1.downpayment AS lovdescfinancingamount,
    t1.finrepaymentamount,
    t1.custid,
    t1.defferments,
    t1.plandefercount,
    t1.finbranch,
    t1.finsourceid,
    t1.alloweddefrpychange,
    t1.availeddefrpychange,
    t1.alloweddeffrqchange,
    t1.availeddeffrqchange,
    t1.recaltype,
    t1.finassetvalue,
    t1.disbaccountid,
    t1.repayaccountid,
    t1.finisactive,
    t1.limitvalid,
    t1.overridelimit,
    t1.securitydeposit,
    t1.version,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t7.fintypedesc AS lovdescfintypename,
    t7.finmaxamount AS lovdescfinmaxamt,
    t7.finminamount AS lovdescfinminamount,
    t1.mindownpayperc,
    t7.finisalwdifferment AS lovdescfinalwdeferment,
    t7.finisdwpayrequired AS lovdescdwnpayreq,
    t7.finmaxdifferment AS lovdescfinmaxdifferment,
    t12.branchdesc AS lovdescfinbranchname,
    t12.branchprovince AS finbranchprovincecode,
    t1.lastrepaydate,
    t1.lastrepaypftdate,
    t1.lastrepayrvwdate,
    t1.lastrepaycpzdate,
    t1.allowgrcrepay,
    t1.grcschdmthd,
    t1.grcmargin,
    t1.repaymargin,
    t1.fincurrassetvalue,
    t1.fincommitmentref,
    t1.finlimitref,
    t1.depreciationfrq,
    t1.fincontractdate,
    t1.nextdepdate,
    t1.lastdepdate,
    t1.finaccount,
    t1.fincustpftaccount,
    t17.acrtilllbd AS lovdescaccruedtilllbd,
    t7.finrvwrateapplfor,
    t1.totalrepayamt,
    t1.closingstatus,
    t1.finapproveddate,
    t1.feechargeamt,
    t1.blacklisted,
    t1.finrepaypftonfrq,
    t1.anualizedpercrate,
    t1.effectiverateofreturn,
    t1.migratedfinance,
    t1.schedulemaintained,
    t1.scheduleregenerated,
    t1.finpurpose,
    t39.loanpurposedesc AS lovdescfinpurposename,
    t1.finstatus,
    t1.finstsreason,
    t1.initiateuser,
    t1.bankname,
    t1.iban,
    t1.accounttype,
    t1.ddareferenceno,
    t7.finscheduleon AS lovdescfinscheduleon,
    t1.custdsr,
    t1.jointaccount,
    t1.jointcustid,
    t1.downpaybank,
    t1.downpaysupl,
    t1.downpayaccount,
    t1.securitycollateral,
    t1.approved,
    t1.discrepancy,
    t1.limitapproved,
    t1.graceterms,
    t7.findivision AS lovdescfindivision,
    t1.rcdmaintainsts,
    t1.finrepaymethod,
    t1.grcprofitdaysbasis,
    t1.stepfinance,
    t1.steptype,
    t1.steppolicy,
    t1.alwmanualsteps,
    t1.noofsteps,
    t1.linkedfinref,
    t1.nextuserid,
    t1.priority,
    t24.policydesc AS lovdescsteppolicyname,
    t1.grcminrate,
    t1.grcmaxrate,
    t1.rpyminrate,
    t1.rpymaxrate,
    t1.deviationapproval,
    t1.manualschedule,
    t1.takeoverfinance,
    t1.grcadvbaserate,
    t1.grcadvmargin,
    t1.grcadvpftrate,
    t1.rpyadvbaserate,
    t1.rpyadvmargin,
    t1.rpyadvpftrate,
    t1.supplementrent,
    t1.increasedcost,
    t1.creditinsamt,
    t1.rolloverfrq,
    t1.nextrolloverdate,
    t27.custstsdescription,
    t1.shariastatus,
    t1.initiatedate,
    t1.finpreapprovedref,
    t1.mmaid,
    t1.accountsofficer,
    t1.feeaccountid,
    t1.fincancelac,
    t28.dealername AS lovdescaccountsofficer,
    t28.dealercity AS lovdescsourcecity,
    t1.dsacode,
    t30.rofficerdesc AS dsacodedesc,
    t1.tdsapplicable,
    t1.mandateid,
    t1.droplinefrq,
    t1.firstdroplinedate,
    t1.pftservicingodlimit,
    t1.insuranceamt,
    t1.deductinsdisb,
    t1.alwbpi,
    t1.bpitreatment,
    t1.planemihalw,
    t1.planemihmethod,
    t1.planemihmaxperyear,
    t1.planemihmax,
    t1.planemihlockperiod,
    t1.planemicpz,
    t1.calroundingmode,
    t1.alwmultidisb,
    t1.applicationno,
    t1.referralid,
    t33.rofficerdesc AS referraliddesc,
    t1.dmacode,
    t34.rofficerdesc AS dmacodedesc,
    t1.salesdepartment,
    t35.gendeptdesc AS salesdepartmentdesc,
    t1.quickdisb,
    t1.wifreference,
    t1.unplanemihlockperiod,
    t1.unplanemicpz,
    t1.reagecpz,
    t1.maxunplannedemi,
    t1.maxreageholidays,
    t1.availedunplanemi,
    t1.availedreageh,
    t1.bpiamount,
    t1.deductfeedisb,
    t1.rvwrateapplfor,
    t1.schcalonrvw,
    t1.pastduepftcalmthd,
    t1.pastduepftmargin,
    t1.droppingmethod,
    t1.ratechganyday,
    t1.promotioncode,
    t1.restructureloan,
    t1.oldfinreference,
    t1.reagebucket,
    t1.fincategory,
    t1.productcategory,
    t1.roundingtarget,
    t36.entitycode AS lovdescentitycode,
    t1.eligibilitymethod,
    t38.fieldcodevalue AS loveligibilitymethod,
    t38.valuedesc AS lovdesceligibilitymethod,
    t1.employeename,
    t37.rofficerdesc AS employeenamedesc,
    t1.samplingrequired,
    t1.legalrequired,
    t1.grcmaxamount,
    t1.connector,
    t40.dealername AS connectorcode,
    t40.dealercity AS connectordesc,
    t1.advanceemi,
    t1.advemiterms,
    t1.bpipftdaysbasis,
    t1.fixedratetenor,
    t1.fixedtenorrate,
    t12.branchtel AS finbranchcontact,
    t1.processattributes,
    t1.businessvertical,
    bv.code AS businessverticalcode,
    bv.description AS businessverticaldesc,
    t1.grcadvtype,
    t1.grcadvterms,
    t1.advtype,
    t1.advterms,
    t1.advstage,
    t1.tdspercentage,
    t1.tdsstartdate,
    t1.tdsenddate,
    t1.tdslimitamt,
    t1.vanreq,
    t1.vancode,
    t1.allowdrawingpower,
    t1.allowrevolving,
    t1.sanbsdschdle,
	t1.PromotionSeqID,
	t1.SvAmount,
	t1.CBAmount
   FROM financemain t1
     JOIN rmtfinancetypes t7 ON t1.fintype = t7.fintype
     LEFT JOIN rmtbranches t12 ON t1.finbranch = t12.branchcode
     LEFT JOIN finpftdetails t17 ON t17.finreference = t1.finreference
     LEFT JOIN steppolicyheader t24 ON t1.steppolicy = t24.policycode
     LEFT JOIN bmtcuststatuscodes t27 ON t1.finstatus = t27.custstscode
     LEFT JOIN amtvehicledealer t28 ON t1.accountsofficer = t28.dealerid
     LEFT JOIN relationshipofficers t30 ON t1.dsacode = t30.rofficercode
     LEFT JOIN relationshipofficers t33 ON t1.referralid = t33.rofficercode
     LEFT JOIN relationshipofficers t34 ON t1.dmacode = t34.rofficercode
     LEFT JOIN rmtgendepartments t35 ON t1.salesdepartment = t35.gendepartment
     LEFT JOIN smtdivisiondetail t36 ON t7.findivision = t36.divisioncode
     LEFT JOIN relationshipofficers t37 ON t1.employeename = t37.rofficercode
     LEFT JOIN rmtlovfielddetail t38 ON t1.eligibilitymethod = t38.fieldcodeid AND t38.fieldcode = 'ELGMETHOD'
     LEFT JOIN loanpurposes t39 ON t1.finpurpose = t39.loanpurposecode
     LEFT JOIN amtvehicledealer t40 ON t1.connector = t40.dealerid
     LEFT JOIN business_vertical bv ON bv.id = t1.businessvertical</createView>
	</changeSet>

	<changeSet id="63" author="ADARSH">
		<createView replaceIfExists="true" viewName="financemain_tview">
		SELECT t1.finreference,
    t1.investmentref,
    t1.numberofterms,
    t1.grcperiodenddate,
    t1.allowgrcperiod,
    t1.gracebaserate,
    t1.gracespecialrate,
    t1.grcpftrate,
    t1.grcpftfrq,
    t1.nextgrcpftdate,
    t1.allowgrcpftrvw,
    t1.grcpftrvwfrq,
    t1.nextgrcpftrvwdate,
    t1.allowgrccpz,
    t1.grccpzfrq,
    t1.nextgrccpzdate,
    t1.repaybaserate,
    t1.repayspecialrate,
    t1.repayprofitrate,
    t1.repayfrq,
    t1.nextrepaydate,
    t1.repaypftfrq,
    t1.nextrepaypftdate,
    t1.allowrepayrvw,
    t1.repayrvwfrq,
    t1.nextrepayrvwdate,
    t1.allowrepaycpz,
    t1.repaycpzfrq,
    t1.nextrepaycpzdate,
    t1.maturitydate,
    t1.cpzatgraceend,
    t1.downpayment,
    t1.graceflatamount,
    t1.reqrepayamount,
    t1.totalprofit,
    t1.totalcpz,
    t1.totalgrosspft,
    t1.totalgrossgrcpft,
    t1.totalgracepft,
    t1.totalgracecpz,
    t1.grcratebasis,
    t1.repayratebasis,
    t1.fintype,
    t1.finremarks,
    t1.finccy,
    t1.schedulemethod,
    t1.profitdaysbasis,
    t1.reqmaturity,
    t1.calterms,
    t1.calmaturity,
    t1.firstrepay,
    t1.lastrepay,
    t1.finstartdate,
    t1.finamount,
    t1.finamount + t1.feechargeamt - t1.downpayment AS lovdescfinancingamount,
    t1.finrepaymentamount,
    t1.custid,
    t1.defferments,
    t1.plandefercount,
    t1.finbranch,
    t1.finsourceid,
    t1.alloweddefrpychange,
    t1.availeddefrpychange,
    t1.alloweddeffrqchange,
    t1.availeddeffrqchange,
    t1.recaltype,
    t1.finassetvalue,
    t1.disbaccountid,
    t1.repayaccountid,
    t1.finisactive,
    t1.limitvalid,
    t1.overridelimit,
    t1.securitydeposit,
    t1.version,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t7.fintypedesc AS lovdescfintypename,
    t7.finmaxamount AS lovdescfinmaxamt,
    t7.finminamount AS lovdescfinminamount,
    t1.mindownpayperc,
    t7.finisalwdifferment AS lovdescfinalwdeferment,
    t7.finisdwpayrequired AS lovdescdwnpayreq,
    t7.finmaxdifferment AS lovdescfinmaxdifferment,
    t12.branchdesc AS lovdescfinbranchname,
    t12.branchprovince AS finbranchprovincecode,
    t1.lastrepaydate,
    t1.lastrepaypftdate,
    t1.lastrepayrvwdate,
    t1.lastrepaycpzdate,
    t1.allowgrcrepay,
    t1.grcschdmthd,
    t1.grcmargin,
    t1.repaymargin,
    t1.fincurrassetvalue,
    t1.fincommitmentref,
    t1.finlimitref,
    t1.depreciationfrq,
    t1.fincontractdate,
    t1.nextdepdate,
    t1.lastdepdate,
    t1.finaccount,
    t1.fincustpftaccount,
    t17.acrtilllbd AS lovdescaccruedtilllbd,
    t7.finrvwrateapplfor,
    t1.totalrepayamt,
    t1.closingstatus,
    t1.finapproveddate,
    t1.feechargeamt,
    t1.blacklisted,
    t1.finrepaypftonfrq,
    t1.anualizedpercrate,
    t1.effectiverateofreturn,
    t1.migratedfinance,
    t1.schedulemaintained,
    t1.scheduleregenerated,
    t1.finpurpose,
    t39.loanpurposedesc AS lovdescfinpurposename,
    t1.finstatus,
    t1.finstsreason,
    t1.initiateuser,
    t1.bankname,
    t1.iban,
    t1.accounttype,
    t1.ddareferenceno,
    t7.finscheduleon AS lovdescfinscheduleon,
    t1.custdsr,
    t1.jointaccount,
    t1.jointcustid,
    t1.downpaybank,
    t1.downpaysupl,
    t1.downpayaccount,
    t1.securitycollateral,
    t1.approved,
    t1.discrepancy,
    t1.limitapproved,
    t1.graceterms,
    t7.findivision AS lovdescfindivision,
    t1.rcdmaintainsts,
    t1.finrepaymethod,
    t1.grcprofitdaysbasis,
    t1.stepfinance,
    t1.steptype,
    t1.steppolicy,
    t1.alwmanualsteps,
    t1.noofsteps,
    t1.linkedfinref,
    t1.nextuserid,
    t1.priority,
    t24.policydesc AS lovdescsteppolicyname,
    t1.grcminrate,
    t1.grcmaxrate,
    t1.rpyminrate,
    t1.rpymaxrate,
    t1.deviationapproval,
    t1.manualschedule,
    t1.takeoverfinance,
    t1.grcadvbaserate,
    t1.grcadvmargin,
    t1.grcadvpftrate,
    t1.rpyadvbaserate,
    t1.rpyadvmargin,
    t1.rpyadvpftrate,
    t1.supplementrent,
    t1.increasedcost,
    t1.creditinsamt,
    t1.rolloverfrq,
    t1.nextrolloverdate,
    t27.custstsdescription,
    t1.shariastatus,
    t1.initiatedate,
    t1.finpreapprovedref,
    t1.mmaid,
    t1.accountsofficer,
    t1.feeaccountid,
    t1.fincancelac,
    t28.dealername AS lovdescaccountsofficer,
    t28.dealercity AS lovdescsourcecity,
    t1.dsacode,
    t30.rofficerdesc AS dsacodedesc,
    t1.tdsapplicable,
    t1.mandateid,
    t1.droplinefrq,
    t1.firstdroplinedate,
    t1.pftservicingodlimit,
    t1.insuranceamt,
    t1.deductinsdisb,
    t1.alwbpi,
    t1.bpitreatment,
    t1.planemihalw,
    t1.planemihmethod,
    t1.planemihmaxperyear,
    t1.planemihmax,
    t1.planemihlockperiod,
    t1.planemicpz,
    t1.calroundingmode,
    t1.alwmultidisb,
    t1.applicationno,
    t1.referralid,
    t33.rofficerdesc AS referraliddesc,
    t1.dmacode,
    t34.rofficerdesc AS dmacodedesc,
    t1.salesdepartment,
    t35.gendeptdesc AS salesdepartmentdesc,
    t1.quickdisb,
    t1.wifreference,
    t1.unplanemihlockperiod,
    t1.unplanemicpz,
    t1.reagecpz,
    t1.maxunplannedemi,
    t1.maxreageholidays,
    t1.availedunplanemi,
    t1.availedreageh,
    t1.bpiamount,
    t1.deductfeedisb,
    t1.rvwrateapplfor,
    t1.schcalonrvw,
    t1.pastduepftcalmthd,
    t1.pastduepftmargin,
    t1.droppingmethod,
    t1.ratechganyday,
    t1.promotioncode,
    t1.restructureloan,
    t1.oldfinreference,
    t1.reagebucket,
    t1.fincategory,
    t1.productcategory,
    t1.roundingtarget,
    t36.entitycode AS lovdescentitycode,
    t1.eligibilitymethod,
    t38.fieldcodevalue AS loveligibilitymethod,
    t38.valuedesc AS lovdesceligibilitymethod,
    t1.employeename,
    t37.rofficerdesc AS employeenamedesc,
    t1.samplingrequired,
    t1.legalrequired,
    t1.grcmaxamount,
    t1.connector,
    t40.dealername AS connectorcode,
    t40.dealercity AS connectordesc,
    t1.advanceemi,
    t1.advemiterms,
    t1.bpipftdaysbasis,
    t1.fixedratetenor,
    t1.fixedtenorrate,
    t12.branchtel AS finbranchcontact,
    t1.processattributes,
    t1.businessvertical,
    bv.code AS businessverticalcode,
    bv.description AS businessverticaldesc,
    t1.grcadvtype,
    t1.grcadvterms,
    t1.advtype,
    t1.advterms,
    t1.advstage,
    t1.tdspercentage,
    t1.tdsstartdate,
    t1.tdsenddate,
    t1.tdslimitamt,
    t1.vanreq,
    t1.vancode,
    t1.allowdrawingpower,
    t1.allowrevolving,
    t1.sanbsdschdle,
	t1.PromotionSeqID,
	t1.SvAmount,
	t1.CBAmount
   FROM financemain_temp t1
     JOIN rmtfinancetypes t7 ON t1.fintype = t7.fintype
     LEFT JOIN rmtbranches t12 ON t1.finbranch = t12.branchcode
     LEFT JOIN finpftdetails t17 ON t17.finreference = t1.finreference
     LEFT JOIN steppolicyheader t24 ON t1.steppolicy = t24.policycode
     LEFT JOIN bmtcuststatuscodes t27 ON t1.finstatus = t27.custstscode
     LEFT JOIN amtvehicledealer t28 ON t1.accountsofficer = t28.dealerid
     LEFT JOIN relationshipofficers t30 ON t1.dsacode = t30.rofficercode
     LEFT JOIN relationshipofficers t33 ON t1.referralid = t33.rofficercode
     LEFT JOIN relationshipofficers t34 ON t1.dmacode = t34.rofficercode
     LEFT JOIN rmtgendepartments t35 ON t1.salesdepartment = t35.gendepartment
     LEFT JOIN smtdivisiondetail t36 ON t7.findivision = t36.divisioncode
     LEFT JOIN relationshipofficers t37 ON t1.employeename = t37.rofficercode
     LEFT JOIN rmtlovfielddetail t38 ON t1.eligibilitymethod = t38.fieldcodeid AND t38.fieldcode = 'ELGMETHOD'
     LEFT JOIN loanpurposes t39 ON t1.finpurpose = t39.loanpurposecode
     LEFT JOIN amtvehicledealer t40 ON t1.connector = t40.dealerid
     LEFT JOIN business_vertical bv ON bv.id = t1.businessvertical</createView>
	</changeSet>
	
	<changeSet id="64_pre" author="murthy.y" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'financemain_view');
			]]>
		</sql>
	</changeSet>

	<changeSet id="64" author="ADARSH">
		<createView replaceIfExists="true" viewName="financemain_view">SELECT t1.finreference,
    t1.investmentref,
    t1.numberofterms,
    t1.grcperiodenddate,
    t1.allowgrcperiod,
    t1.gracebaserate,
    t1.gracespecialrate,
    t1.grcpftrate,
    t1.grcpftfrq,
    t1.nextgrcpftdate,
    t1.allowgrcpftrvw,
    t1.grcpftrvwfrq,
    t1.nextgrcpftrvwdate,
    t1.allowgrccpz,
    t1.grccpzfrq,
    t1.nextgrccpzdate,
    t1.repaybaserate,
    t1.repayspecialrate,
    t1.repayprofitrate,
    t1.repayfrq,
    t1.nextrepaydate,
    t1.repaypftfrq,
    t1.nextrepaypftdate,
    t1.allowrepayrvw,
    t1.repayrvwfrq,
    t1.nextrepayrvwdate,
    t1.allowrepaycpz,
    t1.repaycpzfrq,
    t1.nextrepaycpzdate,
    t1.maturitydate,
    t1.cpzatgraceend,
    t1.downpayment,
    t1.graceflatamount,
    t1.reqrepayamount,
    t1.totalprofit,
    t1.totalcpz,
    t1.totalgrosspft,
    t1.totalgrossgrcpft,
    t1.totalgracepft,
    t1.totalgracecpz,
    t1.grcratebasis,
    t1.repayratebasis,
    t1.fintype,
    t1.finremarks,
    t1.finccy,
    t1.schedulemethod,
    t1.profitdaysbasis,
    t1.reqmaturity,
    t1.calterms,
    t1.calmaturity,
    t1.firstrepay,
    t1.lastrepay,
    t1.finstartdate,
    t1.finamount,
    t1.finamount + t1.feechargeamt - t1.downpayment AS lovdescfinancingamount,
    t1.finrepaymentamount,
    t1.custid,
    t1.defferments,
    t1.plandefercount,
    t1.finbranch,
    t1.finsourceid,
    t1.alloweddefrpychange,
    t1.availeddefrpychange,
    t1.alloweddeffrqchange,
    t1.availeddeffrqchange,
    t1.recaltype,
    t1.finassetvalue,
    t1.disbaccountid,
    t1.repayaccountid,
    t1.finisactive,
    t1.limitvalid,
    t1.overridelimit,
    t1.securitydeposit,
    t1.version,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t7.fintypedesc AS lovdescfintypename,
    t7.finmaxamount AS lovdescfinmaxamt,
    t7.finminamount AS lovdescfinminamount,
    t1.mindownpayperc,
    t7.finisalwdifferment AS lovdescfinalwdeferment,
    t7.finisdwpayrequired AS lovdescdwnpayreq,
    t7.finmaxdifferment AS lovdescfinmaxdifferment,
    t12.branchdesc AS lovdescfinbranchname,
    t12.branchprovince AS finbranchprovincecode,
    t1.lastrepaydate,
    t1.lastrepaypftdate,
    t1.lastrepayrvwdate,
    t1.lastrepaycpzdate,
    t1.allowgrcrepay,
    t1.grcschdmthd,
    t1.grcmargin,
    t1.repaymargin,
    t1.fincurrassetvalue,
    t1.fincommitmentref,
    t1.finlimitref,
    t1.depreciationfrq,
    t1.fincontractdate,
    t1.nextdepdate,
    t1.lastdepdate,
    t1.finaccount,
    t1.fincustpftaccount,
    t17.acrtilllbd AS lovdescaccruedtilllbd,
    t7.finrvwrateapplfor,
    t1.totalrepayamt,
    t1.closingstatus,
    t1.finapproveddate,
    t1.feechargeamt,
    t1.blacklisted,
    t1.finrepaypftonfrq,
    t1.anualizedpercrate,
    t1.effectiverateofreturn,
    t1.migratedfinance,
    t1.schedulemaintained,
    t1.scheduleregenerated,
    t1.finpurpose,
    t39.loanpurposedesc AS lovdescfinpurposename,
    t1.finstatus,
    t1.finstsreason,
    t1.initiateuser,
    t1.bankname,
    t1.iban,
    t1.accounttype,
    t1.ddareferenceno,
    t7.finscheduleon AS lovdescfinscheduleon,
    t1.custdsr,
    t1.jointaccount,
    t1.jointcustid,
    t1.downpaybank,
    t1.downpaysupl,
    t1.downpayaccount,
    t1.securitycollateral,
    t1.approved,
    t1.discrepancy,
    t1.limitapproved,
    t1.graceterms,
    t7.findivision AS lovdescfindivision,
    t1.rcdmaintainsts,
    t1.finrepaymethod,
    t1.grcprofitdaysbasis,
    t1.stepfinance,
    t1.steptype,
    t1.steppolicy,
    t1.alwmanualsteps,
    t1.noofsteps,
    t1.linkedfinref,
    t1.nextuserid,
    t1.priority,
    t24.policydesc AS lovdescsteppolicyname,
    t1.grcminrate,
    t1.grcmaxrate,
    t1.rpyminrate,
    t1.rpymaxrate,
    t1.deviationapproval,
    t1.manualschedule,
    t1.takeoverfinance,
    t1.grcadvbaserate,
    t1.grcadvmargin,
    t1.grcadvpftrate,
    t1.rpyadvbaserate,
    t1.rpyadvmargin,
    t1.rpyadvpftrate,
    t1.supplementrent,
    t1.increasedcost,
    t1.creditinsamt,
    t1.rolloverfrq,
    t1.nextrolloverdate,
    t27.custstsdescription,
    t1.shariastatus,
    t1.initiatedate,
    t1.finpreapprovedref,
    t1.mmaid,
    t1.accountsofficer,
    t1.feeaccountid,
    t1.fincancelac,
    t28.dealername AS lovdescaccountsofficer,
    t28.dealercity AS lovdescsourcecity,
    t1.dsacode,
    t30.rofficerdesc AS dsacodedesc,
    t1.tdsapplicable,
    t1.mandateid,
    t1.droplinefrq,
    t1.firstdroplinedate,
    t1.pftservicingodlimit,
    t1.insuranceamt,
    t1.deductinsdisb,
    t1.alwbpi,
    t1.bpitreatment,
    t1.planemihalw,
    t1.planemihmethod,
    t1.planemihmaxperyear,
    t1.planemihmax,
    t1.planemihlockperiod,
    t1.planemicpz,
    t1.calroundingmode,
    t1.alwmultidisb,
    t1.applicationno,
    t1.referralid,
    t33.rofficerdesc AS referraliddesc,
    t1.dmacode,
    t34.rofficerdesc AS dmacodedesc,
    t1.salesdepartment,
    t35.gendeptdesc AS salesdepartmentdesc,
    t1.quickdisb,
    t1.wifreference,
    t1.unplanemihlockperiod,
    t1.unplanemicpz,
    t1.reagecpz,
    t1.maxunplannedemi,
    t1.maxreageholidays,
    t1.availedunplanemi,
    t1.availedreageh,
    t1.bpiamount,
    t1.deductfeedisb,
    t1.rvwrateapplfor,
    t1.schcalonrvw,
    t1.pastduepftcalmthd,
    t1.pastduepftmargin,
    t1.droppingmethod,
    t1.ratechganyday,
    t1.promotioncode,
    t1.restructureloan,
    t1.oldfinreference,
    t1.reagebucket,
    t1.fincategory,
    t1.productcategory,
    t1.roundingtarget,
    t36.entitycode AS lovdescentitycode,
    t1.eligibilitymethod,
    t38.fieldcodevalue AS loveligibilitymethod,
    t38.valuedesc AS lovdesceligibilitymethod,
    t1.employeename,
    t37.rofficerdesc AS employeenamedesc,
    t1.samplingrequired,
    t1.legalrequired,
    t1.grcmaxamount,
    t1.connector,
    t40.dealername AS connectorcode,
    t40.dealercity AS connectordesc,
    t1.advanceemi,
    t1.advemiterms,
    t1.bpipftdaysbasis,
    t1.fixedratetenor,
    t1.fixedtenorrate,
    t12.branchtel AS finbranchcontact,
    t1.processattributes,
    t1.businessvertical,
    bv.code AS businessverticalcode,
    bv.description AS businessverticaldesc,
    t1.grcadvtype,
    t1.grcadvterms,
    t1.advtype,
    t1.advterms,
    t1.advstage,
    t1.tdspercentage,
    t1.tdsstartdate,
    t1.tdsenddate,
    t1.tdslimitamt,
    t1.vanreq,
    t1.vancode,
    t1.allowdrawingpower,
    t1.allowrevolving,
    t1.sanbsdschdle,
	t1.PromotionSeqID,
	t1.SvAmount,
	t1.CBAmount
   FROM financemain_temp t1
     JOIN rmtfinancetypes t7 ON t1.fintype = t7.fintype
     LEFT JOIN rmtbranches t12 ON t1.finbranch = t12.branchcode
     LEFT JOIN finpftdetails t17 ON t17.finreference = t1.finreference
     LEFT JOIN steppolicyheader t24 ON t1.steppolicy = t24.policycode
     LEFT JOIN bmtcuststatuscodes t27 ON t1.finstatus = t27.custstscode
     LEFT JOIN amtvehicledealer t28 ON t1.accountsofficer = t28.dealerid
     LEFT JOIN relationshipofficers t30 ON t1.dsacode = t30.rofficercode
     LEFT JOIN relationshipofficers t33 ON t1.referralid = t33.rofficercode
     LEFT JOIN relationshipofficers t34 ON t1.dmacode = t34.rofficercode
     LEFT JOIN rmtgendepartments t35 ON t1.salesdepartment = t35.gendepartment
     LEFT JOIN smtdivisiondetail t36 ON t7.findivision = t36.divisioncode
     LEFT JOIN relationshipofficers t37 ON t1.employeename = t37.rofficercode
     LEFT JOIN rmtlovfielddetail t38 ON t1.eligibilitymethod = t38.fieldcodeid AND t38.fieldcode = 'ELGMETHOD'
     LEFT JOIN loanpurposes t39 ON t1.finpurpose = t39.loanpurposecode
     LEFT JOIN amtvehicledealer t40 ON t1.connector = t40.dealerid
     LEFT JOIN business_vertical bv ON bv.id = t1.businessvertical
UNION ALL
 SELECT t1.finreference,
    t1.investmentref,
    t1.numberofterms,
    t1.grcperiodenddate,
    t1.allowgrcperiod,
    t1.gracebaserate,
    t1.gracespecialrate,
    t1.grcpftrate,
    t1.grcpftfrq,
    t1.nextgrcpftdate,
    t1.allowgrcpftrvw,
    t1.grcpftrvwfrq,
    t1.nextgrcpftrvwdate,
    t1.allowgrccpz,
    t1.grccpzfrq,
    t1.nextgrccpzdate,
    t1.repaybaserate,
    t1.repayspecialrate,
    t1.repayprofitrate,
    t1.repayfrq,
    t1.nextrepaydate,
    t1.repaypftfrq,
    t1.nextrepaypftdate,
    t1.allowrepayrvw,
    t1.repayrvwfrq,
    t1.nextrepayrvwdate,
    t1.allowrepaycpz,
    t1.repaycpzfrq,
    t1.nextrepaycpzdate,
    t1.maturitydate,
    t1.cpzatgraceend,
    t1.downpayment,
    t1.graceflatamount,
    t1.reqrepayamount,
    t1.totalprofit,
    t1.totalcpz,
    t1.totalgrosspft,
    t1.totalgrossgrcpft,
    t1.totalgracepft,
    t1.totalgracecpz,
    t1.grcratebasis,
    t1.repayratebasis,
    t1.fintype,
    t1.finremarks,
    t1.finccy,
    t1.schedulemethod,
    t1.profitdaysbasis,
    t1.reqmaturity,
    t1.calterms,
    t1.calmaturity,
    t1.firstrepay,
    t1.lastrepay,
    t1.finstartdate,
    t1.finamount,
    t1.finamount + t1.feechargeamt - t1.downpayment AS lovdescfinancingamount,
    t1.finrepaymentamount,
    t1.custid,
    t1.defferments,
    t1.plandefercount,
    t1.finbranch,
    t1.finsourceid,
    t1.alloweddefrpychange,
    t1.availeddefrpychange,
    t1.alloweddeffrqchange,
    t1.availeddeffrqchange,
    t1.recaltype,
    t1.finassetvalue,
    t1.disbaccountid,
    t1.repayaccountid,
    t1.finisactive,
    t1.limitvalid,
    t1.overridelimit,
    t1.securitydeposit,
    t1.version,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t7.fintypedesc AS lovdescfintypename,
    t7.finmaxamount AS lovdescfinmaxamt,
    t7.finminamount AS lovdescfinminamount,
    t1.mindownpayperc,
    t7.finisalwdifferment AS lovdescfinalwdeferment,
    t7.finisdwpayrequired AS lovdescdwnpayreq,
    t7.finmaxdifferment AS lovdescfinmaxdifferment,
    t12.branchdesc AS lovdescfinbranchname,
    t12.branchprovince AS finbranchprovincecode,
    t1.lastrepaydate,
    t1.lastrepaypftdate,
    t1.lastrepayrvwdate,
    t1.lastrepaycpzdate,
    t1.allowgrcrepay,
    t1.grcschdmthd,
    t1.grcmargin,
    t1.repaymargin,
    t1.fincurrassetvalue,
    t1.fincommitmentref,
    t1.finlimitref,
    t1.depreciationfrq,
    t1.fincontractdate,
    t1.nextdepdate,
    t1.lastdepdate,
    t1.finaccount,
    t1.fincustpftaccount,
    t17.acrtilllbd AS lovdescaccruedtilllbd,
    t7.finrvwrateapplfor,
    t1.totalrepayamt,
    t1.closingstatus,
    t1.finapproveddate,
    t1.feechargeamt,
    t1.blacklisted,
    t1.finrepaypftonfrq,
    t1.anualizedpercrate,
    t1.effectiverateofreturn,
    t1.migratedfinance,
    t1.schedulemaintained,
    t1.scheduleregenerated,
    t1.finpurpose,
    t39.loanpurposedesc AS lovdescfinpurposename,
    t1.finstatus,
    t1.finstsreason,
    t1.initiateuser,
    t1.bankname,
    t1.iban,
    t1.accounttype,
    t1.ddareferenceno,
    t7.finscheduleon AS lovdescfinscheduleon,
    t1.custdsr,
    t1.jointaccount,
    t1.jointcustid,
    t1.downpaybank,
    t1.downpaysupl,
    t1.downpayaccount,
    t1.securitycollateral,
    t1.approved,
    t1.discrepancy,
    t1.limitapproved,
    t1.graceterms,
    t7.findivision AS lovdescfindivision,
    t1.rcdmaintainsts,
    t1.finrepaymethod,
    t1.grcprofitdaysbasis,
    t1.stepfinance,
    t1.steptype,
    t1.steppolicy,
    t1.alwmanualsteps,
    t1.noofsteps,
    t1.linkedfinref,
    t1.nextuserid,
    t1.priority,
    t24.policydesc AS lovdescsteppolicyname,
    t1.grcminrate,
    t1.grcmaxrate,
    t1.rpyminrate,
    t1.rpymaxrate,
    t1.deviationapproval,
    t1.manualschedule,
    t1.takeoverfinance,
    t1.grcadvbaserate,
    t1.grcadvmargin,
    t1.grcadvpftrate,
    t1.rpyadvbaserate,
    t1.rpyadvmargin,
    t1.rpyadvpftrate,
    t1.supplementrent,
    t1.increasedcost,
    t1.creditinsamt,
    t1.rolloverfrq,
    t1.nextrolloverdate,
    t27.custstsdescription,
    t1.shariastatus,
    t1.initiatedate,
    t1.finpreapprovedref,
    t1.mmaid,
    t1.accountsofficer,
    t1.feeaccountid,
    t1.fincancelac,
    t28.dealername AS lovdescaccountsofficer,
    t28.dealercity AS lovdescsourcecity,
    t1.dsacode,
    t30.rofficerdesc AS dsacodedesc,
    t1.tdsapplicable,
    t1.mandateid,
    t1.droplinefrq,
    t1.firstdroplinedate,
    t1.pftservicingodlimit,
    t1.insuranceamt,
    t1.deductinsdisb,
    t1.alwbpi,
    t1.bpitreatment,
    t1.planemihalw,
    t1.planemihmethod,
    t1.planemihmaxperyear,
    t1.planemihmax,
    t1.planemihlockperiod,
    t1.planemicpz,
    t1.calroundingmode,
    t1.alwmultidisb,
    t1.applicationno,
    t1.referralid,
    t33.rofficerdesc AS referraliddesc,
    t1.dmacode,
    t34.rofficerdesc AS dmacodedesc,
    t1.salesdepartment,
    t35.gendeptdesc AS salesdepartmentdesc,
    t1.quickdisb,
    t1.wifreference,
    t1.unplanemihlockperiod,
    t1.unplanemicpz,
    t1.reagecpz,
    t1.maxunplannedemi,
    t1.maxreageholidays,
    t1.availedunplanemi,
    t1.availedreageh,
    t1.bpiamount,
    t1.deductfeedisb,
    t1.rvwrateapplfor,
    t1.schcalonrvw,
    t1.pastduepftcalmthd,
    t1.pastduepftmargin,
    t1.droppingmethod,
    t1.ratechganyday,
    t1.promotioncode,
    t1.restructureloan,
    t1.oldfinreference,
    t1.reagebucket,
    t1.fincategory,
    t1.productcategory,
    t1.roundingtarget,
    t36.entitycode AS lovdescentitycode,
    t1.eligibilitymethod,
    t38.fieldcodevalue AS loveligibilitymethod,
    t38.valuedesc AS lovdesceligibilitymethod,
    t1.employeename,
    t37.rofficerdesc AS employeenamedesc,
    t1.samplingrequired,
    t1.legalrequired,
    t1.grcmaxamount,
    t1.connector,
    t40.dealername AS connectorcode,
    t40.dealercity AS connectordesc,
    t1.advanceemi,
    t1.advemiterms,
    t1.bpipftdaysbasis,
    t1.fixedratetenor,
    t1.fixedtenorrate,
    t12.branchtel AS finbranchcontact,
    t1.processattributes,
    t1.businessvertical,
    bv.code AS businessverticalcode,
    bv.description AS businessverticaldesc,
    t1.grcadvtype,
    t1.grcadvterms,
    t1.advtype,
    t1.advterms,
    t1.advstage,
    t1.tdspercentage,
    t1.tdsstartdate,
    t1.tdsenddate,
    t1.tdslimitamt,
    t1.vanreq,
    t1.vancode,
    t1.allowdrawingpower,
    t1.allowrevolving,
    t1.sanbsdschdle,
	t1.PromotionSeqID,
	t1.SvAmount,
	t1.CBAmount
   FROM financemain t1
     JOIN rmtfinancetypes t7 ON t1.fintype = t7.fintype
     LEFT JOIN rmtbranches t12 ON t1.finbranch = t12.branchcode
     LEFT JOIN finpftdetails t17 ON t17.finreference = t1.finreference
     LEFT JOIN steppolicyheader t24 ON t1.steppolicy = t24.policycode
     LEFT JOIN bmtcuststatuscodes t27 ON t1.finstatus = t27.custstscode
     LEFT JOIN amtvehicledealer t28 ON t1.accountsofficer = t28.dealerid
     LEFT JOIN relationshipofficers t30 ON t1.dsacode = t30.rofficercode
     LEFT JOIN relationshipofficers t33 ON t1.referralid = t33.rofficercode
     LEFT JOIN relationshipofficers t34 ON t1.dmacode = t34.rofficercode
     LEFT JOIN rmtgendepartments t35 ON t1.salesdepartment = t35.gendepartment
     LEFT JOIN smtdivisiondetail t36 ON t7.findivision = t36.divisioncode
     LEFT JOIN relationshipofficers t37 ON t1.employeename = t37.rofficercode
     LEFT JOIN rmtlovfielddetail t38 ON t1.eligibilitymethod = t38.fieldcodeid AND t38.fieldcode = 'ELGMETHOD'
     LEFT JOIN loanpurposes t39 ON t1.finpurpose = t39.loanpurposecode
     LEFT JOIN amtvehicledealer t40 ON t1.connector = t40.dealerid
     LEFT JOIN business_vertical bv ON bv.id = t1.businessvertical
  WHERE NOT (EXISTS ( SELECT 1
           FROM financemain_temp
          WHERE financemain_temp.finreference = t1.finreference))</createView>
	</changeSet>
	
	<changeSet id="64_post" author="murthy.y" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'financemain_view');
			]]>
		</sql>
	</changeSet>

	<changeSet id="65" author="ADARSH">
		<createView replaceIfExists="true" viewName="legaldetails_view">
            SELECT t1.legalid,
    t1.legalreference,
    t1.loanreference,
    t1.collateralreference,
    t1.branch,
    t1.legaldate,
    t1.schedulelevelarea,
    t1.legaldecision,
    t1.legalremarks,
    t1.propertydetailmodt,
    t1.propertydetailecdate,
    t1.ecpropertyownername,
    t1.active,
    t1.module,
    t1.version,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t2.branchdesc,
    t3.finbranch,
    t4.findivision
   FROM legaldetails_temp t1
     JOIN rmtbranches t2 ON t1.branch = t2.branchcode
     JOIN financemain_temp t3 ON t3.finreference = t1.loanreference
     JOIN rmtfinancetypes t4 ON t4.fintype = t3.fintype
UNION ALL
 SELECT t1.legalid,
    t1.legalreference,
    t1.loanreference,
    t1.collateralreference,
    t1.branch,
    t1.legaldate,
    t1.schedulelevelarea,
    t1.legaldecision,
    t1.legalremarks,
    t1.propertydetailmodt,
    t1.propertydetailecdate,
    t1.ecpropertyownername,
    t1.active,
    t1.module,
    t1.version,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t2.branchdesc,
    t3.finbranch,
    t4.findivision
   FROM legaldetails t1
     JOIN rmtbranches t2 ON t1.branch = t2.branchcode
     JOIN financemain_view t3 ON t3.finreference = t1.loanreference
     JOIN rmtfinancetypes t4 ON t4.fintype = t3.fintype
  WHERE NOT (EXISTS ( SELECT 1
           FROM legaldetails_temp
          WHERE legaldetails_temp.legalid = t1.legalid))
          </createView>
	</changeSet>

	<changeSet id="66" author="ADARSH">
		<createView replaceIfExists="true" viewName="financemaintenance_aview">
    	SELECT t1.finreference,
    t1.finbranch,
    t1.fintype,
    t1.finccy,
    t1.schedulemethod,
    t1.profitdaysbasis,
    t1.finstartdate,
    t1.numberofterms,
    t1.custid,
    t1.finamount,
    t1.maturitydate,
    t1.finrepaymentamount,
    t1.finisactive,
    t1.blacklisted,
    t1.feechargeamt,
    t1.insuranceamt,
    t1.graceterms,
    t1.allowgrcperiod,
    t1.grcperiodenddate,
    t1.alwmultidisb,
    t1.defferments,
    t1.nextrolecode,
    t1.recordstatus,
    t1.recordtype,
    t1.allowgrcpftrvw,
    t1.allowrepayrvw,
    t1.lastrepaydate,
    t1.lastrepaypftdate,
    t1.alloweddefrpychange,
    t1.availeddefrpychange,
    t1.migratedfinance,
    t1.rcdmaintainsts,
    t1.closingstatus,
    t1.repayratebasis,
    t1.manualschedule,
    t1.takeoverfinance,
    t1.nextrolloverdate,
    t1.downpayment,
    t1.planemihalw,
    t1.fincurrassetvalue,
    t1.finassetvalue,
    t2.custcif AS lovdesccustcif,
    t3.fincategory AS lovdescproductcodename,
    t3.finisalwdifferment AS lovdescfinalwdeferment,
    t4.productcategory,
    t1.samplingrequired,
    t1.advanceemi,
    t1.advemiterms,
    t1.bpipftdaysbasis AS bpiratebasis,
    t1.sanbsdschdle,
	t1.PromotionSeqID,
	t1.SvAmount,
	t1.CBAmount 
   FROM financemain t1
     JOIN customers t2 ON t1.custid = t2.custid
     JOIN rmtfinancetypes t3 ON t1.fintype = t3.fintype
     JOIN bmtproduct t4 ON t3.fincategory = t4.productcode
     </createView>
	</changeSet>

	<changeSet id="67" author="ADARSH" dbms="postgresql,oracle">
		<createView replaceIfExists="true" viewName="financemaintenance_view">
    	SELECT t1.finreference,
    t1.finbranch,
    t1.fintype,
    t1.finccy,
    t1.schedulemethod,
    t1.profitdaysbasis,
    t1.finstartdate,
    t1.numberofterms,
    t1.custid,
    t1.finamount,
    t1.maturitydate,
    t1.finrepaymentamount,
    t1.finisactive,
    t1.blacklisted,
    t1.feechargeamt,
    t1.insuranceamt,
    t1.graceterms,
    t1.allowgrcperiod,
    t1.grcperiodenddate,
    t1.alwmultidisb,
    t1.defferments,
    t1.nextrolecode,
    t1.recordstatus,
    t1.recordtype,
    t1.allowgrcpftrvw,
    t1.allowrepayrvw,
    t1.lastrepaydate,
    t1.lastrepaypftdate,
    t1.alloweddefrpychange,
    t1.availeddefrpychange,
    t1.rcdmaintainsts,
    t1.migratedfinance,
    t1.closingstatus,
    t1.repayratebasis,
    t1.manualschedule,
    t1.fincurrassetvalue,
    t1.takeoverfinance,
    t1.nextrolloverdate,
    t1.availedunplanemi,
    t1.availedreageh,
    t1.maxunplannedemi,
    t1.maxreageholidays,
    t1.downpayment,
    t1.planemihalw,
    t1.calterms,
    t1.ratechganyday,
    t1.finassetvalue,
    t2.custcif AS lovdesccustcif,
    t3.finisalwdifferment AS lovdescfinalwdeferment,
    t3.findivision AS lovdescfindivision,
    t3.fincategory AS lovdescproductcodename,
    t4.productcategory,
    COALESCE(t5.roledesc, fn_get_roledesc(t1.nextrolecode)) AS lovdescrequeststage,
    COALESCE(t9.noinst, 0) AS noinst,
    t1.samplingrequired,
    t1.advemiterms,
    t1.sanbsdschdle,
	t1.PromotionSeqID,
	t1.SvAmount,
	t1.CBAmount
   FROM financemain_temp t1
     JOIN customers t2 ON t1.custid = t2.custid
     JOIN rmtfinancetypes t3 ON t1.fintype = t3.fintype
     LEFT JOIN secroles t5 ON t1.nextrolecode = t5.rolecd
     JOIN bmtproduct t4 ON t3.fincategory = t4.productcode
     LEFT JOIN finpftdetails t9 ON t1.finreference = t9.finreference
UNION ALL
 SELECT t1.finreference,
    t1.finbranch,
    t1.fintype,
    t1.finccy,
    t1.schedulemethod,
    t1.profitdaysbasis,
    t1.finstartdate,
    t1.numberofterms,
    t1.custid,
    t1.finamount,
    t1.maturitydate,
    t1.finrepaymentamount,
    t1.finisactive,
    t1.blacklisted,
    t1.feechargeamt,
    t1.insuranceamt,
    t1.graceterms,
    t1.allowgrcperiod,
    t1.grcperiodenddate,
    t1.alwmultidisb,
    t1.defferments,
    t1.nextrolecode,
    t1.recordstatus,
    t1.recordtype,
    t1.allowgrcpftrvw,
    t1.allowrepayrvw,
    t1.lastrepaydate,
    t1.lastrepaypftdate,
    t1.alloweddefrpychange,
    t1.availeddefrpychange,
    t1.rcdmaintainsts,
    t1.migratedfinance,
    t1.closingstatus,
    t1.repayratebasis,
    t1.manualschedule,
    t1.fincurrassetvalue,
    t1.takeoverfinance,
    t1.nextrolloverdate,
    t1.availedunplanemi,
    t1.availedreageh,
    t1.maxunplannedemi,
    t1.maxreageholidays,
    t1.downpayment,
    t1.planemihalw,
    t1.calterms,
    t1.ratechganyday,
    t1.finassetvalue,
    t2.custcif AS lovdesccustcif,
    t3.finisalwdifferment AS lovdescfinalwdeferment,
    t3.findivision AS lovdescfindivision,
    t3.fincategory AS lovdescproductcodename,
    t4.productcategory,
    COALESCE(t5.roledesc, fn_get_roledesc(t1.nextrolecode)) AS lovdescrequeststage,
    COALESCE(t9.noinst, 0) AS noinst,
    t1.samplingrequired,
    t1.advemiterms,
    t1.sanbsdschdle,
	t1.PromotionSeqID,
	t1.SvAmount,
	t1.CBAmount
   FROM financemain t1
     JOIN customers t2 ON t1.custid = t2.custid
     JOIN rmtfinancetypes t3 ON t1.fintype = t3.fintype
     LEFT JOIN secroles t5 ON t1.nextrolecode = t5.rolecd
     JOIN bmtproduct t4 ON t3.fincategory = t4.productcode
     LEFT JOIN finpftdetails t9 ON t1.finreference = t9.finreference
  WHERE NOT (EXISTS ( SELECT 1 AS expr1
           FROM financemain_temp
          WHERE financemain_temp.finreference = t1.finreference))
         </createView>
	</changeSet>
	
	<changeSet id="67" author="ADARSH" dbms="mssql">
		<createView replaceIfExists="true" viewName="financemaintenance_view">
    	SELECT t1.finreference,
    t1.finbranch,
    t1.fintype,
    t1.finccy,
    t1.schedulemethod,
    t1.profitdaysbasis,
    t1.finstartdate,
    t1.numberofterms,
    t1.custid,
    t1.finamount,
    t1.maturitydate,
    t1.finrepaymentamount,
    t1.finisactive,
    t1.blacklisted,
    t1.feechargeamt,
    t1.insuranceamt,
    t1.graceterms,
    t1.allowgrcperiod,
    t1.grcperiodenddate,
    t1.alwmultidisb,
    t1.defferments,
    t1.nextrolecode,
    t1.recordstatus,
    t1.recordtype,
    t1.allowgrcpftrvw,
    t1.allowrepayrvw,
    t1.lastrepaydate,
    t1.lastrepaypftdate,
    t1.alloweddefrpychange,
    t1.availeddefrpychange,
    t1.rcdmaintainsts,
    t1.migratedfinance,
    t1.closingstatus,
    t1.repayratebasis,
    t1.manualschedule,
    t1.fincurrassetvalue,
    t1.takeoverfinance,
    t1.nextrolloverdate,
    t1.availedunplanemi,
    t1.availedreageh,
    t1.maxunplannedemi,
    t1.maxreageholidays,
    t1.downpayment,
    t1.planemihalw,
    t1.calterms,
    t1.ratechganyday,
    t1.finassetvalue,
    t2.custcif AS lovdesccustcif,
    t3.finisalwdifferment AS lovdescfinalwdeferment,
    t3.findivision AS lovdescfindivision,
    t3.fincategory AS lovdescproductcodename,
    t4.productcategory,
    COALESCE(t5.roledesc, dbo.fn_get_roledesc(t1.nextrolecode)) AS lovdescrequeststage,
    COALESCE(t9.noinst, 0) AS noinst,
    t1.samplingrequired,
    t1.advemiterms,
    t1.sanbsdschdle,
	t1.PromotionSeqID,
	t1.SvAmount,
	t1.CBAmount
   FROM financemain_temp t1
     JOIN customers t2 ON t1.custid = t2.custid
     JOIN rmtfinancetypes t3 ON t1.fintype = t3.fintype
     LEFT JOIN secroles t5 ON t1.nextrolecode = t5.rolecd
     JOIN bmtproduct t4 ON t3.fincategory = t4.productcode
     LEFT JOIN finpftdetails t9 ON t1.finreference = t9.finreference
UNION ALL
 SELECT t1.finreference,
    t1.finbranch,
    t1.fintype,
    t1.finccy,
    t1.schedulemethod,
    t1.profitdaysbasis,
    t1.finstartdate,
    t1.numberofterms,
    t1.custid,
    t1.finamount,
    t1.maturitydate,
    t1.finrepaymentamount,
    t1.finisactive,
    t1.blacklisted,
    t1.feechargeamt,
    t1.insuranceamt,
    t1.graceterms,
    t1.allowgrcperiod,
    t1.grcperiodenddate,
    t1.alwmultidisb,
    t1.defferments,
    t1.nextrolecode,
    t1.recordstatus,
    t1.recordtype,
    t1.allowgrcpftrvw,
    t1.allowrepayrvw,
    t1.lastrepaydate,
    t1.lastrepaypftdate,
    t1.alloweddefrpychange,
    t1.availeddefrpychange,
    t1.rcdmaintainsts,
    t1.migratedfinance,
    t1.closingstatus,
    t1.repayratebasis,
    t1.manualschedule,
    t1.fincurrassetvalue,
    t1.takeoverfinance,
    t1.nextrolloverdate,
    t1.availedunplanemi,
    t1.availedreageh,
    t1.maxunplannedemi,
    t1.maxreageholidays,
    t1.downpayment,
    t1.planemihalw,
    t1.calterms,
    t1.ratechganyday,
    t1.finassetvalue,
    t2.custcif AS lovdesccustcif,
    t3.finisalwdifferment AS lovdescfinalwdeferment,
    t3.findivision AS lovdescfindivision,
    t3.fincategory AS lovdescproductcodename,
    t4.productcategory,
    COALESCE(t5.roledesc, dbo.fn_get_roledesc(t1.nextrolecode)) AS lovdescrequeststage,
    COALESCE(t9.noinst, 0) AS noinst,
    t1.samplingrequired,
    t1.advemiterms,
    t1.sanbsdschdle,
	t1.PromotionSeqID,
	t1.SvAmount,
	t1.CBAmount
   FROM financemain t1
     JOIN customers t2 ON t1.custid = t2.custid
     JOIN rmtfinancetypes t3 ON t1.fintype = t3.fintype
     LEFT JOIN secroles t5 ON t1.nextrolecode = t5.rolecd
     JOIN bmtproduct t4 ON t3.fincategory = t4.productcode
     LEFT JOIN finpftdetails t9 ON t1.finreference = t9.finreference
  WHERE NOT (EXISTS ( SELECT 1 AS expr1
           FROM financemain_temp
          WHERE financemain_temp.finreference = t1.finreference))
         </createView>
	</changeSet>

	<changeSet id="68" author="ADARSH">
		<createView replaceIfExists="true" viewName="financemain_dataview">
    	SELECT t1.finreference,
    	 t1.fintype,
  		 t2.custcif AS lovdesccustcif,
  		 t1.custid,
   		 t1.closingstatus,
  		 t1.finisactive,
   		 t1.maturitydate,
   		 t1.productCategory
  	 FROM financemain t1
    	JOIN customers t2 ON t1.custid = t2.custid
     	JOIN rmtfinancetypes t3 ON t3.fintype = t1.fintype
  		WHERE t1.closingstatus IS NULL OR t1.closingstatus != 'C'
  		</createView>
	</changeSet>

	<changeSet id="69" author="ADARSH">
		<dropPrimaryKey constraintName="pk_fintypefees"
			tableName="fintypefees" />
	</changeSet>
	
	<changeSet id="70_pre" author="ADARSH" dbms="mssql">
		<addNotNullConstraint tableName="fintypefees" columnName="fintype" columnDataType="varchar(8)" />
		<addNotNullConstraint tableName="fintypefees" columnName="originationfee" columnDataType="boolean" />
		<addNotNullConstraint tableName="fintypefees" columnName="finevent" columnDataType="varchar(8)" />
		<addNotNullConstraint tableName="fintypefees" columnName="feetypeid" columnDataType="bigint" />
		<addNotNullConstraint tableName="fintypefees" columnName="moduleid" columnDataType="int" />
		<addNotNullConstraint tableName="fintypefees" columnName="referenceid" columnDataType="bigint" />
	</changeSet>

	<changeSet id="70" author="ADARSH">
		<addPrimaryKey
			columnNames="fintype, originationfee, finevent, feetypeid, moduleid, referenceid"
			constraintName="pk_fintypefees" tableName="fintypefees" />
	</changeSet>

	<changeSet id="71" author="ADARSH">
		<addColumn tableName="FINPFTDETAILS">
			<column name="GAPINTAMZ" type="decimal(18,0)" defaultValue="0" />
		</addColumn>
	</changeSet>

	<changeSet id="72" author="ADARSH">
		<addColumn tableName="FINPFTDETAILS">
			<column name="GAPINTAMZLBD" type="decimal(18,0)" defaultValue="0" />
		</addColumn>
	</changeSet>

	<changeSet id="73" author="ADARSH">
		<addColumn tableName="FINPFTDETAILS">
			<column name="PRVMTHGAPINTAMZ" type="decimal(18,0)" defaultValue="0" />
		</addColumn>
	</changeSet>

	<changeSet id="74" author="ADARSH">
		<addColumn tableName="FINPFTDETAILS">
			<column name="SVAMOUNT" type="decimal(18,2)" defaultValue="0" />
		</addColumn>
	</changeSet>

	<changeSet id="75" author="ADARSH">
		<addColumn tableName="FINPFTDETAILS">
			<column name="CBAmount" type="decimal(18,2)" defaultValue="0" />
		</addColumn>
	</changeSet>

	<changeSet id="76" author="ADARSH">
		<addColumn tableName="FINPFTDETAILS_SNAPSHOT">
			<column name="GAPINTAMZ" type="decimal(18,0)" defaultValue="0" />
		</addColumn>
	</changeSet>

	<changeSet id="77" author="ADARSH">
		<addColumn tableName="FINPFTDETAILS_SNAPSHOT">
			<column name="GAPINTAMZLBD" type="decimal(18,0)" defaultValue="0" />
		</addColumn>
	</changeSet>

	<changeSet id="78" author="ADARSH">
		<addColumn tableName="FINPFTDETAILS_SNAPSHOT">
			<column name="PRVMTHGAPINTAMZ" type="decimal(18,0)" defaultValue="0" />
		</addColumn>
	</changeSet>

	<changeSet id="79" author="ADARSH">
		<addColumn tableName="FINPFTDETAILS_SNAPSHOT">
			<column name="SVAMOUNT" type="decimal(18,2)" defaultValue="0" />
		</addColumn>
	</changeSet>

	<changeSet id="80" author="ADARSH">
		<addColumn tableName="FINPFTDETAILS_SNAPSHOT">
			<column name="CBAmount" type="decimal(18,2)" defaultValue="0" />
		</addColumn>
	</changeSet>

	<changeSet id="81" author="ADARSH">
		<sql>
		<![CDATA[
		UPDATE FINPFTDETAILS SET GapIntAmz=0, GapIntAmzLbd=0, PrvMthGapIntAmz = 0;
	    UPDATE FINPFTDETAILS_SNAPSHOT SET GapIntAmz=0, GapIntAmzLbd=0, PrvMthGapIntAmz =0;
		]]>
		</sql>
	</changeSet>
	
	<changeSet id="82" author="ADARSH">
		<sql>
		<![CDATA[
		INSERT INTO bmtamountcodes(allowedevent, allowedria, amountcode, amountcodedesc, amountcodeisactive, version, lastmntby, lastmnton, recordstatus, rolecode, nextrolecode, taskid, nexttaskid, recordtype, workflowid) VALUES ('AMZ', 0, 'ae_dGapAmz', 'Gap Interest from Last Posting to Today', 1, 1, 1000, current_timestamp, 'Approved', null, null, null, null, null, 0);
		INSERT INTO bmtamountcodes(allowedevent, allowedria, amountcode, amountcodedesc, amountcodeisactive, version, lastmntby, lastmnton, recordstatus, rolecode, nextrolecode, taskid, nexttaskid, recordtype, workflowid) VALUES ('ADDDBSP', 0, 'ae_svAmount', 'Subvention Amount', 1, 1, 1000, current_timestamp, 'Approved', null, null, null, null, null, 0);
		INSERT INTO bmtamountcodes(allowedevent, allowedria, amountcode, amountcodedesc, amountcodeisactive, version, lastmntby, lastmnton, recordstatus, rolecode, nextrolecode, taskid, nexttaskid, recordtype, workflowid) VALUES ('ADDDBSP', 0, 'ae_cbAmount', 'Cash Back Amount', 1, 1, 1000, current_timestamp, 'Approved', null, null, null, null, null, 0);
 		]]>
		</sql>
	</changeSet>
		
	<changeSet id="83" author="satyanarayana.g" dbms="postgresql,oracle">
		<createView viewName="FINANCEMAIN_LVIEW" replaceIfExists="true">
			SELECT T1.FINREFERENCE,
				  T1.INVESTMENTREF,
				  T1.FINTYPE,
				  T1.FINCCY,
				  T1.FINAMOUNT,
				  T1.DOWNPAYMENT,
				  T1.FEECHARGEAMT,
				  T1.SCHEDULEMETHOD,
				  T1.NUMBEROFTERMS,
				  T1.RECORDSTATUS,
				  T1.RECORDTYPE,
				  T1.ROLECODE,
				  T1.NEXTROLECODE,
				  T1.FINBRANCH,
				  T1.FINCONTRACTDATE,
				  T1.LINKEDFINREF,
				  T1.NEXTUSERID,
				  T1.PRIORITY,
				  T1.WORKFLOWID,
				  T1.TASKID,
				  T1.NEXTTASKID,
				  T1.FINPREAPPROVEDREF,
				  T1.RCDMAINTAINSTS,
				  T1.INSURANCEAMT,
				  T1.FINCURRASSETVALUE,
				  T1.CALTERMS,
				  T1.DEVIATIONAPPROVAL,
				  T1.FINPURPOSE,
				  T1.INITIATEDATE,
				  T1.FINASSETVALUE,
				  T2.CUSTCIF        LOVDESCCUSTCIF,
				  T2.CUSTSHRTNAME   LOVDESCCUSTSHRTNAME,
				  T2.CUSTPASSPORTNO  LOVDESCCUSTPASSPORTNO,
				  T2.CUSTDOB         LOVDESCCUSTDOB,
				  T2.CUSTCRCPR       LOVDESCCUSTCRCPR,
				  T2.PHONENUMBER,
				  T3.FINCATEGORY  LOVDESCPRODUCTCODENAME,
				  T3.FINDIVISION  LOVDESCFINDIVISION,
				  T3.PRODUCT      LOVDESCFINPRODUCT,
				  T3.FINTYPEDESC  LOVDESCFINTYPENAME,
				  T1.PRODUCTCATEGORY,
				  COALESCE(T4.ROLEDESC, FN_GET_ROLEDESC(T1.NEXTROLECODE))  LOVDESCREQUESTSTAGE,
				  T1.SAMPLINGREQUIRED,
				  T1.ADVANCEEMI,
				  T1.ADVEMITERMS,
				  T1.BPIPFTDAYSBASIS,
				  T1.GRACETERMS
				FROM FINANCEMAIN_TEMP T1
				JOIN CUSTOMERS T2 ON T1.CUSTID = T2.CUSTID
				JOIN RMTFINANCETYPES T3 ON T3.FINTYPE = T1.FINTYPE
				LEFT JOIN SECROLES T4 ON T1.NEXTROLECODE = T4.ROLECD
	</createView>
	</changeSet>

	<changeSet id="83" author="satyanarayana.g" dbms="mssql">
		<createView viewName="FINANCEMAIN_LVIEW" replaceIfExists="true">
			SELECT T1.FINREFERENCE,
				  T1.INVESTMENTREF,
				  T1.FINTYPE,
				  T1.FINCCY,
				  T1.FINAMOUNT,
				  T1.DOWNPAYMENT,
				  T1.FEECHARGEAMT,
				  T1.SCHEDULEMETHOD,
				  T1.NUMBEROFTERMS,
				  T1.RECORDSTATUS,
				  T1.RECORDTYPE,
				  T1.ROLECODE,
				  T1.NEXTROLECODE,
				  T1.FINBRANCH,
				  T1.FINCONTRACTDATE,
				  T1.LINKEDFINREF,
				  T1.NEXTUSERID,
				  T1.PRIORITY,
				  T1.WORKFLOWID,
				  T1.TASKID,
				  T1.NEXTTASKID,
				  T1.FINPREAPPROVEDREF,
				  T1.RCDMAINTAINSTS,
				  T1.INSURANCEAMT,
				  T1.FINCURRASSETVALUE,
				  T1.CALTERMS,
				  T1.DEVIATIONAPPROVAL,
				  T1.FINPURPOSE,
				  T1.INITIATEDATE,
				  T1.FINASSETVALUE,
				  T2.CUSTCIF        LOVDESCCUSTCIF,
				  T2.CUSTSHRTNAME   LOVDESCCUSTSHRTNAME,
				  T2.CUSTPASSPORTNO  LOVDESCCUSTPASSPORTNO,
				  T2.CUSTDOB         LOVDESCCUSTDOB,
				  T2.CUSTCRCPR       LOVDESCCUSTCRCPR,
				  T2.PHONENUMBER,
				  T3.FINCATEGORY  LOVDESCPRODUCTCODENAME,
				  T3.FINDIVISION  LOVDESCFINDIVISION,
				  T3.PRODUCT      LOVDESCFINPRODUCT,
				  T3.FINTYPEDESC  LOVDESCFINTYPENAME,
				  T1.PRODUCTCATEGORY,
				  COALESCE(T4.ROLEDESC, dbo.FN_GET_ROLEDESC(T1.NEXTROLECODE))  LOVDESCREQUESTSTAGE,
				  T1.SAMPLINGREQUIRED,
				  T1.ADVANCEEMI,
				  T1.ADVEMITERMS,
				  T1.BPIPFTDAYSBASIS,
				  T1.GRACETERMS
				FROM FINANCEMAIN_TEMP T1
				JOIN CUSTOMERS T2 ON T1.CUSTID = T2.CUSTID
				JOIN RMTFINANCETYPES T3 ON T3.FINTYPE = T1.FINTYPE
				LEFT JOIN SECROLES T4 ON T1.NEXTROLECODE = T4.ROLECD
	</createView>
	</changeSet>
	
</databaseChangeLog>