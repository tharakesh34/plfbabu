<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value="" dbms="oracle" />
	<property name="add.schema" value="" dbms="postgresql" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PLFAVANSEQC.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()" dbms="postgresql" />
	
	<changeSet id="01" author="Irfan">
	<addColumn tableName="finserviceinstruction">
		<column name="InstructionUID" type="bigint"/>	
	</addColumn>
	<addColumn tableName="finserviceinstruction_temp">
		<column name="InstructionUID" type="bigint"/>	
	</addColumn>
	</changeSet>
	<changeSet id="02" author="Irfan">
		<createSequence sequenceName="SeqFinInstructionUID" startValue="1" maxValue="9223372036854775807" incrementBy="1" cycle="false" />
	</changeSet>
	<changeSet id="03" author="Irfan">
		<sql>
			Update finserviceinstruction set InstructionUID=0 where InstructionUID is null;
			Update finserviceinstruction_temp set InstructionUID=0 where InstructionUID is null;
		</sql>
	</changeSet>
	<changeSet id="04" author="Irfan">
	<addColumn tableName="documentdetails">
		<column name="InstructionUID" type="bigint"/>	
	</addColumn>
	<addColumn tableName="documentdetails_temp">
		<column name="InstructionUID" type="bigint"/>	
	</addColumn>
	<addColumn tableName="documentdetails_pa">
		<column name="InstructionUID" type="bigint"/>	
	</addColumn>
	</changeSet>
	<changeSet id="05" author="Irfan">
		<sql>
			Update documentdetails set InstructionUID=0 where InstructionUID is null;
			Update documentdetails_temp set InstructionUID=0 where InstructionUID is null;
		</sql>
	</changeSet>
	<changeSet id="06_Pre" author="Jayant">
         	<sql>
         		select deps_save_and_drop_dependencies('plf','documentdetails_view');
         	</sql>
         </changeSet>
	<changeSet id="06" author="Irfan">
		<createView viewName="documentdetails_view" replaceIfExists="true">
			 SELECT t1.docid,
    t1.docmodule,
    t1.doccategory,
    t1.doctype,
    t1.docname,
    t1.docimage,
    t1.finevent,
    t1.version,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t1.referenceid,
    t1.docrefid,
    t1.docpurpose,
    t1.docuri,
    t1.docreceiveddate,
    t1.docreceived,
    t1.InstructionUID
   FROM documentdetails_temp t1
UNION ALL
 SELECT t1.docid,
    t1.docmodule,
    t1.doccategory,
    t1.doctype,
    t1.docname,
    t1.docimage,
    t1.finevent,
    t1.version,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t1.referenceid,
    t1.docrefid,
    t1.docpurpose,
    t1.docuri,
    t1.docreceiveddate,
    t1.docreceived,
     t1.InstructionUID
   FROM documentdetails t1
  WHERE NOT (EXISTS ( SELECT 1
           FROM documentdetails_temp
          WHERE documentdetails_temp.docid = t1.docid));
		</createView>
	</changeSet>
	<changeSet id="06_Post" author="Jayant">
         	<sql>
         		select deps_restore_dependencies('plf','documentdetails_view');
         	</sql>
         </changeSet>
	<changeSet id="07" author="Irfan">
		<createView viewName="documentdetails_tview" replaceIfExists="true">
		 SELECT t1.docid,
    t1.docmodule,
    t1.doccategory,
    t1.doctype,
    t1.docname,
    t1.docimage,
    t1.finevent,
    t1.version,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t1.referenceid,
    t1.docrefid,
    t1.docpurpose,
    t1.docuri,
    t1.docreceiveddate,
    t1.docreceived,
    t1.InstructionUID
   FROM documentdetails_temp t1;
		</createView>
	</changeSet>
	<changeSet id="08" author="Irfan">
	<addColumn tableName="FinanceCheckListRef">
		<column name="InstructionUID" type="bigint"/>	
	</addColumn>
	<addColumn tableName="FinanceCheckListRef_Temp">
		<column name="InstructionUID" type="bigint"/>	
	</addColumn>
	</changeSet>
	<changeSet id="09" author="Irfan">
		<sql>
			Update FinanceCheckListRef set InstructionUID=0 where InstructionUID is null;
			Update FinanceCheckListRef_Temp set InstructionUID=0 where InstructionUID is null;
		</sql>
	</changeSet>
	<changeSet id="10" author="Irfan">
		<createView viewName="FinanceCheckListRef_View" replaceIfExists="true">
			 SELECT t1.finreference,
    t1.questionid,
    t1.answer,
    t1.remarks,
    t1.version,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t2.checklistdesc AS lovdescquesdesc,
    t3.ansdesc AS lovdescanswerdesc,
    t1.InstructionUID
   FROM financechecklistref_temp t1
     JOIN bmtchecklist t2 ON t1.questionid = t2.checklistid
     JOIN rmtchecklistdetails t3 ON t1.questionid = t3.checklistid AND t1.answer = t3.ansseqno;
		</createView>
	</changeSet>
	<changeSet id="11" author="Irfan">
		<createView viewName="FinanceCheckListRef_Aview" replaceIfExists="true">
			 SELECT t1.finreference,
    t1.questionid,
    t1.answer,
    t1.remarks,
    t1.version,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t2.checklistdesc AS lovdescquesdesc,
    t3.ansdesc AS lovdescanswerdesc,
    t1.InstructionUID
   FROM financechecklistref t1
     JOIN bmtchecklist t2 ON t1.questionid = t2.checklistid
     JOIN rmtchecklistdetails t3 ON t1.questionid = t3.checklistid AND t1.answer = t3.ansseqno;
		</createView>
	</changeSet>
	<changeSet id="12" author="Irfan">
	<addColumn tableName="FinDisbursementDetails">
		<column name="InstructionUID" type="bigint"/>	
	</addColumn>
	<addColumn tableName="FinDisbursementDetails_Temp">
		<column name="InstructionUID" type="bigint"/>	
	</addColumn>
	</changeSet>
	<changeSet id="13" author="Irfan">
		<sql>
			Update FinDisbursementDetails set InstructionUID=0 where InstructionUID is null;
			Update FinDisbursementDetails_Temp set InstructionUID=0 where InstructionUID is null;
		</sql>
	</changeSet>
	<changeSet id="14" author="Irfan">
		<createView viewName="findisbursementdetails_view" replaceIfExists="true">
		 SELECT t1.finreference,
    t1.disbdate,
    t1.disbseq,
    t1.disbdesc,
    t1.disbaccountid,
    t1.disbamount,
    t1.disbreqdate,
    t1.disbdisbursed,
    t1.disbisactive,
    t1.disbremarks,
    t1.version,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t1.feechargeamt,
    t1.disbstatus,
    t1.disbtype,
    t1.disbclaim,
    t1.disbexptype,
    t1.disbretperc,
    t1.disbretamount,
    t1.autodisb,
    t1.netadvdue,
    t1.netretdue,
    t1.disbretpaid,
    t1.retpaiddate,
    t2.expencetypename AS lovdescdisbexptype,
    t1.consultfeefrq,
    t1.consultfeestartdate,
    t1.consultfeeenddate,
    t1.contractorid,
    t1.insuranceamt,
    t1.InstructionUID
   FROM findisbursementdetails_temp t1
     LEFT JOIN amtexpensetype t2 ON t2.expencetypeid = t1.disbexptype
UNION ALL
 SELECT t1.finreference,
    t1.disbdate,
    t1.disbseq,
    t1.disbdesc,
    t1.disbaccountid,
    t1.disbamount,
    t1.disbreqdate,
    t1.disbdisbursed,
    t1.disbisactive,
    t1.disbremarks,
    t1.version,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t1.feechargeamt,
    t1.disbstatus,
    t1.disbtype,
    t1.disbclaim,
    t1.disbexptype,
    t1.disbretperc,
    t1.disbretamount,
    t1.autodisb,
    t1.netadvdue,
    t1.netretdue,
    t1.disbretpaid,
    t1.retpaiddate,
    t2.expencetypename AS lovdescdisbexptype,
    t1.consultfeefrq,
    t1.consultfeestartdate,
    t1.consultfeeenddate,
    t1.contractorid,
    t1.insuranceamt,
    t1.InstructionUID
   FROM findisbursementdetails t1
     LEFT JOIN amtexpensetype t2 ON t2.expencetypeid = t1.disbexptype
  WHERE NOT (EXISTS ( SELECT 1
           FROM findisbursementdetails_temp
          WHERE findisbursementdetails_temp.finreference = t1.finreference));
		</createView>
	</changeSet>
	<changeSet id="15" author="Irfan">
		<createView viewName="findisbursementdetails_tview" replaceIfExists="true">
		 SELECT t1.finreference,
    t1.disbdate,
    t1.disbseq,
    t1.disbdesc,
    t1.disbaccountid,
    t1.disbamount,
    t1.disbreqdate,
    t1.disbdisbursed,
    t1.disbisactive,
    t1.disbremarks,
    t1.version,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t1.feechargeamt,
    t1.disbstatus,
    t1.disbtype,
    t1.disbclaim,
    t1.disbexptype,
    t1.disbretperc,
    t1.disbretamount,
    t1.autodisb,
    t1.netadvdue,
    t1.netretdue,
    t1.disbretpaid,
    t1.retpaiddate,
    t2.expencetypename AS lovdescdisbexptype,
    t1.consultfeefrq,
    t1.consultfeestartdate,
    t1.consultfeeenddate,
    t1.contractorid,
    t1.insuranceamt,
    t1.InstructionUID
   FROM findisbursementdetails_temp t1
     LEFT JOIN amtexpensetype t2 ON t2.expencetypeid = t1.disbexptype;
		</createView>
	</changeSet>
	<changeSet id="16" author="Irfan">
		<createView viewName="findisbursementdetails_aview" replaceIfExists="true">
			 SELECT t1.finreference,
    t1.disbdate,
    t1.disbseq,
    t1.disbdesc,
    t1.disbaccountid,
    t1.disbamount,
    t1.disbreqdate,
    t1.disbdisbursed,
    t1.disbisactive,
    t1.disbremarks,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t1.feechargeamt,
    t1.version,
    t1.disbstatus,
    t1.disbtype,
    t1.disbclaim,
    t1.disbexptype,
    t1.disbretperc,
    t1.disbretamount,
    t1.autodisb,
    t1.netadvdue,
    t1.netretdue,
    t1.disbretpaid,
    t1.retpaiddate,
    t2.expencetypename AS lovdescdisbexptype,
    t1.consultfeefrq,
    t1.consultfeestartdate,
    t1.consultfeeenddate,
    t1.contractorid,
    t1.insuranceamt,
    t1.InstructionUID
   FROM findisbursementdetails t1
     LEFT JOIN amtexpensetype t2 ON t2.expencetypeid = t1.disbexptype;
		</createView>
	</changeSet>
	<changeSet id="17" author="Irfan">
	<addColumn tableName="RejectDocumentDetails">
		<column name="InstructionUID" type="bigint"/>	
	</addColumn>
	</changeSet>
	<changeSet id="18" author="Irfan">
		<sql>
			Update RejectDocumentDetails set InstructionUID=0 where InstructionUID is null;
		</sql>
	</changeSet>
	<changeSet id="19" author="Irfan">
	<addColumn tableName="REJECTFINDISBURSEMENTDETAILS">
		<column name="InstructionUID" type="bigint"/>	
	</addColumn>
	</changeSet>
	<changeSet id="20" author="Irfan">
		<sql>
			Update REJECTFINDISBURSEMENTDETAILS set InstructionUID=0 where InstructionUID is null;
		</sql>
	</changeSet>
	<changeSet id="21" author="Irfan">
	<addColumn tableName="LOAN_PO_ORG_ED_Temp">
		<column name="InstructionUID" type="bigint" defaultValue="0"/>	
	</addColumn>
		</changeSet>

	<changeSet id="22" author="Irfan">
		<sql>
			Update LOAN_PO_ORG_ED_Temp set InstructionUID=0 where InstructionUID is null;
		</sql>
	</changeSet>
	<changeSet id="23" author="Irfan">
	<addColumn tableName="LOAN_PO_ORG_ED">
		<column name="InstructionUID" type="bigint" defaultValue="0"/>	
	</addColumn>
		</changeSet>

	<changeSet id="24" author="Irfan">
		<sql>
			Update LOAN_PO_ORG_ED_Temp set InstructionUID=0 where InstructionUID is null;
		</sql>
	</changeSet>
	<changeSet id="25" author="Irfan">
		<sql>
			Update LOAN_PO_ORG_ED set InstructionUID=0 where InstructionUID is null;
		</sql>
	</changeSet>
	<changeSet id="26_Pre" author="Jayant">
         	<sql>
         		select deps_save_and_drop_dependencies('plf','documentdetails_view');
         	</sql>
         </changeSet>
	<changeSet id="26" author="Irfan">
		<createView viewName="documentdetails_view" replaceIfExists="true">
			 SELECT t1.docid,
    t1.docmodule,
    t1.doccategory,
    t1.doctype,
    t1.docname,
    t1.docimage,
    t1.finevent,
    t1.version,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t1.referenceid,
    t1.docrefid,
    t1.docpurpose,
    t1.docuri,
    t1.docreceiveddate,
    t1.docreceived,
    t1.docoriginal,
    t1.InstructionUID
   FROM documentdetails_temp t1
UNION ALL
 SELECT t1.docid,
    t1.docmodule,
    t1.doccategory,
    t1.doctype,
    t1.docname,
    t1.docimage,
    t1.finevent,
    t1.version,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t1.referenceid,
    t1.docrefid,
    t1.docpurpose,
    t1.docuri,
    t1.docreceiveddate,
    t1.docreceived,
    t1.docoriginal,
    t1.InstructionUID
   FROM documentdetails t1
  WHERE NOT (EXISTS ( SELECT 1
           FROM documentdetails_temp
          WHERE documentdetails_temp.docid = t1.docid));
		</createView>
	</changeSet>
	<changeSet id="26_Post" author="Jayant">
         	<sql>
         		select deps_restore_dependencies('plf','documentdetails_view');
         	</sql>
         </changeSet>
	<changeSet id="27" author="Irfan">
		<createView viewName="documentdetails_tview" replaceIfExists="true">
		 SELECT t1.docid,
    t1.docmodule,
    t1.doccategory,
    t1.doctype,
    t1.docname,
    t1.docimage,
    t1.finevent,
    t1.version,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t1.referenceid,
    t1.docrefid,
    t1.docpurpose,
    t1.docuri,
    t1.docreceiveddate,
    t1.docreceived,
    t1.docoriginal,
    t1.InstructionUID
   FROM documentdetails_temp t1;
		</createView>
	</changeSet>
	<changeSet id="28" author="Irfan">
	<addColumn tableName="loan_pl_org_ed_Temp">
		<column name="InstructionUID" type="bigint" defaultValue="0"/>	
	</addColumn>
		</changeSet>

	<changeSet id="29" author="Irfan">
		<sql>
			Update loan_pl_org_ed_Temp set InstructionUID=0 where InstructionUID is null;
		</sql>
	</changeSet>
	<changeSet id="30" author="Irfan">
	<addColumn tableName="loan_pl_org_ed">
		<column name="InstructionUID" type="bigint" defaultValue="0"/>	
	</addColumn>
		</changeSet>

	<changeSet id="31" author="Irfan">
		<sql>
			Update loan_pl_org_ed set InstructionUID=0 where InstructionUID is null;
		</sql>
	</changeSet>
	<changeSet id="32" author="Irfan">
	<addColumn tableName="loan_ublprd1_org_ed_Temp">
		<column name="InstructionUID" type="bigint" defaultValue="0"/>	
	</addColumn>
		</changeSet>

	<changeSet id="33" author="Irfan">
		<sql>
			Update loan_ublprd1_org_ed_Temp set InstructionUID=0 where InstructionUID is null;
		</sql>
	</changeSet>
	<changeSet id="34" author="Irfan">
	<addColumn tableName="loan_ublprd1_org_ed">
		<column name="InstructionUID" type="bigint" defaultValue="0"/>	
	</addColumn>
		</changeSet>

	<changeSet id="35" author="Irfan">
		<sql>
			Update loan_ublprd1_org_ed set InstructionUID=0 where InstructionUID is null;
		</sql>
	</changeSet>
	<changeSet id="36" author="Irfan">
	<addColumn tableName="loan_usl_org_ed_Temp">
		<column name="InstructionUID" type="bigint" defaultValue="0"/>	
	</addColumn>
		</changeSet>

	<changeSet id="37" author="Irfan">
		<sql>
			Update loan_usl_org_ed_Temp set InstructionUID=0 where InstructionUID is null;
		</sql>
	</changeSet>
	<changeSet id="38" author="Irfan">
	<addColumn tableName="loan_usl_org_ed">
		<column name="InstructionUID" type="bigint" defaultValue="0"/>	
	</addColumn>
		</changeSet>

	<changeSet id="39" author="Irfan">
		<sql>
			Update loan_usl_org_ed set InstructionUID=0 where InstructionUID is null;
		</sql>
	</changeSet>
	<changeSet id="40" author="Irfan">
		<addColumn tableName="FinDisbursementDetails_Log">
		<column name="InstructionUID" type="bigint" defaultValue="0"/>	
	</addColumn>
	</changeSet>
	<changeSet id="41" author="Irfan">
		<sql>
			Update FinDisbursementDetails_Log set InstructionUID=0 where InstructionUID is null;
		</sql>
	</changeSet>
	</databaseChangeLog>