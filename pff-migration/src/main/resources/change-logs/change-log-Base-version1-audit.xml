<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />
	<property name="call.adtdate" value="CONVERT(varchar(20), TH.AuditDate, 106)" dbms="mssql" />
	<property name="call.adtdate" value="to_char(TH.AuditDate, 'DD-MON-YYYY')" dbms="oracle" />
	<property name="call.adtdate" value="to_char(TH.AuditDate, 'DD-MON-YYYY')" dbms="postgresql" />
	<property name="call.adttime" value="CONVERT(varchar(35), TH.AuditDate, 108)" dbms="mssql" />
	<property name="call.adttime" value="to_char( TH.AuditDate, 'HH24:MI:SS')" dbms="oracle" />
	<property name="call.adttime" value="to_char( TH.AuditDate, 'HH24:MI:SS')" dbms="postgresql" />
	

	<changeSet id="pre_run_for_pgp" author="Jayant" runAlways="true"
		dbms="postgresql">
		<sql>
			Set search_path = plfaudit,plf,public,pg_catalog;
		</sql>
	</changeSet>

	<changeSet id="1" author="Prakash">
		<addColumn tableName="ADTFinJointAccountDetails">
			<column name="AuthoritySignatory" type="Boolean" />
			<column name="Sequence" type="Number(10,0)" />
		</addColumn>
	</changeSet>

	<changeSet id="2" author="Amit">
		<addColumn tableName="ADTBMTDOCUMENTTYPES">
			<column name="DocIsPdfExtRequired" type="boolean" />
			<column name="DocIsPasswordProtected" type="boolean" />
			<column name="PdfMappingRef" type="NUMBER(19,0)" />
		</addColumn>
	</changeSet>
	 <changeSet id="3" author="Surekha">
     	<dropColumn tableName="AdtRMTLovFieldDetail" columnName="CatOfcoApplicant"/>
     </changeSet>
<changeSet id="3" author="Amit">
     <addColumn tableName="adtCustomerDocuments">
     	<column name="PdfPassWord" type="nvarchar(200)"/>
     </addColumn>
    </changeSet>
    
    <changeSet id="5" author="Ganesh.p">
     <addColumn tableName="ADTCustomers">
     	<column name="CustsourceId" type="nvarchar(10)"/>
     </addColumn>
    </changeSet>
    <changeSet id="6" author="Jayant">
		<createTable tableName="AdtReasonTypes">
		<column name="AuditId" type="bigint">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="AuditDate" type="datetime">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="AuditSeq" type="int">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="AuditImage" type="varchar(2)">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="Id" type="BIGINT" >
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="Code" type="VARCHAR(8)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="Description" type="VARCHAR(50)"/>
			<column name="Version" type="INT">
				<constraints nullable="false"/>
			</column>
			<column name="LastMntBy" type="BIGINT"/>
			<column name="LastMntOn" type="DATETIME"/>
			<column name="RecordStatus" type="VARCHAR(50)"/>
			<column name="RoleCode" type="VARCHAR(100)"/>
			<column name="NextRoleCode" type="VARCHAR(200)"/>
			<column name="TaskId" type="VARCHAR(50)"/>
			<column name="NextTaskId" type="VARCHAR(200)"/>
			<column name="RecordType" type="VARCHAR(50)"/>
			<column name="WorkFlowId" type="BIGINT"/>
		</createTable>
	</changeSet>
	<changeSet id="7" author="Jayant">
		<createTable tableName="AdtReasonCategory">
		<column name="AuditId" type="bigint">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="AuditDate" type="datetime">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="AuditSeq" type="int">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="AuditImage" type="varchar(2)">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="Id" type="BIGINT" >
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="Code" type="VARCHAR(8)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="Description" type="VARCHAR(50)"/>
			<column name="Version" type="INT">
				<constraints nullable="false"/>
			</column>
			<column name="LastMntBy" type="BIGINT"/>
			<column name="LastMntOn" type="DATETIME"/>
			<column name="RecordStatus" type="VARCHAR(50)"/>
			<column name="RoleCode" type="VARCHAR(100)"/>
			<column name="NextRoleCode" type="VARCHAR(200)"/>
			<column name="TaskId" type="VARCHAR(50)"/>
			<column name="NextTaskId" type="VARCHAR(200)"/>
			<column name="RecordType" type="VARCHAR(50)"/>
			<column name="WorkFlowId" type="BIGINT"/>
		</createTable>
	</changeSet>
	<changeSet id="8" author="Jayant">
		<createTable tableName="AdtReasons">
			<column name="AuditId" type="bigint">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="AuditDate" type="datetime">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="AuditSeq" type="int">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="AuditImage" type="varchar(2)">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="Id" type="BIGINT" >
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="ReasonTypeId" type="BIGINT">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="ReasonCategoryId" type="BIGINT">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="Code" type="VARCHAR(8)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="Description" type="VARCHAR(50)"/>
			<column name="Active" type="BOOLEAN">
				<constraints nullable="false"/>
			</column>
			<column name="Version" type="INT">
				<constraints nullable="false"/>
			</column>
			<column name="LastMntBy" type="BIGINT"/>
			<column name="LastMntOn" type="DATETIME"/>
			<column name="RecordStatus" type="VARCHAR(50)"/>
			<column name="RoleCode" type="VARCHAR(100)"/>
			<column name="NextRoleCode" type="VARCHAR(200)"/>
			<column name="TaskId" type="VARCHAR(50)"/>
			<column name="NextTaskId" type="VARCHAR(200)"/>
			<column name="RecordType" type="VARCHAR(50)"/>
			<column name="WorkFlowId" type="BIGINT"/>
		</createTable>
	</changeSet>
	<changeSet id="10" author="Haritha">
		<createView viewName="AdtReasonCategory_View"
			replaceIfExists="true">
    <![CDATA[SELECT     TH.AuditId, TH.AuditDate AS AuditDateTime, ${call.adtdate} AuditDate, ${call.adttime} AuditTime, COALESCE(AFT.AuditSeq, BEF.AuditSeq) AS AuditSeq, TH.AuditUsrId, T1.UsrFName${call.concatenate}T1.UsrMName${call.concatenate}T1.UsrLName  AS AuditUserName,TH.AuditTranType AS AuditTranType, 
                      Aft.Id as AftId, Aft.Code as AftCode, Aft.Description as AftDescription, 
                      Bef.Id as BefId, Bef.Code as BefCode, Bef.Description as BefDescription 
			FROM      AuditHeader AS TH INNER JOIN
                      SecUsers_View AS T1 ON TH.AuditUsrId = T1.UsrID LEFT OUTER JOIN
                      ADTReasonCategory AS AFT ON  TH.AuditId = AFT.AuditId AND TH.AuditDate = AFT.AuditDate AND AFT.AuditImage = 'A' FULL OUTER JOIN
                      ADTReasonCategory AS BEF ON  TH.AuditId = BEF.AuditId AND TH.AuditDate = BEF.AuditDate AND BEF.AuditImage = 'B'
			WHERE     (TH.AuditTranType <> 'W') AND (TH.AuditModule = 'ReasonCategory')]]>
    
    </createView>
	</changeSet>

	<changeSet id="11" author="Haritha">
		<createView viewName="AdtReasonTypes_View" replaceIfExists="true">
   <![CDATA[ SELECT     TH.AuditId, TH.AuditDate AS AuditDateTime, ${call.adtdate} AuditDate, ${call.adttime} AuditTime, COALESCE(AFT.AuditSeq, BEF.AuditSeq) AS AuditSeq, TH.AuditUsrId, T1.UsrFName${call.concatenate}T1.UsrMName${call.concatenate}T1.UsrLName  AS AuditUserName,TH.AuditTranType AS AuditTranType, 
                      Aft.Id as AftId, Aft.Code as AftCode, Aft.Description as AftDescription, 
                      Bef.Id as BefId, Bef.Code as BefCode, Bef.Description as BefDescription 
			FROM      AuditHeader AS TH INNER JOIN
                      SecUsers_View AS T1 ON TH.AuditUsrId = T1.UsrID LEFT OUTER JOIN
                      ADTReasonTypes AS AFT ON  TH.AuditId = AFT.AuditId AND TH.AuditDate = AFT.AuditDate AND AFT.AuditImage = 'A' FULL OUTER JOIN
                      ADTReasonTypes AS BEF ON  TH.AuditId = BEF.AuditId AND TH.AuditDate = BEF.AuditDate AND BEF.AuditImage = 'B'
WHERE     (TH.AuditTranType <> 'W') AND (TH.AuditModule = 'ReasonTypes')]]>
    
    </createView>
	</changeSet>
    
    <changeSet id="12" author="Haritha">
	<createView viewName="AdtReasons_View" replaceIfExists="true">
    <![CDATA[SELECT     TH.AuditId, TH.AuditDate AS AuditDateTime, ${call.adtdate} AuditDate, ${call.adttime} AuditTime, COALESCE(AFT.AuditSeq, BEF.AuditSeq) AS AuditSeq, TH.AuditUsrId,T1.UsrFName${call.concatenate}T1.UsrMName${call.concatenate}T1.UsrLName AS AuditUserName,TH.AuditTranType AS AuditTranType, 
                      Aft.Id as AftId, Aft.ReasonTypeID as AftReasonTypeID, Aft.ReasonCategoryID as AftReasonCategoryID, Aft.Code as AftCode, Aft.Description as AftDescription, Aft.Active as AftActive, 
                      Bef.Id as BefId, Bef.ReasonTypeID as BefReasonTypeID, Bef.ReasonCategoryID as BefReasonCategoryID, Bef.Code as BefCode, Bef.Description as BefDescription, Bef.Active as BefActive 
				FROM  AuditHeader AS TH INNER JOIN
                      SecUsers_View AS T1 ON TH.AuditUsrId = T1.UsrID LEFT OUTER JOIN
                      ADTReasons AS AFT ON  TH.AuditId = AFT.AuditId AND TH.AuditDate = AFT.AuditDate AND AFT.AuditImage = 'A' FULL OUTER JOIN
                      ADTReasons AS BEF ON  TH.AuditId = BEF.AuditId AND TH.AuditDate = BEF.AuditDate AND BEF.AuditImage = 'B'
				WHERE     (TH.AuditTranType <> 'W') AND (TH.AuditModule = 'ReasonCode')]]>
    </createView>
</changeSet>
	<changeSet id="13" author="Jayant">
		<dropPrimaryKey tableName="AdtReasonCategory" constraintName="pk_adtreasoncategory"/>
	</changeSet>
	<changeSet id="14" author="Jayant">
		<dropPrimaryKey tableName="AdtReasonTypes" constraintName="pk_adtreasontypes"/>
	</changeSet>
	<changeSet id="15" author="Jayant">
		<dropPrimaryKey tableName="AdtReasons" constraintName="pk_adtreasons"/>
	</changeSet>
	<changeSet id="16" author="Jayant">
		<addPrimaryKey tableName="AdtReasonCategory" columnNames="auditid,auditdate,auditseq,auditimage" constraintName="pk_adtreasoncategory"/>
	</changeSet>
	<changeSet id="17" author="Jayant">
		<addPrimaryKey tableName="AdtReasonTypes" columnNames="auditid,auditdate,auditseq,auditimage" constraintName="pk_adtreasontypes"/>
	</changeSet>
	<changeSet id="18" author="Jayant">
		<addPrimaryKey tableName="AdtReasons" columnNames="auditid,auditdate,auditseq,auditimage" constraintName="pk_adtreasons"/>
	</changeSet>
</databaseChangeLog>
