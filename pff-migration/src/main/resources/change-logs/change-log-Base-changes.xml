<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />
	
<!-- <changeSet id="1" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_SystemMaster');		
            delete from secrights where rightname='menuCat_SystemMaster';
		</sql>
</changeSet>
<changeSet id="2" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_ApplicationMaster');		
            delete from secrights where rightname='menuCat_ApplicationMaster';
		</sql>
</changeSet>
<changeSet id="3" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_CustomerMasters');		
            delete from secrights where rightname='menuCat_CustomerMasters';
		</sql>
</changeSet>
<changeSet id="4" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_eod');		
            delete from secrights where rightname='menuCat_eod';
		</sql>
</changeSet>
<changeSet id="5" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_Mandates');		
            delete from secrights where rightname='menuCat_Mandates';
		</sql>
</changeSet>
<changeSet id="6" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_Disbursement');		
            delete from secrights where rightname='menuCat_Disbursement';
		</sql>
</changeSet>
<changeSet id="7" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_SAPGL');		
            delete from secrights where rightname='menuCat_SAPGL';
		</sql>
</changeSet>
<changeSet id="8" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menu_Category_CIBIL');		
            delete from secrights where rightname='menu_Category_CIBIL';
		</sql>
</changeSet>
<changeSet id="9" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_RulesFactory');		
            delete from secrights where rightname='menuCat_RulesFactory';
		</sql>
</changeSet>
<changeSet id="10" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_SolutionFactory');		
            delete from secrights where rightname='menuCat_SolutionFactory';
		</sql>
</changeSet>
<changeSet id="11" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_Finance');		
            delete from secrights where rightname='menuCat_Finance';
		</sql>
</changeSet>
<changeSet id="12" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_Administration');		
            delete from secrights where rightname='menuCat_Administration';
		</sql>
</changeSet>
<changeSet id="13" author="Prakash">
		<sql>
            delete from secrights where rightname='menuCat_StaticParms';
		</sql>
</changeSet>
<changeSet id="14" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_FinanceManagement');		
            delete from secrights where rightname='menuCat_FinanceManagement';
		</sql>
</changeSet>
<changeSet id="15" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_FinanceEnquiry');		
            delete from secrights where rightname='menuCat_FinanceEnquiry';
		</sql>
</changeSet>
<changeSet id="16" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_CustomerEnquiry');		
            delete from secrights where rightname='menuCat_CustomerEnquiry';
		</sql>
</changeSet>
<changeSet id="17" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_Reports');		
            delete from secrights where rightname='menuCat_Reports';
		</sql>
</changeSet>
<changeSet id="18" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_CustomerTemplates');		
            delete from secrights where rightname='menuCat_CustomerTemplates';
		</sql>
</changeSet>
<changeSet id="19" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_CreditReports');		
            delete from secrights where rightname='menuCat_CreditReports';
		</sql>
</changeSet>
<changeSet id="20" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_DelinquencyReports');		
            delete from secrights where rightname='menuCat_DelinquencyReports';
		</sql>
</changeSet>
<changeSet id="21" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_FinReports');		
            delete from secrights where rightname='menuCat_FinReports';
		</sql>
</changeSet>
<changeSet id="22" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_FinDeptReports');		
            delete from secrights where rightname='menuCat_FinDeptReports';
		</sql>
</changeSet>
<changeSet id="23" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_Limit');		
            delete from secrights where rightname='menuCat_Limit';
		</sql>
</changeSet>
<changeSet id="24" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_LimitEnquiry');		
            delete from secrights where rightname='menuCat_LimitEnquiry';
		</sql>
</changeSet>
<changeSet id="25" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_PresentmentDetails');		
            delete from secrights where rightname='menuCat_PresentmentDetails';
		</sql>
</changeSet>
<changeSet id="26" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_payment_PaymentInstructions');		
            delete from secrights where rightname='menuCat_payment_PaymentInstructions';
		</sql>
</changeSet>
<changeSet id="27" author="Prakash">
		<sql>
            delete from SecGroupRights where rightid in (select rightid from secrights where rightname ='menuCat_DashBoard');		
            delete from secrights where rightname='menuCat_DashBoard';
		</sql>
</changeSet> -->

<changeSet id="28" author="Amit">
	<addColumn tableName="BMTDocumentTypes">
		<column name="IsPdfExtRequired" type="boolean" />
		<column name="IsPasswordProtected" type="boolean" />
		<column name="MappingRef" type="NUMBER(19,0)" />
	</addColumn>
	<addColumn tableName="BMTDocumentTypes_temp">
		<column name="IsPdfExtRequired" type="boolean" />
		<column name="IsPasswordProtected" type="boolean" />
		<column name="MappingRef" type="NUMBER(19,0)" />
	</addColumn>
</changeSet>

	<changeSet id="29" author="amit">
		<renameColumn newColumnName="DocIsPdfExtRequired"
			oldColumnName="IsPdfExtRequired" tableName="BMTDocumentTypes" />
		<renameColumn newColumnName="DocIsPasswordProtected"
			oldColumnName="IsPasswordProtected" tableName="BMTDocumentTypes" />
		<renameColumn newColumnName="PdfMappingRef"
			oldColumnName="MappingRef" tableName="BMTDocumentTypes" />

		<renameColumn newColumnName="DocIsPdfExtRequired"
			oldColumnName="IsPdfExtRequired" tableName="BMTDocumentTypes_Temp" />
		<renameColumn newColumnName="DocIsPasswordProtected"
			oldColumnName="IsPasswordProtected" tableName="BMTDocumentTypes_Temp" />
		<renameColumn newColumnName="PdfMappingRef"
			oldColumnName="MappingRef" tableName="BMTDocumentTypes_Temp" />
	</changeSet>
  
  <changeSet id="30" author="Amit" >
	<createView viewName="BMTDocumentTypes_View" replaceIfExists="true">
		  	SELECT DocTypeCode ,
           DocTypeDesc ,
           DocIsMandatory ,
           DocTypeIsActive ,
           DocIsCustDoc ,
           Version ,
           LastMntBy ,
           LastMntOn ,
           RecordStatus ,
           RoleCode ,
           NextRoleCode ,
           TaskId ,
           NextTaskId ,
           RecordType ,
           WorkflowId ,
           DocExpDateIsMand ,
           DocIssueDateMand ,
           DocIdNumMand ,
           DocIssuedAuthorityMand,
           DocIsPdfExtRequired,
           DocIsPasswordProtected,
           PdfMappingRef 
     FROM BMTDocumentTypes_Temp 
   UNION ALL 
   SELECT DocTypeCode ,
           DocTypeDesc ,
           DocIsMandatory ,
           DocTypeIsActive ,
           DocIsCustDoc ,
           Version ,
           LastMntBy ,
           LastMntOn ,
           RecordStatus ,
           RoleCode ,
           NextRoleCode ,
           TaskId ,
           NextTaskId ,
           RecordType ,
           WorkflowId ,
           DocExpDateIsMand ,
           DocIssueDateMand ,
           DocIdNumMand ,
           DocIssuedAuthorityMand,
           DocIsPdfExtRequired,
           DocIsPasswordProtected,
           PdfMappingRef  
     FROM BMTDocumentTypes 
     WHERE NOT EXISTS ( SELECT 1 
                        FROM BMTDocumentTypes_Temp 
                          WHERE DocTypeCode = BMTDocumentTypes.DocTypeCode )
	</createView>
</changeSet>
  
  <changeSet id="31" author="Amit" >
	<createView viewName="BMTDOCUMENTTYPES_AVIEW" replaceIfExists="true">
		  	SELECT DocTypeCode ,
          DocTypeDesc ,
          DocIsMandatory ,
          DocTypeIsActive ,
          DocIsCustDoc ,
          Version ,
          LastMntBy ,
          LastMntOn ,
          RecordStatus ,
          RoleCode ,
          NextRoleCode ,
          TaskId ,
          NextTaskId ,
          RecordType ,
          WorkflowId ,
          DocExpDateIsMand ,
          DocIssueDateMand ,
          DocIdNumMand ,
          DocIssuedAuthorityMand,
           DocIsPdfExtRequired,
           DocIsPasswordProtected,
           PdfMappingRef   
     FROM BMTDocumentTypes
	</createView>
</changeSet>

<changeSet id="32" author="Amit">
		<sql>		
	Update BMTDOCUMENTTYPES set DOCISPDFEXTREQUIRED=0 , DOCISPASSWORDPROTECTED=0 , PDFMAPPINGREF=0;
	Update BMTDOCUMENTTYPES_Temp set DOCISPDFEXTREQUIRED=0 , DOCISPASSWORDPROTECTED=0 , PDFMAPPINGREF=0;
		</sql>
	</changeSet>
	
	<changeSet id="33" author="Amit">
	<sql>
		INSERT INTO SecRights SELECT (select (SeqNo+1) from
		SeqSecRights),3,'DocumentTypeDialog_mappingRef','DocumentTypeDialog',0,1000,sysdate,'Approved','
		',' ',' ',' ',' ',0 FROM SeqSecRights WHERE 0=0;

		Update SeqSecRights set seqno = (select max(rightid)+1 from SecRights);

		INSERT INTO SecGroupRights SELECT (select (SeqNo+1) from
		SeqSecGroupRights ), (select GrpID from SecGroups where
		GrpCode ='DOCUMENTTYPE_MAKER'), (select RightID from SecRights WHERE
		RightName='DocumentTypeDialog_mappingRef'),1,0,10000,sysdate,'Approved','
		',' ',' ',' ',' ',0 FROM SeqSecGroupRights;

		Update SeqSecGroupRights set seqno = (select max(grprightid)+1 from
		SecGroupRights);
	</sql>
</changeSet>


	<changeSet id="34" author="Amit">
		<sql>
			INSERT INTO SecRights SELECT (select (SeqNo+1) from
			SeqSecRights),3,'DocumentTypeDialog_docIsPasswordProtected','DocumentTypeDialog',0,1000,sysdate,'Approved','
			',' ',' ',' ',' ',0 FROM SeqSecRights WHERE 0=0;

			Update SeqSecRights set seqno = (select max(rightid)+1 from SecRights);

			INSERT INTO SecGroupRights SELECT (select (SeqNo+1) from
			SeqSecGroupRights ), (select GrpID from SecGroups where
			GrpCode ='DOCUMENTTYPE_MAKER'), (select RightID from SecRights WHERE
			RightName='DocumentTypeDialog_docIsPasswordProtected'),1,0,10000,sysdate,'Approved','
			',' ',' ',' ',' ',0 FROM SeqSecGroupRights;

			Update SeqSecGroupRights set seqno = (select max(grprightid)+1 from
			SecGroupRights);
		</sql>
	</changeSet>

	<changeSet id="35" author="Amit">
		<sql>
			INSERT INTO SecRights SELECT (select (SeqNo+1) from
			SeqSecRights),3,'DocumentTypeDialog_docIsPdfExtRequired','DocumentTypeDialog',0,1000,sysdate,'Approved','
			',' ',' ',' ',' ',0 FROM SeqSecRights WHERE 0=0;

			Update SeqSecRights set seqno = (select max(rightid)+1 from SecRights);

			INSERT INTO SecGroupRights SELECT (select (SeqNo+1) from
			SeqSecGroupRights ), (select GrpID from SecGroups where
			GrpCode ='DOCUMENTTYPE_MAKER'), (select RightID from SecRights WHERE
			RightName='DocumentTypeDialog_docIsPdfExtRequired'),1,0,10000,sysdate,'Approved','
			',' ',' ',' ',' ',0 FROM SeqSecGroupRights;

			Update SeqSecGroupRights set seqno = (select max(grprightid)+1 from
			SecGroupRights)
		</sql>
	</changeSet>
	
	<changeSet id="36" author="Amit" >
		<createTable tableName="DocumentDataConfig">
			<column name="Type" type="VARCHAR2(50)"/>
			<column name="Year" type="VARCHAR2(50)"/>
			<column name="Label" type="VARCHAR2(50)"/>
			<column name="LabelText" type="VARCHAR2(250)"/>
			<column name="LabelValueType" type="VARCHAR2(50)" />
			<column name="DefaultValue" type="VARCHAR2(50)"/>
			<column name="FormulaExecutionType" type="VARCHAR2(50)"/>
			<column name="IndexOf" type="VARCHAR2(50)"/>
			<column name="ExternalRef" type="VARCHAR2(250)" />
			<column name="MappingValue" type="NUMBER(19,0)" />
			<column name="IsActive" type="NUMBER(1,0)"  defaultValue="1"/>
			<column name="Formula" type="VARCHAR2(500)" />
		</createTable>
		
		<createTable tableName="DocumentDataMapping">
			<column name="MappingId" type="NUMBER(19,0)">
			<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="Type" type="VARCHAR2(50)"/>
		</createTable>
   </changeSet>

<changeSet id="37" author="Amit">
		<sql>		
	Insert into DOCUMENTDATACONFIG (TYPE,YEAR,LABEL,LABELTEXT,LABELVALUETYPE,DEFAULTVALUE,FORMULAEXECUTIONTYPE,INDEXOF,EXTERNALREF,MAPPINGVALUE,ISACTIVE,FORMULA) values ('ITR-4','2015-16','13','Repairs to machinery','int','-1','horizontal','0','repairsToMachinery',1,1,null);
	Insert into DOCUMENTDATACONFIG (TYPE,YEAR,LABEL,LABELTEXT,LABELVALUETYPE,DEFAULTVALUE,FORMULAEXECUTIONTYPE,INDEXOF,EXTERNALREF,MAPPINGVALUE,ISACTIVE,FORMULA) values ('ITR-4','2015-16',' ',' ','Double','-1',' ','0','totalIndirectExpenses',1,1,'rents+powerNFuel+repairsToMachinery');
	Insert into DOCUMENTDATACONFIG (TYPE,YEAR,LABEL,LABELTEXT,LABELVALUETYPE,DEFAULTVALUE,FORMULAEXECUTIONTYPE,INDEXOF,EXTERNALREF,MAPPINGVALUE,ISACTIVE,FORMULA) values ('ITR-4','2015-16','10','Power and fuel','int','-1','horizontal','0','powerNFuel',1,1,null);
	Insert into DOCUMENTDATACONFIG (TYPE,YEAR,LABEL,LABELTEXT,LABELVALUETYPE,DEFAULTVALUE,FORMULAEXECUTIONTYPE,INDEXOF,EXTERNALREF,MAPPINGVALUE,ISACTIVE,FORMULA) values ('ITR-4','2015-16','11','Rents','int','-1','horizontal','0','rents',1,1,null);
		</sql>
	</changeSet>
	
	<changeSet id="38" author="Amit">
		<sql>		
	Insert into PLFDEV.DOCUMENTDATAMAPPING (MAPPINGID,TYPE) values (1,'ITR4');
	Insert into PLFDEV.DOCUMENTDATAMAPPING (MAPPINGID,TYPE) values (2,'ITR5');
	Insert into PLFDEV.DOCUMENTDATAMAPPING (MAPPINGID,TYPE) values (3,'ST3');	
	</sql>
	</changeSet>

</databaseChangeLog>