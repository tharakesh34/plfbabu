<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />

	<changeSet id="pre_run_for_pgp" author="Jayant" runAlways="true"
		dbms="postgresql">
		<sql>
			Set search_path = plf,public,pg_catalog;
		</sql>
	</changeSet>

	<changeSet id="1" author="Satyanarayana.G">
		<sql>

UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
UPDATE SEQSECGROUPS SET SEQNO= (SELECT MAX(GRPID) FROM SECGROUPS);
UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS); 
UPDATE SEQSECROLEGROUPS SET SEQNO= (SELECT MAX(ROLEGRPID) FROM SECROLEGROUPS);	

INSERT INTO SECRIGHTS SELECT (SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 0, 'menuItem_CustomerEnquiry_CustomersEnquiry','MENU',1,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECRIGHTS WHERE 0=0; 
INSERT INTO SECGROUPS SELECT (SELECT MAX(GRPID)+1 FROM SECGROUPS), 'CustomersEnquiry_MAKER', 'Customers Enquiry Maker', 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECGROUPS WHERE 0=0;
INSERT INTO SECGROUPS SELECT (SELECT MAX(GRPID)+1 FROM SECGROUPS), 'CustomersEnquiry_APPROVER', 'Customers Enquiry Approver', 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECGROUPS WHERE 0=0;
INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CustomersEnquiry_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='menuItem_CustomerEnquiry_CustomersEnquiry'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CustomersEnquiry_APPROVER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='menuItem_CustomerEnquiry_CustomersEnquiry'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
INSERT INTO SecRoleGroups values((Select MAX(RoleGrpID)+1 From SecRoleGroups),(Select GrpId  From SecGroups Where GrpCode='CustomersEnquiry_MAKER'), (Select  RoleID  From SecRoles Where RoleCd='MSTGRP1_MAKER'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0); 
INSERT INTO SecRoleGroups values((Select MAX(RoleGrpID)+1 From SecRoleGroups),(Select GrpId  From SecGroups Where GrpCode='CustomersEnquiry_APPROVER'), (Select  RoleID  From SecRoles Where RoleCd='MSTGRP1_APPROVER'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0); 

UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
UPDATE SEQSECGROUPS SET SEQNO= (SELECT MAX(GRPID) FROM SECGROUPS);
UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS); 
UPDATE SEQSECROLEGROUPS SET SEQNO= (SELECT MAX(ROLEGRPID) FROM SECROLEGROUPS);	

</sql>
	</changeSet>
	<changeSet id="2" author="Satyanarayana.G">
		<addColumn tableName="Customers">
			<column name="CUSTCLASSIFICATION" type="nvarchar2(8)"/>
		</addColumn>
	</changeSet>
	<changeSet id="3" author="Satyanarayana.G">
		<addColumn tableName="Customers_Temp">
			<column name="CUSTCLASSIFICATION" type="nvarchar2(8)"/>
		</addColumn>
	</changeSet>
	<changeSet id="4" author="Satyanarayana.G">
<createView viewName="CUSTOMERS_AVIEW" replaceIfExists="true">
SELECT t1.custid,
    t1.custcif,
    t1.custcorebank,
    t1.custctgcode,
    t1.custtypecode,
    t1.custsalutationcode,
    t1.custfname,
    t1.custmname,
    t1.custlname,
    t1.custshrtname,
    t1.custfnamelcllng,
    t1.custmnamelcllng,
    t1.custlnamelcllng,
    t1.custshrtnamelcllng,
    t1.custdftbranch,
    t1.custgendercode,
    t1.custdob,
    t1.custpob,
    t1.custcob,
    t1.custpassportno,
    t1.custmothermaiden,
    t1.custisminor,
    t1.custreferedby,
    t1.custdsa,
    t1.custdsadept,
    t1.custro1,
    t1.custro2,
    t1.custgroupid,
    t1.custsts,
    t1.custstschgdate,
    t1.custgroupsts,
    t1.custisblocked,
    t1.custisactive,
    t1.custisclosed,
    t1.custinactivereason,
    t1.custisdecease,
    t1.custisdormant,
    t1.custisdelinquent,
    t1.custistradefincust,
    t1.custtradelicencenum,
    t1.custtradelicenceexpiry,
    t1.custpassportexpiry,
    t1.custvisanum,
    t1.custvisaexpiry,
    t1.custisstaff,
    t1.custstaffid,
    t1.custindustry,
    t1.custsector,
    t1.custsubsector,
    t1.custprofession,
    t1.custtotalincome,
    t1.custmaritalsts,
    t1.custempsts,
    t1.custsegment,
    t1.custsubsegment,
    t1.custisblacklisted,
    t1.custblrsncode,
    t1.custisrejected,
    t1.custrejectedrsn,
    t1.custbaseccy,
    t1.custlng,
    t1.custparentcountry,
    t1.custresdcountry,
    t1.custriskcountry,
    t1.custnationality,
    t1.custclosedon,
    t1.custstmtfrq,
    t1.custisstmtcombined,
    t1.custstmtlastdate,
    t1.custstmtnextdate,
    t1.custstmtdispatchmode,
    t1.custfirstbusinessdate,
    t1.custaddlvar81,
    t1.custaddlvar82,
    t1.custaddlvar83,
    t1.custaddlvar84,
    t1.custaddlvar85,
    t1.custaddlvar86,
    t1.custaddlvar87,
    t1.custaddlvar88,
    t1.custaddlvar89,
    t1.custaddldate1,
    t1.custaddldate2,
    t1.custaddldate3,
    t1.custaddldate4,
    t1.custaddldate5,
    t1.custaddlvar1,
    t1.custaddlvar2,
    t1.custaddlvar3,
    t1.custaddlvar4,
    t1.custaddlvar5,
    t1.custaddlvar6,
    t1.custaddlvar7,
    t1.custaddlvar8,
    t1.custaddlvar9,
    t1.custaddlvar10,
    t1.custaddlvar11,
    t1.custaddldec1,
    t1.custaddldec2,
    t1.custaddldec3,
    t1.custaddldec4,
    t1.custaddldec5,
    t1.custaddlint1,
    t1.custaddlint2,
    t1.custaddlint3,
    t1.custaddlint4,
    t1.custaddlint5,
    t1.version,
    t1.custsourceid,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t2.custtypedesc AS lovdesccusttypecodename,
    t3.maritalstsdesc AS lovdesccustmaritalstsname,
    t4.empstsdesc AS lovdesccustempstsname,
    t6.custstsdescription AS lovdesccuststsname,
    t7.industrydesc AS lovdesccustindustryname,
    t8.sectordesc AS lovdesccustsectorname,
    t9.subsectordesc AS lovdesccustsubsectorname,
    t10.professiondesc AS lovdesccustprofessionname,
    t11.countrydesc AS lovdesccustcobname,
    t20.segmentdesc AS lovdesccustsegmentname,
    t12.nationalitydesc AS lovdesccustnationalityname,
    t13.genderdesc AS lovdesccustgendercodename,
    t14.deptdesc AS lovdesccustdsadeptname,
    t15.dealername AS lovdesccustro1name,
    t15.dealercity AS lovdesccustro1city,
    t16.grpstsdescription AS lovdesccustgroupstsname,
    t17.branchdesc AS lovdesccustdftbranchname,
    t17.bankrefno AS branchrefno,
    t17.branchswiftbrncde AS custswiftbrncode,
    t18.custctgdesc AS lovdesccustctgcodename,
    t2.custtypectg AS lovdesccustctgtype,
    t19.saluationdesc AS lovdesccustsalutationcodename,
    t21.countrydesc AS lovdesccustparentcountryname,
    t22.countrydesc AS lovdesccustresdcountryname,
    t23.countrydesc AS lovdesccustriskcountryname,
    t24.rofficerdesc AS lovdesccustro2name,
    t25.blrsndesc AS lovdesccustblrsncodename,
    t26.rejectdesc AS lovdesccustrejectedrsnname,
    t27.custgrpdesc AS lovdesccustgroupidname,
    t28.subsegmentdesc AS lovdesccustsubsegmentname,
    t29.lngdesc AS lovdesccustlngname,
    t30.dispatchmodedesc AS lovdescdispatchmodedescname,
    t1.dedupfound,
    t1.skipdedup,
    t1.custtotalexpense,
    t1.custblacklistdate,
    t1.noofdependents,
    t1.custcrcpr,
    t1.jointcust,
    t1.jointcustname,
    t1.jointcustdob,
    t27.custgrpcode AS lovdesccustgroupcode,
    t1.custrelation,
    t1.contactpersonname,
    t1.phonenumber,
    t1.emailid,
    t1.salariedcustomer,
    t31.targetdesc AS lovdesctargetname,
    t1.custsuspsts,
    t1.custsuspdate,
    t1.custsusptrigger,
    T1.SubCategory, 
    T1.CasteId,
    T1.ReligionId,
    T32.CasteCode,
    T32.CasteDesc, 
    T33.ReligionCode,
    T33.ReligionDesc,
    
    COALESCE(t32.roledesc, fn_get_roledesc(t1.nextrolecode)) AS lovdescrequeststage
   FROM customers t1
     LEFT JOIN rmtcusttypes t2 ON t1.custtypecode = t2.custtypecode
     LEFT JOIN bmtmaritalstatuscodes t3 ON t1.custmaritalsts = t3.maritalstscode
     LEFT JOIN bmtempstscodes t4 ON t1.custempsts = t4.empstscode
     LEFT JOIN bmtcuststatuscodes t6 ON t1.custsts = t6.custstscode
     LEFT JOIN bmtindustries t7 ON t1.custindustry = t7.industrycode
     LEFT JOIN bmtsectors t8 ON t1.custsector = t8.sectorcode
     LEFT JOIN bmtsubsectors t9 ON t1.custsector = t9.sectorcode AND t1.custsubsector = t9.subsectorcode
     LEFT JOIN bmtprofessions t10 ON t1.custprofession = t10.professioncode
     LEFT JOIN bmtcountries t11 ON t1.custcob = t11.countrycode
     LEFT JOIN bmtnationalitycodes t12 ON t1.custnationality = t12.nationalitycode
     LEFT JOIN bmtgenders t13 ON t1.custgendercode = t13.gendercode
     LEFT JOIN bmtdepartments t14 ON t1.custdsadept = t14.deptcode
     LEFT JOIN amtvehicledealer t15 ON t1.custro1 = t15.dealerid
     LEFT JOIN bmtgrpstatuscodes t16 ON t1.custgroupsts = t16.grpstscode
     LEFT JOIN rmtbranches t17 ON t1.custdftbranch = t17.branchcode
     LEFT JOIN bmtcustcategories t18 ON t1.custctgcode = t18.custctgcode
     LEFT JOIN bmtsalutations t19 ON t1.custsalutationcode = t19.salutationcode
     LEFT JOIN bmtsegments t20 ON t1.custsegment = t20.segmentcode
     LEFT JOIN bmtcountries t21 ON t1.custparentcountry = t21.countrycode
     LEFT JOIN bmtcountries t22 ON t1.custresdcountry = t22.countrycode
     LEFT JOIN bmtcountries t23 ON t1.custriskcountry = t23.countrycode
     LEFT JOIN relationshipofficers t24 ON t1.custro2 = t24.rofficercode
     LEFT JOIN bmtblacklistrsncodes t25 ON t1.custblrsncode = t25.blrsncode
     LEFT JOIN bmtrejectcodes t26 ON t1.custrejectedrsn = t26.rejectcode
     LEFT JOIN customergroups t27 ON t1.custgroupid = t27.custgrpid
     LEFT JOIN bmtsubsegments t28 ON t1.custsubsegment = t28.subsegmentcode
     LEFT JOIN bmtlanguage t29 ON t1.custlng = t29.lngcode
     LEFT JOIN bmtdispatchmodes t30 ON t1.custstmtdispatchmode = t30.dispatchmodecode
     LEFT JOIN targetdetails t31 ON t1.custaddlvar82 = t31.targetcode
     left join
     Caste T32 ON T1.CasteId = T32.CasteId  LEFT OUTER JOIN
    Religion T33 ON T1.ReligionId = T33.ReligionId
     LEFT JOIN secroles t32 ON t1.nextrolecode = t32.rolecd
    
 </createView>
	</changeSet>
	<changeSet id="5" author="Satyanarayana.G">
		<createView viewName="CUSTOMERS_AEVIEW" replaceIfExists="true">
SELECT t1.custid,
    t1.custcif,
    t1.custcorebank,
    t1.custctgcode,
    t1.custtypecode,
    t1.custshrtname,
    t1.custfname,
    t1.custlname,
    t1.custdob,
    t1.custnationality,
    t1.custsector,
    t1.custsubsector,
    t2.phonenumber,
    t2.phoneareacode,
    t2.phonecountrycode,
    t1.custcrcpr,
    t1.custpassportno,
    t3.custemail AS emailid,
    t1.custaddlvar82,
    t4.custtypedesc AS lovdesccusttypecodename,
    t1.custbaseccy,
    t4.custtypectg AS lovdesccustctgtype,
    t5.custctgdesc AS lovdesccustctgcodename,
    t6.custstsdescription AS lovdesccuststsname,
    t1.custdftbranch,
    t7.branchdesc AS lovdesccustdftbranchname,
    T1.SubCategory,
    T1.CasteId,
    T1.ReligionId,
    T8.CasteCode,
    T8.CasteDesc, 
    T9.ReligionCode,
    T9.ReligionDesc,
    COALESCE(t32.roledesc, fn_get_roledesc(t1.nextrolecode)) AS lovdescrequeststage
   FROM customers t1
     LEFT JOIN customerphonenumbers t2 ON t1.custid = t2.phonecustid AND t2.phonetypecode = 'MOBILE'
     LEFT JOIN customeremails t3 ON t1.custid = t3.custid AND t3.custemailtypecode = 'OFFICE'
     LEFT JOIN rmtcusttypes t4 ON t1.custtypecode = t4.custtypecode
     LEFT JOIN bmtcustcategories t5 ON t1.custctgcode = t5.custctgcode
     LEFT JOIN bmtcuststatuscodes t6 ON t1.custsts = t6.custstscode
     LEFT JOIN rmtbranches t7 ON t1.custdftbranch = t7.branchcode
    LEFT JOIN Caste T8 ON T1.CasteId = T8.CasteId  LEFT OUTER JOIN
    Religion T9 ON T1.ReligionId = T9.ReligionId
     LEFT JOIN secroles t32 ON t1.nextrolecode = t32.rolecd
     </createView>
	</changeSet>
	<changeSet id="6" author="Satyanarayana.G">
		<createView viewName="CUSTOMERS_LVIEW" replaceIfExists="true">
  SELECT c.custid,
    c.custcif,
    c.custcorebank,
    c.custctgcode,
    c.custtypecode,
    c.custshrtname,
    c.custdftbranch,
    c.recordstatus,
    c.rolecode,
    c.nextrolecode,
    c.recordtype,
    ct.custtypedesc AS lovdesccusttypecodename,
    t1.custctgdesc AS lovdesccustctgcodename,
    C.SubCategory,
    C.CasteId, 
    C.ReligionId,
    T2.CasteCode,
    T2.CasteDesc,
    T3.ReligionCode, 
    T3.ReligionDesc,
    COALESCE(t2.roledesc, fn_get_roledesc(c.nextrolecode)) AS lovdescrequeststage
   FROM customers_temp c
     LEFT JOIN rmtcusttypes ct ON c.custtypecode = ct.custtypecode
     LEFT JOIN bmtcustcategories t1 ON c.custctgcode = t1.custctgcode
     LEFT JOIN secroles t2 ON c.nextrolecode = t2.rolecd
     LEFT OUTER JOIN Caste T2 ON C.CasteId = T2.CasteId  
     LEFT OUTER JOIN Religion T3 ON C.ReligionId = T3.ReligionId
UNION ALL
 SELECT c.custid,
    c.custcif,
    c.custcorebank,
    c.custctgcode,
    c.custtypecode,
    c.custshrtname,
    c.custdftbranch,
    c.recordstatus,
    c.rolecode,
    c.nextrolecode,
    c.recordtype,
    ct.custtypedesc AS lovdesccusttypecodename,
    t1.custctgdesc AS lovdesccustctgcodename,
    C.SubCategory,
    C.CasteId,
    C.ReligionId, 
    T2.CasteCode,
    T2.CasteDesc,
    T3.ReligionCode,
    T3.ReligionDesc,
    COALESCE(t2.roledesc, fn_get_roledesc(c.nextrolecode)) AS lovdescrequeststage
   FROM customers c
     LEFT JOIN rmtcusttypes ct ON c.custtypecode = ct.custtypecode
     LEFT JOIN bmtcustcategories t1 ON c.custctgcode = t1.custctgcode
     LEFT JOIN secroles t2 ON c.nextrolecode = t2.rolecd
     LEFT OUTER JOIN Caste T2 ON C.CasteId = T2.CasteId  
     LEFT OUTER JOIN Religion T3 ON C.ReligionId = T3.ReligionId
  WHERE NOT (c.custid IN ( SELECT customers_temp.custid
           FROM customers_temp
          WHERE customers_temp.custid = c.custid))

  </createView>
	</changeSet>
	<changeSet id="7" author="Satyanarayana.G">
		<createView viewName="CUSTOMERS_TVIEW" replaceIfExists="true">
 SELECT t1.custid,
    t1.custcif,
    t1.custcorebank,
    t1.custctgcode,
    t1.custtypecode,
    t1.custsalutationcode,
    t1.custfname,
    t1.custmname,
    t1.custlname,
    t1.custshrtname,
    t1.custfnamelcllng,
    t1.custmnamelcllng,
    t1.custlnamelcllng,
    t1.custshrtnamelcllng,
    t1.custdftbranch,
    t1.custgendercode,
    t1.custdob,
    t1.custpob,
    t1.custcob,
    t1.custpassportno,
    t1.custmothermaiden,
    t1.custisminor,
    t1.custreferedby,
    t1.custdsa,
    t1.custdsadept,
    t1.custro1,
    t1.custro2,
    t1.custgroupid,
    t1.custsts,
    t1.custstschgdate,
    t1.custgroupsts,
    t1.custisblocked,
    t1.custisactive,
    t1.custisclosed,
    t1.custinactivereason,
    t1.custisdecease,
    t1.custisdormant,
    t1.custisdelinquent,
    t1.custistradefincust,
    t1.custtradelicencenum,
    t1.custtradelicenceexpiry,
    t1.custpassportexpiry,
    t1.custvisanum,
    t1.custvisaexpiry,
    t1.custisstaff,
    t1.custstaffid,
    t1.custindustry,
    t1.custsector,
    t1.custsubsector,
    t1.custprofession,
    t1.custtotalincome,
    t1.custmaritalsts,
    t1.custempsts,
    t1.custsegment,
    t1.custsubsegment,
    t1.custisblacklisted,
    t1.custblrsncode,
    t1.custisrejected,
    t1.custrejectedrsn,
    t1.custbaseccy,
    t1.custlng,
    t1.custparentcountry,
    t1.custresdcountry,
    t1.custriskcountry,
    t1.custnationality,
    t1.custclosedon,
    t1.custstmtfrq,
    t1.custisstmtcombined,
    t1.custstmtlastdate,
    t1.custstmtnextdate,
    t1.custstmtdispatchmode,
    t1.custfirstbusinessdate,
    t1.custaddlvar81,
    t1.custaddlvar82,
    t1.custaddlvar83,
    t1.custaddlvar84,
    t1.custaddlvar85,
    t1.custaddlvar86,
    t1.custaddlvar87,
    t1.custaddlvar88,
    t1.custaddlvar89,
    t1.custaddldate1,
    t1.custaddldate2,
    t1.custaddldate3,
    t1.custaddldate4,
    t1.custaddldate5,
    t1.custaddlvar1,
    t1.custaddlvar2,
    t1.custaddlvar3,
    t1.custaddlvar4,
    t1.custaddlvar5,
    t1.custaddlvar6,
    t1.custaddlvar7,
    t1.custaddlvar8,
    t1.custaddlvar9,
    t1.custaddlvar10,
    t1.custaddlvar11,
    t1.custaddldec1,
    t1.custaddldec2,
    t1.custaddldec3,
    t1.custaddldec4,
    t1.custaddldec5,
    t1.custaddlint1,
    t1.custaddlint2,
    t1.custaddlint3,
    t1.custaddlint4,
    t1.custaddlint5,
    t1.custsourceid,
    t1.version,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t2.custtypedesc AS lovdesccusttypecodename,
    t3.maritalstsdesc AS lovdesccustmaritalstsname,
    t4.empstsdesc AS lovdesccustempstsname,
    t6.custstsdescription AS lovdesccuststsname,
    t7.industrydesc AS lovdesccustindustryname,
    t8.sectordesc AS lovdesccustsectorname,
    t9.subsectordesc AS lovdesccustsubsectorname,
    t10.professiondesc AS lovdesccustprofessionname,
    t11.countrydesc AS lovdesccustcobname,
    t20.segmentdesc AS lovdesccustsegmentname,
    t12.nationalitydesc AS lovdesccustnationalityname,
    t13.genderdesc AS lovdesccustgendercodename,
    t14.deptdesc AS lovdesccustdsadeptname,
    t15.dealername AS lovdesccustro1name,
    t15.dealercity AS lovdesccustro1city,
    t16.grpstsdescription AS lovdesccustgroupstsname,
    t17.branchdesc AS lovdesccustdftbranchname,
    t17.bankrefno AS branchrefno,
    t17.branchswiftbrncde AS custswiftbrncode,
    t18.custctgdesc AS lovdesccustctgcodename,
    t2.custtypectg AS lovdesccustctgtype,
    t19.saluationdesc AS lovdesccustsalutationcodename,
    t21.countrydesc AS lovdesccustparentcountryname,
    t22.countrydesc AS lovdesccustresdcountryname,
    t23.countrydesc AS lovdesccustriskcountryname,
    t24.rofficerdesc AS lovdesccustro2name,
    t25.blrsndesc AS lovdesccustblrsncodename,
    t26.rejectdesc AS lovdesccustrejectedrsnname,
    t27.custgrpdesc AS lovdesccustgroupidname,
    t28.subsegmentdesc AS lovdesccustsubsegmentname,
    t29.lngdesc AS lovdesccustlngname,
    t30.dispatchmodedesc AS lovdescdispatchmodedescname,
    t1.dedupfound,
    t1.skipdedup,
    t1.custtotalexpense,
    t1.custblacklistdate,
    t1.noofdependents,
    t1.custcrcpr,
    t1.jointcust,
    t1.jointcustname,
    t1.jointcustdob,
    t27.custgrpcode AS lovdesccustgroupcode,
    t1.contactpersonname,
    t1.phonenumber,
    t1.emailid,
    t1.salariedcustomer,
    t31.targetdesc AS lovdesctargetname,
    t1.custrelation,
    t1.custsuspsts,
    t1.custsuspdate,
    t1.custsusptrigger,
    T1.SubCategory,
    T1.CasteId,
    T1.ReligionId, 
    T32.CasteCode,
    T32.CasteDesc,
    T33.ReligionCode, 
    T33.ReligionDesc,
    COALESCE(t32.roledesc, fn_get_roledesc(t1.nextrolecode)) AS lovdescrequeststage
   FROM customers_temp t1
     LEFT JOIN rmtcusttypes t2 ON t1.custtypecode = t2.custtypecode
     LEFT JOIN bmtmaritalstatuscodes t3 ON t1.custmaritalsts = t3.maritalstscode
     LEFT JOIN bmtempstscodes t4 ON t1.custempsts = t4.empstscode
     LEFT JOIN bmtcuststatuscodes t6 ON t1.custsts = t6.custstscode
     LEFT JOIN bmtindustries t7 ON t1.custindustry = t7.industrycode
     LEFT JOIN bmtsectors t8 ON t1.custsector = t8.sectorcode
     LEFT JOIN bmtsubsectors t9 ON t1.custsector = t9.sectorcode AND t1.custsubsector = t9.subsectorcode
     LEFT JOIN bmtprofessions t10 ON t1.custprofession = t10.professioncode
     LEFT JOIN bmtcountries t11 ON t1.custcob = t11.countrycode
     LEFT JOIN bmtnationalitycodes t12 ON t1.custnationality = t12.nationalitycode
     LEFT JOIN bmtgenders t13 ON t1.custgendercode = t13.gendercode
     LEFT JOIN bmtdepartments t14 ON t1.custdsadept = t14.deptcode
     LEFT JOIN amtvehicledealer t15 ON t1.custro1 = t15.dealerid
     LEFT JOIN bmtgrpstatuscodes t16 ON t1.custgroupsts = t16.grpstscode
     LEFT JOIN rmtbranches t17 ON t1.custdftbranch = t17.branchcode
     LEFT JOIN bmtcustcategories t18 ON t1.custctgcode = t18.custctgcode
     LEFT JOIN bmtsalutations t19 ON t1.custsalutationcode = t19.salutationcode
     LEFT JOIN bmtsegments t20 ON t1.custsegment = t20.segmentcode
     LEFT JOIN bmtcountries t21 ON t1.custparentcountry = t21.countrycode
     LEFT JOIN bmtcountries t22 ON t1.custresdcountry = t22.countrycode
     LEFT JOIN bmtcountries t23 ON t1.custriskcountry = t23.countrycode
     LEFT JOIN relationshipofficers t24 ON t1.custro2 = t24.rofficercode
     LEFT JOIN bmtblacklistrsncodes t25 ON t1.custblrsncode = t25.blrsncode
     LEFT JOIN bmtrejectcodes t26 ON t1.custrejectedrsn = t26.rejectcode
     LEFT JOIN customergroups t27 ON t1.custgroupid = t27.custgrpid
     LEFT JOIN bmtsubsegments t28 ON t1.custsubsegment = t28.subsegmentcode
     LEFT JOIN bmtlanguage t29 ON t1.custlng = t29.lngcode
     LEFT JOIN bmtdispatchmodes t30 ON t1.custstmtdispatchmode = t30.dispatchmodecode
     LEFT JOIN targetdetails t31 ON t1.custaddlvar82 = t31.targetcode
      LEFT JOIN Caste T32 ON T1.CasteId = T32.CasteId  LEFT OUTER JOIN 
      Religion T33 ON T1.ReligionId = T33.ReligionId
     LEFT JOIN secroles t32 ON t1.nextrolecode = t32.rolecd
      </createView>
	</changeSet>
	<changeSet id="8" author="Satyanarayana.G">
		<createView viewName="CUSTOMERS_VIEW" replaceIfExists="true">
SELECT t1.custid,
    t1.custcif,
    t1.custcorebank,
    t1.custctgcode,
    t1.custtypecode,
    t1.custsalutationcode,
    t1.custfname,
    t1.custmname,
    t1.custlname,
    t1.custshrtname,
    t1.custfnamelcllng,
    t1.custmnamelcllng,
    t1.custlnamelcllng,
    t1.custshrtnamelcllng,
    t1.custdftbranch,
    t1.custgendercode,
    t1.custdob,
    t1.custpob,
    t1.custcob,
    t1.custpassportno,
    t1.custmothermaiden,
    t1.custisminor,
    t1.custreferedby,
    t1.custdsa,
    t1.custdsadept,
    t1.custro1,
    t1.custro2,
    t1.custgroupid,
    t1.custsts,
    t1.custstschgdate,
    t1.custgroupsts,
    t1.custisblocked,
    t1.custisactive,
    t1.custisclosed,
    t1.custinactivereason,
    t1.custisdecease,
    t1.custisdormant,
    t1.custisdelinquent,
    t1.custistradefincust,
    t1.custtradelicencenum,
    t1.custtradelicenceexpiry,
    t1.custpassportexpiry,
    t1.custvisanum,
    t1.custvisaexpiry,
    t1.custisstaff,
    t1.custstaffid,
    t1.custindustry,
    t1.custsector,
    t1.custsubsector,
    t1.custprofession,
    t1.custtotalincome,
    t1.custmaritalsts,
    t1.custempsts,
    t1.custsegment,
    t1.custsubsegment,
    t1.custisblacklisted,
    t1.custblrsncode,
    t1.custisrejected,
    t1.custrejectedrsn,
    t1.custbaseccy,
    t1.custlng,
    t1.custparentcountry,
    t1.custresdcountry,
    t1.custriskcountry,
    t1.custnationality,
    t1.custclosedon,
    t1.custstmtfrq,
    t1.custisstmtcombined,
    t1.custstmtlastdate,
    t1.custstmtnextdate,
    t1.custstmtdispatchmode,
    t1.custfirstbusinessdate,
    t1.custaddlvar81,
    t1.custaddlvar82,
    t1.custaddlvar83,
    t1.custaddlvar84,
    t1.custaddlvar85,
    t1.custaddlvar86,
    t1.custaddlvar87,
    t1.custaddlvar88,
    t1.custaddlvar89,
    t1.custaddldate1,
    t1.custaddldate2,
    t1.custaddldate3,
    t1.custaddldate4,
    t1.custaddldate5,
    t1.custaddlvar1,
    t1.custaddlvar2,
    t1.custaddlvar3,
    t1.custaddlvar4,
    t1.custaddlvar5,
    t1.custaddlvar6,
    t1.custaddlvar7,
    t1.custaddlvar8,
    t1.custaddlvar9,
    t1.custaddlvar10,
    t1.custaddlvar11,
    t1.custaddldec1,
    t1.custaddldec2,
    t1.custaddldec3,
    t1.custaddldec4,
    t1.custaddldec5,
    t1.custaddlint1,
    t1.custaddlint2,
    t1.custaddlint3,
    t1.custaddlint4,
    t1.custaddlint5,
    t1.custsourceid,
    t1.version,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t2.custtypedesc AS lovdesccusttypecodename,
    t3.maritalstsdesc AS lovdesccustmaritalstsname,
    t4.empstsdesc AS lovdesccustempstsname,
    t6.custstsdescription AS lovdesccuststsname,
    t7.industrydesc AS lovdesccustindustryname,
    t8.sectordesc AS lovdesccustsectorname,
    t9.subsectordesc AS lovdesccustsubsectorname,
    t10.professiondesc AS lovdesccustprofessionname,
    t11.countrydesc AS lovdesccustcobname,
    t20.segmentdesc AS lovdesccustsegmentname,
    t12.nationalitydesc AS lovdesccustnationalityname,
    t13.genderdesc AS lovdesccustgendercodename,
    t14.deptdesc AS lovdesccustdsadeptname,
    t15.dealername AS lovdesccustro1name,
    t15.dealercity AS lovdesccustro1city,
    t16.grpstsdescription AS lovdesccustgroupstsname,
    t17.branchdesc AS lovdesccustdftbranchname,
    t17.bankrefno AS branchrefno,
    t17.branchswiftbrncde AS custswiftbrncode,
    t18.custctgdesc AS lovdesccustctgcodename,
    t2.custtypectg AS lovdesccustctgtype,
    t19.saluationdesc AS lovdesccustsalutationcodename,
    t21.countrydesc AS lovdesccustparentcountryname,
    t22.countrydesc AS lovdesccustresdcountryname,
    t23.countrydesc AS lovdesccustriskcountryname,
    t24.rofficerdesc AS lovdesccustro2name,
    t25.blrsndesc AS lovdesccustblrsncodename,
    t26.rejectdesc AS lovdesccustrejectedrsnname,
    t27.custgrpdesc AS lovdesccustgroupidname,
    t28.subsegmentdesc AS lovdesccustsubsegmentname,
    t29.lngdesc AS lovdesccustlngname,
    t30.dispatchmodedesc AS lovdescdispatchmodedescname,
    t1.dedupfound,
    t1.skipdedup,
    t1.custtotalexpense,
    t1.custblacklistdate,
    t1.noofdependents,
    t1.custcrcpr,
    t1.jointcust,
    t1.jointcustname,
    t1.jointcustdob,
    t27.custgrpcode AS lovdesccustgroupcode,
    t1.custrelation,
    t1.contactpersonname,
    t1.phonenumber,
    t1.emailid,
    t1.salariedcustomer,
    t31.targetdesc AS lovdesctargetname,
    t1.custsuspsts,
    t1.custsuspdate,
    t1.custsusptrigger,
    T1.SubCategory, 
    T1.CasteId, 
    T1.ReligionId, 
    T32.CasteCode,
    T32.CasteDesc, 
    T33.ReligionCode,
    T33.ReligionDesc,
    COALESCE(t32.roledesc, fn_get_roledesc(t1.nextrolecode)) AS lovdescrequeststage
   FROM customers_temp t1
     LEFT JOIN rmtcusttypes t2 ON t1.custtypecode = t2.custtypecode
     LEFT JOIN bmtmaritalstatuscodes t3 ON t1.custmaritalsts = t3.maritalstscode
     LEFT JOIN bmtempstscodes t4 ON t1.custempsts = t4.empstscode
     LEFT JOIN bmtcuststatuscodes t6 ON t1.custsts = t6.custstscode
     LEFT JOIN bmtindustries t7 ON t1.custindustry = t7.industrycode
     LEFT JOIN bmtsectors t8 ON t1.custsector = t8.sectorcode
     LEFT JOIN bmtsubsectors t9 ON t1.custsector = t9.sectorcode AND t1.custsubsector = t9.subsectorcode
     LEFT JOIN bmtprofessions t10 ON t1.custprofession = t10.professioncode
     LEFT JOIN bmtcountries t11 ON t1.custcob = t11.countrycode
     LEFT JOIN bmtnationalitycodes t12 ON t1.custnationality = t12.nationalitycode
     LEFT JOIN bmtgenders t13 ON t1.custgendercode = t13.gendercode
     LEFT JOIN bmtdepartments t14 ON t1.custdsadept = t14.deptcode
     LEFT JOIN amtvehicledealer t15 ON t1.custro1 = t15.dealerid
     LEFT JOIN bmtgrpstatuscodes t16 ON t1.custgroupsts = t16.grpstscode
     LEFT JOIN rmtbranches t17 ON t1.custdftbranch = t17.branchcode
     LEFT JOIN bmtcustcategories t18 ON t1.custctgcode = t18.custctgcode
     LEFT JOIN bmtsalutations t19 ON t1.custsalutationcode = t19.salutationcode
     LEFT JOIN bmtsegments t20 ON t1.custsegment = t20.segmentcode
     LEFT JOIN bmtcountries t21 ON t1.custparentcountry = t21.countrycode
     LEFT JOIN bmtcountries t22 ON t1.custresdcountry = t22.countrycode
     LEFT JOIN bmtcountries t23 ON t1.custriskcountry = t23.countrycode
     LEFT JOIN relationshipofficers t24 ON t1.custro2 = t24.rofficercode
     LEFT JOIN bmtblacklistrsncodes t25 ON t1.custblrsncode = t25.blrsncode
     LEFT JOIN bmtrejectcodes t26 ON t1.custrejectedrsn = t26.rejectcode
     LEFT JOIN customergroups t27 ON t1.custgroupid = t27.custgrpid
     LEFT JOIN bmtsubsegments t28 ON t1.custsubsegment = t28.subsegmentcode
     LEFT JOIN bmtlanguage t29 ON t1.custlng = t29.lngcode
     LEFT JOIN bmtdispatchmodes t30 ON t1.custstmtdispatchmode = t30.dispatchmodecode
     LEFT JOIN targetdetails t31 ON t1.custaddlvar82 = t31.targetcode
     LEFT JOIN secroles t32 ON t1.nextrolecode = t32.rolecd
     LEFT JOIN Caste T32 ON T1.CasteId = T32.CasteId  LEFT OUTER JOIN 
     Religion T33 ON T1.ReligionId = T33.ReligionId
UNION ALL
 SELECT t1.custid,
    t1.custcif,
    t1.custcorebank,
    t1.custctgcode,
    t1.custtypecode,
    t1.custsalutationcode,
    t1.custfname,
    t1.custmname,
    t1.custlname,
    t1.custshrtname,
    t1.custfnamelcllng,
    t1.custmnamelcllng,
    t1.custlnamelcllng,
    t1.custshrtnamelcllng,
    t1.custdftbranch,
    t1.custgendercode,
    t1.custdob,
    t1.custpob,
    t1.custcob,
    t1.custpassportno,
    t1.custmothermaiden,
    t1.custisminor,
    t1.custreferedby,
    t1.custdsa,
    t1.custdsadept,
    t1.custro1,
    t1.custro2,
    t1.custgroupid,
    t1.custsts,
    t1.custstschgdate,
    t1.custgroupsts,
    t1.custisblocked,
    t1.custisactive,
    t1.custisclosed,
    t1.custinactivereason,
    t1.custisdecease,
    t1.custisdormant,
    t1.custisdelinquent,
    t1.custistradefincust,
    t1.custtradelicencenum,
    t1.custtradelicenceexpiry,
    t1.custpassportexpiry,
    t1.custvisanum,
    t1.custvisaexpiry,
    t1.custisstaff,
    t1.custstaffid,
    t1.custindustry,
    t1.custsector,
    t1.custsubsector,
    t1.custprofession,
    t1.custtotalincome,
    t1.custmaritalsts,
    t1.custempsts,
    t1.custsegment,
    t1.custsubsegment,
    t1.custisblacklisted,
    t1.custblrsncode,
    t1.custisrejected,
    t1.custrejectedrsn,
    t1.custbaseccy,
    t1.custlng,
    t1.custparentcountry,
    t1.custresdcountry,
    t1.custriskcountry,
    t1.custnationality,
    t1.custclosedon,
    t1.custstmtfrq,
    t1.custisstmtcombined,
    t1.custstmtlastdate,
    t1.custstmtnextdate,
    t1.custstmtdispatchmode,
    t1.custfirstbusinessdate,
    t1.custaddlvar81,
    t1.custaddlvar82,
    t1.custaddlvar83,
    t1.custaddlvar84,
    t1.custaddlvar85,
    t1.custaddlvar86,
    t1.custaddlvar87,
    t1.custaddlvar88,
    t1.custaddlvar89,
    t1.custaddldate1,
    t1.custaddldate2,
    t1.custaddldate3,
    t1.custaddldate4,
    t1.custaddldate5,
    t1.custaddlvar1,
    t1.custaddlvar2,
    t1.custaddlvar3,
    t1.custaddlvar4,
    t1.custaddlvar5,
    t1.custaddlvar6,
    t1.custaddlvar7,
    t1.custaddlvar8,
    t1.custaddlvar9,
    t1.custaddlvar10,
    t1.custaddlvar11,
    t1.custaddldec1,
    t1.custaddldec2,
    t1.custaddldec3,
    t1.custaddldec4,
    t1.custaddldec5,
    t1.custaddlint1,
    t1.custaddlint2,
    t1.custaddlint3,
    t1.custaddlint4,
    t1.custaddlint5,
    t1.custsourceid,
    t1.version,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t2.custtypedesc AS lovdesccusttypecodename,
    t3.maritalstsdesc AS lovdesccustmaritalstsname,
    t4.empstsdesc AS lovdesccustempstsname,
    t6.custstsdescription AS lovdesccuststsname,
    t7.industrydesc AS lovdesccustindustryname,
    t8.sectordesc AS lovdesccustsectorname,
    t9.subsectordesc AS lovdesccustsubsectorname,
    t10.professiondesc AS lovdesccustprofessionname,
    t11.countrydesc AS lovdesccustcobname,
    t20.segmentdesc AS lovdesccustsegmentname,
    t12.nationalitydesc AS lovdesccustnationalityname,
    t13.genderdesc AS lovdesccustgendercodename,
    t14.deptdesc AS lovdesccustdsadeptname,
    t15.dealername AS lovdesccustro1name,
    t15.dealercity AS lovdesccustro1city,
    t16.grpstsdescription AS lovdesccustgroupstsname,
    t17.branchdesc AS lovdesccustdftbranchname,
    t17.bankrefno AS branchrefno,
    t17.branchswiftbrncde AS custswiftbrncode,
    t18.custctgdesc AS lovdesccustctgcodename,
    t2.custtypectg AS lovdesccustctgtype,
    t19.saluationdesc AS lovdesccustsalutationcodename,
    t21.countrydesc AS lovdesccustparentcountryname,
    t22.countrydesc AS lovdesccustresdcountryname,
    t23.countrydesc AS lovdesccustriskcountryname,
    t24.rofficerdesc AS lovdesccustro2name,
    t25.blrsndesc AS lovdesccustblrsncodename,
    t26.rejectdesc AS lovdesccustrejectedrsnname,
    t27.custgrpdesc AS lovdesccustgroupidname,
    t28.subsegmentdesc AS lovdesccustsubsegmentname,
    t29.lngdesc AS lovdesccustlngname,
    t30.dispatchmodedesc AS lovdescdispatchmodedescname,
    t1.dedupfound,
    t1.skipdedup,
    t1.custtotalexpense,
    t1.custblacklistdate,
    t1.noofdependents,
    t1.custcrcpr,
    t1.jointcust,
    t1.jointcustname,
    t1.jointcustdob,
    t27.custgrpcode AS lovdesccustgroupcode,
    t1.custrelation,
    t1.contactpersonname,
    t1.phonenumber,
    t1.emailid,
    t1.salariedcustomer,
    t31.targetdesc AS lovdesctargetname,
    t1.custsuspsts,
    t1.custsuspdate,
    t1.custsusptrigger,
    T1.SubCategory, 
    T1.CasteId, 
    T1.ReligionId,
    T32.CasteCode,
    T32.CasteDesc, 
    T33.ReligionCode,
    T33.ReligionDesc,
    COALESCE(t32.roledesc, fn_get_roledesc(t1.nextrolecode)) AS lovdescrequeststage
   FROM customers t1
     LEFT JOIN rmtcusttypes t2 ON t1.custtypecode = t2.custtypecode
     LEFT JOIN bmtmaritalstatuscodes t3 ON t1.custmaritalsts = t3.maritalstscode
     LEFT JOIN bmtempstscodes t4 ON t1.custempsts = t4.empstscode
     LEFT JOIN bmtcuststatuscodes t6 ON t1.custsts = t6.custstscode
     LEFT JOIN bmtindustries t7 ON t1.custindustry = t7.industrycode
     LEFT JOIN bmtsectors t8 ON t1.custsector = t8.sectorcode
     LEFT JOIN bmtsubsectors t9 ON t1.custsector = t9.sectorcode AND t1.custsubsector = t9.subsectorcode
     LEFT JOIN bmtprofessions t10 ON t1.custprofession = t10.professioncode
     LEFT JOIN bmtcountries t11 ON t1.custcob = t11.countrycode
     LEFT JOIN bmtnationalitycodes t12 ON t1.custnationality = t12.nationalitycode
     LEFT JOIN bmtgenders t13 ON t1.custgendercode = t13.gendercode
     LEFT JOIN bmtdepartments t14 ON t1.custdsadept = t14.deptcode
     LEFT JOIN amtvehicledealer t15 ON t1.custro1 = t15.dealerid
     LEFT JOIN bmtgrpstatuscodes t16 ON t1.custgroupsts = t16.grpstscode
     LEFT JOIN rmtbranches t17 ON t1.custdftbranch = t17.branchcode
     LEFT JOIN bmtcustcategories t18 ON t1.custctgcode = t18.custctgcode
     LEFT JOIN bmtsalutations t19 ON t1.custsalutationcode = t19.salutationcode
     LEFT JOIN bmtsegments t20 ON t1.custsegment = t20.segmentcode
     LEFT JOIN bmtcountries t21 ON t1.custparentcountry = t21.countrycode
     LEFT JOIN bmtcountries t22 ON t1.custresdcountry = t22.countrycode
     LEFT JOIN bmtcountries t23 ON t1.custriskcountry = t23.countrycode
     LEFT JOIN relationshipofficers t24 ON t1.custro2 = t24.rofficercode
     LEFT JOIN bmtblacklistrsncodes t25 ON t1.custblrsncode = t25.blrsncode
     LEFT JOIN bmtrejectcodes t26 ON t1.custrejectedrsn = t26.rejectcode
     LEFT JOIN customergroups t27 ON t1.custgroupid = t27.custgrpid
     LEFT JOIN bmtsubsegments t28 ON t1.custsubsegment = t28.subsegmentcode
     LEFT JOIN bmtlanguage t29 ON t1.custlng = t29.lngcode
     LEFT JOIN bmtdispatchmodes t30 ON t1.custstmtdispatchmode = t30.dispatchmodecode
     LEFT JOIN targetdetails t31 ON t1.custaddlvar82 = t31.targetcode
     LEFT JOIN secroles t32 ON t1.nextrolecode = t32.rolecd
    LEFT JOIN Caste T32 ON T1.CasteId = T32.CasteId  LEFT OUTER JOIN 
     Religion T33 ON T1.ReligionId = T33.ReligionId
  WHERE NOT (EXISTS ( SELECT 1 AS expr1
           FROM customers_temp
          WHERE customers_temp.custid = t1.custid))
</createView>
	</changeSet>
	<changeSet id="9" author="Satyanarayana.G">
		<createView viewName="CUSTOMERSDEDUP_VIEW" replaceIfExists="true">
  SELECT t1.custid,
    t1.custcif,
    t1.custfname,
    t1.custlname,
    t1.custcrcpr,
    t1.custpassportno,
    t1.custshrtname,
    t1.custdob,
    t1.custnationality,
    t1.phonenumber AS mobilenumber,
    t1.custctgcode,
    t1.custdftbranch,
    t1.custtypecode,
    t1.custsector,
    t1.custsubsector,
    T1.SubCategory, 
    T1.CasteId,
    T1.ReligionId,
    T3.CasteCode,
    T3.CasteDesc,
    T4.ReligionCode,
    T4.ReligionDesc,
    t2.custtypectg AS lovdesccustctgtype
   FROM plf.customers_temp t1
     LEFT JOIN plf.rmtcusttypes t2 ON t1.custtypecode = t2.custtypecode
     LEFT JOIN Caste T3 ON T1.CasteId = T3.CasteId  LEFT OUTER JOIN 
     Religion T4 ON T1.ReligionId = T4.ReligionId
UNION ALL
 SELECT t1.custid,
    t1.custcif,
    t1.custfname,
    t1.custlname,
    t1.custcrcpr,
    t1.custpassportno,
    t1.custshrtname,
    t1.custdob,
    t1.custnationality,
    t1.phonenumber AS mobilenumber,
    t1.custctgcode,
    t1.custdftbranch,
    t1.custtypecode,
    t1.custsector,
    t1.custsubsector,
    T1.SubCategory,
    T1.CasteId,
    T1.ReligionId,
    T3.CasteCode, 
    T3.CasteDesc, 
    T4.ReligionCode, 
    T4.ReligionDesc,
    t2.custtypectg AS lovdesccustctgtype
   FROM plf.customers t1
     LEFT JOIN plf.rmtcusttypes t2 ON t1.custtypecode = t2.custtypecode
     LEFT JOIN Caste T3 ON T1.CasteId = T3.CasteId  LEFT OUTER JOIN 
     Religion T4 ON T1.ReligionId = T4.ReligionId
  WHERE NOT (EXISTS ( SELECT 1
           FROM plf.customers_temp
          WHERE customers_temp.custid = t1.custid))
</createView>
	</changeSet>
	
	<changeSet id="10" author="Durga Prasad D">
	    <createTable tableName="POSTINGS_REQUESTS">			
			<column name="ID"  	type="bigint" autoIncrement="true" incrementBy="1">
			  <constraints primaryKey="true"  nullable="false" />
			 </column>
			<column name="date" 			type="datetime"/>
			<column name="number" 			type="bigint"/>
			<column name="type" 			type="VARCHAR(50)"/>
			<column name="glcode" 			type="VARCHAR(50)"/>
			<column name="description" 		type="VARCHAR(200)"/>
			<column name="profit_center" 	type="VARCHAR(200)"/>
			<column name="debit_credit" 	type="VARCHAR(20)"/>
			<column name="amount" 		    type="VARCHAR(200)"/>
			<column name="narration" 		type="VARCHAR(200)"/>
		</createTable>
	</changeSet>
	<changeSet id="11" author="Satyanarayana.G">
		<createView viewName="CUSTOMERSDEDUP_VIEW" replaceIfExists="true">
  SELECT t1.custid,
    t1.custcif,
    t1.custfname,
    t1.custlname,
    t1.custcrcpr,
    t1.custpassportno,
    t1.custshrtname,
    t1.custdob,
    t1.custnationality,
    t1.phonenumber AS mobilenumber,
    t1.custctgcode,
    t1.custdftbranch,
    t1.custtypecode,
    t1.custsector,
    t1.custsubsector,
    T1.SubCategory, 
    T1.CasteId,
    T1.ReligionId,
    T3.CasteCode,
    T3.CasteDesc,
    T4.ReligionCode,
    T4.ReligionDesc,
    t2.custtypectg AS lovdesccustctgtype
   FROM customers_temp t1
     LEFT JOIN rmtcusttypes t2 ON t1.custtypecode = t2.custtypecode
     LEFT JOIN Caste T3 ON T1.CasteId = T3.CasteId  LEFT OUTER JOIN 
     Religion T4 ON T1.ReligionId = T4.ReligionId
UNION ALL
 SELECT t1.custid,
    t1.custcif,
    t1.custfname,
    t1.custlname,
    t1.custcrcpr,
    t1.custpassportno,
    t1.custshrtname,
    t1.custdob,
    t1.custnationality,
    t1.phonenumber AS mobilenumber,
    t1.custctgcode,
    t1.custdftbranch,
    t1.custtypecode,
    t1.custsector,
    t1.custsubsector,
    T1.SubCategory,
    T1.CasteId,
    T1.ReligionId,
    T3.CasteCode, 
    T3.CasteDesc, 
    T4.ReligionCode, 
    T4.ReligionDesc,
    t2.custtypectg AS lovdesccustctgtype
   FROM customers t1
     LEFT JOIN rmtcusttypes t2 ON t1.custtypecode = t2.custtypecode
     LEFT JOIN Caste T3 ON T1.CasteId = T3.CasteId  LEFT OUTER JOIN 
     Religion T4 ON T1.ReligionId = T4.ReligionId
  WHERE NOT (EXISTS ( SELECT 1
           FROM customers_temp
          WHERE customers_temp.custid = t1.custid))
</createView>
	</changeSet>
	<changeSet id="12" author="Jayant" dbms="postgresql">
		<modifyDataType tableName="POSTINGS_REQUESTS" columnName="type" newDataType="citext"/>
	</changeSet>
	<changeSet id="13" author="Jayant" dbms="postgresql">
		<modifyDataType tableName="POSTINGS_REQUESTS" columnName="glcode" newDataType="citext"/>
	</changeSet>
	<changeSet id="14" author="Jayant" dbms="postgresql">
		<modifyDataType tableName="POSTINGS_REQUESTS" columnName="description" newDataType="citext"/>
	</changeSet>
	<changeSet id="15" author="Jayant" dbms="postgresql">
		<modifyDataType tableName="POSTINGS_REQUESTS" columnName="profit_center" newDataType="citext"/>
	</changeSet>
	<changeSet id="16" author="Jayant" dbms="postgresql">
		<modifyDataType tableName="POSTINGS_REQUESTS" columnName="debit_credit" newDataType="citext"/>
	</changeSet>
	<changeSet id="17" author="Jayant" dbms="postgresql">
		<modifyDataType tableName="POSTINGS_REQUESTS" columnName="amount" newDataType="citext"/>
	</changeSet>
	<changeSet id="18" author="Jayant" dbms="postgresql">
		<modifyDataType tableName="POSTINGS_REQUESTS" columnName="narration" newDataType="citext"/>
	</changeSet>
</databaseChangeLog>