<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />
	
	<changeSet id="pre_run_for_pgp" author="Kesav" runAlways="true" dbms="postgresql">
		<sql>
			Set search_path = plf,public,pg_catalog;
		</sql>
	</changeSet>
	
	<!-- Entity -->
	<changeSet id="1" author="Kesav">
		<addColumn tableName="Entity">
			<column name="GSTINAvailable" type="boolean" defaultValue="0"/>
		</addColumn>
	</changeSet>
	
	<changeSet id="2" author="Kesav">
		<addColumn tableName="Entity_Temp">
			<column name="GSTINAvailable" type="boolean" defaultValue="0"/>
		</addColumn>
	</changeSet>
	
	<changeSet id="2.1" author="Kesav" dbms="postgresql">
		<sql>
			set search_path=plf,public,pg_catalog;
		</sql>
	</changeSet>
	<changeSet id="3" author="Kesav">
		<comment>gstinAvailable column added for GST changes</comment>
		<createView viewName="entity_aview" replaceIfExists="true">
			SELECT  	t1.entitycode,
					    t1.entitydesc,
					    t1.pannumber,
					    t1.entityaddrline1,
					    t1.entityaddrline2,
					    t1.entityaddrhnbr,
					    t1.entityflatnbr,
					    t1.entityaddrstreet,
					    t1.entitypobox,
					    t1.country,
					    t1.statecode,
					    t1.citycode,
					    t1.pincode,
					    t1.active,
					    t1.version,
					    t1.lastmntby,
					    t1.lastmnton,
					    t1.recordstatus,
					    t1.rolecode,
					    t1.nextrolecode,
					    t1.taskid,
					    t1.nexttaskid,
					    t1.recordtype,
					    t1.workflowid,
					    t2.countrydesc AS countryname,
					    t3.cpprovincename AS provincename,
					    t4.pccityname AS cityname,
					    t5.areaname AS pincodename,
					    t1.cinnumber,
					    t1.gstinAvailable
   			FROM 		entity t1
     		LEFT JOIN	bmtcountries t2 ON t1.country = t2.countrycode
     		LEFT JOIN 	rmtcountryvsprovince t3 ON t1.statecode = t3.cpprovince AND t1.country = t3.cpcountry
     		LEFT JOIN 	rmtprovincevscity t4 ON t1.citycode = t4.pccity AND t1.statecode = t4.pcprovince AND t1.country = t4.pccountry
     		LEFT JOIN 	pincodes t5 ON t1.pincode = t5.pincode AND t1.citycode = t5.city
		</createView>	
	</changeSet>
	
	<changeSet id="4" author="Kesav">
		<comment>gstinAvailable column added for GST changes</comment>
		<createView viewName="entity_view" replaceIfExists="true">
			 SELECT 	t1.entitycode,
						t1.entitydesc,
						t1.pannumber,
						t1.entityaddrline1,
						t1.entityaddrline2,
						t1.entityaddrhnbr,
						t1.entityflatnbr,
						t1.entityaddrstreet,
						t1.entitypobox,
						t1.country,
						t1.statecode,
						t1.citycode,
						t1.pincode,
						t1.active,
						t1.version,
						t1.lastmntby,
						t1.lastmnton,
						t1.recordstatus,
						t1.rolecode,
						t1.nextrolecode,
						t1.taskid,
						t1.nexttaskid,
						t1.recordtype,
						t1.workflowid,
						t2.countrydesc AS countryname,
						t3.cpprovincename AS provincename,
						t4.pccityname AS cityname,
						t5.areaname AS pincodename,
						t1.cinnumber,
						t1.gstinAvailable
			 FROM 		entity_temp t1
			 LEFT JOIN 	bmtcountries t2 ON t1.country = t2.countrycode
			 LEFT JOIN 	rmtcountryvsprovince t3 ON t1.statecode = t3.cpprovince AND t1.country = t3.cpcountry
			 LEFT JOIN 	rmtprovincevscity t4 ON t1.citycode = t4.pccity AND t1.statecode = t4.pcprovince AND t1.country = t4.pccountry
			 LEFT JOIN 	pincodes t5 ON t1.pincode = t5.pincode AND t1.citycode = t5.city
			
			 UNION ALL
			 
			 SELECT 	t1.entitycode,
						t1.entitydesc,
						t1.pannumber,
						t1.entityaddrline1,
						t1.entityaddrline2,
						t1.entityaddrhnbr,
						t1.entityflatnbr,
						t1.entityaddrstreet,
						t1.entitypobox,
						t1.country,
						t1.statecode,
						t1.citycode,
						t1.pincode,
						t1.active,
						t1.version,
						t1.lastmntby,
						t1.lastmnton,
						t1.recordstatus,
						t1.rolecode,
						t1.nextrolecode,
						t1.taskid,
						t1.nexttaskid,
						t1.recordtype,
						t1.workflowid,
						t2.countrydesc AS countryname,
						t3.cpprovincename AS provincename,
						t4.pccityname AS cityname,
						t5.areaname AS pincodename,
						t1.cinnumber,
						t1.gstinAvailable
			 FROM 		entity t1
			 LEFT JOIN  bmtcountries t2 ON t1.country = t2.countrycode
			 LEFT JOIN  rmtcountryvsprovince t3 ON t1.statecode = t3.cpprovince AND t1.country = t3.cpcountry
			 LEFT JOIN  rmtprovincevscity t4 ON t1.citycode = t4.pccity AND t1.statecode = t4.pcprovince AND t1.country = t4.pccountry
			 LEFT JOIN  pincodes t5 ON t1.pincode = t5.pincode AND t1.citycode = t5.city
			 WHERE NOT (EXISTS ( SELECT 1 FROM entity_temp WHERE entity_temp.entitycode = t1.entitycode))		
 		</createView>
	</changeSet>
	
	<!-- TAXDETAIL -->
	<changeSet id="5" author="Kesav">
		<addColumn tableName="TAXDETAIL">
			<column name="hsnNumber" type="varchar(100)"/>
			<column name="natureService" type="varchar(100)"/>
		</addColumn>
	</changeSet>
	
	<changeSet id="6" author="Kesav">
		<addColumn tableName="TAXDETAIL_Temp">
			<column name="hsnNumber" type="varchar(100)"/>
			<column name="natureService" type="varchar(100)"/>
		</addColumn>
	</changeSet>
	
	 <changeSet id="7" author="Kesav">
	 	<comment> hsnNumber, natureService and gstinAvailable columns added for GST changes</comment>
		<createView viewName="taxdetail_aview" replaceIfExists="true">
			SELECT t1.id,
		    t1.country,
		    t2.countrydesc AS countryname,
		    t1.statecode,
		    t3.cpprovincename AS provincename,
		    t1.entitycode,
		    t4.entitydesc,
		    t1.taxcode,
		    t1.addressline1,
		    t1.addressline2,
		    t1.addressline3,
		    t1.addressline4,
		    t1.pincode,
		    t1.citycode,
		    t6.pccityname AS cityname,
		    t1.version,
		    t1.lastmntby,
		    t1.lastmnton,
		    t1.recordstatus,
		    t1.rolecode,
		    t1.nextrolecode,
		    t1.taskid,
		    t1.nexttaskid,
		    t1.recordtype,
		    t1.workflowid,
			t1.hsnNumber,
			t1.natureService,
			t4.GstInAvailable
		   	FROM taxdetail t1
		    JOIN bmtcountries t2 ON t1.country = t2.countrycode
		    JOIN rmtcountryvsprovince t3 ON t1.statecode = t3.cpprovince
		    JOIN entity t4 ON t1.entitycode = t4.entitycode
		    JOIN pincodes t5 ON t1.pincode = t5.pincode
		    JOIN rmtprovincevscity t6 ON t1.citycode = t6.pccity		
     	</createView>
	</changeSet>
	
	<changeSet id="8" author="Kesav">
		<comment> hsnNumber, natureService and gstinAvailable columns added for GST changes</comment>
		<createView viewName="taxdetail_view" replaceIfExists="true">
			SELECT 	t1.id,
					t1.country,
					t2.countrydesc AS countryname,
					t1.statecode,
					t3.cpprovincename AS provincename,
					t1.entitycode,
					t4.entitydesc,
					t1.taxcode,
					t1.addressline1,
					t1.addressline2,
					t1.addressline3,
					t1.addressline4,
					t1.pincode,
					t1.citycode,
					t6.pccityname AS cityname,
					t1.version,
					t1.lastmntby,
					t1.lastmnton,
					t1.recordstatus,
					t1.rolecode,
					t1.nextrolecode,
					t1.taskid,
					t1.nexttaskid,
					t1.recordtype,
					t1.workflowid,
					t1.hsnNumber,
					t1.natureService,
					t4.GstInAvailable
			FROM 	taxdetail_temp t1
		    JOIN 	bmtcountries t2 ON t1.country = t2.countrycode
		    JOIN 	rmtcountryvsprovince t3 ON t1.statecode = t3.cpprovince
		    JOIN 	entity t4 ON t1.entitycode = t4.entitycode
		    JOIN 	pincodes t5 ON t1.pincode = t5.pincode
		    JOIN 	rmtprovincevscity t6 ON t1.citycode = t6.pccity
			
			UNION ALL
			
			SELECT 	t1.id,
					t1.country,
					t2.countrydesc AS countryname,
					t1.statecode,
					t3.cpprovincename AS provincename,
					t1.entitycode,
					t4.entitydesc,
					t1.taxcode,
					t1.addressline1,
					t1.addressline2,
					t1.addressline3,
					t1.addressline4,
					t1.pincode,
					t1.citycode,
					t6.pccityname AS cityname,
					t1.version,
					t1.lastmntby,
					t1.lastmnton,
					t1.recordstatus,
					t1.rolecode,
					t1.nextrolecode,
					t1.taskid,
					t1.nexttaskid,
					t1.recordtype,
					t1.workflowid,
					t1.hsnNumber,
					t1.natureService,
					t4.GstInAvailable
			FROM 	taxdetail t1
		    JOIN 	bmtcountries t2 ON t1.country = t2.countrycode
		    JOIN 	rmtcountryvsprovince t3 ON t1.statecode = t3.cpprovince
		    JOIN 	entity t4 ON t1.entitycode = t4.entitycode
		    JOIN 	pincodes t5 ON t1.pincode = t5.pincode
		    JOIN 	rmtprovincevscity t6 ON t1.citycode = t6.pccity
			WHERE NOT (EXISTS ( SELECT 1 FROM taxdetail_temp WHERE taxdetail_temp.id = t1.id))
		</createView>
	</changeSet>
	
	<changeSet id="9" author="Kesav">
		<sql>
			Delete from RBFIELDDETAILS where RBMODULE = 'GSTRULE' and RBEVENT = 'CGST' and RBFLDNAME = 'fromStateGstExempted';
			Delete from RBFIELDDETAILS where RBMODULE = 'GSTRULE' and RBEVENT = 'SGST' and RBFLDNAME = 'fromStateGstExempted';
			Delete from RBFIELDDETAILS where RBMODULE = 'GSTRULE' and RBEVENT = 'UGST' and RBFLDNAME = 'fromStateGstExempted';
			Delete from RBFIELDDETAILS where RBMODULE = 'GSTRULE' and RBEVENT = 'IGST' and RBFLDNAME = 'fromStateGstExempted';
			
			Insert into RBFIELDDETAILS (RBMODULE,RBEVENT,RBFLDNAME,RBFLDDESC,RBFLDTYPE,RBFLDLEN,RBFORCALFLDS,RBFORBLDFLDS,RBFLDTABLENAME,RBSTFLDS,MODULECODE) values 
			('GSTRULE','CGST','fromStateGstExempted','From State GST Exempted','nchar',1,'0','1',' ','static,global','  '); 
			 Insert into RBFIELDDETAILS (RBMODULE,RBEVENT,RBFLDNAME,RBFLDDESC,RBFLDTYPE,RBFLDLEN,RBFORCALFLDS,RBFORBLDFLDS,RBFLDTABLENAME,RBSTFLDS,MODULECODE) values 
			('GSTRULE','IGST','fromStateGstExempted','From State GST Exempted','nchar',1,'0','1',' ','static,global','  '); 
			Insert into RBFIELDDETAILS (RBMODULE,RBEVENT,RBFLDNAME,RBFLDDESC,RBFLDTYPE,RBFLDLEN,RBFORCALFLDS,RBFORBLDFLDS,RBFLDTABLENAME,RBSTFLDS,MODULECODE) values 
			('GSTRULE','SGST','fromStateGstExempted','From State GST Exempted','nchar',1,'0','1',' ','static,global','  ');
			Insert into RBFIELDDETAILS (RBMODULE,RBEVENT,RBFLDNAME,RBFLDDESC,RBFLDTYPE,RBFLDLEN,RBFORCALFLDS,RBFORBLDFLDS,RBFLDTABLENAME,RBSTFLDS,MODULECODE) values 
			('GSTRULE','UGST','fromStateGstExempted','From State GST Exempted','nchar',1,'0','1',' ','static,global','  ');
			
			Delete from RBFIELDDETAILS where RBMODULE = 'GSTRULE' and RBEVENT = 'CGST' and RBFLDNAME = 'toStateGstExempted';
			Delete from RBFIELDDETAILS where RBMODULE = 'GSTRULE' and RBEVENT = 'SGST' and RBFLDNAME = 'toStateGstExempted';
			Delete from RBFIELDDETAILS where RBMODULE = 'GSTRULE' and RBEVENT = 'UGST' and RBFLDNAME = 'toStateGstExempted';
			Delete from RBFIELDDETAILS where RBMODULE = 'GSTRULE' and RBEVENT = 'IGST' and RBFLDNAME = 'toStateGstExempted';
			
			Insert into RBFIELDDETAILS (RBMODULE,RBEVENT,RBFLDNAME,RBFLDDESC,RBFLDTYPE,RBFLDLEN,RBFORCALFLDS,RBFORBLDFLDS,RBFLDTABLENAME,RBSTFLDS,MODULECODE) values 
			('GSTRULE','CGST','toStateGstExempted','From State GST Exempted','nchar',1,'0','1',' ','static,global','  '); 
			 Insert into RBFIELDDETAILS (RBMODULE,RBEVENT,RBFLDNAME,RBFLDDESC,RBFLDTYPE,RBFLDLEN,RBFORCALFLDS,RBFORBLDFLDS,RBFLDTABLENAME,RBSTFLDS,MODULECODE) values 
			('GSTRULE','IGST','toStateGstExempted','From State GST Exempted','nchar',1,'0','1',' ','static,global','  '); 
			Insert into RBFIELDDETAILS (RBMODULE,RBEVENT,RBFLDNAME,RBFLDDESC,RBFLDTYPE,RBFLDLEN,RBFORCALFLDS,RBFORBLDFLDS,RBFLDTABLENAME,RBSTFLDS,MODULECODE) values 
			('GSTRULE','SGST','toStateGstExempted','From State GST Exempted','nchar',1,'0','1',' ','static,global','  ');
			Insert into RBFIELDDETAILS (RBMODULE,RBEVENT,RBFLDNAME,RBFLDDESC,RBFLDTYPE,RBFLDLEN,RBFORCALFLDS,RBFORBLDFLDS,RBFLDTABLENAME,RBSTFLDS,MODULECODE) values 
			('GSTRULE','UGST','toStateGstExempted','From State GST Exempted','nchar',1,'0','1',' ','static,global','  ');
			
			Delete from RBFIELDDETAILS where RBMODULE = 'GSTRULE' and RBEVENT = 'CGST' and RBFLDNAME = 'gstExempted';
			Delete from RBFIELDDETAILS where RBMODULE = 'GSTRULE' and RBEVENT = 'SGST' and RBFLDNAME = 'gstExempted';
			Delete from RBFIELDDETAILS where RBMODULE = 'GSTRULE' and RBEVENT = 'UGST' and RBFLDNAME = 'gstExempted';
			Delete from RBFIELDDETAILS where RBMODULE = 'GSTRULE' and RBEVENT = 'IGST' and RBFLDNAME = 'gstExempted';
			
			Insert into RBFIELDDETAILS (RBMODULE,RBEVENT,RBFLDNAME,RBFLDDESC,RBFLDTYPE,RBFLDLEN,RBFORCALFLDS,RBFORBLDFLDS,RBFLDTABLENAME,RBSTFLDS,MODULECODE) values 
			('GSTRULE','CGST','gstExempted','From State GST Exempted','nchar',1,'0','1',' ','static,global','  '); 
			 Insert into RBFIELDDETAILS (RBMODULE,RBEVENT,RBFLDNAME,RBFLDDESC,RBFLDTYPE,RBFLDLEN,RBFORCALFLDS,RBFORBLDFLDS,RBFLDTABLENAME,RBSTFLDS,MODULECODE) values 
			('GSTRULE','IGST','gstExempted','From State GST Exempted','nchar',1,'0','1',' ','static,global','  '); 
			Insert into RBFIELDDETAILS (RBMODULE,RBEVENT,RBFLDNAME,RBFLDDESC,RBFLDTYPE,RBFLDLEN,RBFORCALFLDS,RBFORBLDFLDS,RBFLDTABLENAME,RBSTFLDS,MODULECODE) values 
			('GSTRULE','SGST','gstExempted','From State GST Exempted','nchar',1,'0','1',' ','static,global','  ');
			Insert into RBFIELDDETAILS (RBMODULE,RBEVENT,RBFLDNAME,RBFLDDESC,RBFLDTYPE,RBFLDLEN,RBFORCALFLDS,RBFORBLDFLDS,RBFLDTABLENAME,RBSTFLDS,MODULECODE) values 
			('GSTRULE','UGST','gstExempted','From State GST Exempted','nchar',1,'0','1',' ','static,global','  ');		
		</sql>
	</changeSet>
	
	<changeSet id="10" author="Kesava">
		<sql>
			delete from Rules where Rulemodule='GSTRULE' and RULECODE = 'CGST';
			delete from Rules where Rulemodule='GSTRULE' and RULECODE = 'IGST';
			delete from Rules where Rulemodule='GSTRULE' and RULECODE = 'SGST';
			delete from Rules where Rulemodule='GSTRULE' and RULECODE = 'UGST';
		</sql>
	</changeSet>

	<changeSet id="11" author="Kesava">
		<insert tableName="Rules">
			<column name="RULEID" valueComputed="(select Max(Ruleid)+1 from rules)"/>
			<column name="RULEMODULE">GSTRULE</column>
			<column name="RULEEVENT">CGST</column>
			<column name="RULECODE">CGST</column>
			<column name="RULECODEDESC">CGST</column>
			<column name="WAIVERDECIDER">null</column>
			<column name="WAIVER">0</column>
			<column name="WAIVERPERC">null</column>
			<column name="SQLRULE" type="NCLOB"><![CDATA[ if (fromState == toState && (toUnionTerritory == '0' && (fromStateGstExempted == '0' && (toStateGstExempted == '0' && (gstExempted == '0'))))) { Result = 9 ; return;} else {Result = 0 ; return;} ]]></column>
			<column name="ACTUALBLOCK"><![CDATA[(|if|FIELDLIST|fromState| |==|FIELDLIST|toState| |1|0|1|1|1|9| |~(|AND|FIELDLIST|toUnionTerritory| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|fromStateGstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|toStateGstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|gstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~)|~)|~)|~)|~)|~(|else|0|0|0|1|1|0| |~)|]]></column>
			<column name="SEQORDER">0</column>
			<column name="RETURNTYPE">D</column>
			<column name="GROUPID">0</column>
			<column name="VERSION">5</column>
			<column name="LASTMNTBY">1000</column>
			<column name="LASTMNTON" valueDate="current_timestamp"/>
			<column name="RECORDSTATUS">Approved</column>
			<column name="ROLECODE">null</column>
			<column name="NEXTROLECODE">null</column>
			<column name="TASKID">null</column>
			<column name="NEXTTASKID">null</column>
			<column name="RECORDTYPE">null</column>
			<column name="WORKFLOWID">0</column>
			<column name="ALLOWDEVIATION">0</column>
			<column name="DEVIATIONTYPE">#</column>
			<column name="CALFEEMODIFY">0</column>
			<column name="FEETOFINANCE">null</column>
			<column name="REVOLVING">1</column>
			<column name="FIXEDORVARIABLELIMIT">F</column>
			<column name="ACTIVE">1</column>
			<column name="FIELDS">fromState</column>
			<column name="FEETYPEID">null</column>
		</insert>
	</changeSet>
	<changeSet id="12" author="Kesava">
		<update tableName="Rules">
			<column name="SQLRULE" type="NCLOB"><![CDATA[ if (fromState == toState && (toUnionTerritory == '0' && (fromStateGstExempted == '0' && (toStateGstExempted == '0' && (gstExempted == '0'))))) {
	Result = 9 ; return;  
} else {
	Result = 0 ; return;  
}]]></column>
			<column name="ACTUALBLOCK" type="NCLOB"><![CDATA[(|if|FIELDLIST|fromState| |==|FIELDLIST|toState| |1|0|1|1|1|9| |~(|AND|FIELDLIST|toUnionTerritory| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|fromStateGstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|toStateGstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|gstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~)|~)|~)|~)|~)|~(|else|0|0|0|1|1|0| |~)|]]></column>
			<where> Rulemodule='GSTRULE' and RULECODE = 'CGST' AND ACTIVE=1</where>
		</update>
	</changeSet>
	<changeSet id="13" author="Kesava">
		<sql>
			update SeqRules set SeqNo = (select max(RuleId)+1 from Rules);
		</sql>
	</changeSet>
	
	<changeSet id="14" author="Kesava">
		<insert tableName="Rules">
			<column name="RULEID" valueComputed="(select Max(Ruleid)+1 from rules)"/>
			<column name="RULEMODULE">GSTRULE</column>
			<column name="RULEEVENT">IGST</column>
			<column name="RULECODE">IGST</column>
			<column name="RULECODEDESC">IGST</column>
			<column name="WAIVERDECIDER">null</column>
			<column name="WAIVER">0</column>
			<column name="WAIVERPERC">null</column>
			<column name="SQLRULE" type="NCLOB"><![CDATA[ if (fromState !== toState && (toUnionTerritory == '0' && (fromStateGstExempted == '0' && (toStateGstExempted == '0' && (gstExempted == '0'))))) { Result = 18 ; return; } else { Result = 0 ; return; }]]></column>
			<column name="ACTUALBLOCK"><![CDATA[(|if|FIELDLIST|fromState| |!==|FIELDLIST|toState| |1|0|1|1|1|18| |~(|AND|FIELDLIST|toUnionTerritory| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|fromStateGstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|toStateGstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|gstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~)|~)|~)|~)|~)|~(|else|0|0|0|1|1|0| |~)|]]></column>
			<column name="SEQORDER">0</column>
			<column name="RETURNTYPE">D</column>
			<column name="GROUPID">0</column>
			<column name="VERSION">5</column>
			<column name="LASTMNTBY">1000</column>
			<column name="LASTMNTON" valueDate="current_timestamp"/>
			<column name="RECORDSTATUS">Approved</column>
			<column name="ROLECODE">null</column>
			<column name="NEXTROLECODE">null</column>
			<column name="TASKID">null</column>
			<column name="NEXTTASKID">null</column>
			<column name="RECORDTYPE">null</column>
			<column name="WORKFLOWID">0</column>
			<column name="ALLOWDEVIATION">0</column>
			<column name="DEVIATIONTYPE">#</column>
			<column name="CALFEEMODIFY">0</column>
			<column name="FEETOFINANCE">null</column>
			<column name="REVOLVING">1</column>
			<column name="FIXEDORVARIABLELIMIT">F</column>
			<column name="ACTIVE">1</column>
			<column name="FIELDS">fromState</column>
			<column name="FEETYPEID">null</column>
		</insert>
	</changeSet>
	<changeSet id="15" author="Kesava">
		<update tableName="Rules">
			<column name="SQLRULE" type="NCLOB"><![CDATA[ if (fromState !== toState && (toUnionTerritory == '0' && (fromStateGstExempted == '0' && (toStateGstExempted == '0' && (gstExempted == '0'))))) {
	Result = 18 ; return;  
} else {
	Result = 0 ; return;  
} ]]></column>
			<column name="ACTUALBLOCK" type="NCLOB"><![CDATA[(|if|FIELDLIST|fromState| |!==|FIELDLIST|toState| |1|0|1|1|1|18| |~(|AND|FIELDLIST|toUnionTerritory| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|fromStateGstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|toStateGstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|gstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~)|~)|~)|~)|~)|~(|else|0|0|0|1|1|0| |~)|]]></column>
			<where> Rulemodule='GSTRULE' and RULECODE = 'IGST'AND ACTIVE=1</where>
		</update>
	</changeSet>
	<changeSet id="16" author="Kesava">
		<sql>
			update SeqRules set SeqNo = (select max(RuleId)+1 from Rules);
		</sql>
	</changeSet>

	<changeSet id="17" author="Kesava">
		<insert tableName="Rules">
			<column name="RULEID" valueComputed="(select Max(Ruleid)+1 from rules)"/>
			<column name="RULEMODULE">GSTRULE</column>
			<column name="RULEEVENT">SGST</column>
			<column name="RULECODE">SGST</column>
			<column name="RULECODEDESC">SGST</column>
			<column name="WAIVERDECIDER">null</column>
			<column name="WAIVER">0</column>
			<column name="WAIVERPERC">null</column>
			<column name="SQLRULE" type="NCLOB"><![CDATA[ if (fromState == toState && (toUnionTerritory == '0' && (fromStateGstExempted == '0' && (toStateGstExempted == '0' && (gstExempted == '0'))))) { Result = 9 ; return; } else { Result = 0 ; return; }]]></column>
			<column name="ACTUALBLOCK"><![CDATA[(|if|FIELDLIST|fromState| |==|FIELDLIST|toState| |1|0|1|1|1|9| |~(|AND|FIELDLIST|toUnionTerritory| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|fromStateGstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|toStateGstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|gstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~)|~)|~)|~)|~)|~(|else|0|0|0|1|1|0| |~)|]]></column>
			<column name="SEQORDER">0</column>
			<column name="RETURNTYPE">D</column>
			<column name="GROUPID">0</column>
			<column name="VERSION">3</column>
			<column name="LASTMNTBY">1000</column>
			<column name="LASTMNTON" valueDate="current_timestamp"/>
			<column name="RECORDSTATUS">Approved</column>
			<column name="ROLECODE">null</column>
			<column name="NEXTROLECODE">null</column>
			<column name="TASKID">null</column>
			<column name="NEXTTASKID">null</column>
			<column name="RECORDTYPE">null</column>
			<column name="WORKFLOWID">0</column>
			<column name="ALLOWDEVIATION">0</column>
			<column name="DEVIATIONTYPE">#</column>
			<column name="CALFEEMODIFY">0</column>
			<column name="FEETOFINANCE">null</column>
			<column name="REVOLVING">1</column>
			<column name="FIXEDORVARIABLELIMIT">F</column>
			<column name="ACTIVE">1</column>
			<column name="FIELDS">fromState</column>
			<column name="FEETYPEID">null</column>
		</insert>
	</changeSet>
	<changeSet id="18" author="Kesava">
		<update tableName="Rules">
			<column name="SQLRULE" type="NCLOB"><![CDATA[ if (fromState == toState && (toUnionTerritory == '0' && (fromStateGstExempted == '0' && (toStateGstExempted == '0' && (gstExempted == '0'))))) {
	Result = 9 ; return;  
 } else {
	Result = 0 ; return;  
 } ]]></column>
			<column name="ACTUALBLOCK" type="NCLOB"><![CDATA[(|if|FIELDLIST|fromState| |==|FIELDLIST|toState| |1|0|1|1|1|9| |~(|AND|FIELDLIST|toUnionTerritory| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|fromStateGstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|toStateGstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|gstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~)|~)|~)|~)|~)|~(|else|0|0|0|1|1|0| |~)|]]></column>
			<where> Rulemodule='GSTRULE' and RULECODE = 'SGST'AND ACTIVE=1</where>
		</update>
	</changeSet>
	<changeSet id="19" author="Kesava">
		<sql>
			update SeqRules set SeqNo = (select max(RuleId)+1 from Rules);
		</sql>
	</changeSet>

	<changeSet id="20" author="Kesava">
		<insert tableName="Rules">
			<column name="RULEID" valueComputed="(select Max(Ruleid)+1 from rules)"/>
			<column name="RULEMODULE">GSTRULE</column>
			<column name="RULEEVENT">UGST</column>
			<column name="RULECODE">UGST</column>
			<column name="RULECODEDESC">UGST</column>
			<column name="WAIVERDECIDER">null</column>
			<column name="WAIVER">0</column>
			<column name="WAIVERPERC">null</column>
			<column name="SQLRULE" type="NCLOB"><![CDATA[ if (toUnionTerritory == '1' && (fromStateGstExempted == '0' && (toStateGstExempted == '0' && (gstExempted == '0')))) { Result = 9 ; return;  } else { Result = 0 ; return; } ]]></column>
			<column name="ACTUALBLOCK"><![CDATA[(|if|FIELDLIST|toUnionTerritory| |==|STATICTEXT|1| |1|0|1|1|1|9| |~(|AND|FIELDLIST|fromStateGstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|toStateGstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|gstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~)|~)|~)|~)|~(|else|0|0|0|1|1|0| |~)|]]></column>
			<column name="SEQORDER">0</column>
			<column name="RETURNTYPE">D</column>
			<column name="GROUPID">0</column>
			<column name="VERSION">4</column>
			<column name="LASTMNTBY">1000</column>
			<column name="LASTMNTON" valueDate="current_timestamp"/>
			<column name="RECORDSTATUS">Approved</column>
			<column name="ROLECODE">null</column>
			<column name="NEXTROLECODE">null</column>
			<column name="TASKID">null</column>
			<column name="NEXTTASKID">null</column>
			<column name="RECORDTYPE">null</column>
			<column name="WORKFLOWID">0</column>
			<column name="ALLOWDEVIATION">0</column>
			<column name="DEVIATIONTYPE">#</column>
			<column name="CALFEEMODIFY">0</column>
			<column name="FEETOFINANCE">null</column>
			<column name="REVOLVING">1</column>
			<column name="FIXEDORVARIABLELIMIT">F</column>
			<column name="ACTIVE">1</column>
			<column name="FIELDS">toState</column>
			<column name="FEETYPEID">null</column>
		</insert>
	</changeSet>
	<changeSet id="21" author="Kesava">
		<update tableName="Rules">
			<column name="SQLRULE" type="NCLOB"><![CDATA[ if (toUnionTerritory == '1' && (fromStateGstExempted == '0' && (toStateGstExempted == '0' && (gstExempted == '0')))) {
	Result = 9 ; return;  
} else {
	Result = 0 ; return;  
}]]></column>
			<column name="ACTUALBLOCK" type="NCLOB"><![CDATA[(|if|FIELDLIST|toUnionTerritory| |==|STATICTEXT|1| |1|0|1|1|1|9| |~(|AND|FIELDLIST|fromStateGstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|toStateGstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~(|AND|FIELDLIST|gstExempted| |==|STATICTEXT|0| |1|0|0|0|0|~)|~)|~)|~)|~(|else|0|0|0|1|1|0| |~)|]]></column>
			<where> Rulemodule='GSTRULE' and RULECODE = 'UGST'AND ACTIVE=1</where>
		</update>
	</changeSet>
	<changeSet id="22" author="Kesava">
		<sql>
			update SeqRules set SeqNo = (select max(RuleId)+1 from Rules);
		</sql>
	</changeSet>
	<changeSet id="23" author="Kesava">
		<update tableName="Rules">			
			<column name="SQLRULE" type="NCLOB"><![CDATA[ if (fromState == toState && (toUnionTerritory == '0' && (fromStateGstExempted == '0' && (toStateGstExempted == '0' && (gstExempted == '0'))))) {
	Result = 9 ; return;  
} else {
	Result = 0 ; return;  
}]]></column>
			<where> Rulemodule='GSTRULE' and RULECODE = 'CGST' AND ACTIVE=1</where>
		</update>
	</changeSet>
	<changeSet id="24" author="Kesava">
		<update tableName="Rules">
			<column name="SQLRULE" type="NCLOB"><![CDATA[ if (fromState !== toState && (toUnionTerritory == '0' && (fromStateGstExempted == '0' && (toStateGstExempted == '0' && (gstExempted == '0'))))) {
	Result = 18 ; return;  
} else {
	Result = 0 ; return;  
} ]]></column>
			<where> Rulemodule='GSTRULE' and RULECODE = 'IGST'AND ACTIVE=1</where>
		</update>
	</changeSet>
	<changeSet id="25" author="Kesava">
		<update tableName="Rules">
			<column name="SQLRULE" type="NCLOB"><![CDATA[ if (fromState == toState && (toUnionTerritory == '0' && (fromStateGstExempted == '0' && (toStateGstExempted == '0' && (gstExempted == '0'))))) {
	Result = 9 ; return;  
 } else {
	Result = 0 ; return;  
 } ]]>
 		</column>
			<where> Rulemodule='GSTRULE' and RULECODE = 'SGST'AND ACTIVE=1</where>
		</update>
	</changeSet>
	<changeSet id="26" author="Kesava">
		<update tableName="Rules">
			<column name="SQLRULE" type="NCLOB"><![CDATA[ if (toUnionTerritory == '1' && (fromStateGstExempted == '0' && (toStateGstExempted == '0' && (gstExempted == '0')))) {
	Result = 9 ; return;  
} else {
	Result = 0 ; return;  
}]]></column>
			<where> Rulemodule='GSTRULE' and RULECODE = 'UGST'AND ACTIVE=1</where>
		</update>
	</changeSet>

	<changeSet id="27" author="Kesava">
		<sql>
			Update Entity set GSTINAvailable = 0 where GSTINAvailable is null;
			Update Entity_Temp set GSTINAvailable = 0 where GSTINAvailable is null;
		</sql>
	</changeSet>
	
	<changeSet id="28" author="Kesava">
		<createTable tableName="GST_Invoice_Txn">
			<column name="InvoiceNo" type="varchar(50)">
				<constraints primaryKey="true"  nullable="false" />
			</column>
			<column name="TransactionID" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="InvoiceDate" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="Invoice_Amt" type="NUMBER(19,5)">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="CompanyCode" type="varchar(8)">
				<constraints nullable="false" />
			</column>
			<column name="CompanyName" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="Company_GSTIN" type="varchar(100)">
				<constraints nullable="false" />
			</column>
			<column name="Company_Address1" type="varchar(1000)">
				<constraints nullable="false" />
			</column>
			<column name="Company_Address2" type="varchar(1000)"/>
			<column name="Company_Address3" type="varchar(1000)"/>
			<column name="Company_PINCode" type="varchar(10)">
				<constraints nullable="false" />
			</column>
			<column name="Company_State_Code" type="varchar(8)">
				<constraints nullable="false" />
			</column>
			<column name="Company_State_Name" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="HSNNumber" type="varchar(100)">
				<constraints nullable="false" />
			</column>
			<column name="NatureService" type="varchar(100)">
				<constraints nullable="false" />
			</column>
			<column name="PanNumber" type="varchar(10)" />
			<column name="LoanAccountNo" type="varchar(20)" />
			<column name="CustomerID" type="varchar(20)" />	<!--  Need to clarity with custCif or CustId-->
			<column name="CustomerName" type="varchar(150)">
				<constraints nullable="false" />
			</column>
			<column name="CustomerGSTIN" type="varchar(100)"/>
			<column name="CustomerStateCode" type="varchar(2)" />
			<column name="CustomerStateName" type="varchar(50)" />
			<column name="CustomerAddress" type="varchar(1000)" />
			<column name="Invoice_Status" type="varchar(1)">
				<constraints nullable="false" />
			</column>
		</createTable>
	</changeSet>
	
	<changeSet id="29" author="Kesava">
		<createTable tableName="GST_Invoice_Txn_Details">
			<column name="InvoiceNo" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="FeeCode" type="varchar(8)">
				<constraints nullable="false" />
			</column>
			<column name="FeeDescription" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="CGST_RATE" type="NUMBER(5,2)" />
			<column name="CGST_AMT" type="NUMBER(19,5)" />
			<column name="SGST_RATE" type="NUMBER(5,2)" />
			<column name="SGST_AMT" type="NUMBER(19,5)" />
			<column name="IGST_RATE" type="NUMBER(5,2)" />
			<column name="IGST_AMT" type="NUMBER(19,5)" />
			<column name="UGST_RATE" type="NUMBER(5,2)" />
			<column name="UGST_AMT" type="NUMBER(19,5)" />
		</createTable>
	</changeSet>
	
	<changeSet id="30" author="Kesav">
		<createTable tableName="SeqGst_invoice_txn">
			<column name="SeqNo" type="bigint" />
		</createTable>
	</changeSet>
	
	<changeSet id="31" author="Kesav">
		<sql>
			Insert into SeqGst_invoice_txn values (0);
		</sql>
	</changeSet>
	
	<changeSet id="32" author="Kesav">
		<sql>
			delete from REPORTFILTERFIELDS where reportid=(select reportid from reportconfiguration where menuitemcode='menu_Item_GST_InvoiceReport');
			delete from REPORTCONFIGURATION where menuitemcode='menu_Item_GST_InvoiceReport';
			
			Insert into REPORTCONFIGURATION 
			values ((select max(reportid)+1 from REPORTCONFIGURATION),'GST Invoice Report','GST Invoice Report',1,'InvoiceReport','dataSource',1,'menu_Item_GST_InvoiceReport',1,1000,null,null,null,null,null,null,0,current_timestamp,1,1);
			
			Insert into REPORTFILTERFIELDS 
			values ((select reportid from reportconfiguration where menuitemcode='menu_Item_GST_InvoiceReport'),1,'CustCIF','LOVSEARCH','Customer ID','customerid',null,'Customer','getCustCIF','getCustShrtName',0,0,0,0,1,0,' ',' ',' ',' ',250,0,'=',1,1000,'Approved',null,null,null,null,null,0,current_timestamp,null);
			
			Insert into REPORTFILTERFIELDS 
			values ((select reportid from reportconfiguration where menuitemcode='menu_Item_GST_InvoiceReport'),2,'FinReference','LOVSEARCH','Loan Reference','loanaccountno',null,'FinanceMain','getFinReference','getFinReference',0,0,0,0,2,0,' ',' ',' ',' ',250,0,'=',1,1000,'Approved',null,null,null,null,null,0,current_timestamp,null);
			
			Insert into REPORTFILTERFIELDS
			values ((select reportid from reportconfiguration where menuitemcode='menu_Item_GST_InvoiceReport'),3,'Invoice Number','TXT','Invoice Number','invoiceno',null,null,null,null,0,20,0,0,3,0,null,null,null,null,250,0,'%',4,1000,'Approved',null,null,null,null,null,0,current_timestamp,null);
			
			Insert into REPORTFILTERFIELDS 
			values ((select reportid from reportconfiguration where menuitemcode='menu_Item_GST_InvoiceReport'),4,'Date','DATERANGE','Date','invoicedate',null,'---Select----',null,null,0,0,0,0,4,0,null,null,null,null,150,0,'=',3,1000,'Approved',null,null,null,null,null,0,current_timestamp,null);
		</sql>
	</changeSet>
	
	
	 <changeSet id="33" author="Kesav">
	 	<comment> cgst, sgst, ugst and igst columns added for GST changes</comment>
		<createView viewName="finfeescheduledetail_aview" replaceIfExists="true">
			 SELECT t1.feeid,
				    t1.schdate,
				    t1.schamount,
				    t1.paidamount,
				    t1.osamount,
				    t1.waiveramount,
				    t1.writeoffamount,
				    t2.finreference,
				    t2.feetypeid,
				    t2.finevent,
					t1.cgst,
				    t1.sgst,
				    t1.ugst,
				    t1.igst
				   FROM finfeescheduledetail t1
				     JOIN finfeedetail t2 ON t1.feeid = t2.feeid
     	</createView>
	</changeSet>
	
	<changeSet author="Kesav" id="34">
		<dropPrimaryKey tableName="GST_Invoice_Txn" constraintName="pk_gst_invoice_txn"/>
	</changeSet>
	
	<changeSet author="Kesav" id="35">
		<addPrimaryKey tableName="GST_Invoice_Txn" constraintName="pk_gst_invoice_txn" columnNames="invoiceno"/>
	</changeSet>
	
	<changeSet author="Kesav" id="36">
		<comment> Drop Null Constraint</comment>
		<dropNotNullConstraint tableName="GST_Invoice_Txn" columnName="Invoice_Amt" columnDataType="NUMBER(19,5)" />	
	</changeSet>
	
	<changeSet author="Kesav" id="37">
		<comment> Drop Null Constraint</comment>
		<dropNotNullConstraint tableName="GST_Invoice_Txn" columnName="Company_GSTIN" columnDataType="varchar(100)" />
	</changeSet>
	
	<changeSet author="Kesav" id="38">
		<comment> Drop Null Constraint</comment>
		<dropNotNullConstraint tableName="GST_Invoice_Txn" columnName="Company_Address1" columnDataType="varchar(1000)" />
	</changeSet>
	
	<changeSet author="Kesav" id="39">
		<comment> Drop Null Constraint</comment>
		<dropNotNullConstraint tableName="GST_Invoice_Txn" columnName="Company_PINCode" columnDataType="varchar(10)" />
	</changeSet>
	
	<changeSet author="Kesav" id="40">
		<comment> Drop Null Constraint</comment>
		<dropNotNullConstraint tableName="GST_Invoice_Txn" columnName="Company_State_Code" columnDataType="varchar(8)" />
	</changeSet>
	
	<changeSet author="Kesav" id="41">
		<comment> Drop Null Constraint</comment>
		<dropNotNullConstraint tableName="GST_Invoice_Txn" columnName="Company_State_Name" columnDataType="varchar(50)" />
	</changeSet>
	
	<changeSet author="Kesav" id="42">
		<comment> Drop Null Constraint</comment>
		<dropNotNullConstraint tableName="GST_Invoice_Txn" columnName="HSNNumber" columnDataType="varchar(100)" />
	</changeSet>
	
	<changeSet author="Kesav" id="43">
		<comment> Drop Null Constraint</comment>
		<dropNotNullConstraint tableName="GST_Invoice_Txn" columnName="NatureService" columnDataType="varchar(100)" />
	</changeSet>
	
	<changeSet author="Kesav" id="44">
		<comment> Drop Null Constraint</comment>
		<dropNotNullConstraint tableName="GST_Invoice_Txn" columnName="CustomerName" columnDataType="varchar(150)" />
	</changeSet>
	
	<changeSet author="Kesav" id="45">
		<comment> Drop Null Constraint</comment>
		<dropNotNullConstraint tableName="GST_Invoice_Txn" columnName="Invoice_Status" columnDataType="varchar(1)" />		
	</changeSet>
	
	<changeSet author="Kesav" id="46">
		<comment> Drop Null Constraint</comment>
		<dropNotNullConstraint tableName="GST_Invoice_Txn" columnName="CompanyCode" columnDataType="varchar(8)" />
	</changeSet>
	
	<changeSet author="Kesav" id="47">
		<comment> Drop Null Constraint</comment>
		<dropNotNullConstraint tableName="GST_Invoice_Txn" columnName="CompanyName" columnDataType="varchar(50)" />
	</changeSet>
	
	<changeSet author="Kesav" id="48">
		<comment> data type modified from varchar(8) to varchar(20)</comment>
		<modifyDataType tableName="GST_Invoice_Txn_Details" columnName="FeeCode" newDataType="varchar(20)" />
	</changeSet> 
	
	<changeSet author="Kesav" id="49">
		<comment> data type modified from NUMBER(19,5) to NUMBER(18,0)</comment>
		<modifyDataType tableName="GST_Invoice_Txn_Details" columnName="UGST_AMT" newDataType="NUMBER(18,0)" />
	</changeSet>
	
	<changeSet author="Kesav" id="50">
		<comment> data type modified from NUMBER(19,5) to NUMBER(18,0)</comment>
		<modifyDataType tableName="GST_Invoice_Txn" columnName="Invoice_Amt" newDataType="NUMBER(18,0)" />
	</changeSet>
	
	<changeSet author="Kesav" id="51">
		<comment> data type modified from NUMBER(19,5) to NUMBER(18,0)</comment>
		<modifyDataType tableName="GST_Invoice_Txn_Details" columnName="CGST_AMT" newDataType="NUMBER(18,0)" />
	</changeSet>
		
	<changeSet author="Kesav" id="52">
		<comment> data type modified from NUMBER(19,5) to NUMBER(18,0)</comment>
		<modifyDataType tableName="GST_Invoice_Txn_Details" columnName="SGST_AMT" newDataType="NUMBER(18,0)" />
	</changeSet>
	
	<changeSet author="Kesav" id="53">
		<comment> data type modified from NUMBER(19,5) to NUMBER(18,0)</comment>
		<modifyDataType tableName="GST_Invoice_Txn_Details" columnName="IGST_AMT" newDataType="NUMBER(18,0)" />
	</changeSet>
	
	<changeSet id="54" author="Kesav">
		<comment>TaxApplicable and TaxComponent columns added for GST changes</comment>
		<createView viewName="Manualadvise_View" replaceIfExists="true">
			SELECT t1.adviseid,
			    t1.advisetype,
			    t1.finreference,
			    t1.feetypeid,
			    t1.sequence,
			    t1.adviseamount,
			    t1.paidamount,
			    t1.waivedamount,
			    t1.remarks,
			    t1.valuedate,
			    t1.postdate,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.feetypedesc,
			    t2.feetypecode,
			    t1.bounceid,
			    t1.receiptid,
			    t3.bouncecode,
			    t1.reservedamt,
			    t1.balanceamt,
			    t3.reason AS bouncecodedesc,
			    t2.TaxApplicable,
			    t2.TaxComponent
			   FROM manualadvise_temp t1
			     LEFT JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
			     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid
			UNION ALL
			 SELECT t1.adviseid,
			    t1.advisetype,
			    t1.finreference,
			    t1.feetypeid,
			    t1.sequence,
			    t1.adviseamount,
			    t1.paidamount,
			    t1.waivedamount,
			    t1.remarks,
			    t1.valuedate,
			    t1.postdate,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.feetypedesc,
			    t2.feetypecode,
			    t1.bounceid,
			    t1.receiptid,
			    t3.bouncecode,
			    t1.reservedamt,
			    t1.balanceamt,
			    t3.reason AS bouncecodedesc,
			    t2.TaxApplicable,
			    t2.TaxComponent
			   FROM manualadvise t1
			     LEFT JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
			     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid
			  WHERE NOT (EXISTS ( SELECT 1
			           FROM manualadvise_temp
			          WHERE manualadvise_temp.adviseid = t1.adviseid))			
		</createView>	
	</changeSet>
	
	<changeSet id="55" author="Kesav">
		<comment>TaxApplicable and TaxComponent columns added for GST changes</comment>
		<createView viewName="manualadvise_tview" replaceIfExists="true">
			SELECT t1.adviseid,
			    t1.advisetype,
			    t1.finreference,
			    t1.feetypeid,
			    t1.sequence,
			    t1.adviseamount,
			    t1.paidamount,
			    t1.waivedamount,
			    t1.remarks,
			    t1.valuedate,
			    t1.postdate,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.feetypedesc,
			    t2.feetypecode,
			    t1.bounceid,
			    t1.receiptid,
			    t3.bouncecode,
			    t1.reservedamt,
			    t1.balanceamt,
			    t3.reason AS bouncecodedesc,
				t2.TaxApplicable,
			    t2.TaxComponent
			   FROM manualadvise_temp t1
			     LEFT JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
			     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid			
		</createView>	
	</changeSet>
	
	<changeSet id="56" author="Kesav">
		<comment>TaxApplicable and TaxComponent columns added for GST changes</comment>
		<createView viewName="manualadvise_lview" replaceIfExists="true">
			SELECT t1.adviseid,
			    t1.advisetype,
			    t1.finreference,
			    t1.feetypeid,
			    t1.sequence,
			    t1.adviseamount,
			    t1.paidamount,
			    t1.waivedamount,
			    t1.remarks,
			    t1.valuedate,
			    t1.postdate,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.feetypedesc,
			    t2.feetypecode,
			    t1.bounceid,
			    t1.receiptid,
			    t3.bouncecode,
			    t1.reservedamt,
			    t1.balanceamt,
			    t3.reason AS bouncecodedesc,
				t2.TaxApplicable,
			    t2.TaxComponent
			   FROM manualadvise t1
			     JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
			     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid			
		</createView>	
	</changeSet>
	
	<changeSet id="57" author="Kesav">
		<comment>TaxApplicable and TaxComponent columns added for GST changes</comment>
		<createView viewName="manualadvise_aview" replaceIfExists="true">
			SELECT t1.adviseid,
			    t1.advisetype,
			    t1.finreference,
			    t1.feetypeid,
			    t1.sequence,
			    t1.adviseamount,
			    t1.paidamount,
			    t1.waivedamount,
			    t1.remarks,
			    t1.valuedate,
			    t1.postdate,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.feetypedesc,
			    t2.feetypecode,
			    t1.bounceid,
			    t1.receiptid,
			    t3.bouncecode,
			    t1.reservedamt,
			    t1.balanceamt,
			    t3.reason AS bouncecodedesc,
				t2.TaxApplicable,
			    t2.TaxComponent
			   FROM manualadvise t1
			     LEFT JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
			     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid			
		</createView>	
	</changeSet>
	
	<changeSet author="Kesav" id="58">
		<comment> data type modified from NUMBER(18,0) to decimal(18,0)</comment>
		<modifyDataType tableName="GST_Invoice_Txn_Details" columnName="UGST_AMT" newDataType="decimal(18,0)" />
	</changeSet>
	
	<changeSet author="Kesav" id="59">
		<comment> data type modified from NUMBER(18,0) to decimal(18,0)</comment>
		<modifyDataType tableName="GST_Invoice_Txn" columnName="Invoice_Amt" newDataType="decimal(18,0)" />
	</changeSet>
	
	<changeSet author="Kesav" id="60">
		<comment> data type modified from NUMBER(18,0) to decimal(18,0)</comment>
		<modifyDataType tableName="GST_Invoice_Txn_Details" columnName="CGST_AMT" newDataType="decimal(18,0)" />
	</changeSet>
		
	<changeSet author="Kesav" id="61">
		<comment> data type modified from NUMBER(18,0) to decimal(18,0)</comment>
		<modifyDataType tableName="GST_Invoice_Txn_Details" columnName="SGST_AMT" newDataType="decimal(18,0)" />
	</changeSet>
	
	<changeSet author="Kesav" id="62">
		<comment> data type modified from NUMBER(18,0) to decimal(18,0)</comment>
		<modifyDataType tableName="GST_Invoice_Txn_Details" columnName="IGST_AMT" newDataType="decimal(18,0)" />
	</changeSet>
	
	<changeSet author="Kesav" id="63">
		<comment> data type modified from NUMBER(5,2) to decimal(5,2)</comment>
		<modifyDataType tableName="GST_Invoice_Txn_Details" columnName="CGST_RATE" newDataType="decimal(5,2)" />
	</changeSet>
	
	<changeSet author="Kesav" id="64">
		<comment> data type modified from NUMBER(5,2) to decimal(5,2)</comment>
		<modifyDataType tableName="GST_Invoice_Txn_Details" columnName="SGST_RATE" newDataType="decimal(5,2)" />
	</changeSet>
	
	<changeSet author="Kesav" id="65">
		<comment> data type modified from NUMBER(5,2) to decimal(5,2)</comment>
		<modifyDataType tableName="GST_Invoice_Txn_Details" columnName="IGST_RATE" newDataType="decimal(5,2)" />
	</changeSet>
	
	<changeSet author="Kesav" id="66">
		<comment> data type modified from NUMBER(5,2) to decimal(5,2)</comment>
		<modifyDataType tableName="GST_Invoice_Txn_Details" columnName="UGST_RATE" newDataType="decimal(5,2)" />
	</changeSet>
	<changeSet id="67" author="Jayant" dbms="postgresql">
		<sql>
			select deps_save_and_drop_dependencies('plf','feetypes');
		</sql>
	</changeSet>
	<changeSet id="68" author="Jayant" dbms="postgresql">
		<sql>
			select deps_save_and_drop_dependencies('plf','feetypes_temp');
		</sql>
	</changeSet>
	<changeSet id="69" author="Jayant">
		<modifyDataType tableName="feetypes" columnName="TaxApplicable" newDataType="boolean"/>
		<modifyDataType tableName="feetypes_temp" columnName="TaxApplicable" newDataType="boolean"/>
	</changeSet>
	<changeSet id="70" author="Jayant" dbms="postgresql">
		<sql>
			select deps_restore_dependencies('plf','feetypes');
		</sql>
	</changeSet>
	<changeSet id="71" author="Jayant" dbms="postgresql">
		<sql>
			select deps_restore_dependencies('plf','feetypes_temp');
		</sql>
	</changeSet>
	<changeSet id="72" author="Kesav">
		<comment>coalesce added in TaxApplicable column for GST changes</comment>
		<createView viewName="Manualadvise_View" replaceIfExists="true">
			SELECT t1.adviseid,
			    t1.advisetype,
			    t1.finreference,
			    t1.feetypeid,
			    t1.sequence,
			    t1.adviseamount,
			    t1.paidamount,
			    t1.waivedamount,
			    t1.remarks,
			    t1.valuedate,
			    t1.postdate,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.feetypedesc,
			    t2.feetypecode,
			    t1.bounceid,
			    t1.receiptid,
			    t3.bouncecode,
			    t1.reservedamt,
			    t1.balanceamt,
			    t3.reason AS bouncecodedesc,
			    coalesce(t2.TaxApplicable,0) TaxApplicable,
			    t2.TaxComponent
			   FROM manualadvise_temp t1
			     LEFT JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
			     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid
			UNION ALL
			 SELECT t1.adviseid,
			    t1.advisetype,
			    t1.finreference,
			    t1.feetypeid,
			    t1.sequence,
			    t1.adviseamount,
			    t1.paidamount,
			    t1.waivedamount,
			    t1.remarks,
			    t1.valuedate,
			    t1.postdate,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.feetypedesc,
			    t2.feetypecode,
			    t1.bounceid,
			    t1.receiptid,
			    t3.bouncecode,
			    t1.reservedamt,
			    t1.balanceamt,
			    t3.reason AS bouncecodedesc,
			    coalesce(t2.TaxApplicable,0) TaxApplicable,
			    t2.TaxComponent
			   FROM manualadvise t1
			     LEFT JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
			     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid
			  WHERE NOT (EXISTS ( SELECT 1
			           FROM manualadvise_temp
			          WHERE manualadvise_temp.adviseid = t1.adviseid))			
		</createView>	
	</changeSet>
	
	<changeSet id="73" author="Kesav">
		<comment>coalesce added in TaxApplicable column for GST changes</comment>
		<createView viewName="manualadvise_tview" replaceIfExists="true">
			SELECT t1.adviseid,
			    t1.advisetype,
			    t1.finreference,
			    t1.feetypeid,
			    t1.sequence,
			    t1.adviseamount,
			    t1.paidamount,
			    t1.waivedamount,
			    t1.remarks,
			    t1.valuedate,
			    t1.postdate,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.feetypedesc,
			    t2.feetypecode,
			    t1.bounceid,
			    t1.receiptid,
			    t3.bouncecode,
			    t1.reservedamt,
			    t1.balanceamt,
			    t3.reason AS bouncecodedesc,
				coalesce(t2.TaxApplicable,0) TaxApplicable,
			    t2.TaxComponent
			   FROM manualadvise_temp t1
			     LEFT JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
			     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid			
		</createView>	
	</changeSet>
	
	<changeSet id="74" author="Kesav">
		<comment>coalesce added in TaxApplicable column for GST changes</comment>
		<createView viewName="manualadvise_lview" replaceIfExists="true">
			SELECT t1.adviseid,
			    t1.advisetype,
			    t1.finreference,
			    t1.feetypeid,
			    t1.sequence,
			    t1.adviseamount,
			    t1.paidamount,
			    t1.waivedamount,
			    t1.remarks,
			    t1.valuedate,
			    t1.postdate,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.feetypedesc,
			    t2.feetypecode,
			    t1.bounceid,
			    t1.receiptid,
			    t3.bouncecode,
			    t1.reservedamt,
			    t1.balanceamt,
			    t3.reason AS bouncecodedesc,
				coalesce(t2.TaxApplicable,0) TaxApplicable,
			    t2.TaxComponent
			   FROM manualadvise t1
			     JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
			     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid			
		</createView>	
	</changeSet>
	
	<changeSet id="75" author="Kesav">
		<comment>coalesce added in TaxApplicable column for GST changes</comment>
		<createView viewName="manualadvise_aview" replaceIfExists="true">
			SELECT t1.adviseid,
			    t1.advisetype,
			    t1.finreference,
			    t1.feetypeid,
			    t1.sequence,
			    t1.adviseamount,
			    t1.paidamount,
			    t1.waivedamount,
			    t1.remarks,
			    t1.valuedate,
			    t1.postdate,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.feetypedesc,
			    t2.feetypecode,
			    t1.bounceid,
			    t1.receiptid,
			    t3.bouncecode,
			    t1.reservedamt,
			    t1.balanceamt,
			    t3.reason AS bouncecodedesc,
				coalesce(t2.TaxApplicable,0) TaxApplicable,
			    t2.TaxComponent
			   FROM manualadvise t1
			     LEFT JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
			     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid			
		</createView>	
	</changeSet>
	
	<changeSet author="Kesav" id="76">
		<comment> new columns added for GST calculations</comment>
		<addColumn tableName="ManualAdvise_Temp">
			<column name="PaidCgst" type="decimal(18,0)" defaultValue="0"/>
			<column name="PaidSgst" type="decimal(18,0)" defaultValue="0"/>
			<column name="PaidUgst" type="decimal(18,0)" defaultValue="0"/>
			<column name="PaidIgst" type="decimal(18,0)" defaultValue="0"/>
		</addColumn>
	</changeSet>
	
	<changeSet author="Kesav" id="77">
		<comment> new columns added for GST calculations</comment>
		<addColumn tableName="ManualAdvise">
			<column name="PaidCgst" type="decimal(18,0)" defaultValue="0"/>
			<column name="PaidSgst" type="decimal(18,0)" defaultValue="0"/>
			<column name="PaidUgst" type="decimal(18,0)" defaultValue="0"/>
			<column name="PaidIgst" type="decimal(18,0)" defaultValue="0"/>
		</addColumn>
	</changeSet>
	
	<changeSet id="78" author="Kesav">
		<comment> Old fields updated </comment>
		<sql>
			Update ManualAdvise set PaidCgst = 0 where PaidCgst is null; 
			Update ManualAdvise set PaidSgst = 0 where PaidSgst is null; 
			Update ManualAdvise set PaidUgst = 0 where PaidUgst is null; 
			Update ManualAdvise set PaidIgst = 0 where PaidIgst is null; 
			
			Update ManualAdvise_Temp set PaidCgst = 0 where PaidCgst is null; 
			Update ManualAdvise_Temp set PaidSgst = 0 where PaidSgst is null; 
			Update ManualAdvise_Temp set PaidUgst = 0 where PaidUgst is null; 
			Update ManualAdvise_Temp set PaidIgst = 0 where PaidIgst is null; 
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="79">
		<comment> new columns added for GST calculations</comment>
		<addColumn tableName="manualadvisemovements_Temp">
			<column name="PaidCgst" type="decimal(18,0)" defaultValue="0"/>
			<column name="PaidSgst" type="decimal(18,0)" defaultValue="0"/>
			<column name="PaidUgst" type="decimal(18,0)" defaultValue="0"/>
			<column name="PaidIgst" type="decimal(18,0)" defaultValue="0"/>
		</addColumn>
	</changeSet>
	
	<changeSet author="Kesav" id="80">
		<comment> new columns added for GST calculations</comment>
		<addColumn tableName="manualadvisemovements">
			<column name="PaidCgst" type="decimal(18,0)" defaultValue="0"/>
			<column name="PaidSgst" type="decimal(18,0)" defaultValue="0"/>
			<column name="PaidUgst" type="decimal(18,0)" defaultValue="0"/>
			<column name="PaidIgst" type="decimal(18,0)" defaultValue="0"/>
		</addColumn>
	</changeSet>
	
	<changeSet id="81" author="Kesav">
		<comment> Old fields updated </comment>
		<sql>
			Update manualadvisemovements set PaidCgst = 0 where PaidCgst is null; 
			Update manualadvisemovements set PaidSgst = 0 where PaidSgst is null; 
			Update manualadvisemovements set PaidUgst = 0 where PaidUgst is null; 
			Update manualadvisemovements set PaidIgst = 0 where PaidIgst is null; 
			
			Update manualadvisemovements_Temp set PaidCgst = 0 where PaidCgst is null; 
			Update manualadvisemovements_Temp set PaidSgst = 0 where PaidSgst is null; 
			Update manualadvisemovements_Temp set PaidUgst = 0 where PaidUgst is null; 
			Update manualadvisemovements_Temp set PaidIgst = 0 where PaidIgst is null; 
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="82">
		<comment> new columns added for GST calculations</comment>
		<addColumn tableName="receiptallocationdetail_Temp">
			<column name="PaidGST" type="decimal(18,0)" defaultValue="0"/>
		</addColumn>
	</changeSet>
	
	<changeSet author="Kesav" id="83">
		<comment> new columns added for GST calculations</comment>
		<addColumn tableName="receiptallocationdetail">
			<column name="PaidGST" type="decimal(18,0)" defaultValue="0"/>
		</addColumn>
	</changeSet>
	
	<changeSet id="84" author="Kesav">
		<comment> Old fields updated </comment>
		<sql>
			Update receiptallocationdetail set PaidGST = 0 where PaidGST is null; 
			Update receiptallocationdetail_Temp set PaidGST = 0 where PaidGST is null; 
		</sql>
	</changeSet>
	
	<changeSet id="85" author="Kesav">
		<comment>PaidCgst, PaidSgst, PaidIgst, PaidUgst columns added for GST changes</comment>
		<createView viewName="manualadvise_aview" replaceIfExists="true">
			SELECT t1.adviseid,
			    t1.advisetype,
			    t1.finreference,
			    t1.feetypeid,
			    t1.sequence,
			    t1.adviseamount,
			    t1.paidamount,
			    t1.waivedamount,
			    t1.remarks,
			    t1.valuedate,
			    t1.postdate,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.feetypedesc,
			    t2.feetypecode,
			    t1.bounceid,
			    t1.receiptid,
			    t3.bouncecode,
			    t1.reservedamt,
			    t1.balanceamt,
			    t3.reason AS bouncecodedesc,
			    COALESCE(t2.taxapplicable, 0) AS taxapplicable,
			    t2.taxcomponent,
			    t1.PaidCgst, t1.PaidSgst, t1.PaidIgst, t1.PaidUgst
			   FROM manualadvise t1
			     LEFT JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
			     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid		
		</createView>
	</changeSet>
	
	<changeSet id="86" author="Kesav">
		<comment>PaidCgst, PaidSgst, PaidIgst, PaidUgst columns added for GST changes</comment>
		<createView viewName="manualadvise_lview" replaceIfExists="true">
			SELECT t1.adviseid,
		    t1.advisetype,
		    t1.finreference,
		    t1.feetypeid,
		    t1.sequence,
		    t1.adviseamount,
		    t1.paidamount,
		    t1.waivedamount,
		    t1.remarks,
		    t1.valuedate,
		    t1.postdate,
		    t1.version,
		    t1.lastmntby,
		    t1.lastmnton,
		    t1.recordstatus,
		    t1.rolecode,
		    t1.nextrolecode,
		    t1.taskid,
		    t1.nexttaskid,
		    t1.recordtype,
		    t1.workflowid,
		    t2.feetypedesc,
		    t2.feetypecode,
		    t1.bounceid,
		    t1.receiptid,
		    t3.bouncecode,
		    t1.reservedamt,
		    t1.balanceamt,
		    t3.reason AS bouncecodedesc,
		    COALESCE(t2.taxapplicable, 0) AS taxapplicable,
		    t2.taxcomponent, t1.PaidCgst, t1.PaidSgst, t1.PaidIgst, t1.PaidUgst
		   FROM manualadvise t1
		     JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
		     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid
		</createView>
	</changeSet>
	
	<changeSet id="87" author="Kesav">
		<comment>PaidCgst, PaidSgst, PaidIgst, PaidUgst columns added for GST changes</comment>
		<createView viewName="manualadvise_tview" replaceIfExists="true">
			SELECT t1.adviseid,
			    t1.advisetype,
			    t1.finreference,
			    t1.feetypeid,
			    t1.sequence,
			    t1.adviseamount,
			    t1.paidamount,
			    t1.waivedamount,
			    t1.remarks,
			    t1.valuedate,
			    t1.postdate,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.feetypedesc,
			    t2.feetypecode,
			    t1.bounceid,
			    t1.receiptid,
			    t3.bouncecode,
			    t1.reservedamt,
			    t1.balanceamt,
			    t3.reason AS bouncecodedesc,
			    COALESCE(t2.taxapplicable, 0) AS taxapplicable,
			    t2.taxcomponent, t1.PaidCgst, t1.PaidSgst, t1.PaidIgst, t1.PaidUgst
			   FROM manualadvise_temp t1
			     LEFT JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
			     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid		
		</createView>
	</changeSet>
	
	<changeSet id="88" author="Kesav">
		<comment>PaidCgst, PaidSgst, PaidIgst, PaidUgst columns added for GST changes</comment>
		<createView viewName="manualadvise_view" replaceIfExists="true">
		SELECT t1.adviseid,
		    t1.advisetype,
		    t1.finreference,
		    t1.feetypeid,
		    t1.sequence,
		    t1.adviseamount,
		    t1.paidamount,
		    t1.waivedamount,
		    t1.remarks,
		    t1.valuedate,
		    t1.postdate,
		    t1.version,
		    t1.lastmntby,
		    t1.lastmnton,
		    t1.recordstatus,
		    t1.rolecode,
		    t1.nextrolecode,
		    t1.taskid,
		    t1.nexttaskid,
		    t1.recordtype,
		    t1.workflowid,
		    t2.feetypedesc,
		    t2.feetypecode,
		    t1.bounceid,
		    t1.receiptid,
		    t3.bouncecode,
		    t1.reservedamt,
		    t1.balanceamt,
		    t3.reason AS bouncecodedesc,
		    COALESCE(t2.taxapplicable, 0) AS taxapplicable,
		    t2.taxcomponent, t1.PaidCgst, t1.PaidSgst, t1.PaidIgst, t1.PaidUgst
		   FROM manualadvise_temp t1
		     LEFT JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
		     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid
		UNION ALL
		 SELECT t1.adviseid,
		    t1.advisetype,
		    t1.finreference,
		    t1.feetypeid,
		    t1.sequence,
		    t1.adviseamount,
		    t1.paidamount,
		    t1.waivedamount,
		    t1.remarks,
		    t1.valuedate,
		    t1.postdate,
		    t1.version,
		    t1.lastmntby,
		    t1.lastmnton,
		    t1.recordstatus,
		    t1.rolecode,
		    t1.nextrolecode,
		    t1.taskid,
		    t1.nexttaskid,
		    t1.recordtype,
		    t1.workflowid,
		    t2.feetypedesc,
		    t2.feetypecode,
		    t1.bounceid,
		    t1.receiptid,
		    t3.bouncecode,
		    t1.reservedamt,
		    t1.balanceamt,
		    t3.reason AS bouncecodedesc,
		    COALESCE(t2.taxapplicable, 0) AS taxapplicable,
		    t2.taxcomponent, t1.PaidCgst, t1.PaidSgst, t1.PaidIgst, t1.PaidUgst
		   FROM manualadvise t1
		     LEFT JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
		     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid
		  WHERE NOT (EXISTS ( SELECT 1
		           FROM manualadvise_temp
		          WHERE manualadvise_temp.adviseid = t1.adviseid))
		</createView>
	</changeSet>
	
	<changeSet id="89" author="Kesav">
		<comment>taxapplicable, taxcomponent, PaidCgst, PaidSgst, PaidIgst, PaidUgst columns added for GST changes</comment>
		<createView viewName="manualadvisemovements_tview" replaceIfExists="true">
			SELECT 		t1.movementid,
						t1.adviseid,
						t1.movementdate,
						t1.movementamount,
						t1.paidamount,
						t1.waivedamount,
						t1.status,
						t1.receiptid,
						t1.receiptseqid,
						t3.feetypecode, COALESCE(t3.taxapplicable, 0) AS taxapplicable,
						t3.taxcomponent, t1.PaidCgst, t1.PaidSgst, t1.PaidIgst, t1.PaidUgst
			FROM 		manualadvisemovements_temp t1
			JOIN 		manualadvise t2 ON t1.adviseid = t2.adviseid
			LEFT JOIN 	feetypes t3 ON t2.feetypeid = t3.feetypeid		
		</createView>
	</changeSet>
	
	<changeSet id="90" author="Kesav">
		<sql>
			Delete from BMTAMOUNTCODES where AllowedEvent = 'ADDDBSP' and AmountCode = 'ae_deductVasDisb';
			Delete from BMTAMOUNTCODES where AllowedEvent = 'ADDDBSP' and AmountCode = 'ae_addVasToFinance';
			Delete from BMTAMOUNTCODES where AllowedEvent = 'ADDDBSP' and AmountCode = 'ae_vasFeeWaived';
			Delete from BMTAMOUNTCODES where AllowedEvent = 'ADDDBSP' and AmountCode = 'ae_paidVasFee';
			
			Insert into BMTAMOUNTCODES values ('ADDDBSP',0,'ae_deductVasDisb','Deduct VAS Fee From Disbursement','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES values ('ADDDBSP',0,'ae_addVasToFinance','VAS Fee Added to Loan with current Diusbursement','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES values ('ADDDBSP',0,'ae_vasFeeWaived','VAS Fees Waived','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
			Insert into BMTAMOUNTCODES values ('ADDDBSP',0,'ae_paidVasFee','Total Paid VAS Fee','1',1,1005,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);			
		</sql>
	</changeSet>
	
	<changeSet id="91" author="Kesav">
		<addColumn tableName="BounceReasons">
			<column name="TaxApplicable" type="boolean" defaultValue="0" />
			<column name="TaxComponent" type="Char(1)"/>
		</addColumn>
	</changeSet>
	
	<changeSet id="92" author="Kesav">
		<addColumn tableName="BounceReasons_Temp">
			<column name="TaxApplicable" type="boolean" defaultValue="0" />
			<column name="TaxComponent" type="Char(1)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="93" author="Kesav">
		<sql>
			Update BounceReasons set TaxApplicable = 0 where TaxApplicable is null; 			
			Update BounceReasons_Temp set TaxApplicable = 0 where TaxApplicable is null; 			
		</sql>
	</changeSet>
	
	<changeSet id="94" author="Kesav">
		<comment>taxapplicable, taxcomponent columns added for GST changes</comment>
		<createView viewName="bouncereasons_aview" replaceIfExists="true">
			SELECT 	t1.bounceid,
				    t1.bouncecode,
				    t1.reasontype,
				    t1.category,
				    t1.reason,
				    t1.action,
				    t1.ruleid,
				    t1.returncode,
				    t1.active,
				    t1.version,
				    t1.lastmntby,
				    t1.lastmnton,
				    t1.recordstatus,
				    t1.rolecode,
				    t1.nextrolecode,
				    t1.taskid,
				    t1.nexttaskid,
				    t1.recordtype,
				    t1.workflowid,
				    t2.rulecode,
				    t2.rulecodedesc, t1.TaxComponent, t1.TaxApplicable
			FROM 	bouncereasons t1
			JOIN 	rules t2 ON t1.ruleid = t2.ruleid
		</createView>
	</changeSet>
	
	<changeSet id="95" author="Kesav">
		<comment>taxapplicable, taxcomponent columns added for GST changes</comment>
		<createView viewName="bouncereasons_view" replaceIfExists="true">
			SELECT 	t1.bounceid,
				    t1.bouncecode,
				    t1.reasontype,
				    t1.category,
				    t1.reason,
				    t1.action,
				    t1.ruleid,
				    t1.returncode,
				    t1.active,
				    t1.version,
				    t1.lastmntby,
				    t1.lastmnton,
				    t1.recordstatus,
				    t1.rolecode,
				    t1.nextrolecode,
				    t1.taskid,
				    t1.nexttaskid,
				    t1.recordtype,
				    t1.workflowid,
				    t2.rulecode,
				    t2.rulecodedesc, t1.TaxComponent, t1.TaxApplicable
			FROM 	bouncereasons_temp t1
			JOIN 	rules t2 ON t1.ruleid = t2.ruleid
			
			UNION ALL
			
			SELECT 	t1.bounceid,
				    t1.bouncecode,
				    t1.reasontype,
				    t1.category,
				    t1.reason,
				    t1.action,
				    t1.ruleid,
				    t1.returncode,
				    t1.active,
				    t1.version,
				    t1.lastmntby,
				    t1.lastmnton,
				    t1.recordstatus,
				    t1.rolecode,
				    t1.nextrolecode,
				    t1.taskid,
				    t1.nexttaskid,
				    t1.recordtype,
				    t1.workflowid,
				    t2.rulecode,
				    t2.rulecodedesc, t1.TaxComponent, t1.TaxApplicable
			FROM 	bouncereasons t1
			JOIN 	rules t2 ON t1.ruleid = t2.ruleid
			WHERE NOT (EXISTS ( SELECT 1 FROM bouncereasons_temp WHERE bouncereasons_temp.bounceid = t1.bounceid))
		</createView>
	</changeSet>
	
	<changeSet id="96" author="Kesav">
		<sql>
			Update SeqSecGroups Set SeqNo = (Select MAX(GrpID) + 1 from SecGroups);
			Update SeqSecRights Set SeqNo = (Select MAX(RightID) + 1 from SecRights);
			Update SeqSecGroupRights Set SeqNo = (Select MAX(GrpRightID) + 1 from SecGroupRights);
			Update SeqSecRoleGroups Set SeqNo = (Select MAX(RoleGrpID) + 1 from SecRoleGroups);
			
			Delete from SecGroupRights where RightID In (Select RightID from SecRights where RightName = 'BounceReasonDialog_TaxApplicable');
			Delete from SecRights where RightName = 'BounceReasonDialog_TaxApplicable';
			
			Insert into SecRights Values((Select max(RightID) + 1 from SecRights), 3, 'BounceReasonDialog_TaxApplicable', 'BounceReasonDialog', 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'BOUNCEREASON_MAKER'), (Select RightID from SecRights where RightName = 'BounceReasonDialog_TaxApplicable'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Delete from SecGroupRights where RightID In (Select RightID from SecRights where RightName = 'BounceReasonDialog_TaxComponent');
			Delete from SecRights where RightName = 'BounceReasonDialog_TaxComponent';
			
			Insert into SecRights Values((Select max(RightID) + 1 from SecRights), 3, 'BounceReasonDialog_TaxComponent', 'BounceReasonDialog', 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'BOUNCEREASON_MAKER'), (Select RightID from SecRights where RightName = 'BounceReasonDialog_TaxComponent'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Update SeqSecGroups Set SeqNo = (Select MAX(GrpID) + 1 from SecGroups);
			Update SeqSecRights Set SeqNo = (Select MAX(RightID) + 1 from SecRights);
			Update SeqSecGroupRights Set SeqNo = (Select MAX(GrpRightID) + 1 from SecGroupRights);
			Update SeqSecRoleGroups Set SeqNo = (Select MAX(RoleGrpID) + 1 from SecRoleGroups);		
		</sql>
	</changeSet>
	
		
	<changeSet id="97" author="Kesav">
		<comment> Case added for TaxApplicable, TaxComponent columns</comment>
		<createView viewName="manualadvise_aview" replaceIfExists="true">
			SELECT t1.adviseid,
			    t1.advisetype,
			    t1.finreference,
			    t1.feetypeid,
			    t1.sequence,
			    t1.adviseamount,
			    t1.paidamount,
			    t1.waivedamount,
			    t1.remarks,
			    t1.valuedate,
			    t1.postdate,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.feetypedesc,
			    t2.feetypecode,
			    t1.bounceid,
			    t1.receiptid,
			    t3.bouncecode,
			    t1.reservedamt,
			    t1.balanceamt,
			    t3.reason AS bouncecodedesc,
			    Case when t1.feetypeid > 0 then COALESCE(t2.taxapplicable, 0) else COALESCE(t3.taxapplicable, 0) END AS TaxApplicable,
			    Case when t1.feeTypeid > 0 then t2.TaxComponent else t3.TaxComponent END AS TaxComponent,
			    t1.PaidCgst, t1.PaidSgst, t1.PaidIgst, t1.PaidUgst
			   FROM manualadvise t1
			     LEFT JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
			     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid		
		</createView>
	</changeSet>
	
	<changeSet id="98" author="Kesav">
		<comment> Case added for TaxApplicable, TaxComponent columns</comment>
		<createView viewName="manualadvise_lview" replaceIfExists="true">
			SELECT t1.adviseid,
		    t1.advisetype,
		    t1.finreference,
		    t1.feetypeid,
		    t1.sequence,
		    t1.adviseamount,
		    t1.paidamount,
		    t1.waivedamount,
		    t1.remarks,
		    t1.valuedate,
		    t1.postdate,
		    t1.version,
		    t1.lastmntby,
		    t1.lastmnton,
		    t1.recordstatus,
		    t1.rolecode,
		    t1.nextrolecode,
		    t1.taskid,
		    t1.nexttaskid,
		    t1.recordtype,
		    t1.workflowid,
		    t2.feetypedesc,
		    t2.feetypecode,
		    t1.bounceid,
		    t1.receiptid,
		    t3.bouncecode,
		    t1.reservedamt,
		    t1.balanceamt,
		    t3.reason AS bouncecodedesc,
		    Case when t1.feetypeid > 0 then COALESCE(t2.taxapplicable, 0) else COALESCE(t3.taxapplicable, 0) END AS TaxApplicable,
			Case when t1.feeTypeid > 0 then t2.TaxComponent else t3.TaxComponent END AS TaxComponent,
		    t1.PaidCgst, t1.PaidSgst, t1.PaidIgst, t1.PaidUgst
		   FROM manualadvise t1
		     JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
		     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid
		</createView>
	</changeSet>
	
	<changeSet id="99" author="Kesav">
		<comment> Case added for TaxApplicable, TaxComponent columns</comment>
		<createView viewName="manualadvise_tview" replaceIfExists="true">
			SELECT t1.adviseid,
			    t1.advisetype,
			    t1.finreference,
			    t1.feetypeid,
			    t1.sequence,
			    t1.adviseamount,
			    t1.paidamount,
			    t1.waivedamount,
			    t1.remarks,
			    t1.valuedate,
			    t1.postdate,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.feetypedesc,
			    t2.feetypecode,
			    t1.bounceid,
			    t1.receiptid,
			    t3.bouncecode,
			    t1.reservedamt,
			    t1.balanceamt,
			    t3.reason AS bouncecodedesc,
			    Case when t1.feetypeid > 0 then COALESCE(t2.taxapplicable, 0) else COALESCE(t3.taxapplicable, 0) END AS TaxApplicable,
			    Case when t1.feeTypeid > 0 then t2.TaxComponent else t3.TaxComponent END AS TaxComponent,
			    t1.PaidCgst, t1.PaidSgst, t1.PaidIgst, t1.PaidUgst
			   FROM manualadvise_temp t1
			     LEFT JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
			     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid		
		</createView>
	</changeSet>
	
	<changeSet id="100" author="Kesav">
		<comment> Case added for TaxApplicable, TaxComponent columns</comment>
		<createView viewName="manualadvise_view" replaceIfExists="true">
		SELECT t1.adviseid,
		    t1.advisetype,
		    t1.finreference,
		    t1.feetypeid,
		    t1.sequence,
		    t1.adviseamount,
		    t1.paidamount,
		    t1.waivedamount,
		    t1.remarks,
		    t1.valuedate,
		    t1.postdate,
		    t1.version,
		    t1.lastmntby,
		    t1.lastmnton,
		    t1.recordstatus,
		    t1.rolecode,
		    t1.nextrolecode,
		    t1.taskid,
		    t1.nexttaskid,
		    t1.recordtype,
		    t1.workflowid,
		    t2.feetypedesc,
		    t2.feetypecode,
		    t1.bounceid,
		    t1.receiptid,
		    t3.bouncecode,
		    t1.reservedamt,
		    t1.balanceamt,
		    t3.reason AS bouncecodedesc,
		    Case when t1.feetypeid > 0 then COALESCE(t2.taxapplicable, 0) else COALESCE(t3.taxapplicable, 0) END AS TaxApplicable,
			Case when t1.feeTypeid > 0 then t2.TaxComponent else t3.TaxComponent END AS TaxComponent,
		    t1.PaidCgst, t1.PaidSgst, t1.PaidIgst, t1.PaidUgst
		   FROM manualadvise_temp t1
		     LEFT JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
		     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid
		UNION ALL
		 SELECT t1.adviseid,
		    t1.advisetype,
		    t1.finreference,
		    t1.feetypeid,
		    t1.sequence,
		    t1.adviseamount,
		    t1.paidamount,
		    t1.waivedamount,
		    t1.remarks,
		    t1.valuedate,
		    t1.postdate,
		    t1.version,
		    t1.lastmntby,
		    t1.lastmnton,
		    t1.recordstatus,
		    t1.rolecode,
		    t1.nextrolecode,
		    t1.taskid,
		    t1.nexttaskid,
		    t1.recordtype,
		    t1.workflowid,
		    t2.feetypedesc,
		    t2.feetypecode,
		    t1.bounceid,
		    t1.receiptid,
		    t3.bouncecode,
		    t1.reservedamt,
		    t1.balanceamt,
		    t3.reason AS bouncecodedesc,
		    Case when t1.feetypeid > 0 then COALESCE(t2.taxapplicable, 0) else COALESCE(t3.taxapplicable, 0) END AS TaxApplicable,
			Case when t1.feeTypeid > 0 then t2.TaxComponent else t3.TaxComponent END AS TaxComponent,
		    t1.PaidCgst, t1.PaidSgst, t1.PaidIgst, t1.PaidUgst
		   FROM manualadvise t1
		     LEFT JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
		     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid
		  WHERE NOT (EXISTS ( SELECT 1
		           FROM manualadvise_temp
		          WHERE manualadvise_temp.adviseid = t1.adviseid))
		</createView>
	</changeSet>
	
	<changeSet id="101" author="Kesav">
		<comment>PaidGST column added for GST changes</comment>
		<createView viewName="receiptallocationdetail_aview" replaceIfExists="true">
			 SELECT t1.receiptallocationid,
				    t1.receiptid,
				    t1.allocationid,
				    t1.allocationtype,
				    t1.allocationto,
				    t1.paidamount,
				    t1.waivedamount,
				    COALESCE(t3.feetypedesc, t5.feetypedesc) AS typedesc,
				    t1.PaidGST
			FROM 	receiptallocationdetail t1
				    LEFT JOIN finfeedetail t2 ON t1.allocationto = t2.feeid AND t1.allocationtype = 'FEE'
				    LEFT JOIN feetypes t3 ON t2.feetypeid = t3.feetypeid
				    LEFT JOIN manualadvise t4 ON t1.allocationto = t4.adviseid AND t1.allocationtype = 'MANADV'
				    LEFT JOIN feetypes t5 ON t4.feetypeid = t5.feetypeid
		</createView>
	</changeSet>
	
	<changeSet id="102" author="Kesav">
		<comment>Existing Field descriptions changes</comment>
		<sql>
			UPdate RBFieldDetails set RbfldDesc = 'From State Union Territory' where RBModule = 'GSTRULE' and RBEvent = 'CGST' and rbfldName = 'fromUnionTerritory';
			UPdate RBFieldDetails set RbfldDesc = 'To State Union Territory' where RBModule = 'GSTRULE' and RBEvent = 'CGST' and rbfldName = 'toUnionTerritory';
			UPdate RBFieldDetails set RbfldDesc = 'GST Exempted' where RBModule = 'GSTRULE' and RBEvent = 'CGST' and rbfldName = 'gstExempted';
			UPdate RBFieldDetails set RbfldDesc = 'To State GST Exempted' where RBModule = 'GSTRULE' and RBEvent = 'CGST' and rbfldName = 'toStateGstExempted';
			
			UPdate RBFieldDetails set RbfldDesc = 'From State Union Territory' where RBModule = 'GSTRULE' and RBEvent = 'SGST' and rbfldName = 'fromUnionTerritory';
			UPdate RBFieldDetails set RbfldDesc = 'To State Union Territory' where RBModule = 'GSTRULE' and RBEvent = 'SGST' and rbfldName = 'toUnionTerritory';
			UPdate RBFieldDetails set RbfldDesc = 'GST Exempted' where RBModule = 'GSTRULE' and RBEvent = 'SGST' and rbfldName = 'gstExempted';
			UPdate RBFieldDetails set RbfldDesc = 'To State GST Exempted' where RBModule = 'GSTRULE' and RBEvent = 'SGST' and rbfldName = 'toStateGstExempted';
			
			UPdate RBFieldDetails set RbfldDesc = 'From State Union Territory' where RBModule = 'GSTRULE' and RBEvent = 'IGST' and rbfldName = 'fromUnionTerritory';
			UPdate RBFieldDetails set RbfldDesc = 'To State Union Territory' where RBModule = 'GSTRULE' and RBEvent = 'IGST' and rbfldName = 'toUnionTerritory';
			UPdate RBFieldDetails set RbfldDesc = 'GST Exempted' where RBModule = 'GSTRULE' and RBEvent = 'IGST' and rbfldName = 'gstExempted';
			UPdate RBFieldDetails set RbfldDesc = 'To State GST Exempted' where RBModule = 'GSTRULE' and RBEvent = 'IGST' and rbfldName = 'toStateGstExempted';
			
			UPdate RBFieldDetails set RbfldDesc = 'From State Union Territory' where RBModule = 'GSTRULE' and RBEvent = 'UGST' and rbfldName = 'fromUnionTerritory';
			UPdate RBFieldDetails set RbfldDesc = 'To State Union Territory' where RBModule = 'GSTRULE' and RBEvent = 'UGST' and rbfldName = 'toUnionTerritory';
			UPdate RBFieldDetails set RbfldDesc = 'GST Exempted' where RBModule = 'GSTRULE' and RBEvent = 'UGST' and rbfldName = 'gstExempted';
			UPdate RBFieldDetails set RbfldDesc = 'To State GST Exempted' where RBModule = 'GSTRULE' and RBEvent = 'UGST' and rbfldName = 'toStateGstExempted';
			
			UPdate RBFieldDetails set RbfldType = 'nchar' where RBModule = 'GSTRULE' and RBEvent = 'CGST' and rbfldName = 'toUnionTerritory';
			UPdate RBFieldDetails set RbfldType = 'nchar' where RBModule = 'GSTRULE' and RBEvent = 'SGST' and rbfldName = 'toUnionTerritory';
			UPdate RBFieldDetails set RbfldType = 'nchar' where RBModule = 'GSTRULE' and RBEvent = 'IGST' and rbfldName = 'toUnionTerritory';
			UPdate RBFieldDetails set RbfldType = 'nchar' where RBModule = 'GSTRULE' and RBEvent = 'UGST' and rbfldName = 'toUnionTerritory';		
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="103">
		<dropColumn tableName="BounceReasons" columnName="TaxApplicable"/>
		<dropColumn tableName="BounceReasons" columnName="TaxComponent"/>
		
		<dropColumn tableName="BounceReasons_Temp" columnName="TaxApplicable"/>
		<dropColumn tableName="BounceReasons_Temp" columnName="TaxComponent"/>
	</changeSet>
	
	<changeSet id="104" author="Kesav">
		<comment>taxapplicable, taxcomponent columns deleted for GST changes</comment>
		<createView viewName="bouncereasons_aview" replaceIfExists="true">
			SELECT  t1.bounceid,
				    t1.bouncecode,
				    t1.reasontype,
				    t1.category,
				    CASE WHEN t1.category = '1' THEN 'Technical'
				         WHEN t1.category = '2' THEN 'Non Technical'
				    END AS lovdesccategory,
				    t1.reason,
				    t1.action,
				    t1.ruleid,
				    t1.returncode,
				    t1.active,
				    t1.version,
				    t1.lastmntby,
				    t1.lastmnton,
				    t1.recordstatus,
				    t1.rolecode,
				    t1.nextrolecode,
				    t1.taskid,
				    t1.nexttaskid,
				    t1.recordtype,
				    t1.workflowid,
				    t2.rulecode,
				    t2.rulecodedesc
				   FROM bouncereasons t1
				     JOIN rules t2 ON t1.ruleid = t2.ruleid

		</createView>
	</changeSet>
	
	<changeSet id="105" author="Kesav">
		<comment>taxapplicable, taxcomponent columns deleted for GST changes</comment>
		<createView viewName="bouncereasons_view" replaceIfExists="true">
			SELECT t1.bounceid,
    t1.bouncecode,
    t1.reasontype,
    t1.category,
	CASE WHEN t1.category = '1' THEN 'Technical'
	     WHEN t1.category = '2' THEN 'Non Technical'
	END AS lovdesccategory,
    t1.reason,
    t1.action,
    t1.ruleid,
    t1.returncode,
    t1.active,
    t1.version,
    t1.lastmntby,
    t1.lastmnton,
    t1.recordstatus,
    t1.rolecode,
    t1.nextrolecode,
    t1.taskid,
    t1.nexttaskid,
    t1.recordtype,
    t1.workflowid,
    t2.rulecode,
    t2.rulecodedesc
   FROM bouncereasons_temp t1
     JOIN rules t2 ON t1.ruleid = t2.ruleid
UNION ALL
 SELECT t1.bounceid,
		t1.bouncecode,
		t1.reasontype,
		t1.category,
		CASE WHEN t1.category = '1' THEN 'Technical'
			 WHEN t1.category = '2' THEN 'Non Technical'
		END AS lovdesccategory,
		t1.reason,
		t1.action,
		t1.ruleid,
		t1.returncode,
		t1.active,
		t1.version,
		t1.lastmntby,
		t1.lastmnton,
		t1.recordstatus,
		t1.rolecode,
		t1.nextrolecode,
		t1.taskid,
		t1.nexttaskid,
		t1.recordtype,
		t1.workflowid,
		t2.rulecode,
		t2.rulecodedesc
   FROM bouncereasons t1
     JOIN rules t2 ON t1.ruleid = t2.ruleid
  WHERE NOT (EXISTS ( SELECT 1 FROM bouncereasons_temp WHERE bouncereasons_temp.bounceid = t1.bounceid))
		</createView>
	</changeSet>
	
	<changeSet id="106" author="Kesav">
		<comment>taxapplicable and taxcomponent columns values from FeeTypes</comment>
		<createView viewName="manualadvise_aview" replaceIfExists="true">
			SELECT t1.adviseid,
			    t1.advisetype,
			    t1.finreference,
			    t1.feetypeid,
			    t1.sequence,
			    t1.adviseamount,
			    t1.paidamount,
			    t1.waivedamount,
			    t1.remarks,
			    t1.valuedate,
			    t1.postdate,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.feetypedesc,
			    t2.feetypecode,
			    t1.bounceid,
			    t1.receiptid,
			    t3.bouncecode,
			    t1.reservedamt,
			    t1.balanceamt,
			    t3.reason AS bouncecodedesc,
			    COALESCE(t2.taxapplicable, 0) AS taxapplicable,
			    t2.taxcomponent,
			    t1.PaidCgst, t1.PaidSgst, t1.PaidIgst, t1.PaidUgst
			   FROM manualadvise t1
			     LEFT JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
			     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid		
		</createView>
	</changeSet>
	
	<changeSet id="107" author="Kesav">
		<comment>taxapplicable and taxcomponent columns values from FeeTypes</comment>
		<createView viewName="manualadvise_lview" replaceIfExists="true">
			SELECT t1.adviseid,
		    t1.advisetype,
		    t1.finreference,
		    t1.feetypeid,
		    t1.sequence,
		    t1.adviseamount,
		    t1.paidamount,
		    t1.waivedamount,
		    t1.remarks,
		    t1.valuedate,
		    t1.postdate,
		    t1.version,
		    t1.lastmntby,
		    t1.lastmnton,
		    t1.recordstatus,
		    t1.rolecode,
		    t1.nextrolecode,
		    t1.taskid,
		    t1.nexttaskid,
		    t1.recordtype,
		    t1.workflowid,
		    t2.feetypedesc,
		    t2.feetypecode,
		    t1.bounceid,
		    t1.receiptid,
		    t3.bouncecode,
		    t1.reservedamt,
		    t1.balanceamt,
		    t3.reason AS bouncecodedesc,
		    COALESCE(t2.taxapplicable, 0) AS taxapplicable,
		    t2.taxcomponent, t1.PaidCgst, t1.PaidSgst, t1.PaidIgst, t1.PaidUgst
		   FROM manualadvise t1
		     JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
		     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid
		</createView>
	</changeSet>
	
	<changeSet id="108" author="Kesav">
		<comment>taxapplicable and taxcomponent columns values from FeeTypes</comment>
		<createView viewName="manualadvise_tview" replaceIfExists="true">
			SELECT t1.adviseid,
			    t1.advisetype,
			    t1.finreference,
			    t1.feetypeid,
			    t1.sequence,
			    t1.adviseamount,
			    t1.paidamount,
			    t1.waivedamount,
			    t1.remarks,
			    t1.valuedate,
			    t1.postdate,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t2.feetypedesc,
			    t2.feetypecode,
			    t1.bounceid,
			    t1.receiptid,
			    t3.bouncecode,
			    t1.reservedamt,
			    t1.balanceamt,
			    t3.reason AS bouncecodedesc,
			    COALESCE(t2.taxapplicable, 0) AS taxapplicable,
			    t2.taxcomponent, t1.PaidCgst, t1.PaidSgst, t1.PaidIgst, t1.PaidUgst
			   FROM manualadvise_temp t1
			     LEFT JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
			     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid		
		</createView>
	</changeSet>
	
	<changeSet id="109" author="Kesav">
		<comment>taxapplicable and taxcomponent columns values from FeeTypes</comment>
		<createView viewName="manualadvise_view" replaceIfExists="true">
		SELECT t1.adviseid,
		    t1.advisetype,
		    t1.finreference,
		    t1.feetypeid,
		    t1.sequence,
		    t1.adviseamount,
		    t1.paidamount,
		    t1.waivedamount,
		    t1.remarks,
		    t1.valuedate,
		    t1.postdate,
		    t1.version,
		    t1.lastmntby,
		    t1.lastmnton,
		    t1.recordstatus,
		    t1.rolecode,
		    t1.nextrolecode,
		    t1.taskid,
		    t1.nexttaskid,
		    t1.recordtype,
		    t1.workflowid,
		    t2.feetypedesc,
		    t2.feetypecode,
		    t1.bounceid,
		    t1.receiptid,
		    t3.bouncecode,
		    t1.reservedamt,
		    t1.balanceamt,
		    t3.reason AS bouncecodedesc,
		    COALESCE(t2.taxapplicable, 0) AS taxapplicable,
		    t2.taxcomponent, t1.PaidCgst, t1.PaidSgst, t1.PaidIgst, t1.PaidUgst
		   FROM manualadvise_temp t1
		     LEFT JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
		     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid
		UNION ALL
		 SELECT t1.adviseid,
		    t1.advisetype,
		    t1.finreference,
		    t1.feetypeid,
		    t1.sequence,
		    t1.adviseamount,
		    t1.paidamount,
		    t1.waivedamount,
		    t1.remarks,
		    t1.valuedate,
		    t1.postdate,
		    t1.version,
		    t1.lastmntby,
		    t1.lastmnton,
		    t1.recordstatus,
		    t1.rolecode,
		    t1.nextrolecode,
		    t1.taskid,
		    t1.nexttaskid,
		    t1.recordtype,
		    t1.workflowid,
		    t2.feetypedesc,
		    t2.feetypecode,
		    t1.bounceid,
		    t1.receiptid,
		    t3.bouncecode,
		    t1.reservedamt,
		    t1.balanceamt,
		    t3.reason AS bouncecodedesc,
		    COALESCE(t2.taxapplicable, 0) AS taxapplicable,
		    t2.taxcomponent, t1.PaidCgst, t1.PaidSgst, t1.PaidIgst, t1.PaidUgst
		   FROM manualadvise t1
		     LEFT JOIN feetypes t2 ON t1.feetypeid = t2.feetypeid
		     LEFT JOIN bouncereasons t3 ON t1.bounceid = t3.bounceid
		  WHERE NOT (EXISTS ( SELECT 1
		           FROM manualadvise_temp
		          WHERE manualadvise_temp.adviseid = t1.adviseid))
		</createView>
	</changeSet>
	
	<changeSet id="110" author="Kesav">
		<comment>feeTypeDesc column added for GST changes</comment>
		<createView viewName="manualadvisemovements_tview" replaceIfExists="true">
			SELECT 		t1.movementid,
						t1.adviseid,
						t1.movementdate,
						t1.movementamount,
						t1.paidamount,
						t1.waivedamount,
						t1.status,
						t1.receiptid,
						t1.receiptseqid,
						t3.feetypecode, COALESCE(t3.taxapplicable, 0) AS taxapplicable,
						t3.taxcomponent, t1.PaidCgst, t1.PaidSgst, t1.PaidIgst, t1.PaidUgst, t3.feeTypeDesc
			FROM 		manualadvisemovements_temp t1
			JOIN 		manualadvise t2 ON t1.adviseid = t2.adviseid
			LEFT JOIN 	feetypes t3 ON t2.feetypeid = t3.feetypeid		
		</createView>
	</changeSet>
	
	<changeSet author="Kesav" id="111">
		<comment> FeeAmount column added in GST_Invoice_Txn_Details</comment>
		<addColumn tableName="GST_Invoice_Txn_Details">
			<column name="FeeAmount" type="decimal(18,0)" defaultValue="0"/>
		</addColumn>
	</changeSet>
	
	<changeSet author="Kesav" id="112">
		<sql>
			update reportfilterfields set mandatory=1 where reportid=(select reportid from reportconfiguration where menuitemcode='menu_Item_GST_InvoiceReport') and fieldid=1;
			update reportfilterfields set mandatory=1 where reportid=(select reportid from reportconfiguration where menuitemcode='menu_Item_GST_InvoiceReport') and fieldid=2;
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="113">
		<sql>
			update GST_Invoice_Txn_Details set FeeAmount = 0 where FeeAmount is null;
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="114">
		<sql>
			update reportfilterfields set fieldtype='LOVSEARCH',modulename='GSTInvoiceReport',lovhiddenfieldmethod='getInvoiceNo',
			lovtextfieldmethod='getLoanAccountNo',fieldlength=0 where reportid=(select reportid from reportconfiguration where menuitemcode='menu_Item_GST_InvoiceReport') and fieldid=3;
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="115">
		<sql>
			 update reportfilterfields set lovtextfieldmethod='getInvoiceNo', fielddbname='T.invoiceno' 
			 where reportid=(select reportid from reportconfiguration where menuitemcode='menu_Item_GST_InvoiceReport') and fieldid='3';
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="116">
		<comment> InvoiceType column added in GST_Invoice_Txn</comment>
		<addColumn tableName="GST_Invoice_Txn">
			<column name="InvoiceType" type="varchar(1)" defaultValue="D">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>
	
	<changeSet author="Kesav" id="117" dbms="postgresql">
		<sql>
			 create table gst_invoice_txn_bkp as select * from gst_invoice_txn;
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="117" dbms="mssql">
		<sql>
			 select * into gst_invoice_txn_bkp from gst_invoice_txn;
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="117" dbms="oracle">
		<sql>
			 create table gst_invoice_txn_bkp as select * from gst_invoice_txn;
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="118">
		<comment> InvoiceId column added in gst_invoice_txn_bkp</comment>
		<addColumn tableName="gst_invoice_txn_bkp">
			<column name="InvoiceId" type="bigint"/>
		</addColumn>
	</changeSet>
	
	<changeSet author="Kesav" id="119" dbms="postgresql">
		<sql>
			 update gst_invoice_txn_bkp fp set invoiceid = cast (SPLIT_PART(invoiceno, 'INV', 2) as bigint) 
			 where  invoiceno = (select invoiceno from gst_invoice_txn_bkp fm where fm.invoiceno = fp.invoiceno);
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="119" dbms="oracle">
		<sql>
			update 	GST_INVOICE_TXN_bkp T1 
			set 	INVOICEID = (Select SUBSTR(INVOICENO, INSTR(INVOICENO,'INV') + 3, LENGTH(INVOICENO)) 
								 from 	GST_INVOICE_TXN_bkp t2
								 where 	t2.INVOICENO = t1.INVOICENO);
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="119" dbms="mssql">
		<sql>
			update GST_INVOICE_TXN_bkp 
			set INVOICEID = (Select SUBSTR(INVOICENO,INSTR(INVOICENO,'INV') + 3, LENGTH(INVOICENO)) 
							 from 	GST_INVOICE_TXN_bkp t2
							 where 	t2.INVOICENO = GST_INVOICE_TXN_bkp.INVOICENO);
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="120">
		<dropTable tableName="GST_Invoice_Txn" />
	</changeSet>
	
	 <changeSet id="121" author="Kesava">
		<createTable tableName="GST_Invoice_Txn">
			<column name="InvoiceId" type="bigint">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="InvoiceNo" type="varchar(50)"/>
			<column name="TransactionID" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="InvoiceDate" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="Invoice_Amt" type="decimal(18,0)">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="CompanyCode" type="varchar(8)">
				<constraints nullable="false" />
			</column>
			<column name="CompanyName" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="Company_GSTIN" type="varchar(100)">
				<constraints nullable="false" />
			</column>
			<column name="Company_Address1" type="varchar(1000)">
				<constraints nullable="false" />
			</column>
			<column name="Company_Address2" type="varchar(1000)"/>
			<column name="Company_Address3" type="varchar(1000)"/>
			<column name="Company_PINCode" type="varchar(10)">
				<constraints nullable="false" />
			</column>
			<column name="Company_State_Code" type="varchar(8)">
				<constraints nullable="false" />
			</column>
			<column name="Company_State_Name" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="HSNNumber" type="varchar(100)">
				<constraints nullable="false" />
			</column>
			<column name="NatureService" type="varchar(100)">
				<constraints nullable="false" />
			</column>
			<column name="PanNumber" type="varchar(10)" />
			<column name="LoanAccountNo" type="varchar(20)" />
			<column name="CustomerID" type="varchar(20)" />	
			<column name="CustomerName" type="varchar(150)"/>
			<column name="CustomerGSTIN" type="varchar(100)"/>
			<column name="CustomerStateCode" type="varchar(2)" />
			<column name="CustomerStateName" type="varchar(50)" />
			<column name="CustomerAddress" type="varchar(1000)" />
			<column name="Invoice_Status" type="varchar(1)" defaultValue="I">
				<constraints nullable="false" />
			</column>
			<column name="InvoiceType" type="varchar(1)" defaultValue="D">
				<constraints nullable="false" />
			</column>
		</createTable>
	</changeSet>
	
	<changeSet author="Kesav" id="122">
		<sql>
			Insert 	into gst_invoice_txn (invoiceid,invoiceno,transactionid,invoicedate,invoice_amt,companycode,companyname,company_gstin,company_address1,
					company_address2,company_address3,company_pincode,company_state_code,company_state_name,hsnnumber,natureservice,pannumber,loanaccountno,
					customerid,customername,customergstin,customerstatecode,customerstatename,customeraddress,invoice_status,invoicetype)
			Select 	invoiceid,invoiceno,transactionid,invoicedate,invoice_amt,companycode,companyname,company_gstin,company_address1,
					company_address2,company_address3,company_pincode,company_state_code,company_state_name,hsnnumber,natureservice,pannumber,loanaccountno,
					customerid,customername,customergstin,customerstatecode,customerstatename,customeraddress,invoice_status,invoicetype
			from 	gst_invoice_txn_bkp;
		</sql>
	</changeSet>
		
	<changeSet author="Kesav" id="123" dbms="postgresql">
		<sql>
			 create table gst_invoice_txn_details_bkp as select * from gst_invoice_txn_details;
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="123" dbms="mssql">
		<sql>
			 select * into gst_invoice_txn_details_bkp from gst_invoice_txn_details;
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="123" dbms="oracle">
		<sql>
			 create table gst_invoice_txn_details_bkp as select * from gst_invoice_txn_details;
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="124">
		<comment> InvoiceId column added in gst_invoice_txn_details_bkp</comment>
		<addColumn tableName="gst_invoice_txn_details_bkp">
			<column name="InvoiceId" type="bigint"/>
			<column name="Id" type="bigint"/>
		</addColumn>
	</changeSet>
	
	<changeSet author="Kesav" id="125" dbms="postgresql">
		<sql>
			 update gst_invoice_txn_details_bkp fp set invoiceid = cast (SPLIT_PART(invoiceno, 'INV', 2) as bigint) 
			 where  invoiceno = (select invoiceno from gst_invoice_txn_details_bkp fm where fm.invoiceno=fp.invoiceno and fm.feecode=fp.feecode);
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="125" dbms="oracle">
		<sql>
			update 	gst_invoice_txn_details_bkp T1 
			set 	INVOICEID = (Select SUBSTR(INVOICENO, INSTR(INVOICENO,'INV') + 3, LENGTH(INVOICENO)) 
								 from 	gst_invoice_txn_details_bkp t2
								 where  t2.INVOICENO = t1.INVOICENO and t2.feecode = t1.feecode);
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="125" dbms="mssql">
		<sql>
			update 	gst_invoice_txn_details_bkp 
			set 	INVOICEID = (Select SUBSTR(INVOICENO,INSTR(INVOICENO,'INV')+3, LENGTH(INVOICENO)) 
								 from 	gst_invoice_txn_details_bkp t2
								 where 	t2.INVOICENO = gst_invoice_txn_details_bkp.INVOICENO and t2.feecode = gst_invoice_txn_details_bkp.feecode);
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="126">
		<dropTable tableName="gst_invoice_txn_details" />
	</changeSet>
	
	<changeSet id="127" author="Kesava">
		<createTable tableName="GST_Invoice_Txn_Details">
			<column name="Id" type="bigint">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="InvoiceId" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="InvoiceNo" type="varchar(50)"/>
			<column name="FeeCode" type="varchar(8)">
				<constraints nullable="false" />
			</column>
			<column name="FeeAmount" type="decimal(18,0)" defaultValue="0"/>
			<column name="CGST_RATE" type="decimal(5,2)" defaultValue="0"/>
			<column name="CGST_AMT" type="decimal(18,0)" defaultValue="0"/>
			<column name="SGST_RATE" type="decimal(5,2)" defaultValue="0"/>
			<column name="SGST_AMT" type="decimal(18,0)" defaultValue="0"/>
			<column name="IGST_RATE" type="decimal(5,2)" defaultValue="0"/>
			<column name="IGST_AMT" type="decimal(18,0)" defaultValue="0"/>
			<column name="UGST_RATE" type="decimal(5,2)" defaultValue="0"/>
			<column name="UGST_AMT" type="decimal(18,0)" defaultValue="0"/>
		</createTable>
	</changeSet>
	
	<changeSet author="Kesav" id="128">
		<sql>
			Insert 	Into gst_invoice_txn_details (id,invoiceid,invoiceno,feecode,FeeAmount,cgst_rate,cgst_amt,sgst_rate,sgst_amt,igst_rate,igst_amt,ugst_rate,ugst_amt)
			Select 	row_number() over (order by invoiceid) id,invoiceid,invoiceno,feecode,FeeAmount,cgst_rate,cgst_amt,sgst_rate,sgst_amt,igst_rate,igst_amt,ugst_rate,ugst_amt 
			From 	gst_invoice_txn_details_bkp order by invoiceid;
		</sql>
	</changeSet>
	
	<changeSet id="129" author="Kesav">
		<createTable tableName="Seq_Gst_Invoice_Txn_Details">
			<column name="SeqNo" type="bigint" />
		</createTable>
	</changeSet>
	
	<changeSet id="130" author="Kesav">
		<sql>
			Insert into Seq_Gst_Invoice_Txn_Details values (0);
			update Seq_Gst_Invoice_Txn_Details set SeqNo = (select max(Id) from gst_invoice_txn_details);
		</sql>
	</changeSet>
	
	<changeSet author="Kesav" id="131">
		<comment>Adding Unique Key with GST_Invoice_Txn</comment>
		<addUniqueConstraint tableName="GST_Invoice_Txn" constraintName="UK_GST_Invoice_Txn_InvoiceId" columnNames="InvoiceId" />
	</changeSet>
	
	<changeSet author="Kesav" id="132">
		<comment>Adding Foreign Key with GST_Invoice_Txn</comment>
		<addForeignKeyConstraint constraintName="FK_GST_Invoice_Txn_InvoiceId"
			baseTableName="GST_Invoice_Txn_Details" baseColumnNames="InvoiceId"
			referencedColumnNames="InvoiceId" referencedTableName="GST_Invoice_Txn" />
	</changeSet>
	
	<changeSet author="Kesav" id="133">
		<dropColumn tableName="GST_Invoice_Txn_Details" columnName="InvoiceNo"/>
	</changeSet>
	
	<changeSet id="134" author="Kesava">
		<createTable tableName="Seq_GST_Invoice">
			<column name="FromState" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="Entity" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="TransactionType" type="varchar(1)">
				<constraints nullable="false" />
			</column>
			<column name="SeqNo" type="bigint" defaultValue="0" >
				<constraints nullable="false" />
			</column>
		</createTable>
	</changeSet>
	
	<changeSet author="Kesav" id="135">
		<comment>Adding Composite Primary Key to Seq_GST_Invoice</comment>
		<addPrimaryKey columnNames="FromState,Entity,TransactionType" constraintName="PK_Seq_GST_Inv" tableName="Seq_GST_Invoice" />
	</changeSet>
	
	<changeSet id="136" author="Kesav">
		<sql>
			Insert Into Seq_GST_Invoice (FromState, Entity, TransactionType, SeqNo) Select StateCode, EntityCode, 'D' TransactionType, 0 SeqNo From TaxDetail;
			Insert Into Seq_GST_Invoice (FromState, Entity, TransactionType, SeqNo) Select StateCode, EntityCode, 'C' TransactionType, 0 SeqNo From TaxDetail;
		</sql>
	</changeSet>
	
	<changeSet id="137" author="Kesav">
		<createView viewName="GST_Invoice_Txn_View" replaceIfExists="true">
			  Select 	InvoiceNo,  LoanAccountNo From 	GST_Invoice_Txn  Where 	InvoiceNo is not null
		</createView>	
	</changeSet>
	
	<changeSet author="Kesav" id="138">
		<dropTable tableName="gst_invoice_txn_bkp" />
	</changeSet>
	
	<changeSet author="Kesav" id="139">
		<dropTable tableName="gst_invoice_txn_details_bkp" />
	</changeSet>
	
	<changeSet id="140" author="Kesav">
		<createView viewName="GST_FinanceMain_View" replaceIfExists="true">
			 Select 	T1.FinReference, T1.FinType 
			 From 		FinanceMain T1
			 Inner Join GST_Invoice_Txn T2 ON T2.LoanAccountNo = T1.FinReference
		</createView>	
	</changeSet>
	
	<changeSet id="141" author="Kesav">
		<sql>
			update reportfilterfields set modulename = 'GSTFinanceMain' 
 			where  reportid = (select reportid from reportconfiguration where menuitemcode = 'menu_Item_GST_InvoiceReport') and fieldid='2';
		</sql>
	</changeSet>
	
	<changeSet id="142" author="Kesav">
		<sql>
			Delete from SMTPARAMETERS where SysParmCode = 'AUTO_GST_INVOICE_REQ_JOB_CORNEXP';
			Delete from SMTParameters where sysparmCode = 'AUTO_GST_INVOICE_NO';
						
			Insert into SMTPARAMETERS 
			values ('AUTO_GST_INVOICE_REQ_JOB_CORNEXP','GST Invoice No Request Job Cron expression.','String',1,'0 0 * * * ?',30,0,null,null,'GST Invoice No Request Job Cron expression.',1,1000,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
						
			Insert into SMTPARAMETERS 
			values ('AUTO_GST_INVOICE_NO','GST Invoice Nubmber Auto Generation','String',1,'Y',1,0,null,null,'GST Invoice Nubmber Auto Generation',1,1000,CURRENT_TIMESTAMP,'Approved',null,null,null,null,null,0);
		</sql>
	</changeSet>
	
	<changeSet id="143" author="Kesav">
		<renameTable newTableName="Seq_Gst_Invoice_Txn" oldTableName="SeqGst_Invoice_Txn" />
	</changeSet>
	
	<changeSet id="144" author="Kesav">
		<sql>
			Update Gst_Invoice_Txn set InvoiceNo = null;
		</sql>
	</changeSet>
	
</databaseChangeLog>