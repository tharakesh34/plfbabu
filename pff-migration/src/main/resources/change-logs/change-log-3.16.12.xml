<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />

	<changeSet id="1.1" author="murthy.y">
	<dropForeignKeyConstraint baseTableName="TRAIL_BALANCE_REPORT" constraintName="FK_TBR_HID"/>
	<dropForeignKeyConstraint baseTableName="TRAIL_BALANCE_REPORT_LAST_RUN" constraintName="FK_TBRLR_HID"/>
</changeSet>

<changeSet id="1.2" author="murthy.y">
<comment>The TRIAL_BALANCE_HEADER table holds the trail balance batch details</comment>
	<createTable tableName="TRIAL_BALANCE_HEADER">
			<column name="ID" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="SEQNO" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="DIMENSION" type="varchar(20)">
				<constraints nullable="false" />
			</column>
			<column name="FILENAME" type="varchar(100)"/>
			<column name="COMPANYNAME" type="varchar(100)">
				<constraints nullable="false" />
			</column>
			<column name="REPORTNAME" type="varchar(100)">
				<constraints nullable="false" />
			</column>
			<column name="STARTDATE" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="ENDDATE" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="CURRENCY" type="char(3)">
				<constraints nullable="false" />
			</column>
		</createTable>
</changeSet>
<changeSet id="1.3" author="murthy.y">
	<addPrimaryKey columnNames="ID" constraintName="PK_TBH" tableName="TRIAL_BALANCE_HEADER" />
</changeSet>

<changeSet id="1.4" author="murthy.y">
	<sql>
		<![CDATA[
			INSERT INTO TRIAL_BALANCE_HEADER select ID, 1, 'STATE', FILENAME, COMPANYNAME, REPORTNAME, STARTDATE, ENDDATE, CURRENCY from TRAIL_BALANCE_HEADER; 
		]]>
	</sql>
</changeSet>
<changeSet id="1.5" author="murthy.y">
		<renameTable newTableName="TRIAL_BALANCE_REPORT_LAST_RUN" oldTableName="TRAIL_BALANCE_REPORT_LAST_RUN"/>
		<renameTable newTableName="TRIAL_BALANCE_REPORT_FILE" oldTableName="TRAIL_BALANCE_REPORT_FILE"/>
		<renameTable newTableName="TRIAL_BALANCE_REPORT" oldTableName="TRAIL_BALANCE_REPORT"/>
		<renameView oldViewName="TRAIL_BALANCE_REPORT_VIEW" newViewName="TRIAL_BALANCE_REPORT_VIEW"/>
		<renameView oldViewName="TRAIL_BALANCE_REPORT_FILE_VIEW" newViewName="TRIAL_BALANCE_REPORT_FILE_VIEW"/>
</changeSet>

<changeSet id="1.6" author="murthy.y">
	<addForeignKeyConstraint constraintName="FK_TBR_HID" referencedTableName="TRIAL_BALANCE_HEADER" baseColumnNames="HEADERID" baseTableName="TRIAL_BALANCE_REPORT" referencedColumnNames="ID"/>
	<addForeignKeyConstraint constraintName="FK_TBRLR_HID" referencedTableName="TRIAL_BALANCE_HEADER" baseColumnNames="HEADERID" baseTableName="TRIAL_BALANCE_REPORT_LAST_RUN" referencedColumnNames="ID"/>
</changeSet>
<changeSet id="1.7" author="murthy.y">
	<createIndex indexName="IDX_TBR_HID" tableName="TRIAL_BALANCE_REPORT">
		<column name="HEADERID" type="bigint"/>
	</createIndex>
</changeSet>
<changeSet id="1.8" author="murthy.y">
	<createIndex indexName="IDX_TBRLR_HID" tableName="TRIAL_BALANCE_REPORT_LAST_RUN">
			<column name="HEADERID" type="bigint"/>
	</createIndex>
	</changeSet>
<changeSet id="1.9" author="murthy.y">
	<createIndex indexName="IDX_TBH_DIMENSION" tableName="TRIAL_BALANCE_HEADER">
		<column name="DIMENSION" type="varchar(20)"/>
	</createIndex>
</changeSet>

<changeSet id="1.10" author="murthy.y">
	<sql>
		<![CDATA[			
			UPDATE DATA_ENGINE_CONFIG SET NAME = 'TRIAL_BALANCE_EXPORT_STATE', FILENAMEFORMAT = '${START_DATE},_${END_DATE},_${HEADER_ID}' WHERE NAME = 'GL_TRAIL_BALANCE_EXPORT';
			UPDATE DATA_ENGINE_TABLE SET STATUSUPDATE = 'UPDATE TRIAL_BALANCE_HEADER SET FILENAME = :FILE_NAME WHERE ID = :HEADER_ID AND DIMENSION = :DIMENSION' WHERE CONFIGID = (select ID from DATA_ENGINE_CONFIG where NAME = 'TRIAL_BALANCE_EXPORT_STATE');
		]]>
	</sql>
</changeSet>
<changeSet id="1.11" author="murthy.y">
		<sql>
			<![CDATA[
				
				DELETE FROM DATA_ENGINE_LOG WHERE ID IN (SELECT ID FROM DATA_ENGINE_STATUS WHERE NAME = 'TRIAL_BALANCE_EXPORT_CONSOLIDATE');
				DELETE FROM DATA_ENGINE_STATUS where NAME = 'TRIAL_BALANCE_EXPORT_CONSOLIDATE';
				DELETE FROM DATA_ENGINE_EVENT_PROPERTIES WHERE CONFIG_ID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'TRIAL_BALANCE_EXPORT_CONSOLIDATE');
				
				DELETE FROM DATA_ENGINE_COLUMN where TABLEID IN (select ID from DATA_ENGINE_TABLE WHERE CONFIGID = (select ID from DATA_ENGINE_CONFIG where Name = 'TRIAL_BALANCE_EXPORT_CONSOLIDATE'));
				DELETE FROM DATA_ENGINE_TABLE where CONFIGID IN (select ID from DATA_ENGINE_CONFIG where Name = 'TRIAL_BALANCE_EXPORT_CONSOLIDATE');
				DELETE FROM DATA_ENGINE_CONFIG where Name = 'TRIAL_BALANCE_EXPORT_CONSOLIDATE';
				
				INSERT INTO DATA_ENGINE_CONFIG VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_CONFIG),'TRIAL_BALANCE_EXPORT_CONSOLIDATE', 'Trial balance consolidate report', 2, NULL, NULL, NULL, ',' , 0, 0, 'PARENT GROUP,LEDGER,DESCRIPTION,OPENING BALANCE,CR/DR,DEBIT AMOUNT,CREDIT AMOUNT,CLOSING BALANCE,CR/DR', 'Row:{, ${COMPANY_NAME}}Row:{, ${REPORT_NAME}}Row:{, ${TRANSACTION_DURATION}}Row:{Currency: ${CURRENCY}', NULL, 'A', '/opt/PFF/SAPGL', 'TRIAL_BALANCE_CONSOLIDATE_', '.csv', 0, NULL, '${START_DATE}, _${END_DATE},_${HEADER_ID}', NULL, 0, 'MOVE_TO_S3_BUCKET', 1, 1);
				INSERT INTO DATA_ENGINE_TABLE  VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_TABLE), (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'TRIAL_BALANCE_EXPORT_CONSOLIDATE'), 'TRIAL_BALANCE_REPORT_FILE',  0, 'HEADERID', NULL, 'UPDATE TRIAL_BALANCE_HEADER SET FILENAME = :FILE_NAME WHERE ID = :HEADER_ID AND DIMENSION = :DIMENSION', NULL, NULL, NULL, NULL, NULL, 0, 0, 0);
			
				INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'TRIAL_BALANCE_REPORT_FILE' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'TRIAL_BALANCE_EXPORT_CONSOLIDATE')), 	'ACTYPEGRPID',			0, 'N', NULL, NULL,	NULL, NULL, 0, NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'TRIAL_BALANCE_REPORT_FILE' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'TRIAL_BALANCE_EXPORT_CONSOLIDATE')), 	'HOSTACCOUNT',			0, 'N', NULL, NULL,	NULL, NULL, 0, NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'TRIAL_BALANCE_REPORT_FILE' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'TRIAL_BALANCE_EXPORT_CONSOLIDATE')), 	'DESCRIPTION',			0, 'N', NULL, NULL,	NULL, NULL, 0, NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'TRIAL_BALANCE_REPORT_FILE' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'TRIAL_BALANCE_EXPORT_CONSOLIDATE')), 	'OPENINGBAL',			  0, 'N', NULL, NULL,	NULL, NULL, 0, NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'TRIAL_BALANCE_REPORT_FILE' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'TRIAL_BALANCE_EXPORT_CONSOLIDATE')), 	'OPENINGBALTYPE',		0, 'N', NULL, NULL,	NULL, NULL, 0, NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'TRIAL_BALANCE_REPORT_FILE' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'TRIAL_BALANCE_EXPORT_CONSOLIDATE')), 	'DEBITAMOUNT',			0, 'N', NULL, NULL,	NULL, NULL, 0, NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'TRIAL_BALANCE_REPORT_FILE' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'TRIAL_BALANCE_EXPORT_CONSOLIDATE')), 	'CREDITAMOUNT',			0, 'N', NULL, NULL,	NULL, NULL, 0, NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'TRIAL_BALANCE_REPORT_FILE' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'TRIAL_BALANCE_EXPORT_CONSOLIDATE')), 	'CLOSINGBAL',			  0, 'N', NULL, NULL,	NULL, NULL, 0, NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN),(Select Id FROM DATA_ENGINE_TABLE WHERE Name = 'TRIAL_BALANCE_REPORT_FILE' and CONFIGID = (Select Id FROM DATA_ENGINE_CONFIG WHERE Name = 'TRIAL_BALANCE_EXPORT_CONSOLIDATE')), 	'CLOSINGBALTYPE',		0, 'N', NULL, NULL,	NULL, NULL, 0, NULL, NULL, NULL, NULL, 'O');

				UPDATE SEQ_DATA_ENGINE_CONFIG SET SeqNo=(Select coalesce(MAX(ID), 1) FROM DATA_ENGINE_CONFIG);
				UPDATE SEQ_DATA_ENGINE_TABLE  SET SeqNo=(Select coalesce(MAX(ID), 1) FROM DATA_ENGINE_TABLE);
				UPDATE SEQ_DATA_ENGINE_COLUMN SET SeqNo=(Select coalesce(MAX(ID), 1) FROM DATA_ENGINE_COLUMN);	

				delete from DATA_ENGINE_EVENT_PROPERTIES where CONFIG_ID IN (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'TRIAL_BALANCE_EXPORT_CONSOLIDATE');
				INSERT INTO DATA_ENGINE_EVENT_PROPERTIES
				select (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'TRIAL_BALANCE_EXPORT_CONSOLIDATE'), 
				STORAGE_TYPE, REGION_NAME, BUCKET_NAME, ACCESS_KEY, SECRET_KEY, PREFIX, SSE_ALGORITHM, HOST_NAME,PORT,PRIVATE_KEY
				from DATA_ENGINE_EVENT_PROPERTIES where CONFIG_ID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'TRIAL_BALANCE_EXPORT_STATE');				
			]]>
		</sql>
</changeSet>
<changeSet id="1.12" author="murthy.y">
	<sql>
		<![CDATA[	
			UPDATE DATA_ENGINE_TABLE SET NAME = 'TRIAL_BALANCE_REPORT_FILE_VIEW', STATUSUPDATE = 'UPDATE TRIAL_BALANCE_HEADER SET FILENAME = :FILE_NAME WHERE ID = :HEADER_ID AND DIMENSION = :DIMENSION' where CONFIGID IN (select ID from DATA_ENGINE_CONFIG where NAME = 'TRIAL_BALANCE_EXPORT_STATE');
			UPDATE DATA_ENGINE_TABLE SET NAME = 'TRIAL_BALANCE_REPORT_FILE', 	  STATUSUPDATE = 'UPDATE TRIAL_BALANCE_HEADER SET FILENAME = :FILE_NAME WHERE ID = :HEADER_ID AND DIMENSION = :DIMENSION' where CONFIGID IN (select ID from DATA_ENGINE_CONFIG where NAME = 'TRIAL_BALANCE_EXPORT_CONSOLIDATE');
			UPDATE DATA_ENGINE_CONFIG SET HEADER = 'Row:{, ${COMPANY_NAME}}Row:{, ${REPORT_NAME}}Row:{, ${TRANSACTION_DURATION}}Row:{Currency: ${CURRENCY}Row:{PARENT GROUP,LEDGER,DESCRIPTION,OPENING BALANCE,CR/DR,DEBIT AMOUNT,CREDIT AMOUNT,CLOSING BALANCE,CR/DR}', FIELDNAMES = NULL  where NAME = 'TRIAL_BALANCE_EXPORT_CONSOLIDATE';
		]]>
	</sql>
</changeSet>
<changeSet id="1.13" author="murthy.y" dbms="oracle">
	<createView viewName="TRIAL_BALANCE_REPORT_VIEW" replaceIfExists="true">
		  	SELECT HEADERID,
			  COUNTRY,
			  PROVINCE,
			  ACTYPEGRPID,
			  HOSTACCOUNT,
			  DESCRIPTION,
			  UDF_CONVERTCURRENCY(OPENINGBAL, TBH.CURRENCY, 'INR') OPENINGBAL,
			  OPENINGBALTYPE,
			  UDF_CONVERTCURRENCY(DEBITAMOUNT, TBH.CURRENCY, 'INR') DEBITAMOUNT,
			  UDF_CONVERTCURRENCY(CREDITAMOUNT, TBH.CURRENCY, 'INR') CREDITAMOUNT,
			  UDF_CONVERTCURRENCY(CLOSINGBAL, TBH.CURRENCY, 'INR') CLOSINGBAL,
			  CLOSINGBALTYPE
			  FROM TRIAL_BALANCE_REPORT_LAST_RUN TBR
			  INNER JOIN TRIAL_BALANCE_HEADER TBH ON TBH.ID = TBR.HEADERID
	</createView>
</changeSet>
<changeSet id="1.14" author="murthy.y" dbms="mssql">
	<createView viewName="TRIAL_BALANCE_REPORT_VIEW" replaceIfExists="true">
		  SELECT HEADERID,
			  COUNTRY,
			  PROVINCE,
			  ACTYPEGRPID,
			  HOSTACCOUNT,
			  DESCRIPTION,
			  dbo.UDF_CONVERTCURRENCY(OPENINGBAL, TBH.CURRENCY, 'INR') OPENINGBAL,
			  OPENINGBALTYPE,
			  dbo.UDF_CONVERTCURRENCY(DEBITAMOUNT, TBH.CURRENCY, 'INR') DEBITAMOUNT,
			  dbo.UDF_CONVERTCURRENCY(CREDITAMOUNT, TBH.CURRENCY, 'INR') CREDITAMOUNT,
			  dbo.UDF_CONVERTCURRENCY(CLOSINGBAL, TBH.CURRENCY, 'INR') CLOSINGBAL,
			  CLOSINGBALTYPE
			  FROM TRIAL_BALANCE_REPORT_LAST_RUN TBR
			  INNER JOIN TRIAL_BALANCE_HEADER TBH ON TBH.ID = TBR.HEADERID
	</createView>
</changeSet>
<changeSet id="1.17" author="murthy.y" dbms="postgresql">
	<createView viewName="TRIAL_BALANCE_REPORT_VIEW" replaceIfExists="true">
		  SELECT HEADERID,
			  COUNTRY,
			  PROVINCE,
			  ACTYPEGRPID,
			  HOSTACCOUNT,
			  DESCRIPTION,
			  UDF_CONVERTCURRENCY(OPENINGBAL, TBH.CURRENCY, 'INR') OPENINGBAL,
			  OPENINGBALTYPE,
			  UDF_CONVERTCURRENCY(DEBITAMOUNT, TBH.CURRENCY, 'INR') DEBITAMOUNT,
			  UDF_CONVERTCURRENCY(CREDITAMOUNT, TBH.CURRENCY, 'INR') CREDITAMOUNT,
			  UDF_CONVERTCURRENCY(CLOSINGBAL, TBH.CURRENCY, 'INR') CLOSINGBAL,
			  CLOSINGBALTYPE
			  FROM TRIAL_BALANCE_REPORT_LAST_RUN TBR
			  INNER JOIN TRIAL_BALANCE_HEADER TBH ON TBH.ID = TBR.HEADERID
	</createView>
</changeSet>
<changeSet id="1.16" author="murthy.y" dbms="oracle">
	<createView viewName="TRIAL_BALANCE_REPORT_FILE_VIEW" replaceIfExists="true">
			SELECT ID,COUNTRY,
		  PROVINCE,
		  ACTYPEGRPID,
		  HOSTACCOUNT,
		  DESCRIPTION,
		  OPENINGBAL,
		  OPENINGBALTYPE,
		  DEBITAMOUNT,
		  CREDITAMOUNT,
		  CLOSINGBAL,
		  CLOSINGBALTYPE
		  FROM TRIAL_BALANCE_REPORT_FILE order by ID, PROVINCE
	</createView>
</changeSet>
<changeSet id="1.17" author="murthy.y" dbms="mssql">
	<createView viewName="TRIAL_BALANCE_REPORT_FILE_VIEW" replaceIfExists="true">
			SELECT ID,COUNTRY,
		  PROVINCE,
		  ACTYPEGRPID,
		  HOSTACCOUNT,
		  DESCRIPTION,
		  OPENINGBAL,
		  OPENINGBALTYPE,
		  DEBITAMOUNT,
		  CREDITAMOUNT,
		  CLOSINGBAL,
		  CLOSINGBALTYPE
		  FROM TRIAL_BALANCE_REPORT_FILE
	</createView>
</changeSet>
<changeSet id="1.18" author="murthy.y" dbms="postgresql">
	<createView viewName="TRIAL_BALANCE_REPORT_FILE_VIEW" replaceIfExists="true">
		SELECT ID,COUNTRY,
	  PROVINCE,
	  ACTYPEGRPID,
	  HOSTACCOUNT,
	  DESCRIPTION,
	  OPENINGBAL,
	  OPENINGBALTYPE,
	  DEBITAMOUNT,
	  CREDITAMOUNT,
	  CLOSINGBAL,
	  CLOSINGBALTYPE
	  FROM TRIAL_BALANCE_REPORT_FILE order by ID, PROVINCE
	</createView>
</changeSet>
<changeSet id="1.19" author="murthy.y">
    <dropNotNullConstraint columnDataType="CHAR(2)" columnName="COUNTRY" tableName="TRIAL_BALANCE_REPORT"/>
    <dropNotNullConstraint columnDataType="VARCHAR2(8)" columnName="PROVINCE" tableName="TRIAL_BALANCE_REPORT"/>
</changeSet>
<changeSet id="1.20" author="murthy.y">
    <dropNotNullConstraint columnDataType="CHAR(2)" columnName="COUNTRY" tableName="TRIAL_BALANCE_REPORT_LAST_RUN"/>
    <dropNotNullConstraint columnDataType="VARCHAR2(8)" columnName="PROVINCE" tableName="TRIAL_BALANCE_REPORT_LAST_RUN"/>
</changeSet>
<changeSet id="1.21" author="murthy.y">
	<sql>
		<![CDATA[	
			UPDATE DATA_ENGINE_TABLE SET NAME = 'TRIAL_BALANCE_REPORT_FILE_VIEW', STATUSUPDATE = 'UPDATE TRIAL_BALANCE_HEADER SET FILENAME = :FILE_NAME WHERE ID = :ID AND DIMENSION = :DIMENSION' where CONFIGID IN (select ID from DATA_ENGINE_CONFIG where NAME = 'TRIAL_BALANCE_EXPORT_STATE');
			UPDATE DATA_ENGINE_TABLE SET NAME = 'TRIAL_BALANCE_REPORT_FILE', 	  STATUSUPDATE = 'UPDATE TRIAL_BALANCE_HEADER SET FILENAME = :FILE_NAME WHERE ID = :ID AND DIMENSION = :DIMENSION' where CONFIGID IN (select ID from DATA_ENGINE_CONFIG where NAME = 'TRIAL_BALANCE_EXPORT_CONSOLIDATE');
		]]>
	</sql>
</changeSet>
<changeSet author="manoj" id="2">
<comment>The ALM_EXTRACT table holds the staging table for the ALM process</comment>
	<createTable tableName="ALM_EXTRACT">
		<column name="SEQID"          	 type="bigint"/>
		<column name="FINREFERENCE"   	 type="varchar(20)">
			<constraints nullable="false"/>
		</column>
		<column name="FINTYPE"        	 type="varchar(8)">
			<constraints nullable="false"/>
		</column>	
		<column name="FINSTARTDATE"   	 type="datetime"/>
		<column name="MATURITYDATE"      type="datetime"/>
		<column name="CLOSINGSTATUS"     type="char(1)"/>
		<column name="CCYMINORCCYUNITS"  type="smallint"/>
		<column name="CCYEDITFIELD"      type="smallint"/>
		<column name="EMIADV"            type="varchar(20)"/>
	</createTable>
</changeSet>
	
<changeSet author="manoj" id="3">
	<addPrimaryKey columnNames="SEQID" constraintName="PK_SEQID" tableName="ALM_EXTRACT"/>
</changeSet>
	
<changeSet author="manoj" id="4">
	<createIndex indexName="IX_ALM_EX_FINREF" tableName="ALM_EXTRACT" unique="true">
		<column name="FINREFERENCE" type="varchar(20)"/>
    </createIndex>
</changeSet>
	<changeSet id="5" author="Jayant" dbms="oracle">
	    <sql splitStatements="false">
	        begin
	        	SP_INVALIDVIEWS;
	        	RESEED_SEQUENCE_TABLES;
	        end;
	    </sql>
	</changeSet>
	
<changeSet id="6" author="manoj">
	<sql>
		<![CDATA[	
			update PSX_DEDUP_EOD_CUST_DEMO_DTL set PSX_BATCH_ID = NULL, EOD_BATCH_ID = NULL;
			update PSX_DEDUP_EOD_CUST_ADDR_DTL set PSX_BATCH_ID = NULL, EOD_BATCH_ID = NULL;
			update PSX_DEDUP_EOD_CUST_LOAN_DTL set PSX_BATCH_ID = NULL, EOD_BATCH_ID = NULL; 
		]]>
	</sql>
</changeSet>	
<changeSet id="7" author="madhubabu">
	<sql>
		INSERT INTO SecRights SELECT (select (SeqNo+1) from SeqSecRights),0,'menuItem_Enquiry_CollateralSetup','MENU',0,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 FROM SeqSecRights WHERE 0=0;
		INSERT INTO secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode ='CL_LOAN_ENQUIRY'), (Select RightID from SecRights where RightName = 'menuItem_Enquiry_CollateralSetup'), 1, 1, 1000,CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
		Update SeqSecRights Set SeqNo = (Select MAX(RightID) + 1 from SecRights);
		Update SeqSecGroupRights Set SeqNo = (Select MAX(GrpRightID) + 1 from SecGroupRights);

	</sql>
</changeSet>
</databaseChangeLog>