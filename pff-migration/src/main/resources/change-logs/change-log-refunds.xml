<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value="" dbms="oracle" />
	<property name="add.schema" value="" dbms="postgresql" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PLFAVANSEQC.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()" dbms="postgresql" />

	<changeSet id="pre_run_for_pgp" author="Adarsh" runAlways="true" dbms="postgresql">
		<sql>
			Set search_path = plf,public,pg_catalog;
		</sql>
	</changeSet>
	
	<changeSet id="TK#2565.1_pre" author="saisandeep.b" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'paymentheader_view');
			]]>
		</sql>
	</changeSet>

	<changeSet id="TK#2565.1" author="saisandeep.b">
		<createView replaceIfExists="true" viewName="PAYMENTHEADER_VIEW">
			<![CDATA[
				SELECT T1.PAYMENTID,
					FM.FINID,
					FM.FINREFERENCE,
					T1.PAYMENTTYPE,
					T1.PAYMENTAMOUNT,
					T1.CREATEDON,
					T1.APPROVEDON,
					T1.STATUS,
					T1.VERSION,
					T1.LASTMNTBY,
					T1.LASTMNTON,
					T1.RECORDSTATUS,
					T1.ROLECODE,
					T1.NEXTROLECODE,
					T1.TASKID,
					T1.NEXTTASKID,
					T1.RECORDTYPE,
					T1.WORKFLOWID,
					PIT.PAYMENTTYPE PAYMENTINSTRTYPE,
					FM.CUSTID,
					C.CUSTCOREBANK
				FROM PAYMENTHEADER_TEMP T1
				INNER JOIN FINANCEMAIN FM ON FM.FINID = T1.FINID
				LEFT JOIN PAYMENTINSTRUCTIONS_TEMP PIT ON T1.PAYMENTID = PIT.PAYMENTID
				INNER JOIN CUSTOMERS C ON C.CUSTID = FM.CUSTID
				UNION ALL
				SELECT T1.PAYMENTID,
					FM.FINID,
					FM.FINREFERENCE,
					T1.PAYMENTTYPE,
					T1.PAYMENTAMOUNT,
					T1.CREATEDON,
					T1.APPROVEDON,
					T1.STATUS,
					T1.VERSION,
					T1.LASTMNTBY,
					T1.LASTMNTON,
					T1.RECORDSTATUS,
					T1.ROLECODE,
					T1.NEXTROLECODE,
					T1.TASKID,
					T1.NEXTTASKID,
					T1.RECORDTYPE,
					T1.WORKFLOWID,
					PI.PAYMENTTYPE PAYMENTINSTRTYPE,
					FM.CUSTID,
					C.CUSTCOREBANK
				FROM PAYMENTHEADER T1
				INNER JOIN FINANCEMAIN FM ON FM.FINID = T1.FINID
				LEFT JOIN PAYMENTINSTRUCTIONS PI ON T1.PAYMENTID = PI.PAYMENTID
				INNER JOIN CUSTOMERS C ON C.CUSTID = FM.CUSTID
				WHERE NOT EXISTS (SELECT 1 FROM PAYMENTHEADER_TEMP
					WHERE PAYMENTHEADER_TEMP.PAYMENTID = T1.PAYMENTID)
			]]>
		</createView>
	</changeSet>
	
	<changeSet id="TK#2565.1_post" author="saisandeep.b" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'paymentheader_view');
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="TK#2565.2_pre" author="saisandeep.b" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'paymentheader_aview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="TK#2565.2" author="saisandeep.b">
		<createView replaceIfExists="true" viewName="PAYMENTHEADER_AVIEW">
			<![CDATA[
				SELECT T1.PAYMENTID,
					FM.FINID,
					FM.FINREFERENCE,
					T1.PAYMENTTYPE,
					T1.PAYMENTAMOUNT,
					T1.CREATEDON,
					T1.APPROVEDON,
					T1.STATUS,
					T1.VERSION,
					T1.LASTMNTBY,
					T1.LASTMNTON,
					T1.RECORDSTATUS,
					T1.ROLECODE,
					T1.NEXTROLECODE,
					T1.TASKID,
					T1.NEXTTASKID,
					T1.RECORDTYPE,
					T1.WORKFLOWID,
					PI.PAYMENTTYPE PAYMENTINSTRTYPE,
					FM.CUSTID,
					C.CUSTCOREBANK
				FROM PAYMENTHEADER T1
				INNER JOIN FINANCEMAIN FM ON FM.FINID = T1.FINID
				LEFT JOIN PAYMENTINSTRUCTIONS PI ON T1.PAYMENTID = PI.PAYMENTID
				INNER JOIN CUSTOMERS C ON C.CUSTID = FM.CUSTID
			]]>
		</createView>
	</changeSet>
	
	<changeSet id="TK#2565.2_post" author="saisandeep.b" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'paymentheader_aview');
			]]>
		</sql>
	</changeSet>
 	
 	<changeSet id="TK#2565.3" author="saisandeep.b">
		<createTable tableName="PAYMINS_UPLOADS">
			<column name="Id" type="bigint" autoIncrement="true">
				<constraints nullable="false" />
			</column>
			<column name="HeaderId" type="bigint" />
			<column name="FinReference" type="varchar(20)" />
			<column name="FinId" type="bigInt" />
			<column name="ExcessType" type="char(1)" />
			<column name="FeeType" type="varchar(8)" />
			<column name="PayAmount" type="decimal(18,2)" />
			<column name="Remarks" type="varchar(100)" />
			<column name="OverRideOverDue" type="char(1)" />
			<column name="Progress" type="int" />
			<column name="Status" type="char(1)" />
			<column name="ErrorCode" type="varchar(20)" />
			<column name="ErrorDesc" type="varchar(2000)" />
		</createTable>
	</changeSet>

	<changeSet id="TK#2565.4" author="saisandeep.b">
		<addPrimaryKey tableName="PAYMINS_UPLOADS" columnNames="Id" />
	</changeSet>
	
	<changeSet id="TK#2565.5" author="saisandeep.b">
		<sql>
			<![CDATA[
				DELETE FROM DATA_ENGINE_LOG WHERE STATUSID IN (SELECT ID FROM DATA_ENGINE_STATUS WHERE NAME ='PAYINS_REFUND_UPLOAD');
 				DELETE FROM DATA_ENGINE_DOWNLOAD_HISTORY WHERE ID IN (SELECT ID FROM DATA_ENGINE_STATUS WHERE NAME ='PAYINS_REFUND_UPLOAD');
 				DELETE FROM DATA_ENGINE_STATUS WHERE NAME ='PAYINS_REFUND_UPLOAD';
 				
				DELETE FROM DATA_ENGINE_COLUMN WHERE TABLEID IN (SELECT ID FROM DATA_ENGINE_TABLE WHERE CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_UPLOAD'));
				DELETE FROM DATA_ENGINE_TABLE WHERE CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_UPLOAD');
				DELETE FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_UPLOAD';

				INSERT INTO DATA_ENGINE_CONFIG (ID, NAME, DESCRIPTION, PARSER, WORKSHEET, TEXTQUALIFIER, ROWDELIMITER, COLUMNDELIMITER, STARTINGROW, SKIPHEADERROW, FIELDNAMES, HEADER, TRAILER, UPLOADLOCATION, UPLOADPATH, FILEPREFIXNAME, FILEEXTENSION, FILESEQUENCENO, LASTPROCESSEDON, FILENAMEFORMAT, CRONEXPRESSION, NOTIFICATIONSTATUSEMAIL, POSTEVENT, BACKUPFILE, ACTIVE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_CONFIG), 'PAYINS_REFUND_UPLOAD', 'payment Instruction Upload File.', 12, 'PaymentInstruction', null, null, ',', 0, 1, null, 'ROW:{Reference No,Type of Excess,Fee Type,Pay Amount,Remarks,Override Overdue}', null, 'C', '/opt/pff/hdfc/paymentinstruction/upload', 'PaymentInstruction_', '.xls', 0, CURRENT_TIMESTAMP, '${ddmm},.${SEQ_DATE_FILE}', null, 0, NULL, 1, 1);

				INSERT INTO DATA_ENGINE_TABLE (ID, CONFIGID, NAME, OPERATION, KEYFIELDS, FILTER, STATUSUPDATE, SKIPROWS, IDENTIFIER, DESCRIPTION, STARTINDEX, ENDINDEX, RECORDLENGTH, MULTIROW, HEADERTABLE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_TABLE), (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_UPLOAD'), 'PAYMINS_UPLOADS', 1, 'HEADERID', NULL, NULL, NULL, NULL, NULL, NULL, NULL, 2, 0, 0);

				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'PAYMINS_UPLOADS' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_UPLOAD')), 'HEADERID',     0, 'N', NULL, NULL, '${HEADER_ID}', NULL, '0', NULL, NULL, NULL, NULL, 'M');								
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'PAYMINS_UPLOADS' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_UPLOAD')), 'FINREFERENCE',  0, 'N', NULL, NULL, NULL, NULL, '0', NULL, NULL, NULL, NULL, 'M');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'PAYMINS_UPLOADS' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_UPLOAD')), 'EXCESSTYPE',       0, 'N', NULL, NULL, NULL, NULL, '1', NULL, NULL, NULL, NULL, 'M');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'PAYMINS_UPLOADS' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_UPLOAD')), 'FEETYPE',       0, 'N', NULL, NULL, NULL, NULL, '2', NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'PAYMINS_UPLOADS' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_UPLOAD')), 'PAYAMOUNT',       0, 'N', NULL, NULL, NULL, NULL, '3', NULL, NULL, NULL, NULL, 'M');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'PAYMINS_UPLOADS' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_UPLOAD')), 'REMARKS',       0, 'N', NULL, NULL, NULL, NULL, '4', NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'PAYMINS_UPLOADS' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_UPLOAD')), 'OVERRIDEOVERDUE',       0, 'N', NULL, NULL, NULL, NULL, '5', NULL, NULL, NULL, NULL, 'M');
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="TK#2565.6" author="saisandeep.b">
		<sql>
			<![CDATA[
				DELETE FROM DATA_ENGINE_LOG WHERE STATUSID IN (SELECT ID FROM DATA_ENGINE_STATUS WHERE NAME ='PAYINS_REFUND_TEMPLATE');
 				DELETE FROM DATA_ENGINE_DOWNLOAD_HISTORY WHERE ID IN (SELECT ID FROM DATA_ENGINE_STATUS WHERE NAME ='PAYINS_REFUND_TEMPLATE');
 				DELETE FROM DATA_ENGINE_STATUS WHERE NAME ='PAYINS_REFUND_TEMPLATE';
							
				DELETE FROM DATA_ENGINE_COLUMN WHERE TABLEID IN (SELECT ID FROM DATA_ENGINE_TABLE WHERE CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_TEMPLATE'));
				DELETE FROM DATA_ENGINE_TABLE WHERE CONFIGID IN (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_TEMPLATE');
				DELETE FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_TEMPLATE';
							
				INSERT INTO DATA_ENGINE_CONFIG (ID, NAME, DESCRIPTION, PARSER, WORKSHEET, TEXTQUALIFIER, ROWDELIMITER, COLUMNDELIMITER, STARTINGROW, SKIPHEADERROW, FIELDNAMES, HEADER, TRAILER, UPLOADLOCATION, UPLOADPATH, FILEPREFIXNAME, FILEEXTENSION, FILESEQUENCENO, LASTPROCESSEDON, FILENAMEFORMAT, CRONEXPRESSION, NOTIFICATIONSTATUSEMAIL, POSTEVENT, BACKUPFILE, ACTIVE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_CONFIG), 'PAYINS_REFUND_TEMPLATE', 'PaymentInstruction template download', 3, 'PaymentInstruction', NULL, NULL, ',' , 0, 0, NULL, 'ROW:{Reference No,Type of Excess,Fee Type,Pay Amount,Remarks,Override Overdue}',  '', 'A', '/opt/pff/hdfc/paymentinstruction/template', 'PaymentInstruction_', '.xls', 0, current_timestamp, '${ddMMYYYYHms}', NULL, 0, NULL, 1, 1);

				INSERT INTO DATA_ENGINE_TABLE (ID, CONFIGID, NAME, OPERATION, KEYFIELDS, FILTER, STATUSUPDATE, SKIPROWS, IDENTIFIER, DESCRIPTION, STARTINDEX, ENDINDEX, RECORDLENGTH, MULTIROW, HEADERTABLE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_TABLE), (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_TEMPLATE'), 'PAYMINS_UPLOADS',  0, 'ID', 'HEADERID = :HEADERID', NULL, NULL, NULL, NULL, NULL, NULL, 2, 0, 0);
				
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'PAYMINS_UPLOADS' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_TEMPLATE')), 'FINREFERENCE',0, 'N', NULL, NULL, NULL, NULL, '0', NULL, NULL, NULL, NULL, 'M');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'PAYMINS_UPLOADS' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_TEMPLATE')), 'EXCESSTYPE',0, 'N', NULL, NULL, NULL, NULL, '1', NULL, NULL, NULL, NULL, 'M');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'PAYMINS_UPLOADS' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_TEMPLATE')), 'FEETYPE',0, 'N', NULL, NULL, NULL, NULL, '2', NULL, NULL, NULL, NULL, 'M');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'PAYMINS_UPLOADS' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_TEMPLATE')), 'PAYAMOUNT',0, 'N', NULL, NULL, NULL, NULL, '3', NULL, NULL, NULL, NULL, 'M');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'PAYMINS_UPLOADS' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_TEMPLATE')), 'REMARKS',0, 'N', NULL, NULL, NULL, NULL, '4', NULL, NULL, NULL, NULL, 'M');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'PAYMINS_UPLOADS' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_TEMPLATE')), 'OVERRIDEOVERDUE',0, 'N', NULL, NULL, NULL, NULL, '5', NULL, NULL, NULL, NULL, 'M');
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="TK#2565.7" author="saisandeep.b">
		<sql>
			<![CDATA[
				DELETE FROM DATA_ENGINE_LOG WHERE STATUSID IN (SELECT ID FROM DATA_ENGINE_STATUS WHERE NAME ='PAYINS_REFUND_DOWNLOAD');
 				DELETE FROM DATA_ENGINE_DOWNLOAD_HISTORY WHERE ID IN (SELECT ID FROM DATA_ENGINE_STATUS WHERE NAME ='PAYINS_REFUND_DOWNLOAD');
 				DELETE FROM DATA_ENGINE_STATUS WHERE NAME ='PAYINS_REFUND_DOWNLOAD';
							
				DELETE FROM DATA_ENGINE_COLUMN WHERE TABLEID IN (SELECT ID FROM DATA_ENGINE_TABLE WHERE CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_DOWNLOAD'));
				DELETE FROM DATA_ENGINE_TABLE WHERE CONFIGID IN (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_DOWNLOAD');
				DELETE FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_DOWNLOAD';
							
				INSERT INTO DATA_ENGINE_CONFIG (ID, NAME, DESCRIPTION, PARSER, WORKSHEET, TEXTQUALIFIER, ROWDELIMITER, COLUMNDELIMITER, STARTINGROW, SKIPHEADERROW, FIELDNAMES, HEADER, TRAILER, UPLOADLOCATION, UPLOADPATH, FILEPREFIXNAME, FILEEXTENSION, FILESEQUENCENO, LASTPROCESSEDON, FILENAMEFORMAT, CRONEXPRESSION, NOTIFICATIONSTATUSEMAIL, POSTEVENT, BACKUPFILE, ACTIVE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_CONFIG), 'PAYINS_REFUND_DOWNLOAD', 'PaymentInstruction download', 3, 'PaymentInstruction', NULL, NULL, ',' , 0, 0, NULL, 'ROW:{Reference No,Type of Excess,Fee Type,Pay Amount,Remarks,Override Overdue,Upload Status,Upload Failure Reason}',  '', 'A', '/opt/pff/hdfc/paymentinstruction/download', 'PaymentInstruction_', '.xls', 0, current_timestamp, '${ddMMYYYYHms}', NULL, 0, NULL, 1, 1);

				INSERT INTO DATA_ENGINE_TABLE (ID, CONFIGID, NAME, OPERATION, KEYFIELDS, FILTER, STATUSUPDATE, SKIPROWS, IDENTIFIER, DESCRIPTION, STARTINDEX, ENDINDEX, RECORDLENGTH, MULTIROW, HEADERTABLE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_TABLE), (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_DOWNLOAD'), 'PAYMINS_UPLOADS',  0, 'ID', 'HEADERID = :HEADERID', NULL, NULL, NULL, NULL, NULL, NULL, 10, 0, 0);
				
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'PAYMINS_UPLOADS' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_DOWNLOAD')), 'FINREFERENCE',    0,'N', NULL, NULL, NULL, NULL, '0', NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'PAYMINS_UPLOADS' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_DOWNLOAD')), 'TYPEOFEXCESS',	 0,'N', NULL, NULL, NULL, NULL, '1', NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'PAYMINS_UPLOADS' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_DOWNLOAD')), 'FEETYPE',	     0,'N', NULL, NULL, NULL, NULL, '2', NULL, NULL, NULL, 'dd-MMM-yyyy', 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'PAYMINS_UPLOADS' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_DOWNLOAD')), 'PAYAMOUNT',	         0,'N', NULL, NULL, NULL, NULL, '3', NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'PAYMINS_UPLOADS' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_DOWNLOAD')), 'REMARKS',	     0,'N', NULL, NULL, NULL, NULL, '4', NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'PAYMINS_UPLOADS' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_DOWNLOAD')), 'OVERRIDEOVERDUE',	     0,'N', NULL, NULL, NULL, NULL, '5', NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'PAYMINS_UPLOADS' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_DOWNLOAD')), 'STATUS',	     0,'N', NULL, NULL, NULL, NULL, '6', NULL, NULL, NULL, NULL, 'O');
				INSERT INTO DATA_ENGINE_COLUMN (ID, TABLEID, NAME, SKIP, SEQTYPE, SEQOBJECT, DEFAULTVALUE, DERIVEDFROM, REFERENCECOLUMN, STARTINDEX, ENDINDEX, RULEFORVALUE, QUERYFORVALUE, FORMAT, CONSTRAINTTYPE) VALUES ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_COLUMN), (SELECT ID FROM DATA_ENGINE_TABLE WHERE NAME = 'PAYMINS_UPLOADS' AND CONFIGID = (SELECT ID FROM DATA_ENGINE_CONFIG WHERE NAME = 'PAYINS_REFUND_DOWNLOAD')), 'ErrorDesc',	     0,'N', NULL, NULL, NULL, NULL, '7', NULL, NULL, NULL, NULL, 'O');
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="TK#2565.8_pre" author="saisandeep.b" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'financemainmaintenance_view');
			]]>
		</sql>
	</changeSet>

	<changeSet id="TK#2565.8" author="saisandeep.b">
		<createView replaceIfExists="true" viewName="FINANCEMAINMAINTENANCE_VIEW">
			<![CDATA[
				SELECT T1.FINID,
					T1.FINREFERENCE,
					T1.FINTYPE,
					T1.FINCCY,
					T1.CALROUNDINGMODE,
					T1.ROUNDINGTARGET,
					T1.FINBRANCH,
					T1.CUSTID,
					T1.FINSTARTDATE,
					T1.MATURITYDATE,
					T1.CLOSINGSTATUS,
					T1.WRITEOFFLOAN
				FROM FINANCEMAIN_TEMP T1
				UNION ALL
				SELECT T1.FINID,
					T1.FINREFERENCE,
					T1.FINTYPE,
					T1.FINCCY,
					T1.CALROUNDINGMODE,
					T1.ROUNDINGTARGET,
					T1.FINBRANCH,
					T1.CUSTID,
					T1.FINSTARTDATE,
					T1.MATURITYDATE,
					T1.CLOSINGSTATUS,
					T1.WRITEOFFLOAN
				FROM FINANCEMAIN T1
				WHERE NOT EXISTS (SELECT 1 FROM FINANCEMAIN_TEMP WHERE FINANCEMAIN_TEMP.FINID= T1.FINID);
			]]>
		</createView>
	</changeSet>
	
	<changeSet id="TK#2565.8_post" author="saisandeep.b" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'financemainmaintenance_view');
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="TK#2565.9.1" author="saisandeep.b">
		<createTable tableName="PaymentInstUploadQueuing">
			<column name="Id" type="bigint" autoIncrement="true">
				<constraints nullable="false" primaryKey="true" primaryKeyName="PK_PYINSUPQUEUING_UPID" />
			</column>
			<column name="UploadHeaderId" type="bigint" />
			<column name="UploadDetailId" type="bigint" />
			<column name="Finreference" type="varchar(20)" />
			<column name="JsonObject" type="clob" />
			<column name="EodDate" type="datetime" />
			<column name="ThreadId" type="int" />
			<column name="Progress" type="int" />
			<column name="StartTime" type="datetime" />
			<column name="EndTime" type="datetime" />
			<column name="ErrorLog" type="Varchar(2000)" />
			<column name="EodProcess" type="int"/>
		</createTable>
	</changeSet>
	
	<changeSet id="TK#2565.9.2" author="saisandeep.b">
		<createTable tableName="PaymentInstUploadQueuing_Log">
			<column name="Id" type="bigint" autoIncrement="true">
				<constraints nullable="false" primaryKey="true" primaryKeyName="PK_PYINSUPQUEUING_LOG_UPID" />
			</column>
			<column name="UploadHeaderId" type="bigint" />
			<column name="UploadDetailId" type="bigint" />
			<column name="Finreference" type="VARCHAR(20)" />
			<column name="JsonObject" type="clob" />
			<column name="EodDate" type="datetime" />
			<column name="ThreadId" type="int" />
			<column name="Progress" type="int" />
			<column name="StartTime" type="datetime" />
			<column name="EndTime" type="datetime" />
			<column name="ErrorLog" type="Varchar(2000)" />
			<column name="EodProcess" type="int"/>
		</createTable>
	</changeSet> 
	
	<changeSet id="TK#2565.10" author="saisandeep.b">
		<sql>
			<![CDATA[
				DELETE from ErrorDetails WHERE code='REFUND014';
				INSERT INTO ErrorDetails VALUES('REFUND014','EN','W','There are dues available for knock off! Please confirm to proceed','','Approved',null,null,null,null,null,0,CURRENT_TIMESTAMP,1000,0);
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="TK#2565.11" author="saisandeep.b">
		<sql>
			<![CDATA[
				Delete from SMTparameters where SysParmCode = 'REFUND_UPLOAD_THREAD_COUNT';
				INSERT INTO SMTparameters (SysParmCode, SysParmDesc, SysParmType, SysParmMaint, SysParmValue, SysParmLength, SysParmDec,SysParmList, SysParmValdMod, SysParmDescription, Version, LastMntBy, LastMntOn, RecordStatus, RoleCode, NextRoleCode, TaskId, NexttaskId, RecordType, WorkflowId) VALUES('REFUND_UPLOAD_THREAD_COUNT', 'Manual Refund default thread count', 'int', '1', '10', 2, 0, NULL, NULL, '', 1, 1000, CURRENT_TIMESTAMP,'Approved', NULL, NULL, NULL, NULL, NULL, 0);
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="TK#2565.12" author="saisandeep.b">
		<sql>
			<![CDATA[
				DELETE FROM SECROLEGROUPS WHERE GRPID IN (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'MANUAL_REF_UPLOAD_MAKER');
				DELETE FROM SECROLEGROUPS WHERE GRPID IN (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'MANUAL_REF_UPLOAD_APPROVER');

				DELETE FROM SECROLES WHERE ROLECD = 'MANUAL_REF_UPLOAD_MAKER';
				DELETE FROM SECROLES WHERE ROLECD = 'MANUAL_REF_UPLOAD_APPROVER';

				DELETE FROM SECGROUPRIGHTS WHERE GRPID IN (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'MANUAL_REF_UPLOAD_MAKER');
				DELETE FROM SECGROUPRIGHTS WHERE GRPID IN (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'MANUAL_REF_UPLOAD_APPROVER');

				DELETE FROM SECGROUPS WHERE GRPCODE ='MANUAL_REF_UPLOAD_MAKER';
				DELETE FROM SECGROUPS WHERE GRPCODE ='MANUAL_REF_UPLOAD_APPROVER';

				DELETE FROM SECRIGHTS WHERE RIGHTNAME ='menu_Item_ManualRefUpload_Maker';
				DELETE FROM SECRIGHTS WHERE RIGHTNAME ='menu_Item_ManualRefUpload_Approver';

				INSERT INTO SECRIGHTS(RIGHTID, RIGHTTYPE, RIGHTNAME, PAGE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES ((SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 0, 'menu_Item_ManualRefUpload_Maker', 'MENU', 1, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				INSERT INTO SECRIGHTS(RIGHTID, RIGHTTYPE, RIGHTNAME, PAGE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES ((SELECT MAX(RIGHTID)+1 FROM SECRIGHTS), 0, 'menu_Item_ManualRefUpload_Approver', 'MENU', 1, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				
				INSERT INTO SECGROUPS(GRPID, GRPCODE, GRPDESC, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(GRPID)+1 FROM SECGROUPS), 'MANUAL_REF_UPLOAD_MAKER', 'WF Maker for Manual Refund Upload', 0, 1000, current_timestamp, 'Approved', null, null, null, null, null, 0);
				INSERT INTO SECGROUPS(GRPID, GRPCODE, GRPDESC, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(GRPID)+1 FROM SECGROUPS), 'MANUAL_REF_UPLOAD_APPROVER', 'WF Approver for Manual Refund Upload', 0, 1000, current_timestamp, 'Approved', null, null, null, null, null, 0);

				INSERT INTO SECGROUPRIGHTS (GRPRIGHTID, GRPID, RIGHTID, ACCESSTYPE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'MANUAL_REF_UPLOAD_MAKER'),    (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'menu_Item_ManualRefUpload_Maker'),    1, 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				INSERT INTO SECGROUPRIGHTS (GRPRIGHTID, GRPID, RIGHTID, ACCESSTYPE, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'MANUAL_REF_UPLOAD_APPROVER'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME = 'menu_Item_ManualRefUpload_Approver'), 1, 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);

				INSERT INTO SECROLES (ROLEID, ROLEAPP, ROLECD, ROLEDESC, ROLECATEGORY, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(ROLEID)+1 FROM SECROLES), 1, 'MANUAL_REF_UPLOAD_MAKER', 'Maker role from Manual Refund Upload', '', 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0); 
				INSERT INTO SECROLES (ROLEID, ROLEAPP, ROLECD, ROLEDESC, ROLECATEGORY, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID) VALUES((SELECT MAX(ROLEID)+1 FROM SECROLES), 1, 'MANUAL_REF_UPLOAD_APPROVER', 'Approver role from Manual Refund Upload',	'', 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);

				INSERT INTO SECROLEGROUPS (ROLEGRPID, GRPID, ROLEID, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID)VALUES ((SELECT MAX(ROLEGRPID)+1 FROM SECROLEGROUPS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'MANUAL_REF_UPLOAD_MAKER'),    (SELECT ROLEID FROM SECROLES WHERE ROLECD = 'MANUAL_REF_UPLOAD_MAKER'),    0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
				INSERT INTO SECROLEGROUPS (ROLEGRPID, GRPID, ROLEID, VERSION, LASTMNTBY, LASTMNTON, RECORDSTATUS, ROLECODE, NEXTROLECODE, TASKID, NEXTTASKID, RECORDTYPE, WORKFLOWID)VALUES ((SELECT MAX(ROLEGRPID)+1 FROM SECROLEGROUPS), (SELECT GRPID FROM SECGROUPS WHERE GRPCODE = 'MANUAL_REF_UPLOAD_APPROVER'), (SELECT ROLEID FROM SECROLES WHERE ROLECD = 'MANUAL_REF_UPLOAD_APPROVER'), 0, 1000, CURRENT_TIMESTAMP, 'Approved', NULL, NULL, NULL, NULL, NULL, 0);
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="TK#2568.1" author="Vijayakumar.K">
		<sql>
			<![CDATA[
				DELETE FROM ERRORDETAILS WHERE CODE='REFUND001';
				INSERT INTO ERRORDETAILS (CODE, LANGUAGE, SEVERITY, MESSAGE, RECORDSTATUS, WORKFLOWID, LASTMNTBY, VERSION) VALUES ('REFUND001', 'EN', 'E', 'DPD days are grater than the Configured system parameter value.', 'Approved', 0, 1000, 1);
				DELETE FROM ERRORDETAILS WHERE CODE='REFUND002';
				INSERT INTO ERRORDETAILS (CODE, LANGUAGE, SEVERITY, MESSAGE, RECORDSTATUS, WORKFLOWID, LASTMNTBY, VERSION) VALUES ('REFUND002', 'EN', 'E', 'Receipt in Cancellation process.', 'Approved', 0, 1000, 1);
				DELETE FROM ERRORDETAILS WHERE CODE='REFUND003';
				INSERT INTO ERRORDETAILS (CODE, LANGUAGE, SEVERITY, MESSAGE, RECORDSTATUS, WORKFLOWID, LASTMNTBY, VERSION) VALUES ('REFUND003', 'EN', 'E', 'Receipt in refund process.', 'Approved', 0, 1000, 1);
				DELETE FROM ERRORDETAILS WHERE CODE='REFUND004';
				INSERT INTO ERRORDETAILS (CODE, LANGUAGE, SEVERITY, MESSAGE, RECORDSTATUS, WORKFLOWID, LASTMNTBY, VERSION) VALUES ('REFUND004', 'EN', 'E', 'Refund Amount is grater than the max refund amount in loan type.', 'Approved', 0, 1000, 1);
				DELETE FROM ERRORDETAILS WHERE CODE='REFUND005';
				INSERT INTO ERRORDETAILS (CODE, LANGUAGE, SEVERITY, MESSAGE, RECORDSTATUS, WORKFLOWID, LASTMNTBY, VERSION) VALUES ('REFUND005', 'EN', 'E', 'Refund Amount is less than the minimum refund amount in loan type.', 'Approved', 0, 1000, 1);
				DELETE FROM ERRORDETAILS WHERE CODE='REFUND006';
				INSERT INTO ERRORDETAILS (CODE, LANGUAGE, SEVERITY, MESSAGE, RECORDSTATUS, WORKFLOWID, LASTMNTBY, VERSION) VALUES ('REFUND006', 'EN', 'E', 'Refund Amount is zero.', 'Approved', 0, 1000, 1);
				DELETE FROM ERRORDETAILS WHERE CODE='REFUND007';
				INSERT INTO ERRORDETAILS (CODE, LANGUAGE, SEVERITY, MESSAGE, RECORDSTATUS, WORKFLOWID, LASTMNTBY, VERSION) VALUES ('REFUND007', 'EN', 'E', 'Beneficiary details are not available for  the refund loan.', 'Approved', 0, 1000, 1);
				DELETE FROM ERRORDETAILS WHERE CODE='REFUND008';
				INSERT INTO ERRORDETAILS (CODE, LANGUAGE, SEVERITY, MESSAGE, RECORDSTATUS, WORKFLOWID, LASTMNTBY, VERSION) VALUES ('REFUND008', 'EN', 'E', 'Amount refunded sucessfully to loan..', 'Approved', 0, 1000, 1);
				DELETE FROM ERRORDETAILS WHERE CODE='REFUND009';
				INSERT INTO ERRORDETAILS (CODE, LANGUAGE, SEVERITY, MESSAGE, RECORDSTATUS, WORKFLOWID, LASTMNTBY, VERSION) VALUES ('REFUND009', 'EN', 'E', ' Auto refund Failed', 'Approved', 0, 1000, 1);
				DELETE FROM ERRORDETAILS WHERE CODE='REFUND010';
				INSERT INTO ERRORDETAILS (CODE, LANGUAGE, SEVERITY, MESSAGE, RECORDSTATUS, WORKFLOWID, LASTMNTBY, VERSION) VALUES ('REFUND010', 'EN', 'E', 'Loan was write off.', 'Approved', 0, 1000, 1);
				DELETE FROM ERRORDETAILS WHERE CODE='REFUND011';
				INSERT INTO ERRORDETAILS (CODE, LANGUAGE, SEVERITY, MESSAGE, RECORDSTATUS, WORKFLOWID, LASTMNTBY, VERSION) VALUES ('REFUND011', 'EN', 'E', 'Loan is in Hold Staus.', 'Approved', 0, 1000, 1);
				DELETE FROM ERRORDETAILS WHERE CODE='REFUND012';
				INSERT INTO ERRORDETAILS (CODE, LANGUAGE, SEVERITY, MESSAGE, RECORDSTATUS, WORKFLOWID, LASTMNTBY, VERSION) VALUES ('REFUND012', 'EN', 'E', 'Loan was not refund because auto refund through cheque  flag value is false.', 'Approved', 0, 1000, 1);
				DELETE FROM ERRORDETAILS WHERE CODE='REFUND013';
				INSERT INTO ERRORDETAILS (CODE, LANGUAGE, SEVERITY, MESSAGE, RECORDSTATUS, WORKFLOWID, LASTMNTBY, VERSION) VALUES ('REFUND013', 'EN', 'E', 'Unhandled expection.', 'Approved', 0, 1000, 1);
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="TK#2568.2" author="Vijayakumar.k">
		<createTable tableName="Auto_Refund_Loans">
			<column name="Id" type="bigint" autoIncrement="true">
				<constraints nullable="false" primaryKey="true" />
			</column>
			<column name="FinId" type="NUMBER" >
				<constraints nullable="false"/>
			</column>
			<column name="REFUNDAMT" type="NUMBER(18,0)" defaultValue="0" />
			<column name="APPDATE" type="date" />
			<column name="ExecutionTime" type="timestamp" />
			<column name="Status" type="char(1)" />
			<column name="ERRORCODE" type="varchar2(20)" />
		</createTable>
	</changeSet>
</databaseChangeLog>