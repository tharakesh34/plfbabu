<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />
	
	<changeSet id="01" author="Surekha">
		<sql>
			 DELETE from ReportList where Code = 'WorkFlowDetails';
 
			Insert into ReportList Values('WorkFlowDetails','WorkFlowDetails','listheader_workFlowType.label,listheader_workFlowSubType.label,listheader_workFlowDesc.label,listheader_RecordStatus.label,listheader_RecordType.label','workFlowType,workFlowSubType,workFlowDesc,recordStatus,recordType','String,String,String,String,String','','ReportList05','WorkFlow Details', 'Solution Factory',0, 1000,Current_TimeStamp,'Approved', null, null, null, null, null, 0,0);
		</sql>
	</changeSet>
	<changeSet id="02" author="Surekha">
		<sql>
			UPDATE SEQSECGROUPS SET SEQNO= (SELECT MAX(GRPID) FROM SECGROUPS);
			UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS); 
			UPDATE SEQSECROLEGROUPS SET SEQNO= (SELECT MAX(ROLEGRPID) FROM SECROLEGROUPS);
			
			INSERT INTO SECGROUPS SELECT (SELECT MAX(GRPID)+1 FROM SECGROUPS), 'JVPOSTINGS_VIEW', 'WF enquiry for JVPOSTINGS', 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0 FROM SEQSECGROUPS WHERE 0=0;
			INSERT INTO SecRoleGroups values((Select MAX(RoleGrpID)+1 From SecRoleGroups),(Select GrpId  From SecGroups Where GrpCode='JVPOSTINGS_VIEW'), (Select  RoleID  From SecRoles Where RoleCd='MSTGRP1_MAKER'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
			INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='JVPOSTINGS_VIEW') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='menuItem_others_JVPostingEnquiry'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
			 
			UPDATE SEQSECGROUPS SET SEQNO= (SELECT MAX(GRPID) FROM SECGROUPS);
			UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS); 
			UPDATE SEQSECROLEGROUPS SET SEQNO= (SELECT MAX(ROLEGRPID) FROM SECROLEGROUPS);
			
		</sql>
	</changeSet>
	<changeSet id="03" author="Surekha">
		<createView viewName="RELATIONSHIPOFFICERS_VIEW" replaceIfExists="true">
			SELECT T1.ROfficerCode , T1.ROfficerDesc ,T1.ROfficerDeptCode ,T2.GenDeptDesc lovDescROfficerDeptCodeName  , T1.ROfficerIsActive ,
	           T1.Version , T1.LastMntBy , T1.LastMntOn ,T1.RecordStatus , T1.RoleCode ,T1.NextRoleCode , T1.TaskId ,T1.NextTaskId , T1.RecordType , T1.WorkflowId 
     		FROM RelationshipOfficers_Temp T1 LEFT JOIN 
     			RMTGenDepartments T2 ON T1.ROfficerDeptCode = T2.GenDepartment
			UNION ALL 
			SELECT T1.ROfficerCode , T1.ROfficerDesc ,T1.ROfficerDeptCode ,T2.GenDeptDesc lovDescROfficerDeptCodeName  , T1.ROfficerIsActive ,
	           T1.Version , T1.LastMntBy , T1.LastMntOn ,T1.RecordStatus , T1.RoleCode ,T1.NextRoleCode , T1.TaskId ,T1.NextTaskId , T1.RecordType , T1.WorkflowId 
     		FROM RelationshipOfficers T1 LEFT JOIN 
     			RMTGenDepartments T2 ON T1.ROfficerDeptCode = T2.GenDepartment
     		WHERE NOT EXISTS ( SELECT 1 FROM RelationshipOfficers_Temp WHERE ROfficerCode = T1.ROfficerCode )
		</createView>
	</changeSet>
</databaseChangeLog>