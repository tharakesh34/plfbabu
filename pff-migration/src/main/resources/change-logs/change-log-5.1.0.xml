<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />

	<changeSet id="pre_run_for_pgp" author="Adarsh" runAlways="true" dbms="postgresql">
		<sql>
			Set search_path = plf,public,pg_catalog;
		</sql>
	</changeSet>

	<changeSet id="1" author="Shinde.b">
		<addColumn tableName="RMTFinanceTypes">
			<column name="AutoApprove" type="boolean" defaultValueBoolean="0" />
		</addColumn>
	</changeSet>

	<changeSet id="2" author="Shinde.b">
		<addColumn tableName="RMTFinanceTypes_Temp">
			<column name="AutoApprove" type="boolean" defaultValueBoolean="0" />
		</addColumn>
	</changeSet>

	<changeSet id="3" author="Shinde.b">
		<sql>
			Update RMTFinanceTypes set AutoApprove = 0;
			Update RMTFinanceTypes_Temp set AutoApprove = 0;
		</sql>
	</changeSet>

	<changeSet id="4" author="Shinde.b">
		<createView viewName="RMTFINANCETYPES_VIEW" replaceIfExists="true">
				   SELECT t1.fintype,
					    t1.fincategory,
					    t1.fintypedesc,
					    t1.finccy,
					    t1.findayscaltype,
					    t1.finactype,
					    t1.fincontingentactype,
					    t1.finisgenref,
					    t1.finmaxamount,
					    t1.finminamount,
					    t1.finisopennewfinac,
					    t1.findftstmtfrq,
					    t1.finisalwmd,
					    t1.finschdmthd,
					    t1.finisalwgrace,
					    t1.finhistretension,
					    t1.equalrepayment,
					    t1.finratetype,
					    t1.finbaserate,
					    t1.finsplrate,
					    t1.finintrate,
					    t1.finminrate,
					    t1.finmaxrate,
					    t1.findftintfrq,
					    t1.finisintcpz,
					    t1.fincpzfrq,
					    t1.finisrvwalw,
					    t1.finrvwfrq,
					    t1.fingrcratetype,
					    t1.fingrcbaserate,
					    t1.fingrcsplrate,
					    t1.fingrcintrate,
					    t1.fingrcminrate,
					    t1.fingrcmaxrate,
					    t1.fingrcdftintfrq,
					    t1.fingrcisintcpz,
					    t1.fingrccpzfrq,
					    t1.fingrcisrvwalw,
					    t1.fingrcrvwfrq,
					    t1.finminterm,
					    t1.finmaxterm,
					    t1.findftterms,
					    t1.finrpyfrq,
					    t1.finrepaymethod,
					    t1.finisalwpartialrpy,
					    t1.finisalwdifferment,
					    t1.finmaxdifferment,
					    t1.finisalwearlyrpy,
					    t1.finisalwearlysettle,
					    t1.finodrpytries,
					    t1.finearlypayrule,
					    t1.finearlysettlerule,
					    t1.findepositrestrictedto,
					    t1.finaebuyorinception,
					    t1.finaesellormaturity,
					    t1.finisactive,
					    t1.version,
					    t1.lastmntby,
					    t1.lastmnton,
					    t1.recordstatus,
					    t1.rolecode,
					    t1.nextrolecode,
					    t1.taskid,
					    t1.nexttaskid,
					    t1.recordtype,
					    t1.workflowid,
					    t1.stepfinance,
					    t1.steppingmandatory,
					    t1.alwmanualsteps,
					    t1.alwdsteppolicies,
					    t1.dftsteppolicy,
					    t4.actypedesc AS lovdescfincontingentactypename,
					    t5.actypedesc AS lovdescfinactypename,
					    t1.finisdwpayrequired,
					    t1.finrvwrateapplfor,
					    t1.finalwratechangeanydate,
					    t1.finisintcpzatgrcend,
					    t1.finelgrulecode,
					    t1.limitelgrulecode,
					    t1.finschcalcodeonrvw,
					    t1.alwplandeferment,
					    t1.plandefercount,
					    t1.finassettype,
					    t1.pftpayactype,
					    t1.finisopenpftpayacc,
					    t31.actypedesc AS lovdescpftpayactypename,
					    t1.finisalwgrcrepay,
					    t1.fingrcschdmthd,
					    t1.fingrcmargin,
					    t1.finmargin,
					    t1.finscheduleon,
					    t1.fingrcscheduleon,
					    t1.fincommitmentreq,
					    t1.fincollateralreq,
					    t1.findepreciationreq,
					    t1.findepreciationfrq,
					    t1.finbankcontingentactype,
					    t1.finprovisionactype,
					    t38.actypedesc AS lovdescfinbankcontactypename,
					    t39.actypedesc AS lovdescfinprovisionactypename,
					    t1.allowriainvestment,
					    t1.overridelimit,
					    t1.limitrequired,
					    t1.fincommitmentovrride,
					    t1.fincollateralovrride,
					    t1.finpftunchanged,
					    t1.applyodpenalty,
					    t1.odincgrcdays,
					    t1.odchargetype,
					    t1.odgracedays,
					    t1.odchargecalon,
					    t1.odchargeamtorperc,
					    t1.odallowwaiver,
					    t1.odmaxwaiverperc,
					    t1.findivision,
					    t48.divisioncodedesc AS lovdescfindivisionname,
					    t48.entitycode AS lovdescentitycode,
					    t1.finsuspactype,
					    t49.actypedesc AS lovdescfinsuspactypename,
					    t1.product,
					    t1.startdate,
					    t1.enddate,
					    t1.allowdownpaypgm,
					    t1.fintypedesc AS lovdescpromofintypedesc,
					    t1.remarks,
					    t1.alwearlypaymethods,
					    t1.pastduepftcalmthd,
					    t1.pastduepftmargin,
					    t1.alwadvancerent,
					    t1.grcadvbaserate,
					    t1.grcadvmargin,
					    t1.grcadvpftrate,
					    t1.rpyadvbaserate,
					    t1.rpyadvmargin,
					    t1.rpyadvpftrate,
					    t1.rolloverfinance,
					    t1.rolloverfrq,
					    t1.downpayrule,
					    t59.rulecode AS downpayrulecode,
					    t59.rulecodedesc AS downpayruledesc,
					    t1.finsusptrigger,
					    t1.finsuspremarks,
					    t1.alwmultipartydisb,
					    t1.collateraltype,
					    t1.tdsapplicable,
					    t1.manualschedule,
					    t1.applygrcpricing,
					    t1.grcpricingmethod,
					    t1.applyrpypricing,
					    t1.rpypricingmethod,
					    t1.rpyhierarchy,
					    t67.rulecode AS grcpricingmethoddesc,
					    t68.rulecode AS rpypricingmethoddesc,
					    t1.droplineod,
					    t1.droppingmethod,
					    t1.ratechganyday,
					    t1.finrepaypftonfrq,
					    t1.alwbpi,
					    t1.bpitreatment,
					    t1.pftdueschon,
					    t1.planemihalw,
					    t1.planemihmethod,
					    t1.planemihmaxperyear,
					    t1.planemihmax,
					    t1.planemihlockperiod,
					    t1.planemicpz,
					    t1.unplanemihlockperiod,
					    t1.unplanemicpz,
					    t1.reagecpz,
					    t1.fddlockperiod,
					    t1.alwdrpymethods,
					    t1.maxunplannedemi,
					    t1.maxreageholidays,
					    t1.roundingmode,
					    t1.roundingtarget,
					    t1.frequencydays,
					    t1.quickdisb,
					    t1.alwmaxdisbcheckreq,
					    t1.alwreage,
					    t1.alwunplanemiholiday,
					    t1.profitcenterid,
					    t69.profitcentercode,
					    t69.profitcenterdesc,
					    t1.productcategory,
					    t2.productdesc AS fincategorydesc,
					    t1.developerfinance,
					    t1.costoffunds,
					    t1.chequecapturereq,
					    t1.finltvcheck,
					    t1.partiallysecured,
					    t1.alwadvemi,
					    t1.advemiminterms,
					    t1.advemimaxterms,
					    t1.advemidftterms,
					    t1.advemischdmthd,
					    t1.bpipftdaysbasis,
					    t1.eligibilitymethods,
					    t1.alwhybridrate,
					    t1.fixedratetenor,
					    t1.odmincapamount,
					    t1.odrulecode,
					    t1.alwzerointacc,
					    t1.autorejectiondays,
					    t1.taxnomand,
					    t1.putcallrequired,
					    t1.grcadvintersetreq,
					    t1.grcadvtype,
					    t1.grcadvminterms,
					    t1.grcadvmaxterms,
					    t1.grcadvdefaultterms,
					    t1.advintersetreq,
					    t1.advtype,
					    t1.advminterms,
					    t1.advmaxterms,
					    t1.advdefaultterms,
					    t1.advstage,
					    t1.dsfreq,
					    t1.cashcollateralreq,
					    t1.tdsallowtomodify,
					    t1.tdsapplicableto,
					    t1.alwvan,
					    t1.vanallocationmethod,
					    t1.allowdrawingpower,
					    t1.allowrevolving,
					    t1.alwsanctionamt,
					    t1.alwsanctionamtoverride,
					    t1.sanbsdschdle,
					    t1.finisratervwatgrcend,
					    t1.schdonpmtcal,
						t1.autoApprove
			     FROM rmtfinancetypes_temp t1
			     LEFT JOIN bmtproduct t2 ON t1.fincategory::text = t2.productcode::text
			     LEFT JOIN rmtaccounttypes t4 ON t1.fincontingentactype::text = t4.actype::text
			     LEFT JOIN rmtaccounttypes t38 ON t1.finbankcontingentactype::text = t38.actype::text
			     LEFT JOIN rmtaccounttypes t39 ON t1.finprovisionactype::text = t39.actype::text
			     LEFT JOIN rmtaccounttypes t5 ON t1.finactype::text = t5.actype::text
			     LEFT JOIN rmtaccounttypes t31 ON t1.pftpayactype::text = t31.actype::text
			     LEFT JOIN smtdivisiondetail t48 ON t1.findivision::text = t48.divisioncode::text
			     LEFT JOIN rmtaccounttypes t49 ON t1.finsuspactype::text = t49.actype::text
			     LEFT JOIN rules t59 ON t1.downpayrule = t59.ruleid
			     LEFT JOIN rules t67 ON t1.grcpricingmethod = t67.ruleid
			     LEFT JOIN rules t68 ON t1.rpypricingmethod = t68.ruleid
			     LEFT JOIN profitcenters t69 ON t69.profitcenterid = t1.profitcenterid
					 UNION ALL
					 SELECT t1.fintype,
					    t1.fincategory,
					    t1.fintypedesc,
					    t1.finccy,
					    t1.findayscaltype,
					    t1.finactype,
					    t1.fincontingentactype,
					    t1.finisgenref,
					    t1.finmaxamount,
					    t1.finminamount,
					    t1.finisopennewfinac,
					    t1.findftstmtfrq,
					    t1.finisalwmd,
					    t1.finschdmthd,
					    t1.finisalwgrace,
					    t1.finhistretension,
					    t1.equalrepayment,
					    t1.finratetype,
					    t1.finbaserate,
					    t1.finsplrate,
					    t1.finintrate,
					    t1.finminrate,
					    t1.finmaxrate,
					    t1.findftintfrq,
					    t1.finisintcpz,
					    t1.fincpzfrq,
					    t1.finisrvwalw,
					    t1.finrvwfrq,
					    t1.fingrcratetype,
					    t1.fingrcbaserate,
					    t1.fingrcsplrate,
					    t1.fingrcintrate,
					    t1.fingrcminrate,
					    t1.fingrcmaxrate,
					    t1.fingrcdftintfrq,
					    t1.fingrcisintcpz,
					    t1.fingrccpzfrq,
					    t1.fingrcisrvwalw,
					    t1.fingrcrvwfrq,
					    t1.finminterm,
					    t1.finmaxterm,
					    t1.findftterms,
					    t1.finrpyfrq,
					    t1.finrepaymethod,
					    t1.finisalwpartialrpy,
					    t1.finisalwdifferment,
					    t1.finmaxdifferment,
					    t1.finisalwearlyrpy,
					    t1.finisalwearlysettle,
					    t1.finodrpytries,
					    t1.finearlypayrule,
					    t1.finearlysettlerule,
					    t1.findepositrestrictedto,
					    t1.finaebuyorinception,
					    t1.finaesellormaturity,
					    t1.finisactive,
					    t1.version,
					    t1.lastmntby,
					    t1.lastmnton,
					    t1.recordstatus,
					    t1.rolecode,
					    t1.nextrolecode,
					    t1.taskid,
					    t1.nexttaskid,
					    t1.recordtype,
					    t1.workflowid,
					    t1.stepfinance,
					    t1.steppingmandatory,
					    t1.alwmanualsteps,
					    t1.alwdsteppolicies,
					    t1.dftsteppolicy,
					    t4.actypedesc AS lovdescfincontingentactypename,
					    t5.actypedesc AS lovdescfinactypename,
					    t1.finisdwpayrequired,
					    t1.finrvwrateapplfor,
					    t1.finalwratechangeanydate,
					    t1.finisintcpzatgrcend,
					    t1.finelgrulecode,
					    t1.limitelgrulecode,
					    t1.finschcalcodeonrvw,
					    t1.alwplandeferment,
					    t1.plandefercount,
					    t1.finassettype,
					    t1.pftpayactype,
					    t1.finisopenpftpayacc,
					    t31.actypedesc AS lovdescpftpayactypename,
					    t1.finisalwgrcrepay,
					    t1.fingrcschdmthd,
					    t1.fingrcmargin,
					    t1.finmargin,
					    t1.finscheduleon,
					    t1.fingrcscheduleon,
					    t1.fincommitmentreq,
					    t1.fincollateralreq,
					    t1.findepreciationreq,
					    t1.findepreciationfrq,
					    t1.finbankcontingentactype,
					    t1.finprovisionactype,
					    t38.actypedesc AS lovdescfinbankcontactypename,
					    t39.actypedesc AS lovdescfinprovisionactypename,
					    t1.allowriainvestment,
					    t1.overridelimit,
					    t1.limitrequired,
					    t1.fincommitmentovrride,
					    t1.fincollateralovrride,
					    t1.finpftunchanged,
					    t1.applyodpenalty,
					    t1.odincgrcdays,
					    t1.odchargetype,
					    t1.odgracedays,
					    t1.odchargecalon,
					    t1.odchargeamtorperc,
					    t1.odallowwaiver,
					    t1.odmaxwaiverperc,
					    t1.findivision,
					    t48.divisioncodedesc AS lovdescfindivisionname,
					    t48.entitycode AS lovdescentitycode,
					    t1.finsuspactype,
					    t49.actypedesc AS lovdescfinsuspactypename,
					    t1.product,
					    t1.startdate,
					    t1.enddate,
					    t1.allowdownpaypgm,
					    t1.fintypedesc AS lovdescpromofintypedesc,
					    t1.remarks,
					    t1.alwearlypaymethods,
					    t1.pastduepftcalmthd,
					    t1.pastduepftmargin,
					    t1.alwadvancerent,
					    t1.grcadvbaserate,
					    t1.grcadvmargin,
					    t1.grcadvpftrate,
					    t1.rpyadvbaserate,
					    t1.rpyadvmargin,
					    t1.rpyadvpftrate,
					    t1.rolloverfinance,
					    t1.rolloverfrq,
					    t1.downpayrule,
					    t59.rulecode AS downpayrulecode,
					    t59.rulecodedesc AS downpayruledesc,
					    t1.finsusptrigger,
					    t1.finsuspremarks,
					    t1.alwmultipartydisb,
					    t1.collateraltype,
					    t1.tdsapplicable,
					    t1.manualschedule,
					    t1.applygrcpricing,
					    t1.grcpricingmethod,
					    t1.applyrpypricing,
					    t1.rpypricingmethod,
					    t1.rpyhierarchy,
					    t67.rulecode AS grcpricingmethoddesc,
					    t68.rulecode AS rpypricingmethoddesc,
					    t1.droplineod,
					    t1.droppingmethod,
					    t1.ratechganyday,
					    t1.finrepaypftonfrq,
					    t1.alwbpi,
					    t1.bpitreatment,
					    t1.pftdueschon,
					    t1.planemihalw,
					    t1.planemihmethod,
					    t1.planemihmaxperyear,
					    t1.planemihmax,
					    t1.planemihlockperiod,
					    t1.planemicpz,
					    t1.unplanemihlockperiod,
					    t1.unplanemicpz,
					    t1.reagecpz,
					    t1.fddlockperiod,
					    t1.alwdrpymethods,
					    t1.maxunplannedemi,
					    t1.maxreageholidays,
					    t1.roundingmode,
					    t1.roundingtarget,
					    t1.frequencydays,
					    t1.quickdisb,
					    t1.alwmaxdisbcheckreq,
					    t1.alwreage,
					    t1.alwunplanemiholiday,
					    t1.profitcenterid,
					    t69.profitcentercode,
					    t69.profitcenterdesc,
					    t1.productcategory,
					    t2.productdesc AS fincategorydesc,
					    t1.developerfinance,
					    t1.costoffunds,
					    t1.chequecapturereq,
					    t1.finltvcheck,
					    t1.partiallysecured,
					    t1.alwadvemi,
					    t1.advemiminterms,
					    t1.advemimaxterms,
					    t1.advemidftterms,
					    t1.advemischdmthd,
					    t1.bpipftdaysbasis,
					    t1.eligibilitymethods,
					    t1.alwhybridrate,
					    t1.fixedratetenor,
					    t1.odmincapamount,
					    t1.odrulecode,
					    t1.alwzerointacc,
					    t1.autorejectiondays,
					    t1.taxnomand,
					    t1.putcallrequired,
					    t1.grcadvintersetreq,
					    t1.grcadvtype,
					    t1.grcadvminterms,
					    t1.grcadvmaxterms,
					    t1.grcadvdefaultterms,
					    t1.advintersetreq,
					    t1.advtype,
					    t1.advminterms,
					    t1.advmaxterms,
					    t1.advdefaultterms,
					    t1.advstage,
					    t1.dsfreq,
					    t1.cashcollateralreq,
					    t1.tdsallowtomodify,
					    t1.tdsapplicableto,
					    t1.alwvan,
					    t1.vanallocationmethod,
					    t1.allowdrawingpower,
					    t1.allowrevolving,
					    t1.alwsanctionamt,
					    t1.alwsanctionamtoverride,
					    t1.sanbsdschdle,
					    t1.finisratervwatgrcend,
					    t1.schdonpmtcal,
						t1.autoApprove
					   FROM rmtfinancetypes t1
					     LEFT JOIN bmtproduct t2 ON t1.fincategory::text = t2.productcode::text
					     LEFT JOIN rmtaccounttypes t4 ON t1.fincontingentactype::text = t4.actype::text
					     LEFT JOIN rmtaccounttypes t38 ON t1.finbankcontingentactype::text = t38.actype::text
					     LEFT JOIN rmtaccounttypes t39 ON t1.finprovisionactype::text = t39.actype::text
					     LEFT JOIN rmtaccounttypes t5 ON t1.finactype::text = t5.actype::text
					     LEFT JOIN rmtaccounttypes t31 ON t1.pftpayactype::text = t31.actype::text
					     LEFT JOIN smtdivisiondetail t48 ON t1.findivision::text = t48.divisioncode::text
					     LEFT JOIN rmtaccounttypes t49 ON t1.finsuspactype::text = t49.actype::text
					     LEFT JOIN rules t59 ON t1.downpayrule = t59.ruleid
					     LEFT JOIN rules t67 ON t1.grcpricingmethod = t67.ruleid
					     LEFT JOIN rules t68 ON t1.rpypricingmethod = t68.ruleid
					     LEFT JOIN profitcenters t69 ON t69.profitcenterid = t1.profitcenterid
					  WHERE NOT (EXISTS ( SELECT 1 AS expr1
					     FROM rmtfinancetypes_temp
					     WHERE rmtfinancetypes_temp.fintype::text = t1.fintype::text))
			   </createView>
	</changeSet>



	<changeSet id="4.1" author="Shinde.b" dbms="postgresql">
		<sql>
			<![CDATA[
					select deps_restore_dependencies ('plf', 'lmtfinanceworkflowdef_aview');
		 	]]>
		</sql>
	</changeSet>

	<changeSet id="4.2" author="Shinde.b">
		<sql>
	         <![CDATA[
	            Drop View RMTFINANCETYPES_AVIEW cascade;
	         ]]>
		</sql>
	</changeSet>


	<changeSet id="5" author="Shinde.b">
		<createView viewName="RMTFINANCETYPES_AVIEW" replaceIfExists="true">
			 SELECT t1.fintype,
				    t1.fincategory,
				    t1.fintypedesc,
				    t1.finccy,
				    t1.findayscaltype,
				    t1.finactype,
				    t1.fincontingentactype,
				    t1.finisgenref,
				    t1.finmaxamount,
				    t1.finminamount,
				    t1.finisopennewfinac,
				    t1.findftstmtfrq,
				    t1.finisalwmd,
				    t1.finschdmthd,
				    t1.finisalwgrace,
				    t1.finhistretension,
				    t1.equalrepayment,
				    t1.finratetype,
				    t1.finbaserate,
				    t1.finsplrate,
				    t1.finintrate,
				    t1.finminrate,
				    t1.finmaxrate,
				    t1.findftintfrq,
				    t1.finisintcpz,
				    t1.fincpzfrq,
				    t1.finisrvwalw,
				    t1.finrvwfrq,
				    t1.fingrcratetype,
				    t1.fingrcbaserate,
				    t1.fingrcsplrate,
				    t1.fingrcintrate,
				    t1.fingrcminrate,
				    t1.fingrcmaxrate,
				    t1.fingrcdftintfrq,
				    t1.fingrcisintcpz,
				    t1.fingrccpzfrq,
				    t1.fingrcisrvwalw,
				    t1.fingrcrvwfrq,
				    t1.finminterm,
				    t1.finmaxterm,
				    t1.findftterms,
				    t1.finrpyfrq,
				    t1.finrepaymethod,
				    t1.finisalwpartialrpy,
				    t1.finisalwdifferment,
				    t1.finmaxdifferment,
				    t1.finisalwearlyrpy,
				    t1.finisalwearlysettle,
				    t1.finodrpytries,
				    t1.finearlypayrule,
				    t1.finearlysettlerule,
				    t1.findepositrestrictedto,
				    t1.finaebuyorinception,
				    t1.finaesellormaturity,
				    t1.finisactive,
				    t1.version,
				    t1.lastmntby,
				    t1.lastmnton,
				    t1.recordstatus,
				    t1.rolecode,
				    t1.nextrolecode,
				    t1.taskid,
				    t1.nexttaskid,
				    t1.recordtype,
				    t1.workflowid,
				    t1.stepfinance,
				    t1.steppingmandatory,
				    t1.alwmanualsteps,
				    t1.alwdsteppolicies,
				    t1.dftsteppolicy,
				    t4.actypedesc AS lovdescfincontingentactypename,
				    t5.actypedesc AS lovdescfinactypename,
				    t1.finisdwpayrequired,
				    t1.finrvwrateapplfor,
				    t1.finalwratechangeanydate,
				    t1.finisintcpzatgrcend,
				    t1.finelgrulecode,
				    t1.limitelgrulecode,
				    t1.finschcalcodeonrvw,
				    t1.alwplandeferment,
				    t1.plandefercount,
				    t1.finassettype,
				    t1.pftpayactype,
				    t1.finisopenpftpayacc,
				    t31.actypedesc AS lovdescpftpayactypename,
				    t1.finisalwgrcrepay,
				    t1.fingrcschdmthd,
				    t1.fingrcmargin,
				    t1.finmargin,
				    t1.finscheduleon,
				    t1.fingrcscheduleon,
				    t1.fincommitmentreq,
				    t1.fincollateralreq,
				    t1.findepreciationreq,
				    t1.findepreciationfrq,
				    t1.finbankcontingentactype,
				    t1.finprovisionactype,
				    t38.actypedesc AS lovdescfinbankcontactypename,
				    t39.actypedesc AS lovdescfinprovisionactypename,
				    t1.allowriainvestment,
				    t1.overridelimit,
				    t1.limitrequired,
				    t1.fincommitmentovrride,
				    t1.fincollateralovrride,
				    t1.finpftunchanged,
				    t1.applyodpenalty,
				    t1.odincgrcdays,
				    t1.odchargetype,
				    t1.odgracedays,
				    t1.odchargecalon,
				    t1.odchargeamtorperc,
				    t1.odallowwaiver,
				    t1.odmaxwaiverperc,
				    t1.findivision,
				    t48.divisioncodedesc AS lovdescfindivisionname,
				    t48.entitycode AS lovdescentitycode,
				    t1.finsuspactype,
				    t49.actypedesc AS lovdescfinsuspactypename,
				    t1.product,
				    t1.startdate,
				    t1.enddate,
				    t1.allowdownpaypgm,
				    t1.remarks,
				    t1.alwearlypaymethods,
				    t1.pastduepftcalmthd,
				    t1.pastduepftmargin,
				    t1.alwadvancerent,
				    t1.grcadvbaserate,
				    t1.grcadvmargin,
				    t1.grcadvpftrate,
				    t1.rpyadvbaserate,
				    t1.rpyadvmargin,
				    t1.rpyadvpftrate,
				    t1.rolloverfinance,
				    t1.rolloverfrq,
				    t1.downpayrule,
				    t59.rulecode AS downpayrulecode,
				    t59.rulecodedesc AS downpayruledesc,
				    t1.finsusptrigger,
				    t1.finsuspremarks,
				    t1.alwmultipartydisb,
				    t1.collateraltype,
				    t1.tdsapplicable,
				    t1.manualschedule,
				    t1.applygrcpricing,
				    t1.grcpricingmethod,
				    t1.applyrpypricing,
				    t1.rpypricingmethod,
				    t1.rpyhierarchy,
				    t67.rulecode AS grcpricingmethoddesc,
				    t68.rulecode AS rpypricingmethoddesc,
				    t1.droplineod,
				    t1.droppingmethod,
				    t1.ratechganyday,
				    t1.finrepaypftonfrq,
				    t1.alwbpi,
				    t1.bpitreatment,
				    t1.pftdueschon,
				    t1.planemihalw,
				    t1.planemihmethod,
				    t1.planemihmaxperyear,
				    t1.planemihmax,
				    t1.planemihlockperiod,
				    t1.planemicpz,
				    t1.unplanemihlockperiod,
				    t1.unplanemicpz,
				    t1.reagecpz,
				    t1.fddlockperiod,
				    t1.alwdrpymethods,
				    t1.maxunplannedemi,
				    t1.maxreageholidays,
				    t1.roundingmode,
				    t1.roundingtarget,
				    t1.frequencydays,
				    t1.quickdisb,
				    t1.alwreage,
				    t1.alwunplanemiholiday,
				    t1.alwmaxdisbcheckreq,
				    t1.fintypedesc AS lovdescpromofintypedesc,
				    t1.profitcenterid,
				    t69.profitcentercode,
				    t69.profitcenterdesc,
				    t1.productcategory,
				    t2.productdesc AS fincategorydesc,
				    t1.developerfinance,
				    t1.costoffunds,
				    t1.chequecapturereq,
				    t1.finltvcheck,
				    t1.partiallysecured,
				    t1.alwadvemi,
				    t1.advemiminterms,
				    t1.advemimaxterms,
				    t1.advemidftterms,
				    t1.advemischdmthd,
				    t1.bpipftdaysbasis,
				    t1.eligibilitymethods,
				    t1.alwhybridrate,
				    t1.fixedratetenor,
				    t1.odmincapamount,
				    t1.odrulecode,
				    t1.alwzerointacc,
				    t1.autorejectiondays,
				    t1.taxnomand,
				    t1.putcallrequired,
				    t1.grcadvintersetreq,
				    t1.grcadvtype,
				    t1.grcadvminterms,
				    t1.grcadvmaxterms,
				    t1.grcadvdefaultterms,
				    t1.advintersetreq,
				    t1.advtype,
				    t1.advminterms,
				    t1.advmaxterms,
				    t1.advdefaultterms,
				    t1.advstage,
				    t1.dsfreq,
				    t1.cashcollateralreq,
				    t1.tdsallowtomodify,
				    t1.tdsapplicableto,
				    t1.alwvan,
				    t1.vanallocationmethod,
				    t1.allowdrawingpower,
				    t1.allowrevolving,
				    t1.alwsanctionamt,
				    t1.alwsanctionamtoverride,
				    t1.sanbsdschdle,
				    t1.finisratervwatgrcend,
				    t1.schdonpmtcal,
				   t1.autoApprove
				   FROM rmtfinancetypes t1
				     LEFT JOIN bmtproduct t2 ON t1.fincategory::text = t2.productcode::text
				     LEFT JOIN rmtaccounttypes t4 ON t1.fincontingentactype::text = t4.actype::text
				     LEFT JOIN rmtaccounttypes t38 ON t1.finbankcontingentactype::text = t38.actype::text
				     LEFT JOIN rmtaccounttypes t39 ON t1.finprovisionactype::text = t39.actype::text
				     LEFT JOIN rmtaccounttypes t5 ON t1.finactype::text = t5.actype::text
				     LEFT JOIN rmtaccounttypes t31 ON t1.pftpayactype::text = t31.actype::text
				     LEFT JOIN smtdivisiondetail t48 ON t1.findivision::text = t48.divisioncode::text
				     LEFT JOIN rmtaccounttypes t49 ON t1.finsuspactype::text = t49.actype::text
				     LEFT JOIN rules t59 ON t1.downpayrule = t59.ruleid
				     LEFT JOIN rules t67 ON t1.grcpricingmethod = t67.ruleid
				     LEFT JOIN rules t68 ON t1.rpypricingmethod = t68.ruleid
				     LEFT JOIN profitcenters t69 ON t69.profitcenterid = t1.profitcenterid
	     </createView>
	</changeSet>

	<changeSet id="5.1" author="Shinde.b" dbms="postgresql">
		<sql>
			<![CDATA[
					select deps_save_and_drop_dependencies ('plf', 'lmtfinanceworkflowdef_aview');
			]]>
		</sql>
	</changeSet>


	<changeSet id="6" author="Shinde.b">
		<createView viewName="RMTFINANCETYPES_ORGVIEW" replaceIfExists="true">
			 SELECT t1.fintype,
			    t1.fincategory,
			    t1.fintypedesc,
			    t1.finccy,
			    t1.findayscaltype,
			    t1.finactype,
			    t1.fincontingentactype,
			    t1.finisgenref,
			    t1.finmaxamount,
			    t1.finminamount,
			    t1.finisopennewfinac,
			    t1.finisalwmd,
			    t1.finschdmthd,
			    t1.finisalwgrace,
			    t1.equalrepayment,
			    t1.finratetype,
			    t1.finbaserate,
			    t1.finsplrate,
			    t1.finintrate,
			    t1.finminrate,
			    t1.finmaxrate,
			    t1.findftintfrq,
			    t1.finisintcpz,
			    t1.fincpzfrq,
			    t1.finisrvwalw,
			    t1.finrvwfrq,
			    t1.fingrcratetype,
			    t1.fingrcbaserate,
			    t1.fingrcsplrate,
			    t1.fingrcintrate,
			    t1.fingrcminrate,
			    t1.fingrcmaxrate,
			    t1.fingrcdftintfrq,
			    t1.fingrcisintcpz,
			    t1.fingrccpzfrq,
			    t1.fingrcisrvwalw,
			    t1.fingrcrvwfrq,
			    t1.finminterm,
			    t1.finmaxterm,
			    t1.findftterms,
			    t1.finrpyfrq,
			    t1.finrepaymethod,
			    t1.finisalwdifferment,
			    t1.finmaxdifferment,
			    t1.finisactive,
			    t1.stepfinance,
			    t1.steppingmandatory,
			    t1.alwmanualsteps,
			    t1.alwdsteppolicies,
			    t1.dftsteppolicy,
			    t1.finisdwpayrequired,
			    t1.finrvwrateapplfor,
			    t1.finalwratechangeanydate,
			    t1.finisintcpzatgrcend,
			    t1.finschcalcodeonrvw,
			    t1.alwplandeferment,
			    t1.plandefercount,
			    t1.pftpayactype,
			    t1.finisopenpftpayacc,
			    t1.finisalwgrcrepay,
			    t1.fingrcschdmthd,
			    t1.fingrcmargin,
			    t1.finmargin,
			    t1.fincommitmentreq,
			    t1.fincollateralreq,
			    t1.findepreciationreq,
			    t1.findepreciationfrq,
			    t1.finbankcontingentactype,
			    t1.finprovisionactype,
			    t1.allowriainvestment,
			    t1.overridelimit,
			    t1.limitrequired,
			    t1.fincommitmentovrride,
			    t1.fincollateralovrride,
			    t1.finrepaypftonfrq,
			    t1.finpftunchanged,
			    t1.applyodpenalty,
			    t1.odincgrcdays,
			    t1.odchargetype,
			    t1.odgracedays,
			    t1.odchargecalon,
			    t1.odchargeamtorperc,
			    t1.odallowwaiver,
			    t1.odmaxwaiverperc,
			    t1.findivision,
			    t3.divisioncodedesc AS lovdescfindivisionname,
			    t1.finsuspactype,
			    t1.product,
			    t1.startdate,
			    t1.enddate,
			    t1.allowdownpaypgm,
			    t1.fintypedesc AS lovdescpromofintypedesc,
			    t1.remarks,
			    t4.policydesc AS lovdescdftsteppolicyname,
			    t1.pastduepftcalmthd,
			    t1.pastduepftmargin,
			    t1.alwadvancerent,
			    t1.grcadvbaserate,
			    t1.grcadvmargin,
			    t1.grcadvpftrate,
			    t1.rpyadvbaserate,
			    t1.rpyadvmargin,
			    t1.rpyadvpftrate,
			    t1.rolloverfinance,
			    t1.rolloverfrq,
			    t1.downpayrule,
			    t1.alwmultipartydisb,
			    t1.collateraltype,
			    t1.tdsapplicable,
			    t5.rulecode AS downpayrulecode,
			    t5.rulecodedesc AS downpayruledesc,
			    t1.applygrcpricing,
			    t1.applyrpypricing,
			    t6.rulecode AS grcpricingmethoddesc,
			    t7.rulecode AS rpypricingmethoddesc,
			    t1.droplineod,
			    t1.droppingmethod,
			    t1.ratechganyday,
			    t4.steptype AS dftsteppolicytype,
			    t1.manualschedule,
			    t1.alwbpi,
			    t1.bpitreatment,
			    t1.pftdueschon,
			    t1.planemihalw,
			    t1.planemihmethod,
			    t1.planemihmaxperyear,
			    t1.planemihmax,
			    t1.planemihlockperiod,
			    t1.planemicpz,
			    t1.unplanemihlockperiod,
			    t1.unplanemicpz,
			    t1.reagecpz,
			    t1.fddlockperiod,
			    t1.alwdrpymethods,
			    t1.maxunplannedemi,
			    t1.maxreageholidays,
			    t1.roundingmode,
			    t1.roundingtarget,
			    t1.frequencydays,
			    t1.quickdisb,
			    t1.alwreage,
			    t1.alwunplanemiholiday,
			    t1.alwmaxdisbcheckreq,
			    t1.productcategory,
			    t1.rpyhierarchy,
			    t1.developerfinance,
			    t3.entitycode AS lovdescentitycode,
			    t8.entitydesc AS lovdescentitydesc,
			    t1.costoffunds,
			    t1.chequecapturereq,
			    t1.finltvcheck,
			    t1.partiallysecured,
			    t1.alwadvemi,
			    t1.advemiminterms,
			    t1.advemimaxterms,
			    t1.advemidftterms,
			    t1.advemischdmthd,
			    t1.bpipftdaysbasis,
			    t1.eligibilitymethods,
			    t1.alwhybridrate,
			    t1.fixedratetenor,
			    t1.odmincapamount,
			    t1.odrulecode,
			    t1.alwzerointacc,
			    t1.finisalwpartialrpy,
			    t1.autorejectiondays,
			    t1.taxnomand,
			    t1.putcallrequired,
			    t1.grcadvintersetreq,
			    t1.grcadvtype,
			    t1.grcadvminterms,
			    t1.grcadvmaxterms,
			    t1.grcadvdefaultterms,
			    t1.advintersetreq,
			    t1.advtype,
			    t1.advminterms,
			    t1.advmaxterms,
			    t1.advdefaultterms,
			    t1.advstage,
			    t1.dsfreq,
			    t1.cashcollateralreq,
			    t1.alwearlypaymethods,
			    t1.tdsallowtomodify,
			    t1.tdsapplicableto,
			    t1.alwvan,
			    t1.vanallocationmethod,
			    t1.allowdrawingpower,
			    t1.allowrevolving,
			    t1.alwsanctionamt,
			    t1.alwsanctionamtoverride,
			    t1.sanbsdschdle,
			    t1.finisratervwatgrcend,
			    t1.schdonpmtcal,
				t1.autoApprove
			   FROM rmtfinancetypes t1
	     JOIN smtdivisiondetail t3 ON t1.findivision::text = t3.divisioncode::text
	     LEFT JOIN steppolicyheader t4 ON t1.dftsteppolicy::text = t4.policycode::text
	     LEFT JOIN rules t5 ON t1.downpayrule = t5.ruleid
	     LEFT JOIN rules t6 ON t1.grcpricingmethod = t6.ruleid
	     LEFT JOIN rules t7 ON t1.rpypricingmethod = t7.ruleid
	     LEFT JOIN entity t8 ON t3.entitycode::text = t8.entitycode::text
	</createView>
	</changeSet>

	<changeSet id="7" author="Shinde.b">
		<sql>
		    <![CDATA[
		        Insert into SMTPARAMETERS (SYSPARMCODE,SYSPARMDESC,SYSPARMTYPE,SYSPARMMAINT,SYSPARMVALUE,SYSPARMLENGTH,SYSPARMDEC,SYSPARMLIST,SYSPARMVALDMOD,SYSPARMDESCRIPTION,VERSION,LASTMNTBY,LASTMNTON,RECORDSTATUS,ROLECODE,NEXTROLECODE,TASKID,NEXTTASKID,RECORDTYPE,WORKFLOWID) values ('ALLOW_AUTOAPRROVE','Allow Auto Approve Fin','String',1,'N',3,0,null,null,'Allow Auto Approve Fin',1,1000,to_date('26-11-19','DD-MM-RR'),'Approved',null,null,null,null,null,0);
		     ]]>
		</sql>
	</changeSet>
	<changeSet id="8" author="keerthi.P">
		<addColumn tableName="Mandates">
			<column name="defaultmandate" type="boolean" />
		</addColumn>
	</changeSet>

	<changeSet id="9" author="keerthi.P">
		<addColumn tableName="Mandates_temp">
			<column name="defaultmandate" type="boolean" />
		</addColumn>
	</changeSet>

	<changeSet id="10" author="keerthi.P">
		<sql>
			<![CDATA[
				UPDATE Mandates Set defaultmandate = 0  where defaultmandate is null;
				UPDATE Mandates_temp Set defaultmandate = 0 where defaultmandate is null;
			]]>
		</sql>
	</changeSet>

	<changeSet id="11" author="keerthi.P" dbms="mssql">
		<sql>
			<![CDATA[	
				ALTER TABLE Mandates ADD CONSTRAINT DF_Mandates_DEFMND DEFAULT 0 FOR defaultmandate;
				ALTER TABLE Mandates_temp ADD CONSTRAINT DF_Mandates_temp_DEFMND DEFAULT 0 FOR defaultmandate;
			]]>
		</sql>
	</changeSet>

	<changeSet id="12" author="keerthi.P" dbms="postgresql, oracle">
		<addDefaultValue columnName="defaultmandate" tableName="Mandates" defaultValue="0" />
		<addDefaultValue columnName="defaultmandate" tableName="Mandates_temp" defaultValue="0" />
	</changeSet>

	<changeSet id="13" author="keerthi.P" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'mandates_view');
			]]>
		</sql>
	</changeSet>


	<changeSet id="14" author="keerthi.P">
		<createView replaceIfExists="true" viewName="Mandates_View">
            SELECT T1.MANDATEID,
		    T1.CUSTID,
		    T1.MANDATEREF,
		    T1.MANDATETYPE,
		    T1.BANKBRANCHID,
		    T1.ACCNUMBER,
		    T1.ACCHOLDERNAME,
		    T1.JOINTACCHOLDERNAME,
		    T1.ACCTYPE,
		    T1.OPENMANDATE,
		    T1.STARTDATE,
		    T1.EXPIRYDATE,
		    T1.MAXLIMIT,
		    T1.PERIODICITY,
		    T1.PHONECOUNTRYCODE,
		    T1.PHONEAREACODE,
		    T1.PHONENUMBER,
		    T1.STATUS,
		    T1.APPROVALID,
		    T1.VERSION,
		    T1.LASTMNTBY,
		    T1.LASTMNTON,
		    T1.RECORDSTATUS,
		    T1.ROLECODE,
		    T1.NEXTROLECODE,
		    T1.TASKID,
		    T1.NEXTTASKID,
		    T1.RECORDTYPE,
		    T1.WORKFLOWID,
		    T1.REASON,
		    T1.MANDATECCY,
		    T2.CUSTCIF,
		    T2.CUSTSHRTNAME,
		    T3.BANKCODE,
		    T3.BRANCHCODE,
		    T3.BRANCHDESC,
		    T3.MICR,
		    T3.IFSC,
		    T3.CITY,
		    T4.BANKNAME,
		    T1.INPUTDATE,
		    T1.ACTIVE,
			T1.DEFAULTMANDATE,
		    0 AS USEEXISTING,
		    T1.ORGREFERENCE,
		    T5.PCCITYNAME,
		    T1.DOCUMENTNAME,
		    T1.DOCUMENTREF,
		    T1.EXTERNALREF,
		    T1.ENTITYCODE,
		    T6.ENTITYDESC,
		    T1.PRIMARYMANDATEID,
		    T1.SWAPISACTIVE,
		    T1.BARCODENUMBER,
			T7.PARTNERBANKCODE,
			T7.PARTNERBANKNAME,
			T1.PARTNERBANKID
		FROM MANDATES_TEMP T1
		     JOIN CUSTOMERS T2 ON T1.CUSTID = T2.CUSTID
		     LEFT JOIN BANKBRANCHES T3 ON T1.BANKBRANCHID = T3.BANKBRANCHID
		     LEFT JOIN BMTBANKDETAIL T4 ON T3.BANKCODE = T4.BANKCODE
		     LEFT JOIN RMTPROVINCEVSCITY T5 ON T3.CITY = T5.PCCITY
		     LEFT JOIN ENTITY T6 ON T1.ENTITYCODE = T6.ENTITYCODE
			 LEFT JOIN PARTNERBANKS T7 ON T1.PARTNERBANKID = T7.PARTNERBANKID
		UNION ALL
		SELECT T1.MANDATEID,
		    T1.CUSTID,
		    T1.MANDATEREF,
		    T1.MANDATETYPE,
		    T1.BANKBRANCHID,
		    T1.ACCNUMBER,
		    T1.ACCHOLDERNAME,
		    T1.JOINTACCHOLDERNAME,
		    T1.ACCTYPE,
		    T1.OPENMANDATE,
		    T1.STARTDATE,
		    T1.EXPIRYDATE,
		    T1.MAXLIMIT,
		    T1.PERIODICITY,
		    T1.PHONECOUNTRYCODE,
		    T1.PHONEAREACODE,
		    T1.PHONENUMBER,
		    T1.STATUS,
		    T1.APPROVALID,
		    T1.VERSION,
		    T1.LASTMNTBY,
		    T1.LASTMNTON,
		    T1.RECORDSTATUS,
		    T1.ROLECODE,
		    T1.NEXTROLECODE,
		    T1.TASKID,
		    T1.NEXTTASKID,
		    T1.RECORDTYPE,
		    T1.WORKFLOWID,
		    T1.REASON,
		    T1.MANDATECCY,
		    T2.CUSTCIF,
		    T2.CUSTSHRTNAME,
		    T3.BANKCODE,
		    T3.BRANCHCODE,
		    T3.BRANCHDESC,
		    T3.MICR,
		    T3.IFSC,
		    T3.CITY,
		    T4.BANKNAME,
		    T1.INPUTDATE,
		    T1.ACTIVE,
			T1.DEFAULTMANDATE,
		    1 AS USEEXISTING,
		    T1.ORGREFERENCE,
		    T5.PCCITYNAME,
		    T1.DOCUMENTNAME,
		    T1.DOCUMENTREF,
		    T1.EXTERNALREF,
		    T1.ENTITYCODE,
		    T6.ENTITYDESC,
		    T1.PRIMARYMANDATEID,
		    T1.SWAPISACTIVE,
		    T1.BARCODENUMBER,
			T7.PARTNERBANKCODE,
			T7.PARTNERBANKNAME,
			T1.PARTNERBANKID
			FROM MANDATES T1
		    JOIN CUSTOMERS T2 ON T1.CUSTID = T2.CUSTID
		    LEFT JOIN BANKBRANCHES T3 ON T1.BANKBRANCHID = T3.BANKBRANCHID
		    LEFT JOIN BMTBANKDETAIL T4 ON T3.BANKCODE = T4.BANKCODE
		    LEFT JOIN RMTPROVINCEVSCITY T5 ON T3.CITY = T5.PCCITY
		    LEFT JOIN ENTITY T6 ON T1.ENTITYCODE = T6.ENTITYCODE
			LEFT JOIN PARTNERBANKS T7 ON T1.PARTNERBANKID = T7.PARTNERBANKID
			WHERE NOT (EXISTS ( SELECT 1 FROM MANDATES_TEMP
		    WHERE MANDATES_TEMP.MANDATEID = T1.MANDATEID))
		</createView>
	</changeSet>

	<changeSet id="15" author="keerthi.P" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'mandates_view');
			]]>
		</sql>
	</changeSet>

	<changeSet id="16" author="keerthi.P" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'mandates_tview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="17" author="keerthi.P">
		<createView replaceIfExists="true" viewName="MANDATES_TVIEW">
           SELECT T1.MANDATEID,
		    T1.CUSTID,
		    T1.MANDATEREF,
		    T1.MANDATETYPE,
		    T1.BANKBRANCHID,
		    T1.ACCNUMBER,
		    T1.ACCHOLDERNAME,
		    T1.JOINTACCHOLDERNAME,
		    T1.ACCTYPE,
		    T1.OPENMANDATE,
		    T1.STARTDATE,
		    T1.EXPIRYDATE,
		    T1.MAXLIMIT,
		    T1.PERIODICITY,
		    T1.PHONECOUNTRYCODE,
		    T1.PHONEAREACODE,
		    T1.PHONENUMBER,
		    T1.STATUS,
		    T1.APPROVALID,
		    T1.VERSION,
		    T1.LASTMNTBY,
		    T1.LASTMNTON,
		    T1.RECORDSTATUS,
		    T1.ROLECODE,
		    T1.NEXTROLECODE,
		    T1.TASKID,
		    T1.NEXTTASKID,
		    T1.RECORDTYPE,
		    T1.WORKFLOWID,
		    T1.REASON,
		    T1.MANDATECCY,
		    T2.CUSTCIF,
		    T2.CUSTSHRTNAME,
		    T3.BANKCODE,
		    T3.BRANCHCODE,
		    T3.BRANCHDESC,
		    T3.MICR,
		    T3.IFSC,
		    T3.CITY,
		    T4.BANKNAME,
		    T1.INPUTDATE,
		    T1.ACTIVE,
			T1.DEFAULTMANDATE,
		    0 AS USEEXISTING,
		    T1.ORGREFERENCE,
		    T5.PCCITYNAME,
		    T1.DOCUMENTNAME,
		    T1.DOCUMENTREF,
		    T1.EXTERNALREF,
		    T1.ENTITYCODE,
		    T6.ENTITYDESC,
		    T1.PRIMARYMANDATEID,
		    T1.SWAPISACTIVE,
		    T1.BARCODENUMBER,
			T7.PARTNERBANKCODE,
			T7.PARTNERBANKNAME,
			T1.PARTNERBANKID
			FROM MANDATES_TEMP T1
			JOIN CUSTOMERS T2 ON T1.CUSTID = T2.CUSTID
			LEFT JOIN BANKBRANCHES T3 ON T1.BANKBRANCHID = T3.BANKBRANCHID
		    LEFT JOIN BMTBANKDETAIL T4 ON T3.BANKCODE = T4.BANKCODE
			LEFT JOIN RMTPROVINCEVSCITY T5 ON T3.CITY = T5.PCCITY
			LEFT JOIN ENTITY T6 ON T1.ENTITYCODE = T6.ENTITYCODE
			LEFT JOIN PARTNERBANKS T7 ON T1.PARTNERBANKID = T7.PARTNERBANKID
		</createView>
	</changeSet>

	<changeSet id="18" author="keerthi.P" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'mandates_tview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="19" author="keerthi.P" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_save_and_drop_dependencies ('plf', 'mandates_aview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="20" author="keerthi.P">
		<createView replaceIfExists="true" viewName="MANDATES_AVIEW">
	        SELECT T1.MANDATEID,
	        T1.CUSTID,
	        T1.MANDATEREF,
	        T1.MANDATETYPE,
	        T1.BANKBRANCHID,
	        T1.ACCNUMBER,
	        T1.ACCHOLDERNAME,
	        T1.JOINTACCHOLDERNAME,
	        T1.ACCTYPE,
	        T1.OPENMANDATE,
	        T1.STARTDATE,
	        T1.EXPIRYDATE,
	        T1.MAXLIMIT,
	        T1.PERIODICITY,
	        T1.PHONECOUNTRYCODE,
	        T1.PHONEAREACODE,
	        T1.PHONENUMBER,
	        T1.STATUS,
	        T1.APPROVALID,
	        T1.VERSION,
	        T1.LASTMNTBY,
	        T1.LASTMNTON,
	        T1.RECORDSTATUS,
	        T1.ROLECODE,
	        T1.NEXTROLECODE,
	        T1.TASKID,
	        T1.NEXTTASKID,
	        T1.RECORDTYPE,
	        T1.WORKFLOWID,
	        T1.REASON,
	        T1.MANDATECCY,
	        T2.CUSTCIF,
	        T2.CUSTSHRTNAME,
	        T3.BANKCODE,
	        T3.BRANCHCODE,
	        T3.BRANCHDESC,
	        T3.MICR,
	        T3.IFSC,
	        T3.CITY,
	        T4.BANKNAME,
	        T1.INPUTDATE,
	        T1.INPUTDATE AS FROMDATE,
	        T1.INPUTDATE AS TODATE,
	        T1.ACTIVE,
			T1.DEFAULTMANDATE,
	        1 AS USEEXISTING,
	        T1.ORGREFERENCE,
	        T5.PCCITYNAME,
	        T1.DOCUMENTNAME,
	        T1.DOCUMENTREF,
	        T1.EXTERNALREF,
	        T1.ENTITYCODE,
	        T6.ENTITYDESC,
	        T1.PRIMARYMANDATEID,
	        T1.SWAPISACTIVE,
	        T1.BARCODENUMBER,
	        T7.PARTNERBANKCODE,
	        T7.PARTNERBANKNAME,
	        T1.PARTNERBANKID
	        FROM MANDATES T1
	        JOIN CUSTOMERS T2 ON T1.CUSTID = T2.CUSTID
	        LEFT JOIN BANKBRANCHES T3 ON T1.BANKBRANCHID = T3.BANKBRANCHID
	        LEFT JOIN BMTBANKDETAIL T4 ON T3.BANKCODE = T4.BANKCODE
	        LEFT JOIN RMTPROVINCEVSCITY T5 ON T3.CITY = T5.PCCITY
	        LEFT JOIN ENTITY T6 ON T1.ENTITYCODE = T6.ENTITYCODE
	        LEFT JOIN PARTNERBANKS T7 ON T1.PARTNERBANKID = T7.PARTNERBANKID
		</createView>
	</changeSet>

	<changeSet id="21" author="keerthi.P" dbms="postgresql">
		<sql>
			<![CDATA[
				select deps_restore_dependencies ('plf', 'mandates_aview');
			]]>
		</sql>
	</changeSet>

	<changeSet id="22" author="keerthi.P">
		<sql>
			<![CDATA[
			    Update SeqSecRights set SeqNo = (Select max(RightId) from SecRights);
			    UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS);
			    
			    INSERT INTO SecRights Values ((select max(RightId)+1 from SecRights),3,'MandateDialog_DefaultMandate','MandateDialog',0,1000,current_timestamp,'Approved','',' ',' ',' ',' ',0);
				INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='MANDATE_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='MandateDialog_DefaultMandate'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
				INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CL_ORIGINATION_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='MandateDialog_DefaultMandate'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
				INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='CL_ORIGINATION_WRM') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='MandateDialog_DefaultMandate'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
				INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='BFSD_ORIGINATION_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='MandateDialog_DefaultMandate'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
				INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='MANDATES_MAKER') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='MandateDialog_DefaultMandate'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
				
			]]>
		</sql>
	</changeSet>

	<changeSet id="23" author="keerthi.P">
		<sql>
			<![CDATA[
				INSERT INTO SMTparameters VALUES('ALLOW_DEFAULT_MANDATE_REQ','Default Mandate required or not','String',1,'N',1,0,null,null,'Default Mandate required or not',1,1000,current_timestamp,'Approved',null,null,null,null,null,0);
			]]>
		</sql>
	</changeSet>
</databaseChangeLog>

