<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />

	<changeSet id="pre_run_for_pgp" author="Jayant" runAlways="true"
		dbms="postgresql">
		<sql>
			Set search_path = plf,public,pg_catalog;
		</sql>
	</changeSet>
	<changeSet id="1.0" author="murthy.y">
		<createSequence sequenceName="SeqOrganizations"
			startValue="1" maxValue="9223372036854775807" incrementBy="1" />
	</changeSet>
	<changeSet id="2" author="murthy.y">
		<createTable tableName="organizations">
			<column name="Id" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="Type" type="int" remarks="SCHOOL-1, COLLLAGE-2">
				<constraints nullable="false" />
			</column>
			<column name="CustId" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="Code" type="varchar(20)">
				<constraints nullable="false" />
			</column>
			<column name="Name" type="Varchar(150)">
				<constraints nullable="false" />
			</column>
			<column name="Date_Incorporation" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="CreatedBy" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="CreatedOn" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="Version" type="int">
				<constraints nullable="false" />
			</column>
			<column name="LastMntBy" type="bigint" />
			<column name="LastMntOn" type="datetime" />
			<column name="RecordStatus" type="varchar(50)" />
			<column name="RoleCode" type="varchar(100)" />
			<column name="NextRoleCode" type="varchar(200)" />
			<column name="TaskId" type="varchar(50)" />
			<column name="NextTaskId" type="varchar(200)" />
			<column name="RecordType" type="varchar(50)" />
			<column name="WorkflowId" type="bigint" />
		</createTable>
	</changeSet>
	<changeSet id="2.1" author="murthy.y">
		<createTable tableName="organizations_temp">
			<column name="Id" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="Type" type="int" remarks="SCHOOL-1, COLLLAGE-2">
				<constraints nullable="false" />
			</column>
			<column name="CustId" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="Code" type="varchar(20)">
				<constraints nullable="false" />
			</column>
			<column name="Name" type="Varchar(150)">
				<constraints nullable="false" />
			</column>
			<column name="Date_Incorporation" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="CreatedBy" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="CreatedOn" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="Version" type="int">
				<constraints nullable="false" />
			</column>
			<column name="LastMntBy" type="bigint" />
			<column name="LastMntOn" type="datetime" />
			<column name="RecordStatus" type="varchar(50)" />
			<column name="RoleCode" type="varchar(100)" />
			<column name="NextRoleCode" type="varchar(200)" />
			<column name="TaskId" type="varchar(50)" />
			<column name="NextTaskId" type="varchar(200)" />
			<column name="RecordType" type="varchar(50)" />
			<column name="WorkflowId" type="bigint" />
		</createTable>
	</changeSet>
	<changeSet id="2.2" author="murthy.y">
		<addPrimaryKey tableName="organizations" columnNames="id"
			constraintName="pk_organizations_id" />
		<addPrimaryKey tableName="organizations_temp"
			columnNames="id" constraintName="pk_organization_temp_id" />
		<addForeignKeyConstraint constraintName="fk_organizations_custId"
			referencedTableName="customers" referencedColumnNames="CustId"
			baseTableName="organizations" baseColumnNames="CustId" />
		<addForeignKeyConstraint constraintName="fk_organization_temp_custId"
			referencedTableName="customers" referencedColumnNames="CustId"
			baseTableName="organizations_temp" baseColumnNames="CustId" />
	</changeSet>
	<changeSet id="3.0" author="murthy.y" dbms="postgresql">
		<createView viewName="organizations_view" replaceIfExists="true">
			select 
				o.id,
				o.type,
				o.custId,
				o.code,
				o.name,
				o.date_incorporation,
				o.createdby,
				o.createdon,
				o.version,
				o.lastmntby,
				o.lastmnton,
				o.recordstatus,
				o.rolecode,
				o.nextrolecode,
				o.taskid,
				o.nexttaskid,
				o.recordtype,
				o.workflowid,
			    c.custcif as cif,
			    c.custshrtname
		    from organizations_temp o
		    	inner join customers c on c.custid = o.custid
			union all
			select 
				o.id,
				o.type,
				o.custId,
				o.code,
				o.name,
				o.date_incorporation,
				o.createdby,
				o.createdon,
				o.version,
				o.lastmntby,
				o.lastmnton,
				o.recordstatus,
				o.rolecode,
				o.nextrolecode,
				o.taskid,
				o.nexttaskid,
				o.recordtype,
				o.workflowid,
			    c.custcif as cif,
			    c.custshrtname
		    from organizations o
		     inner join customers c on c.custid = o.custid
			 where not exists ( select 1 from organizations_temp where id = o.id);
		</createView>
		<createView viewName="organizations_aview" replaceIfExists="true">
			select 
				o.id,
				o.type,
				o.custId,
				o.code,
				o.name,
				o.date_incorporation,
				o.createdby,
				o.createdon,
				o.version,
				o.lastmntby,
				o.lastmnton,
				o.recordstatus,
				o.rolecode,
				o.nextrolecode,
				o.taskid,
				o.nexttaskid,
				o.recordtype,
				o.workflowid,
			    c.custcif as cif,
			    c.custshrtname
		    from organizations o
		    	inner join customers c on c.custid = o.custid;
		</createView>
	</changeSet>
	<changeSet id="4.0_Pre" author="Jayant">
		<comment> delete script for child tables of Secroles</comment>
		<sql>
			delete from secoperationroles where roleid in (select roleid from secroles where rolecd ='ORGANIZATION_SCHOOL_MAKER');
			delete from secoperationroles where roleid in (select roleid from secroles where rolecd ='ORGANIZATION_SCHOOL_APPROVER');
		</sql>
	</changeSet>
	<changeSet id="4.0" author="murthy.y">
		<sql>
			<![CDATA[
				delete from Secroles Where Rolecd = 'ORGANIZATION_SCHOOL_MAKER';
				delete from Secroles Where Rolecd = 'ORGANIZATION_SCHOOL_APPROVER';
			
				Update SeqSecRoles set seqno = (Select Max(roleid) from Secroles_view);
			
				INSERT INTO SecRoles SELECT (select seqno+1 from SeqSecRoles), 1, 'ORGANIZATION_SCHOOL_MAKER', 'Maker Role for School Funding', null, 0, 1000, CURRENT_TIMESTAMP, 'Approved', null, null, null, null, null, 0 FROM SeqSecRoleGroups WHERE 0=0;
				INSERT INTO SecRoles SELECT (select seqno+2 from SeqSecRoles), 1, 'ORGANIZATION_SCHOOL_APPROVER', 'Approver Role for School Funding', null, 0, 1000, CURRENT_TIMESTAMP, 'Approved', null, null, null, null, null, 0 FROM SeqSecRoleGroups WHERE 0=0;
			]]>
		</sql>
	</changeSet>
	<changeSet id="4.1" author="murthy.y">
		<sql>
			<![CDATA[
				update workflowdetails set WorkFlowActive='0' where WorkFlowType='ORGANIZATION_SCHOOL';
			]]>
		</sql>
		<insert tableName="WorkFlowDetails">
			<column name="WorkFlowId" valueComputed="(select max(Seqno) + 1 from SeqWorkFlowDetails)" />
			<column name="WorkFlowType">ORGANIZATION_SCHOOL</column>
			<column name="WorkFlowSubType">ORGANIZATION_SCHOOL</column>
			<column name="WorkFlowDesc">School Funding Master Workflow</column>
			<column name="JsonDesign" type="nclob"><![CDATA[NULL]]></column>
			<column name="SvgDesign" type="nclob"><![CDATA[NULL]]></column>
			<column name="WorkFlowXml" type="clob"><![CDATA[NULL]]></column>
			<column name="WorkFlowRoles">ORGANIZATION_SCHOOL_MAKER;ORGANIZATION_SCHOOL_APPROVER
			</column>
			<column name="FirstTaskOwner">ORGANIZATION_SCHOOL_MAKER</column>
			<column name="WorkFlowActive">1</column>
			<column name="Version">0</column>
			<column name="LastMntBy">1000</column>
			<column name="LastMntOn" valueDate="current_timestamp" />
			<column name="RecordStatus">Null</column>
			<column name="RoleCode"></column>
			<column name="NextRoleCode"></column>
			<column name="TaskId"></column>
			<column name="NextTaskId"></column>
			<column name="RecordType">NULL</column>
		</insert>
	</changeSet>
	<changeSet id="4.2" author="murthy.y">
		<update tableName="WORKFLOWDETAILS">
			<column name="JSONDESIGN" type="NCLOB"><![CDATA[{"resourceId":"canvas","properties":{"process_id":"ORGANIZATION_SCHOOL","name":"School funding workflow","documentation":"Maker/Checker workflow for school funding","category":"","listenerclass":"","listenerentitytype":""},"stencil":{"id":"BPMNDiagram"},"childShapes":[{"resourceId":"startEvent1","properties":{"overrideid":"","name":"Start"},"stencil":{"id":"StartNoneEvent"},"childShapes":[],"outgoing":[{"resourceId":"sid-62671BC5-8E41-498B-BDD5-D58682E07058"}],"bounds":{"lowerRight":{"x":130,"y":193},"upperLeft":{"x":100,"y":163}},"dockers":[]},{"resourceId":"sid-C582990C-FA38-42A5-8480-AB3D0980398E","properties":{"overrideid":"","name":"Maker","usertaskassignment":{"assignment":{"type":"idm","idm":{"type":"user","assignee":{"email":"ORGANIZATION_SCHOOL_MAKER","firstName":"ORGANIZATION_SCHOOL_MAKER","fullName":"ORGANIZATION_SCHOOL_MAKER","id":"ORGANIZATION_SCHOOL_MAKER","roledesc":"Role For Organization School Maker","$$hashKey":"object:3218"}}}},"additionalforms":"","formkeydefinition":"","prioritydefinition":"Role Queue","baseactor":"","duedatedefinition":"","multiinstance_type":"None","isforcompensation":"false"},"stencil":{"id":"UserTask"},"childShapes":[],"outgoing":[{"resourceId":"sid-90E3D507-992C-4A25-A122-20874033A554"},{"resourceId":"sid-EE9D254D-F645-41D4-8865-C830A628B08E"}],"bounds":{"lowerRight":{"x":310,"y":218},"upperLeft":{"x":210,"y":138}},"dockers":[]},{"resourceId":"sid-62671BC5-8E41-498B-BDD5-D58682E07058","properties":{"overrideid":"","name":"","repruseaction":"false","conditionsequenceflow":"","defaultflow":"false","action":"","state":"","mandatenotes":"false","capturereasons":"false","typeofreason":""},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-C582990C-FA38-42A5-8480-AB3D0980398E"}],"bounds":{"lowerRight":{"x":209.15625,"y":178},"upperLeft":{"x":130.7265625,"y":178}},"dockers":[{"x":15,"y":15},{"x":50,"y":40}],"target":{"resourceId":"sid-C582990C-FA38-42A5-8480-AB3D0980398E"}},{"resourceId":"sid-4A26CD84-66D9-485B-BA98-7270E41ED6B0","properties":{"overrideid":"","name":"Approver","usertaskassignment":{"assignment":{"type":"idm","idm":{"type":"user","assignee":{"email":"ORGANIZATION_SCHOOL_APPROVER","firstName":"ORGANIZATION_SCHOOL_APPROVER","fullName":"ORGANIZATION_SCHOOL_APPROVER","id":"ORGANIZATION_SCHOOL_APPROVER","roledesc":"Role For Organization School Approver","$$hashKey":"object:2140"}}}},"additionalforms":"","formkeydefinition":"","prioritydefinition":"Role Queue","baseactor":"","duedatedefinition":"","multiinstance_type":"None","isforcompensation":"false"},"stencil":{"id":"UserTask"},"childShapes":[],"outgoing":[{"resourceId":"sid-4FDEDA31-BB0D-4C1F-ACCD-48C5AD945F85"}],"bounds":{"lowerRight":{"x":490,"y":218},"upperLeft":{"x":390,"y":138}},"dockers":[]},{"resourceId":"sid-0F430ABA-CD3A-409F-A1BB-2228AD27422E","properties":{"overrideid":"","name":"","sequencefloworder":""},"stencil":{"id":"ExclusiveGateway"},"childShapes":[],"outgoing":[{"resourceId":"sid-F89EE913-9556-4C3B-9097-CF2B85083C47"},{"resourceId":"sid-03C378B5-552E-4F74-ADD6-874DA2D03D66"},{"resourceId":"sid-F8129FFE-C307-4BF8-BB40-494025C41851"}],"bounds":{"lowerRight":{"x":595,"y":198},"upperLeft":{"x":555,"y":158}},"dockers":[]},{"resourceId":"sid-2B32A3FE-8550-4C6F-9205-49B1CF1C364F","properties":{"overrideid":"","name":"Complete Process","rerunnable":true,"servicetaskexpression":"doApprove","isforcompensation":"false","multiinstance_type":"None","prioritydefinition":"Role Queue","type":"http://b3mn.org/stencilset/bpmn2.0#UserTask","usertaskassignment":"","additionalforms":"","formkeydefinition":"","duedatedefinition":"","baseactor":""},"stencil":{"id":"approveTask"},"childShapes":[],"outgoing":[{"resourceId":"sid-56B6BBDD-7E3D-407D-8666-26E97743A850"}],"bounds":{"lowerRight":{"x":760,"y":218},"upperLeft":{"x":660,"y":138}},"dockers":[]},{"resourceId":"sid-A1094339-06E1-4C79-A701-1CD451268C5C","properties":{"overrideid":"","name":"Cancel Process","rerunnable":true,"servicetaskexpression":"doReject","isforcompensation":"false","multiinstance_type":"None","prioritydefinition":"Role Queue","type":"http://b3mn.org/stencilset/bpmn2.0#UserTask","usertaskassignment":"","additionalforms":"","formkeydefinition":"","duedatedefinition":"","baseactor":""},"stencil":{"id":"rejectTask"},"childShapes":[],"outgoing":[{"resourceId":"sid-6BA8261C-34B3-4C69-BA31-163D52465132"}],"bounds":{"lowerRight":{"x":625,"y":380},"upperLeft":{"x":525,"y":300}},"dockers":[]},{"resourceId":"sid-52D8B9BD-DEB9-49D6-BA3B-496EED33F57C","properties":{"overrideid":"","name":"Approved"},"stencil":{"id":"EndNoneEvent"},"childShapes":[],"outgoing":[],"bounds":{"lowerRight":{"x":853,"y":192},"upperLeft":{"x":825,"y":164}},"dockers":[]},{"resourceId":"sid-56B6BBDD-7E3D-407D-8666-26E97743A850","properties":{"overrideid":"","name":"","repruseaction":"false","conditionsequenceflow":"","defaultflow":"false","action":"","state":"","mandatenotes":"false","capturereasons":"false","typeofreason":""},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-52D8B9BD-DEB9-49D6-BA3B-496EED33F57C"}],"bounds":{"lowerRight":{"x":824.8984375,"y":178},"upperLeft":{"x":760.3828125,"y":178}},"dockers":[{"x":50,"y":40},{"x":14,"y":14}],"target":{"resourceId":"sid-52D8B9BD-DEB9-49D6-BA3B-496EED33F57C"}},{"resourceId":"sid-E49D16E7-99DD-4BD3-B3B2-0EEF77161046","properties":{"overrideid":"","name":"Cancelled"},"stencil":{"id":"EndNoneEvent"},"childShapes":[],"outgoing":[],"bounds":{"lowerRight":{"x":698,"y":354},"upperLeft":{"x":670,"y":326}},"dockers":[]},{"resourceId":"sid-6BA8261C-34B3-4C69-BA31-163D52465132","properties":{"overrideid":"","name":"","repruseaction":"false","conditionsequenceflow":"","defaultflow":"false","action":"","state":"","mandatenotes":"false","capturereasons":"false","typeofreason":""},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-E49D16E7-99DD-4BD3-B3B2-0EEF77161046"}],"bounds":{"lowerRight":{"x":669.375,"y":340},"upperLeft":{"x":625.390625,"y":340}},"dockers":[{"x":50,"y":40},{"x":14,"y":14}],"target":{"resourceId":"sid-E49D16E7-99DD-4BD3-B3B2-0EEF77161046"}},{"resourceId":"sid-4FDEDA31-BB0D-4C1F-ACCD-48C5AD945F85","properties":{"overrideid":"","name":"","repruseaction":"false","conditionsequenceflow":"","defaultflow":"false","action":"","state":"","mandatenotes":"false","capturereasons":"false","typeofreason":""},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-0F430ABA-CD3A-409F-A1BB-2228AD27422E"}],"bounds":{"lowerRight":{"x":555.015625,"y":178},"upperLeft":{"x":490.5703125,"y":178}},"dockers":[{"x":50,"y":40},{"x":20,"y":20}],"target":{"resourceId":"sid-0F430ABA-CD3A-409F-A1BB-2228AD27422E"}},{"resourceId":"sid-EE9D254D-F645-41D4-8865-C830A628B08E","properties":{"overrideid":"","name":"Submit","repruseaction":true,"conditionsequenceflow":{"expression":{"type":"static","staticValue":"vo.recordStatus == 'Submitted'"}},"defaultflow":"false","action":"Submit","state":"Submitted","mandatenotes":"false","capturereasons":"false","typeofreason":"","showdiamondmarker":false},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-4A26CD84-66D9-485B-BA98-7270E41ED6B0"}],"bounds":{"lowerRight":{"x":389.52959701805423,"y":178.5},"upperLeft":{"x":310.6978238359261,"y":178.5}},"dockers":[{"x":72.75389944188339,"y":40.5},{"x":20.488059532159923,"y":40.5}],"target":{"resourceId":"sid-4A26CD84-66D9-485B-BA98-7270E41ED6B0"}},{"resourceId":"sid-90E3D507-992C-4A25-A122-20874033A554","properties":{"overrideid":"","name":"Cancel","repruseaction":true,"conditionsequenceflow":{"expression":{"type":"static","staticValue":"vo.recordStatus == 'Cancelled'"}},"defaultflow":"false","action":"Cancel","state":"Cancelled","mandatenotes":true,"capturereasons":"false","typeofreason":""},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-A1094339-06E1-4C79-A701-1CD451268C5C"}],"bounds":{"lowerRight":{"x":524.78125,"y":340},"upperLeft":{"x":260,"y":218.234375}},"dockers":[{"x":50,"y":40},{"x":260,"y":340},{"x":50,"y":40}],"target":{"resourceId":"sid-A1094339-06E1-4C79-A701-1CD451268C5C"}},{"resourceId":"sid-F89EE913-9556-4C3B-9097-CF2B85083C47","properties":{"overrideid":"","name":"Reject","repruseaction":true,"conditionsequenceflow":{"expression":{"type":"static","staticValue":"vo.recordStatus == 'Rejected'"}},"defaultflow":"false","action":"Reject","state":"Rejected","mandatenotes":true,"capturereasons":"false","typeofreason":""},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-A1094339-06E1-4C79-A701-1CD451268C5C"}],"bounds":{"lowerRight":{"x":575.4383102896053,"y":299.88672354249684},"upperLeft":{"x":575.1241897103947,"y":198.42577645750313}},"dockers":[{"x":20.5,"y":20.5},{"x":50,"y":40}],"target":{"resourceId":"sid-A1094339-06E1-4C79-A701-1CD451268C5C"}},{"resourceId":"sid-F8129FFE-C307-4BF8-BB40-494025C41851","properties":{"overrideid":"","name":"Resubmit","repruseaction":true,"conditionsequenceflow":{"expression":{"type":"static","staticValue":"vo.recordStatus == 'Resubmitted'"}},"defaultflow":"false","action":"Resubmit","state":"Resubmitted","mandatenotes":true,"capturereasons":"false","typeofreason":""},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-C582990C-FA38-42A5-8480-AB3D0980398E"}],"bounds":{"lowerRight":{"x":575.5,"y":157.90625},"upperLeft":{"x":260,"y":74}},"dockers":[{"x":20.5,"y":20.5},{"x":575.5,"y":74},{"x":260,"y":74},{"x":50,"y":40}],"target":{"resourceId":"sid-C582990C-FA38-42A5-8480-AB3D0980398E"}},{"resourceId":"sid-03C378B5-552E-4F74-ADD6-874DA2D03D66","properties":{"overrideid":"","name":"Approve","repruseaction":true,"conditionsequenceflow":{"expression":{"type":"static","staticValue":"vo.recordStatus == 'Approved'"}},"defaultflow":"false","action":"Approve","state":"Approved","mandatenotes":"false","capturereasons":"false","typeofreason":"","showdiamondmarker":false},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-2B32A3FE-8550-4C6F-9205-49B1CF1C364F"}],"bounds":{"lowerRight":{"x":659.6132881597279,"y":178.42597005356777},"upperLeft":{"x":595.4140555902721,"y":178.18731119643223}},"dockers":[{"x":20.5,"y":20.5},{"x":50,"y":40}],"target":{"resourceId":"sid-2B32A3FE-8550-4C6F-9205-49B1CF1C364F"}}],"bounds":{"lowerRight":{"x":1200,"y":1050},"upperLeft":{"x":0,"y":0}},"stencilset":{"url":"stencilsets/bpmn2.0/bpmn2.0.json","namespace":"http://b3mn.org/stencilset/bpmn2.0#"},"ssextensions":[]}]]></column>
			<column name="WORKFLOWXML" type="CLOB"><![CDATA[<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://activiti.org/test">   <process id="ORGANIZATION_SCHOOL" name="Organization School Workflow" isExecutable="true">     <documentation>Maker/Checker Workflow for Organization School</documentation>     <startEvent id="startEvent1" name="Start"/>     <userTask id="sid-C582990C-FA38-42A5-8480-AB3D0980398E" name="Maker" activiti:actor="ORGANIZATION_SCHOOL_MAKER" activiti:assignmentLevel="Role Queue"/>     <sequenceFlow id="sid-62671BC5-8E41-498B-BDD5-D58682E07058" sourceRef="startEvent1" targetRef="sid-C582990C-FA38-42A5-8480-AB3D0980398E" representsUserAction="false" mandateNotes="false" captureReasons="false"/>     <userTask id="sid-4A26CD84-66D9-485B-BA98-7270E41ED6B0" name="Approver" activiti:actor="ORGANIZATION_SCHOOL_APPROVER" activiti:assignmentLevel="Role Queue"/>     <exclusiveGateway id="sid-0F430ABA-CD3A-409F-A1BB-2228AD27422E"/>     <serviceTask id="sid-2B32A3FE-8550-4C6F-9205-49B1CF1C364F" name="Complete Process" activiti:operation="doApprove" activiti:rerunnable="true"/>     <serviceTask id="sid-A1094339-06E1-4C79-A701-1CD451268C5C" name="Cancel Process" activiti:operation="doReject" activiti:rerunnable="true"/>     <endEvent id="sid-52D8B9BD-DEB9-49D6-BA3B-496EED33F57C" name="Approved"/>     <sequenceFlow id="sid-56B6BBDD-7E3D-407D-8666-26E97743A850" sourceRef="sid-2B32A3FE-8550-4C6F-9205-49B1CF1C364F" targetRef="sid-52D8B9BD-DEB9-49D6-BA3B-496EED33F57C" representsUserAction="false" mandateNotes="false" captureReasons="false"/>     <endEvent id="sid-E49D16E7-99DD-4BD3-B3B2-0EEF77161046" name="Cancelled"/>     <sequenceFlow id="sid-6BA8261C-34B3-4C69-BA31-163D52465132" sourceRef="sid-A1094339-06E1-4C79-A701-1CD451268C5C" targetRef="sid-E49D16E7-99DD-4BD3-B3B2-0EEF77161046" representsUserAction="false" mandateNotes="false" captureReasons="false"/>     <sequenceFlow id="sid-4FDEDA31-BB0D-4C1F-ACCD-48C5AD945F85" sourceRef="sid-4A26CD84-66D9-485B-BA98-7270E41ED6B0" targetRef="sid-0F430ABA-CD3A-409F-A1BB-2228AD27422E" representsUserAction="false" mandateNotes="false" captureReasons="false"/>     <sequenceFlow id="sid-EE9D254D-F645-41D4-8865-C830A628B08E" name="Submit" sourceRef="sid-C582990C-FA38-42A5-8480-AB3D0980398E" targetRef="sid-4A26CD84-66D9-485B-BA98-7270E41ED6B0" action="Submit" state="Submitted" representsUserAction="true" mandateNotes="false" captureReasons="false"><conditionExpression xsi:type="tFormalExpression">vo.recordStatus == "Submitted"</conditionExpression>     </sequenceFlow>     <sequenceFlow id="sid-90E3D507-992C-4A25-A122-20874033A554" name="Cancel" sourceRef="sid-C582990C-FA38-42A5-8480-AB3D0980398E" targetRef="sid-A1094339-06E1-4C79-A701-1CD451268C5C" action="Cancel" state="Cancelled" representsUserAction="true" mandateNotes="true" captureReasons="false"><conditionExpression xsi:type="tFormalExpression">vo.recordStatus == "Cancelled"</conditionExpression>     </sequenceFlow>     <sequenceFlow id="sid-F89EE913-9556-4C3B-9097-CF2B85083C47" name="Reject" sourceRef="sid-0F430ABA-CD3A-409F-A1BB-2228AD27422E" targetRef="sid-A1094339-06E1-4C79-A701-1CD451268C5C" action="Reject" state="Rejected" representsUserAction="true" mandateNotes="true" captureReasons="false"><conditionExpression xsi:type="tFormalExpression">vo.recordStatus == "Rejected"</conditionExpression>     </sequenceFlow>     <sequenceFlow id="sid-F8129FFE-C307-4BF8-BB40-494025C41851" name="Resubmit" sourceRef="sid-0F430ABA-CD3A-409F-A1BB-2228AD27422E" targetRef="sid-C582990C-FA38-42A5-8480-AB3D0980398E" action="Resubmit" state="Resubmitted" representsUserAction="true" mandateNotes="true" captureReasons="false"><conditionExpression xsi:type="tFormalExpression">vo.recordStatus == "Resubmitted"</conditionExpression>     </sequenceFlow>     <sequenceFlow id="sid-03C378B5-552E-4F74-ADD6-874DA2D03D66" name="Approve" sourceRef="sid-0F430ABA-CD3A-409F-A1BB-2228AD27422E" targetRef="sid-2B32A3FE-8550-4C6F-9205-49B1CF1C364F" action="Approve" state="Approved" representsUserAction="true" mandateNotes="false" captureReasons="false"><conditionExpression xsi:type="tFormalExpression">vo.recordStatus == "Approved"</conditionExpression>     </sequenceFlow>   </process>   <bpmndi:BPMNDiagram id="BPMNDiagram_ORGANIZATION_SCHOOL">     <bpmndi:BPMNPlane bpmnElement="ORGANIZATION_SCHOOL" id="BPMNPlane_ORGANIZATION_SCHOOL"><bpmndi:BPMNShape bpmnElement="startEvent1" id="BPMNShape_startEvent1"><omgdc:Bounds height="30.0" width="30.0" x="100.0" y="163.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-C582990C-FA38-42A5-8480-AB3D0980398E" id="BPMNShape_sid-C582990C-FA38-42A5-8480-AB3D0980398E"><omgdc:Bounds height="80.0" width="100.0" x="210.0" y="138.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-4A26CD84-66D9-485B-BA98-7270E41ED6B0" id="BPMNShape_sid-4A26CD84-66D9-485B-BA98-7270E41ED6B0"><omgdc:Bounds height="80.0" width="100.0" x="390.0" y="138.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-0F430ABA-CD3A-409F-A1BB-2228AD27422E" id="BPMNShape_sid-0F430ABA-CD3A-409F-A1BB-2228AD27422E"><omgdc:Bounds height="40.0" width="40.0" x="555.0" y="158.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-2B32A3FE-8550-4C6F-9205-49B1CF1C364F" id="BPMNShape_sid-2B32A3FE-8550-4C6F-9205-49B1CF1C364F"><omgdc:Bounds height="80.0" width="100.0" x="660.0" y="138.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-A1094339-06E1-4C79-A701-1CD451268C5C" id="BPMNShape_sid-A1094339-06E1-4C79-A701-1CD451268C5C"><omgdc:Bounds height="80.0" width="100.0" x="525.0" y="300.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-52D8B9BD-DEB9-49D6-BA3B-496EED33F57C" id="BPMNShape_sid-52D8B9BD-DEB9-49D6-BA3B-496EED33F57C"><omgdc:Bounds height="28.0" width="28.0" x="825.0" y="164.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-E49D16E7-99DD-4BD3-B3B2-0EEF77161046" id="BPMNShape_sid-E49D16E7-99DD-4BD3-B3B2-0EEF77161046"><omgdc:Bounds height="28.0" width="28.0" x="670.0" y="326.0"/></bpmndi:BPMNShape><bpmndi:BPMNEdge bpmnElement="sid-EE9D254D-F645-41D4-8865-C830A628B08E" id="BPMNEdge_sid-EE9D254D-F645-41D4-8865-C830A628B08E"><omgdi:waypoint x="310.0" y="178.5"/><omgdi:waypoint x="390.0" y="178.5"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-90E3D507-992C-4A25-A122-20874033A554" id="BPMNEdge_sid-90E3D507-992C-4A25-A122-20874033A554"><omgdi:waypoint x="260.0" y="218.0"/><omgdi:waypoint x="260.0" y="340.0"/><omgdi:waypoint x="525.0" y="340.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-F8129FFE-C307-4BF8-BB40-494025C41851" id="BPMNEdge_sid-F8129FFE-C307-4BF8-BB40-494025C41851"><omgdi:waypoint x="575.5" y="158.5"/><omgdi:waypoint x="575.5" y="74.0"/><omgdi:waypoint x="260.0" y="74.0"/><omgdi:waypoint x="260.0" y="138.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-6BA8261C-34B3-4C69-BA31-163D52465132" id="BPMNEdge_sid-6BA8261C-34B3-4C69-BA31-163D52465132"><omgdi:waypoint x="625.0" y="340.0"/><omgdi:waypoint x="670.0" y="340.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-F89EE913-9556-4C3B-9097-CF2B85083C47" id="BPMNEdge_sid-F89EE913-9556-4C3B-9097-CF2B85083C47"><omgdi:waypoint x="575.4409937888199" y="197.55900621118013"/><omgdi:waypoint x="575.123839009288" y="300.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-56B6BBDD-7E3D-407D-8666-26E97743A850" id="BPMNEdge_sid-56B6BBDD-7E3D-407D-8666-26E97743A850"><omgdi:waypoint x="760.0" y="178.0"/><omgdi:waypoint x="825.0" y="178.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-03C378B5-552E-4F74-ADD6-874DA2D03D66" id="BPMNEdge_sid-03C378B5-552E-4F74-ADD6-874DA2D03D66"><omgdi:waypoint x="594.570895522388" y="178.42910447761193"/><omgdi:waypoint x="660.0" y="178.18587360594796"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-4FDEDA31-BB0D-4C1F-ACCD-48C5AD945F85" id="BPMNEdge_sid-4FDEDA31-BB0D-4C1F-ACCD-48C5AD945F85"><omgdi:waypoint x="490.0" y="178.0"/><omgdi:waypoint x="555.0" y="178.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-62671BC5-8E41-498B-BDD5-D58682E07058" id="BPMNEdge_sid-62671BC5-8E41-498B-BDD5-D58682E07058"><omgdi:waypoint x="130.0" y="178.0"/><omgdi:waypoint x="210.0" y="178.0"/></bpmndi:BPMNEdge>     </bpmndi:BPMNPlane>   </bpmndi:BPMNDiagram> </definitions>]]></column>
			<where>workflowtype='ORGANIZATION_SCHOOL' and workflowactive=1
			</where>
		</update>
	</changeSet>
	<changeSet id="4.3" author="murthy.y">
		<sql>
			<![CDATA[
				UPDATE SeqWorkFlowDetails SET SEQNO= (SELECT MAX(WorkflowId)+1 FROM workflowdetails);
			]]>
		</sql>
	</changeSet>
	<changeSet id="5.0_pre" author="murthy.y" dbms="postgresql">
		<sql>
			<![CDATA[
					select deps_save_and_drop_dependencies ('plf', 'bmtlovfieldcode');
					select deps_save_and_drop_dependencies ('plf', 'bmtlovfieldcode_temp');
			]]>
		</sql>
	</changeSet>
	<changeSet id="5.0" author="murthy.y">
		<modifyDataType tableName="BMTLovFieldcode" columnName="fieldcode" newDataType="varchar(50)" />
		<modifyDataType tableName="BMTLovFieldcode_temp" columnName="fieldcode" newDataType="varchar(50)" />
	</changeSet>
	<changeSet id="5.0_post" author="murthy.y" dbms="postgresql">
		<sql>
			<![CDATA[
					select deps_restore_dependencies ('plf', 'bmtlovfieldcode');
					select deps_restore_dependencies ('plf', 'bmtlovfieldcode_temp');
			]]>
		</sql>
	</changeSet>
	<changeSet id="5.1" author="murthy.y">
		<sql>
			<![CDATA[
				insert into BMTLovFieldCode values('ORG_SCHOOL_SERVICES','Product or Services for school funding', 'String', 1, 1, 1, 1000, current_timestamp, 'Approved', '', '', '', '', '', 0);
			]]>
		</sql>
	</changeSet>
	<changeSet id="5.2_pre" author="murthy.y" dbms="postgresql">
		<sql>
			<![CDATA[
					select deps_save_and_drop_dependencies ('plf', 'rmtlovfielddetail');
					select deps_save_and_drop_dependencies ('plf', 'rmtlovfielddetail_temp');
			]]>
		</sql>
	</changeSet>
	<changeSet id="5.2" author="murthy.y">
		<modifyDataType tableName="rmtlovfielddetail" columnName="fieldcode" newDataType="varchar(50)" />
		<modifyDataType tableName="rmtlovfielddetail_temp" columnName="fieldcode" newDataType="varchar(50)" />
	</changeSet>
	<changeSet id="5.2_post" author="murthy.y" dbms="postgresql">
		<sql>
			<![CDATA[
					select deps_restore_dependencies ('plf', 'rmtlovfielddetail');
					select deps_restore_dependencies ('plf', 'rmtlovfielddetail_temp');
			]]>
		</sql>
	</changeSet>
	<changeSet id="5.3_pre" author="murthy.y" dbms="postgresql">
		<sql>
			<![CDATA[
					select deps_save_and_drop_dependencies ('plf', 'rmtlovfielddetail');
					select deps_save_and_drop_dependencies ('plf', 'rmtlovfielddetail_temp');
					select deps_save_and_drop_dependencies ('plf', 'bmtlovfieldcode');
					select deps_save_and_drop_dependencies ('plf', 'bmtlovfieldcode_temp');
			]]>
		</sql>
	</changeSet>
	<changeSet id="5.3" author="murthy.y" dbms="postgresql">
		<modifyDataType tableName="rmtlovfielddetail" columnName="fieldcode" newDataType="citext" />
		<modifyDataType tableName="rmtlovfielddetail_temp" columnName="fieldcode" newDataType="citext" />
		<modifyDataType tableName="bmtlovfieldcode" columnName="fieldcode" newDataType="citext" />
		<modifyDataType tableName="bmtlovfieldcode" columnName="fieldcode" newDataType="citext" />
	</changeSet>
	<changeSet id="5.3_post" author="murthy.y" dbms="postgresql">
		<sql>
			<![CDATA[
					select deps_restore_dependencies ('plf', 'rmtlovfielddetail');
					select deps_restore_dependencies ('plf', 'rmtlovfielddetail_temp');
					select deps_restore_dependencies ('plf', 'bmtlovfieldcode');
					select deps_restore_dependencies ('plf', 'bmtlovfieldcode_temp');
			]]>
		</sql>
	</changeSet>
	<changeSet id="6.0" author="murthy.y">
		<createSequence sequenceName="SeqOrgIncomeExpenseHeader"
			startValue="1" maxValue="9223372036854775807" incrementBy="1" />
		<createSequence sequenceName="SeqOrgIncomeExpenses"
			startValue="1" maxValue="9223372036854775807" incrementBy="1" />
	</changeSet>
	<changeSet id="6.1" author="murthy.y">
		<createTable tableName="org_income_expense_header">
			<column name="id" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="orgId" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="financialYear" type="int" />
			<column name="CreatedBy" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="CreatedOn" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="Version" type="int">
				<constraints nullable="false" />
			</column>
			<column name="LastMntBy" type="bigint" />
			<column name="LastMntOn" type="datetime" />
			<column name="RecordStatus" type="varchar(50)" />
			<column name="RoleCode" type="varchar(100)" />
			<column name="NextRoleCode" type="varchar(200)" />
			<column name="TaskId" type="varchar(50)" />
			<column name="NextTaskId" type="varchar(200)" />
			<column name="RecordType" type="varchar(50)" />
			<column name="WorkflowId" type="bigint" />
		</createTable>
	</changeSet>
	<changeSet id="6.2" author="murthy.y">
		<createTable tableName="org_income_expense_header_temp">
			<column name="id" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="orgId" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="financialYear" type="int" />
			<column name="CreatedBy" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="CreatedOn" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="Version" type="int">
				<constraints nullable="false" />
			</column>
			<column name="LastMntBy" type="bigint" />
			<column name="LastMntOn" type="datetime" />
			<column name="RecordStatus" type="varchar(50)" />
			<column name="RoleCode" type="varchar(100)" />
			<column name="NextRoleCode" type="varchar(200)" />
			<column name="TaskId" type="varchar(50)" />
			<column name="NextTaskId" type="varchar(200)" />
			<column name="RecordType" type="varchar(50)" />
			<column name="WorkflowId" type="bigint" />
		</createTable>
	</changeSet>
	<changeSet id="6.3" author="murthy.y">
		<addPrimaryKey tableName="org_income_expense_header"
			columnNames="id" constraintName="pk_org_income_expense_h_id" />
		<addPrimaryKey tableName="org_income_expense_header_temp"
			columnNames="id" constraintName="pk_org_income_expense_h_t_id" />
		<addForeignKeyConstraint constraintName="fk_org_income_expense_h_orId"
			referencedTableName="organizations" referencedColumnNames="id"
			baseTableName="org_income_expense_header" baseColumnNames="orgId" />
		<addForeignKeyConstraint constraintName="fk_org_income_expense_h_t_orId"
			referencedTableName="organizations" referencedColumnNames="id"
			baseTableName="org_income_expense_header_temp" baseColumnNames="orgId" />
	</changeSet>
	<changeSet id="6.4" author="murthy.y">
		<createTable tableName="org_income_expenses">
			<column name="id" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="headerId" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="incomeExpense" type="varchar(8)">
				<constraints nullable="false" />
			</column>
			<column name="incomeExpenseCode" type="varchar(8)">
				<constraints nullable="false" />
			</column>
			<column name="category" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="incomeExpenseType" type="varchar(20)">
				<constraints nullable="false" />
			</column>
			<column name="units" type="int" defaultValue="0" />
			<column name="unitPrice" type="number(18,0)" />
			<column name="total" type="number(18,0)" />
			<column name="frequency" type="varchar(10)" />
			<column name="loockUpId" type="bigint" />
			<column name="consider" type="boolean" defaultValue="1">
				<constraints nullable="false" />
			</column>
			<column name="CreatedBy" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="CreatedOn" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="Version" type="int">
				<constraints nullable="false" />
			</column>
			<column name="LastMntBy" type="bigint" />
			<column name="LastMntOn" type="datetime" />
			<column name="RecordStatus" type="varchar(50)" />
			<column name="RoleCode" type="varchar(100)" />
			<column name="NextRoleCode" type="varchar(200)" />
			<column name="TaskId" type="varchar(50)" />
			<column name="NextTaskId" type="varchar(200)" />
			<column name="RecordType" type="varchar(50)" />
			<column name="WorkflowId" type="bigint" />
		</createTable>
	</changeSet>
	<changeSet id="6.5" author="murthy.y">
		<createTable tableName="org_income_expenses_temp">
			<column name="id" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="headerId" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="incomeExpense" type="varchar(8)">
				<constraints nullable="false" />
			</column>
			<column name="incomeExpenseCode" type="varchar(8)">
				<constraints nullable="false" />
			</column>
			<column name="category" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="incomeExpenseType" type="varchar(20)">
				<constraints nullable="false" />
			</column>
			<column name="units" type="int" defaultValue="0" />
			<column name="unitPrice" type="number(18,0)" />
			<column name="total" type="number(18,0)" />
			<column name="frequency" type="varchar(10)" />
			<column name="loockUpId" type="bigint" />
			<column name="consider" type="boolean" defaultValue="1">
				<constraints nullable="false" />
			</column>
			<column name="CreatedBy" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="CreatedOn" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="Version" type="int">
				<constraints nullable="false" />
			</column>
			<column name="LastMntBy" type="bigint" />
			<column name="LastMntOn" type="datetime" />
			<column name="RecordStatus" type="varchar(50)" />
			<column name="RoleCode" type="varchar(100)" />
			<column name="NextRoleCode" type="varchar(200)" />
			<column name="TaskId" type="varchar(50)" />
			<column name="NextTaskId" type="varchar(200)" />
			<column name="RecordType" type="varchar(50)" />
			<column name="WorkflowId" type="bigint" />
		</createTable>
	</changeSet>
	<changeSet id="6.6" author="murthy.y">
		<addPrimaryKey tableName="org_income_expenses"
			columnNames="id" constraintName="pk_org_income_expenses_id" />
		<addPrimaryKey tableName="org_income_expenses_temp"
			columnNames="id" constraintName="pk_org_income_expenses_temp_id" />
		<addForeignKeyConstraint constraintName="fk_org_income_expense_h_id"
			referencedTableName="org_income_expense_header"
			referencedColumnNames="id" baseTableName="org_income_expenses"
			baseColumnNames="headerId" />
		<addForeignKeyConstraint constraintName="fk_org_income_expense_h_t_id"
			referencedTableName="org_income_expense_header_temp"
			referencedColumnNames="id" baseTableName="org_income_expenses_temp"
			baseColumnNames="headerId" />
	</changeSet>
	<changeSet id="7.0" author="murthy.y">
		<createView viewName="org_income_expense_header_view"
			replaceIfExists="true">
			select 
				h.id,
				h.orgid,
				h.financialyear,
				h.createdby,
				h.createdon,
				o.code,
				o.name,
				o.date_incorporation,
				c.custcif,
				c.custshrtname,
				h.version,
				h.lastmntby,
				h.lastmnton,
				h.recordstatus,
				h.rolecode,
				h.nextrolecode,
				h.taskid,
				h.nexttaskid,
				h.recordtype,
				h.workflowid
				from org_income_expense_header_temp h
				inner join organizations o on o.id = h.orgid
				inner join customers c on c.custid = o.custid
			union all
			select 
				h.id,
				h.orgid,
				h.financialyear,
				h.createdby,
				h.createdon,
				o.code,
				o.name,
				o.date_incorporation,
				c.custcif,
				c.custshrtname,
				h.version,
				h.lastmntby,
				h.lastmnton,
				h.recordstatus,
				h.rolecode,
				h.nextrolecode,
				h.taskid,
				h.nexttaskid,
				h.recordtype,
				h.workflowid
				from org_income_expense_header h
				inner join organizations o on o.id = h.orgid
				inner join customers c on c.custid = o.custid
				where not exists (select 1 from org_income_expense_header_temp where id=h.id)
		</createView>
	</changeSet>
	<changeSet id="7.1" author="murthy.y">
		<createView viewName="org_income_expenses_view"
			replaceIfExists="true">
			SELECT ie.id,
			h.orgid,
			ie.headerid,
			ie.incomeexpense,
			ie.incomeexpensecode,
			ie.category,
			ie.incomeexpensetype,
			ie.units,
			ie.unitprice,
			ie.frequency,
			ie.consider,
			ie.loockupid,
			ie.total,
			h.financialyear,
			o.code,
			o.name,
			o.date_incorporation,
			c.custcif,
			c.custshrtname,
			rf.fieldcodevalue AS loockupvalue,
			rf.valuedesc AS loockupdesc,
			i.incometypedesc AS expensedesc,
			ie.createdby,
			ie.createdon,
			ie.version,
			ie.lastmntby,
			ie.lastmnton,
			ie.recordstatus,
			ie.rolecode,
			ie.nextrolecode,
			ie.taskid,
			ie.nexttaskid,
			ie.recordtype,
			ie.workflowid
			FROM org_income_expenses_temp ie
			JOIN org_income_expense_header_temp h ON h.id = ie.headerid
			JOIN organizations o ON o.id = h.orgid
			JOIN customers c ON c.custid = o.custid
			LEFT JOIN rmtlovfielddetail rf ON rf.fieldcodeid = ie.loockupid
			LEFT JOIN bmtincometypes i ON i.incomeexpense = ie.incomeexpense and i.category = ie.category and i.incometypecode = ie.incomeexpensecode
			UNION ALL
			SELECT ie.id,
			h.orgid,
			ie.headerid,
			ie.incomeexpense,
			ie.incomeexpensecode,
			ie.category,
			ie.incomeexpensetype,
			ie.units,
			ie.unitprice,
			ie.frequency,
			ie.consider,
			ie.loockupid,
			ie.total,
			h.financialyear,
			o.code,
			o.name,
			o.date_incorporation,
			c.custcif,
			c.custshrtname,
			rf.fieldcodevalue loockupvalue,
			rf.valuedesc loockupdesc,
			i.incometypedesc expensedesc,
			ie.createdby,
			ie.createdon,
			ie.version,
			ie.lastmntby,
			ie.lastmnton,
			ie.recordstatus,
			ie.rolecode,
			ie.nextrolecode,
			ie.taskid,
			ie.nexttaskid,
			ie.recordtype,
			ie.workflowid
			FROM org_income_expenses ie
			JOIN org_income_expense_header h ON h.id = ie.headerid
			JOIN organizations o ON o.id = h.orgid
			JOIN customers c ON c.custid = o.custid
			LEFT JOIN bmtincometypes i ON i.incomeexpense = ie.incomeexpense and i.category = ie.category and i.incometypecode = ie.incomeexpensecode			LEFT JOIN rmtlovfielddetail rf ON rf.fieldcodeid = ie.loockupid
			WHERE NOT (EXISTS ( SELECT 1
			FROM org_income_expenses_temp
			WHERE org_income_expenses_temp.id = ie.id))
		</createView>
	</changeSet>
	<changeSet id="7.2" author="murthy.y">
		<createView viewName="org_income_expenses_aview"
			replaceIfExists="true">
			SELECT ie.id,
			h.orgid,
			ie.headerid,
			ie.incomeexpense,
			ie.incomeexpensecode,
			ie.category,
			ie.incomeexpensetype,
			ie.units,
			ie.unitprice,
			ie.frequency,
			ie.consider,
			ie.loockupid,
			ie.total,
			h.financialyear,
			o.code,
			o.name,
			o.date_incorporation,
			c.custcif,
			c.custshrtname,
			rf.fieldcodevalue AS loockupvalue,
			rf.valuedesc AS loockupdesc,
			i.incometypedesc AS expensedesc,
			ie.createdby,
			ie.createdon,
			ie.version,
			ie.lastmntby,
			ie.lastmnton,
			ie.recordstatus,
			ie.rolecode,
			ie.nextrolecode,
			ie.taskid,
			ie.nexttaskid,
			ie.recordtype,
			ie.workflowid
			FROM org_income_expenses ie
			JOIN org_income_expense_header h ON h.id = ie.headerid
			JOIN organizations o ON o.id = h.orgid
			JOIN customers c ON c.custid = o.custid
			LEFT JOIN rmtlovfielddetail rf ON rf.fieldcodeid = ie.loockupid
			LEFT JOIN bmtincometypes i ON i.incomeexpense = ie.incomeexpense and i.category = ie.category and i.incometypecode = ie.incomeexpensecode
		</createView>
	</changeSet>
	<changeSet id="8.0" author="murthy.y">
		<sql>
			<![CDATA[
				delete from Secroles Where Rolecd = 'ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER';
				delete from Secroles Where Rolecd = 'ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER';
			
				Update SeqSecRoles set seqno = (Select Max(roleid) from Secroles_view);
			
				INSERT INTO SecRoles SELECT (select seqno+1 from SeqSecRoles), 1, 'ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER', 'Maker Role for School Funding', null, 0, 1000, CURRENT_TIMESTAMP, 'Approved', null, null, null, null, null, 0 FROM SeqSecRoleGroups WHERE 0=0;
				INSERT INTO SecRoles SELECT (select seqno+2 from SeqSecRoles), 1, 'ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER', 'Approver Role for School Funding', null, 0, 1000, CURRENT_TIMESTAMP, 'Approved', null, null, null, null, null, 0 FROM SeqSecRoleGroups WHERE 0=0;
			]]>
		</sql>
	</changeSet>
	<changeSet id="8.0" author="murthy.y">
		<sql>
			<![CDATA[
				delete from Secroles Where Rolecd = 'ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER';
				delete from Secroles Where Rolecd = 'ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER';
			
				Update SeqSecRoles set seqno = (Select Max(roleid) from Secroles_view);
			
				INSERT INTO SecRoles SELECT (select seqno+1 from SeqSecRoles), 1, 'ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER', 'Maker Role for School Funding', null, 0, 1000, CURRENT_TIMESTAMP, 'Approved', null, null, null, null, null, 0 FROM SeqSecRoleGroups WHERE 0=0;
				INSERT INTO SecRoles SELECT (select seqno+2 from SeqSecRoles), 1, 'ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER', 'Approver Role for School Funding', null, 0, 1000, CURRENT_TIMESTAMP, 'Approved', null, null, null, null, null, 0 FROM SeqSecRoleGroups WHERE 0=0;
			]]>
		</sql>
	</changeSet>
	<changeSet id="8.1" author="murthy.y">
		<sql>
			<![CDATA[
				update workflowdetails set WorkFlowActive='0' where WorkFlowType='ORGANIZATION_SCHOOL_INCOME_EXPENSE';
			]]>
		</sql>
		<insert tableName="WorkFlowDetails">
			<column name="WorkFlowId" valueComputed="(select max(Seqno) + 1 from SeqWorkFlowDetails)" />
			<column name="WorkFlowType">ORGANIZATION_SCHOOL_INCOME_EXPENSE</column>
			<column name="WorkFlowSubType">ORGANIZATION_SCHOOL_INCOME_EXPENSE</column>
			<column name="WorkFlowDesc">School Funding Master Workflow</column>
			<column name="JsonDesign" type="nclob"><![CDATA[NULL]]></column>
			<column name="SvgDesign" type="nclob"><![CDATA[NULL]]></column>
			<column name="WorkFlowXml" type="clob"><![CDATA[NULL]]></column>
			<column name="WorkFlowRoles">ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER;ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER
			</column>
			<column name="FirstTaskOwner">ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER</column>
			<column name="WorkFlowActive">1</column>
			<column name="Version">0</column>
			<column name="LastMntBy">1000</column>
			<column name="LastMntOn" valueDate="current_timestamp" />
			<column name="RecordStatus">Null</column>
			<column name="RoleCode"></column>
			<column name="NextRoleCode"></column>
			<column name="TaskId"></column>
			<column name="NextTaskId"></column>
			<column name="RecordType">NULL</column>
		</insert>
	</changeSet>
	<changeSet id="8.2" author="murthy.y">
		<update tableName="WORKFLOWDETAILS">
			<column name="JSONDESIGN" type="NCLOB"><![CDATA[{"resourceId":"canvas","properties":{"process_id":"ORGANIZATION_SCHOOL_INCOME_EXPENSE","name":"School funding workflow","documentation":"Maker/Checker workflow for school funding","category":"","listenerclass":"","listenerentitytype":""},"stencil":{"id":"BPMNDiagram"},"childShapes":[{"resourceId":"startEvent1","properties":{"overrideid":"","name":"Start"},"stencil":{"id":"StartNoneEvent"},"childShapes":[],"outgoing":[{"resourceId":"sid-62671BC5-8E41-498B-BDD5-D58682E07058"}],"bounds":{"lowerRight":{"x":130,"y":193},"upperLeft":{"x":100,"y":163}},"dockers":[]},{"resourceId":"sid-C582990C-FA38-42A5-8480-AB3D0980398E","properties":{"overrideid":"","name":"Maker","usertaskassignment":{"assignment":{"type":"idm","idm":{"type":"user","assignee":{"email":"ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER","firstName":"ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER","fullName":"ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER","id":"ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER","roledesc":"Role For Organization School Maker","$$hashKey":"object:3218"}}}},"additionalforms":"","formkeydefinition":"","prioritydefinition":"Role Queue","baseactor":"","duedatedefinition":"","multiinstance_type":"None","isforcompensation":"false"},"stencil":{"id":"UserTask"},"childShapes":[],"outgoing":[{"resourceId":"sid-90E3D507-992C-4A25-A122-20874033A554"},{"resourceId":"sid-EE9D254D-F645-41D4-8865-C830A628B08E"}],"bounds":{"lowerRight":{"x":310,"y":218},"upperLeft":{"x":210,"y":138}},"dockers":[]},{"resourceId":"sid-62671BC5-8E41-498B-BDD5-D58682E07058","properties":{"overrideid":"","name":"","repruseaction":"false","conditionsequenceflow":"","defaultflow":"false","action":"","state":"","mandatenotes":"false","capturereasons":"false","typeofreason":""},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-C582990C-FA38-42A5-8480-AB3D0980398E"}],"bounds":{"lowerRight":{"x":209.15625,"y":178},"upperLeft":{"x":130.7265625,"y":178}},"dockers":[{"x":15,"y":15},{"x":50,"y":40}],"target":{"resourceId":"sid-C582990C-FA38-42A5-8480-AB3D0980398E"}},{"resourceId":"sid-4A26CD84-66D9-485B-BA98-7270E41ED6B0","properties":{"overrideid":"","name":"Approver","usertaskassignment":{"assignment":{"type":"idm","idm":{"type":"user","assignee":{"email":"ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER","firstName":"ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER","fullName":"ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER","id":"ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER","roledesc":"Role For Organization School Approver","$$hashKey":"object:2140"}}}},"additionalforms":"","formkeydefinition":"","prioritydefinition":"Role Queue","baseactor":"","duedatedefinition":"","multiinstance_type":"None","isforcompensation":"false"},"stencil":{"id":"UserTask"},"childShapes":[],"outgoing":[{"resourceId":"sid-4FDEDA31-BB0D-4C1F-ACCD-48C5AD945F85"}],"bounds":{"lowerRight":{"x":490,"y":218},"upperLeft":{"x":390,"y":138}},"dockers":[]},{"resourceId":"sid-0F430ABA-CD3A-409F-A1BB-2228AD27422E","properties":{"overrideid":"","name":"","sequencefloworder":""},"stencil":{"id":"ExclusiveGateway"},"childShapes":[],"outgoing":[{"resourceId":"sid-F89EE913-9556-4C3B-9097-CF2B85083C47"},{"resourceId":"sid-03C378B5-552E-4F74-ADD6-874DA2D03D66"},{"resourceId":"sid-F8129FFE-C307-4BF8-BB40-494025C41851"}],"bounds":{"lowerRight":{"x":595,"y":198},"upperLeft":{"x":555,"y":158}},"dockers":[]},{"resourceId":"sid-2B32A3FE-8550-4C6F-9205-49B1CF1C364F","properties":{"overrideid":"","name":"Complete Process","rerunnable":true,"servicetaskexpression":"doApprove","isforcompensation":"false","multiinstance_type":"None","prioritydefinition":"Role Queue","type":"http://b3mn.org/stencilset/bpmn2.0#UserTask","usertaskassignment":"","additionalforms":"","formkeydefinition":"","duedatedefinition":"","baseactor":""},"stencil":{"id":"approveTask"},"childShapes":[],"outgoing":[{"resourceId":"sid-56B6BBDD-7E3D-407D-8666-26E97743A850"}],"bounds":{"lowerRight":{"x":760,"y":218},"upperLeft":{"x":660,"y":138}},"dockers":[]},{"resourceId":"sid-A1094339-06E1-4C79-A701-1CD451268C5C","properties":{"overrideid":"","name":"Cancel Process","rerunnable":true,"servicetaskexpression":"doReject","isforcompensation":"false","multiinstance_type":"None","prioritydefinition":"Role Queue","type":"http://b3mn.org/stencilset/bpmn2.0#UserTask","usertaskassignment":"","additionalforms":"","formkeydefinition":"","duedatedefinition":"","baseactor":""},"stencil":{"id":"rejectTask"},"childShapes":[],"outgoing":[{"resourceId":"sid-6BA8261C-34B3-4C69-BA31-163D52465132"}],"bounds":{"lowerRight":{"x":625,"y":380},"upperLeft":{"x":525,"y":300}},"dockers":[]},{"resourceId":"sid-52D8B9BD-DEB9-49D6-BA3B-496EED33F57C","properties":{"overrideid":"","name":"Approved"},"stencil":{"id":"EndNoneEvent"},"childShapes":[],"outgoing":[],"bounds":{"lowerRight":{"x":853,"y":192},"upperLeft":{"x":825,"y":164}},"dockers":[]},{"resourceId":"sid-56B6BBDD-7E3D-407D-8666-26E97743A850","properties":{"overrideid":"","name":"","repruseaction":"false","conditionsequenceflow":"","defaultflow":"false","action":"","state":"","mandatenotes":"false","capturereasons":"false","typeofreason":""},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-52D8B9BD-DEB9-49D6-BA3B-496EED33F57C"}],"bounds":{"lowerRight":{"x":824.8984375,"y":178},"upperLeft":{"x":760.3828125,"y":178}},"dockers":[{"x":50,"y":40},{"x":14,"y":14}],"target":{"resourceId":"sid-52D8B9BD-DEB9-49D6-BA3B-496EED33F57C"}},{"resourceId":"sid-E49D16E7-99DD-4BD3-B3B2-0EEF77161046","properties":{"overrideid":"","name":"Cancelled"},"stencil":{"id":"EndNoneEvent"},"childShapes":[],"outgoing":[],"bounds":{"lowerRight":{"x":698,"y":354},"upperLeft":{"x":670,"y":326}},"dockers":[]},{"resourceId":"sid-6BA8261C-34B3-4C69-BA31-163D52465132","properties":{"overrideid":"","name":"","repruseaction":"false","conditionsequenceflow":"","defaultflow":"false","action":"","state":"","mandatenotes":"false","capturereasons":"false","typeofreason":""},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-E49D16E7-99DD-4BD3-B3B2-0EEF77161046"}],"bounds":{"lowerRight":{"x":669.375,"y":340},"upperLeft":{"x":625.390625,"y":340}},"dockers":[{"x":50,"y":40},{"x":14,"y":14}],"target":{"resourceId":"sid-E49D16E7-99DD-4BD3-B3B2-0EEF77161046"}},{"resourceId":"sid-4FDEDA31-BB0D-4C1F-ACCD-48C5AD945F85","properties":{"overrideid":"","name":"","repruseaction":"false","conditionsequenceflow":"","defaultflow":"false","action":"","state":"","mandatenotes":"false","capturereasons":"false","typeofreason":""},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-0F430ABA-CD3A-409F-A1BB-2228AD27422E"}],"bounds":{"lowerRight":{"x":555.015625,"y":178},"upperLeft":{"x":490.5703125,"y":178}},"dockers":[{"x":50,"y":40},{"x":20,"y":20}],"target":{"resourceId":"sid-0F430ABA-CD3A-409F-A1BB-2228AD27422E"}},{"resourceId":"sid-EE9D254D-F645-41D4-8865-C830A628B08E","properties":{"overrideid":"","name":"Submit","repruseaction":true,"conditionsequenceflow":{"expression":{"type":"static","staticValue":"vo.recordStatus == 'Submitted'"}},"defaultflow":"false","action":"Submit","state":"Submitted","mandatenotes":"false","capturereasons":"false","typeofreason":"","showdiamondmarker":false},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-4A26CD84-66D9-485B-BA98-7270E41ED6B0"}],"bounds":{"lowerRight":{"x":389.52959701805423,"y":178.5},"upperLeft":{"x":310.6978238359261,"y":178.5}},"dockers":[{"x":72.75389944188339,"y":40.5},{"x":20.488059532159923,"y":40.5}],"target":{"resourceId":"sid-4A26CD84-66D9-485B-BA98-7270E41ED6B0"}},{"resourceId":"sid-90E3D507-992C-4A25-A122-20874033A554","properties":{"overrideid":"","name":"Cancel","repruseaction":true,"conditionsequenceflow":{"expression":{"type":"static","staticValue":"vo.recordStatus == 'Cancelled'"}},"defaultflow":"false","action":"Cancel","state":"Cancelled","mandatenotes":true,"capturereasons":"false","typeofreason":""},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-A1094339-06E1-4C79-A701-1CD451268C5C"}],"bounds":{"lowerRight":{"x":524.78125,"y":340},"upperLeft":{"x":260,"y":218.234375}},"dockers":[{"x":50,"y":40},{"x":260,"y":340},{"x":50,"y":40}],"target":{"resourceId":"sid-A1094339-06E1-4C79-A701-1CD451268C5C"}},{"resourceId":"sid-F89EE913-9556-4C3B-9097-CF2B85083C47","properties":{"overrideid":"","name":"Reject","repruseaction":true,"conditionsequenceflow":{"expression":{"type":"static","staticValue":"vo.recordStatus == 'Rejected'"}},"defaultflow":"false","action":"Reject","state":"Rejected","mandatenotes":true,"capturereasons":"false","typeofreason":""},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-A1094339-06E1-4C79-A701-1CD451268C5C"}],"bounds":{"lowerRight":{"x":575.4383102896053,"y":299.88672354249684},"upperLeft":{"x":575.1241897103947,"y":198.42577645750313}},"dockers":[{"x":20.5,"y":20.5},{"x":50,"y":40}],"target":{"resourceId":"sid-A1094339-06E1-4C79-A701-1CD451268C5C"}},{"resourceId":"sid-F8129FFE-C307-4BF8-BB40-494025C41851","properties":{"overrideid":"","name":"Resubmit","repruseaction":true,"conditionsequenceflow":{"expression":{"type":"static","staticValue":"vo.recordStatus == 'Resubmitted'"}},"defaultflow":"false","action":"Resubmit","state":"Resubmitted","mandatenotes":true,"capturereasons":"false","typeofreason":""},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-C582990C-FA38-42A5-8480-AB3D0980398E"}],"bounds":{"lowerRight":{"x":575.5,"y":157.90625},"upperLeft":{"x":260,"y":74}},"dockers":[{"x":20.5,"y":20.5},{"x":575.5,"y":74},{"x":260,"y":74},{"x":50,"y":40}],"target":{"resourceId":"sid-C582990C-FA38-42A5-8480-AB3D0980398E"}},{"resourceId":"sid-03C378B5-552E-4F74-ADD6-874DA2D03D66","properties":{"overrideid":"","name":"Approve","repruseaction":true,"conditionsequenceflow":{"expression":{"type":"static","staticValue":"vo.recordStatus == 'Approved'"}},"defaultflow":"false","action":"Approve","state":"Approved","mandatenotes":"false","capturereasons":"false","typeofreason":"","showdiamondmarker":false},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-2B32A3FE-8550-4C6F-9205-49B1CF1C364F"}],"bounds":{"lowerRight":{"x":659.6132881597279,"y":178.42597005356777},"upperLeft":{"x":595.4140555902721,"y":178.18731119643223}},"dockers":[{"x":20.5,"y":20.5},{"x":50,"y":40}],"target":{"resourceId":"sid-2B32A3FE-8550-4C6F-9205-49B1CF1C364F"}}],"bounds":{"lowerRight":{"x":1200,"y":1050},"upperLeft":{"x":0,"y":0}},"stencilset":{"url":"stencilsets/bpmn2.0/bpmn2.0.json","namespace":"http://b3mn.org/stencilset/bpmn2.0#"},"ssextensions":[]}]]></column>
			<column name="WORKFLOWXML" type="CLOB"><![CDATA[<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://activiti.org/test">   <process id="ORGANIZATION_SCHOOL_INCOME_EXPENSE" name="Organization School Workflow" isExecutable="true">     <documentation>Maker/Checker Workflow for Organization School</documentation>     <startEvent id="startEvent1" name="Start"/>     <userTask id="sid-C582990C-FA38-42A5-8480-AB3D0980398E" name="Maker" activiti:actor="ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER" activiti:assignmentLevel="Role Queue"/>     <sequenceFlow id="sid-62671BC5-8E41-498B-BDD5-D58682E07058" sourceRef="startEvent1" targetRef="sid-C582990C-FA38-42A5-8480-AB3D0980398E" representsUserAction="false" mandateNotes="false" captureReasons="false"/>     <userTask id="sid-4A26CD84-66D9-485B-BA98-7270E41ED6B0" name="Approver" activiti:actor="ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER" activiti:assignmentLevel="Role Queue"/>     <exclusiveGateway id="sid-0F430ABA-CD3A-409F-A1BB-2228AD27422E"/>     <serviceTask id="sid-2B32A3FE-8550-4C6F-9205-49B1CF1C364F" name="Complete Process" activiti:operation="doApprove" activiti:rerunnable="true"/>     <serviceTask id="sid-A1094339-06E1-4C79-A701-1CD451268C5C" name="Cancel Process" activiti:operation="doReject" activiti:rerunnable="true"/>     <endEvent id="sid-52D8B9BD-DEB9-49D6-BA3B-496EED33F57C" name="Approved"/>     <sequenceFlow id="sid-56B6BBDD-7E3D-407D-8666-26E97743A850" sourceRef="sid-2B32A3FE-8550-4C6F-9205-49B1CF1C364F" targetRef="sid-52D8B9BD-DEB9-49D6-BA3B-496EED33F57C" representsUserAction="false" mandateNotes="false" captureReasons="false"/>     <endEvent id="sid-E49D16E7-99DD-4BD3-B3B2-0EEF77161046" name="Cancelled"/>     <sequenceFlow id="sid-6BA8261C-34B3-4C69-BA31-163D52465132" sourceRef="sid-A1094339-06E1-4C79-A701-1CD451268C5C" targetRef="sid-E49D16E7-99DD-4BD3-B3B2-0EEF77161046" representsUserAction="false" mandateNotes="false" captureReasons="false"/>     <sequenceFlow id="sid-4FDEDA31-BB0D-4C1F-ACCD-48C5AD945F85" sourceRef="sid-4A26CD84-66D9-485B-BA98-7270E41ED6B0" targetRef="sid-0F430ABA-CD3A-409F-A1BB-2228AD27422E" representsUserAction="false" mandateNotes="false" captureReasons="false"/>     <sequenceFlow id="sid-EE9D254D-F645-41D4-8865-C830A628B08E" name="Submit" sourceRef="sid-C582990C-FA38-42A5-8480-AB3D0980398E" targetRef="sid-4A26CD84-66D9-485B-BA98-7270E41ED6B0" action="Submit" state="Submitted" representsUserAction="true" mandateNotes="false" captureReasons="false"><conditionExpression xsi:type="tFormalExpression">vo.recordStatus == "Submitted"</conditionExpression>     </sequenceFlow>     <sequenceFlow id="sid-90E3D507-992C-4A25-A122-20874033A554" name="Cancel" sourceRef="sid-C582990C-FA38-42A5-8480-AB3D0980398E" targetRef="sid-A1094339-06E1-4C79-A701-1CD451268C5C" action="Cancel" state="Cancelled" representsUserAction="true" mandateNotes="true" captureReasons="false"><conditionExpression xsi:type="tFormalExpression">vo.recordStatus == "Cancelled"</conditionExpression>     </sequenceFlow>     <sequenceFlow id="sid-F89EE913-9556-4C3B-9097-CF2B85083C47" name="Reject" sourceRef="sid-0F430ABA-CD3A-409F-A1BB-2228AD27422E" targetRef="sid-A1094339-06E1-4C79-A701-1CD451268C5C" action="Reject" state="Rejected" representsUserAction="true" mandateNotes="true" captureReasons="false"><conditionExpression xsi:type="tFormalExpression">vo.recordStatus == "Rejected"</conditionExpression>     </sequenceFlow>     <sequenceFlow id="sid-F8129FFE-C307-4BF8-BB40-494025C41851" name="Resubmit" sourceRef="sid-0F430ABA-CD3A-409F-A1BB-2228AD27422E" targetRef="sid-C582990C-FA38-42A5-8480-AB3D0980398E" action="Resubmit" state="Resubmitted" representsUserAction="true" mandateNotes="true" captureReasons="false"><conditionExpression xsi:type="tFormalExpression">vo.recordStatus == "Resubmitted"</conditionExpression>     </sequenceFlow>     <sequenceFlow id="sid-03C378B5-552E-4F74-ADD6-874DA2D03D66" name="Approve" sourceRef="sid-0F430ABA-CD3A-409F-A1BB-2228AD27422E" targetRef="sid-2B32A3FE-8550-4C6F-9205-49B1CF1C364F" action="Approve" state="Approved" representsUserAction="true" mandateNotes="false" captureReasons="false"><conditionExpression xsi:type="tFormalExpression">vo.recordStatus == "Approved"</conditionExpression>     </sequenceFlow>   </process>   <bpmndi:BPMNDiagram id="BPMNDiagram_ORGANIZATION_SCHOOL_INCOME_EXPENSE">     <bpmndi:BPMNPlane bpmnElement="ORGANIZATION_SCHOOL_INCOME_EXPENSE" id="BPMNPlane_ORGANIZATION_SCHOOL_INCOME_EXPENSE"><bpmndi:BPMNShape bpmnElement="startEvent1" id="BPMNShape_startEvent1"><omgdc:Bounds height="30.0" width="30.0" x="100.0" y="163.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-C582990C-FA38-42A5-8480-AB3D0980398E" id="BPMNShape_sid-C582990C-FA38-42A5-8480-AB3D0980398E"><omgdc:Bounds height="80.0" width="100.0" x="210.0" y="138.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-4A26CD84-66D9-485B-BA98-7270E41ED6B0" id="BPMNShape_sid-4A26CD84-66D9-485B-BA98-7270E41ED6B0"><omgdc:Bounds height="80.0" width="100.0" x="390.0" y="138.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-0F430ABA-CD3A-409F-A1BB-2228AD27422E" id="BPMNShape_sid-0F430ABA-CD3A-409F-A1BB-2228AD27422E"><omgdc:Bounds height="40.0" width="40.0" x="555.0" y="158.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-2B32A3FE-8550-4C6F-9205-49B1CF1C364F" id="BPMNShape_sid-2B32A3FE-8550-4C6F-9205-49B1CF1C364F"><omgdc:Bounds height="80.0" width="100.0" x="660.0" y="138.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-A1094339-06E1-4C79-A701-1CD451268C5C" id="BPMNShape_sid-A1094339-06E1-4C79-A701-1CD451268C5C"><omgdc:Bounds height="80.0" width="100.0" x="525.0" y="300.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-52D8B9BD-DEB9-49D6-BA3B-496EED33F57C" id="BPMNShape_sid-52D8B9BD-DEB9-49D6-BA3B-496EED33F57C"><omgdc:Bounds height="28.0" width="28.0" x="825.0" y="164.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-E49D16E7-99DD-4BD3-B3B2-0EEF77161046" id="BPMNShape_sid-E49D16E7-99DD-4BD3-B3B2-0EEF77161046"><omgdc:Bounds height="28.0" width="28.0" x="670.0" y="326.0"/></bpmndi:BPMNShape><bpmndi:BPMNEdge bpmnElement="sid-EE9D254D-F645-41D4-8865-C830A628B08E" id="BPMNEdge_sid-EE9D254D-F645-41D4-8865-C830A628B08E"><omgdi:waypoint x="310.0" y="178.5"/><omgdi:waypoint x="390.0" y="178.5"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-90E3D507-992C-4A25-A122-20874033A554" id="BPMNEdge_sid-90E3D507-992C-4A25-A122-20874033A554"><omgdi:waypoint x="260.0" y="218.0"/><omgdi:waypoint x="260.0" y="340.0"/><omgdi:waypoint x="525.0" y="340.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-F8129FFE-C307-4BF8-BB40-494025C41851" id="BPMNEdge_sid-F8129FFE-C307-4BF8-BB40-494025C41851"><omgdi:waypoint x="575.5" y="158.5"/><omgdi:waypoint x="575.5" y="74.0"/><omgdi:waypoint x="260.0" y="74.0"/><omgdi:waypoint x="260.0" y="138.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-6BA8261C-34B3-4C69-BA31-163D52465132" id="BPMNEdge_sid-6BA8261C-34B3-4C69-BA31-163D52465132"><omgdi:waypoint x="625.0" y="340.0"/><omgdi:waypoint x="670.0" y="340.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-F89EE913-9556-4C3B-9097-CF2B85083C47" id="BPMNEdge_sid-F89EE913-9556-4C3B-9097-CF2B85083C47"><omgdi:waypoint x="575.4409937888199" y="197.55900621118013"/><omgdi:waypoint x="575.123839009288" y="300.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-56B6BBDD-7E3D-407D-8666-26E97743A850" id="BPMNEdge_sid-56B6BBDD-7E3D-407D-8666-26E97743A850"><omgdi:waypoint x="760.0" y="178.0"/><omgdi:waypoint x="825.0" y="178.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-03C378B5-552E-4F74-ADD6-874DA2D03D66" id="BPMNEdge_sid-03C378B5-552E-4F74-ADD6-874DA2D03D66"><omgdi:waypoint x="594.570895522388" y="178.42910447761193"/><omgdi:waypoint x="660.0" y="178.18587360594796"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-4FDEDA31-BB0D-4C1F-ACCD-48C5AD945F85" id="BPMNEdge_sid-4FDEDA31-BB0D-4C1F-ACCD-48C5AD945F85"><omgdi:waypoint x="490.0" y="178.0"/><omgdi:waypoint x="555.0" y="178.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-62671BC5-8E41-498B-BDD5-D58682E07058" id="BPMNEdge_sid-62671BC5-8E41-498B-BDD5-D58682E07058"><omgdi:waypoint x="130.0" y="178.0"/><omgdi:waypoint x="210.0" y="178.0"/></bpmndi:BPMNEdge>     </bpmndi:BPMNPlane>   </bpmndi:BPMNDiagram> </definitions>]]></column>
			<where>workflowtype='ORGANIZATION_SCHOOL_INCOME_EXPENSE' and workflowactive=1
			</where>
		</update>
	</changeSet>
	<changeSet id="8.3" author="murthy.y">
		<sql>
			<![CDATA[
				UPDATE SeqWorkFlowDetails SET SEQNO= (SELECT MAX(WorkflowId)+1 FROM workflowdetails);
			]]>
		</sql>
	</changeSet>
	<changeSet id="9.0" author="lakshmi.n">
		<sql>
			<![CDATA[
				delete from secoperationroles where roleid IN (select roleid from SecRoles where rolecd IN('ORGANIZATION_SCHOOL_MAKER', 'ORGANIZATION_SCHOOL_APPROVER'));
				Delete from SecRoleGroups where roleid in(Select roleid from secroles where rolecd in('ORGANIZATION_SCHOOL_MAKER','ORGANIZATION_SCHOOL_APPROVER')) and grpid in(Select grpid from secgroups where grpcode IN('ORGANIZATION_SCHOOL_MAKER','ORGANIZATION_SCHOOL_APPROVER'));
				Delete from SecRoles where rolecd in('ORGANIZATION_SCHOOL_MAKER','ORGANIZATION_SCHOOL_APPROVER');
				Delete from Secgrouprights where grpid in(Select grpid from secgroups where grpcode IN('ORGANIZATION_SCHOOL_MAKER','ORGANIZATION_SCHOOL_APPROVER')) and rightid in(Select rightid from SecRights where Page IN('OrganizationSchoolDialog','OrganizationSchoolList'));
				Delete from Secgrouprights where grpid in(Select grpid from secgroups where grpcode IN('ORGANIZATION_SCHOOL_MAKER','ORGANIZATION_SCHOOL_APPROVER')) and rightid in(Select rightid from SecRights where RightName = 'menuItem_OrganizationSchool_Enquiry');
				Delete from Secgrouprights where grpid in(Select grpid from secgroups where grpcode IN('ORGANIZATION_SCHOOL_MAKER','ORGANIZATION_SCHOOL_APPROVER')) and rightid in(Select rightid from SecRights where RightName = 'menuItem_OrganizationSchool');
				
				Delete from SecGroups where GrpCode IN('ORGANIZATION_SCHOOL_MAKER','ORGANIZATION_SCHOOL_APPROVER');
				
				Delete from SecRights where page IN('OrganizationSchoolDialog','OrganizationSchoolList');
				Delete from SecRights where RightName = 'menuItem_OrganizationSchool';
				Delete from SecRights where RightName = 'menuItem_OrganizationSchool_Enquiry';
				
				update SeqSecRights set SeqNo = ((Select MAX(RightID) From SecRights));
				INSERT INTO SecRights VALUES ((Select MAX(RightID)+1 From SecRights), 0, 'menuItem_OrganizationSchool', 'MENU',  1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				INSERT INTO SecRights VALUES ((Select MAX(RightID)+1 From SecRights), 0, 'menuItem_OrganizationSchool_Enquiry', 'MENU',  1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ','',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights), 2, 'button_OrganizationSchoolList_btnNew', 'OrganizationSchoolList', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights), 2, 'button_OrganizationSchoolDialog_btnEdit', 'OrganizationSchoolDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights), 2, 'button_OrganizationSchoolDialog_btnDelete', 'OrganizationSchoolDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights), 2, 'button_OrganizationSchoolDialog_btnSave', 'OrganizationSchoolDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights), 3, 'OrganizationSchoolDialog_CIF', 'OrganizationSchoolDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights), 3, 'OrganizationSchoolDialog_Name', 'OrganizationSchoolDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights), 3, 'OrganizationSchoolDialog_Code', 'OrganizationSchoolDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights), 3, 'OrganizationSchoolDialog_DateOfIncorporation', 'OrganizationSchoolDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights), 3, 'OrganizationSchoolDialog_OrganizationSchoolExtFields', 'OrganizationSchoolDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				update SeqSecRights set SeqNo = ((Select MAX(RightID) From SecRights));
				
				update SeqSecGroups set SeqNo = ((Select MAX(GrpID) From SecGroups));
				Insert Into secGroups values((Select MAX(GrpID)+1 From secGroups),'ORGANIZATION_SCHOOL_MAKER','WF Maker for  School Organization',0 ,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGroups values((Select MAX(GrpID)+1 From secGroups),'ORGANIZATION_SCHOOL_APPROVER','WF Approver for School Organization',0,1000,current_timestamp, 'Approved','','','','','',0);
				update SeqSecGroups set SeqNo = ((Select MAX(GrpID) From SecGroups));
				
				update SeqSecGrouprights set SeqNo = ((Select MAX(GrpRightID) From secGrouprights));
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_MAKER'),(select RightId from secRights where RightName='menuItem_OrganizationSchool'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_MAKER'),(select RightId from secRights where RightName='menuItem_OrganizationSchool_Enquiry'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_MAKER'),(select RightId from secRights where RightName='button_OrganizationSchoolDialog_btnEdit'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_MAKER'),(select RightId from secRights where RightName='button_OrganizationSchoolDialog_btnDelete'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_MAKER'),(select RightId from secRights where RightName='button_OrganizationSchoolDialog_btnSave'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_MAKER'),(select RightId from secRights where RightName='OrganizationSchoolDialog_CIF'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_MAKER'),(select RightId from secRights where RightName='OrganizationSchoolDialog_Name'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_MAKER'),(select RightId from secRights where RightName='OrganizationSchoolDialog_Code'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_MAKER'),(select RightId from secRights where RightName='OrganizationSchoolDialog_DateOfIncorporation'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_MAKER'),(select RightId from secRights where RightName='OrganizationSchoolDialog_OrganizationSchoolExtFields'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_APPROVER'),(select RightId from secRights where RightName='menuItem_OrganizationSchool'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_APPROVER'),(select RightId from secRights where RightName='menuItem_OrganizationSchool_Enquiry'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_APPROVER'),(select RightId from secRights where RightName='button_OrganizationSchoolDialog_btnSave'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				update SeqSecGrouprights set SeqNo = ((Select MAX(GrpRightID) From secGrouprights));
				
				update SeqSecroles set SeqNo = ((Select MAX(roleid) From secroles));
				INSERT INTO secroles VALUES ((select MAX(roleid)+1 From secroles),1,'ORGANIZATION_SCHOOL_MAKER','Workflow Maker',null,0,1000,current_timestamp,null,null,null,null,null,null,0);
				INSERT INTO secroles VALUES ((select MAX(roleid)+1 From secroles),1,'ORGANIZATION_SCHOOL_APPROVER','Workflow Approver',null,0,1000,current_timestamp,null,null,null,null,null,null,0);
				update SeqSecroles set SeqNo = ((Select MAX(roleid) From secroles));
				
				update SeqSecRoleGroups set SeqNo = ((Select MAX(RoleGrpID) From secRoleGroups));
				Insert into secRoleGroups values((select MAX(RoleGrpID)+1 From secRoleGroups),(select GrpID from SecGroups where grpCode='ORGANIZATION_SCHOOL_MAKER'),(select RoleID from secRoles where RoleCd='ORGANIZATION_SCHOOL_MAKER'),0,1000,current_timestamp,'Approved','','','','','',0);
				Insert into secRoleGroups values((select MAX(RoleGrpID)+1 From secRoleGroups),(select GrpID from SecGroups where grpCode='ORGANIZATION_SCHOOL_APPROVER'),(select RoleID from secRoles where RoleCd='ORGANIZATION_SCHOOL_APPROVER'),0,1000,current_timestamp,'Approved','','','','','',0);
				update SeqSecRoleGroups set SeqNo = ((Select MAX(RoleGrpID) From secRoleGroups));
			]]>
		</sql>
	</changeSet>
	<changeSet id="9.1" author="lakshmi.n">
		<sql>
			<![CDATA[
				delete from secoperationroles where roleid in (select roleid from SecRoles where rolecd in ('ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER', 'ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER'));
				Delete from SecRoleGroups where roleid in (Select roleid from secroles where rolecd in ('ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER','ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER')) and grpid in(Select grpid from secgroups where grpcode IN('ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER','ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER'));
				Delete from SecRoles where rolecd in ('ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER','ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER');
				Delete from Secgrouprights where grpid in (Select grpid from secgroups where grpcode IN ('ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER','ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER')) and rightid in(Select rightid from SecRights where Page IN('OrganizationIncomeExpenseDialog','OrganizationIncomeExpenseList'));
				Delete from Secgrouprights where grpid in (Select grpid from secgroups where grpcode IN ('ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER','ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER')) and rightid in(Select rightid from SecRights where RightName = 'menuItem_OrganizationIncomeExpense_Enquiry');
				Delete from Secgrouprights where grpid in (Select grpid from secgroups where grpcode IN ('ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER','ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER')) and rightid in(Select rightid from SecRights where RightName = 'menuItem_OrganizationIncomeExpense');
				Delete from SecGroups where GrpCode IN('ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER','ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER');
				
				Delete from SecRights where RightName = 'menuItem_OrganizationIncomeExpense';
				Delete from SecRights where RightName = 'menuItem_OrganizationIncomeExpense_Enquiry';
				Delete from SecRights where page in ('OrganizationIncomeExpenseDialog','OrganizationIncomeExpenseList');
				
				update SeqSecRights set SeqNo = ((Select MAX(RightID) From SecRights));
				INSERT INTO SecRights VALUES ((Select MAX(RightID)+1 From SecRights), 0, 'menuItem_OrganizationIncomeExpense', 'MENU',  1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				INSERT INTO SecRights VALUES ((Select MAX(RightID)+1 From SecRights), 0, 'menuItem_OrganizationIncomeExpense_Enquiry', 'MENU',  1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ','',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights),  2, 'button_OrganizationIncomeExpenseList_btnNew', 'OrganizationIncomeExpenseList', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights),  2, 'button_OrganizationIncomeExpenseDialog_btnEdit', 'OrganizationIncomeExpenseDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights),  2, 'button_OrganizationIncomeExpenseDialog_btnDelete', 'OrganizationIncomeExpenseDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights),  2, 'button_OrganizationIncomeExpenseDialog_btnSave', 'OrganizationIncomeExpenseDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights),  2, 'button_OrganizationIncomeExpenseDialog_btnNewCoreIncome', 'OrganizationIncomeExpenseDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights),  2, 'button_OrganizationIncomeExpenseDialog_btnNewNonCoreIncome', 'OrganizationIncomeExpenseDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights),  2, 'button_OrganizationIncomeExpenseDialog_btnNewExpense', 'OrganizationIncomeExpenseDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights),  3, 'OrganizationIncomeExpenseDialog_Units', 'OrganizationIncomeExpenseDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights),  3, 'OrganizationIncomeExpenseDialog_UnitPrice', 'OrganizationIncomeExpenseDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights),  3, 'OrganizationIncomeExpenseDialog_CollectionFrequency', 'OrganizationIncomeExpenseDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights),  3, 'OrganizationIncomeExpenseDialog_ProductService', 'OrganizationIncomeExpenseDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights),  3, 'OrganizationIncomeExpenseDialog_NoOfUnits', 'OrganizationIncomeExpenseDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights),  3, 'OrganizationIncomeExpenseDialog_AvgCollection', 'OrganizationIncomeExpenseDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights),  3, 'OrganizationIncomeExpenseDialog_ExpenseType', 'OrganizationIncomeExpenseDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				Insert into SecRights Values((Select MAX(RightID)+1 From SecRights),  3, 'OrganizationIncomeExpenseDialog_ExpenseIncurred', 'OrganizationIncomeExpenseDialog', 1, 1000, current_timestamp, 'Approved',' ',' ',' ',' ',' ',0);
				update SeqSecRights set SeqNo = ((Select MAX(RightID) From SecRights));
				
				update SeqSecGroups set SeqNo = ((Select MAX(GrpID) From SecGroups));
				Insert Into secGroups values((Select MAX(GrpID)+1 From secGroups),'ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER','WF Maker for  Organization Income Expense Details',0 ,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGroups values((Select MAX(GrpID)+1 From secGroups),'ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER','WF Approver for Organization Income Expense Details',0,1000,current_timestamp, 'Approved','','','','','',0);
				update SeqSecGroups set SeqNo = ((Select MAX(GrpID) From SecGroups));
				
				update SeqSecGrouprights set SeqNo = ((Select MAX(GrpRightID) From secGrouprights));
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER'),(select RightId from secRights where RightName='menuItem_OrganizationIncomeExpense'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER'),(select RightId from secRights where RightName='menuItem_OrganizationIncomeExpense_Enquiry'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER'),(select RightId from secRights where RightName='button_OrganizationIncomeExpenseList_btnNew'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER'),(select RightId from secRights where RightName='button_OrganizationIncomeExpenseDialog_btnEdit'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER'),(select RightId from secRights where RightName='button_OrganizationIncomeExpenseDialog_btnDelete'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER'),(select RightId from secRights where RightName='button_OrganizationIncomeExpenseDialog_btnSave'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER'),(select RightId from secRights where RightName='button_OrganizationIncomeExpenseDialog_btnNewCoreIncome'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER'),(select RightId from secRights where RightName='button_OrganizationIncomeExpenseDialog_btnNewNonCoreIncome'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER'),(select RightId from secRights where RightName='button_OrganizationIncomeExpenseDialog_btnNewExpense'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER'),(select RightId from secRights where RightName='OrganizationIncomeExpenseDialog_Units'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER'),(select RightId from secRights where RightName='OrganizationIncomeExpenseDialog_UnitPrice'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER'),(select RightId from secRights where RightName='OrganizationIncomeExpenseDialog_CollectionFrequency'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER'),(select RightId from secRights where RightName='OrganizationIncomeExpenseDialog_ProductService'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER'),(select RightId from secRights where RightName='OrganizationIncomeExpenseDialog_NoOfUnits'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER'),(select RightId from secRights where RightName='OrganizationIncomeExpenseDialog_AvgCollection'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER'),(select RightId from secRights where RightName='OrganizationIncomeExpenseDialog_ExpenseType'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER'),(select RightId from secRights where RightName='OrganizationIncomeExpenseDialog_ExpenseIncurred'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER'),(select RightId from secRights where RightName='menuItem_OrganizationIncomeExpense'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER'),(select RightId from secRights where RightName='menuItem_OrganizationIncomeExpense_Enquiry'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				Insert Into secGrouprights values((select MAX(GrpRightID)+1 From secGrouprights),(select GrpId from SecGroups where Grpcode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER'),(select RightId from secRights where RightName='button_OrganizationIncomeExpenseDialog_btnSave'),1,0,1000,current_timestamp, 'Approved','','','','','',0);
				update SeqSecGrouprights set SeqNo = ((Select MAX(GrpRightID) From secGrouprights));
				
				update SeqSecroles set SeqNo = ((Select MAX(roleid) From secroles));
				INSERT INTO secroles VALUES ((select MAX(roleid)+1 From secroles),1,'ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER',   'Workflow Maker',null,0,1000,current_timestamp,null,null,null,null,null,null,0);
				INSERT INTO secroles VALUES ((select MAX(roleid)+1 From secroles),1,'ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER', 'Workflow Approver',null,0,1000,current_timestamp,null,null,null,null,null,null,0);
				update SeqSecroles set SeqNo = ((Select MAX(roleid) From secroles));
				
				update SeqSecRoleGroups set SeqNo = ((Select MAX(RoleGrpID) From secRoleGroups));
				Insert into secRoleGroups values((select MAX(RoleGrpID)+1 From secRoleGroups),(select GrpID from SecGroups where grpCode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER'),(select RoleID from secRoles where RoleCd='ORGANIZATION_SCHOOL_INCOME_EXPENSE_MAKER'),0,1000,current_timestamp,'Approved','','','','','',0);
				Insert into secRoleGroups values((select MAX(RoleGrpID)+1 From secRoleGroups),(select GrpID from SecGroups where grpCode='ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER'),(select RoleID from secRoles where RoleCd='ORGANIZATION_SCHOOL_INCOME_EXPENSE_APPROVER'),0,1000,current_timestamp,'Approved','','','','',0);
				update SeqSecRoleGroups set SeqNo = ((Select MAX(RoleGrpID) From secRoleGroups));
			]]>
		</sql>
	</changeSet>	
	<changeSet id="10" author="lakshmi.n">
	<sql>
		<![CDATA[
		delete from REPORTLIST Where Code = 'Organization';
		 INSERT INTO REPORTLIST  
		 Values ('Organization','Organization',
		 'listheader_CIF.label,listheader_OrgCode.label,listheader_Name.label,listheader_DateOfInc.label',
		 'cif,code,name,date_Incorporation','String,String,String,Date',' ','ReportList04','Organization','Organization',0,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0,0);
		 
		 delete from REPORTLIST Where Code = 'IncomeExpenseHeader';
		 INSERT INTO REPORTLIST  
		 Values ('IncomeExpenseHeader','IncomeExpenseHeader',
		 'listheader_CIF.label,listheader_FinancialYear.label',
		 'custCif,financialYear','String,int',' ','ReportList02','IncomeExpense','IncomeExpense',0,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0,0);
		 
		]]>
	</sql>
</changeSet>
</databaseChangeLog>