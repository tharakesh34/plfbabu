<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PFFBFSQCAudit.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()::timestamp" dbms="postgresql" />

<changeSet id="1" author="Madhubabu">
<sql>
	Delete From smtparameters where sysparmcode = 'AHB_DOWNPAY_AC';
</sql>
</changeSet>

<changeSet id="2" author="satish">
<sql>
delete from SMTHolidayMaster;
delete from SMTWeekendMaster;

</sql>
</changeSet>
<changeSet id="3" author="satish">
		<createView replaceIfExists="true" viewName="Mandates_View">
SELECT		T1.MandateID, T1.CustID,   T1.MandateRef, T1.MandateType,T1.BankBranchID, T1.AccNumber, T1.AccHolderName,
			T1.JointAccHolderName, T1.AccType, T1.OpenMandate, T1.StartDate, T1.ExpiryDate, T1.MaxLimit,
			T1.Periodicity, T1.PhoneCountryCode, T1.PhoneAreaCode, T1.PhoneNumber, T1.Status, T1.ApprovalID		
			, T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId,
			 T1.NextTaskId, T1.RecordType, T1.WorkflowId,T1.Reason,T1.MandateCcy,T2.CustCIF,T2.CustShrtName, T3.BankCode, T3.BranchCode,T3.BranchDesc,T3.MICR,
			 T3.IFSC, T3.City, T4.BankName, T1.InputDate,T1.Active, 0 useExisting,T1.OrgReference
FROM    	Mandates_Temp T1 INNER JOIN
			Customers T2  ON T1.CustID = T2.CustID LEFT OUTER JOIN 
			BankBranches T3 ON T1.BankBranchID = T3.BankBranchID  LEFT OUTER JOIN
			BMTBankDetail T4  ON T3.BankCode=T4.BankCode 
            
UNION ALL

SELECT		T1.MandateID, T1.CustID,   T1.MandateRef, T1.MandateType,T1.BankBranchID, T1.AccNumber, T1.AccHolderName,
			T1.JointAccHolderName, T1.AccType, T1.OpenMandate, T1.StartDate, T1.ExpiryDate, T1.MaxLimit,
			T1.Periodicity, T1.PhoneCountryCode, T1.PhoneAreaCode, T1.PhoneNumber, T1.Status, T1.ApprovalID		
			, T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId,
			 T1.NextTaskId, T1.RecordType, T1.WorkflowId,T1.Reason,T1.MandateCcy,T2.CustCIF,T2.CustShrtName, T3.BankCode, T3.BranchCode,T3.BranchDesc,T3.MICR,
			 T3.IFSC, T3.City, T4.BankName, T1.InputDate,T1.Active,1 useExisting,T1.OrgReference
FROM    	Mandates T1 INNER JOIN
			Customers T2  ON T1.CustID = T2.CustID LEFT OUTER JOIN 
			BankBranches T3 ON T1.BankBranchID = T3.BankBranchID  LEFT OUTER JOIN
			BMTBankDetail T4  ON T3.BankCode=T4.BankCode 
			WHERE     NOT EXISTS (SELECT 1 FROM Mandates_TEMP WHERE MandateID = T1.MandateID)
		</createView>
		<createView replaceIfExists="true" viewName="Mandates_TView">
SELECT		T1.MandateID, T1.CustID,   T1.MandateRef, T1.MandateType,T1.BankBranchID, T1.AccNumber, T1.AccHolderName,
			T1.JointAccHolderName, T1.AccType, T1.OpenMandate, T1.StartDate, T1.ExpiryDate, T1.MaxLimit,
			T1.Periodicity, T1.PhoneCountryCode, T1.PhoneAreaCode, T1.PhoneNumber, T1.Status, T1.ApprovalID		
			, T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId,
			 T1.NextTaskId, T1.RecordType, T1.WorkflowId,T1.Reason,T1.MandateCcy,T2.CustCIF,T2.CustShrtName, T3.BankCode, T3.BranchCode,T3.BranchDesc,T3.MICR,
			 T3.IFSC, T3.City, T4.BankName, T1.InputDate,T1.Active, 0 useExisting,T1.OrgReference
FROM    	Mandates_Temp  T1 INNER JOIN
			Customers  T2  ON T1.CustID = T2.CustID LEFT OUTER JOIN 
			BankBranches  T3 ON T1.BankBranchID = T3.BankBranchID  LEFT OUTER JOIN
			BMTBankDetail  T4  ON T3.BankCode=T4.BankCode 
		</createView>
		<createView replaceIfExists="true" viewName="Mandates_AView">
SELECT		T1.MandateID, T1.CustID,   T1.MandateRef, T1.MandateType,T1.BankBranchID, T1.AccNumber, T1.AccHolderName,
			T1.JointAccHolderName, T1.AccType, T1.OpenMandate, T1.StartDate, T1.ExpiryDate, T1.MaxLimit,
			T1.Periodicity, T1.PhoneCountryCode, T1.PhoneAreaCode, T1.PhoneNumber, T1.Status, T1.ApprovalID		
			, T1.Version , T1.LastMntBy, T1.LastMntOn,T1.RecordStatus, T1.RoleCode, T1.NextRoleCode, T1.TaskId,
			 T1.NextTaskId, T1.RecordType, T1.WorkflowId,T1.Reason,T1.MandateCcy,T2.CustCIF,T2.CustShrtName, T3.BankCode, T3.BranchCode,T3.BranchDesc,T3.MICR,
			 T3.IFSC, T3.City, T4.BankName, T1.InputDate,T1.Active, 1 useExisting,T1.OrgReference
FROM    	Mandates  T1 INNER JOIN
			Customers  T2  ON T1.CustID = T2.CustID LEFT OUTER JOIN 
			BankBranches  T3 ON T1.BankBranchID = T3.BankBranchID  LEFT OUTER JOIN
			BMTBankDetail  T4  ON T3.BankCode=T4.BankCode 
		</createView>
	</changeSet>
	
	<changeSet id="4"  author="Siva" >
	<sql>
			delete from ErrorDetails where ErrorCode = '30577';
		INSERT INTO ErrorDetails VALUES('30577','EN','E','Partial Settlement with more amounts are not allowed as Future Disbursements are being removed.','','Approved','','','','','',0,CURRENT_TIMESTAMP,1000,0);
	</sql>
</changeSet>


<changeSet id="5"  author="DurgaPrasad G" >
<sql>
	UPDATE SeqSecRights SET SeqNo = (SELECT MAX(RightID) FROM SecRights);
	UPDATE SeqSecGroups SET SeqNo = (SELECT MAX(GrpID) FROM SecGroups);
	UPDATE SeqSecRoles SET SeqNo = (SELECT MAX(RoleID) FROM SecRoles);
	UPDATE SeqSecOperations SET SeqNo = (SELECT MAX(OprID) FROM SecOperations);
	UPDATE SeqSecGroupRights SET SeqNo = (SELECT MAX(GrpRightID) FROM SecGroupRights);
	UPDATE SeqSecRoleGroups SET SeqNo = (SELECT MAX(RoleGrpID) FROM SecRoleGroups);
	UPDATE SeqSecOperationRoles SET SeqNo = (SELECT MAX(OprRoleID) FROM SecOperationRoles);

	INSERT INTO SECRIGHTS VALUES((SELECT MAX(RIGHTID) + 1 FROM SECRIGHTS) , 3, 'DISB_HDFC_CHQ_EXPORT','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECRIGHTS VALUES((SELECT MAX(RIGHTID) + 1 FROM SECRIGHTS) , 3, 'DISB_HDFC_NEFT_EXPORT','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECRIGHTS VALUES((SELECT MAX(RIGHTID) + 1 FROM SECRIGHTS) , 3, 'DISB_OTHER_CHQ_EXPORT','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECRIGHTS VALUES((SELECT MAX(RIGHTID) + 1 FROM SECRIGHTS) , 3, 'DISB_OTHER_NEFT_EXPORT','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECRIGHTS VALUES((SELECT MAX(RIGHTID) + 1 FROM SECRIGHTS) , 3, 'MANDATES_EXPORT','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECRIGHTS VALUES((SELECT MAX(RIGHTID) + 1 FROM SECRIGHTS) , 3, 'DISB_RESPONSE','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECRIGHTS VALUES((SELECT MAX(RIGHTID) + 1 FROM SECRIGHTS) , 3, 'MANDATES_IMPORT','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECRIGHTS VALUES((SELECT MAX(RIGHTID) + 1 FROM SECRIGHTS) , 3, 'ALM_REQUEST','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECRIGHTS VALUES((SELECT MAX(RIGHTID) + 1 FROM SECRIGHTS) , 3, 'CONTROL_DUMP_REQUEST','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECRIGHTS VALUES((SELECT MAX(RIGHTID) + 1 FROM SECRIGHTS) , 3, 'POSIDEX_UPDATE_EODREQUEST','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECRIGHTS VALUES((SELECT MAX(RIGHTID) + 1 FROM SECRIGHTS) , 3, 'POSIDEX_CUSTOMER_UPDATEREQUEST','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);

	INSERT INTO SECGROUPS VALUES((SELECT MAX(GRPID)+1 FROM SECGROUPS),'DISB_HDFC_CHQ_EXPORT','Disbursement hdfc chq export',0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECGROUPS VALUES((SELECT MAX(GRPID)+1 FROM SECGROUPS),'DISB_HDFC_NEFT_EXPORT','Disbursement hdfc neft export',0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECGROUPS VALUES((SELECT MAX(GRPID)+1 FROM SECGROUPS),'DISB_OTHER_CHQ_EXPORT','Disbursement other  export',0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECGROUPS VALUES((SELECT MAX(GRPID)+1 FROM SECGROUPS),'DISB_OTHER_NEFT_EXPORT','Disbursement other  neft export',0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECGROUPS VALUES((SELECT MAX(GRPID)+1 FROM SECGROUPS),'MANDATES_EXPORT','Mandates  download',0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECGROUPS VALUES((SELECT MAX(GRPID)+1 FROM SECGROUPS),'DISB_RESPONSE','Disbursement response import',0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECGROUPS VALUES((SELECT MAX(GRPID)+1 FROM SECGROUPS),'MANDATES_IMPORT','Mandate response import',0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECGROUPS VALUES((SELECT MAX(GRPID)+1 FROM SECGROUPS),'ALM_REQUEST','ALM Request',0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECGROUPS VALUES((SELECT MAX(GRPID)+1 FROM SECGROUPS),'CONTROL_DUMP_REQUEST','Control dump request',0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECGROUPS VALUES((SELECT MAX(GRPID)+1 FROM SECGROUPS),'POSIDEX_UPDATE_EODREQUEST','Posidex update eodrequest',0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECGROUPS VALUES((SELECT MAX(GRPID)+1 FROM SECGROUPS),'POSIDEX_CUSTOMER_UPDATEREQUEST','Posidex customer updaterequest',0,1000,CURRENT_TIMESTAMP,'','','','','','',0);

	INSERT INTO SECGROUPRIGHTS VALUES ((SELECT MAX(GRPRIGHTID) +1  FROM SECGROUPRIGHTS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='DISB_HDFC_CHQ_EXPORT'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME ='DISB_HDFC_CHQ_EXPORT'), 1,0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECGROUPRIGHTS VALUES ((SELECT MAX(GRPRIGHTID) +1  FROM SECGROUPRIGHTS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='DISB_HDFC_NEFT_EXPORT'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME ='DISB_HDFC_NEFT_EXPORT'), 1,0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECGROUPRIGHTS VALUES ((SELECT MAX(GRPRIGHTID) +1  FROM SECGROUPRIGHTS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='DISB_OTHER_CHQ_EXPORT'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME ='DISB_OTHER_CHQ_EXPORT'), 1,0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECGROUPRIGHTS VALUES ((SELECT MAX(GRPRIGHTID) +1  FROM SECGROUPRIGHTS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='DISB_OTHER_NEFT_EXPORT'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME ='DISB_OTHER_NEFT_EXPORT'), 1,0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECGROUPRIGHTS VALUES ((SELECT MAX(GRPRIGHTID) +1  FROM SECGROUPRIGHTS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='MANDATES_EXPORT'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME ='MANDATES_EXPORT'), 1,0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECGROUPRIGHTS VALUES ((SELECT MAX(GRPRIGHTID) +1  FROM SECGROUPRIGHTS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='DISB_RESPONSE'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME ='DISB_RESPONSE'), 1,0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECGROUPRIGHTS VALUES ((SELECT MAX(GRPRIGHTID) +1  FROM SECGROUPRIGHTS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='MANDATES_IMPORT'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME ='MANDATES_IMPORT'), 1,0,1000,CURRENT_TIMESTAMP,'','','','','','',0);																																		
	INSERT INTO SECGROUPRIGHTS VALUES ((SELECT MAX(GRPRIGHTID) +1  FROM SECGROUPRIGHTS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='ALM_REQUEST'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME ='ALM_REQUEST'), 1,0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECGROUPRIGHTS VALUES ((SELECT MAX(GRPRIGHTID) +1  FROM SECGROUPRIGHTS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='CONTROL_DUMP_REQUEST'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME ='CONTROL_DUMP_REQUEST'), 1,0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECGROUPRIGHTS VALUES ((SELECT MAX(GRPRIGHTID) +1  FROM SECGROUPRIGHTS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='POSIDEX_UPDATE_EODREQUEST'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME ='POSIDEX_UPDATE_EODREQUEST'), 1,0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECGROUPRIGHTS VALUES ((SELECT MAX(GRPRIGHTID) +1  FROM SECGROUPRIGHTS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='POSIDEX_CUSTOMER_UPDATEREQUEST'), (SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME ='POSIDEX_CUSTOMER_UPDATEREQUEST'), 1,0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
			
	INSERT INTO SECROLES VALUES((SELECT MAX(ROLEID)+1 FROM SECROLES),1,'DISB_HDFC_CHQ_EXPORT','Disbursement hdfc chq download','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECROLES VALUES((SELECT MAX(ROLEID)+1 FROM SECROLES),1,'DISB_HDFC_NEFT_EXPORT','Disbursement hdfc neft download','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECROLES VALUES((SELECT MAX(ROLEID)+1 FROM SECROLES),1,'DISB_OTHER_CHQ_EXPORT','Disbursement other chq download','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECROLES VALUES((SELECT MAX(ROLEID)+1 FROM SECROLES),1,'DISB_OTHER_NEFT_EXPORT','Disbursement other neft download','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECROLES VALUES((SELECT MAX(ROLEID)+1 FROM SECROLES),1,'MANDATES_EXPORT','Mandates download','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECROLES VALUES((SELECT MAX(ROLEID)+1 FROM SECROLES),1,'DISB_RESPONSE','Disbursement upload','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECROLES VALUES((SELECT MAX(ROLEID)+1 FROM SECROLES),1,'MANDATES_IMPORT','Mandate upload','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECROLES VALUES((SELECT MAX(ROLEID)+1 FROM SECROLES),1,'ALM_REQUEST','ALM Request','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECROLES VALUES((SELECT MAX(ROLEID)+1 FROM SECROLES),1,'CONTROL_DUMP_REQUEST','Control dump request','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECROLES VALUES((SELECT MAX(ROLEID)+1 FROM SECROLES),1,'POSIDEX_UPDATE_EODREQUEST','Posidex update eodrequest','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECROLES VALUES((SELECT MAX(ROLEID)+1 FROM SECROLES),1,'POSIDEX_CUSTOMER_UPDATEREQUEST','Posidex customer updaterequest','FileDBInterface',1,1000,CURRENT_TIMESTAMP,'','','','','','',0);

	INSERT INTO SECROLEGROUPS VALUES ((SELECT MAX(ROLEGRPID)+1 FROM SECROLEGROUPS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='DISB_HDFC_CHQ_EXPORT'),(SELECT ROLEID FROM SECROLES WHERE ROLECD='DISB_HDFC_CHQ_EXPORT'),0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECROLEGROUPS VALUES ((SELECT MAX(ROLEGRPID)+1 FROM SECROLEGROUPS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='DISB_HDFC_NEFT_EXPORT'),(SELECT ROLEID FROM SECROLES WHERE ROLECD='DISB_HDFC_NEFT_EXPORT'),0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECROLEGROUPS VALUES ((SELECT MAX(ROLEGRPID)+1 FROM SECROLEGROUPS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='DISB_OTHER_CHQ_EXPORT'),(SELECT ROLEID FROM SECROLES WHERE ROLECD='DISB_OTHER_CHQ_EXPORT'),0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECROLEGROUPS VALUES ((SELECT MAX(ROLEGRPID)+1 FROM SECROLEGROUPS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='DISB_OTHER_NEFT_EXPORT'),(SELECT ROLEID FROM SECROLES WHERE ROLECD='DISB_OTHER_NEFT_EXPORT'),0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECROLEGROUPS VALUES ((SELECT MAX(ROLEGRPID)+1 FROM SECROLEGROUPS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='MANDATES_EXPORT'),(SELECT ROLEID FROM SECROLES WHERE ROLECD='MANDATES_EXPORT'),0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECROLEGROUPS VALUES ((SELECT MAX(ROLEGRPID)+1 FROM SECROLEGROUPS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='DISB_RESPONSE'),(SELECT ROLEID FROM SECROLES WHERE ROLECD='DISB_RESPONSE'),0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECROLEGROUPS VALUES ((SELECT MAX(ROLEGRPID)+1 FROM SECROLEGROUPS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='MANDATES_IMPORT'),(SELECT ROLEID FROM SECROLES WHERE ROLECD='MANDATES_IMPORT'),0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECROLEGROUPS VALUES ((SELECT MAX(ROLEGRPID)+1 FROM SECROLEGROUPS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='ALM_REQUEST'), (SELECT ROLEID FROM SECROLES WHERE ROLECD='ALM_REQUEST'),0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECROLEGROUPS VALUES ((SELECT MAX(ROLEGRPID)+1 FROM SECROLEGROUPS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='CONTROL_DUMP_REQUEST'), (SELECT ROLEID FROM SECROLES WHERE ROLECD='CONTROL_DUMP_REQUEST'),0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECROLEGROUPS VALUES ((SELECT MAX(ROLEGRPID)+1 FROM SECROLEGROUPS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='POSIDEX_UPDATE_EODREQUEST'), (SELECT ROLEID FROM SECROLES WHERE ROLECD='POSIDEX_UPDATE_EODREQUEST'),0,1000,CURRENT_TIMESTAMP,'','','','','','',0);
	INSERT INTO SECROLEGROUPS VALUES ((SELECT MAX(ROLEGRPID)+1 FROM SECROLEGROUPS),(SELECT GRPID FROM SECGROUPS WHERE GRPCODE ='POSIDEX_CUSTOMER_UPDATEREQUEST'), (SELECT ROLEID FROM SECROLES WHERE ROLECD='POSIDEX_CUSTOMER_UPDATEREQUEST'),0,1000,CURRENT_TIMESTAMP,'','','','','','',0);

	INSERT INTO SecOperations VALUES ((select MAX(OprID)+1 from SecOperations),'DISB_HDFC_CHQ_EXPORT','Disbursement hdfc chq export',1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 );
	INSERT INTO SecOperations VALUES ((select MAX(OprID)+1 from SecOperations),'DISB_HDFC_NEFT_EXPORT','Disbursement hdfc neft export',1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 );
	INSERT INTO SecOperations VALUES ((select MAX(OprID)+1 from SecOperations),'DISB_OTHER_CHQ_EXPORT','Disbursement other  export',1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 );
	INSERT INTO SecOperations VALUES ((select MAX(OprID)+1 from SecOperations),'DISB_OTHER_NEFT_EXPORT','Disbursement other  neft export',1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 );
	INSERT INTO SecOperations VALUES ((select MAX(OprID)+1 from SecOperations),'MANDATES_EXPORT','Mandates  download',1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 );
	INSERT INTO SecOperations VALUES ((select MAX(OprID)+1 from SecOperations),'DISB_RESPONSE','Disbursement response import',1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 );
	INSERT INTO SecOperations VALUES ((select MAX(OprID)+1 from SecOperations),'MANDATES_IMPORT','Mandate response import',1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 );
	INSERT INTO SecOperations VALUES ((select MAX(OprID)+1 from SecOperations),'ALM_REQUEST','ALM Request',1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 );
	INSERT INTO SecOperations VALUES ((select MAX(OprID)+1 from SecOperations),'CONTROL_DUMP_REQUEST','Control dump request',1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 );
	INSERT INTO SecOperations VALUES ((select MAX(OprID)+1 from SecOperations),'POSIDEX_UPDATE_EODREQUEST','Posidex update eodrequest',1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 );
	INSERT INTO SecOperations VALUES ((select MAX(OprID)+1 from SecOperations),'POSIDEX_CUSTOMER_UPDATEREQUEST','Posidex customer updaterequest',1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0 );

	INSERT INTO SecOperationRoles values ((select MAX(OprRoleID)+1 from SecOperationRoles), (select OprID from SecOperations WHERE OprCode='DISB_HDFC_CHQ_EXPORT'), (select RoleID from SecRoles where RoleCd='DISB_HDFC_CHQ_EXPORT'),1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0)
	INSERT INTO SecOperationRoles values ((select MAX(OprRoleID)+1 from SecOperationRoles), (select OprID from SecOperations WHERE OprCode='DISB_HDFC_NEFT_EXPORT'), (select RoleID from SecRoles where RoleCd='DISB_HDFC_NEFT_EXPORT'),1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0)
	INSERT INTO SecOperationRoles values ((select MAX(OprRoleID)+1 from SecOperationRoles), (select OprID from SecOperations WHERE OprCode='DISB_OTHER_CHQ_EXPORT'), (select RoleID from SecRoles where RoleCd='DISB_OTHER_CHQ_EXPORT'),1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0)
	INSERT INTO SecOperationRoles values ((select MAX(OprRoleID)+1 from SecOperationRoles), (select OprID from SecOperations WHERE OprCode='DISB_OTHER_NEFT_EXPORT'), (select RoleID from SecRoles where RoleCd='DISB_OTHER_NEFT_EXPORT'),1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0)
	INSERT INTO SecOperationRoles values ((select MAX(OprRoleID)+1 from SecOperationRoles), (select OprID from SecOperations WHERE OprCode='MANDATES_EXPORT'), (select RoleID from SecRoles where RoleCd='MANDATES_EXPORT'),1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0)
	INSERT INTO SecOperationRoles values ((select MAX(OprRoleID)+1 from SecOperationRoles), (select OprID from SecOperations WHERE OprCode='DISB_RESPONSE'), (select RoleID from SecRoles where RoleCd='DISB_RESPONSE'),1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0)
	INSERT INTO SecOperationRoles values ((select MAX(OprRoleID)+1 from SecOperationRoles), (select OprID from SecOperations WHERE OprCode='MANDATES_IMPORT'), (select RoleID from SecRoles where RoleCd='MANDATES_IMPORT'),1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0)
	INSERT INTO SecOperationRoles values ((select MAX(OprRoleID)+1 from SecOperationRoles), (select OprID from SecOperations WHERE OprCode='ALM_REQUEST'), (select RoleID from SecRoles where RoleCd='ALM_REQUEST'),1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0)
	INSERT INTO SecOperationRoles values ((select MAX(OprRoleID)+1 from SecOperationRoles), (select OprID from SecOperations WHERE OprCode='CONTROL_DUMP_REQUEST'), (select RoleID from SecRoles where RoleCd='CONTROL_DUMP_REQUEST'),1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0)
	INSERT INTO SecOperationRoles values ((select MAX(OprRoleID)+1 from SecOperationRoles), (select OprID from SecOperations WHERE OprCode='POSIDEX_UPDATE_EODREQUEST'), (select RoleID from SecRoles where RoleCd='POSIDEX_UPDATE_EODREQUEST'),1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0)
	INSERT INTO SecOperationRoles values ((select MAX(OprRoleID)+1 from SecOperationRoles), (select OprID from SecOperations WHERE OprCode='POSIDEX_CUSTOMER_UPDATEREQUEST'), (select RoleID from SecRoles where RoleCd='POSIDEX_CUSTOMER_UPDATEREQUEST'),1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0)

	UPDATE SeqSecRights SET SeqNo = (SELECT MAX(RightID) FROM SecRights);
	UPDATE SeqSecGroups SET SeqNo = (SELECT MAX(GrpID) FROM SecGroups);
	UPDATE SeqSecRoles SET SeqNo = (SELECT MAX(RoleID) FROM SecRoles);
	UPDATE SeqSecOperations SET SeqNo = (SELECT MAX(OprID) FROM SecOperations);
	UPDATE SeqSecGroupRights SET SeqNo = (SELECT MAX(GrpRightID) FROM SecGroupRights);
	UPDATE SeqSecRoleGroups SET SeqNo = (SELECT MAX(RoleGrpID) FROM SecRoleGroups);
	UPDATE SeqSecOperationRoles SET SeqNo = (SELECT MAX(OprRoleID) FROM SecOperationRoles);
</sql>
</changeSet>

     	 	  	
<changeSet id="6" author="DurgaPrasad G" dbms="oracle">	
   		<sql splitStatements="false">
     		 begin
         	 execute immediate 'CREATE SEQUENCE SEQ_DATA_ENGINE_PROCESS_LOG START WITH 1 INCREMENT BY 1 MAXVALUE 9223372036854775807 NOCYCLE';  
     		 end;  
     	 </sql>
 </changeSet>
 
 <changeSet id="7" author="DurgaPrasad G" dbms="postgresql">	
   		<sql splitStatements="false">
   			do $$
			 begin
			 execute 'CREATE SEQUENCE SEQ_DATA_ENGINE_PROCESS_LOG START  1 INCREMENT BY 1 ';  
			 end;  
			$$;
	    </sql>
 </changeSet>
 
 <changeSet id="8" author="DurgaPrasad G" dbms="mssql">
		<sql splitStatements="false">
			CREATE TABLE SEQ_DATA_ENGINE_PROCESS_LOG(
			SeqNo 				bigint IDENTITY(1,1) NOT NULL,
			Value 				int NOT NULL
			);	
		</sql>
</changeSet>



<changeSet id="9" author="DurgaPrasad G">
	<dropTable tableName="ALM" />
</changeSet>

<changeSet id="10" author="DurgaPrasad G">
<createTable tableName="ALM">
			<column name="AGREEMENTID" type="Number(8)">
				<constraints nullable="false" />
			</column>
			<column name="AGREEMENTNO" type="varchar(20)">
				<constraints nullable="false" />
			</column>
			<column name="PRODUCTFLAG" type="varchar(12)">
				<constraints nullable="false" />
			</column>
			<column name="NPA_STAGEID" type="varchar(12)"/>
			<column name="INSTLAMT" type="NUMBER (16,2)"/>
			<column name="PRINCOMP" type="NUMBER (16,2)"/>
			<column name="INTCOMP" type="NUMBER (16,2)"/>
			<column name="DUEDATE" type="datetime" />
			<column name="ACCRUEDAMT" type="NUMBER (16,2)"/>
			<column name="ACCRUEDON" type="datetime" />
			<column name="CUMULATIVEACCRUALAMT" type="NUMBER (16,2)"/>
			<column name="ADVFLAG" type="char(1)"/>
</createTable>
</changeSet>

<changeSet  id="11" author="DurgaPrasad G" >
<createView viewName="INT_ALM_VIEW" replaceIfExists="true">
	Select Right(F.FinReference,8) AGREEMENTID,F.ApplicationNo AGREEMENTNO,F.FinType PRODUCTFLAG,'' NPA_STAGEID ,
	(FP.TotalPriBal+Fp.TotalPftBal)/CcyMinorCcyUnits INSTLAMT,FP.TotalPriBal/CcyMinorCcyUnits PRINCOMP,Fp.TotalPftBal/CcyMinorCcyUnits INTCOMP,Fp.FirstRepayDate DUEDATE,
	Fp.AccruePft/CcyMinorCcyUnits ACCRUEDAMT,NULL ACCRUEDON,Fp.AccruePft/CcyMinorCcyUnits CUMULATIVE_ACCRUAL_AMT,'N' ADVFLAG
	from FinanceMain F
	Inner join FinPftDetails FP on Fp.FinReference=F.FinReference
	Inner Join RMTCurrencies RC on RC.CcyCode=F.FinCcy
</createView>
</changeSet>


<changeSet id="12" author="DurgaPrasad G">
	<dropTable tableName="ALM" />
</changeSet>

<changeSet id="13" author="DurgaPrasad G">
<createTable tableName="ALM">
			<column name="AGREEMENTID" type="Number(8)">
				<constraints nullable="false" />
			</column>
			<column name="AGREEMENTNO" type="varchar(20)">
				<constraints nullable="false" />
			</column>
			<column name="PRODUCTFLAG" type="varchar(12)">
				<constraints nullable="false" />
			</column>
			<column name="NPA_STAGEID" type="varchar(12)"/>
			<column name="INSTLAMT" type="NUMBER (16,2)"/>
			<column name="PRINCOMP" type="NUMBER (16,2)"/>
			<column name="INTCOMP" type="NUMBER (16,2)"/>
			<column name="DUEDATE" type="datetime" />
			<column name="ACCRUEDAMT" type="NUMBER (16,2)"/>
			<column name="ACCRUEDON" type="datetime" />
			<column name="CUMULATIVE_ACCRUAL_AMT" type="NUMBER (16,2)"/>
			<column name="ADVFLAG" type="char(1)"/>
</createTable>
</changeSet>


<changeSet  id="15" author="Siva" >
<createView viewName="CollateralAssignment_View" replaceIfExists="true">
	
 Select CA.Module, CA.Reference, CA.CollateralRef, CA.AssignPerc, CS.CollateralCcy , 
  CS.CollateralValue,CS.BankValuation,	(TotAssignPerc-CA.AssignPerc)TotAssignPerc, 
  Coalesce((FinCurrAssetValue-DownPayment+FeeChargeAmt+InsuranceAmt-FinRepaymentAmount),CmtUtilizedAmount)UtilizedAmount, CA.Version,
   CA.LastMntBy, CA.LastMntOn,   CA.RecordStatus, CA.RoleCode, CA.NextRoleCode, CA.TaskId, 
   CA.NextTaskId, CA.RecordType, CA.WorkflowId  from CollateralAssignment_Temp CA 
   inner join CollateralSetUp CS on CA.CollateralRef = CS.CollateralRef   Left join 
   ( 	Select CollateralRef,SUM(AssignPerc) TotAssignPerc from (Select Reference,CollateralRef, AssignPerc 
     from CollateralAssignment_Temp	union Select Reference,CollateralRef, AssignPerc  from CollateralAssignment CA  
     where NOT EXISTS (SELECT 1 FROM CollateralAssignment_Temp  WHERE CollateralRef = CA.CollateralRef and
       Module =CA.Module and Reference=CA.Reference))T1 group by CollateralRef)T   
       on T.CollateralRef = CA.CollateralRef   Left Join FinanceMain_Temp FM on CA.Reference = FM.FinReference
        left join Commitments_Temp CM on CM.CmtReference =CA.Reference
        union all 
  Select CA.Module, CA.Reference, CA.CollateralRef, CA.AssignPerc, CS.CollateralCcy , 
  CS.CollateralValue,CS.BankValuation,	(TotAssignPerc-CA.AssignPerc)TotAssignPerc, 
  Coalesce((FinCurrAssetValue-DownPayment+FeeChargeAmt+InsuranceAmt-FinRepaymentAmount),CmtUtilizedAmount)UtilizedAmount, CA.Version,
   CA.LastMntBy, CA.LastMntOn,   CA.RecordStatus, CA.RoleCode, CA.NextRoleCode, CA.TaskId, 
   CA.NextTaskId, CA.RecordType, CA.WorkflowId  from CollateralAssignment CA 
   inner join CollateralSetUp CS on CA.CollateralRef = CS.CollateralRef   Left join 
   ( 	Select CollateralRef,SUM(AssignPerc) TotAssignPerc from (Select Reference,CollateralRef, AssignPerc 
     from CollateralAssignment_Temp	union Select Reference,CollateralRef, AssignPerc  from CollateralAssignment CA  
     where NOT EXISTS (SELECT 1 FROM CollateralAssignment_Temp  WHERE CollateralRef = CA.CollateralRef and
       Module =CA.Module and Reference=CA.Reference))T1 group by CollateralRef)T   
       on T.CollateralRef = CA.CollateralRef   Left Join FinanceMain FM on CA.Reference = FM.FinReference
        left join Commitments CM on CM.CmtReference =CA.Reference
	  WHERE     NOT EXISTS
 (SELECT 1 FROM CollateralAssignment_Temp 
  WHERE CollateralRef = CA.CollateralRef and Module =CA.Module and Reference=CA.Reference)

</createView>
</changeSet>

<changeSet  id="16" author="Siva" >
<createView viewName="CollateralAssignment_TView" replaceIfExists="true">
	
 Select CA.Module, CA.Reference, CA.CollateralRef, CA.AssignPerc, CS.CollateralCcy , 
  CS.CollateralValue,CS.BankValuation,	(TotAssignPerc-CA.AssignPerc)TotAssignPerc, 
  (FinCurrAssetValue-DownPayment+FeeChargeAmt+InsuranceAmt-FinRepaymentAmount) UtilizedAmount, CA.Version,
   CA.LastMntBy, CA.LastMntOn,   CA.RecordStatus, CA.RoleCode, CA.NextRoleCode, CA.TaskId, 
   CA.NextTaskId, CA.RecordType, CA.WorkflowId  from CollateralAssignment_Temp CA 
   inner join CollateralSetUp CS on CA.CollateralRef = CS.CollateralRef   Left join 
   ( 	Select CollateralRef,SUM(AssignPerc) TotAssignPerc from (Select Reference,CollateralRef, AssignPerc 
     from CollateralAssignment_Temp	union Select Reference,CollateralRef, AssignPerc  from CollateralAssignment CA  
     where NOT EXISTS (SELECT 1 FROM CollateralAssignment_Temp  WHERE CollateralRef = CA.CollateralRef and
       Module =CA.Module and Reference=CA.Reference))T1 group by CollateralRef)T   
       on T.CollateralRef = CA.CollateralRef   Left Join FinanceMain_Temp FM on CA.Reference = FM.FinReference  


</createView>
</changeSet>

<changeSet  id="17" author="Siva" >
<createView viewName="CollateralAssignment_AView" replaceIfExists="true">
	
  Select CA.Module, CA.Reference, CA.CollateralRef, CA.AssignPerc, CS.CollateralCcy , 
  CS.CollateralValue,CS.BankValuation,	(TotAssignPerc-CA.AssignPerc)TotAssignPerc, 
  Coalesce((FinCurrAssetValue-DownPayment+FeeChargeAmt+InsuranceAmt-FinRepaymentAmount),CmtUtilizedAmount)UtilizedAmount, CA.Version,
   CA.LastMntBy, CA.LastMntOn,   CA.RecordStatus, CA.RoleCode, CA.NextRoleCode, CA.TaskId, 
   CA.NextTaskId, CA.RecordType, CA.WorkflowId  from CollateralAssignment CA 
   inner join CollateralSetUp CS on CA.CollateralRef = CS.CollateralRef   Left join 
   ( 	Select CollateralRef,SUM(AssignPerc) TotAssignPerc from (Select Reference,CollateralRef, AssignPerc 
     from CollateralAssignment_Temp	union Select Reference,CollateralRef, AssignPerc  from CollateralAssignment CA  
     where NOT EXISTS (SELECT 1 FROM CollateralAssignment_Temp  WHERE CollateralRef = CA.CollateralRef and
       Module =CA.Module and Reference=CA.Reference))T1 group by CollateralRef)T   
       on T.CollateralRef = CA.CollateralRef   Left Join FinanceMain FM on CA.Reference = FM.FinReference
        left join Commitments CM on CM.CmtReference =CA.Reference

</createView>
</changeSet>

<changeSet id="18" author="DurgaPrasad G">
	<createTable tableName="PSX_UCIN_REVERSE_FEED">
				<column name="CUSTOMER_NO" type="int"/>
				<column name="DATASOURCE" type="varchar(3)"/>
				<column name="UCIN_NO" type="varchar(20)">
					<constraints nullable="false" />
				</column>
				<column name="SEGMENT" type="varchar(5)">
					<constraints nullable="false" />
				</column>
				<column name="BATCH_ID" type="varchar(12)"/>
				<column name="BASE_TYPE_FLAG" type="varchar(20)">
					<constraints nullable="false" />
				</column>
				<column name="PSX_BATCH_ID" type="bigint" />
				<column name="PROCESSED_FLAG" type="char(1)">
					<constraints nullable="false" />
				</column>
				<column name="CUSTOMER_ID"  type="varchar(20)" />
				<column name="SOURCE_SYS_ID" type="int"/>
	</createTable>
</changeSet>
</databaseChangeLog>
