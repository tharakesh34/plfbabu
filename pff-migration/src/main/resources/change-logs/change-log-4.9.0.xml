<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value="" dbms="oracle" />
	<property name="add.schema" value="" dbms="postgresql" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PLFAVANSEQC.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()" dbms="postgresql" />


	 <changeSet id="pre_run_for_pgp" author="Jayant" runAlways="true"
		dbms="postgresql">
		<sql>
			Set search_path = plf,public,pg_catalog;
		</sql>
	</changeSet>
	
	<changeSet id = "1" author = "Siva">
		<comment> Profit Fraction setting based on Parameter </comment>
		<sql>
			Delete From SMTparameters where SYSPARMCODE = 'ROUND_ADJ_METHOD';
	
			INSERT INTO SMTparameters values('ROUND_ADJ_METHOD', 'Schedule Rounding Fraction Adjustment Method', 'String', 0, 'ADJ_NEXT_INST', 20, 0, NULL, NULL, 
				'Schedule Rounding Fraction Adjustment Method', 1, 1000, CURRENT_TIMESTAMP, 'Approved','','','','','',0);
		</sql>
	</changeSet>
	
	
	<changeSet id="01" author="Durgaprasad.g">
		<addColumn tableName="RMTFinanceTypes" >
			<column name="PartiallySecured" type="boolean" defaultValueBoolean="false"/>
		</addColumn>
	</changeSet>
	
	<changeSet id="02" author="Durgaprasad.g">
		<addColumn tableName="RMTFinanceTypes_temp" >
			<column name="PartiallySecured" type="boolean" defaultValueBoolean="false"/>
		</addColumn>
	</changeSet>
	
	<changeSet id="03" author="Durgaprasad.g">
		<createView viewName="rmtfinancetypes_view" replaceIfExists="true">
			 SELECT t1.fintype,
			    t1.fincategory,
			    t1.fintypedesc,
			    t1.finccy,
			    t1.findayscaltype,
			    t1.finactype,
			    t1.fincontingentactype,
			    t1.finisgenref,
			    t1.finmaxamount,
			    t1.finminamount,
			    t1.finisopennewfinac,
			    t1.findftstmtfrq,
			    t1.finisalwmd,
			    t1.finschdmthd,
			    t1.finisalwgrace,
			    t1.finhistretension,
			    t1.equalrepayment,
			    t1.finratetype,
			    t1.finbaserate,
			    t1.finsplrate,
			    t1.finintrate,
			    t1.finminrate,
			    t1.finmaxrate,
			    t1.findftintfrq,
			    t1.finisintcpz,
			    t1.fincpzfrq,
			    t1.finisrvwalw,
			    t1.finrvwfrq,
			    t1.fingrcratetype,
			    t1.fingrcbaserate,
			    t1.fingrcsplrate,
			    t1.fingrcintrate,
			    t1.fingrcminrate,
			    t1.fingrcmaxrate,
			    t1.fingrcdftintfrq,
			    t1.fingrcisintcpz,
			    t1.fingrccpzfrq,
			    t1.fingrcisrvwalw,
			    t1.fingrcrvwfrq,
			    t1.finminterm,
			    t1.finmaxterm,
			    t1.findftterms,
			    t1.finrpyfrq,
			    t1.finrepaymethod,
			    t1.finisalwpartialrpy,
			    t1.finisalwdifferment,
			    t1.finmaxdifferment,
			    t1.finisalwearlyrpy,
			    t1.finisalwearlysettle,
			    t1.finodrpytries,
			    t1.finearlypayrule,
			    t1.finearlysettlerule,
			    t1.findepositrestrictedto,
			    t1.finaebuyorinception,
			    t1.finaesellormaturity,
			    t1.finisactive,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t1.stepfinance,
			    t1.steppingmandatory,
			    t1.alwmanualsteps,
			    t1.alwdsteppolicies,
			    t1.dftsteppolicy,
			    t4.actypedesc AS lovdescfincontingentactypename,
			    t5.actypedesc AS lovdescfinactypename,
			    t1.finisdwpayrequired,
			    t1.finrvwrateapplfor,
			    t1.finalwratechangeanydate,
			    t1.finisintcpzatgrcend,
			    t1.finelgrulecode,
			    t1.limitelgrulecode,
			    t1.finschcalcodeonrvw,
			    t1.alwplandeferment,
			    t1.plandefercount,
			    t1.finassettype,
			    t1.pftpayactype,
			    t1.finisopenpftpayacc,
			    t31.actypedesc AS lovdescpftpayactypename,
			    t1.finisalwgrcrepay,
			    t1.fingrcschdmthd,
			    t1.fingrcmargin,
			    t1.finmargin,
			    t1.finscheduleon,
			    t1.fingrcscheduleon,
			    t1.fincommitmentreq,
			    t1.fincollateralreq,
			    t1.findepreciationreq,
			    t1.findepreciationfrq,
			    t1.finbankcontingentactype,
			    t1.finprovisionactype,
			    t38.actypedesc AS lovdescfinbankcontactypename,
			    t39.actypedesc AS lovdescfinprovisionactypename,
			    t1.allowriainvestment,
			    t1.overridelimit,
			    t1.limitrequired,
			    t1.fincommitmentovrride,
			    t1.fincollateralovrride,
			    t1.finpftunchanged,
			    t1.applyodpenalty,
			    t1.odincgrcdays,
			    t1.odchargetype,
			    t1.odgracedays,
			    t1.odchargecalon,
			    t1.odchargeamtorperc,
			    t1.odallowwaiver,
			    t1.odmaxwaiverperc,
			    t1.findivision,
			    t48.divisioncodedesc AS lovdescfindivisionname,
			    t48.entitycode AS lovdescentitycode,
			    t1.finsuspactype,
			    t49.actypedesc AS lovdescfinsuspactypename,
			    t1.product,
			    t1.startdate,
			    t1.enddate,
			    t1.allowdownpaypgm,
			    t1.fintypedesc AS lovdescpromofintypedesc,
			    t1.remarks,
			    t1.alwearlypaymethods,
			    t1.pastduepftcalmthd,
			    t1.pastduepftmargin,
			    t1.alwadvancerent,
			    t1.grcadvbaserate,
			    t1.grcadvmargin,
			    t1.grcadvpftrate,
			    t1.rpyadvbaserate,
			    t1.rpyadvmargin,
			    t1.rpyadvpftrate,
			    t1.rolloverfinance,
			    t1.rolloverfrq,
			    t1.downpayrule,
			    t59.rulecode AS downpayruledesc,
			    t1.finsusptrigger,
			    t1.finsuspremarks,
			    t1.alwmultipartydisb,
			    t1.collateraltype,
			    t1.tdsapplicable,
			    t1.manualschedule,
			    t1.applygrcpricing,
			    t1.grcpricingmethod,
			    t1.applyrpypricing,
			    t1.rpypricingmethod,
			    t1.rpyhierarchy,
			    t67.rulecode AS grcpricingmethoddesc,
			    t68.rulecode AS rpypricingmethoddesc,
			    t1.droplineod,
			    t1.droppingmethod,
			    t1.ratechganyday,
			    t1.finrepaypftonfrq,
			    t1.alwbpi,
			    t1.bpitreatment,
			    t1.pftdueschon,
			    t1.planemihalw,
			    t1.planemihmethod,
			    t1.planemihmaxperyear,
			    t1.planemihmax,
			    t1.planemihlockperiod,
			    t1.planemicpz,
			    t1.unplanemihlockperiod,
			    t1.unplanemicpz,
			    t1.reagecpz,
			    t1.fddlockperiod,
			    t1.alwdrpymethods,
			    t1.maxunplannedemi,
			    t1.maxreageholidays,
			    t1.roundingmode,
			    t1.roundingtarget,
			    t1.frequencydays,
			    t1.quickdisb,
			    t1.alwmaxdisbcheckreq,
			    t1.alwreage,
			    t1.alwunplanemiholiday,
			    t1.profitcenterid,
			    t69.profitcentercode,
			    t69.profitcenterdesc,
			    t1.productcategory,
			    t2.productdesc AS fincategorydesc,
			    t1.developerfinance,
			    t1.costoffunds,
			    t1.chequecapturereq,
			    t1.finltvcheck,
			    t1.PartiallySecured
			   FROM rmtfinancetypes_temp t1
			     LEFT JOIN bmtproduct t2 ON t1.fincategory = t2.productcode
			     LEFT JOIN rmtaccounttypes t4 ON t1.fincontingentactype = t4.actype
			     LEFT JOIN rmtaccounttypes t38 ON t1.finbankcontingentactype = t38.actype
			     LEFT JOIN rmtaccounttypes t39 ON t1.finprovisionactype = t39.actype
			     LEFT JOIN rmtaccounttypes t5 ON t1.finactype = t5.actype
			     LEFT JOIN rmtaccounttypes t31 ON t1.pftpayactype = t31.actype
			     LEFT JOIN smtdivisiondetail t48 ON t1.findivision = t48.divisioncode
			     LEFT JOIN rmtaccounttypes t49 ON t1.finsuspactype = t49.actype
			     LEFT JOIN rules t59 ON t1.downpayrule = t59.ruleid
			     LEFT JOIN rules t67 ON t1.grcpricingmethod = t67.ruleid
			     LEFT JOIN rules t68 ON t1.rpypricingmethod = t68.ruleid
			     LEFT JOIN profitcenters t69 ON t69.profitcenterid = t1.profitcenterid
			UNION ALL
			 SELECT t1.fintype,
			    t1.fincategory,
			    t1.fintypedesc,
			    t1.finccy,
			    t1.findayscaltype,
			    t1.finactype,
			    t1.fincontingentactype,
			    t1.finisgenref,
			    t1.finmaxamount,
			    t1.finminamount,
			    t1.finisopennewfinac,
			    t1.findftstmtfrq,
			    t1.finisalwmd,
			    t1.finschdmthd,
			    t1.finisalwgrace,
			    t1.finhistretension,
			    t1.equalrepayment,
			    t1.finratetype,
			    t1.finbaserate,
			    t1.finsplrate,
			    t1.finintrate,
			    t1.finminrate,
			    t1.finmaxrate,
			    t1.findftintfrq,
			    t1.finisintcpz,
			    t1.fincpzfrq,
			    t1.finisrvwalw,
			    t1.finrvwfrq,
			    t1.fingrcratetype,
			    t1.fingrcbaserate,
			    t1.fingrcsplrate,
			    t1.fingrcintrate,
			    t1.fingrcminrate,
			    t1.fingrcmaxrate,
			    t1.fingrcdftintfrq,
			    t1.fingrcisintcpz,
			    t1.fingrccpzfrq,
			    t1.fingrcisrvwalw,
			    t1.fingrcrvwfrq,
			    t1.finminterm,
			    t1.finmaxterm,
			    t1.findftterms,
			    t1.finrpyfrq,
			    t1.finrepaymethod,
			    t1.finisalwpartialrpy,
			    t1.finisalwdifferment,
			    t1.finmaxdifferment,
			    t1.finisalwearlyrpy,
			    t1.finisalwearlysettle,
			    t1.finodrpytries,
			    t1.finearlypayrule,
			    t1.finearlysettlerule,
			    t1.findepositrestrictedto,
			    t1.finaebuyorinception,
			    t1.finaesellormaturity,
			    t1.finisactive,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t1.stepfinance,
			    t1.steppingmandatory,
			    t1.alwmanualsteps,
			    t1.alwdsteppolicies,
			    t1.dftsteppolicy,
			    t4.actypedesc AS lovdescfincontingentactypename,
			    t5.actypedesc AS lovdescfinactypename,
			    t1.finisdwpayrequired,
			    t1.finrvwrateapplfor,
			    t1.finalwratechangeanydate,
			    t1.finisintcpzatgrcend,
			    t1.finelgrulecode,
			    t1.limitelgrulecode,
			    t1.finschcalcodeonrvw,
			    t1.alwplandeferment,
			    t1.plandefercount,
			    t1.finassettype,
			    t1.pftpayactype,
			    t1.finisopenpftpayacc,
			    t31.actypedesc AS lovdescpftpayactypename,
			    t1.finisalwgrcrepay,
			    t1.fingrcschdmthd,
			    t1.fingrcmargin,
			    t1.finmargin,
			    t1.finscheduleon,
			    t1.fingrcscheduleon,
			    t1.fincommitmentreq,
			    t1.fincollateralreq,
			    t1.findepreciationreq,
			    t1.findepreciationfrq,
			    t1.finbankcontingentactype,
			    t1.finprovisionactype,
			    t38.actypedesc AS lovdescfinbankcontactypename,
			    t39.actypedesc AS lovdescfinprovisionactypename,
			    t1.allowriainvestment,
			    t1.overridelimit,
			    t1.limitrequired,
			    t1.fincommitmentovrride,
			    t1.fincollateralovrride,
			    t1.finpftunchanged,
			    t1.applyodpenalty,
			    t1.odincgrcdays,
			    t1.odchargetype,
			    t1.odgracedays,
			    t1.odchargecalon,
			    t1.odchargeamtorperc,
			    t1.odallowwaiver,
			    t1.odmaxwaiverperc,
			    t1.findivision,
			    t48.divisioncodedesc AS lovdescfindivisionname,
			    t48.entitycode AS lovdescentitycode,
			    t1.finsuspactype,
			    t49.actypedesc AS lovdescfinsuspactypename,
			    t1.product,
			    t1.startdate,
			    t1.enddate,
			    t1.allowdownpaypgm,
			    t1.fintypedesc AS lovdescpromofintypedesc,
			    t1.remarks,
			    t1.alwearlypaymethods,
			    t1.pastduepftcalmthd,
			    t1.pastduepftmargin,
			    t1.alwadvancerent,
			    t1.grcadvbaserate,
			    t1.grcadvmargin,
			    t1.grcadvpftrate,
			    t1.rpyadvbaserate,
			    t1.rpyadvmargin,
			    t1.rpyadvpftrate,
			    t1.rolloverfinance,
			    t1.rolloverfrq,
			    t1.downpayrule,
			    t59.rulecode AS downpayruledesc,
			    t1.finsusptrigger,
			    t1.finsuspremarks,
			    t1.alwmultipartydisb,
			    t1.collateraltype,
			    t1.tdsapplicable,
			    t1.manualschedule,
			    t1.applygrcpricing,
			    t1.grcpricingmethod,
			    t1.applyrpypricing,
			    t1.rpypricingmethod,
			    t1.rpyhierarchy,
			    t67.rulecode AS grcpricingmethoddesc,
			    t68.rulecode AS rpypricingmethoddesc,
			    t1.droplineod,
			    t1.droppingmethod,
			    t1.ratechganyday,
			    t1.finrepaypftonfrq,
			    t1.alwbpi,
			    t1.bpitreatment,
			    t1.pftdueschon,
			    t1.planemihalw,
			    t1.planemihmethod,
			    t1.planemihmaxperyear,
			    t1.planemihmax,
			    t1.planemihlockperiod,
			    t1.planemicpz,
			    t1.unplanemihlockperiod,
			    t1.unplanemicpz,
			    t1.reagecpz,
			    t1.fddlockperiod,
			    t1.alwdrpymethods,
			    t1.maxunplannedemi,
			    t1.maxreageholidays,
			    t1.roundingmode,
			    t1.roundingtarget,
			    t1.frequencydays,
			    t1.quickdisb,
			    t1.alwmaxdisbcheckreq,
			    t1.alwreage,
			    t1.alwunplanemiholiday,
			    t1.profitcenterid,
			    t69.profitcentercode,
			    t69.profitcenterdesc,
			    t1.productcategory,
			    t2.productdesc AS fincategorydesc,
			    t1.developerfinance,
			    t1.costoffunds,
			    t1.chequecapturereq,
			    t1.finltvcheck,
			    t1.PartiallySecured
			   FROM rmtfinancetypes t1
			     LEFT JOIN bmtproduct t2 ON t1.fincategory = t2.productcode
			     LEFT JOIN rmtaccounttypes t4 ON t1.fincontingentactype = t4.actype
			     LEFT JOIN rmtaccounttypes t38 ON t1.finbankcontingentactype = t38.actype
			     LEFT JOIN rmtaccounttypes t39 ON t1.finprovisionactype = t39.actype
			     LEFT JOIN rmtaccounttypes t5 ON t1.finactype = t5.actype
			     LEFT JOIN rmtaccounttypes t31 ON t1.pftpayactype = t31.actype
			     LEFT JOIN smtdivisiondetail t48 ON t1.findivision = t48.divisioncode
			     LEFT JOIN rmtaccounttypes t49 ON t1.finsuspactype = t49.actype
			     LEFT JOIN rules t59 ON t1.downpayrule = t59.ruleid
			     LEFT JOIN rules t67 ON t1.grcpricingmethod = t67.ruleid
			     LEFT JOIN rules t68 ON t1.rpypricingmethod = t68.ruleid
			     LEFT JOIN profitcenters t69 ON t69.profitcenterid = t1.profitcenterid
			  WHERE NOT (EXISTS ( SELECT 1 AS expr1
			           FROM rmtfinancetypes_temp
			          WHERE rmtfinancetypes_temp.fintype = t1.fintype))
		</createView>
	</changeSet>
	
	<changeSet id="04" author="Durgaprasad.g">
		<createView viewName="rmtfinancetypes_aview" replaceIfExists="true">
			 SELECT t1.fintype,
			    t1.fincategory,
			    t1.fintypedesc,
			    t1.finccy,
			    t1.findayscaltype,
			    t1.finactype,
			    t1.fincontingentactype,
			    t1.finisgenref,
			    t1.finmaxamount,
			    t1.finminamount,
			    t1.finisopennewfinac,
			    t1.findftstmtfrq,
			    t1.finisalwmd,
			    t1.finschdmthd,
			    t1.finisalwgrace,
			    t1.finhistretension,
			    t1.equalrepayment,
			    t1.finratetype,
			    t1.finbaserate,
			    t1.finsplrate,
			    t1.finintrate,
			    t1.finminrate,
			    t1.finmaxrate,
			    t1.findftintfrq,
			    t1.finisintcpz,
			    t1.fincpzfrq,
			    t1.finisrvwalw,
			    t1.finrvwfrq,
			    t1.fingrcratetype,
			    t1.fingrcbaserate,
			    t1.fingrcsplrate,
			    t1.fingrcintrate,
			    t1.fingrcminrate,
			    t1.fingrcmaxrate,
			    t1.fingrcdftintfrq,
			    t1.fingrcisintcpz,
			    t1.fingrccpzfrq,
			    t1.fingrcisrvwalw,
			    t1.fingrcrvwfrq,
			    t1.finminterm,
			    t1.finmaxterm,
			    t1.findftterms,
			    t1.finrpyfrq,
			    t1.finrepaymethod,
			    t1.finisalwpartialrpy,
			    t1.finisalwdifferment,
			    t1.finmaxdifferment,
			    t1.finisalwearlyrpy,
			    t1.finisalwearlysettle,
			    t1.finodrpytries,
			    t1.finearlypayrule,
			    t1.finearlysettlerule,
			    t1.findepositrestrictedto,
			    t1.finaebuyorinception,
			    t1.finaesellormaturity,
			    t1.finisactive,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t1.stepfinance,
			    t1.steppingmandatory,
			    t1.alwmanualsteps,
			    t1.alwdsteppolicies,
			    t1.dftsteppolicy,
			    t4.actypedesc AS lovdescfincontingentactypename,
			    t5.actypedesc AS lovdescfinactypename,
			    t1.finisdwpayrequired,
			    t1.finrvwrateapplfor,
			    t1.finalwratechangeanydate,
			    t1.finisintcpzatgrcend,
			    t1.finelgrulecode,
			    t1.limitelgrulecode,
			    t1.finschcalcodeonrvw,
			    t1.alwplandeferment,
			    t1.plandefercount,
			    t1.finassettype,
			    t1.pftpayactype,
			    t1.finisopenpftpayacc,
			    t31.actypedesc AS lovdescpftpayactypename,
			    t1.finisalwgrcrepay,
			    t1.fingrcschdmthd,
			    t1.fingrcmargin,
			    t1.finmargin,
			    t1.finscheduleon,
			    t1.fingrcscheduleon,
			    t1.fincommitmentreq,
			    t1.fincollateralreq,
			    t1.findepreciationreq,
			    t1.findepreciationfrq,
			    t1.finbankcontingentactype,
			    t1.finprovisionactype,
			    t38.actypedesc AS lovdescfinbankcontactypename,
			    t39.actypedesc AS lovdescfinprovisionactypename,
			    t1.allowriainvestment,
			    t1.overridelimit,
			    t1.limitrequired,
			    t1.fincommitmentovrride,
			    t1.fincollateralovrride,
			    t1.finpftunchanged,
			    t1.applyodpenalty,
			    t1.odincgrcdays,
			    t1.odchargetype,
			    t1.odgracedays,
			    t1.odchargecalon,
			    t1.odchargeamtorperc,
			    t1.odallowwaiver,
			    t1.odmaxwaiverperc,
			    t1.findivision,
			    t48.divisioncodedesc AS lovdescfindivisionname,
			    t48.entitycode AS lovdescentitycode,
			    t1.finsuspactype,
			    t49.actypedesc AS lovdescfinsuspactypename,
			    t1.product,
			    t1.startdate,
			    t1.enddate,
			    t1.allowdownpaypgm,
			    t1.remarks,
			    t1.alwearlypaymethods,
			    t1.pastduepftcalmthd,
			    t1.pastduepftmargin,
			    t1.alwadvancerent,
			    t1.grcadvbaserate,
			    t1.grcadvmargin,
			    t1.grcadvpftrate,
			    t1.rpyadvbaserate,
			    t1.rpyadvmargin,
			    t1.rpyadvpftrate,
			    t1.rolloverfinance,
			    t1.rolloverfrq,
			    t1.downpayrule,
			    t59.rulecode AS downpayruledesc,
			    t1.finsusptrigger,
			    t1.finsuspremarks,
			    t1.alwmultipartydisb,
			    t1.collateraltype,
			    t1.tdsapplicable,
			    t1.manualschedule,
			    t1.applygrcpricing,
			    t1.grcpricingmethod,
			    t1.applyrpypricing,
			    t1.rpypricingmethod,
			    t1.rpyhierarchy,
			    t67.rulecode AS grcpricingmethoddesc,
			    t68.rulecode AS rpypricingmethoddesc,
			    t1.droplineod,
			    t1.droppingmethod,
			    t1.ratechganyday,
			    t1.finrepaypftonfrq,
			    t1.alwbpi,
			    t1.bpitreatment,
			    t1.pftdueschon,
			    t1.planemihalw,
			    t1.planemihmethod,
			    t1.planemihmaxperyear,
			    t1.planemihmax,
			    t1.planemihlockperiod,
			    t1.planemicpz,
			    t1.unplanemihlockperiod,
			    t1.unplanemicpz,
			    t1.reagecpz,
			    t1.fddlockperiod,
			    t1.alwdrpymethods,
			    t1.maxunplannedemi,
			    t1.maxreageholidays,
			    t1.roundingmode,
			    t1.roundingtarget,
			    t1.frequencydays,
			    t1.quickdisb,
			    t1.alwreage,
			    t1.alwunplanemiholiday,
			    t1.alwmaxdisbcheckreq,
			    t1.fintypedesc AS lovdescpromofintypedesc,
			    t1.profitcenterid,
			    t69.profitcentercode,
			    t69.profitcenterdesc,
			    t1.productcategory,
			    t2.productdesc AS fincategorydesc,
			    t1.developerfinance,
			    t1.costoffunds,
			    t1.chequecapturereq,
			    t1.finltvcheck,
			    t1.PartiallySecured
			   FROM rmtfinancetypes t1
			     LEFT JOIN bmtproduct t2 ON t1.fincategory = t2.productcode
			     LEFT JOIN rmtaccounttypes t4 ON t1.fincontingentactype = t4.actype
			     LEFT JOIN rmtaccounttypes t38 ON t1.finbankcontingentactype = t38.actype
			     LEFT JOIN rmtaccounttypes t39 ON t1.finprovisionactype = t39.actype
			     LEFT JOIN rmtaccounttypes t5 ON t1.finactype = t5.actype
			     LEFT JOIN rmtaccounttypes t31 ON t1.pftpayactype = t31.actype
			     LEFT JOIN smtdivisiondetail t48 ON t1.findivision = t48.divisioncode
			     LEFT JOIN rmtaccounttypes t49 ON t1.finsuspactype = t49.actype
			     LEFT JOIN rules t59 ON t1.downpayrule = t59.ruleid
			     LEFT JOIN rules t67 ON t1.grcpricingmethod = t67.ruleid
			     LEFT JOIN rules t68 ON t1.rpypricingmethod = t68.ruleid
			     LEFT JOIN profitcenters t69 ON t69.profitcenterid = t1.profitcenterid
		</createView>
	</changeSet>
	
	<changeSet id="05" author="Durgaprasad g">
		<createView viewName="rmtfinancetypes_aeview" replaceIfExists="true">
			 SELECT t1.fintype,
			    '' AS findeffreq,
			    t1.finactype,
			    t1.finccy,
			    t1.finisopennewfinac,
			    t1.pftpayactype,
			    t1.finisopenpftpayacc,
			    t1.fincontingentactype,
			    t1.finprovisionactype,
			    t1.finsuspactype,
			    t1.fincategory,
			    t1.developerfinance,
			    t1.PartiallySecured
			   FROM rmtfinancetypes t1
		</createView>
	</changeSet>
	
	<changeSet id="06" author="Durgaprasad g">
		<createView viewName="rmtfinancetypes_orgview" replaceIfExists="true">
			 SELECT t1.fintype,
			    t1.fincategory,
			    t1.fintypedesc,
			    t1.finccy,
			    t1.findayscaltype,
			    t1.finactype,
			    t1.fincontingentactype,
			    t1.finisgenref,
			    t1.finmaxamount,
			    t1.finminamount,
			    t1.finisopennewfinac,
			    t1.finisalwmd,
			    t1.finschdmthd,
			    t1.finisalwgrace,
			    t1.equalrepayment,
			    t1.finratetype,
			    t1.finbaserate,
			    t1.finsplrate,
			    t1.finintrate,
			    t1.finminrate,
			    t1.finmaxrate,
			    t1.findftintfrq,
			    t1.finisintcpz,
			    t1.fincpzfrq,
			    t1.finisrvwalw,
			    t1.finrvwfrq,
			    t1.fingrcratetype,
			    t1.fingrcbaserate,
			    t1.fingrcsplrate,
			    t1.fingrcintrate,
			    t1.fingrcminrate,
			    t1.fingrcmaxrate,
			    t1.fingrcdftintfrq,
			    t1.fingrcisintcpz,
			    t1.fingrccpzfrq,
			    t1.fingrcisrvwalw,
			    t1.fingrcrvwfrq,
			    t1.finminterm,
			    t1.finmaxterm,
			    t1.findftterms,
			    t1.finrpyfrq,
			    t1.finrepaymethod,
			    t1.finisalwdifferment,
			    t1.finmaxdifferment,
			    t1.finisactive,
			    t1.stepfinance,
			    t1.steppingmandatory,
			    t1.alwmanualsteps,
			    t1.alwdsteppolicies,
			    t1.dftsteppolicy,
			    t1.finisdwpayrequired,
			    t1.finrvwrateapplfor,
			    t1.finalwratechangeanydate,
			    t1.finisintcpzatgrcend,
			    t1.finschcalcodeonrvw,
			    t1.alwplandeferment,
			    t1.plandefercount,
			    t1.pftpayactype,
			    t1.finisopenpftpayacc,
			    t1.finisalwgrcrepay,
			    t1.fingrcschdmthd,
			    t1.fingrcmargin,
			    t1.finmargin,
			    t1.fincommitmentreq,
			    t1.fincollateralreq,
			    t1.findepreciationreq,
			    t1.findepreciationfrq,
			    t1.finbankcontingentactype,
			    t1.finprovisionactype,
			    t1.allowriainvestment,
			    t1.overridelimit,
			    t1.limitrequired,
			    t1.fincommitmentovrride,
			    t1.fincollateralovrride,
			    t1.finrepaypftonfrq,
			    t1.finpftunchanged,
			    t1.applyodpenalty,
			    t1.odincgrcdays,
			    t1.odchargetype,
			    t1.odgracedays,
			    t1.odchargecalon,
			    t1.odchargeamtorperc,
			    t1.odallowwaiver,
			    t1.odmaxwaiverperc,
			    t1.findivision,
			    t3.divisioncodedesc AS lovdescfindivisionname,
			    t1.finsuspactype,
			    t1.product,
			    t1.startdate,
			    t1.enddate,
			    t1.allowdownpaypgm,
			    t1.fintypedesc AS lovdescpromofintypedesc,
			    t1.remarks,
			    t4.policydesc AS lovdescdftsteppolicyname,
			    t1.pastduepftcalmthd,
			    t1.pastduepftmargin,
			    t1.alwadvancerent,
			    t1.grcadvbaserate,
			    t1.grcadvmargin,
			    t1.grcadvpftrate,
			    t1.rpyadvbaserate,
			    t1.rpyadvmargin,
			    t1.rpyadvpftrate,
			    t1.rolloverfinance,
			    t1.rolloverfrq,
			    t1.downpayrule,
			    t1.alwmultipartydisb,
			    t1.collateraltype,
			    t1.tdsapplicable,
			    t5.rulecode AS downpayruledesc,
			    t1.applygrcpricing,
			    t1.applyrpypricing,
			    t6.rulecode AS grcpricingmethoddesc,
			    t7.rulecode AS rpypricingmethoddesc,
			    t1.droplineod,
			    t1.droppingmethod,
			    t1.ratechganyday,
			    t4.steptype AS dftsteppolicytype,
			    t1.manualschedule,
			    t1.alwbpi,
			    t1.bpitreatment,
			    t1.pftdueschon,
			    t1.planemihalw,
			    t1.planemihmethod,
			    t1.planemihmaxperyear,
			    t1.planemihmax,
			    t1.planemihlockperiod,
			    t1.planemicpz,
			    t1.unplanemihlockperiod,
			    t1.unplanemicpz,
			    t1.reagecpz,
			    t1.fddlockperiod,
			    t1.alwdrpymethods,
			    t1.maxunplannedemi,
			    t1.maxreageholidays,
			    t1.roundingmode,
			    t1.roundingtarget,
			    t1.frequencydays,
			    t1.quickdisb,
			    t1.alwreage,
			    t1.alwunplanemiholiday,
			    t1.alwmaxdisbcheckreq,
			    t1.productcategory,
			    t1.rpyhierarchy,
			    t1.developerfinance,
			    t3.entitycode AS lovdescentitycode,
			    t8.entitydesc AS lovdescentitydesc,
			    t1.costoffunds,
			    t1.chequecapturereq,
			    t1.finltvcheck,
			    t1.PartiallySecured
			   FROM rmtfinancetypes t1
			     JOIN smtdivisiondetail t3 ON t1.findivision = t3.divisioncode
			     LEFT JOIN steppolicyheader t4 ON t1.dftsteppolicy = t4.policycode
			     LEFT JOIN rules t5 ON t1.downpayrule = t5.ruleid
			     LEFT JOIN rules t6 ON t1.grcpricingmethod = t6.ruleid
			     LEFT JOIN rules t7 ON t1.rpypricingmethod = t7.ruleid
			     LEFT JOIN entity t8 ON t3.entitycode = t8.entitycode
		</createView>
	</changeSet>
	
	<changeSet id="07" author="Durgaprasad.g">
		<sql>
			Update financechecklistref set recordtype = Null;
			Update financechecklistref_temp set recordtype = Null;
		</sql>
	</changeSet>

<changeSet id = "8" author = "Ganesh.p">
	<comment>Security operations added for PostingsDownload</comment>
	<sql>
	DELETE FROM SecOperationRoles Where OprId=(Select OprId  From SecOperations Where OprCode='OPERATION_POSTINGS_DOWNLOAD') AND RoleID=(Select  RoleID  From SecRoles Where RoleCd='Postings_download');
	DELETE FROM SecRoleGroups Where GrpId=(Select GrpId  From SecGroups Where GrpCode='Postings_Download') AND RoleID=(Select  RoleID  From SecRoles Where RoleCd='Postings_download');
	DELETE FROM SECGROUPRIGHTS Where GRPID=(SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='Postings_Download') AND RIGHTID=(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='menu_Item_PostingsDownload');

	DELETE FROM SECRIGHTS  WHERE RIGHTNAME='menu_Item_PostingsDownload';
	DELETE FROM SECGROUPS Where GRPCODE='Postings_Download';
	DELETE FROM SECROLES Where RoleCd='Postings_download';
	DELETE FROM SECOPERATIONS Where OprCode='OPERATION_POSTINGS_DOWNLOAD';		

	Insert into SecRights(RightID,RightType,RightName,Page,Version,LastMntBy,LastMntOn,RecordStatus,RoleCode,NextRoleCode,TaskId,NextTaskId,RecordType,WorkflowId) Values
	((Select MAX(RightID)+1 From SecRights), 0, 'menu_Item_PostingsDownload', 'MENU', 1, 1000, Current_Timestamp, 'Approved',' ',' ',' ',' ',' ',0);

	Insert Into secGroups(GrpID,GrpCode,GrpDesc,Version,LastMntBy,LastMntOn,RecordStatus,RoleCode,NextRoleCode,TaskId,NextTaskId,RecordType,WorkflowId) values
	((Select MAX(GrpID)+1 From secGroups),'Postings_Download','Postings Download.',0,1000,Current_Timestamp,'Approved','','','','','',0);

	INSERT INTO SecRoles (RoleID,RoleApp,RoleCd,RoleDesc,RoleCategory,Version,LastMntBy,LastMntOn,RecordStatus,RoleCode,NextRoleCode,TaskId,NextTaskId,RecordType,WorkflowId) VALUES
	((select MAX(RoleID)+1 from SecRoles),1,'Postings_download','Postings file download.','BulkProcessing',1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0);

	INSERT INTO SecOperations (OprID,OprCode,OprDesc,Version,LastMntBy,LastMntOn,RecordStatus,RoleCode,NextRoleCode,TaskId,NextTaskId,RecordType,WorkflowId) VALUES 
	((select MAX(OprID)+1 from SecOperations),'OPERATION_POSTINGS_DOWNLOAD','Postings Download',1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0);
	
	INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='Postings_Download') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='menu_Item_PostingsDownload'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
	INSERT INTO SECROLEGROUPS values((Select MAX(RoleGrpID)+1 From SecRoleGroups),(Select GrpId  From SecGroups Where GrpCode='Postings_Download'), (Select  RoleID  From SecRoles Where RoleCd='Postings_download'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
	INSERT INTO SECOPERATIONROLES values((Select MAX(OprRoleID)+1 From SecOperationRoles),(Select OprId  From SecOperations Where OprCode='OPERATION_POSTINGS_DOWNLOAD'), (Select  RoleID  From SecRoles Where RoleCd='Postings_download'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
	
	
	UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
	UPDATE SEQSECGROUPS SET SEQNO= (SELECT MAX(GRPID) FROM SECGROUPS);
	UPDATE SEQSECROLES SET SEQNO= (SELECT MAX(ROLEID) FROM SECROLES);
	UPDATE SEQSECOPERATIONS SET SEQNO= (SELECT MAX(OPRID) FROM SECOPERATIONS);
				
	UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS);
	UPDATE SEQSECROLEGROUPS SET SEQNO= (SELECT MAX(ROLEGRPID) FROM SECROLEGROUPS);
	UPDATE SEQSECOPERATIONROLES SET SEQNO= (SELECT MAX(OPRROLEID) FROM SECOPERATIONROLES);
		</sql>
</changeSet>

<changeSet id = "9" author = "Ganesh.p">
	<comment>Security operations added for External Upload</comment>
	<sql>
	DELETE FROM SecOperationRoles Where OprId=(Select OprId  From SecOperations Where OprCode='OPERATION_EXTERNAL_UPLOAD') AND RoleID=(Select  RoleID  From SecRoles Where RoleCd='External_Upload');
	DELETE FROM SecRoleGroups Where GrpId=(Select GrpId  From SecGroups Where GrpCode='External_Upload') AND RoleID=(Select  RoleID  From SecRoles Where RoleCd='External_Upload');
	DELETE FROM SECGROUPRIGHTS Where GRPID=(SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='External_Upload') AND RIGHTID=(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='menu_Item_ExternalUpload');

	DELETE FROM SECRIGHTS  WHERE RIGHTNAME='menu_Item_ExternalUpload';
	DELETE FROM SECGROUPS Where GRPCODE='External_Upload';
	DELETE FROM SECROLES Where RoleCd='External_Upload';
	DELETE FROM SECOPERATIONS Where OprCode='OPERATION_EXTERNAL_UPLOAD';
	
	Insert into SecRights(RightID,RightType,RightName,Page,Version,LastMntBy,LastMntOn,RecordStatus,RoleCode,NextRoleCode,TaskId,NextTaskId,RecordType,WorkflowId) Values
	((Select MAX(RightID)+1 From SecRights), 0, 'menu_Item_ExternalUpload', 'MENU', 1, 1000, Current_Timestamp, 'Approved',' ',' ',' ',' ',' ',0);

	Insert Into secGroups(GrpID,GrpCode,GrpDesc,Version,LastMntBy,LastMntOn,RecordStatus,RoleCode,NextRoleCode,TaskId,NextTaskId,RecordType,WorkflowId) values
	((Select MAX(GrpID)+1 From secGroups),'External_Upload','External Uploads.',0,1000,Current_Timestamp,'Approved','','','','','',0);

	INSERT INTO SecRoles (RoleID,RoleApp,RoleCd,RoleDesc,RoleCategory,Version,LastMntBy,LastMntOn,RecordStatus,RoleCode,NextRoleCode,TaskId,NextTaskId,RecordType,WorkflowId) VALUES
	((select MAX(RoleID)+1 from SecRoles),1,'External_Upload','External uploads.','BulkProcessing',1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0);

	INSERT INTO SecOperations (OprID,OprCode,OprDesc,Version,LastMntBy,LastMntOn,RecordStatus,RoleCode,NextRoleCode,TaskId,NextTaskId,RecordType,WorkflowId) VALUES 
	((select MAX(OprID)+1 from SecOperations),'OPERATION_EXTERNAL_UPLOAD','External Upload',1,1000,CURRENT_TIMESTAMP,'Approved',' ',' ',' ',' ',' ',0);
	
	INSERT INTO SECGROUPRIGHTS VALUES((SELECT MAX(GRPRIGHTID)+1 FROM SECGROUPRIGHTS), (SELECT GRPID  FROM SECGROUPS WHERE GRPCODE='External_Upload') ,(SELECT RIGHTID FROM SECRIGHTS WHERE RIGHTNAME='menu_Item_ExternalUpload'), 1, 0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
	INSERT INTO SecRoleGroups values((Select MAX(RoleGrpID)+1 From SecRoleGroups),(Select GrpId  From SecGroups Where GrpCode='External_Upload'), (Select  RoleID  From SecRoles Where RoleCd='External_Upload'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
	INSERT INTO SecOperationRoles values((Select MAX(OprRoleID)+1 From SecOperationRoles),(Select OprId  From SecOperations Where OprCode='OPERATION_EXTERNAL_UPLOAD'), (Select  RoleID  From SecRoles Where RoleCd='External_Upload'),0,1000,CURRENT_TIMESTAMP,' ',' ',' ',' ',' ',' ',0);
	
		
	UPDATE SEQSECRIGHTS SET SEQNO= (SELECT MAX(RIGHTID) FROM SECRIGHTS);
	UPDATE SEQSECGROUPS SET SEQNO= (SELECT MAX(GRPID) FROM SECGROUPS);
	UPDATE SEQSECROLES SET SEQNO= (SELECT MAX(ROLEID) FROM SECROLES);
	UPDATE SEQSECOPERATIONS SET SEQNO= (SELECT MAX(OPRID) FROM SECOPERATIONS);
				
	UPDATE SEQSECGROUPRIGHTS SET SEQNO = (SELECT MAX(GRPRIGHTID) FROM SECGROUPRIGHTS);
	UPDATE SEQSECROLEGROUPS SET SEQNO= (SELECT MAX(ROLEGRPID) FROM SECROLEGROUPS);
	UPDATE SEQSECOPERATIONROLES SET SEQNO= (SELECT MAX(OPRROLEID) FROM SECOPERATIONROLES);
	</sql>
</changeSet>
	<changeSet id="10" author="vijaykumar.l">
		<sql>
			update ExtendedFieldHeader set modulename = 'ASSETTYPE' where modulename ='AssetType';
    		update ExtendedFieldHeader_temp set modulename = 'ASSETTYPE' where modulename ='AssetType';
		</sql>
	</changeSet>	
	
	<changeSet id="11" author="Vinay">
		<sql>
			update financemain set eligibilitymethod=(select fieldcodeid from rmtlovfielddetail t2 where financemain.eligibilitymethod = t2.fieldcodevalue);
			update financemain_temp set eligibilitymethod=(select fieldcodeid from rmtlovfielddetail t2 where financemain_temp.eligibilitymethod = t2.fieldcodevalue);
		</sql>
	</changeSet>
	
	<changeSet id="12" author="Vinay">
		<sql>
			update financemain set eligibilitymethod=0 where eligibilitymethod is null;
			update financemain_temp set eligibilitymethod=0 where eligibilitymethod is null;
		</sql>
	</changeSet>
	
	<changeSet id="14" author="Vinay">
		<dropDefaultValue tableName="FinanceMain" columnName="EligibilityMethod"/>
		<dropDefaultValue tableName="FinanceMain_Temp" columnName="EligibilityMethod"/>
	</changeSet>
	
	<changeSet id="15.0" author="Vinay" dbms="postgresql">
		<sql>
			alter table FinanceMain alter column EligibilityMethod drop default;
			alter table FinanceMain_Temp alter column EligibilityMethod drop default;
		</sql>
	</changeSet>
	
	<changeSet id="15" author="Vinay">
		<modifyDataType tableName="FinanceMain" columnName="EligibilityMethod" newDataType="bigint"/>
		<modifyDataType tableName="FinanceMain_Temp" columnName="EligibilityMethod" newDataType="bigint"/>
	</changeSet>
	
	<changeSet id="16" author="Vinay">
		<createView viewName="financemain_aview" replaceIfExists="true">
			SELECT t1.finreference,
			    t1.numberofterms,
			    t1.grcperiodenddate,
			    t1.allowgrcperiod,
			    t1.gracebaserate,
			    t1.gracespecialrate,
			    t1.grcpftrate,
			    t1.grcpftfrq,
			    t1.nextgrcpftdate,
			    t1.allowgrcpftrvw,
			    t1.grcpftrvwfrq,
			    t1.nextgrcpftrvwdate,
			    t1.allowgrccpz,
			    t1.grccpzfrq,
			    t1.nextgrccpzdate,
			    t1.repaybaserate,
			    t1.repayspecialrate,
			    t1.repayprofitrate,
			    t1.repayfrq,
			    t1.nextrepaydate,
			    t1.repaypftfrq,
			    t1.nextrepaypftdate,
			    t1.allowrepayrvw,
			    t1.repayrvwfrq,
			    t1.nextrepayrvwdate,
			    t1.allowrepaycpz,
			    t1.repaycpzfrq,
			    t1.nextrepaycpzdate,
			    t1.maturitydate,
			    t1.cpzatgraceend,
			    t1.downpayment,
			    t1.graceflatamount,
			    t1.reqrepayamount,
			    t1.totalprofit,
			    t1.totalcpz,
			    t1.totalgrosspft,
			    t1.totalgrossgrcpft,
			    t1.totalgracepft,
			    t1.totalgracecpz,
			    t1.grcratebasis,
			    t1.repayratebasis,
			    t1.fintype,
			    t1.finremarks,
			    t1.finccy,
			    t1.schedulemethod,
			    t1.profitdaysbasis,
			    t1.reqmaturity,
			    t1.calterms,
			    t1.calmaturity,
			    t1.firstrepay,
			    t1.lastrepay,
			    t1.finstartdate,
			    t1.finamount,
			    t1.finamount + t1.feechargeamt - t1.downpayment AS lovdescfinancingamount,
			    t1.finrepaymentamount,
			    t1.custid,
			    t1.defferments,
			    t1.plandefercount,
			    t1.finbranch,
			    t1.finsourceid,
			    t1.alloweddefrpychange,
			    t1.availeddefrpychange,
			    t1.alloweddeffrqchange,
			    t1.availeddeffrqchange,
			    t1.recaltype,
			    t1.finassetvalue,
			    t1.disbaccountid,
			    t1.repayaccountid,
			    t1.finisactive,
			    t1.limitvalid,
			    t1.overridelimit,
			    t1.securitydeposit,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t7.fintypedesc AS lovdescfintypename,
			    t7.finmaxamount AS lovdescfinmaxamt,
			    t7.finminamount AS lovdescfinminamount,
			    t1.mindownpayperc,
			    t7.finisalwdifferment AS lovdescfinalwdeferment,
			    t7.finisdwpayrequired AS lovdescdwnpayreq,
			    t7.finmaxdifferment AS lovdescfinmaxdifferment,
			    t12.branchdesc AS lovdescfinbranchname,
			    t1.lastrepaydate,
			    t1.lastrepaypftdate,
			    t1.lastrepayrvwdate,
			    t1.lastrepaycpzdate,
			    t1.allowgrcrepay,
			    t1.grcschdmthd,
			    t1.grcmargin,
			    t1.repaymargin,
			    t1.fincurrassetvalue,
			    t1.fincommitmentref,
			    t1.finlimitref,
			    t1.depreciationfrq,
			    t1.fincontractdate,
			    t1.nextdepdate,
			    t1.lastdepdate,
			    t1.finaccount,
			    t1.fincustpftaccount,
			    t17.acrtilllbd AS lovdescaccruedtilllbd,
			    t7.finrvwrateapplfor,
			    t1.totalrepayamt,
			    t1.closingstatus,
			    t1.finapproveddate,
			    t1.feechargeamt,
			    t1.blacklisted,
			    t1.finrepaypftonfrq,
			    t1.anualizedpercrate,
			    t1.effectiverateofreturn,
			    t1.migratedfinance,
			    t1.schedulemaintained,
			    t1.scheduleregenerated,
			    t1.finpurpose,
			    t39.loanpurposedesc as lovdescfinpurposename,
			    t1.finstatus,
			    t1.finstsreason,
			    t1.initiateuser,
			    t1.bankname,
			    t1.iban,
			    t1.accounttype,
			    t1.ddareferenceno,
			    t7.finscheduleon AS lovdescfinscheduleon,
			    t1.custdsr,
			    t1.jointaccount,
			    t1.jointcustid,
			    t1.downpaybank,
			    t1.downpaysupl,
			    t1.downpayaccount,
			    t1.securitycollateral,
			    t1.approved,
			    t1.discrepancy,
			    t1.limitapproved,
			    t1.investmentref,
			    t1.graceterms,
			    t7.findivision AS lovdescfindivision,
			    t1.rcdmaintainsts,
			    t1.finrepaymethod,
			    t1.grcprofitdaysbasis,
			    t1.stepfinance,
			    t1.steptype,
			    t1.steppolicy,
			    t1.alwmanualsteps,
			    t1.noofsteps,
			    t1.linkedfinref,
			    t1.nextuserid,
			    t1.priority,
			    t24.policydesc AS lovdescsteppolicyname,
			    t1.grcminrate,
			    t1.grcmaxrate,
			    t1.rpyminrate,
			    t1.rpymaxrate,
			    t1.deviationapproval,
			    t1.manualschedule,
			    t1.takeoverfinance,
			    t1.grcadvbaserate,
			    t1.grcadvmargin,
			    t1.grcadvpftrate,
			    t1.rpyadvbaserate,
			    t1.rpyadvmargin,
			    t1.rpyadvpftrate,
			    t1.supplementrent,
			    t1.increasedcost,
			    t1.rolloverfrq,
			    t1.nextrolloverdate,
			    t27.custstsdescription,
			    t1.shariastatus,
			    t1.initiatedate,
			    t1.finpreapprovedref,
			    t1.mmaid,
			    t1.accountsofficer,
			    t1.feeaccountid,
			    t1.fincancelac,
			    t28.dealername AS lovdescaccountsofficer,
			    t28.dealercity AS lovdescsourcecity,
			    t29.agreename,
			    t29.mmareference AS lovdescmmareference,
			    t1.dsacode,
			    t30.rofficerdesc AS dsacodedesc,
			    t1.tdsapplicable,
			    t1.mandateid,
			    t1.droplinefrq,
			    t1.firstdroplinedate,
			    t1.pftservicingodlimit,
			    t1.insuranceamt,
			    t1.deductinsdisb,
			    t1.alwbpi,
			    t1.bpitreatment,
			    t1.planemihalw,
			    t1.planemihmethod,
			    t1.planemihmaxperyear,
			    t1.planemihmax,
			    t1.planemihlockperiod,
			    t1.planemicpz,
			    t1.calroundingmode,
			    t1.alwmultidisb,
			    t1.applicationno,
			    t1.referralid,
			    t33.rofficerdesc AS referraliddesc,
			    t1.dmacode,
			    t34.rofficerdesc AS dmacodedesc,
			    t1.salesdepartment,
			    t35.gendeptdesc AS salesdepartmentdesc,
			    t1.quickdisb,
			    t1.wifreference,
			    t1.unplanemihlockperiod,
			    t1.unplanemicpz,
			    t1.reagecpz,
			    t1.maxunplannedemi,
			    t1.maxreageholidays,
			    t1.availedunplanemi,
			    t1.availedreageh,
			    t1.bpiamount,
			    t1.deductfeedisb,
			    t1.rvwrateapplfor,
			    t1.schcalonrvw,
			    t1.pastduepftcalmthd,
			    t1.pastduepftmargin,
			    t1.droppingmethod,
			    t1.ratechganyday,
			    t1.promotioncode,
			    t1.restructureloan,
			    t1.oldfinreference,
			    t1.reagebucket,
			    t1.fincategory,
			    t1.productcategory,
			    t1.roundingtarget,
			    t36.entitycode AS lovdescentitycode,
			    t1.eligibilitymethod,
			    t38.fieldcodevalue as lovEligibilityMethod,
			    t38.valuedesc as lovDescEligibilityMethod,
			    t1.employeename,
			    t37.rofficerdesc AS employeenamedesc,
			    t1.samplingrequired,
			    t1.legalrequired,
			    t1.grcmaxamount
			   FROM financemain t1
			     JOIN rmtfinancetypes t7 ON t1.fintype = t7.fintype
			     LEFT JOIN rmtbranches t12 ON t1.finbranch = t12.branchcode
			     LEFT JOIN finpftdetails t17 ON t17.finreference = t1.finreference
			     LEFT JOIN steppolicyheader t24 ON t1.steppolicy = t24.policycode
			     LEFT JOIN bmtcuststatuscodes t27 ON t1.finstatus = t27.custstscode
			     LEFT JOIN amtvehicledealer t28 ON t1.accountsofficer = t28.dealerid
			     LEFT JOIN mmagreements t29 ON t1.mmaid = t29.mmaid
			     LEFT JOIN relationshipofficers t30 ON t1.dsacode = t30.rofficercode
			     LEFT JOIN relationshipofficers t33 ON t1.referralid = t33.rofficercode
			     LEFT JOIN relationshipofficers t34 ON t1.dmacode = t34.rofficercode
			     LEFT JOIN rmtgendepartments t35 ON t1.salesdepartment = t35.gendepartment
			     LEFT JOIN smtdivisiondetail t36 ON t7.findivision = t36.divisioncode
			     LEFT JOIN relationshipofficers t37 ON t1.employeename = t37.rofficercode
			     LEFT JOIN rmtlovfielddetail t38 ON t1.eligibilitymethod = t38.fieldcodeid and t38.fieldcode='ELGMETHOD'
			     LEFT JOIN loanpurposes t39 ON t1.finpurpose = t39.loanpurposecode
		</createView>
	</changeSet>
	
	<changeSet id="17" author="Vinay">
		<createView viewName="financemain_tview" replaceIfExists="true">
				SELECT t1.finreference,
				    t1.investmentref,
				    t1.numberofterms,
				    t1.grcperiodenddate,
				    t1.allowgrcperiod,
				    t1.gracebaserate,
				    t1.gracespecialrate,
				    t1.grcpftrate,
				    t1.grcpftfrq,
				    t1.nextgrcpftdate,
				    t1.allowgrcpftrvw,
				    t1.grcpftrvwfrq,
				    t1.nextgrcpftrvwdate,
				    t1.allowgrccpz,
				    t1.grccpzfrq,
				    t1.nextgrccpzdate,
				    t1.repaybaserate,
				    t1.repayspecialrate,
				    t1.repayprofitrate,
				    t1.repayfrq,
				    t1.nextrepaydate,
				    t1.repaypftfrq,
				    t1.nextrepaypftdate,
				    t1.allowrepayrvw,
				    t1.repayrvwfrq,
				    t1.nextrepayrvwdate,
				    t1.allowrepaycpz,
				    t1.repaycpzfrq,
				    t1.nextrepaycpzdate,
				    t1.maturitydate,
				    t1.cpzatgraceend,
				    t1.downpayment,
				    t1.graceflatamount,
				    t1.reqrepayamount,
				    t1.totalprofit,
				    t1.totalcpz,
				    t1.totalgrosspft,
				    t1.totalgrossgrcpft,
				    t1.totalgracepft,
				    t1.totalgracecpz,
				    t1.grcratebasis,
				    t1.repayratebasis,
				    t1.fintype,
				    t1.finremarks,
				    t1.finccy,
				    t1.schedulemethod,
				    t1.profitdaysbasis,
				    t1.reqmaturity,
				    t1.calterms,
				    t1.calmaturity,
				    t1.firstrepay,
				    t1.lastrepay,
				    t1.finstartdate,
				    t1.finamount,
				    t1.finrepaymentamount,
				    t1.custid,
				    t1.defferments,
				    t1.plandefercount,
				    t1.finbranch,
				    t1.finsourceid,
				    t1.alloweddefrpychange,
				    t1.availeddefrpychange,
				    t1.alloweddeffrqchange,
				    t1.availeddeffrqchange,
				    t1.recaltype,
				    t1.finassetvalue,
				    t1.disbaccountid,
				    t1.repayaccountid,
				    t1.finisactive,
				    t1.limitvalid,
				    t1.overridelimit,
				    t1.securitydeposit,
				    t1.version,
				    t1.lastmntby,
				    t1.lastmnton,
				    t1.recordstatus,
				    t1.rolecode,
				    t1.nextrolecode,
				    t1.taskid,
				    t1.nexttaskid,
				    t1.recordtype,
				    t1.workflowid,
				    t2.fintypedesc AS lovdescfintypename,
				    t2.finmaxamount AS lovdescfinmaxamt,
				    t2.finminamount AS lovdescfinminamount,
				    t1.mindownpayperc,
				    t4.branchdesc AS lovdescfinbranchname,
				    t1.lastrepaydate,
				    t1.lastrepaypftdate,
				    t1.lastrepayrvwdate,
				    t1.lastrepaycpzdate,
				    t1.allowgrcrepay,
				    t1.grcschdmthd,
				    t1.grcmargin,
				    t1.repaymargin,
				    t1.fincurrassetvalue,
				    t1.fincommitmentref,
				    t1.finlimitref,
				    t1.depreciationfrq,
				    t1.fincontractdate,
				    t1.nextdepdate,
				    t1.lastdepdate,
				    t1.finaccount,
				    t1.fincustpftaccount,
				    t1.totalrepayamt,
				    t1.finapproveddate,
				    t1.feechargeamt,
				    t1.blacklisted,
				    t1.finrepaypftonfrq,
				    t1.anualizedpercrate,
				    t1.effectiverateofreturn,
				    t1.migratedfinance,
				    t1.schedulemaintained,
				    t1.scheduleregenerated,
				    t1.finpurpose,
				    t14.loanpurposedesc as lovdescfinpurposename,
				    t1.finstatus,
				    t1.finstsreason,
				    t1.initiateuser,
				    t1.bankname,
				    t1.iban,
				    t1.accounttype,
				    t1.ddareferenceno,
				    t1.custdsr,
				    t1.jointaccount,
				    t1.jointcustid,
				    t1.downpaybank,
				    t1.downpaysupl,
				    t1.downpayaccount,
				    t1.securitycollateral,
				    t1.approved,
				    t1.discrepancy,
				    t1.limitapproved,
				    t1.graceterms,
				    t2.findivision AS lovdescfindivision,
				    t1.rcdmaintainsts,
				    t1.finrepaymethod,
				    t1.grcprofitdaysbasis,
				    t1.stepfinance,
				    t1.steptype,
				    t1.steppolicy,
				    t1.alwmanualsteps,
				    t1.noofsteps,
				    t1.linkedfinref,
				    t1.nextuserid,
				    t1.priority,
				    t5.policydesc AS lovdescsteppolicyname,
				    t1.grcminrate,
				    t1.grcmaxrate,
				    t1.rpyminrate,
				    t1.rpymaxrate,
				    t1.deviationapproval,
				    t1.manualschedule,
				    t1.takeoverfinance,
				    t1.grcadvbaserate,
				    t1.grcadvmargin,
				    t1.grcadvpftrate,
				    t1.rpyadvbaserate,
				    t1.rpyadvmargin,
				    t1.rpyadvpftrate,
				    t1.supplementrent,
				    t1.increasedcost,
				    t1.creditinsamt,
				    t1.rolloverfrq,
				    t1.nextrolloverdate,
				    t1.shariastatus,
				    t1.initiatedate,
				    t1.finpreapprovedref,
				    t1.mmaid,
				    t1.accountsofficer,
				    t1.feeaccountid,
				    t1.fincancelac,
				    t6.dealername AS lovdescaccountsofficer,
				    t6.dealercity AS lovdescsourcecity,
				    t1.dsacode,
				    t7.rofficerdesc AS dsacodedesc,
				    t1.tdsapplicable,
				    t1.mandateid,
				    t1.droplinefrq,
				    t1.firstdroplinedate,
				    t1.pftservicingodlimit,
				    t1.insuranceamt,
				    t1.deductinsdisb,
				    t1.alwbpi,
				    t1.bpitreatment,
				    t1.planemihalw,
				    t1.planemihmethod,
				    t1.planemihmaxperyear,
				    t1.planemihmax,
				    t1.planemihlockperiod,
				    t1.planemicpz,
				    t1.calroundingmode,
				    t1.alwmultidisb,
				    t1.applicationno,
				    t1.referralid,
				    t8.rofficerdesc AS referraliddesc,
				    t1.dmacode,
				    t9.rofficerdesc AS dmacodedesc,
				    t1.salesdepartment,
				    t10.gendeptdesc AS salesdepartmentdesc,
				    t1.quickdisb,
				    t1.wifreference,
				    t1.unplanemihlockperiod,
				    t1.unplanemicpz,
				    t1.reagecpz,
				    t1.maxunplannedemi,
				    t1.maxreageholidays,
				    t1.availedunplanemi,
				    t1.availedreageh,
				    t1.bpiamount,
				    t1.deductfeedisb,
				    t1.rvwrateapplfor,
				    t1.schcalonrvw,
				    t1.pastduepftcalmthd,
				    t1.pastduepftmargin,
				    t1.droppingmethod,
				    t1.ratechganyday,
				    t1.promotioncode,
				    t1.restructureloan,
				    t1.oldfinreference,
				    t1.reagebucket,
				    t1.fincategory,
				    t1.productcategory,
				    t1.roundingtarget,
				    t11.entitycode AS lovdescentitycode,
				    t1.eligibilitymethod,
				    t13.fieldcodevalue as lovEligibilityMethod,
					t13.valuedesc as lovDescEligibilityMethod,
				    t1.employeename,
				    t12.rofficerdesc AS employeenamedesc,
				    t1.samplingrequired,
				    t1.legalrequired,
				    t1.grcmaxamount
				   FROM financemain_temp t1
				     JOIN rmtfinancetypes t2 ON t1.fintype = t2.fintype
				     JOIN rmtbranches t4 ON t1.finbranch = t4.branchcode
				     LEFT JOIN steppolicyheader t5 ON t1.steppolicy = t5.policycode
				     LEFT JOIN amtvehicledealer t6 ON t1.accountsofficer = t6.dealerid
				     LEFT JOIN relationshipofficers t7 ON t1.dsacode = t7.rofficercode
				     LEFT JOIN relationshipofficers t8 ON t1.referralid = t8.rofficercode
				     LEFT JOIN relationshipofficers t9 ON t1.dmacode = t9.rofficercode
				     LEFT JOIN rmtgendepartments t10 ON t1.salesdepartment = t10.gendepartment
				     LEFT JOIN smtdivisiondetail t11 ON t2.findivision = t11.divisioncode
				     LEFT JOIN relationshipofficers t12 ON t1.employeename = t12.rofficercode
				     LEFT JOIN rmtlovfielddetail t13 ON t1.eligibilitymethod = t13.fieldcodeid and t13.fieldcode='ELGMETHOD'
				     LEFT JOIN loanpurposes t14 ON t1.finpurpose = t14.loanpurposecode
		</createView>
	</changeSet>
	
	<changeSet id="18" author="Vinay">
		<createView viewName="financemain_view" replaceIfExists="true">
			 SELECT t1.finreference,
			    t1.investmentref,
			    t1.numberofterms,
			    t1.grcperiodenddate,
			    t1.allowgrcperiod,
			    t1.gracebaserate,
			    t1.gracespecialrate,
			    t1.grcpftrate,
			    t1.grcpftfrq,
			    t1.nextgrcpftdate,
			    t1.allowgrcpftrvw,
			    t1.grcpftrvwfrq,
			    t1.nextgrcpftrvwdate,
			    t1.allowgrccpz,
			    t1.grccpzfrq,
			    t1.nextgrccpzdate,
			    t1.repaybaserate,
			    t1.repayspecialrate,
			    t1.repayprofitrate,
			    t1.repayfrq,
			    t1.nextrepaydate,
			    t1.repaypftfrq,
			    t1.nextrepaypftdate,
			    t1.allowrepayrvw,
			    t1.repayrvwfrq,
			    t1.nextrepayrvwdate,
			    t1.allowrepaycpz,
			    t1.repaycpzfrq,
			    t1.nextrepaycpzdate,
			    t1.maturitydate,
			    t1.cpzatgraceend,
			    t1.downpayment,
			    t1.graceflatamount,
			    t1.reqrepayamount,
			    t1.totalprofit,
			    t1.totalcpz,
			    t1.totalgrosspft,
			    t1.totalgrossgrcpft,
			    t1.totalgracepft,
			    t1.totalgracecpz,
			    t1.grcratebasis,
			    t1.repayratebasis,
			    t1.fintype,
			    t1.finremarks,
			    t1.finccy,
			    t1.schedulemethod,
			    t1.profitdaysbasis,
			    t1.reqmaturity,
			    t1.calterms,
			    t1.calmaturity,
			    t1.firstrepay,
			    t1.lastrepay,
			    t1.finstartdate,
			    t1.finamount,
			    t1.finamount + t1.feechargeamt - t1.downpayment AS lovdescfinancingamount,
			    t1.finrepaymentamount,
			    t1.custid,
			    t1.defferments,
			    t1.plandefercount,
			    t1.finbranch,
			    t1.finsourceid,
			    t1.alloweddefrpychange,
			    t1.availeddefrpychange,
			    t1.alloweddeffrqchange,
			    t1.availeddeffrqchange,
			    t1.recaltype,
			    t1.finassetvalue,
			    t1.disbaccountid,
			    t1.repayaccountid,
			    t1.finisactive,
			    t1.limitvalid,
			    t1.overridelimit,
			    t1.securitydeposit,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t7.fintypedesc AS lovdescfintypename,
			    t7.finmaxamount AS lovdescfinmaxamt,
			    t7.finminamount AS lovdescfinminamount,
			    t1.mindownpayperc,
			    t7.finisalwdifferment AS lovdescfinalwdeferment,
			    t7.finisdwpayrequired AS lovdescdwnpayreq,
			    t7.finmaxdifferment AS lovdescfinmaxdifferment,
			    t12.branchdesc AS lovdescfinbranchname,
			    t1.lastrepaydate,
			    t1.lastrepaypftdate,
			    t1.lastrepayrvwdate,
			    t1.lastrepaycpzdate,
			    t1.allowgrcrepay,
			    t1.grcschdmthd,
			    t1.grcmargin,
			    t1.repaymargin,
			    t1.fincurrassetvalue,
			    t1.fincommitmentref,
			    t1.finlimitref,
			    t1.depreciationfrq,
			    t1.fincontractdate,
			    t1.nextdepdate,
			    t1.lastdepdate,
			    t1.finaccount,
			    t1.fincustpftaccount,
			    t17.acrtilllbd AS lovdescaccruedtilllbd,
			    t7.finrvwrateapplfor,
			    t1.totalrepayamt,
			    t1.closingstatus,
			    t1.finapproveddate,
			    t1.feechargeamt,
			    t1.blacklisted,
			    t1.finrepaypftonfrq,
			    t1.anualizedpercrate,
			    t1.effectiverateofreturn,
			    t1.migratedfinance,
			    t1.schedulemaintained,
			    t1.scheduleregenerated,
			    t1.finpurpose,
			    t39.loanpurposedesc as lovdescfinpurposename,
			    t1.finstatus,
			    t1.finstsreason,
			    t1.initiateuser,
			    t1.bankname,
			    t1.iban,
			    t1.accounttype,
			    t1.ddareferenceno,
			    t7.finscheduleon AS lovdescfinscheduleon,
			    t1.custdsr,
			    t1.jointaccount,
			    t1.jointcustid,
			    t1.downpaybank,
			    t1.downpaysupl,
			    t1.downpayaccount,
			    t1.securitycollateral,
			    t1.approved,
			    t1.discrepancy,
			    t1.limitapproved,
			    t1.graceterms,
			    t7.findivision AS lovdescfindivision,
			    t1.rcdmaintainsts,
			    t1.finrepaymethod,
			    t1.grcprofitdaysbasis,
			    t1.stepfinance,
			    t1.steptype,
			    t1.steppolicy,
			    t1.alwmanualsteps,
			    t1.noofsteps,
			    t1.linkedfinref,
			    t1.nextuserid,
			    t1.priority,
			    t24.policydesc AS lovdescsteppolicyname,
			    t1.grcminrate,
			    t1.grcmaxrate,
			    t1.rpyminrate,
			    t1.rpymaxrate,
			    t1.deviationapproval,
			    t1.manualschedule,
			    t1.takeoverfinance,
			    t1.grcadvbaserate,
			    t1.grcadvmargin,
			    t1.grcadvpftrate,
			    t1.rpyadvbaserate,
			    t1.rpyadvmargin,
			    t1.rpyadvpftrate,
			    t1.supplementrent,
			    t1.increasedcost,
			    t1.rolloverfrq,
			    t1.nextrolloverdate,
			    t27.custstsdescription,
			    t1.shariastatus,
			    t1.initiatedate,
			    t1.finpreapprovedref,
			    t1.mmaid,
			    t1.accountsofficer,
			    t1.feeaccountid,
			    t1.fincancelac,
			    t28.dealername AS lovdescaccountsofficer,
			    t28.dealercity AS lovdescsourcecity,
			    t1.dsacode,
			    t30.rofficerdesc AS dsacodedesc,
			    t1.tdsapplicable,
			    t1.mandateid,
			    t1.droplinefrq,
			    t1.firstdroplinedate,
			    t1.pftservicingodlimit,
			    t1.insuranceamt,
			    t1.deductinsdisb,
			    t1.alwbpi,
			    t1.bpitreatment,
			    t1.planemihalw,
			    t1.planemihmethod,
			    t1.planemihmaxperyear,
			    t1.planemihmax,
			    t1.planemihlockperiod,
			    t1.planemicpz,
			    t1.calroundingmode,
			    t1.alwmultidisb,
			    t1.applicationno,
			    t1.referralid,
			    t33.rofficerdesc AS referraliddesc,
			    t1.dmacode,
			    t34.rofficerdesc AS dmacodedesc,
			    t1.salesdepartment,
			    t35.gendeptdesc AS salesdepartmentdesc,
			    t1.quickdisb,
			    t1.wifreference,
			    t1.unplanemihlockperiod,
			    t1.unplanemicpz,
			    t1.reagecpz,
			    t1.maxunplannedemi,
			    t1.maxreageholidays,
			    t1.availedunplanemi,
			    t1.availedreageh,
			    t1.bpiamount,
			    t1.deductfeedisb,
			    t1.rvwrateapplfor,
			    t1.schcalonrvw,
			    t1.pastduepftcalmthd,
			    t1.pastduepftmargin,
			    t1.droppingmethod,
			    t1.ratechganyday,
			    t1.promotioncode,
			    t1.restructureloan,
			    t1.oldfinreference,
			    t1.reagebucket,
			    t1.fincategory,
			    t1.productcategory,
			    t1.roundingtarget,
			    t36.entitycode AS lovdescentitycode,
			    t1.eligibilitymethod,
			    t38.fieldcodevalue as lovEligibilityMethod,
				t38.valuedesc as lovDescEligibilityMethod,
			    t1.employeename,
			    t37.rofficerdesc AS employeenamedesc,
			    t1.samplingrequired,
			    t1.legalrequired,
			    t1.grcmaxamount
			   FROM financemain_temp t1
			     JOIN rmtfinancetypes t7 ON t1.fintype = t7.fintype
			     LEFT JOIN rmtbranches t12 ON t1.finbranch = t12.branchcode
			     LEFT JOIN finpftdetails t17 ON t17.finreference = t1.finreference
			     LEFT JOIN steppolicyheader t24 ON t1.steppolicy = t24.policycode
			     LEFT JOIN bmtcuststatuscodes t27 ON t1.finstatus = t27.custstscode
			     LEFT JOIN amtvehicledealer t28 ON t1.accountsofficer = t28.dealerid
			     LEFT JOIN relationshipofficers t30 ON t1.dsacode = t30.rofficercode
			     LEFT JOIN relationshipofficers t33 ON t1.referralid = t33.rofficercode
			     LEFT JOIN relationshipofficers t34 ON t1.dmacode = t34.rofficercode
			     LEFT JOIN rmtgendepartments t35 ON t1.salesdepartment = t35.gendepartment
			     LEFT JOIN smtdivisiondetail t36 ON t7.findivision = t36.divisioncode
			     LEFT JOIN relationshipofficers t37 ON t1.employeename = t37.rofficercode
			     LEFT JOIN rmtlovfielddetail t38 ON t1.eligibilitymethod = t38.fieldcodeid and t38.fieldcode='ELGMETHOD'
			     LEFT JOIN loanpurposes t39 ON t1.finpurpose = t39.loanpurposecode
			UNION ALL
			 SELECT t1.finreference,
			    t1.investmentref,
			    t1.numberofterms,
			    t1.grcperiodenddate,
			    t1.allowgrcperiod,
			    t1.gracebaserate,
			    t1.gracespecialrate,
			    t1.grcpftrate,
			    t1.grcpftfrq,
			    t1.nextgrcpftdate,
			    t1.allowgrcpftrvw,
			    t1.grcpftrvwfrq,
			    t1.nextgrcpftrvwdate,
			    t1.allowgrccpz,
			    t1.grccpzfrq,
			    t1.nextgrccpzdate,
			    t1.repaybaserate,
			    t1.repayspecialrate,
			    t1.repayprofitrate,
			    t1.repayfrq,
			    t1.nextrepaydate,
			    t1.repaypftfrq,
			    t1.nextrepaypftdate,
			    t1.allowrepayrvw,
			    t1.repayrvwfrq,
			    t1.nextrepayrvwdate,
			    t1.allowrepaycpz,
			    t1.repaycpzfrq,
			    t1.nextrepaycpzdate,
			    t1.maturitydate,
			    t1.cpzatgraceend,
			    t1.downpayment,
			    t1.graceflatamount,
			    t1.reqrepayamount,
			    t1.totalprofit,
			    t1.totalcpz,
			    t1.totalgrosspft,
			    t1.totalgrossgrcpft,
			    t1.totalgracepft,
			    t1.totalgracecpz,
			    t1.grcratebasis,
			    t1.repayratebasis,
			    t1.fintype,
			    t1.finremarks,
			    t1.finccy,
			    t1.schedulemethod,
			    t1.profitdaysbasis,
			    t1.reqmaturity,
			    t1.calterms,
			    t1.calmaturity,
			    t1.firstrepay,
			    t1.lastrepay,
			    t1.finstartdate,
			    t1.finamount,
			    t1.finamount + t1.feechargeamt - t1.downpayment AS lovdescfinancingamount,
			    t1.finrepaymentamount,
			    t1.custid,
			    t1.defferments,
			    t1.plandefercount,
			    t1.finbranch,
			    t1.finsourceid,
			    t1.alloweddefrpychange,
			    t1.availeddefrpychange,
			    t1.alloweddeffrqchange,
			    t1.availeddeffrqchange,
			    t1.recaltype,
			    t1.finassetvalue,
			    t1.disbaccountid,
			    t1.repayaccountid,
			    t1.finisactive,
			    t1.limitvalid,
			    t1.overridelimit,
			    t1.securitydeposit,
			    t1.version,
			    t1.lastmntby,
			    t1.lastmnton,
			    t1.recordstatus,
			    t1.rolecode,
			    t1.nextrolecode,
			    t1.taskid,
			    t1.nexttaskid,
			    t1.recordtype,
			    t1.workflowid,
			    t7.fintypedesc AS lovdescfintypename,
			    t7.finmaxamount AS lovdescfinmaxamt,
			    t7.finminamount AS lovdescfinminamount,
			    t1.mindownpayperc,
			    t7.finisalwdifferment AS lovdescfinalwdeferment,
			    t7.finisdwpayrequired AS lovdescdwnpayreq,
			    t7.finmaxdifferment AS lovdescfinmaxdifferment,
			    t12.branchdesc AS lovdescfinbranchname,
			    t1.lastrepaydate,
			    t1.lastrepaypftdate,
			    t1.lastrepayrvwdate,
			    t1.lastrepaycpzdate,
			    t1.allowgrcrepay,
			    t1.grcschdmthd,
			    t1.grcmargin,
			    t1.repaymargin,
			    t1.fincurrassetvalue,
			    t1.fincommitmentref,
			    t1.finlimitref,
			    t1.depreciationfrq,
			    t1.fincontractdate,
			    t1.nextdepdate,
			    t1.lastdepdate,
			    t1.finaccount,
			    t1.fincustpftaccount,
			    t17.acrtilllbd AS lovdescaccruedtilllbd,
			    t7.finrvwrateapplfor,
			    t1.totalrepayamt,
			    t1.closingstatus,
			    t1.finapproveddate,
			    t1.feechargeamt,
			    t1.blacklisted,
			    t1.finrepaypftonfrq,
			    t1.anualizedpercrate,
			    t1.effectiverateofreturn,
			    t1.migratedfinance,
			    t1.schedulemaintained,
			    t1.scheduleregenerated,
			    t1.finpurpose,
			    t39.loanpurposedesc as lovdescfinpurposename,
			    t1.finstatus,
			    t1.finstsreason,
			    t1.initiateuser,
			    t1.bankname,
			    t1.iban,
			    t1.accounttype,
			    t1.ddareferenceno,
			    t7.finscheduleon AS lovdescfinscheduleon,
			    t1.custdsr,
			    t1.jointaccount,
			    t1.jointcustid,
			    t1.downpaybank,
			    t1.downpaysupl,
			    t1.downpayaccount,
			    t1.securitycollateral,
			    t1.approved,
			    t1.discrepancy,
			    t1.limitapproved,
			    t1.graceterms,
			    t7.findivision AS lovdescfindivision,
			    t1.rcdmaintainsts,
			    t1.finrepaymethod,
			    t1.grcprofitdaysbasis,
			    t1.stepfinance,
			    t1.steptype,
			    t1.steppolicy,
			    t1.alwmanualsteps,
			    t1.noofsteps,
			    t1.linkedfinref,
			    t1.nextuserid,
			    t1.priority,
			    t24.policydesc AS lovdescsteppolicyname,
			    t1.grcminrate,
			    t1.grcmaxrate,
			    t1.rpyminrate,
			    t1.rpymaxrate,
			    t1.deviationapproval,
			    t1.manualschedule,
			    t1.takeoverfinance,
			    t1.grcadvbaserate,
			    t1.grcadvmargin,
			    t1.grcadvpftrate,
			    t1.rpyadvbaserate,
			    t1.rpyadvmargin,
			    t1.rpyadvpftrate,
			    t1.supplementrent,
			    t1.increasedcost,
			    t1.rolloverfrq,
			    t1.nextrolloverdate,
			    t27.custstsdescription,
			    t1.shariastatus,
			    t1.initiatedate,
			    t1.finpreapprovedref,
			    t1.mmaid,
			    t1.accountsofficer,
			    t1.feeaccountid,
			    t1.fincancelac,
			    t28.dealername AS lovdescaccountsofficer,
			    t28.dealercity AS lovdescsourcecity,
			    t1.dsacode,
			    t30.rofficerdesc AS dsacodedesc,
			    t1.tdsapplicable,
			    t1.mandateid,
			    t1.droplinefrq,
			    t1.firstdroplinedate,
			    t1.pftservicingodlimit,
			    t1.insuranceamt,
			    t1.deductinsdisb,
			    t1.alwbpi,
			    t1.bpitreatment,
			    t1.planemihalw,
			    t1.planemihmethod,
			    t1.planemihmaxperyear,
			    t1.planemihmax,
			    t1.planemihlockperiod,
			    t1.planemicpz,
			    t1.calroundingmode,
			    t1.alwmultidisb,
			    t1.applicationno,
			    t1.referralid,
			    t33.rofficerdesc AS referraliddesc,
			    t1.dmacode,
			    t34.rofficerdesc AS dmacodedesc,
			    t1.salesdepartment,
			    t35.gendeptdesc AS salesdepartmentdesc,
			    t1.quickdisb,
			    t1.wifreference,
			    t1.unplanemihlockperiod,
			    t1.unplanemicpz,
			    t1.reagecpz,
			    t1.maxunplannedemi,
			    t1.maxreageholidays,
			    t1.availedunplanemi,
			    t1.availedreageh,
			    t1.bpiamount,
			    t1.deductfeedisb,
			    t1.rvwrateapplfor,
			    t1.schcalonrvw,
			    t1.pastduepftcalmthd,
			    t1.pastduepftmargin,
			    t1.droppingmethod,
			    t1.ratechganyday,
			    t1.promotioncode,
			    t1.restructureloan,
			    t1.oldfinreference,
			    t1.reagebucket,
			    t1.fincategory,
			    t1.productcategory,
			    t1.roundingtarget,
			    t36.entitycode AS lovdescentitycode,
			    t1.eligibilitymethod,
			    t38.fieldcodevalue as lovEligibilityMethod,
				t38.valuedesc as lovDescEligibilityMethod,
			    t1.employeename,
			    t37.rofficerdesc AS employeenamedesc,
			    t1.samplingrequired,
			    t1.legalrequired,
			    t1.grcmaxamount
			   FROM financemain t1
			     JOIN rmtfinancetypes t7 ON t1.fintype = t7.fintype
			     LEFT JOIN rmtbranches t12 ON t1.finbranch = t12.branchcode
			     LEFT JOIN finpftdetails t17 ON t17.finreference = t1.finreference
			     LEFT JOIN steppolicyheader t24 ON t1.steppolicy = t24.policycode
			     LEFT JOIN bmtcuststatuscodes t27 ON t1.finstatus = t27.custstscode
			     LEFT JOIN amtvehicledealer t28 ON t1.accountsofficer = t28.dealerid
			     LEFT JOIN relationshipofficers t30 ON t1.dsacode = t30.rofficercode
			     LEFT JOIN relationshipofficers t33 ON t1.referralid = t33.rofficercode
			     LEFT JOIN relationshipofficers t34 ON t1.dmacode = t34.rofficercode
			     LEFT JOIN rmtgendepartments t35 ON t1.salesdepartment = t35.gendepartment
			     LEFT JOIN smtdivisiondetail t36 ON t7.findivision = t36.divisioncode
			     LEFT JOIN relationshipofficers t37 ON t1.employeename = t37.rofficercode
			     LEFT JOIN rmtlovfielddetail t38 ON t1.eligibilitymethod = t38.fieldcodeid and t38.fieldcode='ELGMETHOD'
			     LEFT JOIN loanpurposes t39 ON t1.finpurpose = t39.loanpurposecode
			  WHERE NOT (EXISTS ( SELECT 1 AS expr1
			           FROM financemain_temp
			          WHERE financemain_temp.finreference = t1.finreference))
		</createView>
	</changeSet>
	
	<changeSet id="11" author="Manoj">
		<comment>Task#497-Display Custom notifications along with auto deviations </comment>
		<renameColumn tableName="Financedeviations_temp" oldColumnName="ManualDeviation" newColumnName="DeviationCategory"/>
	</changeSet>
	
	<changeSet id="12" author="Manoj">
		<renameColumn tableName="Financedeviations" oldColumnName="ManualDeviation" newColumnName="DeviationCategory"/>
	</changeSet>
	
	<changeSet id="13" author="Manoj">
			<modifyDataType tableName="FinanceDeviations_Temp" columnName="DeviationCategory" newDataType="Char(1)" />	
	</changeSet>
	
	<changeSet id="14" author="Manoj">
		<modifyDataType tableName="Financedeviations" columnName="DeviationCategory" newDataType="Char(1)" />
	</changeSet>
	
	<changeSet id="15" author="Manoj">
		<sql>
			update FinanceDeviations_Temp set DeviationCategory = 'A' where DeviationCategory = '0'; 
			update FinanceDeviations  set DeviationCategory = 'A' where DeviationCategory = '0'; 
			update FinanceDeviations_Temp set DeviationCategory = 'M' where DeviationCategory = '1'; 
			update FinanceDeviations set DeviationCategory = 'M' where DeviationCategory = '1'; 
		</sql>
	</changeSet>
	
	<changeSet id="16" author="Kesav">
		<comment>Rights for Stage Accounting</comment>
		<sql>
			Update SeqSecGroups Set SeqNo = (Select MAX(GrpID) + 1 from SecGroups);
			Update SeqSecRights Set SeqNo = (Select MAX(RightID) + 1 from SecRights);
			Update SeqSecGroupRights Set SeqNo = (Select MAX(GrpRightID) + 1 from SecGroupRights);
			Update SeqSecRoleGroups Set SeqNo = (Select MAX(RoleGrpID) + 1 from SecRoleGroups);
			
			Delete from SecGroupRights where GrpID In (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker');
			Delete from SecRoleGroups where GrpID IN (Select GrpId from SecGroups WHERE GrpCode = 'StageAccountingRule_Maker') And RoleID IN (Select RoleID from SecRoles WHERE RoleCd = 'MSTGRP1_MAKER');
			Delete from SecGroups where GrpCode = 'StageAccountingRule_Maker';
			INSERT INTO SecGroups Values ((Select MAX(GrpID)+1 From SecGroups), 'StageAccountingRule_Maker','WF Maker for Rules', 1, 1000, CURRENT_TIMESTAMP, NULL, NULL, NULL, NULL, NULL, NULL,0);
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'RuleDialog_ruleCode'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			INSERT INTO SecRoleGroups values ((SELECT MAX(RoleGrpID) + 1 from SecRoleGroups), (Select MAX(GrpId) from SecGroups WHERE GrpCode = 'StageAccountingRule_Maker'), (Select MAX(RoleID) from SecRoles WHERE RoleCd = 'MSTGRP1_MAKER'), 0, 1000, CURRENT_TIMESTAMP, NULL, NULL, NULL, NULL, NULL, NULL, 0);
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'RuleDialog_ruleCodeDesc'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'RuleDialog_ruleEvent'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'RuleDialog_returnType'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'RuleDialog_active'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'RuleDialog_ruleModule'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'RuleDialog_sqlRule'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'button_RuleDialog_btnNew'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'button_RuleDialog_btnEdit'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'button_RuleDialog_btnDelete'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'button_RuleDialog_btnSave'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'menuCat_RulesFactory'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Delete from SecGroupRights where RightID In (Select RightID from SecRights where RightName = 'menuItem_RulesFactory_StageAccountingRule');
			Delete from SecRights where RightName = 'menuItem_RulesFactory_StageAccountingRule';
			Insert into SecRights Values((Select max(RightID) + 1 from SecRights), 0, 'menuItem_RulesFactory_StageAccountingRule', 'MENU', 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'menuItem_RulesFactory_StageAccountingRule'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Delete from SecGroupRights where RightID In (Select RightID from SecRights where RightName = 'button_RuleList_NewStageAccountingRule');
			Delete from SecRights where RightName = 'button_RuleList_NewStageAccountingRule';
			Insert into SecRights Values((Select max(RightID) + 1 from SecRights), 2, 'button_RuleList_NewStageAccountingRule', 'RuleList', 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'button_RuleList_NewStageAccountingRule'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Delete from SecGroupRights where GrpID In (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Approver');
			Delete from SecRoleGroups where GrpID IN (Select GrpId from SecGroups WHERE GrpCode = 'StageAccountingRule_Approver') And RoleID IN (Select RoleID from SecRoles WHERE RoleCd = 'MSTGRP1_APPROVER');
			Delete from SecGroups where GrpCode = 'StageAccountingRule_Approver';
			INSERT INTO SecGroups Values ((Select MAX(GrpID)+1 From SecGroups), 'StageAccountingRule_Approver','WF Approver for Rules', 1, 1000, CURRENT_TIMESTAMP, NULL, NULL, NULL, NULL, NULL, NULL,0);
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Approver'), (Select RightID from SecRights where RightName = 'button_RuleDialog_btnSave'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			INSERT INTO SecRoleGroups values ((SELECT MAX(RoleGrpID) + 1 from SecRoleGroups), (Select MAX(GrpId) from SecGroups WHERE GrpCode = 'StageAccountingRule_Approver'), (Select MAX(RoleID) from SecRoles WHERE RoleCd = 'MSTGRP1_APPROVER'), 0, 1000, CURRENT_TIMESTAMP, NULL, NULL, NULL, NULL, NULL, NULL, 0);
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Approver'), (Select RightID from SecRights where RightName = 'menuCat_RulesFactory'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Approver'), (Select RightID from SecRights where RightName = 'menuItem_RulesFactory_StageAccountingRule'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Update SeqSecGroups Set SeqNo = (Select MAX(GrpID) + 1 from SecGroups);
			Update SeqSecRights Set SeqNo = (Select MAX(RightID) + 1 from SecRights);
			Update SeqSecGroupRights Set SeqNo = (Select MAX(GrpRightID) + 1 from SecGroupRights);
			Update SeqSecRoleGroups Set SeqNo = (Select MAX(RoleGrpID) + 1 from SecRoleGroups);
		</sql>
	</changeSet>
	
	<changeSet id="17" author="Kesav">
		<comment>RBField Details for Stage Accounting</comment>
		<sql>
			Delete from RBFieldDetails where RBModule = 'STGRULE' and  RBEvent ='STGRULE' and RBFldName = 'fm_productCategory';
			Delete from RBFieldDetails where RBModule = 'STGRULE' and  RBEvent ='STGRULE' and RBFldName = 'fm_finType';
			Delete from RBFieldDetails where RBModule = 'STGRULE' and  RBEvent ='STGRULE' and RBFldName = 'ft_product';
			Delete from RBFieldDetails where RBModule = 'STGRULE' and  RBEvent ='STGRULE' and RBFldName = 'rd_paymentType';
			
			Insert into RBFieldDetails Values ('STGRULE','STGRULE','fm_productCategory','Product Category','nvarchar',8,'0','1',' ','static,global',' ');
			Insert into RBFieldDetails Values ('STGRULE','STGRULE','fm_finType','Loan Type','nvarchar',8,'0','1','RMTFinanceTypes','static,global,dbvalue','FinanceType');	
			Insert into RBFieldDetails Values ('STGRULE','STGRULE','ft_product', 'Product','nvarchar',8, 0,0, 'Product','static,global,dbvalue', 'Product');
			Insert into RBFIELDDETAILS values ('STGRULE','STGRULE','rd_paymentType','Payment Type','nvarchar',8,'0','1',' ','static,global',' ');
		</sql>
	</changeSet>
	<changeSet id="18" author="Vasu">
		<sql>
			update workflowdetails set WorkFlowActive='0' where WorkFlowType='CORPORATECREDITREVIEW';
		</sql>
		<insert tableName="WorkFlowDetails">
			<column name="WorkFlowId" valueComputed="(select max(Seqno) + 1 from SeqWorkFlowDetails)"/>
			<column name="WorkFlowType">CORPORATECREDITREVIEW</column>
			<column name="WorkFlowSubType">Corporate Credit Review</column>
			<column name="WorkFlowDesc">Corporate Credit Review</column>
			<column name="JsonDesign" type="nclob"><![CDATA[NULL]]></column>
			<column name="SvgDesign" type="nclob"><![CDATA[NULL]]></column>
            <column name="WorkFlowXml" type="clob"><![CDATA[NULL]]></column>
			<column name="WorkFlowRoles">CCR</column>
			<column name="FirstTaskOwner">CCR</column>
			<column name="WorkFlowActive">1</column>
			<column name="Version">5</column>
			<column name="LastMntBy">1000</column>		
			<column name="LastMntOn" valueDate="current_timestamp"/>
			<column name="RecordStatus">Null</column>
			<column name="RoleCode"></column>
			<column name="NextRoleCode"></column>
			<column name="TaskId"></column>
			<column name="NextTaskId"></column>	
     		<column name="RecordType">NULL</column>		
		</insert>	
	</changeSet>
	<changeSet id="19" author="Vasu">
		<update tableName="WORKFLOWDETAILS">
			<column name="JSONDESIGN" type="NCLOB"><![CDATA[{"resourceId":822,"properties":{"process_id":"CORPORATECREDITREVIEW","name":"Corporate Credit Review","documentation":"Corporate Credit Review","category":"","listenerclass":"","listenerentitytype":""},"stencil":{"id":"BPMNDiagram"},"childShapes":[{"resourceId":"startEvent1","properties":{"overrideid":"","name":"Start"},"stencil":{"id":"StartNoneEvent"},"childShapes":[],"outgoing":[{"resourceId":"sid-515123C5-CB7D-46E1-A063-D799D2FD178B"}],"bounds":{"lowerRight":{"x":130,"y":193},"upperLeft":{"x":100,"y":163}},"dockers":[]},{"resourceId":"sid-40177BF3-5C8D-4E13-8E55-93126967F234","properties":{"overrideid":"","name":"CCR","usertaskassignment":{"assignment":{"type":"idm","idm":{"type":"user","assignee":{"email":"CCR","firstName":"CCR","fullName":"CCR","id":"CCR","roledesc":"CCR Details","$$hashKey":"object:1622"}}}},"additionalforms":"","formkeydefinition":"","prioritydefinition":"Role Queue","baseactor":"","duedatedefinition":"","multiinstance_type":"None","isforcompensation":"false"},"stencil":{"id":"UserTask"},"childShapes":[],"outgoing":[{"resourceId":"sid-CD1A6740-DA0B-498D-B7B6-2274046A6D08"},{"resourceId":"sid-A945B357-BD12-4D7C-A570-901EB63BA094"}],"bounds":{"lowerRight":{"x":275,"y":218},"upperLeft":{"x":175,"y":138}},"dockers":[]},{"resourceId":"sid-515123C5-CB7D-46E1-A063-D799D2FD178B","properties":{"overrideid":"","name":"","repruseaction":"false","conditionsequenceflow":"","defaultflow":"false","action":"","state":"","mandatenotes":"false"},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-40177BF3-5C8D-4E13-8E55-93126967F234"}],"bounds":{"lowerRight":{"x":174.15625,"y":178},"upperLeft":{"x":130.609375,"y":178}},"dockers":[{"x":15,"y":15},{"x":50,"y":40}],"target":{"resourceId":"sid-40177BF3-5C8D-4E13-8E55-93126967F234"}},{"resourceId":"sid-5532A92C-4873-4D7C-B143-DB3C3A163CF9","properties":{"overrideid":"","name":"Complete Process","servicetaskexpression":"doApprove","isforcompensation":"false","multiinstance_type":"None"},"stencil":{"id":"approveTask"},"childShapes":[],"outgoing":[{"resourceId":"sid-CD2E2866-C3A5-40C4-A152-9280082949F8"}],"bounds":{"lowerRight":{"x":670,"y":218},"upperLeft":{"x":570,"y":138}},"dockers":[]},{"resourceId":"sid-F4AF09CD-2EB1-424D-A5FA-EF81E7B014E8","properties":{"overrideid":"","name":"End"},"stencil":{"id":"EndNoneEvent"},"childShapes":[],"outgoing":[],"bounds":{"lowerRight":{"x":898,"y":192},"upperLeft":{"x":870,"y":164}},"dockers":[]},{"resourceId":"sid-A4322A8F-BC65-426D-9928-816E149E5F68","properties":{"overrideid":"","name":"","sequencefloworder":""},"stencil":{"id":"ExclusiveGateway"},"childShapes":[],"outgoing":[{"resourceId":"sid-99EFE39E-CB76-42B5-A51A-B75F9B2DE167"},{"resourceId":"sid-27DA2ED6-52C9-4B2A-A23F-2ADD1B8D6A9A"}],"bounds":{"lowerRight":{"x":385,"y":198},"upperLeft":{"x":345,"y":158}},"dockers":[]},{"resourceId":"sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B","properties":{"overrideid":"","name":"Reject","servicetaskexpression":"doReject","isforcompensation":"false","multiinstance_type":"None"},"stencil":{"id":"rejectTask"},"childShapes":[],"outgoing":[{"resourceId":"sid-4B7910F8-E94A-43D4-8484-CEFF0485DF0E"}],"bounds":{"lowerRight":{"x":415,"y":349},"upperLeft":{"x":315,"y":269}},"dockers":[]},{"resourceId":"sid-E62880BF-36DA-43D7-98E7-8D49E33BB9C3","properties":{"overrideid":"","name":"End"},"stencil":{"id":"EndNoneEvent"},"childShapes":[],"outgoing":[],"bounds":{"lowerRight":{"x":544.6666717529297,"y":323},"upperLeft":{"x":516.6666717529297,"y":295}},"dockers":[]},{"resourceId":"sid-4B7910F8-E94A-43D4-8484-CEFF0485DF0E","properties":{"overrideid":"","name":"","repruseaction":"false","conditionsequenceflow":"","defaultflow":"false","action":"","state":"","mandatenotes":"false"},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-E62880BF-36DA-43D7-98E7-8D49E33BB9C3"}],"bounds":{"lowerRight":{"x":516.0768275856972,"y":309},"upperLeft":{"x":415.182293176651,"y":309}},"dockers":[{"x":50,"y":40},{"x":14,"y":14}],"target":{"resourceId":"sid-E62880BF-36DA-43D7-98E7-8D49E33BB9C3"}},{"resourceId":"sid-CD2E2866-C3A5-40C4-A152-9280082949F8","properties":{"overrideid":"","name":"","repruseaction":"false","conditionsequenceflow":"","defaultflow":"false","action":"","state":"","mandatenotes":"false"},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-F4AF09CD-2EB1-424D-A5FA-EF81E7B014E8"}],"bounds":{"lowerRight":{"x":869.59375,"y":178},"upperLeft":{"x":670.5,"y":178}},"dockers":[{"x":50,"y":40},{"x":14,"y":14}],"target":{"resourceId":"sid-F4AF09CD-2EB1-424D-A5FA-EF81E7B014E8"}},{"resourceId":"sid-CD1A6740-DA0B-498D-B7B6-2274046A6D08","properties":{"overrideid":"","name":"","repruseaction":false,"conditionsequenceflow":{"expression":{"type":"static","staticValue":""}},"defaultflow":"false","action":"","state":"","mandatenotes":"false","showdiamondmarker":false},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-A4322A8F-BC65-426D-9928-816E149E5F68"}],"bounds":{"lowerRight":{"x":344.8593912124634,"y":178},"upperLeft":{"x":275.7656316757202,"y":178}},"dockers":[{"x":50,"y":40},{"x":31.66668701171875,"y":20}],"target":{"resourceId":"sid-A4322A8F-BC65-426D-9928-816E149E5F68"}},{"resourceId":"sid-99EFE39E-CB76-42B5-A51A-B75F9B2DE167","properties":{"overrideid":"","name":"Approve","repruseaction":true,"conditionsequenceflow":{"expression":{"type":"static","staticValue":"vo.recordStatus == 'Approved'"}},"defaultflow":"false","action":"Approve","state":"Approved","mandatenotes":"false"},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-5532A92C-4873-4D7C-B143-DB3C3A163CF9"}],"bounds":{"lowerRight":{"x":569.2929706798927,"y":178.4609259922493},"upperLeft":{"x":385.3886699451072,"y":178.0996208827507}},"dockers":[{"x":20.5,"y":20.5},{"x":50,"y":40}],"target":{"resourceId":"sid-5532A92C-4873-4D7C-B143-DB3C3A163CF9"}},{"resourceId":"sid-27DA2ED6-52C9-4B2A-A23F-2ADD1B8D6A9A","properties":{"overrideid":"","name":"","repruseaction":false,"conditionsequenceflow":{"expression":{"type":"static","staticValue":"vo.recordStatus == 'Rejected'"}},"defaultflow":"false","action":"","state":"","mandatenotes":true},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B"}],"bounds":{"lowerRight":{"x":365.4219498604973,"y":268.2382885897997},"upperLeft":{"x":365.1561751395027,"y":198.8710864102003}},"dockers":[{"x":20.5,"y":20.5},{"x":50,"y":40}],"target":{"resourceId":"sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B"}},{"resourceId":"sid-A945B357-BD12-4D7C-A570-901EB63BA094","properties":{"overrideid":"","name":"Cancel","repruseaction":true,"conditionsequenceflow":{"expression":{"type":"static","staticValue":"vo.recordStatus == 'Cancelled'"}},"defaultflow":"false","action":"Cancel","state":"Cancelled","mandatenotes":true},"stencil":{"id":"SequenceFlow"},"childShapes":[],"outgoing":[{"resourceId":"sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B"}],"bounds":{"lowerRight":{"x":314.78125,"y":309},"upperLeft":{"x":225,"y":218.9140625}},"dockers":[{"x":50,"y":40},{"x":225,"y":309},{"x":50,"y":40}],"target":{"resourceId":"sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B"}}],"bounds":{"lowerRight":{"x":1200,"y":1050},"upperLeft":{"x":0,"y":0}},"stencilset":{"url":"stencilsets/bpmn2.0/bpmn2.0.json","namespace":"http://b3mn.org/stencilset/bpmn2.0#"},"ssextensions":[]}]]></column>
			<column name="WORKFLOWXML" type="CLOB"><![CDATA[<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://activiti.org/test"><process id="CORPORATECREDITREVIEW" name="Corporate Credit Review" isExecutable="true"><documentation>Corporate Credit Review</documentation><startEvent id="startEvent1" name="Start"/><userTask id="sid-40177BF3-5C8D-4E13-8E55-93126967F234" name="CCR" activiti:actor="CCR" activiti:assignmentLevel="Role Queue"/><sequenceFlow id="sid-515123C5-CB7D-46E1-A063-D799D2FD178B" sourceRef="startEvent1" targetRef="sid-40177BF3-5C8D-4E13-8E55-93126967F234" representsUserAction="false" mandateNotes="false"/><serviceTask id="sid-5532A92C-4873-4D7C-B143-DB3C3A163CF9" name="Complete Process" activiti:operation="doApprove"/><endEvent id="sid-F4AF09CD-2EB1-424D-A5FA-EF81E7B014E8" name="End"/><exclusiveGateway id="sid-A4322A8F-BC65-426D-9928-816E149E5F68"/><serviceTask id="sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B" name="Reject" activiti:operation="doReject"/><endEvent id="sid-E62880BF-36DA-43D7-98E7-8D49E33BB9C3" name="End"/><sequenceFlow id="sid-4B7910F8-E94A-43D4-8484-CEFF0485DF0E" sourceRef="sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B" targetRef="sid-E62880BF-36DA-43D7-98E7-8D49E33BB9C3" representsUserAction="false" mandateNotes="false"/><sequenceFlow id="sid-CD2E2866-C3A5-40C4-A152-9280082949F8" sourceRef="sid-5532A92C-4873-4D7C-B143-DB3C3A163CF9" targetRef="sid-F4AF09CD-2EB1-424D-A5FA-EF81E7B014E8" representsUserAction="false" mandateNotes="false"/><sequenceFlow id="sid-CD1A6740-DA0B-498D-B7B6-2274046A6D08" sourceRef="sid-40177BF3-5C8D-4E13-8E55-93126967F234" targetRef="sid-A4322A8F-BC65-426D-9928-816E149E5F68" representsUserAction="false" mandateNotes="false"/><sequenceFlow id="sid-99EFE39E-CB76-42B5-A51A-B75F9B2DE167" name="Approve" sourceRef="sid-A4322A8F-BC65-426D-9928-816E149E5F68" targetRef="sid-5532A92C-4873-4D7C-B143-DB3C3A163CF9" action="Approve" state="Approved" representsUserAction="true" mandateNotes="false"><conditionExpression xsi:type="tFormalExpression">vo.recordStatus == 'Approved'</conditionExpression></sequenceFlow><sequenceFlow id="sid-27DA2ED6-52C9-4B2A-A23F-2ADD1B8D6A9A" sourceRef="sid-A4322A8F-BC65-426D-9928-816E149E5F68" targetRef="sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B" representsUserAction="false" mandateNotes="true"><conditionExpression xsi:type="tFormalExpression">vo.recordStatus == 'Rejected'</conditionExpression></sequenceFlow><sequenceFlow id="sid-A945B357-BD12-4D7C-A570-901EB63BA094" name="Cancel" sourceRef="sid-40177BF3-5C8D-4E13-8E55-93126967F234" targetRef="sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B" action="Cancel" state="Cancelled" representsUserAction="true" mandateNotes="true"><conditionExpression xsi:type="tFormalExpression">vo.recordStatus == 'Cancelled'</conditionExpression></sequenceFlow></process><bpmndi:BPMNDiagram id="BPMNDiagram_CORPORATECREDITREVIEW"><bpmndi:BPMNPlane bpmnElement="CORPORATECREDITREVIEW" id="BPMNPlane_CORPORATECREDITREVIEW"><bpmndi:BPMNShape bpmnElement="startEvent1" id="BPMNShape_startEvent1"><omgdc:Bounds height="30.0" width="30.0" x="100.0" y="163.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-40177BF3-5C8D-4E13-8E55-93126967F234" id="BPMNShape_sid-40177BF3-5C8D-4E13-8E55-93126967F234"><omgdc:Bounds height="80.0" width="100.0" x="175.0" y="138.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-5532A92C-4873-4D7C-B143-DB3C3A163CF9" id="BPMNShape_sid-5532A92C-4873-4D7C-B143-DB3C3A163CF9"><omgdc:Bounds height="80.0" width="100.0" x="570.0" y="138.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-F4AF09CD-2EB1-424D-A5FA-EF81E7B014E8" id="BPMNShape_sid-F4AF09CD-2EB1-424D-A5FA-EF81E7B014E8"><omgdc:Bounds height="28.0" width="28.0" x="870.0" y="164.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-A4322A8F-BC65-426D-9928-816E149E5F68" id="BPMNShape_sid-A4322A8F-BC65-426D-9928-816E149E5F68"><omgdc:Bounds height="40.0" width="40.0" x="345.0" y="158.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B" id="BPMNShape_sid-3E2CFF23-532A-4A7C-9FF4-F93DC6F1B39B"><omgdc:Bounds height="80.0" width="100.0" x="315.0" y="269.0"/></bpmndi:BPMNShape><bpmndi:BPMNShape bpmnElement="sid-E62880BF-36DA-43D7-98E7-8D49E33BB9C3" id="BPMNShape_sid-E62880BF-36DA-43D7-98E7-8D49E33BB9C3"><omgdc:Bounds height="28.0" width="28.0" x="516.6666717529297" y="295.0"/></bpmndi:BPMNShape><bpmndi:BPMNEdge bpmnElement="sid-4B7910F8-E94A-43D4-8484-CEFF0485DF0E" id="BPMNEdge_sid-4B7910F8-E94A-43D4-8484-CEFF0485DF0E"><omgdi:waypoint x="415.0" y="309.0"/><omgdi:waypoint x="516.6666717529297" y="309.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-CD2E2866-C3A5-40C4-A152-9280082949F8" id="BPMNEdge_sid-CD2E2866-C3A5-40C4-A152-9280082949F8"><omgdi:waypoint x="670.0" y="178.0"/><omgdi:waypoint x="870.0" y="178.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-CD1A6740-DA0B-498D-B7B6-2274046A6D08" id="BPMNEdge_sid-CD1A6740-DA0B-498D-B7B6-2274046A6D08"><omgdi:waypoint x="275.0" y="178.0"/><omgdi:waypoint x="345.0" y="178.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-515123C5-CB7D-46E1-A063-D799D2FD178B" id="BPMNEdge_sid-515123C5-CB7D-46E1-A063-D799D2FD178B"><omgdi:waypoint x="130.0" y="178.0"/><omgdi:waypoint x="175.0" y="178.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-27DA2ED6-52C9-4B2A-A23F-2ADD1B8D6A9A" id="BPMNEdge_sid-27DA2ED6-52C9-4B2A-A23F-2ADD1B8D6A9A"><omgdi:waypoint x="365.42692307692306" y="197.57307692307694"/><omgdi:waypoint x="365.15325670498083" y="269.0"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-99EFE39E-CB76-42B5-A51A-B75F9B2DE167" id="BPMNEdge_sid-99EFE39E-CB76-42B5-A51A-B75F9B2DE167"><omgdi:waypoint x="384.53740157480314" y="178.46259842519686"/><omgdi:waypoint x="570.0" y="178.098231827112"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bpmnElement="sid-A945B357-BD12-4D7C-A570-901EB63BA094" id="BPMNEdge_sid-A945B357-BD12-4D7C-A570-901EB63BA094"><omgdi:waypoint x="225.0" y="218.0"/><omgdi:waypoint x="225.0" y="309.0"/><omgdi:waypoint x="315.0" y="309.0"/></bpmndi:BPMNEdge></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></definitions>]]></column>
			<where>workflowtype='CORPORATECREDITREVIEW'and workflowactive=1
			</where>
		</update>
	</changeSet>
	<changeSet id="20" author="Vasu">
		<sql>
			UPDATE SeqWorkFlowDetails SET SEQNO= (SELECT MAX(WorkflowId)+1 FROM workflowdetails);
		</sql>
	</changeSet> 
	<changeSet id="21" author="Srikanth.m">
	<renameColumn tableName="MANDATE_REQUESTS" oldColumnName="AUXILIARY_FIELD1" newColumnName="NUMBER_OF_TERMS"/>
	<renameColumn tableName="MANDATE_REQUESTS" oldColumnName="AUXILIARY_FIELD2" newColumnName="FREQUENCY"/>
	<renameColumn tableName="MANDATE_RESPONSE" oldColumnName="AUXILIARY_FIELD1" newColumnName="NUMBER_OF_TERMS"/>
	<renameColumn tableName="MANDATE_RESPONSE" oldColumnName="AUXILIARY_FIELD2" newColumnName="FREQUENCY"/>
	</changeSet>
	<changeSet id="22" author="Srikanth.m">
	<createView viewName="INT_MANDATE_REQUEST_VIEW" replaceIfExists="true">
	SELECT M.MANDATEID, 
			BD.BANKSHORTCODE BANKCODE,
			BD.BANKNAME,
			case when LB.BRANCHCODE IS NULL THEN CB.BRANCHCODE ELSE LB.BRANCHCODE END BRANCHCODE,
      		case when LB.BRANCHDESC IS NULL THEN CB.BRANCHDESC ELSE LB.BRANCHDESC END BRANCHDESC,
			CUST.CUSTCIF,
			CUST.CUSTSHRTNAME,
			FT.FINTYPEDESC FINTYPE ,
			FIN.FINREFERENCE ,
			COALESCE((SELECT SUM(TotalAmount) from (Select MAX(FSD.REPAYAMOUNT+FSD.FEESCHD) TotalAmount 
													FROM FINSCHEDULEDETAILS FSD 
													INNER JOIN FINANCEMAIN FM ON FM.FINREFERENCE =FSD.FINREFERENCE AND FM.CUSTID = M.CUSTID 
													GROUP BY FM.FINREFERENCE)T)/CCYMINORCCYUNITS, 0) CUST_EMI,
			COALESCE((SELECT SUM(TotalAmount) from (Select MAX(FSD.REPAYAMOUNT+FSD.FEESCHD) TotalAmount FROM FINSCHEDULEDETAILS FSD WHERE (REPAYONSCHDATE = 1 OR PFTONSCHDATE = 1) AND FINREFERENCE IN (SELECT FINREFERENCE FROM FINANCEMAIN WHERE MANDATEID = M.MANDATEID) GROUP BY FINREFERENCE)T)/CCYMINORCCYUNITS, 0) EMI,
			  CASE M.OPENMANDATE
			    WHEN 1
			    THEN 'New Open ECS'
			    ELSE 'No Open ECS'
			  END OPENMANDATE,
			M.ACCNUMBER,
			CASE WHEN M.ACCTYPE = '10' then 'Savings Account' WHEN M.ACCTYPE = '11' then 'Current Account' WHEN M.ACCTYPE = '11' then 'Cash Credit Account' ELSE  M.ACCTYPE END ACCTYPE,
			M.ACCHOLDERNAME,
			BB.MICR,
			BB.IFSC,
			BB.ADDOFBRANCH,
			(select MIN(FIRSTREPAYDATE) from FINPFTDETAILS where FINREFERENCE IN (SELECT FINREFERENCE FROM FINANCEMAIN WHERE MANDATEID=M.MANDATEID)) FIRSTDUEDATE,
			(select MAX(SCHDATE) from FINSCHEDULEDETAILS where (REPAYONSCHDATE = 1 OR PFTONSCHDATE = 1) and FINREFERENCE IN (SELECT FINREFERENCE FROM FINANCEMAIN WHERE MANDATEID=M.MANDATEID)) EMIENDDATE,
			 COALESCE (M.MAXLIMIT/CCYMINORCCYUNITS, 0) MAXLIMIT, 
     		 COALESCE((SELECT SUM(MANDATEDEBITAMOUNT) from (Select MAX(REPAYAMOUNT+FEESCHD) MANDATEDEBITAMOUNT FROM FINSCHEDULEDETAILS WHERE (REPAYONSCHDATE = 1 OR PFTONSCHDATE = 1) AND FINREFERENCE IN (SELECT FINREFERENCE FROM FINANCEMAIN WHERE MANDATEID=M.MANDATEID)
     		 GROUP BY FINREFERENCE)T), 0)/CCYMINORCCYUNITS DEBITAMOUNT,
         (select max(numberofterms) from Financemain where FINREFERENCE IN (SELECT FINREFERENCE FROM FINANCEMAIN WHERE MANDATEID=M.MANDATEID)) numberofterms,
        M.periodicity,
			  M.STARTDATE,
			  M.EXPIRYDATE,
			  FIN.APPLICATIONNO,
			  M.MANDATETYPE,
			  M.STATUS,
			  M.INPUTDATE,
			  M.RECORDSTATUS,
			  M.RECORDTYPE,
        	M.MANDATECCY,
			  COALESCE (CCY.CCYMINORCCYUNITS, 100) CCYMINORCCYUNITS,M.EntityCode,
              CP.PHONENUMBER,
			CE.CUSTEMAIL
			FROM MANDATES M
			INNER JOIN BANKBRANCHES BB ON BB.BANKBRANCHID = M.BANKBRANCHID
			INNER JOIN BMTBANKDETAIL BD ON BD.BANKCODE=BB.BANKCODE 
			INNER JOIN CUSTOMERS CUST   ON CUST.CUSTID = M.CUSTID
			INNER JOIN RMTBRANCHES CB ON CB.BRANCHCODE = CUST.CUSTDFTBRANCH 
			LEFT JOIN CUSTOMEREMAILS CE ON CE.CUSTID = CUST.CUSTID AND CE.CUSTEMAILPRIORITY = 5
			LEFT JOIN CUSTOMERPHONENUMBERS CP ON CP.PHONECUSTID = CUST.CUSTID AND CP.PHONETYPEPRIORITY = 5
			LEFT OUTER JOIN RMTCURRENCIES CCY ON CCY.CCYCODE = M.MANDATECCY
			LEFT OUTER JOIN FINANCEMAIN FIN ON M.ORGREFERENCE=FIN.FINREFERENCE
			LEFT JOIN RMTBRANCHES LB ON LB.BRANCHCODE = FIN.FINBRANCH 
			LEFT OUTER JOIN RMTFINANCETYPES FT ON FIN.FINTYPE =FT.FINTYPE 
			WHERE M.STATUS = 'NEW' AND M.MANDATEID NOT IN  (select MANDATEID FROM MANDATE_REQUESTS where (status = 'AC' OR status = 'NEW'))
	</createView>
	</changeSet>
	<changeSet id="23" author="Vijaykumar.l">
		<sql>
			update ExtendedFieldHeader set modulename='VAS' where modulename='Vas';
			update ExtendedFieldHeader_Temp set modulename='VAS' where modulename='Vas';
		</sql>
	</changeSet>
	<changeSet id="24" author="Kesav">
		<comment>RBFieldDetails and Stage Accouting Rule Rights</comment>
		<sql>
			Delete from RBFieldDetails where RBModule = 'STGRULE' and  RBEvent ='STGRULE' and RBFldName = 'fm_productCategory';
			Delete from RBFieldDetails where RBModule = 'STGRULE' and  RBEvent ='STGRULE' and RBFldName = 'fm_finType';
			Delete from RBFieldDetails where RBModule = 'STGRULE' and  RBEvent ='STGRULE' and RBFldName = 'ft_product';
			Delete from RBFieldDetails where RBModule = 'STGRULE' and  RBEvent ='STGRULE' and RBFldName = 'rd_paymentType';
			
			Insert into RBFieldDetails Values ('STGRULE','STGRULE','fm_productCategory','Product Category','nvarchar',8,'0','1',' ','static,global',' ');
			Insert into RBFieldDetails Values ('STGRULE','STGRULE','fm_finType','Loan Type','nvarchar',8,'0','1','RMTFinanceTypes','static,global,dbvalue','FinanceType');	
			Insert into RBFieldDetails Values ('STGRULE','STGRULE','ft_product', 'Product','nvarchar',8, 0,0, 'Product','static,global,dbvalue', 'Product');
			Insert into RBFIELDDETAILS values ('STGRULE','STGRULE','rd_paymentType','Payment Type','nvarchar',8,'0','1',' ','static,global',' ');
			
			Update SeqSecGroups Set SeqNo = (Select MAX(GrpID) + 1 from SecGroups);
			Update SeqSecRights Set SeqNo = (Select MAX(RightID) + 1 from SecRights);
			Update SeqSecGroupRights Set SeqNo = (Select MAX(GrpRightID) + 1 from SecGroupRights);
			Update SeqSecRoleGroups Set SeqNo = (Select MAX(RoleGrpID) + 1 from SecRoleGroups);
			
			Delete from SecGroupRights where GrpID In (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker');
			Delete from SecRoleGroups where GrpID IN (Select GrpId from SecGroups WHERE GrpCode = 'StageAccountingRule_Maker') And RoleID IN (Select RoleID from SecRoles WHERE RoleCd = 'MSTGRP1_MAKER');
			Delete from SecGroups where GrpCode = 'StageAccountingRule_Maker';
			INSERT INTO SecGroups Values ((Select MAX(GrpID)+1 From SecGroups), 'StageAccountingRule_Maker','WF Maker for Rules', 1, 1000, CURRENT_TIMESTAMP, NULL, NULL, NULL, NULL, NULL, NULL,0);
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'RuleDialog_ruleCode'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			INSERT INTO SecRoleGroups values ((SELECT MAX(RoleGrpID) + 1 from SecRoleGroups), (Select MAX(GrpId) from SecGroups WHERE GrpCode = 'StageAccountingRule_Maker'), (Select MAX(RoleID) from SecRoles WHERE RoleCd = 'MSTGRP1_MAKER'), 0, 1000, CURRENT_TIMESTAMP, NULL, NULL, NULL, NULL, NULL, NULL, 0);
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'RuleDialog_ruleCodeDesc'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'RuleDialog_ruleEvent'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'RuleDialog_returnType'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'RuleDialog_active'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'RuleDialog_ruleModule'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'RuleDialog_sqlRule'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'button_RuleDialog_btnNew'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'button_RuleDialog_btnEdit'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'button_RuleDialog_btnDelete'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'button_RuleDialog_btnSave'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'menuCat_RulesFactory'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Delete from SecGroupRights where RightID In (Select RightID from SecRights where RightName = 'menuItem_RulesFactory_StageAccountingRule');
			Delete from SecRights where RightName = 'menuItem_RulesFactory_StageAccountingRule';
			Insert into SecRights Values((Select max(RightID) + 1 from SecRights), 0, 'menuItem_RulesFactory_StageAccountingRule', 'MENU', 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'menuItem_RulesFactory_StageAccountingRule'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Delete from SecGroupRights where RightID In (Select RightID from SecRights where RightName = 'button_RuleList_NewStageAccountingRule');
			Delete from SecRights where RightName = 'button_RuleList_NewStageAccountingRule';
			Insert into SecRights Values((Select max(RightID) + 1 from SecRights), 2, 'button_RuleList_NewStageAccountingRule', 'RuleList', 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Maker'), (Select RightID from SecRights where RightName = 'button_RuleList_NewStageAccountingRule'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Delete from SecGroupRights where GrpID In (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Approver');
			Delete from SecRoleGroups where GrpID IN (Select GrpId from SecGroups WHERE GrpCode = 'StageAccountingRule_Approver') And RoleID IN (Select RoleID from SecRoles WHERE RoleCd = 'MSTGRP1_APPROVER');
			Delete from SecGroups where GrpCode = 'StageAccountingRule_Approver';
			INSERT INTO SecGroups Values ((Select MAX(GrpID)+1 From SecGroups), 'StageAccountingRule_Approver','WF Approver for Rules', 1, 1000, CURRENT_TIMESTAMP, NULL, NULL, NULL, NULL, NULL, NULL,0);
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Approver'), (Select RightID from SecRights where RightName = 'button_RuleDialog_btnSave'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			INSERT INTO SecRoleGroups values ((SELECT MAX(RoleGrpID) + 1 from SecRoleGroups), (Select MAX(GrpId) from SecGroups WHERE GrpCode = 'StageAccountingRule_Approver'), (Select MAX(RoleID) from SecRoles WHERE RoleCd = 'MSTGRP1_APPROVER'), 0, 1000, CURRENT_TIMESTAMP, NULL, NULL, NULL, NULL, NULL, NULL, 0);
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Approver'), (Select RightID from SecRights where RightName = 'menuCat_RulesFactory'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Insert into secGroupRights Values((Select max(GrpRightID) + 1 from SecGroupRights), (Select GrpID from SecGroups where GrpCode = 'StageAccountingRule_Approver'), (Select RightID from SecRights where RightName = 'menuItem_RulesFactory_StageAccountingRule'), 1, 1, 1000, CURRENT_TIMESTAMP, null, null, null, null, null, null, 0 );
			
			Update SeqSecGroups Set SeqNo = (Select MAX(GrpID) + 1 from SecGroups);
			Update SeqSecRights Set SeqNo = (Select MAX(RightID) + 1 from SecRights);
			Update SeqSecGroupRights Set SeqNo = (Select MAX(GrpRightID) + 1 from SecGroupRights);
			Update SeqSecRoleGroups Set SeqNo = (Select MAX(RoleGrpID) + 1 from SecRoleGroups);
		</sql>
	</changeSet>
	<changeSet id="25" author="Kesav">
		<createView viewName="LMTFINREFDETAIL_ACVIEW" replaceIfExists="true">
			SELECT  t1.finrefdetailid,
				    t1.fintype,
				    t1.finreftype,
				    t1.finrefid,
				    t1.isactive,
				    t1.showinstage,
				    t1.mandinputinstage,
				    t1.allowinputinstage,
				    t1.allowdeviation,
				    t1.allowwaiver,
				    t1.allowpostpone,
				    t1.allowexpire,
				    t1.version,
				    t1.lastmntby,
				    t1.lastmnton,
				    t1.recordstatus,
				    t1.rolecode,
				    t1.nextrolecode,
				    t1.taskid,
				    t1.nexttaskid,
				    t1.recordtype,
				    t1.workflowid,
				    COALESCE(t2.fintypedesc, t4.collateraldesc, t5.productdesc) AS lovdescfintypedescname,
				    t1.override,
				    t1.overridevalue,
				    t1.finevent,
				    t1.alerttype,
					t3.rulecode AS lovdescnamelov,
				    t3.rulecode AS lovdesccodelov,
				    t3.rulecodedesc AS lovdescrefdesc,
				    t3.sqlrule AS lovDescStgRuleValue
				   FROM lmtfinrefdetail t1
				     LEFT JOIN rmtfinancetypes t2 ON t1.fintype = t2.fintype
				     LEFT JOIN collateralstructure t4 ON t1.fintype = t4.collateraltype
				     LEFT JOIN vasstructure t5 ON t1.fintype = t5.productcode
					 JOIN rules t3 ON t1.finrefid = t3.ruleid AND t1.finreftype = 5		
		</createView>
	</changeSet>
	<changeSet id="26" author="Kesav">
		<createView viewName="LMTFINREFDETAIL_TCVIEW" replaceIfExists="true">
			SELECT  t1.finrefdetailid,
				    t1.fintype,
				    t1.finreftype,
				    t1.finrefid,
				    t1.isactive,
				    t1.showinstage,
				    t1.mandinputinstage,
				    t1.allowinputinstage,
				    t1.allowdeviation,
				    t1.allowwaiver,
				    t1.allowpostpone,
				    t1.allowexpire,
				    t1.version,
				    t1.lastmntby,
				    t1.lastmnton,
				    t1.recordstatus,
				    t1.rolecode,
				    t1.nextrolecode,
				    t1.taskid,
				    t1.nexttaskid,
				    t1.recordtype,
				    t1.workflowid,
				    COALESCE(t2.fintypedesc, t4.collateraldesc, t5.productdesc) AS lovdescfintypedescname,
				    t1.override,
				    t1.overridevalue,
				    t1.finevent,
				    t1.alerttype,
					t3.rulecode AS lovdescnamelov,
				    t3.rulecode AS lovdesccodelov,
				    t3.rulecodedesc AS lovdescrefdesc,
				    t3.sqlrule AS lovDescStgRuleValue
				   FROM lmtfinrefdetail_temp t1
				     LEFT JOIN rmtfinancetypes t2 ON t1.fintype = t2.fintype
				     LEFT JOIN collateralstructure t4 ON t1.fintype = t4.collateraltype
				     LEFT JOIN vasstructure t5 ON t1.fintype = t5.productcode
					 JOIN rules t3 ON t1.finrefid = t3.ruleid AND t1.finreftype = 5
				UNION ALL
				 SELECT t1.finrefdetailid,
				    t1.fintype,
				    t1.finreftype,
				    t1.finrefid,
				    t1.isactive,
				    t1.showinstage,
				    t1.mandinputinstage,
				    t1.allowinputinstage,
				    t1.allowdeviation,
				    t1.allowwaiver,
				    t1.allowpostpone,
				    t1.allowexpire,
				    t1.version,
				    t1.lastmntby,
				    t1.lastmnton,
				    t1.recordstatus,
				    t1.rolecode,
				    t1.nextrolecode,
				    t1.taskid,
				    t1.nexttaskid,
				    t1.recordtype,
				    t1.workflowid,
				    COALESCE(t2.fintypedesc, t4.collateraldesc, t5.productdesc) AS lovdescfintypedescname,
				    t1.override,
				    t1.overridevalue,
				    t1.finevent,
				    t1.alerttype,
					t3.rulecode AS lovdescnamelov,
				    t3.rulecode AS lovdesccodelov,
				    t3.rulecodedesc AS lovdescrefdesc,
				    t3.sqlrule AS lovDescStgRuleValue
				   FROM lmtfinrefdetail t1
				     LEFT JOIN rmtfinancetypes t2 ON t1.fintype = t2.fintype
				     LEFT JOIN collateralstructure t4 ON t1.fintype = t4.collateraltype
				     LEFT JOIN vasstructure t5 ON t1.fintype = t5.productcode
					 JOIN rules t3 ON t1.finrefid = t3.ruleid AND t1.finreftype = 5
				  WHERE NOT (EXISTS ( SELECT 1 AS expr1
				           FROM lmtfinrefdetail_temp
				          WHERE lmtfinrefdetail_temp.finrefdetailid = t1.finrefdetailid))	
		</createView>
	</changeSet>
	
	<changeSet id="24" author="Manoj" dbms="postgresql">
		<dropSequence sequenceName="cibil_file_info_id_seq"/>
	</changeSet>
	
	<changeSet id="25.1" author="Manoj" dbms="postgresql">
		<createSequence sequenceName="cibil_file_info_id_seq"/>
	</changeSet>
	<changeSet id="25" author="Manoj" dbms="postgresql">
		<sql>
			ALTER TABLE cibil_file_info ALTER COLUMN id SET DEFAULT nextval('cibil_file_info_id_seq');
		</sql>
	</changeSet>
	
	
	<changeSet id="27" author="Manoj">
		<sql>
			Insert into data_engine_config (ID,NAME,DESCRIPTION,PARSER,WORKSHEET,TEXTQUALIFIER,ROWDELIMITER,COLUMNDELIMITER,STARTINGROW,SKIPHEADERROW,FIELDNAMES,HEADER,TRAILER,UPLOADLOCATION,UPLOADPATH,FILEPREFIXNAME,FILEEXTENSION,FILESEQUENCENO,LASTPROCESSEDON,FILENAMEFORMAT,CRONEXPRESSION,NOTIFICATIONSTATUSEMAIL,POSTEVENT,BACKUPFILE,ACTIVE) values ((SELECT COALESCE(MAX(ID), 0) + 1 FROM DATA_ENGINE_CONFIG),'CIBIL_REPORT','Cibil Report',5,null,null,null,null,0,0,
			'', '', '','A',null,'DBFILE',null,0,null,null,null,'0',null,1,1);	
		</sql>
	</changeSet>
	
	<changeSet id="28" author="Manoj">
		<createView viewName="CIBIL_CUSTOMER_LOANS_VIEW" replaceIfExists="true">
			SELECT  
				CU.CUSTID,
				COALESCE(AT.CODE, '00') FINTYPE,
				FM.FINREFERENCE, 
				FM.FINSTARTDATE,
				FM.FINAPPROVEDDATE,
				PD.LATESTRPYDATE,
				UDF_CONVERTCURRENCY(FINASSETVALUE, FM.FINCCY, 'INR') FINASSETVALUE,
				UDF_CONVERTCURRENCY(PD.TOTALPRIBAL, FM.FINCCY, 'INR') FUTURE_SCHEDULE_PRIN,
				UDF_CONVERTCURRENCY((PD.ODPRINCIPAL + PD.ODPROFIT), FM.FINCCY, 'INR') INSTALMENT_DUE,
				UDF_CONVERTCURRENCY((PD.TOTALPFTPAID + PD.TOTALPRIPAID), FM.FINCCY, 'INR') INSTALMENT_PAID,
				UDF_CONVERTCURRENCY(BOUNCE_DUE, FM.FINCCY, 'INR') BOUNCE_DUE,
				UDF_CONVERTCURRENCY(BOUNCE_PAID, FM.FINCCY, 'INR') BOUNCE_PAID,
				UDF_CONVERTCURRENCY(LATE_PAYMENT_PENALTY_DUE, FM.FINCCY, 'INR') LATE_PAYMENT_PENALTY_DUE,
				UDF_CONVERTCURRENCY(LATE_PAYMENT_PENALTY_PAID,FM.FINCCY, 'INR') LATE_PAYMENT_PENALTY_PAID,
				UDF_CONVERTCURRENCY(TOTALPRISCHD, FM.FINCCY, 'INR') TOTAL_PRI_SCHD,
				UDF_CONVERTCURRENCY(TOTALPRIPAID, FM.FINCCY, 'INR') TOTAL_PRI_PAID,
				UDF_CONVERTCURRENCY(TOTALPFTSCHD, FM.FINCCY, 'INR') TOTAL_PFT_SCHD,
				UDF_CONVERTCURRENCY(TOTALPFTPAID, FM.FINCCY, 'INR') TOTAL_PFT_PAID,
				UDF_CONVERTCURRENCY(EXCESS_AMOUNT, FM.FINCCY, 'INR') EXCESS_AMOUNT,
				UDF_CONVERTCURRENCY(EXCESS_AMT_PAID, FM.FINCCY, 'INR') EXCESS_AMT_PAID,
				PD.CURODDAYS,
				FM.CLOSINGSTATUS,
				CU.OWNERSHIP,
				UDF_CONVERTCURRENCY(CUSTINCOME, FM.FINCCY, 'INR') CUSTINCOME
       	FROM  FINANCEMAIN FM 
				INNER JOIN CIBIL_CUSTOMER_EXTRACT CU ON  CU.FINREFERENCE = FM.FINREFERENCE 
				INNER JOIN FINPFTDETAILS PD ON PD.FINREFERENCE = FM.FINREFERENCE				
				LEFT JOIN CIBIL_ACCOUNT_TYPES_MAPPING ATM ON ATM.FINTYPE = FM.FINTYPE
				LEFT JOIN CIBIL_ACCOUNT_TYPES AT ON AT.CODE = ATM.CODE
				LEFT JOIN (SELECT MA.FINREFERENCE, SUM(COALESCE(MA.ADVISEAMOUNT,0)- COALESCE(MA.PAIDAMOUNT,0)- COALESCE(MA.WAIVEDAMOUNT,0)) BOUNCE_DUE, SUM(MA.PAIDAMOUNT) BOUNCE_PAID FROM MANUALADVISE  MA  WHERE BOUNCEID > 0 GROUP BY MA.FINREFERENCE) MA ON MA.FINREFERENCE = FM.FINREFERENCE
				LEFT JOIN (SELECT FINREFERENCE, SUM(TOTPENALTYBAL) LATE_PAYMENT_PENALTY_DUE, SUM(TOTPENALTYPAID) LATE_PAYMENT_PENALTY_PAID FROM FINODDETAILS GROUP BY FINREFERENCE) FO ON FO.FINREFERENCE = FM.FINREFERENCE
				LEFT JOIN (SELECT FINREFERENCE, SUM(AMOUNT) EXCESS_AMOUNT, SUM (COALESCE(UTILISEDAMT,0)+ COALESCE(RESERVEDAMT,0)) EXCESS_AMT_PAID FROM FINEXCESSAMOUNT  GROUP BY FINREFERENCE) FE ON FE.FINREFERENCE = FM.FINREFERENCE
				LEFT JOIN  (SELECT CUSTID, COALESCE(SUM(CUSTINCOME), 0) CUSTINCOME FROM CUSTOMERINCOMES GROUP BY CUSTID) CI ON CI.CUSTID = CU.CUSTID
		</createView>
	</changeSet>
	<changeSet id="29" author="MAnoj">
		<createView viewName="CIBIL_FILE_INFO_VIEW" replaceIfExists="true">
			  select ID, FILE_NAME, CREATEDON, STATUS, FILE_LOCATION, (select id from data_engine_config where name = 'CIBIL_REPORT') configId, null  POSTEVENT  
				FROM CIBIL_FILE_INFO
		</createView>
	</changeSet>
</databaseChangeLog>
	