<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<property name="add.schema" value="dbo." dbms="mssql" />
	<property name="add.schema" value=" " dbms="oracle" />
	<property name="add.schema" value=" " dbms="postgresql" />
	<property name="call.substr" value="substring" dbms="mssql" />
	<property name="call.substr" value="substr" dbms="oracle" />
	<property name="call.substr" value="substring" dbms="postgresql" />
	<property name="call.auditdb" value="PLFAVANSEQC.." dbms="mssql" />
	<property name="call.auditdb" value=" " dbms="oracle" />
	<property name="call.concatenate" value="+" dbms="mssql" />
	<property name="call.concatenate" value="||" dbms="oracle" />
	<property name="call.concatenate" value="||" dbms="postgresql" />
	<property name="call.collength" value="LEN" dbms="mssql" />
	<property name="call.collength" value="LENGTH" dbms="oracle" />
	<property name="call.collength" value="LENGTH" dbms="postgresql" />
	<property name="call.date" value="getdate()" dbms="mssql" />
	<property name="call.date" value="sysdate" dbms="oracle" />
	<property name="call.date" value="now()" dbms="postgresql" />


	<changeSet id="pre_run_for_pgp" author="Jayant" runAlways="true"
		dbms="postgresql">
		<sql>
			Set search_path = plf,public,pg_catalog;
		</sql>
	</changeSet>
	
	<changeSet id="1" author="Siva">
		<sql>
			insert into BMTAMOUNTCODES values('REPAY',0,'bounceCharge_CGST_P','Bounce charge CGST paid',1,1,1000,Current_TimeStamp,'Approved',null,null,null,null,null,0);
			insert into BMTAMOUNTCODES values('REPAY',0,'bounceCharge_SGST_P','Bounce charge SGST paid',1,1,1000,Current_TimeStamp,'Approved',null,null,null,null,null,0);
			insert into BMTAMOUNTCODES values('REPAY',0,'bounceCharge_IGST_P','Bounce charge IGST paid',1,1,1000,Current_TimeStamp,'Approved',null,null,null,null,null,0);
			insert into BMTAMOUNTCODES values('REPAY',0,'bounceCharge_UGST_P','Bounce charge UGST paid',1,1,1000,Current_TimeStamp,'Approved',null,null,null,null,null,0);
		</sql>
	</changeSet>
	<changeSet id="2" author="SrinivasaVarma">
		<comment> New Column added allowInRule </comment>
		<createView viewName="extendedfielddetail_aview"
			replaceIfExists="true">
			select t1.moduleid,  t1.fieldname,  t2.modulename as lovdescmodulename, t2.submodulename as lovdescsubmodulename,
			t1.fieldtype, t1.fieldlength,  t1.fieldprec, t1.fieldlabel, t1.fieldmandatory,
			t1.fieldconstraint,  t1.fieldseqorder, t1.fieldlist, t1.fielddefaultvalue,
			t1.fieldminvalue, t1.fieldmaxvalue, t1.fieldunique, t1.extendedtype, t1.version,
			t1.lastmntby, t1.lastmnton,  t1.recordstatus,  t1.rolecode, t1.nextrolecode,
			t1.taskid,  t1.nexttaskid, t1.recordtype,  t1.workflowid, t1.multiline,  t1.parenttag,
			t1.inputelement, t1.editable,t1.allowInRule
			from extendedfielddetail t1 join extendedfieldheader t2 on t1.moduleid = t2.moduleid
		</createView>
	</changeSet>

	<changeSet id="3" author="SrinivasaVarma">
		<comment> New Column added allowInRule </comment>
		<createView viewName="extendedfielddetail_view"
			replaceIfExists="true">
			SELECT t1.moduleid, t1.fieldname, t2.modulename AS lovdescmodulename, t2.submodulename AS lovdescsubmodulename,
		    t1.fieldtype, t1.fieldlength, t1.fieldprec, t1.fieldlabel,
		    t1.fieldmandatory,
		    t1.fieldconstraint,
		    t1.fieldseqorder,
		    t1.fieldlist,
		    t1.fielddefaultvalue,
		    t1.fieldminvalue,
		    t1.fieldmaxvalue,
		    t1.fieldunique,
		    t1.extendedtype,
		    t1.version,
		    t1.lastmntby,
		    t1.lastmnton,
		    t1.recordstatus,
		    t1.rolecode,
		    t1.nextrolecode,
		    t1.taskid,
		    t1.nexttaskid,
		    t1.recordtype,
		    t1.workflowid,
		    t1.multiline,
		    t1.parenttag,
		    t1.inputelement,
		    t1.editable,
		    t1.allowInRule
		   FROM extendedfielddetail_temp t1 JOIN extendedfieldheader_temp t2 ON t1.moduleid = t2.moduleid
		UNION ALL
		 SELECT t1.moduleid,
		    t1.fieldname,
		    t2.modulename AS lovdescmodulename,
		    t2.submodulename AS lovdescsubmodulename,
		    t1.fieldtype,
		    t1.fieldlength,
		    t1.fieldprec,
		    t1.fieldlabel,
		    t1.fieldmandatory,
		    t1.fieldconstraint,
		    t1.fieldseqorder,
		    t1.fieldlist,
		    t1.fielddefaultvalue,
		    t1.fieldminvalue,
		    t1.fieldmaxvalue,
		    t1.fieldunique,
		    t1.extendedtype,
		    t1.version,
		    t1.lastmntby,
		    t1.lastmnton,
		    t1.recordstatus,
		    t1.rolecode,
		    t1.nextrolecode,
		    t1.taskid,
		    t1.nexttaskid,
		    t1.recordtype,
		    t1.workflowid,
		    t1.multiline,
		    t1.parenttag,
		    t1.inputelement,
		    t1.editable,
		    t1.allowInRule
		   FROM extendedfielddetail t1 JOIN extendedfieldheader t2 ON t1.moduleid = t2.moduleid
		   WHERE NOT (EXISTS ( SELECT 1 FROM extendedfielddetail_temp WHERE extendedfielddetail_temp.moduleid = t1.moduleid AND extendedfielddetail_temp.fieldname = t1.fieldname))
		</createView>
	</changeSet>
	
	<changeSet id="4" author="Siva">
		<addColumn tableName="FinRepayHeader">
			<column name="RealizeUnAmz" type="decimal(18,0)" />
		</addColumn>
		<addColumn tableName="FinRepayHeader_Temp">
			<column name="RealizeUnAmz" type="decimal(18,0)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="5" author="Siva" dbms="oracle">
		<addDefaultValue columnName="RealizeUnAmz" tableName="FinRepayHeader" defaultValue="0"/>
		<addDefaultValue columnName="RealizeUnAmz" tableName="FinRepayHeader_Temp" defaultValue="0"/>
	</changeSet>
	<changeSet id="5" author="Siva" dbms="postgresql">
		<addDefaultValue columnName="RealizeUnAmz" tableName="FinRepayHeader" defaultValue="0"/>
		<addDefaultValue columnName="RealizeUnAmz" tableName="FinRepayHeader_Temp" defaultValue="0"/>
	</changeSet>
		<changeSet id="5" author="Siva" dbms="mssql">
		<sql>
			alter table FinRepayHeader add constraint df_fph_RealizeUnAmz default 0 for RealizeUnAmz;
			alter table FinRepayHeader_Temp add constraint df_fph_t_RealizeUnAmz default 0 for RealizeUnAmz;
		</sql>
	</changeSet>
	<changeSet id="6" author="Siva">
		<sql>
			update FinRepayHeader set RealizeUnAmz = 0 where RealizeUnAmz is null;
			update FinRepayHeader_Temp set RealizeUnAmz = 0 where RealizeUnAmz is null;
		</sql>
	</changeSet>
	<changeSet id="7" author="Ganesh.p">
		<comment> change the severity of the LoanStartDate and DisbursmentDate should be matched error</comment>
		<sql>
			update ERRORDETAILS set severity='E' where code='65032';
		</sql>
	</changeSet>
	<changeSet id="8" author="Manoj">
		<comment> New Table : InterfaceMappingConfiguration for mapping PLF and InterfaceData</comment>
		<createTable tableName="InterfaceMappingConfiguration">
			<column name="ServiceName" type="varchar(100)">
				<constraints nullable="false"/>
			</column>
			<column name="ModuleCode" type="varchar(100)">
				<constraints nullable="false"/>
			</column>
			<column name="SourceCode" type="varchar(30)	">
			</column>
			<column name="DestCode" type="varchar(30)">
			</column>
			<column name="SourceId" type="bigint">
			</column>
			<column name="DestId" type="bigint">
			</column>
			<column name="DestDescription" type="varchar(200)" />
			<column name="active" type="boolean" />
			<column name="version" type="int" />
			<column name="lastmntby" type="bigint" />
			<column name="lastmnton" type="datetime" />
			<column name="recordstatus" type="varchar(50)" />
			<column name="rolecode" type="varchar(100)" />
			<column name="nextrolecode" type="varchar(200)" />
			<column name="taskid" type="varchar(50)" />
			<column name="nexttaskid" type="varchar(200)" />
			<column name="recordtype" type="varchar(50)" />
			<column name="workflowid" type="bigint">
				<constraints nullable="false" />
			</column>
		</createTable>
	</changeSet>
	<changeSet id="8_Post" author="manoj" dbms="oracle">
		<addDefaultValue columnName="SourceId" tableName="InterfaceMappingConfiguration" defaultValue="0"/>
		<addDefaultValue columnName="DestId" tableName="InterfaceMappingConfiguration" defaultValue="0"/>
	</changeSet>
	<changeSet id="8_Post" author="manoj" dbms="postgresql">
		<addDefaultValue columnName="SourceId" tableName="InterfaceMappingConfiguration" defaultValue="0"/>
		<addDefaultValue columnName="DestId" tableName="InterfaceMappingConfiguration" defaultValue="0"/>
	</changeSet>
		<changeSet id="8_Post" author="manoj" dbms="mssql">
		<sql>
			alter table InterfaceMappingConfiguration add constraint df_imc_SourceId default 0 for SourceId;
			alter table InterfaceMappingConfiguration add constraint df_imc_DestId default 0 for DestId;
		</sql>
	</changeSet>
	<changeSet id="9" author="Manoj">
		<createIndex tableName="InterfaceMappingConfiguration" indexName="IDX_IMC_MOD_SRC_SM">
			<column name="ModuleCode" type="varchar(100)"/>
			<column name="SourceCode" type="varchar(100)"/>
			<column name="ServiceName" type="varchar(100)"/>
		</createIndex>
	</changeSet>
	<changeSet id="10" author="Manoj">
		<createIndex tableName="InterfaceMappingConfiguration" indexName="IDX_IMC_MOD_SID_SM">
			<column name="ModuleCode" type="varchar(100)"/>
			<column name="SourceId" type="bigint"/>
			<column name="ServiceName" type="varchar(100)"/>
		</createIndex>
	</changeSet>
	<changeSet id="11" author="Manoj">
		<createIndex tableName="InterfaceMappingConfiguration" indexName="IDX_IMC_MOD_SM">
			<column name="ModuleCode" type="varchar(100)"/>
			<column name="ServiceName" type="varchar(100)"/>
		</createIndex>
	</changeSet>

	<changeSet id="12" author="Ganesh.p">
		<modifyDataType tableName="CollateralCoOwners_Temp"
			columnName="CoOwnerIDType" newDataType="VARCHAR(50)" />
	</changeSet>

	<changeSet id="13" author="Ganesh.p">
		<modifyDataType tableName="CollateralCoOwners"
			columnName="CoOwnerIDType" newDataType="VARCHAR(50)" />
	</changeSet>
	
</databaseChangeLog>
	