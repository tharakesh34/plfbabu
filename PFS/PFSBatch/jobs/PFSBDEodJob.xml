<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:lang="http://www.springframework.org/schema/lang"
	xsi:schemaLocation="http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang.xsd
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch-2.1.xsd">

	<import resource="launch-context.xml" />
	<import resource="PFSEndOfDayJob-db.xml" />

	<!-- PFS Application database DSN -->
	<bean id="pfsDatasource" class="org.apache.commons.dbcp.BasicDataSource"
		destroy-method="close">
		<property name="driverClassName" value="${pfsjdbc.driverClassName}" />
		<property name="url" value="${pfsjdbc.url}" />
		<property name="username" value="${pfsjdbc.username}" />
		<property name="password" value="${pfsjdbc.password}" />
		<property name="validationQuery" value="SELECT 1" />
		<property name="testOnBorrow" value="1" />
		<property name="maxActive" value="2" />
		<property name="maxIdle" value="1" />
		<property name="maxWait" value="10000" />
	</bean>

	<!-- _____________________________________________REFERENCE BEANS _________________________________________ -->
	<!-- ====================================================== -->
	<!-- Generic Common DAOs -->
	<!-- ====================================================== -->

	<!-- Error Details -->
	<bean id="errorDetailsDAO" class="com.pennant.backend.dao.impl.ErrorDetailsDAOImpl">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Basis Code -->
	<bean id="basisCodeDAO" abstract="true"
		class="com.pennant.backend.dao.impl.BasisCodeDAO">
		<property name="errorDetailsDAO" ref="errorDetailsDAO" />
	</bean>

	<!-- PFS SMT Parameters -->
	<bean id="pFSParameterDAO"
		class="com.pennant.backend.dao.smtmasters.impl.PFSParameterDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- ====================================================== -->
	<!-- Finance Related Generic DAOs -->
	<!-- ====================================================== -->

	<!-- Finace Type Details -->
	<bean id="financeTypeDAO"
		class="com.pennant.backend.dao.rmtmasters.impl.FinanceTypeDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Finance Main -->
	<bean id="financeMainDAO" class="com.pennant.backend.dao.finance.impl.FinanceMainDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Finace Schedule Details -->
	<bean id="financeScheduleDetailDAO"
		class="com.pennant.backend.dao.finance.impl.FinanceScheduleDetailDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Profit Details -->
	<bean id="profitDetailsDAO"
		class="com.pennant.backend.dao.finance.impl.FinanceProfitDetailDAOImpl">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Repay Instructions -->
	<bean id="repayInstructionDAO"
		class="com.pennant.backend.dao.finance.impl.RepayInstructionDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Deferment Header -->
	<bean id="defermentHeaderDAO"
		class="com.pennant.backend.dao.finance.impl.DefermentHeaderDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Deferment Details -->
	<bean id="defermentDetailDAO"
		class="com.pennant.backend.dao.finance.impl.DefermentDetailDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Finance Profit Detail Filler -->
	<bean name="financeProfitDetailFiller" class="com.pennant.app.util.FinanceProfitDetailFiller">
	</bean>

	<!-- Ovedue Details TBD -->
	<bean id="finODDetailsDAO"
		class="com.pennant.backend.dao.finance.impl.FinODDetailsDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Finance Suspense Head TBD -->
	<bean id="financeSuspHeadDAO"
		class="com.pennant.backend.dao.finance.impl.FinanceSuspHeadDAOImpl">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- ====================================================== -->
	<!-- Potings Related Generic DAOs -->
	<!-- ====================================================== -->
	<!-- Postings -->
	<bean id="postingsDAO"
		class="com.pennant.backend.dao.rulefactory.impl.PostingsDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Syatem Parameter Details -->
	<bean id="SystemParameterDetails " class="com.pennant.app.util.SystemParameterDetails" init-method="Init">
		<property name="pFSParameterDAO" ref="pFSParameterDAO" />
	</bean>

	<!-- Accounting Engine Execution -->
	<bean name="engineExecution" class="com.pennant.app.util.AccountEngineExecution">
		<property name="financeMainDAO" ref="financeMainDAO" />
		<property name="financeTypeDAO" ref="financeTypeDAO" />
		<property name="transactionEntryDAO" ref="transactionEntryDAO" />
		<property name="internalAccountDefinitionDAO" ref="systemInternalAccountDefinitionDAO" />
		<property name="ruleDAO" ref="ruleDAO" />
		<property name="customerDAO" ref="customerDAO" />
		<property name="financeScheduleDetailDAO" ref="financeScheduleDetailDAO" />
		<property name="currencyDAO" ref="currencyDAO" />
		<property name="defermentHeaderDAO" ref="defermentHeaderDAO" />
		<property name="financeSuspHeadDAO" ref="financeSuspHeadDAO" />
		<property name="overdueChargeDAO" ref="overdueChargeDAO" />
		<property name="accountInterfaceService" ref="accountInterfaceService" />
	</bean>

	<!-- Postings Preparation Util -->
	<bean name="postingsPreparationUtil" class="com.pennant.app.util.PostingsPreparationUtil">
		<property name="engineExecution" ref="engineExecution" />
		<property name="accountProcessUtil" ref="accountProcessUtil" />
		<property name="postingsInterfaceService" ref="postingsInterfaceService" />
		<property name="provisionMovementDAO" ref="provisionMovementDAO" />
		<property name="postingsDAO" ref="postingsDAO" />
	</bean>

	<!-- CoreBanking Interface Services -->
	
	<bean id="coreDBDatasource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close">
	  <property name="driverClassName" value="${coredbjdbc.driverClassName}" />
	  <property name="url" value="${coredbjdbc.url}" />
	  <property name="username" value="${coredbjdbc.username}" />
	  <property name="password" value="${coredbjdbc.password}" />
	</bean>
	
	<bean id="coreDBDao" class="com.pennant.coredb.dao.CoreDBDAO">
		<property name="dataSource" ref="coreDBDatasource" />
	</bean>
	
	 <bean id="accountInterfaceService" class="com.pennant.Interface.service.impl.AccountInterfaceServiceCoreDBImpl" >
   		<property name="accountProcess" ref="accountProcess" />
   	</bean>
	   	
     <bean id="postingsInterfaceService" class="com.pennant.Interface.service.impl.PostingsInterfaceServiceCoreDBImpl" >
   		<property name="accountPostingProcess" ref="accountPostingProcess" />
   	</bean>
   	<bean id="calendarInterfaceService" class="com.pennant.Interface.service.impl.CalendarInterfaceServiceCoreDBImpl">
		<property name="dateRollOverProcess" ref="dateRollOverProcess" />
		<property name="weekendMasterDAO" ref="weekendMasterDAO" />
		<property name="holidayMasterDAO" ref="holidayMasterDAO" />
	</bean>
	
	<bean id="accountProcess" class="com.pennant.coredb.process.AccountProcess">
		<property name="coreDBDao" ref="coreDBDao" />
	</bean>

	<bean id="accountPostingProcess" class="com.pennant.coredb.process.AccountPostingProcess">
		<property name="coreDBDao" ref="coreDBDao" />
	</bean>
	
	<bean id="dateRollOverProcess" class="com.pennant.coredb.process.DateRollOverProcess">
		<property name="coreDBDao" ref="coreDBDao" />
	</bean>
	
	<bean id="hostConnection" class="com.pennant.equation.util.HostConnection"
		destroy-method="disConnection" />

	<!-- Account Details -->
	<bean id="accountsDAO" class="com.pennant.backend.dao.accounts.impl.AccountsDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Account process Util -->
	<bean name="accountProcessUtil" class="com.pennant.app.util.AccountProcessUtil">
		<property name="accountsDAO" ref="accountsDAO" />
	</bean>

	<!-- Transaction Entry -->
	<bean id="transactionEntryDAO"
		class="com.pennant.backend.dao.rmtmasters.impl.TransactionEntryDAOImpl">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Finance Account Number Execution TBD -->
	<bean id="financeAccountNumberDAO"
		class="com.pennant.backend.dao.util.impl.FinanceAccountNumberDAOImpl">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- System Internal Account Definition -->
	<bean id="systemInternalAccountDefinitionDAO"
		class="com.pennant.backend.dao.masters.impl.SystemInternalAccountDefinitionDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Rule -->
	<bean id="ruleDAO" class="com.pennant.backend.dao.rulefactory.impl.RuleDAOImpl">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Customer -->
	<bean id="customerDAO"
		class="com.pennant.backend.dao.customermasters.impl.CustomerDAOImpl">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Currency -->
	<bean id="currencyDAO"
		class="com.pennant.backend.dao.applicationmaster.impl.CurrencyDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- ====================================================== -->
	<!-- Job Specific DAOs -->
	<!-- ====================================================== -->

	<!-- +++++++DATE ROLLOVER ++++++++ -->

	<!-- Holiday Util -->
	<bean id="holidayUtil" class="com.pennant.app.util.HolidayUtil">
		<property name="weekendMasterDAO" ref="weekendMasterDAO" />
		<property name="holidayMasterDAO" ref="holidayMasterDAO" />
	</bean>

	<!-- Weekend Master -->
	<bean id="weekendMasterDAO"
		class="com.pennant.backend.dao.smtmasters.impl.WeekendMasterDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Holiday Master -->
	<bean id="holidayMasterDAO"
		class="com.pennant.backend.dao.smtmasters.impl.HolidayMasterDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- +++++++RATE REVIEWS ROLLOVER ++++++++ -->
	<!-- Base Rate -->
	<bean id="baseRateDAO"
		class="com.pennant.backend.dao.applicationmaster.impl.BaseRateDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Special Rate -->
	<bean id="splRateDAO"
		class="com.pennant.backend.dao.applicationmaster.impl.SplRateDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Rate Util -->
	<bean name="RateUtil" class="com.pennant.app.util.RateUtil">
		<property name="baseRateDAO" ref="baseRateDAO" />
		<property name="splRateDAO" ref="splRateDAO" />
	</bean>

	<!-- +++++++REPAYMENT QUEUING & POSTINGS ++++++++ -->
	<!-- Repayment Priority -->
	<bean id="financeRepayPriorityDAO"
		class="com.pennant.backend.dao.finance.impl.FinanceRepayPriorityDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Repay Queue -->
	<bean id="finRepayQueueDAO"
		class="com.pennant.backend.dao.FinRepayQueue.impl.FinRepayQueueDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Finance Repayment -->
	<bean id="financeRepaymentsDAO"
		class="com.pennant.backend.dao.Repayments.impl.FinanceRepaymentsDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Repayment Posting util -->
	<bean id="repayPostingUtil" class="com.pennant.app.util.RepaymentPostingsUtil">
		<property name="financeScheduleDetailDAO" ref="financeScheduleDetailDAO" />
		<property name="financeRepaymentsDAO" ref="financeRepaymentsDAO" />
		<property name="financeMainDAO" ref="financeMainDAO" />
		<property name="finRepayQueueDAO" ref="finRepayQueueDAO" />
		<property name="finODDetailsDAO" ref="finODDetailsDAO" />
		<property name="defermentDetailDAO" ref="defermentDetailDAO" />
		<property name="suspensePostingUtil" ref="suspensePostingUtil" />
		<property name="postingsPreparationUtil" ref="postingsPreparationUtil" />
	</bean>

	<!-- Suspense Posting util -->
	<bean id="suspensePostingUtil" class="com.pennant.app.util.SuspensePostingUtil">
		<property name="financeScheduleDetailDAO" ref="financeScheduleDetailDAO" />
		<property name="finODDetailsDAO" ref="finODDetailsDAO" />
		<property name="financeSuspHeadDAO" ref="financeSuspHeadDAO" />
		<property name="postingsPreparationUtil" ref="postingsPreparationUtil" />
	</bean>

	<!-- +++++++OVERDUE RECOVERY CALCULATIONS & POSTINGS ++++++++ -->
	<!-- Overdue Charge Details -->
	<bean id="overdueChargeDAO"
		class="com.pennant.backend.dao.rulefactory.impl.OverdueChargeDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Overdue Charge Recovery -->
	<bean id="overdueChargeRecoveryDAO"
		class="com.pennant.backend.dao.financemanagement.impl.OverdueChargeRecoveryDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Overdue Charge Recovery Posting Util -->
	<bean id="recoveryPostingsUtil" class="com.pennant.app.util.OverDueRecoveryPostingsUtil">
		<property name="financeMainDAO" ref="financeMainDAO" />
		<property name="accountInterfaceService" ref="accountInterfaceService" />
		<property name="postingsPreparationUtil" ref="postingsPreparationUtil" />
	</bean>

	<!-- +++++++PROVISION CALCULATIONS & POSTINGS ++++++++ -->
	<!-- Provision Details -->
	<bean id="provisionDAO"
		class="com.pennant.backend.dao.financemanagement.impl.ProvisionDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Provision Movement Details -->
	<bean id="provisionMovementDAO"
		class="com.pennant.backend.dao.financemanagement.impl.ProvisionMovementDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Provision Calculation Util -->
	<bean id="provisionCalculationUtil" class="com.pennant.app.util.ProvisionCalculationUtil">
		<property name="financeMainDAO" ref="financeMainDAO" />
		<property name="financeScheduleDetailDAO" ref="financeScheduleDetailDAO" />
		<property name="financeProfitDetailDAO" ref="profitDetailsDAO" />
		<property name="provisionDAO" ref="provisionDAO" />
		<property name="provisionMovementDAO" ref="provisionMovementDAO" />
		<property name="engineExecution" ref="engineExecution" />
		<property name="postingsPreparationUtil" ref="postingsPreparationUtil" />
	</bean>

	<!-- +++++++DISBURSEMENT POSTINGS ++++++++ -->
	<!-- Finance Disbursement Details -->
	<bean id="financeDisbursementDAO"
		class="com.pennant.backend.dao.finance.impl.FinanceDisbursementDAOImpl"
		parent="basisCodeDAO">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- _____________________________________________ TASKLET BEANS _________________________________________ -->

	<!-- Calendar Updation -->
	<bean id="calendarUpdationTaskLet"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref bean="pfsTransactionManager" />
		</property>
		<property name="target">
			<ref bean="calendarUpdationTarget" />
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="saveOrUpdate*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
				<prop key="doApprove*">PROPAGATION_REQUIRED</prop>
				<prop key="doReject*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
			</props>
		</property>
	</bean>

	<bean id="calendarUpdationTarget" class="com.pennant.backend.endofday.calendar.CalendarUpdation">
		<property name="calendarInterfaceService" ref="calendarInterfaceService" />
		<property name="accountsDAO" ref="accountsDAO" />
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Overdue Payments TBD -->
	<bean id="overDueCalculationTaskLet"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref bean="pfsTransactionManager" />
		</property>
		<property name="target">
			<ref bean="overDueCalculationTarget" />
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="saveOrUpdate*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
				<prop key="doApprove*">PROPAGATION_REQUIRED</prop>
				<prop key="doReject*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
			</props>
		</property>
	</bean>

	<bean id="overDueCalculationTarget"
		class="com.pennant.backend.endofday.overduepayments.OverDueRecoveryCalculation">
		<property name="recoveryDAO" ref="overdueChargeRecoveryDAO" />
		<property name="engineExecution" ref="engineExecution" />
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Overdue Charges TBD -->
	<bean id="overDuePostingsTaskLet"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref bean="pfsTransactionManager" />
		</property>
		<property name="target">
			<ref bean="overDuePostingsTarget" />
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="saveOrUpdate*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
				<prop key="doApprove*">PROPAGATION_REQUIRED</prop>
				<prop key="doReject*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
			</props>
		</property>
	</bean>

	<bean id="overDuePostingsTarget"
		class="com.pennant.backend.endofday.overduepayments.OverDueRecoveryPostings">
		<property name="recoveryDAO" ref="overdueChargeRecoveryDAO" />
		<property name="recoveryPostingsUtil" ref="recoveryPostingsUtil" />
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Profit Rate Reviews TBD -->
	<bean id="rateReviewCalculationTasklet"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref bean="pfsTransactionManager" />
		</property>
		<property name="target">
			<ref bean="rateReviewCalculationTarget" />
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="saveOrUpdate*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
				<prop key="doApprove*">PROPAGATION_REQUIRED</prop>
				<prop key="doReject*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
			</props>
		</property>
	</bean>

	<bean id="rateReviewCalculationTarget" class="com.pennant.backend.endofday.ratereview.RateReview">
		<property name="financeMainDAO" ref="financeMainDAO" />
		<property name="financeScheduleDetailDAO" ref="financeScheduleDetailDAO" />
		<property name="repayInstructionDAO" ref="repayInstructionDAO" />
		<property name="defermentDetailDAO" ref="defermentDetailDAO" />
		<property name="defermentHeaderDAO" ref="defermentHeaderDAO" />
		<property name="financeTypeDAO" ref="financeTypeDAO" />
		<property name="financeProfitDetailDAO" ref="profitDetailsDAO" />
		<property name="financeProfitDetailFiller" ref="financeProfitDetailFiller" />
		<property name="postingsPreparationUtil" ref="postingsPreparationUtil" />
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Profit Rate Change Postings TBD -->
	<bean id="refreshRateChangesTasklet"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref bean="pfsTransactionManager" />
		</property>
		<property name="target">
			<ref bean="refreshRateChangesTarget" />
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="saveOrUpdate*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
				<prop key="doApprove*">PROPAGATION_REQUIRED</prop>
				<prop key="doReject*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
			</props>
		</property>
	</bean>

	<bean id="refreshRateChangesTarget"
		class="com.pennant.backend.endofday.ratereview.RefreshRateChanges">
		<property name="financeMainDAO" ref="financeMainDAO" />
		<property name="financeScheduleDetailDAO" ref="financeScheduleDetailDAO" />
		<property name="repayInstructionDAO" ref="repayInstructionDAO" />
		<property name="defermentDetailDAO" ref="defermentDetailDAO" />
		<property name="defermentHeaderDAO" ref="defermentHeaderDAO" />
		<property name="financeTypeDAO" ref="financeTypeDAO" />
		<property name="financeProfitDetailDAO" ref="profitDetailsDAO" />
		<property name="financeProfitDetailFiller" ref="financeProfitDetailFiller" />
		<property name="postingsPreparationUtil" ref="postingsPreparationUtil" />
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Capitalization Postings TBD -->
	<bean id="capitalizationPostingsTasklet"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref bean="pfsTransactionManager" />
		</property>
		<property name="target">
			<ref bean="capitalizationPostingsTarget" />
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="saveOrUpdate*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
				<prop key="doApprove*">PROPAGATION_REQUIRED</prop>
				<prop key="doReject*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
			</props>
		</property>
	</bean>

	<bean id="capitalizationPostingsTarget"
		class="com.pennant.backend.endofday.capitalization.CapitalizationPostings">
		<property name="financeProfitDetailDAO" ref="profitDetailsDAO" />
		<property name="postingsPreparationUtil" ref="postingsPreparationUtil" />
		<property name="suspensePostingUtil" ref="suspensePostingUtil" />
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Repayments Queuing -->
	<bean id="repayQueueTasklet"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref bean="pfsTransactionManager" />
		</property>
		<property name="target">
			<ref bean="repayQueueCalculationTarget" />
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="saveOrUpdate*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
				<prop key="doApprove*">PROPAGATION_REQUIRED</prop>
				<prop key="doReject*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
			</props>
		</property>
	</bean>

	<bean id="repayQueueCalculationTarget"
		class="com.pennant.backend.endofday.repayqueue.RepayQueueCalculation">
		<property name="financeRepayPriorityDAO" ref="financeRepayPriorityDAO" />
		<property name="finRepayQueueDAO" ref="finRepayQueueDAO" />
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Repayment Postings -->
	<bean id="repayQueuePostingsTasklet"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref bean="pfsTransactionManager" />
		</property>
		<property name="target">
			<ref bean="repayQueuePostingsTarget" />
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="saveOrUpdate*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
				<prop key="doApprove*">PROPAGATION_REQUIRED</prop>
				<prop key="doReject*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
			</props>
		</property>
	</bean>

	<bean id="repayQueuePostingsTarget"
		class="com.pennant.backend.endofday.repayqueue.RepayQueuePostings">
		<property name="profitDetailDAO" ref="profitDetailsDAO" />
		<property name="financeMainDAO" ref="financeMainDAO" />
		<property name="financeScheduleDetailDAO" ref="financeScheduleDetailDAO" />
		<property name="postingsUtil" ref="repayPostingUtil" />
		<property name="accountInterfaceService" ref="accountInterfaceService" />
		<property name="suspensePostingUtil" ref="suspensePostingUtil" />
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Amortization Calculation -->
	<bean id="amortizationTasklet"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref bean="pfsTransactionManager" />
		</property>
		<property name="target">
			<ref bean="amortizationTarget" />
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="saveOrUpdate*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
				<prop key="doApprove*">PROPAGATION_REQUIRED</prop>
				<prop key="doReject*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
			</props>
		</property>
	</bean>

	<bean id="amortizationTarget"
		class="com.pennant.backend.endofday.amortization.AmortizationCalculation">
		<property name="financeProfitDetailDAO" ref="profitDetailsDAO" />
		<property name="finMainDAO" ref="financeMainDAO" />
		<property name="finScheduleDAO" ref="financeScheduleDetailDAO" />
		<property name="financeProfitDetailFiller" ref="financeProfitDetailFiller" />
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Amortization Postings -->
	<bean id="amortizationPostingsTasklet"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref bean="pfsTransactionManager" />
		</property>
		<property name="target">
			<ref bean="amortizationPostingsTarget" />
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="saveOrUpdate*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
				<prop key="doApprove*">PROPAGATION_REQUIRED</prop>
				<prop key="doReject*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
			</props>
		</property>
	</bean>

	<bean id="amortizationPostingsTarget"
		class="com.pennant.backend.endofday.amortization.AmortizationPostings">
		<property name="financeProfitDetailDAO" ref="profitDetailsDAO" />
		<property name="financeSuspHeadDAO" ref="financeSuspHeadDAO" />
		<property name="postingsPreparationUtil" ref="postingsPreparationUtil" />
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Provision Calculations TBD -->
	<bean id="provisionCalculationTasklet"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref bean="pfsTransactionManager" />
		</property>
		<property name="target">
			<ref bean="provisionCalculationTarget" />
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="saveOrUpdate*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
				<prop key="doApprove*">PROPAGATION_REQUIRED</prop>
				<prop key="doReject*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
			</props>
		</property>
	</bean>

	<bean id="provisionCalculationTarget"
		class="com.pennant.backend.endofday.provision.ProvisionCalculation">
		<property name="provisionCalculationUtil" ref="provisionCalculationUtil" />
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Provisions Postings TBD -->
	<bean id="provisionPostingsTasklet"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref bean="pfsTransactionManager" />
		</property>
		<property name="target">
			<ref bean="provisionPostingsTarget" />
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="saveOrUpdate*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
				<prop key="doApprove*">PROPAGATION_REQUIRED</prop>
				<prop key="doReject*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
			</props>
		</property>
	</bean>

	<bean id="provisionPostingsTarget"
		class="com.pennant.backend.endofday.provision.ProvisionPostings">
		<property name="financeMainDAO" ref="financeMainDAO" />
		<property name="financeScheduleDetailDAO" ref="financeScheduleDetailDAO" />
		<property name="financeProfitDetailDAO" ref="profitDetailsDAO" />
		<property name="postingsPreparationUtil" ref="postingsPreparationUtil" />
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Deprecation Postings TBD -->
	<bean id="depreciationPostingsTasklet"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref bean="pfsTransactionManager" />
		</property>
		<property name="target">
			<ref bean="depreciationPostingsTarget" />
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="saveOrUpdate*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
				<prop key="doApprove*">PROPAGATION_REQUIRED</prop>
				<prop key="doReject*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
			</props>
		</property>
	</bean>

	<bean id="depreciationPostingsTarget"
		class="com.pennant.backend.endofday.depreciation.DepreciationPostings">
		<property name="postingsPreparationUtil" ref="postingsPreparationUtil" />
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Non-Revolving Limits Adjustments TBD -->

	<!-- Date Rollovers for Finance TBD -->
	<bean id="dateRollOverTasklet"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref bean="pfsTransactionManager" />
		</property>
		<property name="target">
			<ref bean="dateRollOverTarget" />
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="saveOrUpdate*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
				<prop key="doApprove*">PROPAGATION_REQUIRED</prop>
				<prop key="doReject*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
			</props>
		</property>
	</bean>

	<bean id="dateRollOverTarget" class="com.pennant.backend.endofday.daterollover.DateRollOver">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Disbursement Postings TBD -->
	<bean id="dibursementPostingsTasklet"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref bean="pfsTransactionManager" />
		</property>
		<property name="target">
			<ref bean="dibursementPostingsTarget" />
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="saveOrUpdate*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
				<prop key="doApprove*">PROPAGATION_REQUIRED</prop>
				<prop key="doReject*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
			</props>
		</property>
	</bean>

	<bean id="dibursementPostingsTarget"
		class="com.pennant.backend.endofday.disbursement.DisbursementPostings">
		<property name="financeMainDAO" ref="financeMainDAO" />
		<property name="financeScheduleDetailDAO" ref="financeScheduleDetailDAO" />
		<property name="financeProfitDetailDAO" ref="profitDetailsDAO" />
		<property name="financeDisbursementDAO" ref="financeDisbursementDAO" />
		<property name="postingsPreparationUtil" ref="postingsPreparationUtil" />
		<property name="dataSource" ref="pfsDatasource" />
	</bean>
	
	<!-- Value Date Updation -->
	<bean id="valueDateUpdationTasklet"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref bean="pfsTransactionManager" />
		</property>
		<property name="target">
			<ref bean="valueDateUpdationTarget" />
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="saveOrUpdate*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
				<prop key="doApprove*">PROPAGATION_REQUIRED</prop>
				<prop key="doReject*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
			</props>
		</property>
	</bean>

	<bean id="valueDateUpdationTarget" class="com.pennant.backend.endofday.limitdecider.ValueDateUpdation">
		<property name="dataSource" ref="pfsDatasource" />
	</bean>

	<!-- Loop Limit Decider -->
	<bean id="limitDecider"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref bean="pfsTransactionManager" />
		</property>
		<property name="target">
			<ref bean="limitDeciderTarget" />
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="saveOrUpdate*">PROPAGATION_REQUIRED</prop>
				<prop key="delete*">PROPAGATION_REQUIRED</prop>
				<prop key="doApprove*">PROPAGATION_REQUIRED</prop>
				<prop key="doReject*">PROPAGATION_REQUIRED</prop>
				<prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
			</props>
		</property>
	</bean>

	<bean id="limitDeciderTarget" class="com.pennant.backend.endofday.limitdecider.LimitDecider">
		<property name="hostConnection" ref="hostConnection" />
		<property name="dataSource" ref="pfsDatasource" />
	</bean>


	<!-- _____________________________________________ JOB FLOW DEFINITION _________________________________________ -->
	<!-- The job definition for the PLF End of Day -->
	<job id="PradeepPFSEndOfDayJob" xmlns="http://www.springframework.org/schema/batch">

		<!-- Overdue Payments -->
		<step id="calendarUpdation">
			<tasklet ref="calendarUpdationTaskLet" />
			<next on="*" to="overDueCalculation" />
			<end on="FAILED" />
		</step>

		<!-- Overdue Payments -->
		<step id="overDueCalculation">
			<tasklet ref="overDueCalculationTaskLet" />
			<next on="*" to="overDuePostings" />
			<end on="FAILED" />
		</step>

		<!-- Overdue Charges -->
		<step id="overDuePostings">
			<tasklet ref="overDuePostingsTaskLet" />
			<next on="*" to="refreshRateChanges" />
			<end on="FAILED" />
		</step>

		<!-- Profit Rate Change Postings -->
		<step id="refreshRateChanges">
			<tasklet ref="refreshRateChangesTasklet" />
			<next on="*" to="capitalizationPostings" />
			<end on="FAILED" />
		</step>

		<!-- Capitalization Postings -->
		<step id="capitalizationPostings">
			<tasklet ref="capitalizationPostingsTasklet" />
			<next on="*" to="repayQueueCalculation" />
			<end on="FAILED" />
		</step>

		<!-- Schedule Repayments Queuing -->
		<step id="repayQueueCalculation">
			<tasklet ref="repayQueueTasklet" />
			<next on="*" to="repayQueuePostings" />
			<end on="FAILED" />
		</step>

		<!-- Schedule Repayment Postings -->
		<step id="repayQueuePostings">
			<tasklet ref="repayQueuePostingsTasklet" />
			<next on="*" to="amortizationCalculation" />
			<end on="FAILED" />
		</step>

		<!-- Amortization Calculation -->
		<step id="amortizationCalculation">
			<tasklet ref="amortizationTasklet" />
			<next on="*" to="amortizationPostings" />
			<end on="FAILED" />
		</step>

		<!-- Amortization Postings -->
		<step id="amortizationPostings">
			<tasklet ref="amortizationPostingsTasklet" />
			<next on="*" to="provisionCalculation" />
			<end on="FAILED" />
		</step>

		<!-- Provision Calculations -->
		<step id="provisionCalculation">
			<tasklet ref="provisionCalculationTasklet" />
			<next on="*" to="provisionPostings" />
			<end on="FAILED" />
		</step>

		<!-- Provisions Postings -->
		<step id="provisionPostings">
			<tasklet ref="provisionPostingsTasklet" />
			<next on="*" to="depreciationPostings" />
			<end on="FAILED" />
		</step>

		<!-- Depreciation Calculation -->
		<step id="depreciationPostings">
			<tasklet ref="depreciationPostingsTasklet" />
			<next on="*" to="dibursementPostings" />
			<end on="FAILED" />
		</step>

		<!-- Non-Revolving Limits Adjustments -->

		<!-- Disbursement Postings -->
		<step id="dibursementPostings">
			<tasklet ref="dibursementPostingsTasklet" />
			<next on="*" to="valueDateUpdation" />
			<end on="FAILED" />
		</step>
		
		<!-- Value Date Updation -->
		<step id="valueDateUpdation">
			<tasklet ref="valueDateUpdationTasklet" />
			<next on="*" to="rateReviewCalculation" />
			<end on="FAILED" />
		</step>
		
		<!-- Profit Rate Reviews -->
		<step id="rateReviewCalculation">
			<tasklet ref="rateReviewCalculationTasklet" />
			<next on="*" to="dateRollOver" />
			<end on="FAILED" />
		</step>

		<!-- Date Rollovers for Finance -->
		<step id="dateRollOver">
			<tasklet ref="dateRollOverTasklet" />
			<next on="*" to="limitDecision" />
			<end on="FAILED" />
		</step>

		<!-- Limit Decision For loop -->
		<decision id="limitDecision" decider="limitDecider">
			<next on="UNKNOWN" to="overDueCalculation" />
			<end on="COMPLETED" exit-code="COMPLETED" />
		</decision>

	</job>

</beans>